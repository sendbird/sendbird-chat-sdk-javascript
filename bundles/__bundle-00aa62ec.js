import{_ as e,c as t,R as n,g as r,j as s,G as i,U as a,I as o,J as u,q as c,o as l,d as h,e as d,p as _,K as f,N as p,O as v,Q as m,T as E,X as g,Y as y,Z as N,$ as C,a0 as b,a1 as A,S as M,b as S,a as T,i as I,a2 as U,a3 as w,a4 as L,a5 as D,a6 as R,W as O,A as P,f as k,h as x,k as F,a7 as H,a8 as V,a9 as G,aa as B,B as q,ab as K,ac as j,ad as Q,ae as z,af as Y,ag as J,t as W,ah as X,w as Z,ai as $,u as ee,z as te,aj as ne,E as re,V as se,ak as ie,al as ae,am as oe,an as ue,ao as ce,ap as le,aq as he,ar as de,as as _e,at as fe,au as pe}from"./__bundle-1d33b216.js";import{b as ve,C as me,U as Ee,e as ge,F as ye,f as Ne,g as Ce,h as be,i as Ae,j as Me,k as Se,l as Te,T as Ie,m as Ue,D as we,n as Le,o as De,p as Re,q as Oe,A as Pe,a as ke}from"./__bundle-a7378a38.js";var xe,Fe,He,Ve,Ge;!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error"}(xe||(xe={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off"}(Fe||(Fe={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown"}(He||(He={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default"}(Ve||(Ve={})),function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited"}(Ge||(Ge={}));var Be,qe,Ke=function(i){function a(e,r){var s=i.call(this,e,r)||this;return s.state=null,s.role=null,s.isMuted=!1,s.isBlockedByMe=!1,s.isBlockingMe=!1,s.state=t(Ge,r.state)?r.state:null,s.role=t(n,r.role)?r.role:null,r.hasOwnProperty("is_muted")&&(s.isMuted=r.is_muted),r.hasOwnProperty("is_blocked_by_me")&&(s.isBlockedByMe=r.is_blocked_by_me),r.hasOwnProperty("is_blocking_me")&&(s.isBlockingMe=r.is_blocking_me),s}return e(a,i),a.payloadify=function(e){return e?r(s(s({},i.payloadify.call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})):null},a}(ve),je=function(t){function n(e,n){var r,s,o=this;return(o=t.call(this,e)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",o.channelType=null!==(s=n.channel_type)&&void 0!==s?s:i.GROUP,o.reader=new a(o._iid,n.user),o.readAt=n.ts,o}return e(n,t),n}(o);!function(e){e.LATEST_LAST_MESSAGE="latest_last_message",e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(Be||(Be={})),function(e){e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(qe||(qe={}));var Qe,ze,Ye,Je,We,Xe,Ze,$e,et=function(e){switch(e){case Be.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case Be.CHRONOLOGICAL:return["-createdAt","syncIndex"];case Be.CHANNEL_NAME_ALPHABETICAL:return["name"]}};!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(Qe||(Qe={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(ze||(ze={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only",e.EXCLUSIVE_ONLY="exclusive_only"}(Ye||(Ye={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(Je||(Je={})),function(e){e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(We||(We={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(Xe||(Xe={})),function(e){e.AND="AND",e.OR="OR"}(Ze||(Ze={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}($e||($e={}));var tt,nt=function(){function e(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=ze.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=Ye.ALL,this.publicChannelFilter=Qe.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=Je.ALL,this.hiddenChannelFilter=We.UNHIDDEN,this.includeFrozen=!0}return e.prototype._isFriend=function(e){return!!e.friendDiscoveryKey||!!e.friendName},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=Ze.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t=new e;this.searchFilter&&t.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&t.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,r=n.query,s=n.fields;if(r&&s&&s.length>0&&!s.some((function(t){switch(t){case $e.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case $e.MEMBER_NICKNAME:return e.members.some((function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var i=this._userIdsFilter,a=i.userIds,o=i.includeMode,c=i.queryType,l=e.members.map((function(e){return e.userId}));if(o){if(a.length>0)switch(c){case Ze.AND:if(a.some((function(e){return!l.includes(e)})))return!1;break;case Ze.OR:if(a.every((function(e){return!l.includes(e)})))return!1}}else{if(a.includes(t)||a.push(t),e.members.length>a.length)return!1;if(!u(a,l))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var h=this.nicknameContainsFilter.toLowerCase();if(e.members.every((function(e){return!e.nickname.toLowerCase().includes(h)})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.memberStateFilter)switch(this.memberStateFilter){case ze.JOINED:if("joined"!==e.myMemberState)return!1;break;case ze.INVITED:if("invited"!==e.myMemberState)return!1;break;case ze.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case ze.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case We.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case We.HIDDEN:if(!e.isHidden)return!1;break;case We.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case We.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===Je.UNREAD_MESSAGE)if(0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case Qe.PUBLIC:if(!e.isPublic)return!1;break;case Qe.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case Ye.SUPER:if(!e.isSuper)return!1;break;case Ye.NON_SUPER:if(e.isSuper)return!1}return!0},e}(),rt=100,st="GroupChannel",it="url",at="Message",ot="messageId",ut=function(t){function n(e,n){var r=n.sdkState,s=n.cacheContext,i=t.call(this,e)||this;return i._channels=new Map,i._sdkState=r,i._cacheContext=s,i}return e(n,t),Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("GroupChannel"):null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e,t){return void 0===t&&(t=0),s(s({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},n.prototype._deserialize=function(e){return mn.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(n.prototype,"channels",{get:function(){return c([],l(this._channels.values()),!1)},enumerable:!1,configurable:!0}),n.prototype.isCachedInMemory=function(e){return this._channels.has(e)},n.prototype.get=function(e){return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,null];case 3:return[2,this._channels.get(e)]}}))}))},n.prototype.fetch=function(e){var t=e.token,n=e.limit,r=void 0===n?100:n,s=e.backward,i=void 0!==s&&s,a=e.filter,o=void 0===a?new nt:a,u=e.order,c=void 0===u?Be.LATEST_LAST_MESSAGE:u;return h(this,void 0,void 0,(function(){var e,n,s,a,u=this;return d(this,(function(l){switch(l.label){case 0:return this.localCacheEnabled?(e=et(c),n={where:function(e){if(t)switch(c){case Be.CHANNEL_NAME_ALPHABETICAL:if(!i&&e.name.localeCompare(t)<0||i&&e.name.localeCompare(t)>0)return!1;break;case Be.CHRONOLOGICAL:if(!i&&e.createdAt>t||i&&e.createdAt<t)return!1;break;case Be.LATEST_LAST_MESSAGE:if(!i&&e.lastMessageUpdatedAt>t||i&&e.lastMessageUpdatedAt<t)return!1}return o.match(u._deserialize(e),u._sdkState.userId)},index:e,backward:i},[4,this.collection.query(n)]):[3,3];case 1:return[4,l.sent().fetch({limit:r})];case 2:return s=l.sent(),(a=s.map((function(e){return u._deserialize(e)}))).forEach((function(e){u._channels.has(e.url)||u._channels.set(e.url,e)})),[2,a];case 3:return[2,[]]}}))}))},n.prototype.upsert=function(e){return h(this,void 0,void 0,(function(){var t,n,r=this;return d(this,(function(s){switch(s.label){case 0:if(e.forEach((function(e){if(r._channels.has(e.url)){var t=r._channels.get(e.url);Object.assign(t,e,{_iid:r._iid})}else r._channels.set(e.url,e)})),!this.localCacheEnabled)return[3,2];for(n in t=[],e)t.push(this._serialize(e[n],parseInt(n)));return[4,this.collection.upsertMany(t)];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},n.prototype.remove=function(e){return h(this,void 0,void 0,(function(){var t,n,r,s,i,a;return d(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),t=_(e),n=t.next(),o.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return s=o.sent(),i={error:s},[3,7];case 6:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}}))}))},n.prototype.clear=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.clearMemoryCache=function(){this._channels.clear()},n.prototype._setBlockStateOfAllChannels=function(e,t,n){return h(this,void 0,void 0,(function(){var r,s,i,a,o,u,c,l,h,f,p,v,m,E,g,y,N,C,b;return d(this,(function(d){switch(d.label){case 0:if(r=[],e===this._sdkState.userId)try{for(s=_(this._channels.values()),i=s.next();!i.done;i=s.next()){l=i.value;try{for(E=void 0,a=_(l.members),o=a.next();!o.done;o=a.next())if((p=o.value).userId===t){p.isBlockedByMe=n,r.push(l);break}}catch(e){E={error:e}}finally{try{o&&!o.done&&(g=a.return)&&g.call(a)}finally{if(E)throw E.error}}}}catch(e){v={error:e}}finally{try{i&&!i.done&&(m=s.return)&&m.call(s)}finally{if(v)throw v.error}}else if(t===this._sdkState.userId)try{for(u=_(this._channels.values()),c=u.next();!c.done;c=u.next()){l=c.value;try{for(C=void 0,h=_(l.members),f=h.next();!f.done;f=h.next())if((p=f.value).userId===e){p.isBlockingMe=n,r.push(l);break}}catch(e){C={error:e}}finally{try{f&&!f.done&&(b=h.return)&&b.call(h)}finally{if(C)throw C.error}}}}catch(e){y={error:e}}finally{try{c&&!c.done&&(N=u.return)&&N.call(u)}finally{if(y)throw y.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))}))},n.prototype.block=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},n.prototype.unblock=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},n.prototype.markAsRead=function(e,t){return void 0===t&&(t=c([],l(this._channels.keys()),!1)),h(this,void 0,void 0,(function(){var n,r,s,i,a,o,u,c;return d(this,(function(l){switch(l.label){case 0:n=[],l.label=1;case 1:l.trys.push([1,6,7,8]),r=_(t),s=r.next(),l.label=2;case 2:return s.done?[3,5]:(i=s.value,[4,this.get(i)]);case 3:(a=l.sent())._updateUnreadMemberState(this._sdkState.userId,e)&&(a._updateUnreadCount(0,0),n.push(a)),l.label=4;case 4:return s=r.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),u={error:o},[3,8];case 7:try{s&&!s.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:l.sent(),l.label=10;case 10:return[2]}}))}))},n}(o),ct=function(){function e(){this.messageTypeFilter=f.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=m.NONE}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case f.USER:if(e.messageType!==p.USER)return!1;break;case f.FILE:if(e.messageType!==p.FILE)return!1;break;case f.ADMIN:if(e.messageType!==p.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof v))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case m.NONE:if(e.parentMessageId>0)return!1;break;case m.ONLY_REPLY_TO_CHANNEL:if(e instanceof v&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},e}();!function(e){e.CHANNEL_LATEST="channel_latest"}(tt||(tt={}));var lt,ht=function(e){if(e===tt.CHANNEL_LATEST)return["channelUrl","-createdAt","-messageId"]},dt=function(t){function n(e,n){var r=n.sdkState,s=n.cacheContext,i=t.call(this,e)||this;return i._sdkState=r,i._cacheContext=s,i}return e(n,t),Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){var t=s(s({},e.serialize()),{messageId:"".concat(e.messageId)});if(e instanceof E&&e.messageParams){var n=e.messageParams;t.messageParams=s({},n)}else if(e instanceof g&&e.messageParams){n=e.messageParams;t.messageParams=s({},n)}return t},n.prototype._deserialize=function(e){return e=s(s({},e),{messageId:parseInt(e.messageId)}),y.of(this._iid).buildMessageFromSerializedData(e)},n.prototype.get=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,null]}}))}))},n.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,s=void 0===r?100:r,i=e.backward,a=void 0!==i&&i,o=e.filter,u=void 0===o?new ct:o,c=e.order,l=void 0===c?tt.CHANNEL_LATEST:c;return h(this,void 0,void 0,(function(){var e,r,i,o=this;return d(this,(function(c){switch(c.label){case 0:return this.localCacheEnabled?(e=ht(l),r={where:{channelUrl:t,"/where":function(e){if(n&&l===tt.CHANNEL_LATEST)if(!a&&e.createdAt>n||a&&e.createdAt<n)return!1;return u.match(o._deserialize(e))}},index:e,backward:a},[4,this.collection.query(r)]):[3,3];case 1:return[4,c.sent().fetch({limit:s})];case 2:return i=c.sent(),[2,Promise.all(i.map((function(e){return h(o,void 0,void 0,(function(){var t,n,r;return d(this,(function(s){switch(s.label){case 0:return t=this._deserialize(e),(n=e.messageParams)?t instanceof E?(t.messageParams=new C(n),[3,4]):[3,1]:[3,4];case 1:return t instanceof g?n.file&&"string"==typeof n.file&&A(n.fileType)?(r=n,[4,this.collection.getBlob(n.file)]):[3,3]:[3,4];case 2:r.file=s.sent(),s.label=3;case 3:t.messageParams=new N(n),s.label=4;case 4:return[2,t]}}))}))})))];case 3:return[2,[]]}}))}))},n.prototype.upsert=function(e){return h(this,void 0,void 0,(function(){var t,n=this;return d(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,3];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},n.prototype.remove=function(e){return h(this,void 0,void 0,(function(){var t,n,r,s,i,a;return d(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=_(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return s=o.sent(),i={error:s},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},n.prototype.removeChannel=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:ht(tt.CHANNEL_LATEST)})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.removeUnderOffset=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:ht(tt.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.countBetween=function(e,t,n){return h(this,void 0,void 0,(function(){var r,s=this;return d(this,(function(i){switch(i.label){case 0:return this.localCacheEnabled?(r=ht(tt.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=s._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,i.sent()];case 2:return[2,0]}}))}))},n.prototype.saveBlobs=function(e){return h(this,void 0,void 0,(function(){var t=this;return d(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return h(t,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return e instanceof g&&e.messageParams&&((t=e.messageParams).file&&b(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.file=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},n}(o),_t="UnsentMessage",ft="reqId",pt=function(t){function n(e,n){var r=n.sdkState,s=n.cacheContext,i=t.call(this,e)||this;return i._sdkState=r,i._cacheContext=s,i}return e(n,t),Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){if(e.messageId>0)throw M.invalidParameters;var t=s({},e.serialize());if(e instanceof E&&e.messageParams){var n=e.messageParams;t.messageParams=s({},n)}else if(e instanceof g&&e.messageParams){n=e.messageParams;t.messageParams=s({},n)}return t},n.prototype._deserialize=function(e){return e?(e=s(s({},e),{messageId:parseInt(e.messageId)}),y.of(this._iid).buildMessageFromSerializedData(e)):null},n.prototype.get=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,null]}}))}))},n.prototype.fetch=function(e){var t=e.filter,n=void 0===t?new ct:t,r=e.order,s=void 0===r?tt.CHANNEL_LATEST:r,i=e.channelUrl,a=void 0===i?null:i,o=e.sendingStatus,u=void 0===o?null:o,c=e.backward,l=void 0!==c&&c;return h(this,void 0,void 0,(function(){var e,t,r,i,o=this;return d(this,(function(c){switch(c.label){case 0:return this.localCacheEnabled?(e=ht(s),t={"/where":function(e){return n.match(o._deserialize(e))}},a&&(t.channelUrl=a),u&&(t.sendingStatus=u),r={where:t,index:e,backward:l},[4,this.collection.query(r)]):[3,3];case 1:return[4,c.sent().fetch({})];case 2:return i=c.sent(),[2,Promise.all(i.map((function(e){return h(o,void 0,void 0,(function(){var t,n,r;return d(this,(function(s){switch(s.label){case 0:return t=this._deserialize(e),(n=e.messageParams)?t instanceof E?(t.messageParams=new C(n),[3,4]):[3,1]:[3,4];case 1:return t instanceof g?n.file&&"string"==typeof n.file&&A(n.fileType)?(r=n,[4,this.collection.getBlob(n.file)]):[3,3]:[3,4];case 2:r.file=s.sent(),s.label=3;case 3:t.messageParams=new N(n),s.label=4;case 4:return[2,t]}}))}))})))];case 3:return[2,[]]}}))}))},n.prototype.upsert=function(e){return h(this,void 0,void 0,(function(){var t,n=this;return d(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,3];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},n.prototype.remove=function(e){return h(this,void 0,void 0,(function(){var t,n,r,s,i,a;return d(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=_(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return s=o.sent(),i={error:s},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},n.prototype.removeChannel=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.saveBlobs=function(e){return h(this,void 0,void 0,(function(){var t=this;return d(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return h(t,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return e instanceof g&&e.messageParams&&((t=e.messageParams).file&&b(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.file=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},n}(o);!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(lt||(lt={}));var vt,mt=function(){function e(e){this.category=e.cat,this.data=e.data}return e.getDataAsUserBlockEvent=function(e,t){var n=t.data,r=n.blocker,s=n.blockee;return{blocker:new a(e,r),blockee:new a(e,s)}},e.getDataAsFriendDiscoveredEvent=function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new a(e,t)})):[]}},e}(),Et=function(){this.invitedUserIds=[],this.channelUrl=null,this.coverUrl=null,this.coverImage=null,this.isDistinct=null,this.isSuper=null,this.isBroadcast=null,this.isExclusive=null,this.isPublic=null,this.isDiscoverable=null,this.isStrict=null,this.isEphemeral=null,this.accessCode=null,this.name=null,this.data=null,this.customType=null,this.operatorUserIds=null,this.messageSurvivalSeconds=null},gt=function(t){function n(e){var n=t.call(this)||this;if(e)for(var r in e)n.hasOwnProperty(r)&&(n[r]=e[r]);return n}return e(n,t),n.prototype.validate=function(){return S("string",this.invitedUserIds)&&T("string",this.channelUrl,!0)&&T("string",this.coverUrl,!0)&&(I(this.coverImage)||T("string",this.coverImage)||null===this.coverImage)&&T("boolean",this.isDistinct,!0)&&T("boolean",this.isSuper,!0)&&T("boolean",this.isBroadcast,!0)&&T("boolean",this.isExclusive,!0)&&T("boolean",this.isPublic,!0)&&T("boolean",this.isStrict,!0)&&T("boolean",this.isDiscoverable,!0)&&T("boolean",this.isEphemeral,!0)&&T("string",this.accessCode,!0)&&T("string",this.name,!0)&&T("string",this.data,!0)&&T("string",this.customType,!0)&&S("string",this.operatorUserIds,!0)&&T("number",this.messageSurvivalSeconds,!0)},n.prototype.addUserIds=function(e){if(S("string",e))for(var t=e.filter((function(e){return T("string",e)})),n=0;n<t.length;n++)this.addUserId(t[n])},n.prototype.addUserId=function(e){T("string",e)&&(this.invitedUserIds.includes(e)||this.invitedUserIds.push(e))},n}(Et),yt=function(){this.customTypes=[],this.includeEmpty=!1,this.includeFrozen=!0},Nt=function(t){function n(e){var n=t.call(this)||this;if(e)for(var r in e)n.hasOwnProperty(r)&&(n[r]=e[r]);return n}return e(n,t),n.prototype.validate=function(){return(S("string",this.customTypes)||null===this.customTypes)&&(T("boolean",this.includeEmpty)||null===this.includeEmpty)&&T("boolean",this.includeFrozen)},n}(yt),Ct=function(){},bt=function(n){function r(e){var t=n.call(this)||this;if(e)for(var r in e)t.hasOwnProperty(r)&&(t[r]=e[r]);return t}return e(r,n),r.prototype.validate=function(){return t(ze,this.memberStateFilter)},r}(Ct);!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",e.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",e.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",e.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",e.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",e.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",e.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",e.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",e.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",e.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",e.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",e.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",e.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",e.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",e.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",e.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",e.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",e.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",e.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.REQUEST_CHANNEL="REQUEST_CHANNEL",e.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",e.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",e.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS"}(vt||(vt={}));var At=function(e){return e.startsWith("EVENT_")||e===vt.SYNC_CHANNEL_BACKGROUND||e===vt.SYNC_CHANNEL_CHANGELOGS},Mt=function(t){function n(e){var n=e.channels,r=e.source,s=t.call(this)||this;return s.channels=n,s.source=r,s}return e(n,t),n}(U),St=function(t){function n(e){var n=e.channelUrls,r=e.source,s=t.call(this)||this;return s.channelUrls=n,s.source=r,s}return e(n,t),n}(U),Tt=function(t){function n(e,n){var r=n.userId,s=t.call(this)||this;return s._iid=e,s.userId=r,s}return e(n,t),n}(U),It=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,r=e.unsentMessageCache,s=e.dispatcher,i=this;this._observers=new Map,s.on((function(e){return h(i,void 0,void 0,(function(){var s,i,a,o,u=this;return d(this,(function(c){switch(c.label){case 0:return e instanceof Mt?(s=e.channels,o=e.source,i=s.filter((function(e){return e instanceof pr})),[4,t.upsert(i)]):[3,2];case 1:return c.sent(),this._broadcastUpdateEvent(i,o),[3,7];case 2:return e instanceof St?(a=e.channelUrls,o=e.source,[4,t.remove(a)]):[3,5];case 3:return c.sent(),[4,w((function(){return h(u,void 0,void 0,(function(){var e,t,s,i,o,u;return d(this,(function(c){switch(c.label){case 0:c.trys.push([0,6,7,8]),e=_(a),t=e.next(),c.label=1;case 1:return t.done?[3,5]:(s=t.value,[4,n.removeChannel(s)]);case 2:return c.sent(),[4,r.removeChannel(s)];case 3:c.sent(),c.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return i=c.sent(),o={error:i},[3,8];case 7:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}return[7];case 8:return[2]}}))}))}))];case 4:return c.sent(),this._broadcastRemoveEvent(a,o),[3,7];case 5:return e instanceof Tt?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,7];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var s=_(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var s=_(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),Ut=function(){function e(e){var t=e.messageCache,n=e.unsentMessageCache,r=e.dispatcher,s=e.logger,i=this;this._observers=new Map,this._logger=null,this._logger=s,r.on((function(e){return h(i,void 0,void 0,(function(){var r,s,i,a,o,u;return d(this,(function(c){switch(c.label){case 0:return e instanceof R?(r=e.messages,u=e.source,s=r.filter((function(e){return e.messageId>0})),i=r.filter((function(e){return 0===e.messageId})),s.length>0?[4,t.upsert(s)]:[3,3]):[3,6];case 1:return c.sent(),[4,n.remove(s.map((function(e){return e instanceof v?e.reqId:null})).filter((function(e){return null!==e})))];case 2:c.sent(),this._broadcastUpdateEvent(s,u),c.label=3;case 3:return i.length>0?[4,n.upsert(i)]:[3,5];case 4:c.sent(),this._broadcastUpdateEvent(i,u),c.label=5;case 5:return[3,10];case 6:return e instanceof D?(a=e.messageIds,u=e.source,[4,t.remove(a)]):[3,8];case 7:return c.sent(),this._broadcastRemoveEvent(a,u),[3,10];case 8:return e instanceof L?(o=e.reqId,u=e.source,[4,n.remove([o])]):[3,10];case 9:c.sent(),this._broadcastRemoveUnsentEvent(o,u),c.label=10;case 10:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var s=_(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var s=_(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var s=_(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onRemoveUnsent(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),wt=function(t){function n(e,n,r){var s=t.call(this,e,"USEV",r)||this;return s.event=new mt(r),s}return e(n,t),n}(O),Lt=function(t){function n(e){var n=e.userId,s=e.ts,i=e.token,a=e.filter,o=void 0===a?new Nt:a,u=t.call(this)||this,c=o.customTypes,l=o.includeEmpty,h=o.includeFrozen;return u.method=P.PUT,u.path="".concat(k,"/").concat(encodeURIComponent(n),"/my_group_channels/changelogs"),u.params=r({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:s,token:i,custom_types:c,show_empty:l,show_frozen:h}),u}return e(n,t),n}(x),Dt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.updatedChannels=n.updated.map((function(t){return new pr(e,t)})),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r}return e(n,t),n}(F),Rt=function(t){function n(e){var n=e.channelUrl,r=e.isInternalCall,s=t.call(this)||this;return s.method=P.GET,s.path="".concat(r?H:V,"/").concat(encodeURIComponent(n)),s.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},s}return e(n,t),n}(x),Ot=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=null,r.channel=new pr(e,n),r}return e(n,t),n}(F),Pt=function(t){function n(e){var n=this,s=e.userId,i=e.token,a=e.limit,o=e.order,u=e.includeEmpty,c=e.memberStateFilter,l=e.superChannelFilter,h=e.publicChannelFilter,d=e.unreadChannelFilter,_=e.nicknameContainsFilter,f=e.channelNameContainsFilter,p=e.channelUrlsFilter,v=e.customTypesFilter,m=e.customTypeStartsWithFilter,E=e.hiddenChannelFilter,g=e.metadataOrderKeyFilter,y=e.metadataKey,N=e.metadataValues,C=e.metadataValueStartsWith,b=e.includeFrozen,A=e.includeMetaData,M=e.searchFilter,S=e.userIdsFilter;return(n=t.call(this)||this).method=P.GET,n.path="".concat(k,"/").concat(encodeURIComponent(s),"/my_group_channels"),n.params=r({token:i,limit:a,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:u,member_state_filter:c,super_mode:l,public_mode:h,unread_filter:d,members_nickname_contains:_,name_contains:f,channel_urls:p,custom_types:v,custom_type_startswith:m,hidden_mode:E,metadata_order_key:g,metadata_key:y,metadata_values:N,metadata_value_startswith:C,show_frozen:b,show_metadata:A}),M&&M.query&&M.fields&&(n.params.search_query=M.query,n.params.search_fields=M.fields),S&&S.userIds&&S.userIds.length>0&&(S.includeMode?(n.params.members_include_in=S.userIds,n.params.query_type=S.queryType.toUpperCase()):n.params.members_exactly_in=S.userIds),n}return e(n,t),n}(x),kt=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,i=n.channels,a=n.ts;return r.token=s,i&&i.length>0&&(r.channels=i.map((function(t){return t.ts=a,new pr(e,t)}))),r.ts=null!=a?a:null,r}return e(n,t),n}(F),xt=function(t){function n(e){var n=e.userId,r=e.filter,s=t.call(this)||this,i=r.memberStateFilter;return s.method=P.GET,s.path="".concat(k,"/").concat(encodeURIComponent(n),"/group_channel_count"),s.params={state:null!=i?i:ze.ALL},s}return e(n,t),n}(x),Ft=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.groupChannelCount=n.group_channel_count,r}return e(n,t),n}(F),Ht=function(t){function n(e){var n=this,r=e.userId,s=e.channelUrl,i=e.coverUrl,a=e.coverImage,o=e.isDistinct,u=e.isSuper,h=e.isBroadcast,d=e.isPublic,_=e.isExclusive,f=e.isDiscoverable,p=e.isStrict,v=e.isEphemeral,m=e.accessCode,E=e.name,g=e.data,y=e.customType,N=e.messageSurvivalSeconds,C=e.invitedUserIds,b=e.operatorUserIds;return(n=t.call(this)||this).method=P.POST,n.path=V,n.params={user_ids:c([r],l(C),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:s,cover_url:i,cover_file:a,is_distinct:o,is_super:u,is_broadcast:h,is_exclusive:_,is_public:d,is_discoverable:f,strict:p,is_ephemeral:v,access_code:m,name:E,data:g,custom_type:y,operator_ids:b,message_survival_seconds:N},n}return e(n,t),n}(x),Vt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new pr(e,n),r.isCreated=n.is_created,r}return e(n,t),n}(F),Gt=function(t){function n(e){var n=e.userId,r=e.channelUrls,s=t.call(this)||this;return s.method=P.PUT,s.path="".concat(k,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),s.params={channel_urls:r},s}return e(n,t),n}(x);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(F);var Bt=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,i=e.accessCode;return(n=t.call(this)||this).method=P.PUT,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:s,access_code:i},n}return e(n,t),n}(x),qt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new pr(e,n),r}return e(n,t),n}(F),Kt=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u,l=i.users,h=void 0===l?null:l;return s.memberCount=o,s.joinedMemberCount=c,s.members=Array.isArray(h)?h.map((function(t){return new Ke(e,t)})):[new Ke(e,r.data)],s}return e(n,t),n}(me),jt=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId;return(n=t.call(this)||this).method=P.PUT,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:s},n}return e(n,t),n}(x);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(F);var Qt=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u;return s.memberCount=o,s.joinedMemberCount=c,s.member=new Ke(s._iid,r.data),s}return e(n,t),n}(me),zt=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userIds;return(n=t.call(this)||this).method=P.POST,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:s},n}return e(n,t),n}(x),Yt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new pr(e,n),r}return e(n,t),n}(F),Jt=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,o=i.member_count,u=void 0===o?null:o,c=i.joined_member_count,l=void 0===c?null:c,h=i.inviter,d=void 0===h?null:h,_=i.invitees,f=void 0===_?[]:_;return s.memberCount=u,s.joinedMemberCount=l,s.inviter=d?new a(e,d):null,s.invitees=f.map((function(t){return new Ke(e,t)})),s}return e(n,t),n}(me),Wt=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId;return(n=t.call(this)||this).method=P.PUT,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:s},n}return e(n,t),n}(x),Xt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new pr(e,n),r.channel.myMemberState=Ge.NONE,r}return e(n,t),n}(F),Zt=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,o=i.member_count,u=void 0===o?null:o,c=i.joined_member_count,l=void 0===c?null:c,h=i.inviter,d=void 0===h?null:h,_=i.invitee,f=void 0===_?null:_;return s.memberCount=u,s.joinedMemberCount=l,s.inviter=d?new a(e,d):null,s.invitee=f?new Ke(e,f):null,s}return e(n,t),n}(me),$t=function(t){function n(e){var n=e.channelUrl;return t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return e(n,t),n}(G),en=function(t){function n(e,n,r){var s=t.call(this,e,"READ",r)||this;return s.readStatus=new je(e,r),s}return e(n,t),n}(O),tn=function(t){function n(e){var n=e.channelUrl,s=e.userId,i=t.call(this)||this;return(i=t.call(this)||this).method=P.PUT,i.path="".concat(V,"/").concat(encodeURIComponent(n),"/messages/mark_as_delivered"),i.params=r({userId:s}),i}return e(n,t),n}(x);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(F);var nn,rn=function(t){function n(e,n,r){var s=t.call(this,e,"DLVR",r)||this;return s.channelUrl=r.channel_url,s.deliveredStateUpdate=r.updated,s}return e(n,t),n}(O),sn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,i=e.hidePreviousMessages,a=e.allowAutoUnhide;return(n=t.call(this)||this).method=P.PUT,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:s,hide_previous_messages:i,allow_auto_unhide:a},n}return e(n,t),n}(x),an=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return e(n,t),n}(F),on=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.allowAutoUnhide=null,s.hidePreviousMessages=null,s.messageOffsetTimestamp=null,r.data&&(s.allowAutoUnhide=r.data.allow_auto_unhide,s.hidePreviousMessages=r.data.hide_previous_messages),s.messageOffsetTimestamp=r.ts_message_offset,s}return e(n,t),n}(O),un=function(t){function n(e){var n=e.channelUrl,r=e.time;return t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return e(n,t),n}(G),cn=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.user=new a(e,r.data),s}return e(n,t),n}(O),ln=function(t){function n(e){var n=e.channelUrl,r=e.time;return t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return e(n,t),n}(G),hn=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.user=new a(e,r.data),s}return e(n,t),n}(O),dn=function(t){function n(e){var n=e.channelUrl,r=e.messageId;return t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return e(n,t),n}(G),_n=function(n){function r(e,t){var r,s,i,a,o,u,c,l,h,d,_,f,p,v,m,E,g,y,N,C,b=this;return(b=n.call(this,e,t)||this).includeEmpty=!1,b.includeFrozen=!0,b.includeMetaData=!0,b.channelUrlsFilter=null,b.customTypesFilter=null,b.customTypeStartsWithFilter=null,b.nicknameContainsFilter="",b.channelNameContainsFilter="",b.memberStateFilter=ze.ALL,b.unreadChannelFilter=Je.ALL,b.superChannelFilter=Ye.ALL,b.publicChannelFilter=Qe.ALL,b.hiddenChannelFilter=We.UNHIDDEN,b.searchFilter={fields:[],query:null},b.userIdsFilter={userIds:[],includeMode:!0,queryType:Ze.AND},b.metadataKey=null,b.metadataValues=null,b.metadataOrderKeyFilter=null,b.metadataValueStartsWith=null,b.order=Be.LATEST_LAST_MESSAGE,b.includeEmpty=null!==(r=t.includeEmpty)&&void 0!==r&&r,b.includeFrozen=null===(s=t.includeFrozen)||void 0===s||s,b.includeMetaData=null===(i=t.includeMetaData)||void 0===i||i,b.channelUrlsFilter=null!==(a=t.channelUrlsFilter)&&void 0!==a?a:null,b.customTypesFilter=null!==(o=t.customTypesFilter)&&void 0!==o?o:null,b.customTypeStartsWithFilter=null!==(u=t.customTypeStartsWithFilter)&&void 0!==u?u:"",b.nicknameContainsFilter=null!==(c=t.nicknameContainsFilter)&&void 0!==c?c:"",b.channelNameContainsFilter=null!==(l=t.channelNameContainsFilter)&&void 0!==l?l:"",b.memberStateFilter=null!==(h=t.memberStateFilter)&&void 0!==h?h:ze.ALL,b.unreadChannelFilter=null!==(d=t.unreadChannelFilter)&&void 0!==d?d:Je.ALL,b.superChannelFilter=null!==(_=t.superChannelFilter)&&void 0!==_?_:Ye.ALL,b.publicChannelFilter=null!==(f=t.publicChannelFilter)&&void 0!==f?f:Qe.ALL,b.hiddenChannelFilter=null!==(p=t.hiddenChannelFilter)&&void 0!==p?p:We.UNHIDDEN,b.searchFilter=null!==(v=t.searchFilter)&&void 0!==v?v:{fields:[],query:null},b.userIdsFilter=null!==(m=t.userIdsFilter)&&void 0!==m?m:{userIds:[],includeMode:!0,queryType:Ze.AND},b.metadataKey=null!==(E=t.metadataKey)&&void 0!==E?E:null,b.metadataValues=null!==(g=t.metadataValues)&&void 0!==g?g:null,b.metadataOrderKeyFilter=null!==(y=t.metadataOrderKeyFilter)&&void 0!==y?y:null,b.metadataValueStartsWith=null!==(N=t.metadataValueStartsWith)&&void 0!==N?N:null,b.order=null!==(C=t.order)&&void 0!==C?C:Be.LATEST_LAST_MESSAGE,b}return e(r,n),r.prototype._validate=function(){return n.prototype._validate.call(this)&&T("boolean",this.includeEmpty)&&T("boolean",this.includeFrozen)&&T("boolean",this.includeMetaData)&&T("string",this.channelNameContainsFilter)&&S("string",this.channelUrlsFilter,!0)&&S("string",this.customTypesFilter,!0)&&T("string",this.customTypeStartsWithFilter)&&T("string",this.nicknameContainsFilter)&&t(ze,this.memberStateFilter)&&t(Ye,this.superChannelFilter)&&t(Qe,this.publicChannelFilter)&&t(Je,this.unreadChannelFilter)&&t(We,this.hiddenChannelFilter)&&S($e,this.searchFilter.fields)&&T("string",this.searchFilter.query,!0)&&S("string",this.userIdsFilter.userIds)&&T("boolean",this.userIdsFilter.includeMode)&&t(Ze,this.userIdsFilter.queryType)&&t(Be,this.order)&&T("string",this.metadataOrderKeyFilter,!0)&&T("string",this.metadataKey,!0)&&S("string",this.metadataValues,!0)&&T("string",this.metadataValueStartsWith,!0)},r.prototype.serialize=function(){return B(this)},r.prototype.next=function(){return h(this,void 0,void 0,(function(){var e,t,n;return d(this,(function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,mn.of(this._iid).getMyGroupChannels(this._token,this,this.limit)]):[3,2]:[3,5];case 1:return e=r.sent(),t=e.channels,n=e.token,this._token=n,this._hasNext=!!n,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw M.queryInProgress;case 4:return[3,6];case 5:throw M.invalidParameters;case 6:return[2]}}))}))},r}(q),fn=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,r=e.bottom,s=void 0===r?0:r;this.top=n,this.bottom=s}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,c([this.top],l(e),!1)),this.bottom=Math.max.apply(Math,c([this.bottom],l(e),!1))},e}(),pn=function(){function e(e,t){var n=t.localCacheEnabled,r=t.messageCache,s=t.unsentMessageCache,i=t.dispatcher,a=t.sdkState,o=t.logger,u=this;this._iid=e,this._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._messageCache=r,this._unsentMessageCache=s,this._dispatcher=i,this._logger=o,this._sdkState=a,this._localCacheEnabled&&i.on((function(e){if(e instanceof K&&e.stateType===j.CONNECTED)u._isProcessingAutoResend||u.processCachedPendingMessages().then((function(){return u._processNextAutoResend()}))}))}return e.prototype.processCachedPendingMessages=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s,i,a,o;return d(this,(function(u){switch(u.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=u.sent();try{for(t=_(e),n=t.next();!n.done;n=t.next())(r=n.value).errorCode&&Q(r.errorCode)?(s=(new Date).getTime(),i=r.createdAt+2592e5,s<=i?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(r.reqId)<0&&this._autoResendQueue.push(r):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(i).toLocaleString()),r.sendingStatus=z.FAILED,this._dispatcher.dispatch(new R({messages:[r],source:Y.LOCAL_MESSAGE_FAILED})))):(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",r.reqId),r.sendingStatus=z.FAILED,r.errorCode=J.ACK_TIMEOUT,this._dispatcher.dispatch(new R({messages:[r],source:Y.LOCAL_MESSAGE_FAILED})))}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return[2]}}))}))},e.prototype.completeCurrentAndProcessNextAutoResend=function(e){if(this._localCacheEnabled)if(e.sendingStatus===z.SUCCEEDED||e.sendingStatus===z.FAILED&&!Q(e.errorCode)){var t=this.indexOf(e);t>=0&&this._autoResendQueue.splice(t,1),0===t&&this._processNextAutoResend()}else e.sendingStatus===z.PENDING&&Q(e.errorCode)&&this._isNotInQueue(e)&&(this._autoResendQueue.push(e),this._isProcessingAutoResend||this._processNextAutoResend())},e.prototype._fetchAllCachedPendingMessages=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this._unsentMessageCache.fetch({sendingStatus:z.PENDING,backward:!0})];case 1:return[2,e.sent()]}}))}))},e.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},e.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},e.prototype._processNextAutoResend=function(){return h(this,void 0,void 0,(function(){var e,t,n;return d(this,(function(r){switch(r.label){case 0:if(!this._localCacheEnabled||"foreground"!==this._sdkState.appState)return[3,6];r.label=1;case 1:return r.trys.push([1,5,,6]),this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._logger.debug("processing auto-resend for message request id: ",e.reqId),[4,mn.of(this._iid).getChannel(e.channelUrl,!0)]):[3,3];case 2:return t=r.sent(),e instanceof E?t._autoResendUserMessage(e):e instanceof g&&t._autoResendFileMessage(e),[3,4];case 3:this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1,r.label=4;case 4:return[3,6];case 5:return n=r.sent(),this._logger.warn("process auto-resend error: ",n),this._isProcessingAutoResend=!1,[3,6];case 6:return[2]}}))}))},e}(),vn={},mn=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,s=t.dispatcher,i=t.sessionManager,a=t.requestQueue,o=t.logger,u=this;this._leftChannels=new Map,this._markAsReadAllLastSentAt=0,this.autoResendManager=null,this._iid=e,this._sdkState=n,this._sessionManager=i,this._requestQueue=a,this._dispatcher=s,this._logger=o,this._groupChannelHandlers=new Map,this._groupChannelCache=new ut(this._iid,{sdkState:n,cacheContext:r}),this._messageCache=new dt(this._iid,{sdkState:n,cacheContext:r}),this._unsentMessageCache=new pt(this._iid,{sdkState:n,cacheContext:r}),this._groupChannelBroadcast=new It({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:s}),this._messageBroadcast=new Ut({messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:s,logger:o}),this.autoResendManager=new pn(e,{localCacheEnabled:r.localCacheEnabled,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:s,sdkState:n,logger:o}),setInterval((function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(u._dispatcher.dispatch(new Mt({channels:[e],source:vt.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),u._groupChannelHandlers.forEach((function(t){t.onTypingStatusUpdated(e)})))};try{for(var r=_(u._groupChannelCache.channels),s=r.next();!s.done;s=r.next()){n(s.value)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}),1e3),this._dispatcher.on((function(e){e instanceof O&&u._handleEvent(e)})),vn[e]=this}return e.of=function(e){return vn[e]},Object.defineProperty(e.prototype,"handlers",{get:function(){return c([],l(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),e.prototype.buildGroupChannelFromSerializedData=function(e){var t=W(e);return new pr(this._iid,pr.payloadify(t))},e.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=W(e);return new _n(this._iid,t)},e.prototype.buildMemberFromSerializedData=function(e){var t=W(e);return new Ke(this._iid,Ke.payloadify(t))},e.prototype.getChannelFromCache=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getChannelsFromCache=function(e,t,n){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n})];case 1:return[2,r.sent()]}}))}))},e.prototype._handleEvent=function(e){return h(this,void 0,void 0,(function(){var t,r,s,a,o,u,c,l,f,p,m,E,g,y,N,C,b,A,M,S,T,I,U,L,O,P,k,x,F,H,V,G,B,q,K,j,Q,z,J,W,ee,te,ne,re,se,ie,ae,oe,ue,ce,le,he,de,_e,fe,pe,ve,ke,xe,Fe,He,Ve,Be,qe,Ke,je,Qe,ze,Ye,Je,We,Xe,Ze,$e,et,tt,nt,rt,st,it,at,ot,ut,ct,ht,dt,_t,ft,pt,Et,gt,yt,Nt,Ct,bt,At,Tt,It,Ut,Lt,Dt,Rt,Ot,Pt,kt,xt,Ft,Ht,Vt,Gt,Bt,qt,jt,zt,Yt,Wt,Xt,$t,tn,nn,sn,an,un,ln=this;return d(this,(function(_n){switch(_n.label){case 0:switch(_n.trys.push([0,72,,73]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"SYEV":return[3,32];case"USEV":return[3,70]}return[3,71];case 1:return c=null,"MESG"===e.code?c=e.as(Oe):"FILE"===e.code?c=e.as($):"ADMM"!==e.code&&"BRDM"!=e.code||(c=e.as(Pe)),c?(t=c.message,r=c.isMentioned,s=c.forceUpdateLastMessage,t.channelType!==i.GROUP?[3,3]:(w((function(){return h(ln,void 0,void 0,(function(){var e;return d(this,(function(n){return e=new dn(t),this._requestQueue.send(e),[2]}))}))})),I=this._groupChannelCache.isCachedInMemory(t.channelUrl),m=t instanceof v&&t.sender.userId===this._sdkState.userId,[4,this.getChannel(t.channelUrl,!0)])):[3,3];case 2:if((a=_n.sent()).hiddenState=rr.UNHIDDEN,t instanceof v){try{for(o=_(a.members),u=o.next();!u.done;u=o.next())if((st=u.value).userId===t.sender.userId){st.nickname=t.sender.nickname,st.plainProfileUrl=t.sender.plainProfileUrl,st.metaData=t.sender.metaData,st.isBlockedByMe=t.sender.isBlockedByMe;break}}catch(e){zt={error:e}}finally{try{u&&!u.done&&(Yt=o.return)&&Yt.call(o)}finally{if(zt)throw zt.error}}m&&(g=this._sessionManager.currentUser)&&(g.nickname=t.sender.nickname,g.plainProfileUrl=t.sender.plainProfileUrl,g.metaData=t.sender.metaData)}t.silent&&!m||(a.isEphemeral||I)&&((!a.lastMessage||a.lastMessage.createdAt<t.createdAt)&&(a.lastMessage=t),m||a._updateUnreadCount(a.unreadMessageCount+1,a.unreadMentionCount+(r?1:0))),s&&(!a.lastMessage||a.lastMessage.createdAt<t.createdAt)&&(a.lastMessage=t),this._dispatcher.dispatch(new Mt({channels:[a],source:vt.EVENT_MESSAGE_RECEIVED})),t.silent&&!m||Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(a)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),this._dispatcher.dispatch(new R({messages:[t],source:Y.EVENT_MESSAGE_RECEIVED})),Z((function(){return h(ln,void 0,void 0,(function(){var e,n,s,i,o;return d(this,(function(u){try{for(e=_(this._groupChannelHandlers.values()),n=e.next();!n.done;n=e.next())(s=n.value).onMessageReceived(a,t),r&&s.onMentionReceived(a,t)}catch(e){i={error:e}}finally{try{n&&!n.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}}return[2]}))}))})),_n.label=3;case 3:return[3,71];case 4:return c=null,"MEDI"===e.code?c=e.as(Le):"FEDI"===e.code?c=e.as(De):"AEDI"===e.code&&(c=e.as(Re)),c?(l=c.message,f=c.mentionCountChange,l.channelType!==i.GROUP?[3,6]:(I=this._groupChannelCache.isCachedInMemory(l.channelUrl),[4,this.getChannel(l.channelUrl,!0)])):[3,6];case 5:p=_n.sent(),m=l instanceof v&&l.sender.userId===this._sdkState.userId,E=!1,m?(g=this._sessionManager.currentUser)&&(g.nickname=l.sender.nickname,g.plainProfileUrl=l.sender.plainProfileUrl,g.metaData=l.sender.metaData):p.isReadMessage(l)&&0!==f&&!l.silent&&I&&(p._updateUnreadCount(p.unreadMessageCount,p.unreadMentionCount+f),E=!0),!p.lastMessage||p.lastMessage.createdAt<l.createdAt?(p.lastMessage=l,E=!0):p.lastMessage.isIdentical(l)&&(I?p.lastMessage.updatedAt<l.updatedAt&&(p.lastMessage=l,E=!0):E=!0),E&&(this._dispatcher.dispatch(new Mt({channels:[p],source:vt.EVENT_MESSAGE_UPDATED})),l.silent&&!m||Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(p)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),this._dispatcher.dispatch(new R({messages:[l],source:Y.EVENT_MESSAGE_UPDATED})),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r,s;return d(this,(function(i){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated(p,l),0!==f&&n.onMentionReceived(p,l)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),_n.label=6;case 6:return[3,71];case 7:return y=e.as(we),Q=y.channelUrl,P=y.channelType,N=y.messageId,P!==i.GROUP?[3,9]:[4,this.getChannel(Q,!0)];case 8:C=_n.sent(),this._dispatcher.dispatch(new D({messageIds:[N],source:Y.EVENT_MESSAGE_DELETED})),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onMessageDeleted(C,N)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),_n.label=9;case 9:return[3,71];case 10:return(b=e.as(en).readStatus).channelType!==i.GROUP?[3,12]:(I=this._groupChannelCache.isCachedInMemory(b.channelUrl),[4,this.getChannel(b.channelUrl,!0)]);case 11:A=_n.sent(),I&&A._updateUnreadMemberState(b.reader.userId,b.readAt),b.reader.userId===this._sdkState.userId?I?(A.unreadMessageCount>0||A.unreadMentionCount>0)&&(A._updateUnreadCount(0,0),this._dispatcher.dispatch(new Mt({channels:[A],source:vt.EVENT_CHANNEL_READ})),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(A)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):0!==A.unreadMessageCount&&0!==A.unreadMentionCount||(this._dispatcher.dispatch(new Mt({channels:[A],source:vt.EVENT_CHANNEL_READ})),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(A)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):(this._dispatcher.dispatch(new Mt({channels:[A],source:vt.EVENT_CHANNEL_READ})),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUnreadMemberStatusUpdated(A)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),_n.label=12;case 12:return[3,71];case 13:return M=e.as(rn),Q=M.channelUrl,S=M.deliveredStateUpdate,T=void 0===S?{}:S,I=this._groupChannelCache.isCachedInMemory(Q),[4,this.getChannel(Q,!0)];case 14:if(U=_n.sent(),I)for(L in T)U._updateUndeliveredMemberState(L,T[L]);return this._dispatcher.dispatch(new Mt({channels:[U],source:vt.EVENT_CHANNEL_DELIVERED})),Object.keys(T).some((function(e){return e!==ln._sdkState.userId}))&&Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUndeliveredMemberStatusUpdated(U)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),[3,71];case 15:return O=e.as(Ue),Q=O.channelUrl,P=O.channelType,k=O.event,P!==i.GROUP?[3,18]:[4,this.getChannel(Q,!0)];case 16:return x=_n.sent(),[4,this.getMessageFromCache(k.messageId)];case 17:(V=_n.sent())&&(V.applyReactionEvent(k),this._dispatcher.dispatch(new R({messages:[V],source:Y.EVENT_MESSAGE_REACTION_UPDATED}))),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onReactionUpdated(x,k)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),_n.label=18;case 18:return[3,71];case 19:return(F=e.as(Ie).event).channelType!==i.GROUP?[3,22]:[4,this.getChannel(F.channelUrl,!0)];case 20:return H=_n.sent(),[4,this.getMessageFromCache(F.targetMessageId)];case 21:(V=_n.sent())&&(V.applyThreadInfoUpdateEvent(F),this._dispatcher.dispatch(new R({messages:[V],source:Y.EVENT_MESSAGE_THREADINFO_UPDATED}))),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onThreadInfoUpdated(H,F)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),_n.label=22;case 22:return[3,71];case 23:G=e.as(Te).groupChannelMemberCounts,B=[],_n.label=24;case 24:_n.trys.push([24,29,30,31]),q=_(G),K=q.next(),_n.label=25;case 25:return K.done?[3,28]:(j=K.value,Q=j.channelUrl,Qe=j.memberCount,ze=j.joinedMemberCount,z=j.updatedAt,[4,this.getChannelFromCache(Q)]);case 26:(J=_n.sent())&&J._setLatestMemberCount(Qe,ze,z)&&B.push(J),_n.label=27;case 27:return K=q.next(),[3,25];case 28:return[3,31];case 29:return W=_n.sent(),Wt={error:W},[3,31];case 30:try{K&&!K.done&&(Xt=q.return)&&Xt.call(q)}finally{if(Wt)throw Wt.error}return[7];case 31:return B.length>0&&(this._dispatcher.dispatch(new Mt({channels:B,source:vt.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),Z((function(){return h(ln,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){try{for(e=_(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelMemberCountChanged(B)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),[3,71];case 32:if(!(ee=e.as(me).event).isGroupChannelEvent)return[3,69];switch(ee.category){case be.CHANNEL_JOIN:return[3,33];case be.CHANNEL_LEAVE:return[3,35];case be.CHANNEL_OPERATOR_UPDATE:return[3,39];case be.CHANNEL_INVITE:return[3,41];case be.CHANNEL_DECLINE_INVITE:return[3,43];case be.TYPING_START:case be.TYPING_END:return[3,45];case be.USER_CHANNEL_MUTE:case be.USER_CHANNEL_UNMUTE:return[3,47];case be.USER_CHANNEL_BAN:return[3,49];case be.USER_CHANNEL_UNBAN:return[3,53];case be.CHANNEL_FREEZE:case be.CHANNEL_UNFREEZE:return[3,55];case be.CHANNEL_HIDE:return[3,57];case be.CHANNEL_UNHIDE:return[3,59];case be.CHANNEL_DELETED:return[3,61];case be.CHANNEL_PROP_CHANGED:return[3,63];case be.CHANNEL_META_DATA_CHANGED:return[3,65];case be.CHANNEL_META_COUNTERS_CHANGED:return[3,67]}return[3,69];case 33:return[4,this.getChannel(ee.channelUrl,!0)];case 34:return te=_n.sent(),ne=e.as(Kt),re=ne.memberCount,se=ne.joinedMemberCount,ie=ne.members,ae=!1,ie.forEach((function(e){te.isExclusive||te.isSuper||te.isBroadcast?ae=ae||te._setLatestMemberCount(re,se,ee.ts):(e.state=Ge.JOINED,te.addMember(e,ee.ts),ln._updateJoinedMemberCount(te)),e.userId===ln._sdkState.userId&&(te.myMemberState=Ge.JOINED)})),this._dispatcher.dispatch(new Mt({channels:[te],source:vt.EVENT_CHANNEL_JOINED})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var r=_(ie),s=r.next();!s.done;s=r.next()){var i=s.value;e.onUserJoined(te,i)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}te.isBroadcast&&ae&&e.onChannelMemberCountChanged([te])})),[2]}))}))})),[3,69];case 35:return(it=this._leftChannels.get(ee.channelUrl))?(ue=it.channel,[3,38]):[3,36];case 36:return[4,this.getChannel(ee.channelUrl,!0)];case 37:ue=_n.sent(),_n.label=38;case 38:return oe=ue,ce=e.as(Qt),Qe=ce.memberCount,ze=ce.joinedMemberCount,le=ce.member,he=!1,oe.isExclusive||oe.isSuper||oe.isBroadcast?he=oe._setLatestMemberCount(Qe,ze,ee.ts):(oe.removeMember(le),this._updateJoinedMemberCount(oe)),le.userId===this._sdkState.userId?oe.isPublic?(oe.myMemberState=Ge.NONE,oe.invitedAt=0,oe.joinedAt=0,oe._updateUnreadCount(0,0),this._dispatcher.dispatch(new Mt({channels:[oe],source:vt.EVENT_CHANNEL_LEFT}))):(this._markAsLeave(oe),this._dispatcher.dispatch(new St({channelUrls:[oe.url],source:vt.EVENT_CHANNEL_LEFT}))):this._dispatcher.dispatch(new Mt({channels:[oe],source:vt.EVENT_CHANNEL_LEFT})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft(oe,le),oe.isBroadcast&&he&&e.onChannelMemberCountChanged([oe])})),[2]}))}))})),[3,69];case 39:return[4,this.getChannel(ee.channelUrl,!0)];case 40:de=_n.sent(),_e=e.as(Se).operators,fe=_e.map((function(e){return e.userId}));try{for(pe=_(de.members),ve=pe.next();!ve.done;ve=pe.next())(st=ve.value).role=fe.includes(st.userId)?n.OPERATOR:n.NONE}catch(e){$t={error:e}}finally{try{ve&&!ve.done&&(tn=pe.return)&&tn.call(pe)}finally{if($t)throw $t.error}}return de.myRole=fe.includes(this._sdkState.userId)?n.OPERATOR:n.NONE,this._dispatcher.dispatch(new Mt({channels:[de],source:vt.EVENT_CHANNEL_OPERATOR_UPDATED})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated(de,_e)})),[2]}))}))})),[3,69];case 41:return[4,this.getChannel(ee.channelUrl,!0)];case 42:ke=_n.sent(),xe=e.as(Jt),Qe=xe.memberCount,ze=xe.joinedMemberCount,Fe=xe.inviter,(He=xe.invitees).forEach((function(e){return e.state=Ge.INVITED}));try{for(Ve=_(He),Be=Ve.next();!Be.done;Be=Ve.next())qe=Be.value,ke.isExclusive||ke.isSuper||ke.isBroadcast?ke._setLatestMemberCount(Qe,ze,ee.ts):ke.addMember(qe,ee.ts),this._sdkState.userId===qe.userId&&(ke.hiddenState=rr.UNHIDDEN,ke.myMemberState!==Ge.JOINED&&(ke.myMemberState=Ge.INVITED),ke.invitedAt=ee.ts)}catch(e){nn={error:e}}finally{try{Be&&!Be.done&&(sn=Ve.return)&&sn.call(Ve)}finally{if(nn)throw nn.error}}return this._dispatcher.dispatch(new Mt({channels:[ke],source:vt.EVENT_CHANNEL_INVITED})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation(ke,Fe,He)})),[2]}))}))})),[3,69];case 43:return[4,this.getChannel(ee.channelUrl,!0)];case 44:return Ke=_n.sent(),je=e.as(Zt),Qe=je.memberCount,ze=je.joinedMemberCount,Ye=je.inviter,Je=je.invitee,Ke.isExclusive||Ke.isSuper||Ke.isBroadcast?Ke._setLatestMemberCount(Qe,ze,ee.ts):Ke.removeMember(Je),this._sdkState.userId===Je.userId?(Ke.invitedAt=0,Ke.myMemberState=Ge.NONE,Ke.isPublic?this._dispatcher.dispatch(new Mt({channels:[Ke],source:vt.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new St({channelUrls:[Ke.url],source:vt.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new Mt({channels:[Ke],source:vt.EVENT_CHANNEL_DECLINED_INVITE})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation(Ke,Ye,Je)})),[2]}))}))})),[3,69];case 45:return[4,this.getChannel(ee.channelUrl,!0)];case 46:return We=_n.sent(),Xe=ee.category===be.TYPING_START,Ze=e.as(Xe?cn:hn).user,We._updateTypingStatus(Ze,Xe?ee.ts:0),this._dispatcher.dispatch(new Mt({channels:[We],source:vt.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(We)})),[2]}))}))})),[3,69];case 47:return[4,this.getChannel(ee.channelUrl,!0)];case 48:$e=_n.sent(),et=ee.category===be.USER_CHANNEL_MUTE,(tt=e.as(et?Ae:Me).user).userId===this._sdkState.userId&&($e.myMutedState=et?nr.MUTED:nr.UNMUTED);try{for(nt=_($e.members),rt=nt.next();!rt.done;rt=nt.next())if((st=rt.value).userId===tt.userId){st.isMuted=et;break}}catch(e){an={error:e}}finally{try{rt&&!rt.done&&(un=nt.return)&&un.call(nt)}finally{if(an)throw an.error}}return this._dispatcher.dispatch(new Mt({channels:[$e],source:et?vt.EVENT_CHANNEL_MUTED:vt.EVENT_CHANNEL_UNMUTED})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){et?e.onUserMuted($e,tt):e.onUserUnmuted($e,tt)})),[2]}))}))})),[3,69];case 49:return(it=this._leftChannels.get(ee.channelUrl))?(ot=it.channel,[3,52]):[3,50];case 50:return[4,this.getChannel(ee.channelUrl,!0)];case 51:ot=_n.sent(),_n.label=52;case 52:return at=ot,this._markAsLeave(at),ut=e.as(Ce).user,Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned(at,ut)})),[2]}))}))})),[3,69];case 53:return[4,this.getChannel(ee.channelUrl,!0)];case 54:return ct=_n.sent(),ht=e.as(Ne).user,Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned(ct,ht)})),[2]}))}))})),[3,69];case 55:return[4,this.getChannel(ee.channelUrl,!0)];case 56:return dt=_n.sent(),_t=e.as(ye).freeze,dt.isFrozen=_t,this._dispatcher.dispatch(new Mt({channels:[dt],source:_t?vt.EVENT_CHANNEL_FROZEN:vt.EVENT_CHANNEL_UNFROZEN})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){_t?e.onChannelFrozen(dt):e.onChannelUnfrozen(dt)})),[2]}))}))})),[3,69];case 57:return[4,this.getChannel(ee.channelUrl,!0)];case 58:return ft=_n.sent(),pt=e.as(on),Et=pt.allowAutoUnhide,gt=pt.hidePreviousMessages,yt=pt.messageOffsetTimestamp,null!==Et&&(ft.hiddenState=Et?rr.HIDDEN_ALLOW_AUTO_UNHIDE:rr.HIDDEN_PREVENT_AUTO_UNHIDE),null!==gt&&gt&&ft._updateUnreadCount(0,0),null!==yt&&(ft.messageOffsetTimestamp=yt),this._dispatcher.dispatch(new Mt({channels:[ft],source:vt.EVENT_CHANNEL_HIDDEN})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden(ft)})),[2]}))}))})),[3,69];case 59:return[4,this.getChannel(ee.channelUrl,!0)];case 60:return(Nt=_n.sent()).hiddenState=rr.UNHIDDEN,this._dispatcher.dispatch(new Mt({channels:[Nt],source:vt.EVENT_CHANNEL_UNHIDDEN})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(Nt)})),[2]}))}))})),[3,69];case 61:return[4,this.getChannel(ee.channelUrl,!0)];case 62:return Ct=_n.sent(),this._dispatcher.dispatch(new St({channelUrls:[ee.channelUrl],source:vt.EVENT_CHANNEL_DELETED})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted(Ct.url,Ct.channelType)})),[2]}))}))})),[3,69];case 63:return[4,this.getChannelWithoutCache(ee.channelUrl,!0)];case 64:return bt=_n.sent(),this._dispatcher.dispatch(new Mt({channels:[bt],source:vt.EVENT_CHANNEL_UPDATED})),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(bt)})),[2]}))}))})),[3,69];case 65:return[4,this.getChannel(ee.channelUrl,!0)];case 66:return At=_n.sent(),Tt=e.as(ge),It=Tt.created,Ut=Tt.updated,Lt=Tt.deleted,It&&At._upsertCachedMetaData(It,ee.ts),Ut&&At._upsertCachedMetaData(Ut,ee.ts),Lt&&At._removeFromCachedMetaData(Lt,ee.ts),Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){It&&e.onMetaDataCreated(At,It),Ut&&e.onMetaDataUpdated(At,Ut),Lt&&e.onMetaDataDeleted(At,Lt)})),[2]}))}))})),[3,69];case 67:return[4,this.getChannel(ee.channelUrl,!0)];case 68:return Dt=_n.sent(),Rt=e.as(Ee),Ot=Rt.created,Pt=Rt.updated,kt=Rt.deleted,Z((function(){return h(ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Ot&&e.onMetaCounterCreated(Dt,Ot),Pt&&e.onMetaCounterUpdated(Dt,Pt),kt&&e.onMetaCounterDeleted(Dt,kt)})),[2]}))}))})),[3,69];case 69:return[3,71];case 70:switch((xt=e.as(wt).event).category){case lt.USER_BLOCK:Ft=mt.getDataAsUserBlockEvent(this._iid,xt),Ht=Ft.blocker,Vt=Ft.blockee,this._groupChannelCache.block(Ht.userId,Vt.userId);break;case lt.USER_UNBLOCK:Gt=mt.getDataAsUserBlockEvent(this._iid,xt),Bt=Gt.blocker,qt=Gt.blockee,this._groupChannelCache.unblock(Bt.userId,qt.userId)}return[3,71];case 71:return[3,73];case 72:if(jt=_n.sent(),X(jt))throw jt;return[3,73];case 73:return[2]}}))}))},e.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)},e.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},e.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},e.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},e.prototype.subscribeGroupChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},e.prototype.unsubscribeGroupChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},e.prototype.subscribeMessageEvent=function(e,t){this._messageBroadcast.subscribe(e,t)},e.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},e.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter((function(e){return e.state===Ge.JOINED})).length},e.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n;return d(this,(function(r){switch(r.label){case 0:ee(T("string",e)).throw(M.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}}))}))},e.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,r,s,i,a;return d(this,(function(o){switch(o.label){case 0:return ee(T("string",e)).throw(M.invalidParameters),n=new Rt({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(r=o.sent(),s=r.as(Ot).channel,i=s.unreadMessageCount,a=s.unreadMentionCount,s.myCountPreference){case tr.UNREAD_MESSAGE_COUNT_ONLY:a=0;break;case tr.UNREAD_MENTION_COUNT_ONLY:i=0;break;case tr.OFF:i=0,a=0}return s._updateUnreadCount(i,a),[4,this._groupChannelCache.upsert([s])];case 2:return o.sent(),[2,s]}}))}))},e.prototype.getMyGroupChannels=function(e,t,n,r){return void 0===r&&(r=vt.REQUEST_CHANNEL),h(this,void 0,void 0,(function(){var i,a,o,u,c;return d(this,(function(l){switch(l.label){case 0:return i=new Pt(s(s({},t),{userId:this._sdkState.userId,token:e,limit:n})),[4,this._requestQueue.send(i)];case 1:return a=l.sent(),o=a.as(kt),u=o.channels,c=o.token,this._dispatcher.dispatch(new Mt({channels:u,source:r})),[2,{channels:u,token:c}]}}))}))},e.prototype.getMessageFromCache=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getMessagesFromCache=function(e,t,n,r,s){return void 0===s&&(s=100),h(this,void 0,void 0,(function(){return d(this,(function(i){switch(i.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:s,filter:r,backward:"next"===n})];case 1:return[2,i.sent()]}}))}))},e.prototype.getAllFailedMessagesFromCache=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t})];case 1:return[2,n.sent()]}}))}))},e.prototype.removeFailedMessageFromCache=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}}))}))},e.prototype.getCachedMessageCountBetween=function(e,t,n,r){return h(this,void 0,void 0,(function(){return d(this,(function(s){switch(s.label){case 0:return[4,this._messageCache.countBetween(e,t,new fn({top:n,bottom:r}))];case 1:return[2,s.sent()]}}))}))},e.prototype.getMyGroupChannelChangeLogs=function(e,t,n){return void 0===n&&(n=vt.REQUEST_CHANNEL_CHANGELOGS),h(this,void 0,void 0,(function(){var s,i,a,o,u;return d(this,(function(c){switch(c.label){case 0:return ee(T("string",e)&&t instanceof Nt&&t.validate()).throw(M.invalidParameters),s=new Lt(r({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:t})),[4,this._requestQueue.send(s)];case 1:return i=c.sent(),a=i.as(Dt),o=a.updatedChannels,u=a.deletedChannelUrls,o.length>0&&this._dispatcher.dispatch(new Mt({channels:o,source:n})),u.length>0&&this._dispatcher.dispatch(new St({channelUrls:u,source:n})),[2,a]}}))}))},e.prototype.getGroupChannelCount=function(e){return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return ee(e instanceof bt&&e.validate()).throw(M.invalidParameters),t=new xt({userId:this._sdkState.userId,filter:e}),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Ft).groupChannelCount]}}))}))},e.prototype.createChannel=function(e){return h(this,void 0,void 0,(function(){var t,n,r;return d(this,(function(i){switch(i.label){case 0:return ee(e instanceof gt&&e.validate()).throw(M.invalidParameters),e.isPublic||(e.accessCode=null),t=new Ht(s({userId:this._sdkState.userId},e)),[4,this._requestQueue.send(t)];case 1:return n=i.sent(),r=n.as(Vt).channel,[4,this._groupChannelCache.upsert([r])];case 2:return i.sent(),[2,r]}}))}))},e.prototype.markAsReadAll=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s,i,a,o;return d(this,(function(u){switch(u.label){case 0:return e=Date.now(),ee(e-this._markAsReadAllLastSentAt>=1e3).throw(M.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new Gt({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:u.sent(),n=this._groupChannelCache.channels;try{for(r=_(n),s=r.next();!s.done;s=r.next())(i=s.value)._updateUnreadMemberState(this._sdkState.userId,e),i._updateUnreadCount(0,0)}catch(e){a={error:e}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}return n.length>0?[4,this._groupChannelCache.upsert(n)]:[3,3];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},e.prototype.markAsReadWithChannelUrls=function(e){return h(this,void 0,void 0,(function(){var t,n,r,s,i,a,o,u,c;return d(this,(function(l){switch(l.label){case 0:return t=Date.now(),ee(S("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(M.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new Gt({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:l.sent(),r=this._groupChannelCache.channels,s=[];try{for(i=_(r),a=i.next();!a.done;a=i.next())o=a.value,e.includes(o.url)&&(o._updateUnreadMemberState(this._sdkState.userId,t),o._updateUnreadCount(0,0),s.push(o))}catch(e){u={error:e}}finally{try{a&&!a.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}}return s.length>0?[4,this._groupChannelCache.upsert(s)]:[3,3];case 2:l.sent(),l.label=3;case 3:return[2]}}))}))},e.prototype.markAsDelivered=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},e}(),En=function(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},gn=new Map,yn=new Map,Nn=new Map,Cn=function(){function e(t){var n=t.key,r=t.concurrentCallLimit,s=void 0===r?2:r,i=t.backOffDelay,a=void 0===i?0:i,o=this;this._holdersKey=e.createSemaphoreHoldersKey(n),this._resolversKey=e.createSemaphoreResolversKey(n),this._chainProcessStateKey=e.createChainProcessStateKey(n),this._numLocks=s,this._backOffDelay=a,this._localAcquiredKeys=[],this._localResolversData=[],En()?(gn[this._holdersKey]||(gn[this._holdersKey]=[]),yn[this._resolversKey]||(yn[this._resolversKey]=[])):(window.addEventListener("storage",(function(e){return h(o,void 0,void 0,(function(){var t,n;return d(this,(function(r){if(this._localResolversData.length>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()&&this._hasHighestPriorityResolver())switch(e.key){case this._holdersKey:if(t=JSON.parse(e.oldValue),n=JSON.parse(e.newValue),!t||!n||n.length>=t.length)return[2];this._processChainResolve();break;case this._chainProcessStateKey:if(JSON.parse(e.newValue))return[2];this._processChainResolve();break;default:return[2]}return[2]}))}))})),window.addEventListener("beforeunload",(function(){var e=o._getLocalResolversData(),t=o._localResolversData.map((function(e){return e.key})),n=e.filter((function(e){return t.indexOf(e.key)<0}));window.localStorage.setItem(o._resolversKey,JSON.stringify(n)),o._localAcquiredKeys.forEach((function(e){return o.release(e)}))})))}return e.createSemaphoreHoldersKey=function(e){return"collection@semaphore_holders_for:"+e},e.createSemaphoreResolversKey=function(e){return"collection@semaphore_resolvers_for:"+e},e.createChainProcessStateKey=function(e){return"collection@semaphore_chain_process_state_for:"+e},Object.defineProperty(e.prototype,"numLocks",{get:function(){return this._numLocks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backOffDelay",{get:function(){return this._backOffDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numLocksAvailable",{get:function(){if(En())return this.numLocks-gn[this._holdersKey].length;var e=this._getLocalHoldersData();return this.numLocks-e.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waitCount",{get:function(){return En()?yn[this._resolversKey].length:this._getLocalResolversData().length},enumerable:!1,configurable:!0}),e.prototype._hasHighestPriorityResolver=function(){var e=this._getLocalResolversData();return e.length>0&&this._localResolversData.map((function(e){return e.key})).indexOf(e[0].key)>=0},e.prototype._isProcessChainAcquireRunning=function(){if(En())return Nn[this._chainProcessStateKey];var e=window.localStorage[this._chainProcessStateKey];return void 0!==e&&JSON.parse(e)},e.prototype._setProcessChainAcquireRunning=function(e){En()?Nn[this._chainProcessStateKey]=e:e?window.localStorage.setItem(this._chainProcessStateKey,JSON.stringify(e)):window.localStorage.removeItem(this._chainProcessStateKey)},e.prototype._processChainResolve=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return this.waitCount>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()?(this._setProcessChainAcquireRunning(!0),this._tryResolve()?[4,ne(this._backOffDelay)]:[3,2]):[3,3];case 1:t.sent(),t.label=2;case 2:this._setProcessChainAcquireRunning(!1),En()?this._processChainResolve():(e=new StorageEvent("storage",{key:this._chainProcessStateKey,oldValue:JSON.stringify(!0),newValue:JSON.stringify(!1)}),dispatchEvent(e)),t.label=3;case 3:return[2]}}))}))},e.prototype.acquire=function(e){return void 0===e&&(e=0),h(this,void 0,void 0,(function(){var t,n=this;return d(this,(function(r){return En()?[2,new Promise((function(t){for(var r={key:te(),resolver:function(e){return t(e)},priority:e},s=yn[n._resolversKey],i=-1,a=0;a<s.length;a++)if(e>s[a].priority){i=a;break}i>=0?yn[n._resolversKey].splice(i,0,r):yn[n._resolversKey].push(r),n._processChainResolve()}))]:(t=this._getLocalResolversData(),[2,new Promise((function(r){for(var s=te(),i={key:s,priority:e},a={key:s,resolver:function(e){return r(e)},priority:e},o=-1,u=0;u<t.length;u++)if(e>t[u].priority){o=u;break}o>=0?(t.splice(o,0,i),n._localResolversData.splice(o,0,a)):(t.push(i),n._localResolversData.push(a)),window.localStorage.setItem(n._resolversKey,JSON.stringify(t)),n._processChainResolve()}))])}))}))},e.prototype.release=function(e){if(En()){if((t=gn[this._holdersKey].indexOf(e))>=0)return gn[this._holdersKey].splice(t,1),this._processChainResolve(),!0}else if(window.localStorage[this._holdersKey]){var t,n=JSON.parse(window.localStorage[this._holdersKey]),r=c([],l(n),!1);if((t=n.indexOf(e))>=0){n.splice(t,1),window.localStorage.setItem(this._holdersKey,JSON.stringify(n)),this._localAcquiredKeys.splice(this._localAcquiredKeys.indexOf(e),1);var s=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(r),newValue:JSON.stringify(n)});return dispatchEvent(s),!0}}return!1},e.prototype._tryResolve=function(){if(En()){if(gn[this._holdersKey].length<this.numLocks){var e=te();return gn[this._holdersKey]=c(c([],l(gn[this._holdersKey]),!1),[e],!1),(n=yn[this._resolversKey].shift()).resolver(e),!0}}else{var t=this._getLocalHoldersData();if(t.length<this.numLocks){e=te();var n=this._localResolversData.shift(),r=this._getLocalResolversData(),s=r.map((function(e){return e.key})).indexOf(n.key);r.splice(s,1),window.localStorage.setItem(this._resolversKey,JSON.stringify(r)),window.localStorage.setItem(this._holdersKey,JSON.stringify(c(c([],l(t),!1),[e],!1))),this._localAcquiredKeys.push(e);var i=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(c([],l(t),!1)),newValue:JSON.stringify(c(c([],l(t),!1),[e],!1))});return dispatchEvent(i),(0,n.resolver)(e),!0}}return!1},e.prototype._getLocalHoldersData=function(){var e=window.localStorage[this._holdersKey];return void 0!==e?JSON.parse(e):[]},e.prototype._getLocalResolversData=function(){var e=window.localStorage[this._resolversKey];return void 0!==e?JSON.parse(e):[]},e}();!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(nn||(nn={}));var bn,An=function(t){function n(e,n,r,s){void 0===r&&(r=2),void 0===s&&(s=10);var i=t.call(this)||this;return i._worker=null,i._state=nn.IDLE,i._semaphore=null,i._retryCount=0,i._retryLimit=3,i.priority=0,i._worker=n,i._semaphore=new Cn({key:e,concurrentCallLimit:r,backOffDelay:s}),i}return e(n,t),Object.defineProperty(n.prototype,"isIdle",{get:function(){return this._state===nn.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRunning",{get:function(){return this._state===nn.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isDone",{get:function(){return this._state===nn.END},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),n.prototype._run=function(e){return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}}))}))},n.prototype.start=function(e){this.isIdle&&(this._state=nn.RUNNING,this._run(e))},n.prototype.stop=function(){this._state=nn.IDLE,this.dispatch("stop")},n.prototype.end=function(){this._state=nn.END,this.dispatch("end")},n}(re),Mn=function(e){this.source=e},Sn=function(e){this.source=e},Tn={},In=function(){function e(e){var t=e._iid,n=e.channel,r=this;this._prevSync=null,this._nextSync=null,this._metadata=null,this._iid=t,this._channel=n;var s,i,a=se.of(this._iid),o=a.sdkState,u=a.logger;this._metadataKey=(s=o.userId,i=n.url,"sendbird:".concat(s,"@groupchannel/").concat(i,"/message/sync.meta"));var c=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(o.userId,n.url);this._prevSync=new An(c,(function(e){return h(r,void 0,void 0,(function(){var t,n,r,s,i;return d(this,(function(a){switch(a.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return a.sent(),u.debug("message background prev sync from",null===(r=this._metadata)||void 0===r?void 0:r.range.top),this._metadata.previousComplete?[3,4]:[4,y.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(i=null===(s=this._metadata.range)||void 0===s?void 0:s.top)&&void 0!==i?i:e,{prevResultSize:100,nextResultSize:0,replyType:m.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},Y.SYNC_MESSAGE_BACKGROUND)];case 2:return n=a.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.top,this._metadata.previousComplete=!t.hasNext,u.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 3:return a.sent(),[3,5];case 4:t.hasNext=!1,a.label=5;case 5:return[2,t]}}))}))})),this._nextSync=new An(c,(function(e){return h(r,void 0,void 0,(function(){var t,n,r,s,i;return d(this,(function(a){switch(a.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return a.sent(),u.debug("message background next sync from",null===(r=this._metadata)||void 0===r?void 0:r.range.bottom),[4,y.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(i=null===(s=this._metadata.range)||void 0===s?void 0:s.bottom)&&void 0!==i?i:e,{prevResultSize:0,nextResultSize:100,replyType:m.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},Y.SYNC_MESSAGE_BACKGROUND)];case 2:return n=a.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.bottom,u.debug("message background next sync progress",t),[4,this.saveMetadata()];case 3:return a.sent(),[2,t]}}))}))}))}return e.of=function(t,n){if(Tn[t]||(Tn[t]={}),!Tn[t][n.url]){var r=Tn[t][n.url]=new e({_iid:t,channel:n});se.of(t).dispatcher.on((function(e){if(e instanceof K)if(e.stateType===j.CONNECTED)r.resume();else r.pause()}))}return Tn[t][n.url]},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,c([],l(e.map((function(e){return e.createdAt}))),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,c([],l(e.map((function(e){return e.createdAt}))),!1))},e.prototype.loadMetadata=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,se.of(this._iid).cacheContext.store.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={range:new fn(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:Number.MAX_SAFE_INTEGER}),previousComplete:!!e&&e.previousComplete},t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this._metadata?[4,se.of(this._iid).cacheContext.store.set({key:this._metadataKey,value:this._metadata,generation:1})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.resume=function(){var e,t,n,r;se.of(this._iid).logger.debug("message background sync resume()"),this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:Date.now())},e.prototype.pause=function(){se.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e}(),Un={},wn=function(){function e(e){var t=e._iid,n=e.channel,r=this;this._sync=null,this._metadata=null,this._iid=t,this._channel=n;var s,i,a=se.of(this._iid).sdkState;this._metadataKey=(s=a.userId,i=n.url,"sendbird:".concat(s,"@groupchannel/").concat(i,"/message/changelogs.meta"));var o=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(a.userId,this._channel.url);this._sync=new An(o,(function(){return h(r,void 0,void 0,(function(){var e,t,n,r,s;return d(this,(function(i){switch(i.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,5,,8]),[4,y.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:m.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includePollDetails:!0},Y.SYNC_MESSAGE_CHANGELOGS)];case 3:return t=i.sent(),n=t.hasMore,r=t.token,e.hasNext=n,e.nextToken=r,this._metadata.token=r,[4,this.saveMetadata()];case 4:return i.sent(),[2,e];case 5:return(s=i.sent())instanceof M&&s.isInvalidTokenError?[4,this.cleatMetadata()]:[3,7];case 6:i.sent(),i.label=7;case 7:return[3,8];case 8:return[2]}}))}))}))}return e.of=function(t,n){if(Un[t]||(Un[t]={}),!Un[t][n.url]){var r=Un[t][n.url]=new e({_iid:t,channel:n});se.of(t).dispatcher.on((function(e){if(e instanceof K)if(e.stateType===j.CONNECTED)r.resume();else r.pause()}))}return Un[t][n.url]},e.prototype.loadMetadata=function(){return h(this,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){switch(s.label){case 0:return this._metadata?[3,2]:(e=se.of(this._iid),t=e.cacheContext,n=e.connectedAt,[4,t.store.get(this._metadataKey)]);case 1:r=s.sent(),this._metadata={token:r?r.token:n/1e3},s.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this._metadata?[4,se.of(this._iid).cacheContext.store.set({key:this._metadataKey,value:this._metadata,generation:1})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.cleatMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return se.of(this._iid).cacheContext.store.remove(this._metadataKey),[2]}))}))},e.prototype.resume=function(){this._sync.start(0)},e.prototype.pause=function(){this._sync.stop()},e}(),Ln=function(t){function n(e){var n,s,i,a,o,u,c=this;return(c=t.call(this)||this).method=P.GET,c.path="".concat(ie(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),c.params=r({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(n=e.threshold)&&void 0!==n?n:null,reverse:!0,custom_types:null!==(s=e.customTypes)&&void 0!==s?s:["*"],message_type:null!==(i=e.messageType)&&void 0!==i?i:null,include_reactions:null===(a=e.includeReactions)||void 0===a||a,with_sorted_meta_array:null===(o=e.includeMetaArray)||void 0===o||o,show_subchannel_messages_only:null!==(u=e.showSubchannelMessagesOnly)&&void 0!==u&&u}),c}return e(n,t),n}(x),Dn=function(t){function n(e,n){var r,s,i,a,o=this;return(o=t.call(this,e,n)||this).isHugeGap=n.is_huge_gap,o.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map((function(t){return ae(e,t)})),o.prevHasMore=null!==(s=n.prev_hasmore)&&void 0!==s&&s,o.nextMessages=(null!==(i=n.next_messages)&&void 0!==i?i:[]).map((function(t){return ae(e,t)})),o.nextHasmore=null!==(a=n.next_hasmore)&&void 0!==a&&a,o}return e(n,t),n}(F),Rn=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},On=function(e,t,n){if(e.length>0){var r=Rn(e,t);if(r<0){for(var s=0,i=e.length-1,a=Math.floor((s+i)/2);s<i;){var o=Pn(e[a],t,n);if(o>0)i=a,a=Math.floor((s+i)/2);else{if(!(o<0))return{place:a,contains:e[a].isIdentical(t)};s=a+1,a=Math.floor((s+i)/2)}}return{place:Pn(e[a],t,n)>0?a:a+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},Pn=function(e,t,n){switch(n){case Be.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?t.lastMessage.createdAt-e.lastMessage.createdAt:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case Be.CHRONOLOGICAL:return t.createdAt-e.createdAt;case Be.CHANNEL_NAME_ALPHABETICAL:return e.name.localeCompare(t.name)}},kn=function(e,t){if(t instanceof v)return e.findIndex((function(e){return e instanceof v&&t.isIdentical(e)}));e.findIndex((function(e){return e.isIdentical(t)}))},xn=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,s=Math.floor((n+r)/2);n<r;){var i=e[s].createdAt-t.createdAt;if(i>0)r=s,s=Math.floor((n+r)/2);else{if(!(i<0))return s;n=s+1,s=Math.floor((n+r)/2)}}return e[s].createdAt>t.createdAt?s:s+1}return e.length};!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api",e.API_ONLY="api_only"}(bn||(bn={}));var Fn,Hn,Vn=function(){function e(){}return e.prototype._invokeResponse=function(e,t,n){var r=this;Z((function(){return h(r,void 0,void 0,(function(){return d(this,(function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),Gn=function(){function e(e,t){var n=t.channel,r=t.filter,s=t.startingPoint,i=t.limit,a=this;this._channel=null,this._messages=[],this._unsentMessages=[],this._readReceiptMap=new Map,this._deliveryReceiptMap=new Map,this._iid=e,this._key="mc-".concat(te()),this.filter=null!=r?r:new ct,this._channel=n,this._syncRange=new fn({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint=s||Date.now()+6e5,this._limit=i||100;var o=mn.of(this._iid);o.subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n,r,s,i,o=Rn(e,a._channel);if(o>=0)switch(Z((function(){return h(a,void 0,void 0,(function(){var n;return d(this,(function(r){return n=new Mn(t),this._channel=e[o],this._handler.onChannelUpdated(n,this.channel),[2]}))}))})),t){case vt.EVENT_CHANNEL_UPDATED:var u=!1;for(var c in a._messages){if((E=a._messages[c]).createdAt>=a._channel.messageOffsetTimestamp){u=!0;var l=parseInt(c);if(l>0){var f=a._messages.splice(0,l);a._removeMessagesFromView(f.map((function(e){return e.messageId})),Y.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!u&&a._messages.length>0&&a._removeMessagesFromView(a._messages.map((function(e){return e.messageId})),Y.EVENT_MESSAGE_OFFSET_UPDATED);break;case vt.EVENT_CHANNEL_READ:var p=[];try{for(var v=_(a._messages),m=v.next();!m.done;m=v.next()){var E=m.value;if((N=a._readReceiptMap.get(E.messageId))>0)N!==a._channel.getUnreadMemberCount(E)&&p.push(E)}}catch(e){n={error:e}}finally{try{m&&!m.done&&(r=v.return)&&r.call(v)}finally{if(n)throw n.error}}p.length>0&&a._updateMessagesToView(p,Y.EVENT_MESSAGE_READ);break;case vt.EVENT_CHANNEL_DELIVERED:p=[];try{for(var g=_(a._messages),y=g.next();!y.done;y=g.next()){var N;E=y.value;if((N=a._deliveryReceiptMap.get(E.messageId))>0)N!==a._channel.getUndeliveredMemberCount(E)&&p.push(E)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(i=g.return)&&i.call(g)}finally{if(s)throw s.error}}p.length>0&&a._updateMessagesToView(p,Y.EVENT_MESSAGE_READ)}},onRemove:function(e,t){e.indexOf(a.channel.url)>=0&&Z((function(){return h(a,void 0,void 0,(function(){var e;return d(this,(function(n){return e=new Mn(t),this._handler.onChannelDeleted(e,this.channel.url),[2]}))}))}))}}),o.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,r,s=[],i=[];try{for(var o=_(e),u=o.next();!u.done;u=o.next()){var c=u.value;c.channelUrl===a._channel.url&&(a.filter.match(c)?s.push(c):i.push(c.messageId))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}if(oe(t)){if(s.length>0)switch(t){case Y.EVENT_MESSAGE_SENT_FAILED:case Y.EVENT_MESSAGE_SENT_SUCCESS:case Y.EVENT_MESSAGE_UPDATED:case Y.EVENT_MESSAGE_THREADINFO_UPDATED:case Y.EVENT_MESSAGE_REACTION_UPDATED:case Y.SYNC_MESSAGE_CHANGELOGS:a._updateMessagesToView(s,t);break;case Y.EVENT_MESSAGE_SENT_PENDING:case Y.EVENT_MESSAGE_RECEIVED:case Y.SYNC_MESSAGE_FILL:a._addMessagesToView(s,t)}i.length>0&&a._removeMessagesFromView(i,t)}},onRemove:function(e,t){a._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){a._removeUnsentMessageFromView(e,t)}}),In.of(this._iid,this._channel).resume(),wn.of(this._iid,this._channel).resume(),this._prevFill=new An(this._key,(function(e){return h(a,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._limit,source:Y.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.min.apply(Math,c([],l(t.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(n),[2,{hasNext:t.length>=this._limit&&this._syncRange.top>n,nextToken:this._syncRange.top}]):[2,{hasNext:!1,nextToken:0}]}}))}))})),this._nextFill=new An(this._key,(function(e){return h(a,void 0,void 0,(function(){var t,n;return d(this,(function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._limit,source:Y.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.max.apply(Math,c([],l(t.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(n),[2,{hasNext:t.length>=this._limit&&this._syncRange.bottom<n,nextToken:this._syncRange.bottom}]):[2,{hasNext:!1,nextToken:0}]}}))}))}));var u=se.of(this._iid),f=u.dispatcher,p=u.logger;f.on((function(e){if(e instanceof K)if(e.stateType===j.CONNECTED)p.debug("check huge gap"),a._checkHugeGap();else a._prevFill.stop(),a._nextFill.stop()}))}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return c([],l(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===z.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===z.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,c(c([],l(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,c(c([],l(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype.setMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){var t=this;return e.filter((function(e){return e.createdAt>=t._channel.messageOffsetTimestamp}))},e.prototype._addMessagesToView=function(e,t){var n,r,s=this,i=this._filterUnderOffsetMessage(e),a=[],o=[];try{for(var u=_(i),c=u.next();!c.done;c=u.next()){var l=c.value;if(l.messageId>0){if((p=kn(this._messages,l))<0){var f=xn(this._messages,l);a.push(l),this._messages.splice(f,0,l)}else o.push(l),this._messages[p]=l;this._readReceiptMap.set(l.messageId,this._channel.getUnreadMemberCount(l)),this._deliveryReceiptMap.set(l.messageId,this._channel.getUndeliveredMemberCount(l))}else{var p;if(l instanceof v)(p=kn(this._unsentMessages,l))<0?kn(this._messages,l)<0&&(this._unsentMessages.push(l),a.push(l)):(o.push(l),this._unsentMessages[p]=l)}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}oe(t)&&Z((function(){return h(s,void 0,void 0,(function(){var e;return d(this,(function(n){return e=new Sn(t),a.length>0&&this._handler.onMessagesAdded(e,this.channel,a),o.length>0&&this._handler.onMessagesUpdated(e,this.channel,o),[2]}))}))}))},e.prototype._updateMessagesToView=function(e,t){var n,r,s=this,i=[];try{for(var a=_(e),o=a.next();!o.done;o=a.next()){var u,c=o.value;if(c.messageId>0)if((u=kn(this._messages,c))>=0)i.push(c),this._messages[u]=c;else{var l=kn(this._unsentMessages,c);if(l>=0){i.push(c),this._unsentMessages.splice(l,1);var f=xn(this._messages,c);this._messages.splice(f,0,c)}}else if(c instanceof v)(u=kn(this._unsentMessages,c))>=0&&(i.push(c),this._unsentMessages[u]=c)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return oe(t)&&Z((function(){return h(s,void 0,void 0,(function(){var e;return d(this,(function(n){return e=new Sn(t),i.length>0&&this._handler.onMessagesUpdated(e,this.channel,i),[2]}))}))})),i},e.prototype._removeMessagesFromView=function(e,t){var n,r,s=this,i=[],a=function(e){var t=o._messages.findIndex((function(t){return t.messageId===e}));t>=0&&(i.push(o._messages[t].messageId),o._messages.splice(t,1))},o=this;try{for(var u=_(e),c=u.next();!c.done;c=u.next()){a(c.value)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return oe(t)&&i.length>0&&Z((function(){return h(s,void 0,void 0,(function(){var e;return d(this,(function(n){return e=new Sn(t),i.length>0&&this._handler.onMessagesDeleted(e,this.channel,i),[2]}))}))})),i},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,s=t.nextLimit,i=void 0===s?0:s;return h(this,void 0,void 0,(function(){var t,n,s,a,o,u,h;return d(this,(function(d){switch(d.label){case 0:return t=mn.of(this._iid),r>0?[4,t.getMessagesFromCache(this._channel.url,e,"prev",this.filter,this._limit)]:[3,2];case 1:return s=d.sent(),[3,3];case 2:s=[],d.label=3;case 3:return n=s,i>0?[4,t.getMessagesFromCache(this._channel.url,e,"next",this.filter,this._limit)]:[3,5];case 4:return o=d.sent(),[3,6];case 5:o=[],d.label=6;case 6:if(a=o,n.length>0&&a.length)for(h in u=n.map((function(e){return e.messageId})),a)if(u.includes(a[h].messageId)){a.splice(parseInt(h),1);break}return[2,c(c([],l(n),!1),l(a),!1).sort((function(e,t){return t.createdAt-e.createdAt}))]}}))}))},e.prototype._getRemoteMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,i=t.nextLimit,a=void 0===i?0:i,o=t.source,u=void 0===o?Y.REQUEST_MESSAGE:o;return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(i){switch(i.label){case 0:return t=y.of(this._iid),r>0||a>0?[4,t.getMessagesByTimestamp(this._channel.url,this._channel.channelType,e,s(s({},this.filter),{prevResultSize:r,nextResultSize:a,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),u)]:[3,2];case 1:return n=i.sent(),[3,3];case 2:n=[],i.label=3;case 3:return[2,n]}}))}))},e.prototype._checkHugeGap=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,_,f,p=this;return d(this,(function(v){switch(v.label){case 0:return this._messages.length>0?(e=this.viewTop,t=this._syncRange.top,n=this._syncRange.bottom,r=Number.MAX_SAFE_INTEGER,[4,(i=mn.of(this._iid)).getCachedMessageCountBetween(this._channel.url,this.filter,e,t)]):[3,4];case 1:return a=v.sent(),[4,i.getCachedMessageCountBetween(this._channel.url,this.filter,n,r)];case 2:return o=v.sent(),[4,ue((function(){return h(p,void 0,void 0,(function(){var i,u,_,f,p,v,m,E,g,y,N,C,b,A,M,S,T,I=this;return d(this,(function(U){switch(U.label){case 0:return i=se.of(this._iid),u=i.dispatcher,_=i.requestQueue,f=new Ln(s({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:e,prevEnd:t,prevCount:a,nextStart:n,nextEnd:r,nextCount:o},this.filter)),[4,_.send(f)];case 1:return p=U.sent(),v=p.as(Dn),m=v.isHugeGap,E=v.prevMessages,g=void 0===E?[]:E,y=v.prevHasMore,N=v.nextMessages,C=void 0===N?[]:N,b=v.nextHasmore,m?Z((function(){return h(I,void 0,void 0,(function(){return d(this,(function(e){return this._handler.onHugeGapDetected(),[2]}))}))})):(this._hasPrevious=y,this._hasNext=b,A=this.viewTop,M=this.viewBottom,S=Math.min.apply(Math,c([Number.MAX_SAFE_INTEGER],l(g.map((function(e){return e.createdAt}))),!1)),T=Math.max.apply(Math,c([0],l(C.map((function(e){return e.createdAt}))),!1)),u.dispatch(new R({messages:g,source:Y.SYNC_MESSAGE_FILL})),u.dispatch(new R({messages:C,source:Y.SYNC_MESSAGE_FILL})),this._syncRange.extends(S,T),A<S&&this._prevFill.start(S),M>T&&this._nextFill.start(T)),[2]}}))}))}),1)];case 3:return v.sent(),[3,6];case 4:return u=Math.floor(this._limit/2),[4,this._getRemoteMessages(Date.now(),{prevLimit:u,nextLimit:u,source:Y.SYNC_MESSAGE_FILL})];case 5:(_=v.sent()).length>0&&((f=this._syncRange).extends.apply(f,c([],l(_.map((function(e){return e.createdAt}))),!1)),_.length<u&&(this._hasPrevious=!1,this._hasNext=!1)),v.label=6;case 6:return[2]}}))}))},e.prototype._loadAllFailedMessages=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return[4,mn.of(this._iid).getAllFailedMessagesFromCache(this._channel.url,this.filter)];case 1:return e=t.sent(),this._unsentMessages=e,[2,e]}}))}))},e.prototype.initialize=function(e){var t=this,n=new Vn;this._messages=[],this._unsentMessages=[],this._syncRange=new fn({}),this._hasNext=!0,this._hasPrevious=!0;var r=Math.floor(this._limit/2);switch(e){case bn.CACHE_AND_REPLACE_BY_API:this._getLocalMessages(this._startingPoint,{prevLimit:r,nextLimit:r}).then((function(e){var r=t._filterUnderOffsetMessage(e);t._addMessagesToView(r,Y.REQUEST_MESSAGE),n._invokeResponse("local",null,r)})).catch((function(e){if(X(e))throw e;n._invokeResponse("local",e,null)})).finally((function(){t._loadAllFailedMessages(),t._getRemoteMessages(t._startingPoint,{prevLimit:r,nextLimit:r}).then((function(e){var s;t._messages=[];var i=t._filterUnderOffsetMessage(e);i.length<r&&(t._hasPrevious=!1,t._hasNext=!1),i.length>0&&((s=t._syncRange).extends.apply(s,c([],l(i.map((function(e){return e.createdAt}))),!1)),t._addMessagesToView(i,Y.REQUEST_MESSAGE)),n._invokeResponse("remote",null,i)})).catch((function(e){if(X(e))throw e;n._invokeResponse("remote",e,null)}))}));break;case bn.API_ONLY:this._getRemoteMessages(this._startingPoint,{prevLimit:r,nextLimit:r}).then((function(e){var s,i=t._filterUnderOffsetMessage(e);i.length<r&&(t._hasPrevious=!1,t._hasNext=!1),i.length>0&&((s=t._syncRange).extends.apply(s,c([],l(i.map((function(e){return e.createdAt}))),!1)),t._addMessagesToView(i,Y.REQUEST_MESSAGE)),n._invokeResponse("remote",null,i)})).catch((function(e){if(X(e))throw e;n._invokeResponse("remote",e,null)}))}return n},e.prototype.loadPrevious=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s=this;return d(this,(function(i){switch(i.label){case 0:return this._hasPrevious?(e=this.viewTop,t=[],[4,w((function(){return h(s,void 0,void 0,(function(){var n;return d(this,(function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{prevLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}}))}))}))]):[3,5];case 1:return i.sent(),n=In.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,w((function(){return h(s,void 0,void 0,(function(){var r,s;return d(this,(function(i){switch(i.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{prevLimit:this._limit})];case 1:return t=r.apply(this,[i.sent()]),this._hasPrevious=t.length>=this._limit,t.length>0&&((s=this._syncRange).extends.apply(s,c([],l(t.map((function(e){return e.createdAt}))),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.top)),[2]}}))}))}))];case 2:return i.sent(),this._addMessagesToView(t,Y.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=t.length>=this._limit,t.length>0&&((r=this._syncRange).extends.apply(r,c([],l(t.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(t,Y.REQUEST_MESSAGE)),i.label=4;case 4:return[2,t];case 5:return[2,[]]}}))}))},e.prototype.loadNext=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s=this;return d(this,(function(i){switch(i.label){case 0:return e=this.viewBottom,t=[],[4,w((function(){return h(s,void 0,void 0,(function(){var n;return d(this,(function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{nextLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}}))}))}))];case 1:return i.sent(),n=In.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,w((function(){return h(s,void 0,void 0,(function(){var r,s;return d(this,(function(i){switch(i.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{nextLimit:this._limit})];case 1:return t=r.apply(this,[i.sent()]),this._hasNext=t.length>=this._limit,t.length>0&&((s=this._syncRange).extends.apply(s,c([],l(t.map((function(e){return e.createdAt}))),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.bottom)),[2]}}))}))}))];case 2:return i.sent(),this._addMessagesToView(t,Y.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=t.length>=this._limit,t.length>0&&((r=this._syncRange).extends.apply(r,c([],l(t.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(t,Y.REQUEST_MESSAGE)),i.label=4;case 4:return[2,t]}}))}))},e.prototype.removeFailedMessage=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return[4,mn.of(this._iid).removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},e.prototype.dispose=function(){var e=mn.of(this._iid);e.unsubscribeGroupChannelEvent(this._key),e.unsubscribeMessageEvent(this._key)},e}(),Bn=function(){this.coverUrl=null,this.coverImage=null,this.isDistinct=null,this.isPublic=null,this.isDiscoverable=null,this.accessCode=null,this.name=null,this.data=null,this.customType=null,this.operatorUserIds=null,this.messageSurvivalSeconds=null},qn=function(t){function n(e){var n=t.call(this)||this;if(e)for(var r in e)n.hasOwnProperty(r)&&(n[r]=e[r]);return n}return e(n,t),n.prototype.validate=function(){return T("string",this.coverUrl,!0)&&(I(this.coverImage)||T("string",this.coverImage)||null===this.coverImage)&&T("boolean",this.isDistinct,!0)&&T("boolean",this.isPublic,!0)&&T("boolean",this.isDiscoverable,!0)&&T("string",this.accessCode,!0)&&T("string",this.name,!0)&&T("string",this.data,!0)&&T("string",this.customType,!0)&&S("string",this.operatorUserIds,!0)&&T("number",this.messageSurvivalSeconds,!0)},n}(Bn),Kn=function(){this.hidePreviousMessages=!1,this.allowAutoUnhide=!0},jn=function(t){function n(e){var n=t.call(this)||this;if(e)for(var r in e)n.hasOwnProperty(r)&&(n[r]=e[r]);return n}return e(n,t),n.prototype.validate=function(){return T("boolean",this.hidePreviousMessages)&&T("boolean",this.allowAutoUnhide)},n}(Kn),Qn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.token,i=e.limit,a=e.order,o=e.mutedMemberFilter,u=e.memberStateFilter,c=e.nicknameStartsWithFilter,l=e.operatorFilter;return(n=t.call(this)||this).method=P.GET,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/members"),n.params={token:s,limit:i,order:a,muted_member_filter:o,member_state_filter:u,nickname_startswith:c,operator_filter:l,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return e(n,t),n}(x),zn=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.members=[];var s=n.next,i=n.members;return r.token=s,i&&i.length>0&&(r.members=i.map((function(t){return new Ke(e,t)}))),r}return e(n,t),n}(F);!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(Fn||(Fn={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(Hn||(Hn={}));var Yn=function(n){function r(e,t,r){var s,a,o,u,c=this;return(c=n.call(this,e,t,i.GROUP,r)||this).mutedMemberFilter=Fn.ALL,c.memberStateFilter=ze.ALL,c.nicknameStartsWithFilter=null,c.operatorFilter=Xe.ALL,c.order=Hn.MEMBER_NICKNAME_ALPHABETICAL,c.mutedMemberFilter=null!==(s=r.mutedMemberFilter)&&void 0!==s?s:Fn.ALL,c.memberStateFilter=null!==(a=r.memberStateFilter)&&void 0!==a?a:ze.ALL,c.nicknameStartsWithFilter=null!==(o=r.nicknameStartsWithFilter)&&void 0!==o?o:null,c.order=null!==(u=r.order)&&void 0!==u?u:Hn.MEMBER_NICKNAME_ALPHABETICAL,c}return e(r,n),r.prototype._validate=function(){return n.prototype._validate.call(this)&&t(Fn,this.mutedMemberFilter)&&t(ze,this.memberStateFilter)&&(T("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&t(Xe,this.operatorFilter)&&t(Hn,this.order)},r.prototype.next=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,i,a;return d(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=se.of(this._iid).requestQueue,t=new Qn(s(s({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),r=n.as(zn),i=r.members,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw M.queryInProgress;case 4:return[3,6];case 5:throw M.invalidParameters;case 6:return[2]}}))}))},r}(ce),Jn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,i=e.accessCode;return(n=t.call(this)||this).method=P.PUT,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:s,access_code:i},n}return e(n,t),n}(x),Wn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new pr(e,n),r.channel.myMemberState=Ge.JOINED,r}return e(n,t),n}(F),Xn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.isDistinct,i=e.isPublic,a=e.isDiscoverable,o=e.coverUrl,u=e.coverImage,c=e.accessCode,l=e.name,h=e.data,d=e.customType,_=e.operatorUserIds,f=e.messageSurvivalSeconds;return(n=t.call(this)||this).method=P.PUT,n.path="".concat(V,"/").concat(encodeURIComponent(r)),n.params={is_distinct:s,is_public:i,is_discoverable:a,name:l,data:h,custom_type:d,cover_url:o,cover_file:u,access_code:c,operator_ids:_,message_survival_seconds:f},n}return e(n,t),n}(x),Zn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new pr(e,n),r}return e(n,t),n}(F),$n=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=P.DELETE,n.path="".concat(V,"/").concat(encodeURIComponent(r)),n}return e(n,t),n}(x);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(F);var er=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=P.DELETE,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/hide"),n}return e(n,t),n}(x);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(F);var tr,nr,rr,sr,ir=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=P.GET,r.path="".concat(k,"/").concat(encodeURIComponent(n),"/push_preference"),r}return e(n,t),n}(x),ar=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return e(n,t),n}(F),or=function(t){function n(e){var n=e.userId,r=e.pushTriggerOption,s=t.call(this)||this;return s.method=P.PUT,s.path="".concat(k,"/").concat(encodeURIComponent(n),"/push_preference"),s.params={push_trigger_option:r},s}return e(n,t),n}(x),ur=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return e(n,t),n}(F),cr=function(t){function n(e){var n=e.userId,r=e.channelUrl,s=e.countPreference,i=t.call(this)||this;return i.method=P.PUT,i.path="".concat(k,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),i.params={count_preference:s},i}return e(n,t),n}(x),lr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.countPreference=tr[n.count_preference],r}return e(n,t),n}(F),hr=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=P.PUT,n.path="".concat(V,"/").concat(encodeURIComponent(r),"/reset_user_history"),n}return e(n,t),n}(x),dr=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return e(n,t),n}(F),_r=function(t){function n(e){var n=t.call(this)||this,r=e.channelType,s=e.channelUrl;return n.method=P.POST,n.path="".concat(ie(r),"/").concat(encodeURIComponent(s),"/scheduled_messages"),n.params={message_type:p.USER,user_id:e.userId,message:e.message,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,data:e.data,custom_type:e.customType,translation_target_langs:e.translationTargetLanguages,sorted_metaarray:e.metaArrays.map((function(e){return le.payloadify(e)})),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId,apple_critical_alert_options:he.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,scheduled_dt:e.scheduleDatetime},n}return e(n,t),n}(x),fr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new de(e,n),r}return e(n,t),n}(F);!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(tr||(tr={})),function(e){e.MUTED="muted",e.UNMUTED="unmuted"}(nr||(nr={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(rr||(rr={})),function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}(sr||(sr={}));var pr=function(o){function u(e,r){var u,h,d,_,f,p,v,m,E,g,y,N,C,b,A,M,S,I,U=this;return(U=o.call(this,e,r)||this)._unreadMemberStateMap=new Map,U._undeliveredMemberStateMap=new Map,U._typingStatus=new Map,U._lastMemberCountUpdated=0,U._typingStarted=0,U._typingEnded=0,U.isDistinct=!1,U.isSuper=!1,U.isBroadcast=!1,U.isExclusive=!1,U.isPublic=!1,U.isDiscoverable=!0,U.isAccessCodeRequired=!1,U.isPushEnabled=!1,U.unreadMessageCount=0,U.unreadMentionCount=0,U.members=[],U.memberCount=0,U.joinedMemberCount=0,U.hiddenState=rr.UNHIDDEN,U.lastMessage=null,U.messageOffsetTimestamp=0,U.messageSurvivalSeconds=-1,U.myMemberState=Ge.NONE,U.myRole=n.NONE,U.myMutedState=nr.UNMUTED,U.myLastRead=0,U.myCountPreference=tr.ALL,U.myPushTriggerOption=Fe.DEFAULT,U.inviter=null,U.invitedAt=0,U.joinedAt=0,U.channelType=i.GROUP,U.isDistinct=null!==(h=r.is_distinct)&&void 0!==h&&h,U.isSuper=null!==(d=r.is_super)&&void 0!==d&&d,U.isBroadcast=null!==(_=r.is_broadcast)&&void 0!==_&&_,U.isExclusive=null!==(f=r.is_exclusive)&&void 0!==f&&f,U.isPublic=null!==(p=r.is_public)&&void 0!==p&&p,U.isDiscoverable=null!==(v=r.is_discoverable)&&void 0!==v?v:U.isPublic,U.isAccessCodeRequired=null!==(m=r.is_access_code_required)&&void 0!==m&&m,U.isPushEnabled=null!==(E=r.is_push_enabled)&&void 0!==E&&E,Array.isArray(r.members)&&(u=U.members).push.apply(u,c([],l(r.members.map((function(e){return new Ke(U._iid,e)}))),!1)),U.memberCount=null!==(g=r.member_count)&&void 0!==g?g:0,U.joinedMemberCount=null!==(y=r.joined_member_count)&&void 0!==y?y:0,U.hiddenState=t(rr,r.hidden_state)?r.hidden_state:rr.UNHIDDEN,U.messageOffsetTimestamp=null!==(N=r.ts_message_offset)&&void 0!==N?N:0,U.messageSurvivalSeconds=null!==(C=r.message_survival_seconds)&&void 0!==C?C:-1,U.lastMessage=r.last_message?ae(U._iid,s({channel_type:U.channelType},r.last_message)):null,r.read_receipt&&Object.keys(r.read_receipt).forEach((function(e){T("number",r.read_receipt[e])&&U._updateUnreadMemberState(e,r.read_receipt[e])})),r.delivery_receipt&&Object.keys(r.delivery_receipt).forEach((function(e){T("number",r.delivery_receipt[e])&&U._updateUndeliveredMemberState(e,r.delivery_receipt[e])})),U.myMemberState=t(Ge,r.member_state)?r.member_state:Ge.NONE,U.myRole=t(n,r.my_role)?r.my_role:n.NONE,t(nr,r.is_muted)?U.myMutedState=r.is_muted:T("boolean",r.is_muted)?U.myMutedState=r.is_muted?nr.MUTED:nr.UNMUTED:U.myMutedState=nr.UNMUTED,U.myCountPreference=t(tr,r.count_preference)?r.count_preference:tr.ALL,U.myPushTriggerOption=t(Fe,r.push_trigger_option)?r.push_trigger_option:Fe.ALL,U.myLastRead=null!==(b=r.user_last_read)&&void 0!==b?b:0,U.inviter=r.inviter?new a(U._iid,r.inviter):null,U.invitedAt=null!==(A=r.invited_at)&&void 0!==A?A:0,U.joinedAt=null!==(M=r.joined_ts)&&void 0!==M?M:0,U._updateUnreadCount(null!==(S=r.unread_message_count)&&void 0!==S?S:0,null!==(I=r.unread_mention_count)&&void 0!==I?I:0),U}return e(u,o),Object.defineProperty(u.prototype,"isHidden",{get:function(){return this.hiddenState!==rr.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"isTyping",{get:function(){return Object.keys(this._typingStatus).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=_(this._unreadMemberStateMap),s=r.next();!s.done;s=r.next()){var i=l(s.value,2),a=i[0],o=i[1];n[a]=o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=_(this._undeliveredMemberStateMap),s=r.next();!s.done;s=r.next()){var i=l(s.value,2),a=i[0],o=i[1];n[a]=o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),u.payloadify=function(e){return e?r(s(s({},o.payloadify.call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return Ke.payloadify(e)})),last_message:_e(e.lastMessage),inviter:e.inviter?a.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt})):null},u.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===tr.ALL||this.myCountPreference===tr.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var n=se.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===tr.ALL||this.myCountPreference===tr.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},u.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),se.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},u.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);(!n||n<t)&&this._undeliveredMemberStateMap.set(e,t)},u.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus[e.userId]={user:e,ts:t}:delete this._typingStatus[e.userId]},u.prototype._invalidateTypingStatus=function(){var e=(new Date).getTime(),t=!1;for(var n in this._typingStatus){e-this._typingStatus[n].ts>=1e4&&(delete this._typingStatus[n],t=!0)}return t},u.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},u.prototype.isReadMessage=function(e){var t=se.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt},u.prototype.serialize=function(){var e=this;return B(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))},u.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new Gn(this._iid,s({channel:this},e))},u.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new Yn(this._iid,this.url,e)},u.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex((function(t){return t.userId===e.userId}));if(n>-1){var r=this.members[n];r.state===Ge.JOINED&&(e.state=r.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},u.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=this.members.findIndex((function(t){return t.userId===e.userId}));if(t>-1)return this.members.splice(t,1),this.memberCount--,!0}return!1},u.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof v&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=se.of(this._iid).sdkState,s=e.createdAt,i=0;try{for(var a=_(this.members),o=a.next();!o.done;o=a.next()){var u=o.value;if(r.userId!==u.userId&&u.state===Ge.JOINED&&e.sender.userId!==u.userId)(this.cachedUnreadMemberState[u.userId]||0)<s&&i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}return 0},u.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof v&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=se.of(this._iid).sdkState,s=e.createdAt,i=0;try{for(var a=_(this.members),o=a.next();!o.done;o=a.next()){var u=o.value;if(r.userId!==u.userId&&u.state===Ge.JOINED&&e.sender.userId!==u.userId)(this.cachedUndeliveredMemberState[u.userId]||0)<s&&i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}return 0},u.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=se.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=[];return this.members.forEach((function(i){(t||i.userId!==r.userId&&i.userId!==e.sender.userId)&&(n._unreadMemberStateMap.get(i.userId)>=e.createdAt&&s.push(i))})),s},u.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=se.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=[];return this.members.forEach((function(i){(t||i.userId!==r.userId&&i.userId!==e.sender.userId)&&(n._unreadMemberStateMap.get(i.userId)<e.createdAt&&s.push(i))})),s},u.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=se.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(s){if(e||s.userId!==n.userId){var i=t._unreadMemberStateMap.get(s.userId);r[s.userId]=new je(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Ke.payloadify(s),ts:i})}})),r},u.prototype.getTypingUsers=function(){var e=[];for(var t in this._typingStatus){var n=this._typingStatus[t].user;e.push(n)}return e},u.prototype.invalidateTypingStatus=function(){var e=se.of(this._iid).typingIndicatorInvalidateTime,t=(new Date).getTime(),n=!1;for(var r in this._typingStatus){t-this._typingStatus[r].ts>=e&&(delete this._typingStatus[r],n=!0)}return n},u.prototype.refresh=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s,i;return d(this,(function(a){switch(a.label){case 0:return e=se.of(this._iid),t=e.requestQueue,n=e.dispatcher,r=new Rt({channelUrl:this.url}),[4,t.send(r)];case 1:return s=a.sent(),i=s.as(Ot).channel,n.dispatch(new Mt({channels:[i],source:vt.REQUEST_CHANNEL})),[2,i]}}))}))},u.prototype.freeze=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,o.prototype.freeze.call(this)];case 1:return e.sent(),se.of(this._iid).dispatcher.dispatch(new Mt({channels:[this],source:vt.EVENT_CHANNEL_HIDDEN})),[2]}}))}))},u.prototype.unfreeze=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,o.prototype.unfreeze.call(this)];case 1:return e.sent(),se.of(this._iid).dispatcher.dispatch(new Mt({channels:[this],source:vt.EVENT_CHANNEL_UNHIDDEN})),[2]}}))}))},u.prototype.updateChannel=function(e){return h(this,void 0,void 0,(function(){var t,n,r,i,a,o;return d(this,(function(u){switch(u.label){case 0:return ee(e instanceof qn&&e.validate()).throw(M.invalidParameters),t=se.of(this._iid),n=t.dispatcher,r=t.requestQueue,i=new Xn(s({channelUrl:this.url},e)),[4,r.send(i)];case 1:return a=u.sent(),o=a.as(Zn).channel,n.dispatch(new Mt({channels:[o],source:vt.EVENT_CHANNEL_UPDATED})),[2,o]}}))}))},u.prototype.invite=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return ee(e.every((function(e){return e instanceof a}))).throw(M.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},u.prototype.inviteWithUserIds=function(e){return h(this,void 0,void 0,(function(){var t,n,r,s,i,a;return d(this,(function(o){switch(o.label){case 0:return ee(S("string",e)).throw(M.invalidParameters),t=se.of(this._iid),n=t.dispatcher,r=t.requestQueue,s=new zt({channelUrl:this.url,userIds:e}),[4,r.send(s)];case 1:return i=o.sent(),a=i.as(Yt).channel,n.dispatch(new Mt({channels:[a],source:vt.EVENT_CHANNEL_INVITED})),[2,a]}}))}))},u.prototype.join=function(e){return void 0===e&&(e=null),h(this,void 0,void 0,(function(){var t,n,r,s,i,a,o;return d(this,(function(u){switch(u.label){case 0:return ee(T("string",e)||null===e).throw(M.invalidParameters),t=se.of(this._iid),n=t.dispatcher,r=t.sdkState,s=t.requestQueue,i=new Bt({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,s.send(i)];case 1:return a=u.sent(),(o=a.as(qt).channel).myMemberState=Ge.JOINED,n.dispatch(new Mt({channels:[o],source:vt.EVENT_CHANNEL_JOINED})),[2,this]}}))}))},u.prototype.leave=function(){return h(this,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){switch(s.label){case 0:return e=se.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new jt({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s.sent(),[2]}}))}))},u.prototype.acceptInvitation=function(e){return void 0===e&&(e=null),h(this,void 0,void 0,(function(){var t,n,r,s,i,a,o;return d(this,(function(u){switch(u.label){case 0:return ee(T("string",e)||null===e).throw(M.invalidParameters),t=se.of(this._iid),n=t.dispatcher,r=t.sdkState,s=t.requestQueue,i=new Jn({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,s.send(i)];case 1:return a=u.sent(),(o=a.as(Wn).channel).myMemberState=Ge.JOINED,n.dispatch(new Mt({channels:[o],source:vt.EVENT_CHANNEL_ACCEPTED_INVITE})),[2,o]}}))}))},u.prototype.declineInvitation=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s,i;return d(this,(function(a){switch(a.label){case 0:return e=se.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Wt({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s=a.sent(),(i=s.as(Xt).channel).myMemberState=Ge.NONE,[2,i]}}))}))},u.prototype.sendUserMessage=function(e){var t=this,n=new fe,r=se.of(this._iid).dispatcher;return o.prototype.sendUserMessage.call(this,e).onPending((function(e){mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,r){r&&mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(r);n._trigger(e,r)})).onSucceeded((function(e){var s=mn.of(t._iid);s.autoResendManager.completeCurrentAndProcessNextAutoResend(e),t.lastMessage=e,s.handlers.map((function(e){return e.onChannelChanged(t)})),r.dispatch(new Mt({channels:[t],source:vt.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},u.prototype._autoResendUserMessage=function(e){var t=this,n=new fe,r=se.of(this._iid).dispatcher;return o.prototype._autoResendUserMessage.call(this,e).onPending((function(e){mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,r){mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(r),n._trigger(e,r)})).onSucceeded((function(e){var s=mn.of(t._iid);s.autoResendManager.completeCurrentAndProcessNextAutoResend(e),t.lastMessage=e,s.handlers.map((function(e){return e.onChannelChanged(t)})),r.dispatch(new Mt({channels:[t],source:vt.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},u.prototype.sendFileMessage=function(e){var t=this,n=new fe,r=se.of(this._iid).dispatcher;return o.prototype.sendFileMessage.call(this,e).onPending((function(e){mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,r){r&&mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(r);n._trigger(e,r)})).onSucceeded((function(e){var s=mn.of(t._iid);s.autoResendManager.completeCurrentAndProcessNextAutoResend(e),t.lastMessage=e,s.handlers.map((function(e){return e.onChannelChanged(t)})),r.dispatch(new Mt({channels:[t],source:vt.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},u.prototype._autoResendFileMessage=function(e){var t=this,n=new fe,r=se.of(this._iid).dispatcher;return o.prototype._autoResendFileMessage.call(this,e).onPending((function(e){mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,r){mn.of(t._iid).autoResendManager.completeCurrentAndProcessNextAutoResend(r),n._trigger(e,r)})).onSucceeded((function(e){var s=mn.of(t._iid);s.autoResendManager.completeCurrentAndProcessNextAutoResend(e),t.lastMessage=e,s.handlers.map((function(e){return e.onChannelChanged(t)})),r.dispatch(new Mt({channels:[t],source:vt.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},u.prototype.deleteMessage=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,o.prototype.deleteMessage.call(this,e)];case 1:return t.sent(),0===e.messageId&&se.of(this._iid).dispatcher.dispatch(new L({reqId:e.reqId,source:Y.EVENT_MESSAGE_DELETED})),[2]}}))}))},u.prototype.hide=function(e){return h(this,void 0,void 0,(function(){var t,n,r,i,a,o,u;return d(this,(function(c){switch(c.label){case 0:return ee(e instanceof jn&&e.validate()).throw(M.invalidParameters),t=se.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new sn(s({channelUrl:this.url,userId:r.userId},e)),[4,i.send(a)];case 1:return o=c.sent(),u=o.as(an).messageOffsetTimestamp,this.hiddenState=e.allowAutoUnhide?rr.HIDDEN_ALLOW_AUTO_UNHIDE:rr.HIDDEN_PREVENT_AUTO_UNHIDE,e.hidePreviousMessages&&this._updateUnreadCount(0,0),u&&(this.messageOffsetTimestamp=u),n.dispatch(new Mt({channels:[this],source:vt.EVENT_CHANNEL_HIDDEN})),[2,this]}}))}))},u.prototype.unhide=function(){return h(this,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){switch(s.label){case 0:return e=se.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new er({channelUrl:this.url}),[4,n.send(r)];case 1:return s.sent(),this.hiddenState=rr.UNHIDDEN,t.dispatch(new Mt({channels:[this],source:vt.EVENT_CHANNEL_UNHIDDEN})),[2,this]}}))}))},u.prototype.delete=function(){return h(this,void 0,void 0,(function(){var e,t;return d(this,(function(n){switch(n.label){case 0:return e=se.of(this._iid).requestQueue,t=new $n({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},u.prototype.markAsRead=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s,i,a,o=this;return d(this,(function(u){switch(u.label){case 0:return e=se.of(this._iid),t=e.sdkState,n=e.dispatcher,r=e.requestQueue,s=new $t({channelUrl:this.url}),[4,r.send(s)];case 1:return i=u.sent(),a=i.as(en).readStatus,this._updateUnreadMemberState(t.userId,a.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),mn.of(this._iid).handlers.map((function(e){return e.onChannelChanged(o)}))),n.dispatch(new Mt({channels:[this],source:vt.EVENT_CHANNEL_READ})),[2]}}))}))},u.prototype.markAsDelivered=function(){return h(this,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(s){switch(s.label){case 0:return e=se.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new tn({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s.sent(),[2]}}))}))},u.prototype.startTyping=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s;return d(this,(function(i){return e=se.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n&&(this._typingStarted=r,this._typingEnded=0,s=new un({channelUrl:this.url,time:this._typingStarted}),t.send(s)),[2]}))}))},u.prototype.endTyping=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s;return d(this,(function(i){return e=se.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n&&(this._typingStarted=0,this._typingEnded=r,s=new ln({channelUrl:this.url,time:this._typingStarted}),t.send(s)),[2]}))}))},u.prototype.registerScheduledUserMessage=function(e){return h(this,void 0,void 0,(function(){var t,n,r,i,a;return d(this,(function(o){switch(o.label){case 0:return ee(e instanceof pe&&e.validate()).throw(M.invalidParameters),t=se.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new _r(s({channelType:this.channelType,channelUrl:this.url,userId:n.userId,requestId:this._generateRequestId(),scheduleDatetime:e.scheduledDateTimeString},e)),[4,r.send(i)];case 1:return a=o.sent(),[2,a.as(fr).message]}}))}))},u.prototype.getMyPushTriggerOption=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s;return d(this,(function(i){switch(i.label){case 0:return e=se.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new ir({userId:t.userId}),[4,n.send(r)];case 1:return s=i.sent(),[2,s.as(ar).pushTriggerOption]}}))}))},u.prototype.setMyPushTriggerOption=function(e){return h(this,void 0,void 0,(function(){var n,r,s,i,a;return d(this,(function(o){switch(o.label){case 0:return ee(t(Fe,e)).throw(M.invalidParameters),n=se.of(this._iid),r=n.sdkState,s=n.requestQueue,i=new or({userId:r.userId,pushTriggerOption:e}),[4,s.send(i)];case 1:return a=o.sent(),[2,a.as(ur).pushTriggerOption]}}))}))},u.prototype.setMyCountPreference=function(e){return h(this,void 0,void 0,(function(){var n,r,s,i,a,o,u;return d(this,(function(c){switch(c.label){case 0:return ee(t(tr,e)).throw(M.invalidParameters),n=se.of(this._iid),r=n.dispatcher,s=n.sdkState,i=n.requestQueue,a=new cr({channelUrl:this.url,userId:s.userId,countPreference:e}),[4,i.send(a)];case 1:return o=c.sent(),u=o.as(lr).countPreference,this.myCountPreference=u,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),r.dispatch(new Mt({channels:[this],source:vt.EVENT_CHANNEL_CREATED})),[2,u]}}))}))},u.prototype.resetMyHistory=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,s,i;return d(this,(function(a){switch(a.label){case 0:return e=se.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new hr({channelUrl:this.url}),[4,n.send(r)];case 1:return s=a.sent(),i=s.as(dr).messageOffsetTimestamp,this.messageOffsetTimestamp=i,t.dispatch(new Mt({channels:[this],source:vt.EVENT_CHANNEL_RESET_HISTORY})),[2,this]}}))}))},u}(ke);export{Hn as $,pr as A,qe as B,Mt as C,Tt as D,_n as E,Nt as F,Be as G,bt as H,gt as I,tr as J,yt as K,Et as L,tt as M,st as N,Ct as O,He as P,jn as Q,Kn as R,Ye as S,fn as T,sr as U,$e as V,qn as W,Bn as X,We as Y,rr as Z,Ke as _,it as a,Yn as a0,Ge as a1,ze as a2,Gn as a3,Vn as a4,bn as a5,Sn as a6,ct as a7,nr as a8,Xe as a9,Ze as aa,je as ab,Je as ac,at as b,ot as c,ht as d,_t as e,ft as f,et as g,wt as h,lt as i,mt as j,xe as k,ar as l,ir as m,ur as n,Fe as o,or as p,Ve as q,An as r,mn as s,vt as t,On as u,At as v,nt as w,rt as x,Mn as y,Qe as z};
