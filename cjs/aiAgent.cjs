Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./lib/__bundle-898d8198.cjs"),t=require("./lib/__bundle-7445b36f.cjs");require("./lib/__bundle-cf3572ca.cjs"),require("./lib/__bundle-2ef58f52.cjs"),require("./lib/__bundle-137a1c17.cjs"),require("./lib/__bundle-dae7bdf2.cjs"),require("./lib/__bundle-30435ddc.cjs");class n extends e.APIRequestCommand{constructor({aiAgentId:t,userId:n,language:s,country:i,context:r,forceCreateChannel:a,knownActiveChannelUrl:o}){super(),this.method=e.APIRequestMethod.POST,this.path=`${e.API_PATH_AI_AGENT}/ai_agents/${encodeURIComponent(t)}/messenger_settings`,this.requireAuth=!1,this.params=e.deundefined({user_id:n,country:i,language:s,context:r,force_create:a,known_active_channel_url:o})}}class s extends e.APIResponseCommand{constructor(e,t){super(e,t),this.settings=t}}class i extends e.APIRequestCommand{constructor(t){const{token:n,limit:s,aiAgentId:i,status:r,reverse:a,order:o}=t;super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_AI_AGENT}/my_conversations`,this.params=e.deundefined({token:n,limit:s,reverse:a,order:o,status:r,bot_userid:i})}}class r extends e.APIResponseCommand{constructor(e,n){super(e,n),this.conversations=[];const{next_token:s,conversations:i}=n;this.token=s,i&&i.length>0&&(this.conversations=i.map((e=>new t.Conversation(e))))}}const a={limit:10};class o extends e.APIRequestCommand{constructor(t){const{limit:n=a.limit,keys:s,token:i}=t;super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_AI_AGENT}/sdk_message_templates`,this.params=e.deundefined({limit:n,keys:s,token:i})}}class l extends e.APIResponseCommand{constructor(e,t){super(e,t);const{templates:n,template_list_token:s}=t;this.token=s,this.templates=n.map((e=>({template:JSON.stringify(e)})))}}class h extends e.APIRequestCommand{constructor(t){const{key:n}=t;super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_AI_AGENT}/sdk_message_templates/${n}`}}class d extends e.APIResponseCommand{constructor(e,t){super(e,t),this.template=JSON.stringify(t)}}var u,c;exports.AIAgentChannelFilter=void 0,(u=exports.AIAgentChannelFilter||(exports.AIAgentChannelFilter={})).INCLUDE="include",u.EXCLUDE="exclude",exports.DeskChannelFilter=void 0,(c=exports.DeskChannelFilter||(exports.DeskChannelFilter={})).INCLUDE="include",c.EXCLUDE="exclude";const g={aiAgentChannelFilter:exports.AIAgentChannelFilter.INCLUDE,aiAgentIds:[],deskChannelFilter:exports.DeskChannelFilter.INCLUDE,pinnedChannelUrls:[]};class C extends e.APIRequestCommand{constructor(t){super();const{aiAgentChannelFilter:n,aiAgentIds:s,deskChannelFilter:i,aiAgentConversationStatusFilter:r,pinnedChannelUrls:a,userId:o,token:l,limit:h}=Object.assign(Object.assign({},g),t);this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_AI_AGENT_USERS}/${encodeURIComponent(o)}/my_group_channels`,this.params=e.deundefined({token:l,limit:h,ai_agent_channel_filter:n,desk_channel_filter:i}),r&&r.length>0&&(this.params.ai_agent_conversation_status_filter=r),s&&s.length>0&&(this.params.ai_agent_ids=s),a&&a.length>0&&(this.params.pinned_channel_urls=a)}}class p extends e.APIResponseCommand{constructor(e,n){super(e,n),this.channels=[];const{next:s,channels:i,ts:r}=n;this.token=s,i&&i.length>0&&(this.channels=i.map((n=>(n.ts=r,new t.GroupChannel(e,n))))),this.ts=null!=r?r:0}}const _={aiAgentChannelFilter:exports.AIAgentChannelFilter.INCLUDE,aiAgentIds:[],deskChannelFilter:exports.DeskChannelFilter.INCLUDE,pinnedChannelUrls:[]},A=t=>e.isEnumOf(exports.AIAgentChannelFilter,t.aiAgentChannelFilter,!0)&&e.isArrayOf("string",t.aiAgentIds,!0)&&e.isEnumOf(exports.DeskChannelFilter,t.deskChannelFilter,!0)&&e.isArrayOf("string",t.pinnedChannelUrls,!0);class m extends e.APIRequestCommand{constructor({userId:t,ts:n,token:s,params:i}){super();const{aiAgentChannelFilter:r,aiAgentIds:a,deskChannelFilter:o,pinnedChannelUrls:l}=Object.assign(Object.assign({},_),i);this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_AI_AGENT_USERS}/${encodeURIComponent(t)}/my_group_channels/changelogs`,this.params=e.deundefined({token:s,change_ts:n,ai_agent_channel_filter:r,desk_channel_filter:o}),a&&a.length>0&&(this.params.ai_agent_ids=a),l&&l.length>0&&(this.params.pinned_channel_urls=l)}}class v extends e.APIResponseCommand{constructor(e,n){super(e,n),this.updatedChannels=n.updated.map((s=>{const i=Object.assign(s,{ts:n.ts});return new t.GroupChannel(e,i)})),this.deletedChannelUrls=n.deleted,this.hasMore=n.has_more,this.token=n.next,this.ts=n.ts}}const f={aiAgentChannelFilter:exports.AIAgentChannelFilter.INCLUDE,aiAgentIds:[],deskChannelFilter:exports.DeskChannelFilter.INCLUDE,pinnedChannelUrls:[]};class I extends e.APIRequestCommand{constructor({userId:t,params:n}){super();const{aiAgentChannelFilter:s,aiAgentConversationStatusFilter:i,aiAgentIds:r,deskChannelFilter:a,pinnedChannelUrls:o}=Object.assign(Object.assign({},f),n);this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_AI_AGENT_USERS}/${encodeURIComponent(t)}/my_group_channels/unread_message_count`,this.params=e.deundefined({ai_agent_channel_filter:s,desk_channel_filter:a}),i&&i.length>0&&(this.params.ai_agent_conversation_status_filter=i),r&&r.length>0&&(this.params.ai_agent_ids=r),o&&o.length>0&&(this.params.pinned_channel_urls=o)}}class k extends e.APIResponseCommand{constructor(e,t){super(e,t),this.total=t.total,this.aiAgentChannelCount=t.ai_agent_channel,this.deskChannelCount=t.desk_channel,this.pinnedChannel=t.pinned_channel.map((e=>({channelUrl:e.channel_url,count:e.count})))}}const y={};class x{constructor(e,{sdkState:t,requestQueue:n,logger:s,dispatcher:i}){this._iid=e,this._sdkState=t,this._requestQueue=n,this._logger=s,this._dispatcher=i,y[e]=this}static of(e){return y[e]}requestMessengerSettings(t){return e.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:i}=e.Vault.of(this._iid),r=new n(t),a=yield i.commandRouter.send(r),{settings:o}=a.as(s);return o}))}getConversations(t,n,s){return e.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:a}=e.Vault.of(this._iid),o=new i(Object.assign(Object.assign({},n),{token:t,limit:s})),l=yield a.send(o),{conversations:h,token:d}=l.as(r);return{conversations:h,token:d}}))}getMessageTemplates(t={}){return e.__awaiter(this,void 0,void 0,(function*(){const{keys:e,limit:n}=t,s=new o({keys:e,limit:n}),i=yield this._requestQueue.send(s),{templates:r,token:a}=i.as(l);return{templates:r,token:a}}))}getMessageTemplate(t){return e.__awaiter(this,void 0,void 0,(function*(){const e=new h({key:t}),n=yield this._requestQueue.send(e),{template:s}=n.as(d);return{template:s}}))}getMyGroupChannels(n,s,i,r=e.CollectionEventSource.REQUEST_CHANNEL){return e.__awaiter(this,void 0,void 0,(function*(){const e=new C(Object.assign(Object.assign({},s),{userId:this._sdkState.userId,token:n,limit:i})),a=yield this._requestQueue.send(e),{channels:o,token:l,ts:h}=a.as(p);return this._dispatcher.dispatch(new t.GroupChannelUpdateEventCommand({channels:o,context:{source:r}})),{channels:o,token:l,ts:h}}))}getMyGroupChannelChangeLogs(n,s,i=e.CollectionEventSource.REQUEST_CHANNEL_CHANGELOGS){return e.__awaiter(this,void 0,void 0,(function*(){const r="string"==typeof n?n:null,a="number"==typeof n?n:null,o=new m(e.undefineNullProps({userId:this._sdkState.userId,ts:a,token:r,params:s})),l=(yield this._requestQueue.send(o)).as(v),{updatedChannels:h,deletedChannelUrls:d,hasMore:u,ts:c}=l;return h.length>0&&this._dispatcher.dispatch(new t.GroupChannelUpdateEventCommand({channels:h,context:{source:i},ts:c})),d.length>0&&this._dispatcher.dispatch(new t.GroupChannelRemoveEventCommand({channelUrls:d,context:{source:i}})),{updatedChannels:h,deletedChannelUrls:d,hasMore:u,token:l.token}}))}getUnreadMessageCount(t){return e.__awaiter(this,void 0,void 0,(function*(){const e=new I({userId:this._sdkState.userId,params:t}),n=yield this._requestQueue.send(e),{total:s,aiAgentChannelCount:i,deskChannelCount:r,pinnedChannel:a}=n.as(k);return{total:s,aiAgentChannelCount:i,deskChannelCount:r,pinnedChannel:a}}))}}var E;exports.ConversationListOrder=void 0,(E=exports.ConversationListOrder||(exports.ConversationListOrder={})).CREATED_AT="created_at",E.UPDATED_AT="updated_at";const F={status:void 0,aiAgentId:void 0,reverse:!1,order:exports.ConversationListOrder.UPDATED_AT};class O extends e.BaseListQuery{constructor(e,t){var n,s,i,r;super(e,t),this.status=null!==(n=t.status)&&void 0!==n?n:void 0,this.aiAgentId=null!==(s=t.aiAgentId)&&void 0!==s?s:void 0,this.reverse=null!==(i=t.reverse)&&void 0!==i?i:F.reverse,this.order=null!==(r=t.order)&&void 0!==r?r:F.order}_validate(){return super._validate()&&e.isEnumOf(t.ConversationStatus,this.status,!0)&&e.isTypeOf("string",this.aiAgentId,!0)&&e.isTypeOf("boolean",this.reverse)&&e.isEnumOf(exports.ConversationListOrder,this.order)}serialize(){return e.serialize(this)}next(){return e.__awaiter(this,void 0,void 0,(function*(){const t=x.of(this._iid);if(this._validate()){if(this._isLoading)throw e.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{conversations:n,token:s}=yield t.getConversations(this._token,e.undefineNullProps(Object.assign({},this)),this.limit);return this._token=s,this._hasNext=!!s,this._isLoading=!1,n}return[]}throw e.SendbirdError.invalidParameters}))}}class b extends e.BaseListQuery{constructor(e,t){super(e,t),this._ts=0,this.aiAgentChannelFilter=g.aiAgentChannelFilter,this.aiAgentIds=g.aiAgentIds,this.deskChannelFilter=g.deskChannelFilter,this.pinnedChannelUrls=g.pinnedChannelUrls,t.aiAgentChannelFilter&&(this.aiAgentChannelFilter=t.aiAgentChannelFilter),t.aiAgentConversationStatusFilter&&(this.aiAgentConversationStatusFilter=t.aiAgentConversationStatusFilter),t.aiAgentIds&&(this.aiAgentIds=t.aiAgentIds),t.deskChannelFilter&&(this.deskChannelFilter=t.deskChannelFilter),t.pinnedChannelUrls&&(this.pinnedChannelUrls=t.pinnedChannelUrls)}_validate(){return super._validate()&&e.isEnumOf(exports.AIAgentChannelFilter,this.aiAgentChannelFilter)&&e.isArrayOf(t.ConversationStatus,this.aiAgentConversationStatusFilter,!0)&&e.isArrayOf("string",this.aiAgentIds)&&e.isEnumOf(exports.DeskChannelFilter,this.deskChannelFilter)&&e.isArrayOf("string",this.pinnedChannelUrls)}serialize(){return e.serialize(this)}get lastResponseAt(){return this._ts}belongsTo(e){if(this.pinnedChannelUrls.includes(e.url))return!0;if(e.isAIAgent&&!e.conversation)return!1;if(this.aiAgentChannelFilter===exports.AIAgentChannelFilter.EXCLUDE)if(e.isAIAgent)return!1;if(this.aiAgentConversationStatusFilter&&e.isAIAgent){if(!this.aiAgentConversationStatusFilter.some((t=>{var n;return(null===(n=e.conversation)||void 0===n?void 0:n.status)===t})))return!1}if(this.deskChannelFilter===exports.DeskChannelFilter.EXCLUDE)if(e.isDesk)return!1;return!0}next(){return e.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw e.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const t=x.of(this._iid),n=e.undefineNullProps({aiAgentChannelFilter:this.aiAgentChannelFilter,aiAgentConversationStatusFilter:this.aiAgentConversationStatusFilter,aiAgentIds:this.aiAgentIds,deskChannelFilter:this.deskChannelFilter,pinnedChannelUrls:this.pinnedChannelUrls}),{channels:s,token:i,ts:r}=yield t.getMyGroupChannels(this._token,n,this.limit);return this._token=i,this._hasNext=!!i,this._isLoading=!1,this._ts=r,s}return[]}throw e.SendbirdError.invalidParameters}))}}class P extends e.Module{constructor(){super(...arguments),this.name="aiAgent"}init(e,{sdkState:t,dispatcher:n,sessionManager:s,requestQueue:i,logger:r,onlineDetector:a,cacheContext:o}){super.init(e,{sdkState:t,dispatcher:n,sessionManager:s,requestQueue:i,logger:r,onlineDetector:a,cacheContext:o}),this._manager=new x(e,{sdkState:t,requestQueue:i,logger:r,dispatcher:n})}requestMessengerSettings(t){return e.__awaiter(this,void 0,void 0,(function*(){const{aiAgentId:n,userId:s,language:i,country:r,context:a,forceCreateChannel:o,knownActiveChannelUrl:l}=t;return e.unless(e.isTypeOf("string",n)&&e.isTypeOf("string",s,!0)&&e.isTypeOf("string",i,!0)&&e.isTypeOf("string",r,!0)&&e.isTypeOf("object",a,!0)&&e.isTypeOf("boolean",o,!0)&&e.isTypeOf("string",l,!0)).throw(e.SendbirdError.invalidParameters),this._manager.requestMessengerSettings(t)}))}createConversationListQuery(e={}){return new O(this._iid,e)}createMyGroupChannelListQuery(e={}){return new b(this._iid,e)}getMyGroupChannelChangeLogsByToken(t,n={}){return e.__awaiter(this,void 0,void 0,(function*(){const s=Object.assign(Object.assign({},_),n);return e.unless(e.isTypeOf("string",t)&&A(s)).throw(e.SendbirdError.invalidParameters),yield this._manager.getMyGroupChannelChangeLogs(t,s)}))}getMyGroupChannelChangeLogsByTimestamp(t,n={}){return e.__awaiter(this,void 0,void 0,(function*(){const s=Object.assign(Object.assign({},_),n);return e.unless(e.isTypeOf("number",t)&&A(s)).throw(e.SendbirdError.invalidParameters),yield this._manager.getMyGroupChannelChangeLogs(t,s)}))}getUnreadMessageCount(n={}){return e.__awaiter(this,void 0,void 0,(function*(){const s=Object.assign(Object.assign({},f),n);return e.unless(e.isEnumOf(exports.AIAgentChannelFilter,s.aiAgentChannelFilter,!0)&&e.isArrayOf(t.ConversationStatus,s.aiAgentConversationStatusFilter,!0)&&e.isArrayOf("string",s.aiAgentIds,!0)&&e.isEnumOf(exports.DeskChannelFilter,s.deskChannelFilter,!0)&&e.isArrayOf("string",s.pinnedChannelUrls,!0)).throw(e.SendbirdError.invalidParameters),this._manager.getUnreadMessageCount(s)}))}getMessageTemplates(t={}){return e.__awaiter(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},a),t);return e.unless((t=>e.isTypeOf("number",t.limit,!0)&&e.isArrayOf("string",t.keys,!0))(n)).throw(e.SendbirdError.invalidParameters),this._manager.getMessageTemplates(t)}))}getMessageTemplate(t){return e.__awaiter(this,void 0,void 0,(function*(){return e.unless(e.isTypeOf("string",t)).throw(e.SendbirdError.invalidParameters),this._manager.getMessageTemplate(t)}))}}exports.AIAgentInfo=e.AIAgentInfo,exports.Conversation=t.Conversation,exports.ConversationChannelInfo=t.ConversationChannelInfo,exports.ConversationHandoff=t.ConversationHandoff,exports.ConversationResolution=t.ConversationResolution,Object.defineProperty(exports,"ConversationStatus",{enumerable:!0,get:function(){return t.ConversationStatus}}),Object.defineProperty(exports,"ConversationType",{enumerable:!0,get:function(){return t.ConversationType}}),exports.AIAgentGroupChannelListQuery=b,exports.AIAgentModule=P,exports.ConversationListQuery=O;
