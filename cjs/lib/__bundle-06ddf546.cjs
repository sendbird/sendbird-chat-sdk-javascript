function e(e,t,s,i){return new(s||(s=Promise))((function(n,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function a(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}d((i=i.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var t,s="4.19.4";class i{static get OS_VERSION(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}static get SDK_VERSION(){return s}static get SDK_MAJOR_VERSION(){return i.SDK_VERSION.split(".")[0]}static get DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL(){return 100}static get INTERNAL_CALL(){return"ic"}}exports.SendbirdErrorCode=void 0,(t=exports.SendbirdErrorCode||(exports.SendbirdErrorCode={}))[t.NON_AUTHORIZED=400108]="NON_AUTHORIZED",t[t.INVALID_TOKEN=400111]="INVALID_TOKEN",t[t.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",t[t.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",t[t.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",t[t.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",t[t.APPLICATION_NOT_FOUND=400304]="APPLICATION_NOT_FOUND",t[t.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",t[t.SESSION_REVOKED=400310]="SESSION_REVOKED",t[t.INVALID_SESSION_TYPE=400312]="INVALID_SESSION_TYPE",t[t.INVALID_AUTH_FOR_SERVICE=400313]="INVALID_AUTH_FOR_SERVICE",t[t.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",t[t.NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE=400940]="NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE",t[t.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",t[t.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",t[t.INVALID_REQUIRED_FORM_VALUE=400105]="INVALID_REQUIRED_FORM_VALUE",t[t.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",t[t.NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE=901500]="NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE",t[t.ERR_DUPLICATED_DATA=400202]="ERR_DUPLICATED_DATA",t[t.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",t[t.LOST_INSTANCE=700100]="LOST_INSTANCE",t[t.CONNECTION_RENEW=700102]="CONNECTION_RENEW",t[t.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",t[t.INVALID_COMMAND=700700]="INVALID_COMMAND",t[t.XMLHTTPREQUEST_NOT_SUPPORTED=700800]="XMLHTTPREQUEST_NOT_SUPPORTED",t[t.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",t[t.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",t[t.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",t[t.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",t[t.INVALID_PARAMETER=800110]="INVALID_PARAMETER",t[t.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",t[t.NETWORK_ERROR=800120]="NETWORK_ERROR",t[t.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",t[t.MALFORMED_DATA=800130]="MALFORMED_DATA",t[t.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",t[t.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",t[t.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",t[t.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",t[t.ACK_TIMEOUT=800180]="ACK_TIMEOUT",t[t.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",t[t.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",t[t.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",t[t.REQUEST_FAILED=800220]="REQUEST_FAILED",t[t.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",t[t.REQUEST_CANCELED=800240]="REQUEST_CANCELED",t[t.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",t[t.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",t[t.ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED=800270]="ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED",t[t.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",t[t.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",t[t.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",t[t.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",t[t.DATABASE_ERROR=800700]="DATABASE_ERROR",t[t.USER_DEACTIVATED=900021]="USER_DEACTIVATED",t[t.CHANNEL_IS_FROZEN=900050]="CHANNEL_IS_FROZEN",t[t.RECEIVER_USER_DEACTIVATED=900081]="RECEIVER_USER_DEACTIVATED";const n=e=>!(e instanceof o&&!e.shouldThrowOutside);class o extends Error{constructor({code:e=0,message:t=""}){super(t),this.shouldThrowOutside=!1,this._detail="",this.name="SendbirdError",this.code=e,Object.setPrototypeOf(this,o.prototype)}get detail(){return this._detail}setDetail(e){this._detail=e}get isInvalidTokenError(){return this.code===exports.SendbirdErrorCode.INVALID_TOKEN}get isSessionExpiredError(){return this.isSessionTokenExpiredError||this.isSessionKeyExpiredError}get isSessionTokenExpiredError(){return this.code===exports.SendbirdErrorCode.SESSION_TOKEN_EXPIRED}get isSessionKeyExpiredError(){return this.code===exports.SendbirdErrorCode.SESSION_KEY_EXPIRED}get isSessionInvalidatedError(){return this.isSessionRevokedError||this.isUserAuthDeactivedError||this.isUserAuthDeletedOrNotFoundError}get isSessionRevokedError(){return this.code===exports.SendbirdErrorCode.SESSION_REVOKED}get isUserAuthDeactivedError(){return this.code===exports.SendbirdErrorCode.USER_AUTH_DEACTIVATED}get isUserAuthDeletedOrNotFoundError(){return this.code===exports.SendbirdErrorCode.USER_AUTH_DELETED_OR_NOT_FOUND}get isNetworkError(){return this.code===exports.SendbirdErrorCode.NETWORK_ERROR||this.code===exports.SendbirdErrorCode.NETWORK_ROUTING_ERROR}static get debugModeRequired(){return new o({code:exports.SendbirdErrorCode.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})}static get lostInstance(){return new o({code:exports.SendbirdErrorCode.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})}static get invalidCommand(){return new o({code:exports.SendbirdErrorCode.INVALID_COMMAND,message:"Cannot send invalid command."})}static get unknown(){return new o({code:exports.SendbirdErrorCode.UNKNOWN_ERROR,message:"Unknown error occurred."})}static get connectionRenew(){return new o({code:exports.SendbirdErrorCode.CONNECTION_RENEW,message:"Connection restarts."})}static get invalidConnectionStateTransition(){return new o({code:exports.SendbirdErrorCode.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})}static get xmlHttpRequestNotSupported(){return new o({code:exports.SendbirdErrorCode.XMLHTTPREQUEST_NOT_SUPPORTED,message:"Cannot upload file. XMLHttpRequest is not defined in this environment."})}static get connectionRequired(){return new o({code:exports.SendbirdErrorCode.CONNECTION_REQUIRED,message:"Connection is required."})}static get connectionCanceled(){return new o({code:exports.SendbirdErrorCode.CONNECTION_CANCELED,message:"Connection is canceled."})}static get invalidParameters(){return new o({code:exports.SendbirdErrorCode.INVALID_PARAMETER,message:"Invalid parameters."})}static get notSupportedError(){return new o({code:exports.SendbirdErrorCode.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})}static get channelTypeNotSupportedError(){return new o({code:exports.SendbirdErrorCode.NOT_SUPPORTED_ERROR,message:"Called method is not supported in the current channel's channel type."})}static get networkError(){return new o({code:exports.SendbirdErrorCode.NETWORK_ERROR,message:"There was a network error."})}static get markAsReadAllRateLimitExceeded(){return new o({code:exports.SendbirdErrorCode.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})}static get queryInProgress(){return new o({code:exports.SendbirdErrorCode.QUERY_IN_PROGRESS,message:"Query in progress."})}static get noAckTimeout(){return new o({code:exports.SendbirdErrorCode.ACK_TIMEOUT,message:"Command received no ack."})}static get loginTimeout(){return new o({code:exports.SendbirdErrorCode.LOGIN_TIMEOUT,message:"Connection timeout."})}static get connectionClosed(){return new o({code:exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})}static get requestFailed(){return new o({code:exports.SendbirdErrorCode.REQUEST_FAILED,message:"Request failed."})}static get tooManyRequests(){return new o({code:exports.SendbirdErrorCode.REQUEST_DUPLICATED,message:"Too many requests."})}static get alreadyConnectedAsAnotherUser(){return new o({code:exports.SendbirdErrorCode.REQUEST_FAILED,message:"Already logged in as a different user. Call disconnect() first."})}static get fileUploadCanceled(){return new o({code:exports.SendbirdErrorCode.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})}static get requestCanceled(){return new o({code:exports.SendbirdErrorCode.REQUEST_CANCELED,message:"Request has been canceled."})}static get sessionTokenRefreshFailed(){return new o({code:exports.SendbirdErrorCode.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})}static get sessionTokenRequestFailed(){return new o({code:exports.SendbirdErrorCode.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})}static get databaseError(){return new o({code:exports.SendbirdErrorCode.DATABASE_ERROR,message:"Database error."})}static get fileSizeLimitExceededError(){return new o({code:exports.SendbirdErrorCode.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})}static get statLogUploadLimitExceededError(){return new o({code:exports.SendbirdErrorCode.ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED,message:"The upload request failed due to the retry count being exceeded."})}static get malformedDataError(){return new o({code:exports.SendbirdErrorCode.MALFORMED_DATA,message:"Malformed data."})}throwOutside(){throw this.shouldThrowOutside=!0,this}}const r=[exports.SendbirdErrorCode.CONNECTION_REQUIRED,exports.SendbirdErrorCode.NETWORK_ERROR,exports.SendbirdErrorCode.ACK_TIMEOUT,exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_CLOSED,exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_FAILED,exports.SendbirdErrorCode.FILE_UPLOAD_CANCEL_FAILED,exports.SendbirdErrorCode.REQUEST_CANCELED,exports.SendbirdErrorCode.INTERNAL_SERVER_ERROR,exports.SendbirdErrorCode.RATE_LIMIT_EXCEEDED,exports.SendbirdErrorCode.UNKNOWN_SERVER_ERROR,exports.SendbirdErrorCode.USER_DEACTIVATED,exports.SendbirdErrorCode.CHANNEL_IS_FROZEN,exports.SendbirdErrorCode.RECEIVER_USER_DEACTIVATED],a=[exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_CLOSED,exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_FAILED,exports.SendbirdErrorCode.CONNECTION_REQUIRED,exports.SendbirdErrorCode.CHANNEL_IS_FROZEN],d=(e,t,s=!1)=>!(!s||!u(t))||("string"!=typeof e?"object"==typeof e?c(e,t):l(e,t):typeof t===e),c=(e,t,s=!1)=>!(!s||!u(t))||Object.values(e).includes(t),l=(e,t)=>t instanceof e,h=(e,t=!1)=>{if(t&&u(e))return!0;const s="object"==typeof e&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!s){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return s},u=e=>null==e;class _{constructor({useMemberInfoInMessage:e=!0,typingIndicatorInvalidateTime:t=1e4,typingIndicatorThrottle:s=1e3,websocketResponseTimeout:i=1e4,websocketPayloadDecompression:n=!0,sessionTokenRefreshTimeout:o=60}={}){this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=e,this._typingIndicatorInvalidateTime=t,this._typingIndicatorThrottle=s,this._websocketResponseTimeout=i,this._sessionTokenRefreshTimeout=o,this.websocketPayloadDecompression=n}get useMemberInfoInMessage(){return this._useMemberInfoInMessage}set useMemberInfoInMessage(e){d("boolean",e)&&(this._useMemberInfoInMessage=e)}get typingIndicatorInvalidateTime(){return this._typingIndicatorInvalidateTime}set typingIndicatorInvalidateTime(e){d("number",e)&&(this._typingIndicatorInvalidateTime=e)}get typingIndicatorThrottle(){return this._typingIndicatorThrottle}set typingIndicatorThrottle(e){d("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)}get websocketResponseTimeout(){return this._websocketResponseTimeout}set websocketResponseTimeout(e){d("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)}get sessionTokenRefreshTimeout(){return this._sessionTokenRefreshTimeout}set sessionTokenRefreshTimeout(e){d("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e)}}const p={encrypt:e=>e,decrypt:e=>e};class f{constructor({store:e}){this._preference=new Map,this._store=e}_savePreferenceKeys(){return e(this,void 0,void 0,(function*(){yield this._store.set({key:this._keysAddress,value:[...this._preference.keys()]})}))}init(t,s=1){var i;return e(this,void 0,void 0,(function*(){this._version=s,this._keysAddress=t;const e=`${t}.metadata.version`,n=yield this._store.get(e),o=null!==(i=yield this._store.get(t))&&void 0!==i?i:[];if(!n||n.version<this._version){switch(this._version){case 9:{const e=o.find((e=>e.includes("groupchannel/sync.meta")));e&&(yield this._store.remove(e));break}default:yield this._resetPreferenceData(o)}yield this._updatePreferenceVersionInfo(e)}else for(const e of o){const t=yield this._store.get(e);t&&this._preference.set(e,t)}}))}_updatePreferenceVersionInfo(t){return e(this,void 0,void 0,(function*(){yield this._store.set({key:t,value:{version:this._version}})}))}_resetPreferenceData(t){return e(this,void 0,void 0,(function*(){this._preference=new Map,yield this._store.removeMany(t)}))}get(t){return e(this,void 0,void 0,(function*(){return this._preference.get(t)}))}set(t,s){return e(this,void 0,void 0,(function*(){const e=!this._preference.has(t);yield this._store.set({key:t,value:s}),this._preference.set(t,s),e&&(yield this._savePreferenceKeys())}))}remove(t){return e(this,void 0,void 0,(function*(){yield this._store.remove(t),this._preference.delete(t),yield this._savePreferenceKeys()}))}clear(){return e(this,void 0,void 0,(function*(){yield this._store.removeMany([...this._preference.keys()]),this._preference.clear(),yield this._savePreferenceKeys()}))}}class g{constructor({encryption:e,store:t,localCacheEnabled:s,localCacheConfig:i}){this.store=t,this.preference=new f({store:t}),this.encryption=null!=e?e:p,this.localCacheEnabled=s,this.localCacheConfig=i}replaceStore(e){this.store=e,this.preference=new f({store:e})}}var E,m,v,y,S,C;exports.PushTokenRegistrationState=void 0,(E=exports.PushTokenRegistrationState||(exports.PushTokenRegistrationState={})).SUCCESS="success",E.PENDING="pending",E.ERROR="error",exports.PushTriggerOption=void 0,(m=exports.PushTriggerOption||(exports.PushTriggerOption={})).DEFAULT="default",m.ALL="all",m.MENTION_ONLY="mention_only",m.OFF="off",exports.PushTokenType=void 0,(v=exports.PushTokenType||(exports.PushTokenType={})).FCM="gcm",v.APNS="apns",v.UNKNOWN="unknown",exports.AuthTokenType=void 0,(y=exports.AuthTokenType||(exports.AuthTokenType={})).SESSION_TOKEN="session_token",y.ACCESS_TOKEN="access_token",exports.PushTemplate=void 0,(S=exports.PushTemplate||(exports.PushTemplate={})).ALTERNATIVE="alternative",S.DEFAULT="default",exports.CachedDataClearOrder=void 0,(C=exports.CachedDataClearOrder||(exports.CachedDataClearOrder={})).CUSTOM="custom",C.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at";class T{constructor({maxSize:e=256,clearOrder:t=exports.CachedDataClearOrder.MESSAGE_COLLECTION_ACCESSED_AT,customClearOrderComparator:s,enableAutoResend:i=!0}={}){this._clearOrderComparatorUseMessageCollectionAccessedAt=(e,t)=>e.channel.messageCollectionLastAccessedAt===t.channel.messageCollectionLastAccessedAt?e.channel.lastMessage&&!t.channel.lastMessage?1:!e.channel.lastMessage&&t.channel.lastMessage?-1:e.channel.lastMessage||t.channel.lastMessage?e.channel.lastMessage.createdAt-t.channel.lastMessage.createdAt:0:e.channel.messageCollectionLastAccessedAt>t.channel.messageCollectionLastAccessedAt?1:-1,this._maxSize=Math.max(e,64),s?(this._clearOrder=t,this._customClearOrderComparator=s):this._clearOrder=exports.CachedDataClearOrder.MESSAGE_COLLECTION_ACCESSED_AT,this._enableAutoResend=i}get maxSize(){return this._maxSize}get clearOrder(){return this._clearOrder}get clearOrderComparator(){var e;return this._clearOrder===exports.CachedDataClearOrder.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:null!==(e=this._customClearOrderComparator)&&void 0!==e?e:this._clearOrderComparatorUseMessageCollectionAccessedAt}get enableAutoResend(){return this._enableAutoResend}}var w;exports.SessionService=void 0,(w=exports.SessionService||(exports.SessionService={})).FEED="feed",w.CHAT="chat",w.CHAT_API="chat_api";class b{constructor(){this.isRefreshing=!1}get hasSession(){return!!this.sessionKey}get hasChatServicePermission(){var e;return!!(null===(e=this.services)||void 0===e?void 0:e.includes(exports.SessionService.CHAT))}clear(){this.authToken=void 0,this.sessionKey=void 0,this.services=[]}}const I=()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:3&s|8).toString(16)}))};class A{constructor({container:e}){this._container={},this._container=e,this.key=I()}_register(e,t,s){var i;return e in this._container||(this._container[e]=new Map),null===(i=this._container[e])||void 0===i||i.set(this.key,{occurence:t,handler:s}),this}on(e,t){return this._register(e,-1,t)}once(e,t){return this._register(e,1,t)}close(){Object.keys(this._container).forEach((e=>{var t;null===(t=this._container[e])||void 0===t||t.delete(this.key)}))}}class x{constructor(){this._container={}}on(e,t){return new A({container:this._container}).on(e,t)}once(e,t){return new A({container:this._container}).once(e,t)}dispatch(e,t){const s=this._container[e];if(s){const e=[];for(const i of s.keys()){const n=s.get(i);n.handler(t),n.occurence>0&&(n.occurence--,0===n.occurence&&e.push(i))}e.forEach((e=>s.delete(e)))}}}class k{constructor(){this._dispatcher=new x}on(e){return this._dispatcher.on("event",e)}once(e){return this._dispatcher.once("event",e)}dispatch(e){this._dispatcher.dispatch("event",e)}}class R{}const O=e=>{const t={};return e&&Object.keys(e).forEach((s=>{void 0===e[s]||Number.isNaN(e[s])||null===e[s]||(t[s]=e[s])})),t},N=e=>{if(null!=e){if("object"==typeof e){if(Array.isArray(e)){const t=[...e];for(let e=0;e<t.length;e++)t[e]=N(t[e]);return t}return Object.keys(e).forEach((t=>{null===e[t]&&delete e[t]})),e}return e}};var D,L,P,U,M,q,F,z,K,H,B,Q,$;exports.ChannelType=void 0,(D=exports.ChannelType||(exports.ChannelType={})).BASE="base",D.GROUP="group",D.OPEN="open",D.FEED="feed",exports.Role=void 0,(L=exports.Role||(exports.Role={})).OPERATOR="operator",L.NONE="none",exports.MutedState=void 0,(P=exports.MutedState||(exports.MutedState={})).MUTED="muted",P.UNMUTED="unmuted",exports.MessageType=void 0,(U=exports.MessageType||(exports.MessageType={})).BASE="base",U.USER="user",U.FILE="file",U.ADMIN="admin",exports.MessageTypeFilter=void 0,(M=exports.MessageTypeFilter||(exports.MessageTypeFilter={})).ALL="",M.USER="MESG",M.FILE="FILE",M.ADMIN="ADMM",exports.ServerSideMessageType=void 0,(q=exports.ServerSideMessageType||(exports.ServerSideMessageType={})).USER="MESG",q.FILE="FILE",q.ADMIN="ADMM",exports.MentionType=void 0,(F=exports.MentionType||(exports.MentionType={})).USERS="users",F.CHANNEL="channel",exports.ReplyType=void 0,(z=exports.ReplyType||(exports.ReplyType={})).ALL="all",z.NONE="none",z.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",exports.PushNotificationDeliveryOption=void 0,(K=exports.PushNotificationDeliveryOption||(exports.PushNotificationDeliveryOption={})).DEFAULT="default",K.SUPPRESS="suppress",exports.SendingStatus=void 0,(H=exports.SendingStatus||(exports.SendingStatus={})).PENDING="pending",H.SCHEDULED="scheduled",H.SUCCEEDED="succeeded",H.FAILED="failed",H.CANCELED="canceled",exports.MessageReviewStatus=void 0,(B=exports.MessageReviewStatus||(exports.MessageReviewStatus={})).INREVIEW="InReview",B.APPROVED="Approved",exports.NotificationPriority=void 0,(Q=exports.NotificationPriority||(exports.NotificationPriority={})).HIGH="high",Q.NORMAL="normal",Q.LOW="low",exports.MessageTemplateListOrder=void 0,($=exports.MessageTemplateListOrder||(exports.MessageTemplateListOrder={})).CREATED_AT="created_at",$.UPDATED_AT="updated_at";const W="v3",j=`/${W}/users`,G=`/${W}/sdk/users`,Z=`/${W}/storage/file`,V=`/${W}/group_channels`,Y=`/${W}/sdk/group_channels`,X=`/${W}/open_channels`,J=`/${W}/sdk/open_channels`,ee=`/${W}/search`,te=`/${W}/report`,se=`/${W}/emojis`,ie=`/${W}/emoji_categories`,ne=`/${W}/polls`,oe=`/${W}/scheduled_messages`,re=`/${W}/sdk/ui_kit/configuration`,ae=`/${W}/sdk/statistics`,de=`/${W}/sdk/notification_statistics`,ce=`/${W}/notifications`,le=`/${W}/notifications/users`,he=`/${W}/message_templates`,ue=`/${W}/sdk/push_delivery`,_e=`/${W}/forms`,pe=`/${W}/report_category`,fe=`/${W}/sdk/applications/settings`,ge=`/${W}/ai_agent`,Ee=`/${W}/ai_agent/group_channels`,me=e=>{switch(e){case exports.ChannelType.FEED:case exports.ChannelType.GROUP:return V;case exports.ChannelType.OPEN:return X;default:return null}},ve=(e,t,s)=>{switch(e){case exports.MentionType.CHANNEL:return!0;case exports.MentionType.USERS:if(t)for(const e of t)if(e===s)return!0}return!1},ye=(e,t,s)=>{var i;let n=t||new FormData;for(const t in e){if(!e.hasOwnProperty(t))continue;const o=e[t],r=s?`${s}[${t}]`:t;h(o)?n.append(r,o,null!==(i=o.name)&&void 0!==i?i:"filename"):"object"!=typeof o||null===o||Array.isArray(o)||o instanceof Blob?n.append(r,String(o)):n=ye(o,n,r)}return n};var Se;exports.APIRequestMethod=void 0,(Se=exports.APIRequestMethod||(exports.APIRequestMethod={})).GET="GET",Se.POST="POST",Se.PUT="PUT",Se.DELETE="DELETE";class Ce extends R{constructor(){super(...arguments),this.params={},this.requireAuth=!0,this.headers={},this.requestId=I()}encodeParams(e){return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((e=>this.encodeParams(e))).join(","):"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))}get query(){const e=O(this.params);return`?${Object.keys(e).map((t=>`${encodeURIComponent(t)}=${this.encodeParams(e[t])}`)).join("&")}`}get payload(){const e=O(this.params);return Object.keys(e).some((t=>h(e[t])))?ye(e):JSON.stringify(e)}get hasSessionKey(){return void 0!==this.headers["Session-Key"]}}class Te extends R{constructor(e,t){super(),this._iid=e,this._payload=t}get payload(){return Object.assign({},this._payload)}as(e){return new e(this._iid,this.payload)}}class we extends R{constructor(e){super(),this.requestId=e}}class be extends R{constructor({expires_in:e,reason:t=exports.SendbirdErrorCode.SESSION_KEY_EXPIRED,message:s=""}){switch(super(),this.expiresIn=null!=e?e:0,t){case exports.SendbirdErrorCode.SESSION_KEY_EXPIRED:case exports.SendbirdErrorCode.SESSION_TOKEN_EXPIRED:case exports.SendbirdErrorCode.SESSION_REVOKED:case exports.SendbirdErrorCode.USER_AUTH_DEACTIVATED:case exports.SendbirdErrorCode.USER_AUTH_DELETED_OR_NOT_FOUND:this.error=new o({code:t,message:s})}}get invalidateSessionToken(){var e;return!!(null===(e=this.error)||void 0===e?void 0:e.isSessionTokenExpiredError)}}class Ie extends R{constructor(e,t,s,i=""){var n;super(),this._iid=e,this.code=t,this.payload=s,this.requestId=null!==(n=s.req_id)&&void 0!==n?n:i}static createFromRawMessage(e,t){let s=t.substring(0,4),i={};try{i=JSON.parse(t.substring(4))}catch(e){s="NOOP"}finally{return new Ie(e,s,i)}}convertToMessage(){return`${this.code}${JSON.stringify(this.payload)}\n`}as(e){return new e(this._iid,this.code,this.payload)}}class Ae extends R{constructor({code:e,ackRequired:t,payload:s={}}){var i;super(),this.code=e,this.payload=s,this.requestId=null!==(i=this.payload.req_id)&&void 0!==i?i:I(),this.ackRequired=t,this.payload.req_id=this.requestId}convertToMessage(){return`${this.code}${JSON.stringify(this.payload)}\n`}}class xe extends Ce{constructor({userId:e,authToken:t,services:s,expiringSession:i=!0}){super(),this.path=`${j}/${e}/session_key`,this.method=exports.APIRequestMethod.POST,this.params=O({token:t,services:s,expiring_session:!!i}),this.requireAuth=!1}}class ke extends Ae{constructor({authToken:e,expiringSession:t=!0,requestId:s}){super({code:"LOGI",payload:O({token:e,expiring_session:t?1:0,req_id:s}),ackRequired:!0})}}class Re extends Te{constructor(e,t){super(e,t);const{key:s,expires_at:i,services:n}=t;this.key=s,this.expiresAt=i,this.services=n}}class Oe extends Ie{constructor(e,t,s){var i;super(e,"LOGI",s),this.error=null,this.newKey=null,this.newKey=null!==(i=s.new_key)&&void 0!==i?i:null,this.error=s.error?new o(s):null}}class Ne extends R{constructor(e){super(),this.statLog=e}}class De extends R{constructor({request:e,deferred:t,error:s=o.requestFailed}){super(),this.request=e,this.deferred=t,this.error=s}}var Le;exports.StatType=void 0,(Le=exports.StatType||(exports.StatType={})).FEATURE_LOCALCACHE="feature:local_cache",Le.FEATURE_LOCALCACHE_EVENT="feature:local_cache_event",Le.NOTIFICATION="noti:stats",Le.WEBSOCKET_CONNECT="ws:connect",Le.WEBSOCKET_DISCONNECT="ws:disconnect",Le.API_RESULT="api:result";class Pe{constructor({type:e,data:t,ts:s=Date.now()}){this.type=e,this.createdAt=s,this.data=t}static payloadify(e){return O({stat_type:e.type,ts:e.createdAt,data:O(e.data)})}}const Ue=()=>"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product,Me=()=>!("undefined"==typeof navigator||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent));var qe,Fe,ze,Ke;exports.SendbirdProduct=void 0,(Fe=exports.SendbirdProduct||(exports.SendbirdProduct={})).CHAT="chat",Fe.CALLS="calls",Fe.DESK="desk",Fe.LIVE="live",Fe.UIKIT_CHAT="uikit-chat",Fe.UIKIT_LIVE="uikit-live",Fe.AI_AGENT="ai-agent",exports.SendbirdPlatform=void 0,(ze=exports.SendbirdPlatform||(exports.SendbirdPlatform={})).ANDROID="android",ze.IOS="ios",ze.JS="js",ze.UNREAL="unreal",ze.UNITY="unity",ze.REACT_NATIVE="react-native",ze.FLUTTER="flutter",exports.DeviceOsPlatform=void 0,(Ke=exports.DeviceOsPlatform||(exports.DeviceOsPlatform={})).ANDROID="android",Ke.IOS="ios",Ke.WEB="web",Ke.MOBILE_WEB="mobile_web",Ke.WINDOWS="windows";class He{}qe=He,He._getFrameWork=()=>{if("undefined"!=typeof window){if(window.__REACT__)return"react";if(window.__VUE__)return"vue";const e=window.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(e&&e.getFiberRoots&&e.getFiberRoots(1).size>0)return"react";if(window.__NUXT__)return"vue(SSR)";if(window.__NEXT_DATA__||window.__NEXT_P||window.__NEXT_F)return"nextjs"}return""},He.sendbirdSdkUserAgentWithExtension=e=>{let t={main_sdk_info:`chat/${Ue()?exports.SendbirdPlatform.REACT_NATIVE:exports.SendbirdPlatform.JS}/${i.SDK_VERSION}`,device_os_platform:Me()?"mobile-web":"web",os_version:i.OS_VERSION};if(e){const{sendbirdExtensions:s,deviceOS:i,customData:n={}}=e;i.version&&(t.os_version=i.version),i.platform&&(t.device_os_platform=i.platform),s.length>0&&(t.extension_sdk_info=s.map((({product:e,platform:t,version:s})=>`${e}/${t}/${s}`)).join(",")),Object.keys(t).forEach((e=>delete n[e])),Object.keys(n).length>0&&(t=Object.assign(Object.assign({},t),n))}const s=qe._getFrameWork();return s&&(t.javascript_framework=s),Object.entries(t).map((([e,t])=>`${e}=${t}`)).join("&")},He.userAgentWithExtension=e=>{const t=Ue()?"reactnative":"JS",s=e.sb_syncmanager?`s${e.sb_syncmanager}`:"",n=e.sb_uikit?`u${e.sb_uikit}`:"",o=e["device-os-platform"]?`o${e["device-os-platform"]}`:Me()?"omobile-web":"oweb";return`${t}/c${i.SDK_VERSION}/${s}/${n}/${o}`};class Be{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=e=>{t(e)}}))}}class Qe extends R{constructor(e){super(),this.requestId=e.requestId}}class $e extends Ce{constructor(e){super(),this.method=exports.APIRequestMethod.DELETE,this.path=`${me(e.channelType)}/${e.channelUrl}/messages/${e.messageId}`,e.messageToken&&(this.params=O({mesg_token:e.messageToken}))}}class We{constructor(e,{session:t,sdkState:s,dispatcher:i,logger:n,useFetchCompat:o=!1}){this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=e,this._session=t,this._sdkState=s,this._dispatcher=i,this._dispatcher.on((e=>{e instanceof we&&this.cancel(e.requestId)})),this._logger=n,this._shouldImportFetchCompat=o}_createHeader(e,t){const{appId:s,appVersion:n,sendbirdRuntimeEnvironment:o}=this._sdkState,r=Object.assign(Object.assign({},e.headers),{SendBird:`JS,${i.OS_VERSION},${i.SDK_VERSION},${s}${n?`,${n}`:""}`,"SB-User-Agent":He.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":He.sendbirdSdkUserAgentWithExtension(o)});return t||(r["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&!e.hasSessionKey&&this._session.hasSession&&(r["Session-Key"]=this._session.sessionKey),r["App-Id"]=s,this._session&&this._session.authToken&&(r["Access-Token"]=this._session.authToken),r}_statLogApiResult(e,t,s){e.path.includes("/sdk/statistics")||this._dispatcher.dispatch(new Ne(new Pe({type:exports.StatType.API_RESULT,data:{endpoint:e.path,method:e.method,success:!s,latency:Date.now()-t,error_code:null==s?void 0:s.code,error_description:null==s?void 0:s.message}})))}_isBodyRequired(e){const{method:t}=e;return t!==exports.APIRequestMethod.GET&&(t!==exports.APIRequestMethod.DELETE||e instanceof $e)}send(t){return e(this,void 0,void 0,(function*(){const{path:e,method:s,uploadProgressHandler:i}=t,n=this._isBodyRequired(t),{api:r}=this._sdkState,a=`${r.host}${e}${n?"":t.query}`,d=n?t.payload:null,c=this._createHeader(t,d instanceof FormData?d:void 0),l=new AbortController,{signal:h}=l;this._abortControl.set(t.requestId,l);const u=Date.now();try{if(i){const{xmlHttpRequest:e}=yield Promise.resolve().then((function(){return require("./__bundle-5aa3b8d0.cjs")}));try{const s=yield e(this._iid,{requestId:t.requestId,method:t.method,url:a,headers:c,data:null!=d?d:void 0,uploadProgressHandler:i});return this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,u),s}catch(e){if(!(e instanceof o&&e.code===exports.SendbirdErrorCode.XMLHTTPREQUEST_NOT_SUPPORTED))throw e;this._logger.debug("XMLHttpRequest is not available in this environment. progressHandler is ignored.")}}if(this._shouldImportFetchCompat){this._shouldImportFetchCompat=!1;("undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global||{fetch:null}).fetch=null}"undefined"==typeof AbortController&&(yield Promise.resolve().then((function(){return require("./__bundle-093a1164.cjs")}))),"function"!=typeof fetch&&(yield Promise.resolve().then((function(){return require("./__bundle-38c66c0d.cjs")})));const e=yield fetch(a,{method:s,body:d,headers:c,signal:h}),n=yield e.json();if(e.ok||e.redirected)return this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,u),new Te(this._iid,n);if(n){const e=new o(n);if(e.isSessionExpiredError){if(this._dispatcher.dispatch(new be({reason:e.code,message:e.message})),!(t instanceof xe)){const s=new Be;return this._dispatcher.dispatch(new De({request:t,deferred:s,error:e})),s.promise}throw e}throw e.isSessionInvalidatedError?(this._dispatcher.dispatch(new be({reason:e.code,message:e.message})),e):e}throw o.requestFailed}catch(e){throw this._statLogApiResult(t,u,e),e instanceof o?(this._logger.debug("fail api request",e),e):"AbortError"===(null==e?void 0:e.name)?o.requestCanceled:(this._logger.debug("fail api request",e),o.networkError)}}))}cancel(e){if(this._abortControl.has(e)){this._abortControl.get(e).abort(),this._abortControl.delete(e)}this._dispatcher.dispatch(new Qe({requestId:e}))}cancelAll(){for(const e of this._abortControl.values())e.abort();this._abortControl.clear(),this._dispatcher.dispatch(new Qe({}))}}const je=()=>{};
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Ge(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ze=256,Ve=286,Ye=30,Xe=15,Je=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),et=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),tt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),st=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),it=new Array(576);Ge(it);const nt=new Array(60);Ge(nt);const ot=new Array(512);Ge(ot);const rt=new Array(256);Ge(rt);const at=new Array(29);Ge(at);const dt=new Array(Ye);function ct(e,t,s,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}let lt,ht,ut;function _t(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ge(dt);const pt=e=>e<256?ot[e]:ot[256+(e>>>7)],ft=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},gt=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,ft(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},Et=(e,t,s)=>{gt(e,s[2*t],s[2*t+1])},mt=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},vt=(e,t,s)=>{const i=new Array(16);let n,o,r=0;for(n=1;n<=Xe;n++)r=r+s[n-1]<<1,i[n]=r;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=mt(i[t]++,t))}},yt=e=>{let t;for(t=0;t<Ve;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Ye;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},St=e=>{e.bi_valid>8?ft(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ct=(e,t,s,i)=>{const n=2*t,o=2*s;return e[n]<e[o]||e[n]===e[o]&&i[t]<=i[s]},Tt=(e,t,s)=>{const i=e.heap[s];let n=s<<1;for(;n<=e.heap_len&&(n<e.heap_len&&Ct(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!Ct(t,i,e.heap[n],e.depth));)e.heap[s]=e.heap[n],s=n,n<<=1;e.heap[s]=i},wt=(e,t,s)=>{let i,n,o,r,a=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+a++],i+=(255&e.pending_buf[e.sym_buf+a++])<<8,n=e.pending_buf[e.sym_buf+a++],0===i?Et(e,n,t):(o=rt[n],Et(e,o+Ze+1,t),r=Je[o],0!==r&&(n-=at[o],gt(e,n,r)),i--,o=pt(i),Et(e,o,s),r=et[o],0!==r&&(i-=dt[o],gt(e,i,r)))}while(a<e.sym_next);Et(e,256,t)},bt=(e,t)=>{const s=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.elems;let r,a,d,c=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<o;r++)0!==s[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=c<2?++c:0,s[2*d]=1,e.depth[d]=0,e.opt_len--,n&&(e.static_len-=i[2*d+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)Tt(e,s,r);d=o;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Tt(e,s,1),a=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=a,s[2*d]=s[2*r]+s[2*a],e.depth[d]=(e.depth[r]>=e.depth[a]?e.depth[r]:e.depth[a])+1,s[2*r+1]=s[2*a+1]=d,e.heap[1]=d++,Tt(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,i=t.max_code,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,d=t.stat_desc.max_length;let c,l,h,u,_,p,f=0;for(u=0;u<=Xe;u++)e.bl_count[u]=0;for(s[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)l=e.heap[c],u=s[2*s[2*l+1]+1]+1,u>d&&(u=d,f++),s[2*l+1]=u,l>i||(e.bl_count[u]++,_=0,l>=a&&(_=r[l-a]),p=s[2*l],e.opt_len+=p*(u+_),o&&(e.static_len+=p*(n[2*l+1]+_)));if(0!==f){do{for(u=d-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[d]--,f-=2}while(f>0);for(u=d;0!==u;u--)for(l=e.bl_count[u];0!==l;)h=e.heap[--c],h>i||(s[2*h+1]!==u&&(e.opt_len+=(u-s[2*h+1])*s[2*h],s[2*h+1]=u),l--)}})(e,t),vt(s,c,e.bl_count)},It=(e,t,s)=>{let i,n,o=-1,r=t[1],a=0,d=7,c=4;for(0===r&&(d=138,c=3),t[2*(s+1)+1]=65535,i=0;i<=s;i++)n=r,r=t[2*(i+1)+1],++a<d&&n===r||(a<c?e.bl_tree[2*n]+=a:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=n,0===r?(d=138,c=3):n===r?(d=6,c=3):(d=7,c=4))},At=(e,t,s)=>{let i,n,o=-1,r=t[1],a=0,d=7,c=4;for(0===r&&(d=138,c=3),i=0;i<=s;i++)if(n=r,r=t[2*(i+1)+1],!(++a<d&&n===r)){if(a<c)do{Et(e,n,e.bl_tree)}while(0!=--a);else 0!==n?(n!==o&&(Et(e,n,e.bl_tree),a--),Et(e,16,e.bl_tree),gt(e,a-3,2)):a<=10?(Et(e,17,e.bl_tree),gt(e,a-3,3)):(Et(e,18,e.bl_tree),gt(e,a-11,7));a=0,o=n,0===r?(d=138,c=3):n===r?(d=6,c=3):(d=7,c=4)}};let xt=!1;const kt=(e,t,s,i)=>{gt(e,0+(i?1:0),3),St(e),ft(e,s),ft(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var Rt=(e,t,s,i)=>{let n,o,r=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Ze;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),bt(e,e.l_desc),bt(e,e.d_desc),r=(e=>{let t;for(It(e,e.dyn_ltree,e.l_desc.max_code),It(e,e.dyn_dtree,e.d_desc.max_code),bt(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*st[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=n&&(n=o)):n=o=s+5,s+4<=n&&-1!==t?kt(e,t,s,i):4===e.strategy||o===n?(gt(e,2+(i?1:0),3),wt(e,it,nt)):(gt(e,4+(i?1:0),3),((e,t,s,i)=>{let n;for(gt(e,t-257,5),gt(e,s-1,5),gt(e,i-4,4),n=0;n<i;n++)gt(e,e.bl_tree[2*st[n]+1],3);At(e,e.dyn_ltree,t-1),At(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),wt(e,e.dyn_ltree,e.dyn_dtree)),yt(e),i&&St(e)},Ot={_tr_init:e=>{xt||((()=>{let e,t,s,i,n;const o=new Array(16);for(s=0,i=0;i<28;i++)for(at[i]=s,e=0;e<1<<Je[i];e++)rt[s++]=i;for(rt[s-1]=i,n=0,i=0;i<16;i++)for(dt[i]=n,e=0;e<1<<et[i];e++)ot[n++]=i;for(n>>=7;i<Ye;i++)for(dt[i]=n<<7,e=0;e<1<<et[i]-7;e++)ot[256+n++]=i;for(t=0;t<=Xe;t++)o[t]=0;for(e=0;e<=143;)it[2*e+1]=8,e++,o[8]++;for(;e<=255;)it[2*e+1]=9,e++,o[9]++;for(;e<=279;)it[2*e+1]=7,e++,o[7]++;for(;e<=287;)it[2*e+1]=8,e++,o[8]++;for(vt(it,287,o),e=0;e<Ye;e++)nt[2*e+1]=5,nt[2*e]=mt(e,5);lt=new ct(it,Je,257,Ve,Xe),ht=new ct(nt,et,0,Ye,Xe),ut=new ct(new Array(0),tt,0,19,7)})(),xt=!0),e.l_desc=new _t(e.dyn_ltree,lt),e.d_desc=new _t(e.dyn_dtree,ht),e.bl_desc=new _t(e.bl_tree,ut),e.bi_buf=0,e.bi_valid=0,yt(e)},_tr_stored_block:kt,_tr_flush_block:Rt,_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(rt[s]+Ze+1)]++,e.dyn_dtree[2*pt(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{gt(e,2,3),Et(e,256,it),(e=>{16===e.bi_valid?(ft(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Nt=(e,t,s,i)=>{let n=65535&e,o=e>>>16&65535,r=0;for(;0!==s;){r=s>2e3?2e3:s,s-=r;do{n=n+t[i++]|0,o=o+n|0}while(--r);n%=65521,o%=65521}return n|o<<16};const Dt=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var Lt=(e,t,s,i)=>{const n=Dt,o=i+s;e^=-1;for(let s=i;s<o;s++)e=e>>>8^n[255&(e^t[s])];return~e},Pt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ut={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Mt,_tr_stored_block:qt,_tr_flush_block:Ft,_tr_tally:zt,_tr_align:Kt}=Ot,{Z_NO_FLUSH:Ht,Z_PARTIAL_FLUSH:Bt,Z_FULL_FLUSH:Qt,Z_FINISH:$t,Z_BLOCK:Wt,Z_OK:jt,Z_STREAM_END:Gt,Z_STREAM_ERROR:Zt,Z_DATA_ERROR:Vt,Z_BUF_ERROR:Yt,Z_DEFAULT_COMPRESSION:Xt,Z_FILTERED:Jt,Z_HUFFMAN_ONLY:es,Z_RLE:ts,Z_FIXED:ss,Z_DEFAULT_STRATEGY:is,Z_UNKNOWN:ns,Z_DEFLATED:os}=Ut,rs=258,as=262,ds=42,cs=113,ls=666,hs=(e,t)=>(e.msg=Pt[t],t),us=e=>2*e-(e>4?9:0),_s=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ps=e=>{let t,s,i,n=e.w_size;t=e.hash_size,i=t;do{s=e.head[--i],e.head[i]=s>=n?s-n:0}while(--t);t=n,i=t;do{s=e.prev[--i],e.prev[i]=s>=n?s-n:0}while(--t)};let fs=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const gs=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},Es=(e,t)=>{Ft(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,gs(e.strm)},ms=(e,t)=>{e.pending_buf[e.pending++]=t},vs=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ys=(e,t,s,i)=>{let n=e.avail_in;return n>i&&(n=i),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),s),1===e.state.wrap?e.adler=Nt(e.adler,t,n,s):2===e.state.wrap&&(e.adler=Lt(e.adler,t,n,s)),e.next_in+=n,e.total_in+=n,n)},Ss=(e,t)=>{let s,i,n=e.max_chain_length,o=e.strstart,r=e.prev_length,a=e.nice_match;const d=e.strstart>e.w_size-as?e.strstart-(e.w_size-as):0,c=e.window,l=e.w_mask,h=e.prev,u=e.strstart+rs;let _=c[o+r-1],p=c[o+r];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(s=t,c[s+r]===p&&c[s+r-1]===_&&c[s]===c[o]&&c[++s]===c[o+1]){o+=2,s++;do{}while(c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&o<u);if(i=rs-(u-o),o=u-rs,i>r){if(e.match_start=t,r=i,i>=a)break;_=c[o+r-1],p=c[o+r]}}}while((t=h[t&l])>d&&0!=--n);return r<=e.lookahead?r:e.lookahead},Cs=e=>{const t=e.w_size;let s,i,n;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-as)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ps(e),i+=t),0===e.strm.avail_in)break;if(s=ys(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=fs(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=fs(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<as&&0!==e.strm.avail_in)},Ts=(e,t)=>{let s,i,n,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r=0,a=e.strm.avail_in;do{if(s=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n)break;if(n=e.strm.avail_out-n,i=e.strstart-e.block_start,s>i+e.strm.avail_in&&(s=i+e.strm.avail_in),s>n&&(s=n),s<o&&(0===s&&t!==$t||t===Ht||s!==i+e.strm.avail_in))break;r=t===$t&&s===i+e.strm.avail_in?1:0,qt(e,0,0,r),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,gs(e.strm),i&&(i>s&&(i=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,s-=i),s&&(ys(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===r);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?4:t!==Ht&&t!==$t&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(ys(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,o=n>e.w_size?e.w_size:n,i=e.strstart-e.block_start,(i>=o||(i||t===$t)&&t!==Ht&&0===e.strm.avail_in&&i<=n)&&(s=i>n?n:i,r=t===$t&&0===e.strm.avail_in&&s===i?1:0,qt(e,e.block_start,s,r),e.block_start+=s,gs(e.strm)),r?3:1)},ws=(e,t)=>{let s,i;for(;;){if(e.lookahead<as){if(Cs(e),e.lookahead<as&&t===Ht)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=fs(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-as&&(e.match_length=Ss(e,s)),e.match_length>=3)if(i=zt(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=fs(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=fs(e,e.ins_h,e.window[e.strstart+1]);else i=zt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Es(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===$t?(Es(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Es(e,!1),0===e.strm.avail_out)?1:2},bs=(e,t)=>{let s,i,n;for(;;){if(e.lookahead<as){if(Cs(e),e.lookahead<as&&t===Ht)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=fs(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-as&&(e.match_length=Ss(e,s),e.match_length<=5&&(e.strategy===Jt||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,i=zt(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=fs(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Es(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=zt(e,0,e.window[e.strstart-1]),i&&Es(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=zt(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===$t?(Es(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Es(e,!1),0===e.strm.avail_out)?1:2};function Is(e,t,s,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=i,this.func=n}const As=[new Is(0,0,0,0,Ts),new Is(4,4,8,4,ws),new Is(4,5,16,8,ws),new Is(4,6,32,32,ws),new Is(4,4,16,16,bs),new Is(8,16,32,32,bs),new Is(8,16,128,128,bs),new Is(8,32,128,256,bs),new Is(32,128,258,1024,bs),new Is(32,258,258,4096,bs)];function xs(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=os,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),_s(this.dyn_ltree),_s(this.dyn_dtree),_s(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),_s(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),_s(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ks=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==ds&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==cs&&t.status!==ls?1:0},Rs=e=>{if(ks(e))return hs(e,Zt);e.total_in=e.total_out=0,e.data_type=ns;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?ds:cs,e.adler=2===t.wrap?0:1,t.last_flush=-2,Mt(t),jt},Os=e=>{const t=Rs(e);var s;return t===jt&&((s=e.state).window_size=2*s.w_size,_s(s.head),s.max_lazy_match=As[s.level].max_lazy,s.good_match=As[s.level].good_length,s.nice_match=As[s.level].nice_length,s.max_chain_length=As[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},Ns=(e,t,s,i,n,o)=>{if(!e)return Zt;let r=1;if(t===Xt&&(t=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),n<1||n>9||s!==os||i<8||i>15||t<0||t>9||o<0||o>ss||8===i&&1!==r)return hs(e,Zt);8===i&&(i=9);const a=new xs;return e.state=a,a.strm=e,a.status=ds,a.wrap=r,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=s,Os(e)};var Ds={deflateInit:(e,t)=>Ns(e,t,os,15,8,is),deflateInit2:Ns,deflateReset:Os,deflateResetKeep:Rs,deflateSetHeader:(e,t)=>ks(e)||2!==e.state.wrap?Zt:(e.state.gzhead=t,jt),deflate:(e,t)=>{if(ks(e)||t>Wt||t<0)return e?hs(e,Zt):Zt;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===ls&&t!==$t)return hs(e,0===e.avail_out?Yt:Zt);const i=s.last_flush;if(s.last_flush=t,0!==s.pending){if(gs(e),0===e.avail_out)return s.last_flush=-1,jt}else if(0===e.avail_in&&us(t)<=us(i)&&t!==$t)return hs(e,Yt);if(s.status===ls&&0!==e.avail_in)return hs(e,Yt);if(s.status===ds&&0===s.wrap&&(s.status=cs),s.status===ds){let t=os+(s.w_bits-8<<4)<<8,i=-1;if(i=s.strategy>=es||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=i<<6,0!==s.strstart&&(t|=32),t+=31-t%31,vs(s,t),0!==s.strstart&&(vs(s,e.adler>>>16),vs(s,65535&e.adler)),e.adler=1,s.status=cs,gs(e),0!==s.pending)return s.last_flush=-1,jt}if(57===s.status)if(e.adler=0,ms(s,31),ms(s,139),ms(s,8),s.gzhead)ms(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ms(s,255&s.gzhead.time),ms(s,s.gzhead.time>>8&255),ms(s,s.gzhead.time>>16&255),ms(s,s.gzhead.time>>24&255),ms(s,9===s.level?2:s.strategy>=es||s.level<2?4:0),ms(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ms(s,255&s.gzhead.extra.length),ms(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=Lt(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ms(s,0),ms(s,0),ms(s,0),ms(s,0),ms(s,0),ms(s,9===s.level?2:s.strategy>=es||s.level<2?4:0),ms(s,3),s.status=cs,gs(e),0!==s.pending)return s.last_flush=-1,jt;if(69===s.status){if(s.gzhead.extra){let t=s.pending,i=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+i>s.pending_buf_size;){let n=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=Lt(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=n,gs(e),0!==s.pending)return s.last_flush=-1,jt;t=0,i-=n}let n=new Uint8Array(s.gzhead.extra);s.pending_buf.set(n.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending+=i,s.gzhead.hcrc&&s.pending>t&&(e.adler=Lt(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=Lt(e.adler,s.pending_buf,s.pending-i,i)),gs(e),0!==s.pending)return s.last_flush=-1,jt;i=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ms(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=Lt(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=Lt(e.adler,s.pending_buf,s.pending-i,i)),gs(e),0!==s.pending)return s.last_flush=-1,jt;i=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ms(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=Lt(e.adler,s.pending_buf,s.pending-i,i))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(gs(e),0!==s.pending))return s.last_flush=-1,jt;ms(s,255&e.adler),ms(s,e.adler>>8&255),e.adler=0}if(s.status=cs,gs(e),0!==s.pending)return s.last_flush=-1,jt}if(0!==e.avail_in||0!==s.lookahead||t!==Ht&&s.status!==ls){let i=0===s.level?Ts(s,t):s.strategy===es?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(Cs(e),0===e.lookahead)){if(t===Ht)return 1;break}if(e.match_length=0,s=zt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(Es(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$t?(Es(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Es(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===ts?((e,t)=>{let s,i,n,o;const r=e.window;for(;;){if(e.lookahead<=rs){if(Cs(e),e.lookahead<=rs&&t===Ht)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,i=r[n],i===r[++n]&&i===r[++n]&&i===r[++n])){o=e.strstart+rs;do{}while(i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&n<o);e.match_length=rs-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=zt(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=zt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(Es(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$t?(Es(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Es(e,!1),0===e.strm.avail_out)?1:2})(s,t):As[s.level].func(s,t);if(3!==i&&4!==i||(s.status=ls),1===i||3===i)return 0===e.avail_out&&(s.last_flush=-1),jt;if(2===i&&(t===Bt?Kt(s):t!==Wt&&(qt(s,0,0,!1),t===Qt&&(_s(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),gs(e),0===e.avail_out))return s.last_flush=-1,jt}return t!==$t?jt:s.wrap<=0?Gt:(2===s.wrap?(ms(s,255&e.adler),ms(s,e.adler>>8&255),ms(s,e.adler>>16&255),ms(s,e.adler>>24&255),ms(s,255&e.total_in),ms(s,e.total_in>>8&255),ms(s,e.total_in>>16&255),ms(s,e.total_in>>24&255)):(vs(s,e.adler>>>16),vs(s,65535&e.adler)),gs(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?jt:Gt)},deflateEnd:e=>{if(ks(e))return Zt;const t=e.state.status;return e.state=null,t===cs?hs(e,Vt):jt},deflateSetDictionary:(e,t)=>{let s=t.length;if(ks(e))return Zt;const i=e.state,n=i.wrap;if(2===n||1===n&&i.status!==ds||i.lookahead)return Zt;if(1===n&&(e.adler=Nt(e.adler,t,s,0)),i.wrap=0,s>=i.w_size){0===n&&(_s(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(s-i.w_size,s),0),t=e,s=i.w_size}const o=e.avail_in,r=e.next_in,a=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Cs(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=fs(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,Cs(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=r,e.input=a,e.avail_in=o,i.wrap=n,jt},deflateInfo:"pako deflate (from Nodeca project)"};const Ls=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ps=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)Ls(s,t)&&(e[t]=s[t])}}return e},Us=e=>{let t=0;for(let s=0,i=e.length;s<i;s++)t+=e[s].length;const s=new Uint8Array(t);for(let t=0,i=0,n=e.length;t<n;t++){let n=e[t];s.set(n,i),i+=n.length}return s};let Ms=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ms=!1}const qs=new Uint8Array(256);for(let e=0;e<256;e++)qs[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;qs[254]=qs[254]=1;var Fs=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,i,n,o,r=e.length,a=0;for(n=0;n<r;n++)s=e.charCodeAt(n),55296==(64512&s)&&n+1<r&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),n++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(a),o=0,n=0;o<a;n++)s=e.charCodeAt(n),55296==(64512&s)&&n+1<r&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),n++)),s<128?t[o++]=s:s<2048?(t[o++]=192|s>>>6,t[o++]=128|63&s):s<65536?(t[o++]=224|s>>>12,t[o++]=128|s>>>6&63,t[o++]=128|63&s):(t[o++]=240|s>>>18,t[o++]=128|s>>>12&63,t[o++]=128|s>>>6&63,t[o++]=128|63&s);return t},zs=(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,n;const o=new Array(2*s);for(n=0,i=0;i<s;){let t=e[i++];if(t<128){o[n++]=t;continue}let r=qs[t];if(r>4)o[n++]=65533,i+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&i<s;)t=t<<6|63&e[i++],r--;r>1?o[n++]=65533:t<65536?o[n++]=t:(t-=65536,o[n++]=55296|t>>10&1023,o[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ms)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(e[i]);return s})(o,n)},Ks=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+qs[e[s]]>t?s:t};var Hs=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Bs=Object.prototype.toString,{Z_NO_FLUSH:Qs,Z_SYNC_FLUSH:$s,Z_FULL_FLUSH:Ws,Z_FINISH:js,Z_OK:Gs,Z_STREAM_END:Zs,Z_DEFAULT_COMPRESSION:Vs,Z_DEFAULT_STRATEGY:Ys,Z_DEFLATED:Xs}=Ut;function Js(e){this.options=Ps({level:Vs,method:Xs,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ys},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hs,this.strm.avail_out=0;let s=Ds.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==Gs)throw new Error(Pt[s]);if(t.header&&Ds.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Fs(t.dictionary):"[object ArrayBuffer]"===Bs.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=Ds.deflateSetDictionary(this.strm,e),s!==Gs)throw new Error(Pt[s]);this._dict_set=!0}}function ei(e,t){const s=new Js(t);if(s.push(e,!0),s.err)throw s.msg||Pt[s.err];return s.result}Js.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize;let n,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?js:Qs,"string"==typeof e?s.input=Fs(e):"[object ArrayBuffer]"===Bs.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),(o===$s||o===Ws)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(n=Ds.deflate(s,o),n===Zs)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),n=Ds.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Gs;if(0!==s.avail_out){if(o>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},Js.prototype.onData=function(e){this.chunks.push(e)},Js.prototype.onEnd=function(e){e===Gs&&(this.result=Us(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ti={Deflate:Js,deflate:ei,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ei(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ei(e,t)},constants:Ut};const si=16209;var ii=function(e,t){let s,i,n,o,r,a,d,c,l,h,u,_,p,f,g,E,m,v,y,S,C,T,w,b;const I=e.state;s=e.next_in,w=e.input,i=s+(e.avail_in-5),n=e.next_out,b=e.output,o=n-(t-e.avail_out),r=n+(e.avail_out-257),a=I.dmax,d=I.wsize,c=I.whave,l=I.wnext,h=I.window,u=I.hold,_=I.bits,p=I.lencode,f=I.distcode,g=(1<<I.lenbits)-1,E=(1<<I.distbits)-1;e:do{_<15&&(u+=w[s++]<<_,_+=8,u+=w[s++]<<_,_+=8),m=p[u&g];t:for(;;){if(v=m>>>24,u>>>=v,_-=v,v=m>>>16&255,0===v)b[n++]=65535&m;else{if(!(16&v)){if(64&v){if(32&v){I.mode=16191;break e}e.msg="invalid literal/length code",I.mode=si;break e}m=p[(65535&m)+(u&(1<<v)-1)];continue t}for(y=65535&m,v&=15,v&&(_<v&&(u+=w[s++]<<_,_+=8),y+=u&(1<<v)-1,u>>>=v,_-=v),_<15&&(u+=w[s++]<<_,_+=8,u+=w[s++]<<_,_+=8),m=f[u&E];;){if(v=m>>>24,u>>>=v,_-=v,v=m>>>16&255,16&v){if(S=65535&m,v&=15,_<v&&(u+=w[s++]<<_,_+=8,_<v&&(u+=w[s++]<<_,_+=8)),S+=u&(1<<v)-1,S>a){e.msg="invalid distance too far back",I.mode=si;break e}if(u>>>=v,_-=v,v=n-o,S>v){if(v=S-v,v>c&&I.sane){e.msg="invalid distance too far back",I.mode=si;break e}if(C=0,T=h,0===l){if(C+=d-v,v<y){y-=v;do{b[n++]=h[C++]}while(--v);C=n-S,T=b}}else if(l<v){if(C+=d+l-v,v-=l,v<y){y-=v;do{b[n++]=h[C++]}while(--v);if(C=0,l<y){v=l,y-=v;do{b[n++]=h[C++]}while(--v);C=n-S,T=b}}}else if(C+=l-v,v<y){y-=v;do{b[n++]=h[C++]}while(--v);C=n-S,T=b}for(;y>2;)b[n++]=T[C++],b[n++]=T[C++],b[n++]=T[C++],y-=3;y&&(b[n++]=T[C++],y>1&&(b[n++]=T[C++]))}else{C=n-S;do{b[n++]=b[C++],b[n++]=b[C++],b[n++]=b[C++],y-=3}while(y>2);y&&(b[n++]=b[C++],y>1&&(b[n++]=b[C++]))}break}if(64&v){e.msg="invalid distance code",I.mode=si;break e}m=f[(65535&m)+(u&(1<<v)-1)]}}break}}while(s<i&&n<r);y=_>>3,s-=y,_-=y<<3,u&=(1<<_)-1,e.next_in=s,e.next_out=n,e.avail_in=s<i?i-s+5:5-(s-i),e.avail_out=n<r?r-n+257:257-(n-r),I.hold=u,I.bits=_};const ni=15,oi=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ri=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ai=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),di=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ci=(e,t,s,i,n,o,r,a)=>{const d=a.bits;let c,l,h,u,_,p,f=0,g=0,E=0,m=0,v=0,y=0,S=0,C=0,T=0,w=0,b=null;const I=new Uint16Array(16),A=new Uint16Array(16);let x,k,R,O=null;for(f=0;f<=ni;f++)I[f]=0;for(g=0;g<i;g++)I[t[s+g]]++;for(v=d,m=ni;m>=1&&0===I[m];m--);if(v>m&&(v=m),0===m)return n[o++]=20971520,n[o++]=20971520,a.bits=1,0;for(E=1;E<m&&0===I[E];E++);for(v<E&&(v=E),C=1,f=1;f<=ni;f++)if(C<<=1,C-=I[f],C<0)return-1;if(C>0&&(0===e||1!==m))return-1;for(A[1]=0,f=1;f<ni;f++)A[f+1]=A[f]+I[f];for(g=0;g<i;g++)0!==t[s+g]&&(r[A[t[s+g]]++]=g);if(0===e?(b=O=r,p=20):1===e?(b=oi,O=ri,p=257):(b=ai,O=di,p=0),w=0,g=0,f=E,_=o,y=v,S=0,h=-1,T=1<<v,u=T-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){x=f-S,r[g]+1<p?(k=0,R=r[g]):r[g]>=p?(k=O[r[g]-p],R=b[r[g]-p]):(k=96,R=0),c=1<<f-S,l=1<<y,E=l;do{l-=c,n[_+(w>>S)+l]=x<<24|k<<16|R}while(0!==l);for(c=1<<f-1;w&c;)c>>=1;if(0!==c?(w&=c-1,w+=c):w=0,g++,0==--I[f]){if(f===m)break;f=t[s+r[g]]}if(f>v&&(w&u)!==h){for(0===S&&(S=v),_+=E,y=f-S,C=1<<y;y+S<m&&(C-=I[y+S],!(C<=0));)y++,C<<=1;if(T+=1<<y,1===e&&T>852||2===e&&T>592)return 1;h=w&u,n[h]=v<<24|y<<16|_-o}}return 0!==w&&(n[_+w]=f-S<<24|64<<16),a.bits=v,0};const{Z_FINISH:li,Z_BLOCK:hi,Z_TREES:ui,Z_OK:_i,Z_STREAM_END:pi,Z_NEED_DICT:fi,Z_STREAM_ERROR:gi,Z_DATA_ERROR:Ei,Z_MEM_ERROR:mi,Z_BUF_ERROR:vi,Z_DEFLATED:yi}=Ut,Si=16180,Ci=16190,Ti=16191,wi=16192,bi=16194,Ii=16199,Ai=16200,xi=16206,ki=16209,Ri=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Oi(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ni=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Si||t.mode>16211?1:0},Di=e=>{if(Ni(e))return gi;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Si,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,_i},Li=e=>{if(Ni(e))return gi;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Di(e)},Pi=(e,t)=>{let s;if(Ni(e))return gi;const i=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?gi:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=s,i.wbits=t,Li(e))},Ui=(e,t)=>{if(!e)return gi;const s=new Oi;e.state=s,s.strm=e,s.window=null,s.mode=Si;const i=Pi(e,t);return i!==_i&&(e.state=null),i};let Mi,qi,Fi=!0;const zi=e=>{if(Fi){Mi=new Int32Array(512),qi=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ci(1,e.lens,0,288,Mi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ci(2,e.lens,0,32,qi,0,e.work,{bits:5}),Fi=!1}e.lencode=Mi,e.lenbits=9,e.distcode=qi,e.distbits=5},Ki=(e,t,s,i)=>{let n;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(s-o.wsize,s),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>i&&(n=i),o.window.set(t.subarray(s-i,s-i+n),o.wnext),(i-=n)?(o.window.set(t.subarray(s-i,s),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0};var Hi={inflateReset:Li,inflateReset2:Pi,inflateResetKeep:Di,inflateInit:e=>Ui(e,15),inflateInit2:Ui,inflate:(e,t)=>{let s,i,n,o,r,a,d,c,l,h,u,_,p,f,g,E,m,v,y,S,C,T,w=0;const b=new Uint8Array(4);let I,A;const x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ni(e)||!e.output||!e.input&&0!==e.avail_in)return gi;s=e.state,s.mode===Ti&&(s.mode=wi),r=e.next_out,n=e.output,d=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,c=s.hold,l=s.bits,h=a,u=d,T=_i;e:for(;;)switch(s.mode){case Si:if(0===s.wrap){s.mode=wi;break}for(;l<16;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,b[0]=255&c,b[1]=c>>>8&255,s.check=Lt(s.check,b,2,0),c=0,l=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",s.mode=ki;break}if((15&c)!==yi){e.msg="unknown compression method",s.mode=ki;break}if(c>>>=4,l-=4,C=8+(15&c),0===s.wbits&&(s.wbits=C),C>15||C>s.wbits){e.msg="invalid window size",s.mode=ki;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&c?16189:Ti,c=0,l=0;break;case 16181:for(;l<16;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(s.flags=c,(255&s.flags)!==yi){e.msg="unknown compression method",s.mode=ki;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=ki;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(b[0]=255&c,b[1]=c>>>8&255,s.check=Lt(s.check,b,2,0)),c=0,l=0,s.mode=16182;case 16182:for(;l<32;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(b[0]=255&c,b[1]=c>>>8&255,b[2]=c>>>16&255,b[3]=c>>>24&255,s.check=Lt(s.check,b,4,0)),c=0,l=0,s.mode=16183;case 16183:for(;l<16;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(b[0]=255&c,b[1]=c>>>8&255,s.check=Lt(s.check,b,2,0)),c=0,l=0,s.mode=16184;case 16184:if(1024&s.flags){for(;l<16;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(b[0]=255&c,b[1]=c>>>8&255,s.check=Lt(s.check,b,2,0)),c=0,l=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(_=s.length,_>a&&(_=a),_&&(s.head&&(C=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(i.subarray(o,o+_),C)),512&s.flags&&4&s.wrap&&(s.check=Lt(s.check,i,_,o)),a-=_,o+=_,s.length-=_),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===a)break e;_=0;do{C=i[o+_++],s.head&&C&&s.length<65536&&(s.head.name+=String.fromCharCode(C))}while(C&&_<a);if(512&s.flags&&4&s.wrap&&(s.check=Lt(s.check,i,_,o)),a-=_,o+=_,C)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===a)break e;_=0;do{C=i[o+_++],s.head&&C&&s.length<65536&&(s.head.comment+=String.fromCharCode(C))}while(C&&_<a);if(512&s.flags&&4&s.wrap&&(s.check=Lt(s.check,i,_,o)),a-=_,o+=_,C)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;l<16;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(4&s.wrap&&c!==(65535&s.check)){e.msg="header crc mismatch",s.mode=ki;break}c=0,l=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=Ti;break;case 16189:for(;l<32;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}e.adler=s.check=Ri(c),c=0,l=0,s.mode=Ci;case Ci:if(0===s.havedict)return e.next_out=r,e.avail_out=d,e.next_in=o,e.avail_in=a,s.hold=c,s.bits=l,fi;e.adler=s.check=1,s.mode=Ti;case Ti:if(t===hi||t===ui)break e;case wi:if(s.last){c>>>=7&l,l-=7&l,s.mode=xi;break}for(;l<3;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}switch(s.last=1&c,c>>>=1,l-=1,3&c){case 0:s.mode=16193;break;case 1:if(zi(s),s.mode=Ii,t===ui){c>>>=2,l-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=ki}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",s.mode=ki;break}if(s.length=65535&c,c=0,l=0,s.mode=bi,t===ui)break e;case bi:s.mode=16195;case 16195:if(_=s.length,_){if(_>a&&(_=a),_>d&&(_=d),0===_)break e;n.set(i.subarray(o,o+_),r),a-=_,o+=_,d-=_,r+=_,s.length-=_;break}s.mode=Ti;break;case 16196:for(;l<14;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(s.nlen=257+(31&c),c>>>=5,l-=5,s.ndist=1+(31&c),c>>>=5,l-=5,s.ncode=4+(15&c),c>>>=4,l-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=ki;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;l<3;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}s.lens[x[s.have++]]=7&c,c>>>=3,l-=3}for(;s.have<19;)s.lens[x[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,I={bits:s.lenbits},T=ci(0,s.lens,0,19,s.lencode,0,s.work,I),s.lenbits=I.bits,T){e.msg="invalid code lengths set",s.mode=ki;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;w=s.lencode[c&(1<<s.lenbits)-1],g=w>>>24,E=w>>>16&255,m=65535&w,!(g<=l);){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(m<16)c>>>=g,l-=g,s.lens[s.have++]=m;else{if(16===m){for(A=g+2;l<A;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(c>>>=g,l-=g,0===s.have){e.msg="invalid bit length repeat",s.mode=ki;break}C=s.lens[s.have-1],_=3+(3&c),c>>>=2,l-=2}else if(17===m){for(A=g+3;l<A;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}c>>>=g,l-=g,C=0,_=3+(7&c),c>>>=3,l-=3}else{for(A=g+7;l<A;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}c>>>=g,l-=g,C=0,_=11+(127&c),c>>>=7,l-=7}if(s.have+_>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=ki;break}for(;_--;)s.lens[s.have++]=C}}if(s.mode===ki)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=ki;break}if(s.lenbits=9,I={bits:s.lenbits},T=ci(1,s.lens,0,s.nlen,s.lencode,0,s.work,I),s.lenbits=I.bits,T){e.msg="invalid literal/lengths set",s.mode=ki;break}if(s.distbits=6,s.distcode=s.distdyn,I={bits:s.distbits},T=ci(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,I),s.distbits=I.bits,T){e.msg="invalid distances set",s.mode=ki;break}if(s.mode=Ii,t===ui)break e;case Ii:s.mode=Ai;case Ai:if(a>=6&&d>=258){e.next_out=r,e.avail_out=d,e.next_in=o,e.avail_in=a,s.hold=c,s.bits=l,ii(e,u),r=e.next_out,n=e.output,d=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,c=s.hold,l=s.bits,s.mode===Ti&&(s.back=-1);break}for(s.back=0;w=s.lencode[c&(1<<s.lenbits)-1],g=w>>>24,E=w>>>16&255,m=65535&w,!(g<=l);){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(E&&!(240&E)){for(v=g,y=E,S=m;w=s.lencode[S+((c&(1<<v+y)-1)>>v)],g=w>>>24,E=w>>>16&255,m=65535&w,!(v+g<=l);){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}c>>>=v,l-=v,s.back+=v}if(c>>>=g,l-=g,s.back+=g,s.length=m,0===E){s.mode=16205;break}if(32&E){s.back=-1,s.mode=Ti;break}if(64&E){e.msg="invalid literal/length code",s.mode=ki;break}s.extra=15&E,s.mode=16201;case 16201:if(s.extra){for(A=s.extra;l<A;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,l-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;w=s.distcode[c&(1<<s.distbits)-1],g=w>>>24,E=w>>>16&255,m=65535&w,!(g<=l);){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(!(240&E)){for(v=g,y=E,S=m;w=s.distcode[S+((c&(1<<v+y)-1)>>v)],g=w>>>24,E=w>>>16&255,m=65535&w,!(v+g<=l);){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}c>>>=v,l-=v,s.back+=v}if(c>>>=g,l-=g,s.back+=g,64&E){e.msg="invalid distance code",s.mode=ki;break}s.offset=m,s.extra=15&E,s.mode=16203;case 16203:if(s.extra){for(A=s.extra;l<A;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,l-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=ki;break}s.mode=16204;case 16204:if(0===d)break e;if(_=u-d,s.offset>_){if(_=s.offset-_,_>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=ki;break}_>s.wnext?(_-=s.wnext,p=s.wsize-_):p=s.wnext-_,_>s.length&&(_=s.length),f=s.window}else f=n,p=r-s.offset,_=s.length;_>d&&(_=d),d-=_,s.length-=_;do{n[r++]=f[p++]}while(--_);0===s.length&&(s.mode=Ai);break;case 16205:if(0===d)break e;n[r++]=s.length,d--,s.mode=Ai;break;case xi:if(s.wrap){for(;l<32;){if(0===a)break e;a--,c|=i[o++]<<l,l+=8}if(u-=d,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?Lt(s.check,n,u,r-u):Nt(s.check,n,u,r-u)),u=d,4&s.wrap&&(s.flags?c:Ri(c))!==s.check){e.msg="incorrect data check",s.mode=ki;break}c=0,l=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;l<32;){if(0===a)break e;a--,c+=i[o++]<<l,l+=8}if(4&s.wrap&&c!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=ki;break}c=0,l=0}s.mode=16208;case 16208:T=pi;break e;case ki:T=Ei;break e;case 16210:return mi;default:return gi}return e.next_out=r,e.avail_out=d,e.next_in=o,e.avail_in=a,s.hold=c,s.bits=l,(s.wsize||u!==e.avail_out&&s.mode<ki&&(s.mode<xi||t!==li))&&Ki(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?Lt(s.check,n,u,e.next_out-u):Nt(s.check,n,u,e.next_out-u)),e.data_type=s.bits+(s.last?64:0)+(s.mode===Ti?128:0)+(s.mode===Ii||s.mode===bi?256:0),(0===h&&0===u||t===li)&&T===_i&&(T=vi),T},inflateEnd:e=>{if(Ni(e))return gi;let t=e.state;return t.window&&(t.window=null),e.state=null,_i},inflateGetHeader:(e,t)=>{if(Ni(e))return gi;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,_i):gi},inflateSetDictionary:(e,t)=>{const s=t.length;let i,n,o;return Ni(e)?gi:(i=e.state,0!==i.wrap&&i.mode!==Ci?gi:i.mode===Ci&&(n=1,n=Nt(n,t,s,0),n!==i.check)?Ei:(o=Ki(e,t,s,s),o?(i.mode=16210,mi):(i.havedict=1,_i)))},inflateInfo:"pako inflate (from Nodeca project)"};var Bi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Qi=Object.prototype.toString,{Z_NO_FLUSH:$i,Z_FINISH:Wi,Z_OK:ji,Z_STREAM_END:Gi,Z_NEED_DICT:Zi,Z_STREAM_ERROR:Vi,Z_DATA_ERROR:Yi,Z_MEM_ERROR:Xi}=Ut;function Ji(e){this.options=Ps({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hs,this.strm.avail_out=0;let s=Hi.inflateInit2(this.strm,t.windowBits);if(s!==ji)throw new Error(Pt[s]);if(this.header=new Bi,Hi.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Fs(t.dictionary):"[object ArrayBuffer]"===Qi.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=Hi.inflateSetDictionary(this.strm,t.dictionary),s!==ji)))throw new Error(Pt[s])}function en(e,t){const s=new Ji(t);if(s.push(e),s.err)throw s.msg||Pt[s.err];return s.result}Ji.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let o,r,a;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Wi:$i,"[object ArrayBuffer]"===Qi.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),o=Hi.inflate(s,r),o===Zi&&n&&(o=Hi.inflateSetDictionary(s,n),o===ji?o=Hi.inflate(s,r):o===Yi&&(o=Zi));s.avail_in>0&&o===Gi&&s.state.wrap>0&&0!==e[s.next_in];)Hi.inflateReset(s),o=Hi.inflate(s,r);switch(o){case Vi:case Yi:case Zi:case Xi:return this.onEnd(o),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||o===Gi))if("string"===this.options.to){let e=Ks(s.output,s.next_out),t=s.next_out-e,n=zs(s.output,e);s.next_out=t,s.avail_out=i-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(n)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(o!==ji||0!==a){if(o===Gi)return o=Hi.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Ji.prototype.onData=function(e){this.chunks.push(e)},Ji.prototype.onEnd=function(e){e===ji&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Us(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var tn={Inflate:Ji,inflate:en,inflateRaw:function(e,t){return(t=t||{}).raw=!0,en(e,t)},ungzip:en,constants:Ut};const{Deflate:sn,deflate:nn,deflateRaw:on,gzip:rn}=ti,{Inflate:an,inflate:dn,inflateRaw:cn,ungzip:ln}=tn;var hn={Deflate:sn,deflate:nn,deflateRaw:on,gzip:rn,Inflate:an,inflate:dn,inflateRaw:cn,ungzip:ln,constants:Ut};const un=t=>e(void 0,void 0,void 0,(function*(){const e=hn.ungzip(t);if("undefined"!=typeof TextDecoder)try{return new TextDecoder("utf-8").decode(new Uint8Array(e))}catch(e){}const s=8192;return Array.from({length:Math.ceil(e.length/s)},((t,i)=>{const n=i*s,o=e.slice(n,n+s);return String.fromCharCode.apply(null,o)})).join("")})),_n=t=>e(void 0,void 0,void 0,(function*(){try{yield t()}catch(e){if(!(e instanceof o))throw e;e.throwOutside()}})),pn=t=>e(void 0,void 0,void 0,(function*(){try{yield t()}catch(e){}}));var fn,gn;exports.ConnectionState=void 0,(fn=exports.ConnectionState||(exports.ConnectionState={})).CONNECTING="CONNECTING",fn.OPEN="OPEN",fn.CLOSED="CLOSED";class En extends x{constructor(e,{sdkState:t,dispatcher:s,logger:i}){super(),this.lastActive=0,this._iid=e,this._sdkState=t,this._dispatcher=s,this._logger=i}get isOpen(){return this.connectionState===exports.ConnectionState.OPEN}get connectionState(){if(this._ws)switch(this._ws.readyState){case 0:return exports.ConnectionState.CONNECTING;case 1:return exports.ConnectionState.OPEN}return exports.ConnectionState.CLOSED}get ws(){var e;return null!==(e=this._ws)&&void 0!==e?e:null}_handleMessage(e){e.split("\n").forEach((e=>{if(e){const t=Ie.createFromRawMessage(this._iid,e);if(this._logger.debug("receive websocket event",t),"LOGI"===t.code)this.dispatch("message",t);else if("PONG"===t.code)this.dispatch("pong");else if("EXPR"===t.code){if(t.payload){const e=new be(t.payload);e.expiresIn>=0&&this._dispatcher.dispatch(e)}}else"NOOP"===t.code||this.dispatch("message",t)}}))}connect(t,s=""){return e(this,void 0,void 0,(function*(){"function"!=typeof fetch&&(yield Promise.resolve().then((function(){return require("./__bundle-38c66c0d.cjs")}))),pn((()=>e(this,void 0,void 0,(function*(){fetch(this._sdkState.api.host)})))),this._ws=new WebSocket(t,encodeURIComponent(s)),this._ws.onopen=()=>{this._logger.debug("websocket open"),this.dispatch("open")},this._ws.onmessage=t=>e(this,void 0,void 0,(function*(){var s;if(null===(s=this._sdkState.websocket)||void 0===s?void 0:s.compression)if(t.data instanceof Blob){const s=new FileReader;s.readAsArrayBuffer(t.data),s.onloadend=()=>e(this,void 0,void 0,(function*(){try{const e=yield un(s.result);this._handleMessage(e)}catch(e){this.error(e)}}))}else if(t.data instanceof ArrayBuffer)try{const e=yield un(new Uint8Array(t.data));this._handleMessage(e)}catch(e){this.error(e)}else if("undefined"!=typeof Buffer&&t.data instanceof Buffer)try{const e=t.data,s=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),i=yield un(s);this._handleMessage(i)}catch(e){this.error(e)}else"string"==typeof t.data&&this._handleMessage(t.data);else this._handleMessage(t.data)})),this._ws.onerror=()=>{this._logger.debug("websocket error"),this.dispatch("error",o.networkError)},this._ws.onclose=e=>{this._logger.debug("websocket close",e.code,e.reason),this.cleanUpWebSocket(),this.dispatch("close")},this.lastActive=Date.now()}))}cleanUpWebSocket(){this._ws&&(this._ws.onopen=je,this._ws.onmessage=je,this._ws.onerror=je,this._ws.onclose=je,this.connectionState===exports.ConnectionState.OPEN&&this._ws.close(1e3,"Normal Closure"),this._ws=void 0)}disconnect(){return new Promise((e=>{if(this._ws){if(this.connectionState===exports.ConnectionState.CLOSED)return this.cleanUpWebSocket(),void e();this._ws.onclose=null,this._ws.onclose=()=>{this.cleanUpWebSocket(),this.dispatch("close"),e()},this._ws.close()}else e()}))}send(e){if(!this._ws)throw o.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())}error(e){this._logger.debug("websocket error",e),this.dispatch("error",e)}}class mn extends R{constructor({all:e,feed:t,custom_types:s,ts:i}){super(),this.all=e,this.feed=t,this.customTypes=s,this.ts=i}}class vn{constructor(e,{session:t,sdkState:s,dispatcher:i,logger:n,useFetchCompat:r=!1}){this._ackStateMap=new Map,this._batchableCommandAckStateMap=new Map,this._redundantActionCommands=new Map,this._sdkState=s,this._dispatcher=i,this._logger=n,this.apiClient=new We(e,{session:t,sdkState:s,dispatcher:i,logger:n,useFetchCompat:r}),this.websocketClient=new En(e,{sdkState:s,dispatcher:i,logger:n}),this.websocketClient.on("message",(e=>{if(e.payload.unread_cnt&&this._dispatcher.dispatch(new mn(e.payload.unread_cnt)),e.requestId){if(this._ackStateMap.has(e.requestId)){const t=this._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new o({code:e.payload.code,message:e.payload.message}))}else if(this._batchableCommandAckStateMap.has(e.requestId)){const t=Date.now();for(const[s,i]of this._batchableCommandAckStateMap.entries())if(i.channelUrl===e.payload.channel_url&&i.requestTime<t){const t=i.ackState;"EROR"!==e.code?t.resolve(e):t.reject(new o({code:e.payload.code,message:e.payload.message}))}}}else if(this._redundantActionCommands.has(e.payload.unique_id)){const t=this._redundantActionCommands.get(e.payload.unique_id),s=null==t?void 0:t.indexOf(e.code);-1!==s&&(null==t||t.splice(s,1)),0===t.length&&this._redundantActionCommands.delete(e.payload.unique_id)}else this._dispatcher.dispatch(e)})).on("close",(()=>{this._ackStateMap.forEach((e=>{e.reject(o.connectionClosed)})),this._ackStateMap.clear(),this._batchableCommandAckStateMap.clear(),this._redundantActionCommands.clear()}))}_sendApiRequest(t){return e(this,void 0,void 0,(function*(){return t.params.unique_id&&this._redundantActionCommands.set(t.params.unique_id,["SYEV","READ"]),yield this.apiClient.send(t)}))}_sendWebsocketRequest(t){return e(this,void 0,void 0,(function*(){if(!this._sdkState.websocket)throw o.connectionRequired;const e=new Be;if(t.ackRequired){let s;const i=(i,n)=>{const o="READ"===t.code?this._batchableCommandAckStateMap:this._ackStateMap;o.has(t.requestId)&&(o.delete(t.requestId),s&&(clearTimeout(s),s=null),i?(this._logger.debug("fail websocket request",t.requestId,i),e.reject(i)):(this._logger.debug("receive websocket ack",t.requestId,t),this._logger.debug("receive websocket ack",n),e.resolve(n)))};try{s=setTimeout((()=>i(o.noAckTimeout)),this._sdkState.websocket.responseTimeout),"READ"===t.code?this._batchableCommandAckStateMap.set(t.requestId,{ackState:{resolve:e=>i(void 0,e),reject:e=>i(e)},channelUrl:t.payload.channel_url,requestTime:Date.now()}):this._ackStateMap.set(t.requestId,{resolve:e=>i(void 0,e),reject:e=>i(e)}),this.websocketClient.send(t)}catch(e){i(e)}}else try{this.websocketClient.send(t),e.resolve()}catch(t){e.reject(t)}return e.promise}))}send(t){return e(this,void 0,void 0,(function*(){if(t instanceof Ce)return yield this._sendApiRequest(t);if(t instanceof Ae)return yield this._sendWebsocketRequest(t);throw o.invalidParameters}))}cancel(e){this.apiClient.cancel(e)}cancelAll(){this.apiClient.cancelAll()}}exports.ConnectionStateType=void 0,(gn=exports.ConnectionStateType||(exports.ConnectionStateType={}))[gn.NONE=0]="NONE",gn[gn.INITIALIZED=1]="INITIALIZED",gn[gn.CONNECTING=2]="CONNECTING",gn[gn.CONNECTED=3]="CONNECTED",gn[gn.RECONNECTING=4]="RECONNECTING",gn[gn.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",gn[gn.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",gn[gn.LOGOUT=7]="LOGOUT";class yn extends R{constructor({stateType:e}){super(),this.stateType=e}}class Sn extends R{}class Cn extends R{}class Tn extends R{}class wn{constructor(e){var t,s,i,n;this.isEnabled=null!==(t=e.enabled)&&void 0!==t&&t,this.feedChannels=null!==(s=e.feed_channels)&&void 0!==s?s:{},this.templateListToken=null!==(i=e.template_list_token)&&void 0!==i?i:null,this.settingsUpdatedAt=null!==(n=e.settings_updated_at)&&void 0!==n?n:0}static payloadify(e){return O(N({enabled:e.isEnabled,feed_channels:e.feedChannels,template_list_token:e.templateListToken,settings_updated_at:e.settingsUpdatedAt}))}}class bn{constructor(e){var t;this.lastUpdatedAt=null!==(t=e.last_updated_at)&&void 0!==t?t:0}static payloadify(e){return O(N({last_updated_at:e.lastUpdatedAt}))}}class In{constructor(e){var t;this.token=null!==(t=e.template_list_token)&&void 0!==t?t:""}static payloadify(e){return O(N({template_list_token:e.token}))}}class An{constructor(e={min_stat_count:100,min_interval:10800,max_stat_count_per_request:1e3,lower_threshold:10,request_delay_range:180}){this.minStatCount=e.min_stat_count,this.minInterval=1e3*e.min_interval,this.maxStatCountPerRequest=e.max_stat_count_per_request,this.lowerThreshold=e.lower_threshold,this.requestDelayRange=1e3*e.request_delay_range}static payloadify(e){return O(N({min_stat_count:e.minStatCount,min_interval:e.minInterval/1e3,max_stat_count_per_request:e.maxStatCountPerRequest,lower_threshold:e.lowerThreshold,request_delay_range:e.requestDelayRange/1e3}))}}class xn{constructor(e={default:{min_stat_count:100,min_interval:10800,max_stat_count_per_request:1e3,lower_threshold:10,request_delay_range:180}}){this.default=new An(e.default),this.realTime=new An(e.realtime)}static payloadify(e){return O(N({default:An.payloadify(e.default),realtime:An.payloadify(e.realTime)}))}}class kn{constructor(e){var t;this.templateListToken=null!==(t=e.template_list_token)&&void 0!==t?t:null}static payloadify(e){return O(N({template_list_token:e.templateListToken}))}}const Rn=1048576;var On,Nn;exports.UnreadCountThreadingPolicy=void 0,(On=exports.UnreadCountThreadingPolicy||(exports.UnreadCountThreadingPolicy={}))[On.NONE=0]="NONE",On[On.INCLUDE_REPLY=1]="INCLUDE_REPLY",On[On.EXCLUDE_REPLY=2]="EXCLUDE_REPLY",On[On.INCLUDE_REPLY_TO_CHANNEL=3]="INCLUDE_REPLY_TO_CHANNEL",exports.LastMessageThreadingPolicy=void 0,(Nn=exports.LastMessageThreadingPolicy||(exports.LastMessageThreadingPolicy={}))[Nn.NONE=0]="NONE",Nn[Nn.INCLUDE_REPLY=1]="INCLUDE_REPLY",Nn[Nn.EXCLUDE_REPLY=2]="EXCLUDE_REPLY",Nn[Nn.INCLUDE_REPLY_TO_CHANNEL=3]="INCLUDE_REPLY_TO_CHANNEL";class Dn{constructor(e={}){var t,s,i,n,o,r,a,d,c,l;this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?e.file_upload_size_limit*Rn:Number.MAX_SAFE_INTEGER,this.useReaction=!!e.use_reaction,this.applicationAttributes=null!==(t=e.application_attributes)&&void 0!==t?t:[],this.premiumFeatureList=null!==(s=e.premium_feature_list)&&void 0!==s?s:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=null!==(i=e.multiple_file_send_max_size)&&void 0!==i?i:5,this.allowSdkStatsUpload=null===(n=e.allow_sdk_log_ingestion)||void 0===n||n,this.unreadCountThreadingPolicy=null!==(o=e.unread_cnt_threading_policy)&&void 0!==o?o:exports.UnreadCountThreadingPolicy.NONE,this.lastMessageThreadingPolicy=null!==(r=e.last_msg_threading_policy)&&void 0!==r?r:exports.LastMessageThreadingPolicy.NONE,this.uikitConfigInfo=new bn(null!==(a=e.uikit_config)&&void 0!==a?a:{}),this.notificationInfo=e.notifications?new wn(e.notifications):null,this.messageTemplateInfo=e.message_template?new In(e.message_template):null,this.aiAgentInfo=e.ai_agent?new kn(e.ai_agent):null,this.statConfigInfo=e.log_publish_config?new xn(e.log_publish_config):new xn,this.disableSuperGroupMack=null!==(d=e.disable_supergroup_mack)&&void 0!==d&&d,this.configSyncNeeded=null!==(c=e.config_sync_needed)&&void 0!==c&&c,this.requestDedupIntervalMs=null!==(l=e.request_dedup_interval_ms)&&void 0!==l?l:500}static payloadify(e){return O(N({emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/Rn,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction,allow_sdk_log_ingestion:e.allowSdkStatsUpload,unread_cnt_threading_policy:e.unreadCountThreadingPolicy,last_msg_threading_policy:e.lastMessageThreadingPolicy,uikit_config:e.uikitConfigInfo?bn.payloadify(e.uikitConfigInfo):null,notifications:e.notificationInfo?wn.payloadify(e.notificationInfo):null,message_template:e.messageTemplateInfo?In.payloadify(e.messageTemplateInfo):null,log_publish_config:e.statConfigInfo?xn.payloadify(e.statConfigInfo):null,disable_supergroup_mack:e.disableSuperGroupMack,config_sync_needed:e.configSyncNeeded,request_dedup_interval_ms:e.requestDedupIntervalMs}))}}const Ln=e=>`sendbird@${e}/app_configs_info`;class Pn{constructor(e){this._iid="",this._iid=e}static payloadify(e){return{}}}class Un extends Ce{constructor({userId:e,metadata:t}){super(),this.method=exports.APIRequestMethod.POST,this.path=`${j}/${e}/metadata`,this.params={metadata:t}}}class Mn extends Te{constructor(e,t){super(e,t),this.metaData=t}}class qn extends Ce{constructor({userId:e,metadata:t,upsert:s}){super(),this.method=exports.APIRequestMethod.PUT,this.path=`${j}/${e}/metadata`,this.params={metadata:t,upsert:s}}}class Fn extends Te{constructor(e,t){super(e,t),this.metadata=t}}class zn extends Ce{constructor({userId:e,metadataKey:t}){super(),this.method=exports.APIRequestMethod.DELETE,this.path=`${j}/${e}/metadata/${t}`}}class Kn extends Ce{constructor({userId:e}){super(),this.method=exports.APIRequestMethod.DELETE,this.path=`${j}/${e}/metadata`}}const Hn=(e,t)=>{const s=JSON.parse(JSON.stringify(e));return s._iid&&delete s._iid,t&&t(s),s},Bn=(e,t)=>{const s=JSON.parse(JSON.stringify(e));return t&&t(s),s},Qn=e=>({do:t=>{e||t()},throw:t=>{if(!e)throw t}});var $n;exports.UserOnlineState=void 0,($n=exports.UserOnlineState||(exports.UserOnlineState={})).ONLINE="online",$n.OFFLINE="offline",$n.NON_AVAILABLE="nonavailable";class Wn extends Pn{constructor(e,t){var s,i,n,o,r,a,l,h,u,_,p,f,g;super(e),this.userId=null!==(i=null!==(s=t.guest_id)&&void 0!==s?s:t.user_id)&&void 0!==i?i:"",this.nickname=null!==(o=null!==(n=t.nickname)&&void 0!==n?n:t.name)&&void 0!==o?o:"",this.plainProfileUrl=null!==(a=null!==(r=t.profile_url)&&void 0!==r?r:t.image)&&void 0!==a?a:"",this.requireAuth=null!==(l=t.require_auth_for_profile_image)&&void 0!==l&&l,this.metaData=null!==(h=t.metadata)&&void 0!==h?h:{},this.connectionStatus=exports.UserOnlineState.NON_AVAILABLE,c(exports.UserOnlineState,t.is_online)?this.connectionStatus=t.is_online:d("boolean",t.is_online)&&(this.connectionStatus=t.is_online?exports.UserOnlineState.ONLINE:exports.UserOnlineState.OFFLINE),this.isActive=null===(u=t.is_active)||void 0===u||u,this.lastSeenAt=null!==(_=t.last_seen_at)&&void 0!==_?_:null,this.preferredLanguages=t.preferred_languages?[...t.preferred_languages]:null,this.friendDiscoveryKey=null!==(p=t.friend_discovery_key)&&void 0!==p?p:null,this.friendName=null!==(f=t.friend_name)&&void 0!==f?f:null,this._hashValue=this._generateHashValue(),this._updatedAt=null!==(g=t.updatedat)&&void 0!==g?g:0}static payloadify(e){return O(N(Object.assign(Object.assign({},super.payloadify(e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})))}static _buildUserFromSerializedData(e){const t=Bn(e);return new Wn(t._iid,Wn.payloadify(t))}_generateHashValue(){var e;const t=JSON.stringify({userId:this.userId,nickname:this.nickname,plainProfileUrl:this.plainProfileUrl,friendDiscoveryKey:this.friendDiscoveryKey,friendName:this.friendName,metaData:JSON.stringify(this.metaData),performanceLanguages:null===(e=this.preferredLanguages)||void 0===e?void 0:e.toString(),requireAuth:this.requireAuth});let s=0;for(let e=0;e<t.length;e++){s=(s<<5)-s+t.charCodeAt(e),s|=0}return s}get profileUrl(){const{sessionManager:e}=jo.of(this._iid);return this.requireAuth&&e.ekey?`${this.plainProfileUrl}?auth=${e.ekey}`:this.plainProfileUrl}serialize(){return Hn(this)}_isValidMetaData(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((t=>e[t])).every((e=>d("string",e)))}_applyMetaData(e,t=!1){Object.keys(e).forEach((s=>{t?delete this.metaData[s]:this.metaData[s]=e[s]}))}createMetaData(t){return e(this,void 0,void 0,(function*(){Qn(this._isValidMetaData(t)).throw(o.invalidParameters);const{sdkState:e,requestQueue:s}=jo.of(this._iid),i=new Un({userId:e.userId,metadata:t}),n=yield s.send(i),{metaData:r}=n.as(Mn);return this._applyMetaData(r),this.metaData}))}updateMetaData(t,s=!1){return e(this,void 0,void 0,(function*(){Qn(this._isValidMetaData(t)).throw(o.invalidParameters);const{sdkState:e,requestQueue:i}=jo.of(this._iid),n=new qn({userId:e.userId,metadata:t,upsert:s}),r=yield i.send(n),{metadata:a}=r.as(Fn);return this._applyMetaData(a),this.metaData}))}deleteMetaData(t){return e(this,void 0,void 0,(function*(){Qn(d("string",t)).throw(o.invalidParameters);const{sdkState:e,requestQueue:s}=jo.of(this._iid),i=new zn({userId:e.userId,metadataKey:t});return yield s.send(i),this._applyMetaData({[t]:!0},!0),this.metaData}))}deleteAllMetaData(){return e(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=jo.of(this._iid),s=new Kn({userId:e.userId});yield t.send(s),this.metaData={}}))}}class jn extends R{constructor({userProfile:e}){super(),this.userProfile=e}}class Gn{constructor(e,t){var s,i,n,o,r,a,d,c,l,h,u,_,p,f;this._iid=e,this.appInfo=new Dn(t),this.user=new Wn(e,t),this.connectedAt=null!==(s=t.login_ts)&&void 0!==s?s:0,this.firstConnectedAt=0,this.pingInterval=null!==(i=t.ping_interval)&&void 0!==i?i:15e3,this.pongTimeout=null!==(n=t.pong_timeout)&&void 0!==n?n:5e3,this.reconnectInterval=null!==(r=null===(o=t.reconnect)||void 0===o?void 0:o.interval)&&void 0!==r?r:3e3,this.reconnectMaxInterval=null!==(d=null===(a=t.reconnect)||void 0===a?void 0:a.max_interval)&&void 0!==d?d:6e4,this.reconnectRetryCount=null!==(l=null===(c=t.reconnect)||void 0===c?void 0:c.retry_cnt)&&void 0!==l?l:5,this.reconnectIntervalMultiple=null!==(u=null===(h=t.reconnect)||void 0===h?void 0:h.mul)&&void 0!==u?u:2,this.maxUnreadCountOnSuperGroup=null!==(_=t.max_unread_cnt_on_super_group)&&void 0!==_?_:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(p=t.concurrent_call_limit)&&void 0!==p?p:5,this.backOffDelay=null!==(f=t.back_off_delay)&&void 0!==f?f:100}static payloadify(e){return O(N(Object.assign(Object.assign(Object.assign({},Wn.payloadify(e.user)),Dn.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})))}apply(){const e=this.reconnectInterval,t=this.reconnectMaxInterval,s=this.reconnectIntervalMultiple,i=jo.of(this._iid);i.sdkState.websocket&&(i.sdkState.websocket.pingInterval=1e3*this.pingInterval,i.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,i.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,i.sdkState.websocket.reconnectRetryStrategy={calcTimeout:i=>i>0?1e3*Math.min(e*Math.pow(s,i-1),t):10}),i.appInfo=this.appInfo,i.sessionManager.currentUser=this.user,i.connectedAt=this.connectedAt,this.firstConnectedAt||(i.firstConnectedAt=this.connectedAt),i.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,i.concurrentCallLimit=this.concurrentCallLimit,i.backOffDelay=this.backOffDelay,i.requestDeduplicator.requestDedupInterval=this.appInfo.requestDedupIntervalMs,i.dispatcher.dispatch(new jn({userProfile:this}))}}class Zn extends R{constructor({request:e=!0,features:t={},options:s={},statConfigInfo:i}){super(),this.request=e,this.features=Object.assign({localCache:!0,notification:!0},t),this.options=Object.assign({ingestion:!0},s),this.statConfigInfo=i}}class Vn extends R{constructor(e){super(),this.configSyncNeeded=!1,this.configSyncNeeded=e}}class Yn extends Ie{constructor(e,t,s){var i,n,r,a;super(e,t,s),this.error=null,this.services=[],this.userProfile=new Gn(e,s),this.deviceTokenLastDeletedAt=null!==(i=s.device_token_last_deleted_at)&&void 0!==i?i:0,this.key=null!==(n=s.key)&&void 0!==n?n:"",this.ekey=null!==(r=s.ekey)&&void 0!==r?r:"",this.error=s.error?new o(s):null,this.services=null!==(a=s.services)&&void 0!==a?a:[]}static asError(e){return new Yn("","LOGI",Object.assign({user_id:"",error:!0},e))}applyTo(t){return e(this,void 0,void 0,(function*(){if(this.error)throw this.error;{const e=jo.of(t);if(!e)throw o.lostInstance;{const{sessionManager:t,dispatcher:s}=e;yield t.login(this),this.userProfile.apply(),s.dispatch(new Vn(this.userProfile.appInfo.configSyncNeeded)),s.dispatch(new Zn({request:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish"),notification:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_noti_stats_log_publish")},options:{ingestion:this.userProfile.appInfo.allowSdkStatsUpload},statConfigInfo:this.userProfile.appInfo.statConfigInfo}))}}}))}}class Xn{constructor(){this.type=exports.ConnectionStateType.NONE,this.name="none"}run(t){return e(this,void 0,void 0,(function*(){}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){}))}onReconnect(t,{resetReconnectCount:s=!1}){return e(this,void 0,void 0,(function*(){}))}onDisconnect(t,{error:s=null,autoReconnect:i=!1,cause:n=null}){return e(this,void 0,void 0,(function*(){}))}onDisconnectWebSocket(t,s){return e(this,void 0,void 0,(function*(){}))}onLogout(t,s){return e(this,void 0,void 0,(function*(){}))}}class Jn extends Xn{constructor(e={}){var t;super(),this.type=exports.ConnectionStateType.LOGOUT,this.name="logout",this._wasPreviouslyConnected=null===(t=e.wasPreviouslyConnected)||void 0===t||t}run(t){return e(this,void 0,void 0,(function*(){const s=Date.now(),i=t.sdkState.userId;yield t.logout(),yield t.changeState(new uo,s),this._wasPreviouslyConnected&&_n((()=>e(this,void 0,void 0,(function*(){t.connectionHandlers.forEach((e=>{e.onDisconnected&&e.onDisconnected(i)}))}))))}))}}class eo extends Xn{constructor(){super(),this.type=exports.ConnectionStateType.EXTERNAL_DISCONNECTED,this.name="externaldisconnected"}run(t){return e(this,void 0,void 0,(function*(){yield t.disconnect()}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),yield t.changeState(new lo({authToken:s}),e)}))}onReconnect(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new oo,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new Jn,e)}))}}class to extends Xn{constructor({autoReconnect:e}){super(),this.type=exports.ConnectionStateType.INTERNAL_DISCONNECTED,this.name="internaldisconnected",this._autoReconnect=!1,this._autoReconnect=e}run(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),this._autoReconnect&&(yield t.changeState(new oo,e))}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),yield t.changeState(new lo({authToken:s}),e)}))}onReconnect(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new oo,e)}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new eo,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new Jn,e)}))}}const so=t=>e(void 0,void 0,void 0,(function*(){return new Promise((e=>setTimeout(e,t)))}));class io{calcTimeout(){return 0}}const no=(t,s,i=new io)=>e(void 0,void 0,void 0,(function*(){let e=0,n=null;const o=e=>n=null!=e?e:new Error("Halted"),r=()=>{e=0};for(;-1===s||e<s;)try{const e=yield t(o,r);if(n)throw n;return e}catch(t){if(n)throw n;if(e++,e===s)throw t;yield so(i.calcTimeout(e))}throw"It should not happen."}));class oo extends Xn{constructor(){super(...arguments),this.type=exports.ConnectionStateType.RECONNECTING,this.name="reconnecting",this._callbacks=[]}_halt(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)}_flushCallbacks(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach((t=>t(e)))}run(t){return e(this,void 0,void 0,(function*(){const s=Date.now(),i=new Be;this._callbacks.push((e=>e?i.reject(e):i.resolve())),_n((()=>e(this,void 0,void 0,(function*(){t.connectionHandlers.forEach((e=>{e.onReconnectStarted&&e.onReconnectStarted()}))}))));try{const i=I();let n=0;const{reconnectMaxRetry:r,reconnectRetryStrategy:a}=t.sdkState.websocket;yield no(((s,r)=>e(this,void 0,void 0,(function*(){this._haltConnect=s,this._resetConnect=r;try{n++,yield t.connect({connectionKey:i,connectionRetryCount:n})}catch(e){if(t.clearLoginTimer(),e instanceof o){if(e.code===exports.SendbirdErrorCode.CONNECTION_CANCELED)return void s(e);if(e.isSessionExpiredError||e.isSessionInvalidatedError)return void s(e)}throw e}}))),r,a),yield t.changeState(new ro,s),this._flushCallbacks(),_n((()=>e(this,void 0,void 0,(function*(){t.connectionHandlers.forEach((e=>{e.onReconnectSucceeded&&e.onReconnectSucceeded()}))}))))}catch(i){if(n(i))throw i;i instanceof o&&i.code!==exports.SendbirdErrorCode.CONNECTION_CANCELED&&(yield t.changeState(new to({autoReconnect:!1}),s)),this._flushCallbacks(i),_n((()=>e(this,void 0,void 0,(function*(){t.connectionHandlers.forEach((e=>{e.onReconnectFailed&&e.onReconnectFailed()}))}))))}return i.promise}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=new Be;return this._halt(o.connectionCanceled),t.cancelConnectForRetry(),this._callbacks.push((()=>{const i=Date.now();t.changeState(new lo({authToken:s}),i).then((()=>{e.resolve()})).catch((t=>{e.reject(t)}))})),e.promise}))}onReconnect(t,{resetReconnectCount:s=!1}){return e(this,void 0,void 0,(function*(){const e=new Be;return this._resetConnect&&s&&this._resetConnect(),this._callbacks.push((t=>t?e.reject(t):e.resolve())),e.promise}))}onDisconnect(t,{_error:s=null,autoReconnect:i=!0}){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),yield t.changeState(new to({autoReconnect:i}),e)}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),yield t.changeState(new eo,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),yield t.changeState(new Jn,e)}))}}class ro extends Xn{constructor(){super(...arguments),this.type=exports.ConnectionStateType.CONNECTED,this.name="connected"}onReconnect(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),yield t.changeState(new oo,e)}))}onDisconnect(t,{autoReconnect:s}){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new to({autoReconnect:s}),e)}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new eo,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new Jn,e)}))}}var ao;!function(e){e.ExternalSetBackground="ExternalSetBackground",e.ExternalDisconnectWebSocket="ExternalDisconnectWebSocket"}(ao||(ao={}));class co{constructor(e,{sdkState:t,cacheContext:s,connectionHandlers:i,sessionManager:n,websocketClient:o,dispatcher:r,logger:a,disableWebSocketCloseEventHandling:d=!1}){this._disableWebSocketCloseEventHandling=!1,this._webSocketClosedCause=null,this._logger=a,this._disableWebSocketCloseEventHandling=d,this._context=new go(e,{sdkState:t,cacheContext:s,connectionHandlers:i,sessionManager:n,websocketClient:o,dispatcher:r,logger:a}),this._sdkState=t,this._sessionManager=n,this._websocketClient=o}_registerEventDispatcher(){this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh",(()=>{this.isConnecting||this.isConnected||(this._logger.debug("try reconnect by session key refresh"),pn((()=>e(this,void 0,void 0,(function*(){yield this.reconnect()})))))})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(()=>{"foreground"!==this._sdkState.appState||this._webSocketClosedCause||pn((()=>e(this,void 0,void 0,(function*(){this._sessionManager.isSessionKeyRefreshing?yield this.disconnectWebSocket():(this._logger.debug("try reconnect by websocket connection closed"),yield this.reconnect())}))))})))}_clearEventDispatcher(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)}get isConnected(){const{currentState:e}=this._context;return e.type===exports.ConnectionStateType.CONNECTED}get isConnecting(){const{currentState:e}=this._context;return e.type===exports.ConnectionStateType.CONNECTING||e.type===exports.ConnectionStateType.RECONNECTING}get websocketClient(){return this._websocketClient}connect(t){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._webSocketClosedCause=null,yield e.onConnect(this._context,t),this._registerEventDispatcher()}))}reconnect(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._webSocketClosedCause=null,yield e.onReconnect(this._context,{})}))}resetAndReconnect(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._webSocketClosedCause=null,yield e.onReconnect(this._context,{resetReconnectCount:!0})}))}background(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._webSocketClosedCause=ao.ExternalSetBackground,yield e.onDisconnect(this._context,{autoReconnect:!1,cause:this._webSocketClosedCause})}))}disconnect(t){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;yield e.onDisconnect(this._context,{error:t,autoReconnect:!0,cause:this._webSocketClosedCause})}))}disconnectWebSocket(t=!1){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;t&&(this._webSocketClosedCause=ao.ExternalDisconnectWebSocket),yield e.onDisconnectWebSocket(this._context,{cause:this._webSocketClosedCause})}))}logout(t){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._clearEventDispatcher(),yield e.onLogout(this._context,t)}))}}class lo extends Xn{constructor({authToken:e}){super(),this.type=exports.ConnectionStateType.CONNECTING,this.name="connecting",this._authToken="",this._callbacks=[],this._authToken=e}_halt(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)}_flushCallbacks(e){this._haltConnect=void 0,this._callbacks.forEach((t=>t(e)))}run(t){return e(this,void 0,void 0,(function*(){const s=Date.now(),i=new Be;this._callbacks.push((e=>e?i.reject(e):i.resolve()));try{const i=I();let n=0;yield no((s=>e(this,void 0,void 0,(function*(){this._haltConnect=s;try{n++,yield t.connect({authToken:this._authToken,connectionKey:i,connectionRetryCount:n})}catch(e){if(t.clearLoginTimer(),e instanceof o)switch(e.code){case exports.SendbirdErrorCode.CONNECTION_CANCELED:case exports.SendbirdErrorCode.SESSION_KEY_EXPIRED:case exports.SendbirdErrorCode.SESSION_TOKEN_EXPIRED:case exports.SendbirdErrorCode.SESSION_REVOKED:case exports.SendbirdErrorCode.USER_AUTH_DEACTIVATED:case exports.SendbirdErrorCode.USER_AUTH_DELETED_OR_NOT_FOUND:case exports.SendbirdErrorCode.USER_DEACTIVATED:return void s(e)}throw e}}))),t.sdkState.websocket.connectMaxRetry),yield t.changeState(new ro,s),_n((()=>e(this,void 0,void 0,(function*(){this._flushCallbacks(),t.connectionHandlers.forEach((e=>{e.onConnected&&e.onConnected(t.sdkState.userId)}))}))))}catch(i){if(n(i))throw i;yield t.disconnect(),i instanceof o&&i.code!==exports.SendbirdErrorCode.CONNECTION_CANCELED&&(yield t.changeState(new uo,s)),_n((()=>e(this,void 0,void 0,(function*(){this._flushCallbacks(i)}))))}return i.promise}))}onConnect(t){return e(this,void 0,void 0,(function*(){const e=new Be;return this._callbacks.push((t=>t?e.reject(t):e.resolve())),e.promise}))}onDisconnect(t,{error:s=null,autoReconnect:i=!1,cause:n=null}){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(null!=s?s:ho(n)),t.hasSession?yield t.changeState(new to({autoReconnect:i}),e):yield t.changeState(new Jn,e)}))}onDisconnectWebSocket(t,s){return e(this,void 0,void 0,(function*(){this._halt(ho((null==s?void 0:s.cause)||null));const e=Date.now();t.hasSession?yield t.changeState(new eo,e):yield t.changeState(new Jn,e)}))}onLogout(t,s){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(null!=s?s:o.connectionCanceled),yield t.changeState(new Jn,e)}))}}function ho(e){const t=o.connectionCanceled;if(e){let s=null;switch(e){case ao.ExternalSetBackground:s="Connection has been canceled due to the application having externally moved to background while in ConnectingState.";break;case ao.ExternalDisconnectWebSocket:s="Connection has been canceled because sb.disconnectWebSocket() was called while in ConnectingState."}s&&t.setDetail(s)}return t}class uo extends Xn{constructor(){super(...arguments),this.type=exports.ConnectionStateType.INITIALIZED,this.name="initialized"}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new lo({authToken:s}),e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new Jn({wasPreviouslyConnected:!1}),e)}))}}class _o extends Ae{constructor(){super({code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})}}class po{constructor({pingDelegate:e,sdkState:t,logger:s}){this.pingDelegate=e,this.sdkState=t,this._logger=s}get isWaiting(){return!!this._pingTimeoutTimer}ping(){var e;if(!this.sdkState.websocket)throw o.connectionRequired;const t=new _o;try{const s=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((()=>{this._logger.debug("pinger.ping() timeout"),this.pingDelegate.error()}),s),this.pingDelegate.send(t),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return t}pong(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)}refreshTimer(){var e;if(!this.sdkState.websocket)throw o.connectionRequired;this._logger.debug("pinger.refreshTimer()");const t=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((()=>{this.ping()}),t)}start(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()}stop(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)}}const fo=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications","message_template","ai_agent"];class go extends x{constructor(e,{sdkState:t,cacheContext:s,connectionHandlers:i,sessionManager:n,websocketClient:r,dispatcher:a,logger:d,entryState:c=new uo}){var l;super(),this._currentConnectionRetryCount=0,this._stateUpdatedAt=0,this._connectingAt=0,this._connectedAt=0,this._logiReceivedAt=0,this._connectionRequestQueue=[],this._iid=e,this.sdkState=t,this.cacheContext=s,this.connectionHandlers=i,this._sessionManager=n,this._websocketClient=r,this._dispatcher=a,this._logger=d,this._currentState=c,(null===(l=this.sdkState.websocket)||void 0===l?void 0:l.pingerDisabled)||(this._pinger=new po({pingDelegate:{send:e=>this._websocketClient.send(e),error:e=>{a.dispatch(new Ne(new Pe({type:exports.StatType.WEBSOCKET_DISCONNECT,data:{success:!0,error_code:exports.SendbirdErrorCode.NETWORK_ERROR,error_description:"cause=ping_pong_timedout"}}))),this._websocketClient.error(e)}},sdkState:this.sdkState,logger:d})),this._websocketClient.on("open",(()=>{this._connectedAt=Date.now(),this._tryResolveConnectionRequest()})).on("message",(e=>{if("LOGI"===e.code)this.clearLoginTimer(),this._dispatcher.dispatch(e.as(Yn))})).on("ping-refresh",(()=>{var e;return null===(e=this._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(()=>{var e;return null===(e=this._pinger)||void 0===e?void 0:e.pong()})).on("error",(()=>{var e;return null===(e=this._pinger)||void 0===e?void 0:e.stop()})).on("close",(()=>{this._logiProcessingTimer=setTimeout((()=>{this._logiProcessingTimer=void 0,this._unresolvedLogi||this._rejectConnectionRequest(o.networkError)}),500)})),this._dispatcher.on((e=>{e instanceof Yn&&(this._unresolvedLogi=e,this._tryResolveConnectionRequest())}))}get currentState(){return this._currentState}get hasSession(){return this._sessionManager.session.hasSession}changeState(t,s){return e(this,void 0,void 0,(function*(){return s>=this._stateUpdatedAt&&(this._currentState=t,this._stateUpdatedAt=s,this._dispatcher.dispatch(new yn({stateType:t.type})),this._logger.debug(`connection state changes to ${t.name}`),yield this._currentState.run(this),!0)}))}_tryResolveConnectionRequest(){var t;return e(this,void 0,void 0,(function*(){const e=this._unresolvedLogi;this._websocketClient.isOpen&&e&&(this._unresolvedLogi=void 0,this._logiReceivedAt=Date.now(),e.error?(this._sessionManager.session.authToken=void 0,e.error.isSessionExpiredError||e.error.isSessionInvalidatedError?this._dispatcher.dispatch(new be({reason:e.error.code,message:e.error.message})):this._logger.warn(`login failed: ${e.error}`),this._rejectConnectionRequest(e.error)):(yield e.applyTo(this._iid),this._statLogConnection(),null===(t=this._pinger)||void 0===t||t.start(),this._connectionRequestQueue.forEach((e=>e.resolve())),this._connectionRequestQueue=[],this.sdkState.appState="foreground"))}))}_rejectConnectionRequest(e){var t;if(null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){const t=this._connectionRequestQueue;this._connectionRequestQueue=[],t.forEach((t=>t.reject(e))),this._statLogConnection(e)}}_url({configTs:e}){var t;const{appId:s,appVersion:n,userId:o,extensions:r,sendbirdRuntimeEnvironment:a}=this.sdkState,{localCacheEnabled:d}=this.cacheContext,{session:c}=this._sessionManager,l=null===(t=this.sdkState.websocket)||void 0===t?void 0:t.compression,h=!!(null!=r?r:{}).sb_uikit,u=He.userAgentWithExtension(r);return`${this.sdkState.websocket.host}/?p=JS&pv=${encodeURIComponent(i.OS_VERSION)}&sv=${encodeURIComponent(i.SDK_VERSION)}&ai=${s}${n?`&av=${n}`:""}${c.hasSession?"":`&user_id=${encodeURIComponent(o)}`}&pmce=${l?1:0}&active=1&device_token_types=${encodeURIComponent(["gcm","huawei","apns"].join(","))}&SB-User-Agent=${u}&SB-SDK-User-Agent=${encodeURIComponent(He.sendbirdSdkUserAgentWithExtension(a))}&Request-Sent-Timestamp=${Date.now().toString()}&include_extra_data=${encodeURIComponent(String(fo))}${this._sessionManager.handler?"&expiring_session=1":""}&use_local_cache=${d?1:0}&include_poll_details=1${h?"&uikit_config=1":""}&config_ts=${e}`}_statLogConnection(e){var t;this._dispatcher.dispatch(new Ne(new Pe({type:exports.StatType.WEBSOCKET_CONNECT,data:{host_url:null===(t=this.sdkState.websocket)||void 0===t?void 0:t.host,success:!e,latency:this._connectedAt>0?this._connectedAt-this._connectingAt:Date.now()-this._connectingAt,logi_latency:this._logiReceivedAt>0?this._logiReceivedAt-this._connectingAt:void 0,connection_id:this._currentConnectionKey,accum_trial:this._currentConnectionRetryCount,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))}connect(t={}){var s;return e(this,void 0,void 0,(function*(){this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(o.connectionCanceled));const e=new Be,{authToken:i="",connectionKey:n=I(),connectionRetryCount:r=1}=t;if(this._connectionRequestQueue.push(e),1===this._connectionRequestQueue.length){this._currentConnectionKey=n,this._currentConnectionRetryCount=r,this._connectingAt=Date.now(),this._connectedAt=0,this._logiReceivedAt=0,this._loginTimer=setTimeout((()=>{this._loginTimer=void 0,this._rejectConnectionRequest(o.loginTimeout)}),null===(s=this.sdkState.websocket)||void 0===s?void 0:s.responseTimeout);const{session:e}=this._sessionManager;i&&(e.authToken=i,e.sessionKey=void 0);let t=0;const a=yield this.cacheContext.preference.get(Ln(this.sdkState.appId));a&&(t=a.configTs);const d=this._url({configTs:t});e.sessionKey||e.authToken?this._websocketClient.connect(d,JSON.stringify(e.hasSession?{auth:e.sessionKey}:{token:e.authToken})):this._websocketClient.connect(d,JSON.stringify({}))}return e.promise}))}cancelConnectForRetry(){this._dispatcher.dispatch(Yn.asError(o.connectionRenew))}disconnect(){return e(this,void 0,void 0,(function*(){yield this._websocketClient.disconnect()}))}logout(){return e(this,void 0,void 0,(function*(){this.sdkState.userId=void 0,this._unresolvedLogi=void 0,yield this.disconnect(),yield this._sessionManager.clear()}))}clearLoginTimer(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)}}class Eo extends Ce{constructor({appId:e,userId:t,includeUIKitConfig:s=!1,localCacheEnabled:i=!0,expiringSession:n=!0,configTs:o=0}){super(),this.path=`${G}/${t}/authentication`,this.method=exports.APIRequestMethod.POST,this.params=O({expiring_session:!!n,include_logi:!0,include_extra_data:String(fo),uikit_config:s,use_local_cache:i,app_id:e,config_ts:o}),this.requireAuth=!1}}class mo extends Te{constructor(e,t){super(e,t),this.logi=new Yn(e,"LOGI",t)}}var vo;!function(e){e[e.ALL=0]="ALL",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.API=2]="API"}(vo||(vo={}));const yo=[xe,Eo];class So{constructor(e,{session:t,sdkState:s,dispatcher:i,logger:n,useFetchCompat:r=!1}){this._currentConnectionStateType=exports.ConnectionStateType.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new vn(e,{session:t,sdkState:s,dispatcher:i,logger:n,useFetchCompat:r}),this._session=t,this._logger=n,this._dispatcher=i,this._dispatcher.on((e=>{var t;if(e instanceof yn){const{stateType:s}=e;switch(this._currentConnectionStateType=s,s){case exports.ConnectionStateType.CONNECTED:this._resolveLazyCallQueue();break;case exports.ConnectionStateType.INITIALIZED:case exports.ConnectionStateType.INTERNAL_DISCONNECTED:case exports.ConnectionStateType.EXTERNAL_DISCONNECTED:case exports.ConnectionStateType.LOGOUT:this._session.isRefreshing||this._rejectLazyCallQueue((null===(t=this._session)||void 0===t?void 0:t.hasSession)?o.connectionClosed:o.connectionRequired)}}else if(e instanceof Sn)this._session.hasChatServicePermission||this._resolveLazyCallQueue(vo.API);else if(e instanceof Cn||e instanceof Tn)this._rejectLazyCallQueue(o.connectionClosed);else if(e instanceof De){const{request:t,deferred:s,error:i}=e;for(const e of yo)if(t instanceof e)return void s.reject(i);this._lazyCallQueue.push({command:t,deferred:s})}}))}get isReady(){return this._currentConnectionStateType===exports.ConnectionStateType.CONNECTED}get isLazyCallActivated(){return this._currentConnectionStateType===exports.ConnectionStateType.CONNECTING||this._currentConnectionStateType===exports.ConnectionStateType.RECONNECTING||this._session.isRefreshing}_classifyLazyCallQueueByScope(e){const t=[],s=[];let i;switch(e){case vo.ALL:i=null;break;case vo.WEBSOCKET:i=Ae;break;case vo.API:i=Ce}let n=!1;return this._lazyCallQueue.forEach((e=>{!i||e.command instanceof i||(n=!0),n?s.push(e):t.push(e)})),[t,s]}_resolveLazyCallQueue(t=vo.ALL){const[s,i]=this._classifyLazyCallQueueByScope(t);this._lazyCallQueue=i,s.forEach((t=>e(this,void 0,void 0,(function*(){const{command:e,deferred:s,timeout:i}=t;i&&clearTimeout(i);try{const t=yield this.send(e);s.resolve(t)}catch(e){s.reject(e)}}))))}_rejectLazyCallQueue(t,s=vo.ALL){const[i,n]=this._classifyLazyCallQueueByScope(s);this._lazyCallQueue=n,i.forEach((s=>e(this,void 0,void 0,(function*(){const{deferred:e,timeout:i}=s;clearTimeout(i),e.reject(t)}))))}send(t){return e(this,void 0,void 0,(function*(){if(t instanceof Ae){if(this.isReady)return this._logger.debug("send websocket request",t),yield this.commandRouter.send(t);if(this.isLazyCallActivated){this._logger.debug("wait websocket request",t);const e=new Be;return this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout((()=>this.timeout(t.requestId)),1e4)}),e.promise}throw this._logger.debug("fail websocket request"),o.connectionRequired}if(t instanceof Ce){if(this._session.hasSession)return this._logger.debug("send api request",t),yield this.commandRouter.send(t);if(t.hasSessionKey)return this._logger.debug("send api request with tmp session key",t),yield this.commandRouter.send(t);if(this.isLazyCallActivated){this._logger.debug("wait api request",t);const e=new Be;return this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout((()=>this.timeout(t.requestId)),1e4)}),e.promise}{const e=o.connectionRequired;throw this._logger.debug("fail api request",e),e}}throw o.invalidCommand}))}forceSend(t){return e(this,void 0,void 0,(function*(){if(this._logger.debug("send forced request",t),t instanceof Ae||t instanceof Ce)return yield this.commandRouter.send(t);throw o.invalidCommand}))}timeout(e){this._logger.debug("timeout request",e);const t=this._lazyCallQueue.findIndex((t=>t.command.requestId===e));t>-1&&(this._lazyCallQueue[t].deferred.reject(o.connectionRequired),this._lazyCallQueue.splice(t,1))}cancel(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)}cancelAll(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()}}const Co="sendbird@devicetokens";class To{constructor({type:e,token:t,device_os:s,device_manufacturer:i,system_push_enabled:n}){this.type=e,this.token=t,this.deviceOS=s,this.deviceManufacturer=i,this.systemPushEnabled=n}static payloadify(e){return O(N({type:e.type,token:e.token,device_os:e.deviceOS,device_manufacturer:e.deviceManufacturer,system_push_enabled:e.systemPushEnabled}))}}const wo=new WeakMap;class bo extends x{constructor({_iid:e,session:t,cacheContext:s,sdkState:i,dispatcher:o,requestQueue:r,logger:a,pushNotificationAckManager:d}){super(),this._currentConnectionStateType=exports.ConnectionStateType.INITIALIZED,this._isRefreshingAuthToken=!1,this.currentUser=null,this.session=t,this._iid=e,this._cacheContext=s,this._sdkState=i,this._dispatcher=o,this._requestQueue=r,this._logger=a,this._pushNotificationAckManager=d,this._deviceTokens=[],this._dispatcher.on((e=>{var t,s,i;if(e instanceof yn){const{stateType:t}=e;this._currentConnectionStateType=t}else if(e instanceof be&&this.handler&&!this.isSessionKeyRefreshing){if(this._currentConnectionStateType===exports.ConnectionStateType.CONNECTING)return;(null===(t=e.error)||void 0===t?void 0:t.isSessionInvalidatedError)?this.clear():((null===(s=e.error)||void 0===s?void 0:s.isSessionTokenExpiredError)&&this.refreshAuthToken().catch((e=>{if(n(e)&&"foreground"===this._sdkState.appState)throw e})),(null===(i=e.error)||void 0===i?void 0:i.isSessionKeyExpiredError)&&(this._logger.debug("session expired"),this.handler.onSessionExpired&&this.handler.onSessionExpired(),this._currentConnectionStateType===exports.ConnectionStateType.CONNECTED&&this._dispatcher.dispatch(new Ne(new Pe({type:exports.StatType.WEBSOCKET_DISCONNECT,data:{success:!0,error_code:exports.SendbirdErrorCode.SESSION_KEY_EXPIRED,error_description:"cause=session_expired"}}))),this.refreshSessionKey().catch((e=>{if(n(e)&&"foreground"===this._sdkState.appState)throw e}))))}}))}get ekey(){return wo.get(this)}get deviceTokens(){return this._deviceTokens}get deviceTokenLastDeletedAt(){return this._deviceTokenLastDeletedAt}indexOfDeviceToken(e,t){return this._deviceTokens.findIndex((s=>s.type===e&&s.token===t))}hasDeviceToken(e,t){return this.indexOfDeviceToken(e,t)>=0}createRefreshWebsocketCommand(e,t){return new ke({authToken:e,expiringSession:!0,requestId:t})}_refreshSessionKeyByWebSocket(t){return e(this,void 0,void 0,(function*(){const e=this.createRefreshWebsocketCommand(t),s=yield this._requestQueue.forceSend(e),{newKey:i,error:n}=s.as(Oe);if(n)throw n;this.session.sessionKey=null!=i?i:this.session.sessionKey}))}_refreshSessionKeyByApi(t){return e(this,void 0,void 0,(function*(){const s=new xe({userId:this._sdkState.userId,authToken:t,services:this.session.services&&this.session.services.length>0?this.session.services:void 0,expiringSession:!0});yield no((t=>e(this,void 0,void 0,(function*(){try{const e=yield this._requestQueue.forceSend(s),{key:t,services:i}=e.as(Re);this.session.sessionKey=t,this.session.services=i}catch(e){if(!this._isSessionRelatedError(e))throw e;t(e)}}))),3)}))}_refreshSessionKey(t,s=!0){return e(this,void 0,void 0,(function*(){if(this._currentConnectionStateType===exports.ConnectionStateType.CONNECTED)try{return yield this._refreshSessionKeyByWebSocket(t),void this.complete()}catch(e){try{return void(yield this._handleSessionRefreshError(e,s))}catch(e){}}try{yield this._refreshSessionKeyByApi(t),this.complete()}catch(e){yield this._handleSessionRefreshError(e,s)}}))}_receiveNewAuthToken(){var t;const s=new Be;if(this._isRefreshingAuthToken=!0,this.session.sessionKey=void 0,this.session.authToken=void 0,null===(t=this.handler)||void 0===t?void 0:t.onSessionTokenRequired){let t=null;const i=()=>{t&&(clearTimeout(t),t=null)},n=e=>{i(),this._isRefreshingAuthToken&&(this._isRefreshingAuthToken=!1,s.resolve(e))},o=e=>{i(),this._isRefreshingAuthToken&&(this._isRefreshingAuthToken=!1,s.reject(e))};t=setTimeout((()=>o()),1e3*this._sdkState.sessionTokenRefreshTimeout),_n((()=>e(this,void 0,void 0,(function*(){var e;(null===(e=this.handler)||void 0===e?void 0:e.onSessionTokenRequired)&&this.handler.onSessionTokenRequired(n,o)}))))}else s.resolve(null);return s.promise}_handleSessionRefreshError(t,s=!1){return e(this,void 0,void 0,(function*(){if(!(t instanceof o&&(t.isSessionTokenExpiredError||t.code===exports.SendbirdErrorCode.APPLICATION_NOT_FOUND)&&(this.session.authToken=void 0,s)))throw t;{const e=yield this._receiveNewAuthToken();e?(this.session.authToken=e,yield this._refreshSessionKey(this.session.authToken,!1)):yield this.clear()}}))}_isSessionRelatedError(e){return e instanceof o&&(e.isSessionExpiredError||e.isSessionInvalidatedError)}get isSessionKeyRefreshing(){return this.session.isRefreshing}get isRefreshingAuthToken(){return this._isRefreshingAuthToken}get isSessionExpiring(){return!!this.handler}authenticate(t,s){var i;return e(this,void 0,void 0,(function*(){this.session.authToken=s;let e=0;const n=yield this._cacheContext.preference.get(Ln(this._sdkState.appId));n&&(e=n.configTs);const o=new Eo({appId:this._sdkState.appId,userId:t,includeUIKitConfig:!!(null!==(i=this._sdkState.extensions)&&void 0!==i?i:{}).sb_uikit,localCacheEnabled:this._cacheContext.localCacheEnabled,expiringSession:this.isSessionExpiring,configTs:e}),r=yield this._requestQueue.commandRouter.send(o),{logi:a}=r.as(mo);if(a.error)throw a.error;this.session.hasChatServicePermission||(yield a.applyTo(this._iid))}))}login(t){var s;return e(this,void 0,void 0,(function*(){const{key:e,ekey:i,services:n,userProfile:o,deviceTokenLastDeletedAt:r=0}=t;this.session.sessionKey=e,this.session.services=n,wo.set(this,i),this._deviceTokenCacheEnabled=null===(s=null==o?void 0:o.appInfo)||void 0===s?void 0:s.deviceTokenCache;const{preference:a}=this._cacheContext;if(this._deviceTokenCacheEnabled){const e=yield a.get(Co);!e||e.lastDeletedAt<r?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=r,yield this.saveDeviceToken()):(this._deviceTokens=e.tokens.map((e=>new To(To.payloadify(e)))),this._deviceTokenLastDeletedAt=e.lastDeletedAt)}else yield a.remove(Co)}))}complete(){this.dispatch("refresh"),this._dispatcher.dispatch(new Sn),_n((()=>e(this,void 0,void 0,(function*(){var e;this._logger.debug("session refreshed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionRefreshed)&&this.handler.onSessionRefreshed()}))))}error(t){_n((()=>e(this,void 0,void 0,(function*(){var e;(null===(e=this.handler)||void 0===e?void 0:e.onSessionError)&&this.handler.onSessionError(t)}))))}close(){this.dispatch("close"),this._dispatcher.dispatch(new Tn),_n((()=>e(this,void 0,void 0,(function*(){var e;this._logger.debug("session closed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionClosed)&&this.handler.onSessionClosed()}))))}refreshAuthToken(){return e(this,void 0,void 0,(function*(){let e=null;if(this.isSessionExpiring&&!this.session.isRefreshing){this.session.isRefreshing=!0;try{e=yield this._receiveNewAuthToken(),e?(this._logger.debug("session refreshing.."),this.session.authToken=e,yield this._refreshSessionKey(this.session.authToken)):yield this.clear()}catch(t){const s=e?o.sessionTokenRefreshFailed:o.sessionTokenRequestFailed;throw this._dispatcher.dispatch(new Cn),this.error(s),this._logger.debug("refresh auth token error = ",s),s}finally{this.session.isRefreshing=!1}}}))}refreshSessionKey(){return e(this,void 0,void 0,(function*(){if(this.isSessionExpiring&&!this.session.isRefreshing){this.session.isRefreshing=!0;try{yield this._refreshSessionKey(this.session.authToken)}catch(e){const t=o.sessionTokenRefreshFailed;throw this._dispatcher.dispatch(new Cn),this.error(t),t}finally{this.session.isRefreshing=!1}}}))}setDeviceToken(e,t,s){if(this._deviceTokenCacheEnabled){if(this.indexOfDeviceToken(e,t)<0){const i=new To({type:e,token:t,device_os:null==s?void 0:s.deviceOS,device_manufacturer:null==s?void 0:s.deviceManufacturer,system_push_enabled:null==s?void 0:s.systemPushEnabled});return this._deviceTokens.push(i),!0}}return!1}unsetDeviceToken(e,t){if(this._deviceTokenCacheEnabled){const s=this.indexOfDeviceToken(e,t);s>=0&&this._deviceTokens.splice(s,1)}}unsetDeviceTokens(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter((t=>t.type!==e)):[])}setDeviceTokenDeletedAt(e){e>0&&(this._deviceTokenLastDeletedAt=e)}saveDeviceToken(){return e(this,void 0,void 0,(function*(){if(this._deviceTokenCacheEnabled){const{preference:e}=this._cacheContext;yield e.set(Co,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})}}))}clear(){return e(this,void 0,void 0,(function*(){this.currentUser=null,this.session.clear(),this.close(),wo.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,yield this.saveDeviceToken(),this._pushNotificationAckManager.clear()}))}}const Io=(e,t)=>{if(null!==e&&null!==t){const s=Object.keys(e),i=Object.keys(t),n=[...new Set([...s,...i])],o={};for(const s of n){const i=typeof e[s],n=typeof t[s];"undefined"===i?o[s]=t[s]:"undefined"===n?o[s]=e[s]:i!==n?o[s]=t[s]:"object"===i&&e[s]&&t[s]?o[s]=Io(e[s],t[s]):o[s]=t[s]}return o}return t};var Ao,xo;!function(e){e[e.PENDING=0]="PENDING",e[e.COLLECT_ONLY=1]="COLLECT_ONLY",e[e.ENABLED=2]="ENABLED",e[e.DISABLED=3]="DISABLED"}(Ao||(Ao={})),function(e){e.DAILY="daily",e.DEFAULT="default",e.REALTIME="realtime"}(xo||(xo={}));const ko=100;class Ro{constructor({deviceId:e,cacheContext:t,requestQueue:s}){this.queue=[],this.flushWaitQueue=[],this.enabledState=Ao.PENDING,this.isFlushing=!1,this._sentLogStats=[],this.deviceId=e,this.cacheContext=t,this.requestQueue=s,this.logInfo={deviceId:e,statLogs:[],generation:1,lastFlushedAt:0},this.limit=ko}get isEnabled(){return this.enabledState===Ao.ENABLED}init(t){return e(this,void 0,void 0,(function*(){this.key=t;const e=yield this.cacheContext.preference.get(this.key);e&&(this.logInfo=e)}))}_mergeQueue(){this.flushWaitQueue.length>0&&(this.queue=this.queue.concat(this.flushWaitQueue),this.flushWaitQueue=[])}_isDuplicateStat(e){const t=this._sentLogStats.find((t=>{var s;return t.channelUrl===e.data.channel_url&&t.messageId===(null!==(s=e.data.notificationId)&&void 0!==s?s:e.data.message_id)&&t.action===e.data.action}));return t||this._sentLogStats.push({channelUrl:e.data.channel_url,messageId:e.data.message_id,action:e.data.action}),!!t}_save(){return e(this,void 0,void 0,(function*(){const e=[...this.queue,...this.flushWaitQueue];yield this.cacheContext.preference.set(this.key,{deviceId:this.logInfo.deviceId,statLogs:e.map((e=>Pe.payloadify(e))),generation:this.logInfo.generation++,lastFlushedAt:this.logInfo.lastFlushedAt})}))}clear(){return e(this,void 0,void 0,(function*(){this.queue=[],this.flushWaitQueue=[],this.logInfo.generation=1,this._save()}))}}class Oo extends Pe{constructor({type:e,data:t,ts:s=Date.now()}){var i;super({type:e,data:t,ts:s}),this.date=new Date(s),this.key=`${i=this.date,`${i.getFullYear()}${String(i.getMonth()+1).padStart(2,"0")}${String(i.getDate()).padStart(2,"0")}`}_${e}`}}class No extends Ce{constructor({deviceId:e,statLogs:t}){super(),this.method=exports.APIRequestMethod.POST,this.path=`${ae}`,this.params={device_id:e,log_entries:t.map((e=>Pe.payloadify(e)))}}}class Do extends Ro{constructor({deviceId:e,cacheContext:t,requestQueue:s}){super({deviceId:e,cacheContext:t,requestQueue:s})}get _isSendable(){return 0!==this.queue.length&&Date.now()-this.logInfo.lastFlushedAt>=this.statConfig.minInterval}init(t){const s=Object.create(null,{init:{get:()=>super.init}});return e(this,void 0,void 0,(function*(){yield s.init.call(this,t+".daily"),this.queue=this.logInfo.statLogs.map((e=>new Pe({type:e.stat_type,ts:e.ts,data:e.data})))}))}setConfig(t,s){return e(this,void 0,void 0,(function*(){if(this.statConfig=t,this.statConfig.minInterval=864e5,this._mergeQueue(),s.localCacheStat?this.enabledState=s.enabledStat?Ao.ENABLED:Ao.COLLECT_ONLY:(this.enabledState=Ao.DISABLED,yield this.clear()),this.isEnabled&&this._isSendable){const e=yield this._getUploadStats(),t=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100);for(let s=0;s<e.length;s+=this.statConfig.maxStatCountPerRequest){const i=e.slice(s,1+this.statConfig.maxStatCountPerRequest);yield so(t),yield this._flush(i)}}}))}put(t){return e(this,void 0,void 0,(function*(){if(this.enabledState===Ao.DISABLED)return!0;const e=this.enabledState===Ao.PENDING||this.isFlushing?this.flushWaitQueue:this.queue,[s]=e.filter((e=>e instanceof Oo&&e.key===t.key));if(s?s.data=Io(s.data,t.data):e.push(t),this.enabledState!==Ao.PENDING&&(yield this._save()),this.isEnabled&&(this._mergeQueue(),this._isSendable)){const e=yield this._getUploadStats();return yield this._flush(e)}return!0}))}_getUploadStats(){return e(this,void 0,void 0,(function*(){return this.queue.filter((e=>{if(e instanceof Oo){const t=new Date,[s,i]=[e.date.getFullYear(),t.getFullYear()];if(s<i)return!0;if(s===i){const[s,i]=[e.date.getMonth(),t.getMonth()];if(s<i)return!0;if(s===i){const[s,i]=[e.date.getDate(),t.getDate()];return s<i}}}return!1}))}))}_flush(t){return e(this,void 0,void 0,(function*(){let e=!0;if(t.length>0){if(!this.isFlushing){this.isFlushing=!0;try{const e=[...t].slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),s=new No({deviceId:this.deviceId,statLogs:e});yield this.requestQueue.send(s),this.queue=[...t].slice(e.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=ko,this.logInfo.lastFlushedAt=Date.now(),yield this._save()}catch(t){t instanceof o&&(t.code===exports.SendbirdErrorCode.NON_AUTHORIZED?(yield this.clear(),this.enabledState=Ao.DISABLED):t.code===exports.SendbirdErrorCode.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=Ao.COLLECT_ONLY)),this.limit=this.limit+20,e=!1}finally{this.isFlushing=!1}}}else this.isFlushing=!1;return e}))}}class Lo extends Ro{constructor({deviceId:e,cacheContext:t,requestQueue:s}){super({deviceId:e,cacheContext:t,requestQueue:s})}_isSendable(e=!1){if(this.queue.length<this.statConfig.lowerThreshold)return!1;if(e){if(Date.now()-this.logInfo.lastFlushedAt<this.statConfig.minInterval)return!1}else if(this.queue.length<this.statConfig.minStatCount)return!1;return!0}_filterQueueByType(t,s){return e(this,void 0,void 0,(function*(){return s?t.filter((e=>e.type!==exports.StatType.FEATURE_LOCALCACHE_EVENT)):t.filter((e=>e.type===exports.StatType.FEATURE_LOCALCACHE_EVENT))}))}init(t){const s=Object.create(null,{init:{get:()=>super.init}});return e(this,void 0,void 0,(function*(){yield s.init.call(this,t+".default"),this.queue=this.logInfo.statLogs.map((e=>(e.data=Object.assign({message_init_policy:"",starting_point:0},e.data),new Pe({type:e.stat_type,ts:e.ts,data:e.data}))))}))}setConfig(t,s){return e(this,void 0,void 0,(function*(){if(this.statConfig=t,this._mergeQueue(),s.requestStat||s.localCacheStat){let e;this.enabledState=s.enabledStat?Ao.ENABLED:Ao.COLLECT_ONLY,s.requestStat||(e=!1),s.localCacheStat||(e=!0),void 0!==e&&(this.queue=yield this._filterQueueByType(this.queue,e),this.flushWaitQueue=yield this._filterQueueByType(this.flushWaitQueue,e),this._save())}else this.enabledState=Ao.DISABLED,yield this.clear();if(this.isEnabled&&this._isSendable(!0)){const e=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100);yield so(e),yield this._flush(this.queue)}}))}put(t){return e(this,void 0,void 0,(function*(){if(this.enabledState===Ao.DISABLED)return!0;const e=this.enabledState===Ao.PENDING||this.isFlushing?this.flushWaitQueue:this.queue;return e.push(t),this.enabledState!==Ao.PENDING&&(yield this._save()),!this.isEnabled||(this._mergeQueue(),!this._isSendable())||(yield this._flush(e))}))}_flush(t){return e(this,void 0,void 0,(function*(){let e=!0;if(t.length>0){if(!this.isFlushing){this.isFlushing=!0;try{const e=[...t].slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),s=new No({deviceId:this.deviceId,statLogs:e});yield this.requestQueue.send(s),this.queue=[...t].slice(e.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=ko,this.logInfo.lastFlushedAt=Date.now(),yield this._save()}catch(t){t instanceof o&&(t.code===exports.SendbirdErrorCode.NON_AUTHORIZED?(yield this.clear(),this.enabledState=Ao.DISABLED):t.code===exports.SendbirdErrorCode.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=Ao.COLLECT_ONLY)),this.limit=this.limit+20,e=!1}finally{this.isFlushing=!1}}}else this.isFlushing=!1;return e}))}}class Po extends Ce{constructor({deviceId:e,statLogs:t}){super(),this.method=exports.APIRequestMethod.POST,this.path=`${de}`,this.params={device_id:e,log_entries:t.map((e=>Pe.payloadify(e)))}}}class Uo extends Ro{constructor({deviceId:e,cacheContext:t,requestQueue:s}){super({deviceId:e,cacheContext:t,requestQueue:s})}get _isSendable(){return this.queue.length>=this.statConfig.minStatCount&&this.queue.length>this.statConfig.lowerThreshold||this.logInfo.lastFlushedAt>0&&Date.now()-this.logInfo.lastFlushedAt>=this.statConfig.minInterval}init(t){const s=Object.create(null,{init:{get:()=>super.init}});return e(this,void 0,void 0,(function*(){yield s.init.call(this,t+".realtime"),this.queue=this.logInfo.statLogs.map((e=>{var t;return e.data=O(Object.assign(Object.assign({},e.data),{message_id:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,notificationId:void 0})),new Pe({type:e.stat_type,ts:e.ts,data:e.data})})),this._sentLogStats=this.queue.map((e=>{var t;return{channelUrl:e.data.channelUrl,messageId:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,action:e.data.action}}))}))}setConfig(t,s){return e(this,void 0,void 0,(function*(){if(this.statConfig=t,this._mergeQueue(),s.notificationStat?this.enabledState=s.enabledStat?Ao.ENABLED:Ao.COLLECT_ONLY:(this.enabledState=Ao.DISABLED,yield this.clear()),this.isEnabled&&this._isSendable){const e=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100);yield so(e),yield this._flush(this.queue)}}))}put(t){return e(this,void 0,void 0,(function*(){if(this.enabledState===Ao.DISABLED)return!0;const e=this.enabledState===Ao.PENDING||this.isFlushing?this.flushWaitQueue:this.queue;return!!this._isDuplicateStat(t)||(e.push(t),this.enabledState!==Ao.PENDING&&(yield this._save()),!(this.isEnabled&&(this._mergeQueue(),this.isEnabled&&this._isSendable))||(yield this._flush(e)))}))}_flush(t){return e(this,void 0,void 0,(function*(){let e=!0;if(t.length>0){if(!this.isFlushing){this.isFlushing=!0;try{const e=[...t].slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),s=new Po({deviceId:this.deviceId,statLogs:e});yield this.requestQueue.send(s),this.queue=[...t].slice(e.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=ko,this.logInfo.lastFlushedAt=Date.now(),yield this._save()}catch(t){t instanceof o&&(t.code===exports.SendbirdErrorCode.NON_AUTHORIZED?(yield this.clear(),this.enabledState=Ao.DISABLED):t.code===exports.SendbirdErrorCode.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=Ao.COLLECT_ONLY)),this.limit=this.limit+20,e=!1}finally{this.isFlushing=!1}}}else this.isFlushing=!1;return e}))}}class Mo{constructor({cacheContext:e,requestQueue:t,dispatcher:s,logger:i}){this._collectRequestStat=!0,this._collectFeatureLocalCacheStat=!0,this._collectionNotificationStat=!0,this._retryCount=0,this.deviceId=I(),this.cacheContext=e,this.requestQueue=t,this.dispatcher=s,this.logger=i,this._dailyStatCollector=new Do({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue}),this._defaultStatCollector=new Lo({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue}),this._notificationStatCollector=new Uo({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue})}_migration(){return e(this,void 0,void 0,(function*(){const e=yield this.cacheContext.preference.get(this.key);if(e){const t=[];e.statLogs.forEach((e=>{e.stat_type===exports.StatType.FEATURE_LOCALCACHE&&t.push(new Pe({type:e.stat_type,ts:e.ts,data:e.data}))})),yield this.cacheContext.preference.set(this.key+".daily",{deviceId:e.deviceId,statLogs:t.map((e=>Pe.payloadify(e))),generation:e.generation,lastFlushedAt:e.lastFlushedAt});const s=[];e.statLogs.forEach((e=>{e.stat_type!==exports.StatType.FEATURE_LOCALCACHE&&e.stat_type!==exports.StatType.NOTIFICATION&&(e.stat_type===exports.StatType.FEATURE_LOCALCACHE_EVENT&&(e.data=Object.assign({message_init_policy:"",starting_point:0},e.data)),s.push(new Pe({type:e.stat_type,ts:e.ts,data:e.data})))})),yield this.cacheContext.preference.set(this.key+".default",{deviceId:e.deviceId,statLogs:s.map((e=>Pe.payloadify(e))),generation:e.generation,lastFlushedAt:e.lastFlushedAt});const i=[];e.statLogs.forEach((e=>{var t;e.stat_type===exports.StatType.NOTIFICATION&&(e.data=O(Object.assign(Object.assign({},e.data),{message_id:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,notificationId:void 0})),i.push(new Pe({type:e.stat_type,ts:e.ts,data:e.data})))})),yield this.cacheContext.preference.set(this.key+".realtime",{deviceId:e.deviceId,statLogs:i.map((e=>Pe.payloadify(e))),generation:e.generation,lastFlushedAt:e.lastFlushedAt}),yield this.cacheContext.preference.remove(this.key)}}))}init(t){return e(this,void 0,void 0,(function*(){this.key=t,yield this._migration(),yield this._dailyStatCollector.init(this.key),yield this._defaultStatCollector.init(this.key),yield this._notificationStatCollector.init(this.key),this.commandEventContext||(this.commandEventContext=this.dispatcher.on((t=>e(this,void 0,void 0,(function*(){var e;if(t instanceof Ne){const{statLog:e}=t;this.put(e)}else if(t instanceof Zn){const{request:s,features:i,options:n,statConfigInfo:o}=t;this._retryCount=0,this._collectRequestStat=s,this._collectFeatureLocalCacheStat=null==i?void 0:i.localCache,this._collectionNotificationStat=null==i?void 0:i.notification,this._statConfig=o,this._dailyStatCollector.setConfig(this._statConfig.default,{localCacheStat:this._collectFeatureLocalCacheStat,enabledStat:n.ingestion}),this._defaultStatCollector.setConfig(this._statConfig.default,{requestStat:this._collectRequestStat,localCacheStat:this._collectFeatureLocalCacheStat,enabledStat:n.ingestion}),this._notificationStatCollector.setConfig(null!==(e=this._statConfig.realTime)&&void 0!==e?e:this._statConfig.default,{notificationStat:this._collectionNotificationStat,enabledStat:n.ingestion})}})))))}))}put(t){return e(this,void 0,void 0,(function*(){let e=!0;if(t instanceof Oo)this._collectFeatureLocalCacheStat&&(e=yield this._dailyStatCollector.put(t));else switch(t.type){case exports.StatType.API_RESULT:case exports.StatType.WEBSOCKET_CONNECT:case exports.StatType.WEBSOCKET_DISCONNECT:this._collectRequestStat&&(e=yield this._defaultStatCollector.put(t));break;case exports.StatType.FEATURE_LOCALCACHE:case exports.StatType.FEATURE_LOCALCACHE_EVENT:this._collectFeatureLocalCacheStat&&(e=yield this._defaultStatCollector.put(t));break;case exports.StatType.NOTIFICATION:this._collectionNotificationStat&&(e=yield this._notificationStatCollector.put(t))}e?this._retryCount=0:(this._retryCount++,this._retryCount>20&&(this._dailyStatCollector.enabledState=Ao.COLLECT_ONLY,this._defaultStatCollector.enabledState=Ao.COLLECT_ONLY,this._notificationStatCollector.enabledState=Ao.COLLECT_ONLY,this.logger.debug(o.statLogUploadLimitExceededError)))}))}close(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)}}class qo{constructor({limit:e=5}){this.workersByKey={},this.limit=e}run(t,s){return e(this,void 0,void 0,(function*(){if(this.workersByKey[t]||(this.workersByKey[t]=[]),this.workersByKey[t].length<this.limit){this.workersByKey[t].push(s);const e=yield s();return this.workersByKey[t].pop(),e}throw o.tooManyRequests}))}clear(e){this.workersByKey[e]=[]}}var Fo;exports.PushSessionKeyTopic=void 0,(Fo=exports.PushSessionKeyTopic||(exports.PushSessionKeyTopic={})).DELIVERY_RECEIPT="delivery_receipt",Fo.PUSH_ACKNOWLEDGEMENT="push_acknowledgement";class zo extends Pn{constructor(){super(...arguments),this._pushAckedCache={}}isAcked(e,t){var s;const i=`${e}_${t}`;return null!==(s=this._pushAckedCache[i])&&void 0!==s&&s}markAsAcked(e,t){const s=`${e}_${t}`;this._pushAckedCache[s]=!0}clear(){const{logger:e}=jo.of(this._iid);e.debug("clear push acked cache"),this._pushAckedCache={}}parseData(e){var t,s,i,n;const{logger:r}=jo.of(this._iid);let a=e.sendbird;if("string"==typeof a)try{a=JSON.parse(a)}catch(e){throw r.info("push notification payload does not contain sendbird payload in JSON format."),o.malformedDataError}if(!a||"object"!=typeof a)throw r.info("push notification payload does not contain sendbird payload in JSON format."),o.malformedDataError;const d=null!==(t=a.push_tracking_id)&&void 0!==t?t:"",c=a.notification_message_id,l=a.notification_channel_key,h=a.notification_template_key,u=a.notification_event_deadline,_=null!==(s=a.session_key)&&void 0!==s?s:{},p=null!==(i=null==_?void 0:_.key)&&void 0!==i?i:"",f=null!==(n=null==_?void 0:_.topics)&&void 0!==n?n:[];if("string"!=typeof d||0===d.length)throw r.info("push tracking id is not available"),o.malformedDataError;if("string"!=typeof c||0===c.length)throw r.info("message id is not available"),o.malformedDataError;return{pushTrackingId:d,sessionKey:p,sessionTopics:f,messageId:c,channelKey:l,templateKey:h,notificationEventDeadline:u}}}class Ko{constructor(e){this.name=e.name,this._custom=e.custom,this._usedByModerationEngine=e.used_by_moderation_engine}}class Ho extends Ce{constructor(){super(),this.method=exports.APIRequestMethod.GET,this.path=pe}}class Bo extends Te{constructor(e,t){super(e,t),this.reportCategories=t.categories}}class Qo extends Pn{constructor(e){super(e),this._categories=[]}categories(){return e(this,void 0,void 0,(function*(){return 0===this._categories.length&&(yield this._fetchCategories()),this._categories}))}_fetchCategories(){return e(this,void 0,void 0,(function*(){const{requestQueue:e}=jo.of(this._iid),t=new Ho,s=yield e.send(t),{reportCategories:i}=s.as(Bo);i&&this._categories.push(...i.map((e=>new Ko(e))))}))}}class $o{constructor(){this._enabledRequestDedup=!0,this._requestCache=new Map,this._requestDedupInterval=500}set requestDedupInterval(e){this._requestDedupInterval=e,this._requestDedupInterval<=0?this._enabledRequestDedup=!1:e<50&&(this._requestDedupInterval=50)}normalizePath(e){return e.replace("/v3/sdk/","/v3/")}_generateCacheKey(e){const{path:t,time:s,params:i}=e;return`${this.normalizePath(t)}?${i?Object.entries(i).sort((([e],[t])=>e.localeCompare(t))).map((([e,t])=>`${e}=${JSON.stringify(t)}`)).join("&"):""}${s?`_${s}`:""}`}requestGetChannel(e,t,s,i=!0){if(!this._enabledRequestDedup)return t();const n=Date.now(),o=this._generateCacheKey({path:e,params:s});if(i)for(const[e,t]of this._requestCache.entries())if(e.startsWith(o)){if(n-t.requestTime<=this._requestDedupInterval)return t.pendingResponse?Promise.resolve(t.pendingResponse):t.promise}const r=i?this._generateCacheKey({path:e,time:n,params:s}):o,a=t().then((e=>{const t=this._requestCache.get(r);return t&&(t.pendingResponse=e,t.responseTime=Date.now()),Promise.resolve(e)})).catch((e=>Promise.reject(e))).finally((()=>{setTimeout((()=>{this._requestCache.delete(r)}),this._requestDedupInterval)})),d={requestTime:n,responseTime:null,promise:a,pendingResponse:null};return this._requestCache.set(r,d),a}updatePendingResponse(e,t){for(const[s,i]of this._requestCache.entries())if(s.includes(e.url)&&i.pendingResponse&&i.responseTime<t){const t=i.pendingResponse.payload,s=e.constructor.payloadify(e,!0),n=Object.assign(Object.assign({},t),s);i.pendingResponse=new Te(e._iid,n);break}}}const Wo={};class jo{constructor(e,t){var s,n,o,r,a,d,c,l,h;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Wo[e]){Wo[e]=this;const u=null!==(s=t.options)&&void 0!==s?s:new _,p=this.sdkState={appId:t.appId,appVersion:null!==(n=t.appVersion)&&void 0!==n?n:"",appState:"foreground",userId:void 0,extensions:{},api:{host:null!==(o=t.apiHost)&&void 0!==o?o:`https://api-${t.appId}.sendbird.com`},websocket:{host:null!==(r=t.websocketHost)&&void 0!==r?r:`wss://ws-${t.appId}.sendbird.com`,pingerDisabled:!!t.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new io,responseTimeout:u.websocketResponseTimeout},sessionTokenRefreshTimeout:u.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};const f=this.logger=t.logger;this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;const E=this.cacheContext=new g({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(a=t.localCacheEnabled)&&void 0!==a&&a,localCacheConfig:null!==(d=t.localCacheConfig)&&void 0!==d?d:new T});this.debugMode=null!==(c=t.debugMode)&&void 0!==c&&c,this.maxSuperGroupChannelUnreadCount=i.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=u.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=u.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=u.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;const m=this.dispatcher=new k,v=new b;this.requestQueue=new So(e,{session:v,sdkState:p,dispatcher:m,logger:f,useFetchCompat:t.useFetchCompat}),this.pushNotificationAckManager=new zo(e),this.sessionManager=new bo({_iid:e,session:v,cacheContext:E,sdkState:p,dispatcher:m,requestQueue:this.requestQueue,logger:f,pushNotificationAckManager:this.pushNotificationAckManager}),this.connectionManager=new co(e,{sdkState:p,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:m,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(l=t.disableWebSocketCloseEventHandling)&&void 0!==l&&l,logger:f}),this.statManager=new Mo({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:this.dispatcher,logger:f}),this.appStateToggleEnabled=null===(h=t.appStateToggleEnabled)||void 0===h||h,this.messageBackgroundSyncThrottleController=new qo({limit:5}),this.reportCategoryManager=new Qo(e),this.requestDeduplicator=new $o}return Wo[e]}static of(e){if(Wo[e])return Wo[e];throw o.lostInstance}static clear(e){Wo[e]&&delete Wo[e]}hasExtension(e){return this.sdkState.extensions&&this.sdkState.extensions[e]}}exports.AIAgentInfo=kn,exports.APIRequestCommand=Ce,exports.APIResponseCommand=Te,exports.API_PATH_AI_AGENT=ge,exports.API_PATH_AI_AGENT_GROUP_CHANNELS=Ee,exports.API_PATH_APP_SETTINGS_INTERNAL=fe,exports.API_PATH_EMOJIS=se,exports.API_PATH_EMOJI_CATEGORIES=ie,exports.API_PATH_FORMS=_e,exports.API_PATH_GROUP_CHANNELS=V,exports.API_PATH_GROUP_CHANNELS_INTERNAL=Y,exports.API_PATH_MESSAGE_TEMPLATE=he,exports.API_PATH_NOTIFICATIONS=ce,exports.API_PATH_NOTIFICATIONS_USERS=le,exports.API_PATH_OPEN_CHANNELS=X,exports.API_PATH_OPEN_CHANNELS_INTERNAL=J,exports.API_PATH_POLLS=ne,exports.API_PATH_PUSH_DELIVERY=ue,exports.API_PATH_REPORT=te,exports.API_PATH_SCHEDULED_MESSAGES=oe,exports.API_PATH_SEARCH=ee,exports.API_PATH_UIKIT_CONFIGURATION=re,exports.API_PATH_UPLOAD=Z,exports.API_PATH_USERS=j,exports.AppInfo=Dn,exports.BaseCommand=R,exports.BaseListQuery=class{constructor(e,t){var s;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(s=t.limit)&&void 0!==s?s:20}get hasNext(){return this._hasNext}get isLoading(){return this._isLoading}_validate(){return d("number",this.limit)&&this.limit>0}},exports.CachedChannelInfo=class{constructor({channel:e,cachedMessageCount:t}){this._cachedMessageCount=0,this._channel=e,this._cachedMessageCount=t}get channel(){return this._channel}get cachedMessageCount(){return this._cachedMessageCount}},exports.CancelXMLHttpRequestCommand=Qe,exports.ConnectionStateChangeCommand=yn,exports.DEFAULT_ENCRYPTION=p,exports.DEFAULT_MULTIPLE_FILES_MESSAGE_FILE_COUNT_LIMIT=5,exports.DailyRecordStatLog=Oo,exports.Deferred=Be,exports.DeleteMessageEventCommand=class extends Ie{constructor(e,t,s){var i;super(e,"DELM",s),this.channelUrl=s.channel_url,this.channelType=s.channel_type,this.messageId=Number(s.msg_id),this.silent=s.silent,this.messageCreatedAt=s.message_created_at?Number(s.message_created_at):-1,this.senderId=null!==(i=s.sender_id)&&void 0!==i?i:void 0}},exports.DeleteMessageRequestCommand=$e,exports.EventDispatcher=x,exports.InstancedObject=Pn,exports.LocalCacheConfig=T,exports.Module=class{init(e,{sdkState:t,dispatcher:s,sessionManager:i,requestQueue:n,logger:o,onlineDetector:r,cacheContext:a}){this._iid=e,this._cacheContext=a,this._sdkState=t,this._dispatcher=s,this._sessionManager=i,this._requestQueue=n,this._logger=o}},exports.NotificationInfo=wn,exports.ReportCategoryInfo=Ko,exports.RequestResendCommand=De,exports.SEMVER_REGEX_STRING="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",exports.SendbirdChatOptions=_,exports.SendbirdError=o,exports.SessionExpiredCommand=be,exports.SessionRefreshAPICommand=xe,exports.StatLog=Pe,exports.StatLogCommand=Ne,exports.SubscribedUnreadMessageCountUpdateCommand=mn,exports.SyncAppConfigsInfoEventCommand=Vn,exports.UIKitConfigInfo=bn,exports.User=Wn,exports.UserProfile=Gn,exports.UserProfileUpdateCommand=jn,exports.Vault=jo,exports.WebSocketEventCommand=Ie,exports.WebSocketRequestCommand=Ae,exports.__awaiter=e,exports.__rest=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(s[i[n]]=e[i[n]])}return s},exports.asyncRetry=no,exports.calculateMentionCountChange=(e,t,s)=>{var i,n,o,r;const a=ve(null!==(i=e.mentionType)&&void 0!==i?i:null,null!==(n=e.mentionedUserIds)&&void 0!==n?n:[],s),d=ve(null!==(o=t.mentionType)&&void 0!==o?o:null,null!==(r=t.mentionedUserIds)&&void 0!==r?r:[],s);return!a&&d?1:a&&!d?-1:0},exports.checkIfMentioned=ve,exports.createAppConfigsTsCacheKey=Ln,exports.createChangelogIncludeChatNotificationsCacheKey=e=>`sendbird@${e}/changelog_include_chat_notifications`,exports.deepEqual=(e,t)=>{if(e!==t){const s=Object.assign({},e),i=Object.assign({},t);return(!s.hasOwnProperty("messageId")||!i.hasOwnProperty("messageId")||s.messageId===i.messageId)&&((!s.hasOwnProperty("reqId")||!i.hasOwnProperty("reqId")||s.reqId===i.reqId)&&(s.hasOwnProperty("messageId")&&delete s.messageId,s.hasOwnProperty("reqId")&&delete s.reqId,i.hasOwnProperty("messageId")&&delete i.messageId,i.hasOwnProperty("reqId")&&delete i.reqId,JSON.stringify(s)===JSON.stringify(i)))}return!0},exports.deserialize=Bn,exports.deundefined=O,exports.getChannelApiPathByType=me,exports.getReportApiPathByType=e=>{switch(e){case exports.ChannelType.GROUP:return`${te}/group_channels`;case exports.ChannelType.OPEN:return`${te}/open_channels`;default:return null}},exports.hasSameMembers=(e,t)=>{if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;const s=[...e].sort(),i=[...t].sort();for(let e=0;e<s.length;++e)if(s[e]!==i[e])return!1;return!0},exports.isArrayOf=(e,t,s=!1)=>!(!s||!u(t))||Array.isArray(t)&&t.every((t=>d(e,t))),exports.isAutoResendableError=e=>e>0&&a.indexOf(e)>=0,exports.isEnumOf=c,exports.isFile=h,exports.isMilliSecondOf=(e,t=!1)=>!(!t||!u(e))||"number"==typeof e&&13===e.toString().length,exports.isReactNative=Ue,exports.isResendableError=e=>e>0&&r.indexOf(e)>=0,exports.isThrowingOutside=n,exports.isTypeOf=d,exports.noop=je,exports.runAsCallback=_n,exports.runOrNothing=pn,exports.serialize=Hn,exports.sleep=so,exports.undefineNullProps=N,exports.unless=Qn,exports.uuid=I,exports.version=s;
