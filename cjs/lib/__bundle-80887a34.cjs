var e,t=require("./__bundle-a11d6b6e.cjs");exports.CollectionEventSource=void 0,(e=exports.CollectionEventSource||(exports.CollectionEventSource={})).UNKNOWN="UNKNOWN",e.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",e.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",e.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",e.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",e.EVENT_CHANNEL_UNREAD="EVENT_CHANNEL_UNREAD",e.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",e.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",e.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",e.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",e.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",e.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",e.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",e.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",e.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",e.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",e.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",e.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",e.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",e.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",e.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",e.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",e.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",e.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",e.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",e.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",e.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",e.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",e.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",e.REQUEST_CHANNEL="REQUEST_CHANNEL",e.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",e.REFRESH_CHANNEL="REFRESH_CHANNEL",e.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",e.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",e.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_FEEDBACK_ADDED="EVENT_MESSAGE_FEEDBACK_ADDED",e.EVENT_MESSAGE_FEEDBACK_UPDATED="EVENT_MESSAGE_FEEDBACK_UPDATED",e.EVENT_MESSAGE_FEEDBACK_DELETED="EVENT_MESSAGE_FEEDBACK_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.EVENT_THREAD_INFO_UPDATED="EVENT_THREADINFO_UPDATED",e.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",e.EVENT_POLL_VOTED="EVENT_POLL_VOTED",e.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",e.EVENT_CHANNEL_CSAT_SUBMITTED="EVENT_CHANNEL_CSAT_SUBMITTED",e.EVENT_CHANNEL_CONVERSATION_HANDEDOFF="EVENT_CHANNEL_CONVERSATION_HANDEDOFF",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";const s=Object.assign({},exports.CollectionEventSource);class E extends t.BaseCommand{constructor({messages:e,source:t,isWebSocketEventComing:s=!1}){super(),this.messages=e,this.source=t,this.isWebSocketEventComing=s}}class o extends t.BaseCommand{constructor({messageIds:e,source:t,isWebSocketEventComing:s=!1}){super(),this.messageIds=e,this.source=t,this.isWebSocketEventComing=s}}class n extends t.BaseCommand{constructor({messageDeletionTimestamp:e,channelUrl:t,source:s}){super(),this.messageDeletionTimestamp=e,this.channelUrl=t,this.source=s}}class l extends t.BaseCommand{constructor({event:e,source:t,isWebSocketEventComing:s=!1}){super(),this.event=e,this.source=t,this.isWebSocketEventComing=s}}class i extends t.BaseCommand{constructor({event:e,source:t,isWebSocketEventComing:s=!1}){super(),this.event=e,this.source=t,this.isWebSocketEventComing=s}}class a extends t.BaseCommand{constructor({reqId:e,source:t}){super(),this.reqId=e,this.source=t}}class _ extends t.BaseCommand{constructor({polls:e,source:t}){super(),this.polls=e,this.source=t}}class r extends t.BaseCommand{constructor({event:e,source:t}){super(),this.event=e,this.source=t}}class d extends t.BaseCommand{constructor({event:e,source:t}){super(),this.event=e,this.source=t}}var N;exports.PollStatus=void 0,(N=exports.PollStatus||(exports.PollStatus={})).OPEN="open",N.CLOSED="closed";const A=e=>{switch(e){case"open":return exports.PollStatus.OPEN;case"closed":return exports.PollStatus.CLOSED;default:return null}},u=e=>!e||!!e.text&&t.isTypeOf("string",e.text);class p extends t.InstancedObject{constructor(e,t){var s,E,o,n,l,i,a;super(e),this.pollId=0,this.id=0,this.text=null,this.voteCount=0,this.createdBy=null,this.createdAt=0,this.updatedAt=0,this._lastVotedAt=0,this.pollId=null!==(s=t.poll_id)&&void 0!==s?s:0,this.id=null!==(E=t.id)&&void 0!==E?E:0,this.text=null!==(o=t.text)&&void 0!==o?o:null,this.voteCount=null!==(n=t.vote_count)&&void 0!==n?n:0,this.createdBy=null!==(l=t.created_by)&&void 0!==l?l:null,this.createdAt=null!==(i=t.created_at)&&void 0!==i?i:0,this.updatedAt=null!==(a=t.updated_at)&&void 0!==a?a:0}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})))}}class T extends t.InstancedObject{constructor(e,t){var s,E,o,n,l,i,a,_,r,d,N,u,T;super(e),this.id=0,this.title=null,this.createdAt=0,this.updatedAt=0,this.closeAt=-1,this.status=exports.PollStatus.CLOSED,this.messageId=0,this.data=null,this.voterCount=-1,this.options=[],this.createdBy=null,this.allowUserSuggestion=!1,this.allowMultipleVotes=!1,this.votedPollOptionIds=[],this.id=null!==(s=t.id)&&void 0!==s?s:0,this.title=null!==(E=t.title)&&void 0!==E?E:null,this.createdAt=null!==(o=t.created_at)&&void 0!==o?o:0,this.updatedAt=null!==(n=t.updated_at)&&void 0!==n?n:0,this.closeAt=null!==(l=t.close_at)&&void 0!==l?l:-1,this.status=null!==(i=A(t.status))&&void 0!==i?i:exports.PollStatus.CLOSED,this.messageId=null!==(a=t.message_id)&&void 0!==a?a:0,this.data=null!==(_=t.data)&&void 0!==_?_:null,this.voterCount=null!==(r=t.voter_count)&&void 0!==r?r:-1,this.options=t.options?t.options.map((e=>new p(this._iid,e))):[],this.createdBy=null!==(d=t.created_by)&&void 0!==d?d:null,this.allowUserSuggestion=null!==(N=t.allow_user_suggestion)&&void 0!==N&&N,this.allowMultipleVotes=null!==(u=t.allow_multiple_votes)&&void 0!==u&&u,this.votedPollOptionIds=null!==(T=t.voted_option_ids)&&void 0!==T?T:[]}_applyPollUpdatePayload(e){var t,s,E,o,n,l,i,a;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(s=e.updated_at)&&void 0!==s?s:this.updatedAt,this.closeAt=null!==(E=e.close_at)&&void 0!==E?E:this.closeAt,this.status=null!==(o=A(e.status))&&void 0!==o?o:this.status,this.data=null!==(n=e.data)&&void 0!==n?n:this.data,this.voterCount=null!==(l=e.voter_count)&&void 0!==l?l:this.voterCount,e.options&&(this.options=e.options.map((e=>new p(this._iid,e))),this.votedPollOptionIds=e.options.filter((e=>e.vote_count>0)).map((e=>e.id))),this.allowUserSuggestion=null!==(i=e.allow_user_suggestion)&&void 0!==i?i:this.allowUserSuggestion,this.allowMultipleVotes=null!==(a=e.allow_multiple_votes)&&void 0!==a?a:this.allowMultipleVotes}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map((e=>p.payloadify(e))),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})))}applyPollUpdateEvent(e){const t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)}applyPollVoteEvent(e){if(this.id!==e.pollId)return!1;const t=this.options,s=t.map((e=>e.id)),E=e._payload,o=Math.floor(E.ts/1e3);return E.updated_vote_counts.forEach((e=>{const E=s.indexOf(e.option_id);if(E>-1){const s=t[E];o>=s._lastVotedAt&&(s.voteCount=e.vote_count,s._lastVotedAt=o)}})),E.req_id&&E.voted_option_ids&&(this.votedPollOptionIds=E.voted_option_ids),"number"==typeof E.voter_count&&(this.voterCount=E.voter_count),!0}serialize(){return t.serialize(this)}}class h extends t.BaseListQuery{constructor(e,t,s,E){super(e,E),this.channelUrl=t,this.channelType=s}_validate(){return super._validate()&&t.isTypeOf("string",this.channelUrl)&&t.isEnumOf(t.ChannelType,this.channelType)}}class c extends t.APIRequestCommand{constructor({title:e,optionTexts:s,data:E,allowUserSuggestion:o,allowMultipleVotes:n,closeAt:l}){super(),this.method=t.APIRequestMethod.POST,this.path=t.API_PATH_POLLS,this.params={title:e,options:s,data:E,allow_user_suggestion:o,allow_multiple_votes:n,close_at:l}}}class S extends t.APIResponseCommand{constructor(e,t){super(e,t),this.poll=new T(e,t)}}class C extends t.APIRequestCommand{constructor({channelUrl:e,channelType:s,pollId:E}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(E)}`,this.params={channel_url:e,channel_type:s}}}class D extends t.APIResponseCommand{constructor(e,t){super(e,t),this.poll=new T(e,t)}}class L extends t.APIRequestCommand{constructor({channelUrl:e,channelType:s,pollId:E,pollOptionId:o}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(E)}/options/${encodeURIComponent(o)}`,this.params={channel_url:e,channel_type:s}}}class v extends t.APIResponseCommand{constructor(e,t){super(e,t),this.pollOption=new p(e,t)}}class m extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,timestamp:E,token:o}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/polls/changelogs`,this.params=t.deundefined({change_ts:E,token:o})}}class P extends t.APIResponseCommand{constructor(e,t){super(e,t),this.updatedPolls=t.updated.map((t=>((e,t)=>new T(e,t))(e,t))),this.deletedPollIds=t.deleted.map((e=>e)),this.hasMore=t.has_more,this.nextToken=t.next}}const O={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},V=e=>{return t.isTypeOf("string",e.title)&&(s=e.optionTexts,t.isArrayOf("string",s)&&s.every((e=>""!==e.trim())))&&u(e.data)&&t.isTypeOf("boolean",e.allowUserSuggestion,!0)&&t.isTypeOf("boolean",e.allowMultipleVotes,!0)&&t.isTypeOf("number",e.closeAt,!0);var s},I={channelUrl:"",channelType:t.ChannelType.BASE,pollId:0,pollOptionId:0},U=e=>t.isTypeOf("string",e.channelUrl)&&""!==e.channelUrl&&t.isEnumOf(t.ChannelType,e.channelType)&&t.isTypeOf("number",e.pollId)&&e.pollId>0&&t.isTypeOf("number",e.pollOptionId)&&e.pollOptionId>0,R={channelUrl:"",channelType:t.ChannelType.BASE,pollId:0},H=e=>t.isTypeOf("string",e.channelUrl)&&""!==e.channelUrl&&t.isEnumOf(t.ChannelType,e.channelType)&&t.isTypeOf("number",e.pollId),M={};class G extends t.APIRequestCommand{constructor({channelUrl:e,channelType:s,token:E,limit:o}){super(),this.method=t.APIRequestMethod.GET,this.path=t.API_PATH_POLLS,this.params={channel_url:e,channel_type:s,token:E,limit:o}}}class g extends t.APIResponseCommand{constructor(e,t){var s;super(e,t),this.polls=(null!==(s=t.polls)&&void 0!==s?s:[]).map((t=>new T(e,t))),this.token=t.next}}class x extends t.APIRequestCommand{constructor({channelUrl:e,channelType:s,pollId:E,pollOptionId:o,token:n,limit:l}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(E)}/options/${encodeURIComponent(o)}/voters`,this.params={channel_url:e,channel_type:s,token:n,limit:l}}}class y extends t.APIResponseCommand{constructor(e,s){var E;super(e,s),this.voters=(null!==(E=s.voters)&&void 0!==E?E:[]).map((s=>new t.User(e,s))),this.token=s.next}}exports.ChannelDataListQuery=h,exports.MessageEventSource=s,exports.MessageRemoveEventCommand=o,exports.MessageRetentionEventCommand=n,exports.MessageUpdateEventCommand=E,exports.POLL_REMOVED_STATUS="removed",exports.Poll=T,exports.PollChangeLogEventCommand=_,exports.PollCreateParamsDefault=O,exports.PollListQuery=class extends h{constructor(e,t){super(e,t.channelUrl,t.channelType,t)}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=t.Vault.of(this._iid),s=new G(Object.assign(Object.assign({},this),{token:this._token})),E=yield e.send(s),{polls:o,token:n}=E.as(g);return this._token=n,this._hasNext=!!n,this._isLoading=!1,o}return[]}throw t.SendbirdError.invalidParameters}))}},exports.PollManager=class{constructor(e,{sdkState:t,dispatcher:s,sessionManager:E,requestQueue:o,logger:n}){this._iid=e,this._sdkState=t,this._sessionManager=E,this._requestQueue=o,this._dispatcher=s,this._logger=n,M[e]=this}static of(e){return M[e]}buildPollFromSerializedData(e){const s=t.deserialize(e);return new T(this._iid,T.payloadify(s))}get(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(H(e)).throw(t.SendbirdError.invalidParameters);const s=new C(Object.assign({},e)),E=yield this._requestQueue.send(s),{poll:o}=E.as(D);return o}))}create(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(V(e)).throw(t.SendbirdError.invalidParameters);const s=new c(Object.assign({},e)),E=yield this._requestQueue.send(s),{poll:o}=E.as(S);return o}))}getOption(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(U(e)).throw(t.SendbirdError.invalidParameters);const s=new L(Object.assign({},e)),E=yield this._requestQueue.send(s),{pollOption:o}=E.as(v);return o}))}getPollChangeLogs(e,s,E,o=exports.CollectionEventSource.SYNC_POLL_CHANGELOGS){return t.__awaiter(this,void 0,void 0,(function*(){const n=new m(t.undefineNullProps({channelType:s,channelUrl:e,timestamp:"number"==typeof E?E:null,token:"string"==typeof E?E:null})),l=yield this._requestQueue.send(n),{updatedPolls:i,deletedPollIds:a,hasMore:r,nextToken:d}=l.as(P);return i.length>0&&this._dispatcher.dispatch(new _({polls:i,source:o})),{updatedPolls:i,deletedPollIds:a,hasMore:r,token:d}}))}},exports.PollOption=p,exports.PollOptionRetrievalParamsDefault=I,exports.PollRetrievalParamsDefault=R,exports.PollUpdateInternalEventCommand=r,exports.PollVoteEvent=class{constructor(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e}},exports.PollVoteInternalEventCommand=d,exports.PollVoterListQuery=class extends h{constructor(e,t){super(e,t.channelUrl,t.channelType,t),this.pollId=t.pollId,this.pollOptionId=t.pollOptionId}_validate(){return super._validate()&&t.isTypeOf("number",this.pollId)&&t.isTypeOf("number",this.pollOptionId)}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=t.Vault.of(this._iid),s=new x(Object.assign(Object.assign({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),E=yield e.send(s),{voters:o,token:n}=E.as(y);return this._token=n,this._hasNext=!!n,this._isLoading=!1,o}return[]}throw t.SendbirdError.invalidParameters}))}},exports.ReactionUpdateEventCommand=l,exports.ThreadUpdateEventCommand=i,exports.UnsentMessageRemoveEventCommand=a,exports.parsePollStatusPayload=A,exports.shouldGiveEvent=e=>e.startsWith("EVENT_")||e.startsWith("LOCAL_MESSAGE_")||e===exports.CollectionEventSource.SYNC_MESSAGE_FILL||e===exports.CollectionEventSource.SYNC_MESSAGE_CHANGELOGS||e===exports.CollectionEventSource.SYNC_POLL_CHANGELOGS,exports.validatePollCreateParams=V,exports.validatePollData=u,exports.validatePollOptionRetrievalParams=U,exports.validatePollRetrievalParams=H;
