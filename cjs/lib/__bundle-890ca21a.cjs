var t,e=require("./__bundle-06ddf546.cjs");exports.CollectionEventSource=void 0,(t=exports.CollectionEventSource||(exports.CollectionEventSource={})).UNKNOWN="UNKNOWN",t.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",t.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",t.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",t.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",t.EVENT_CHANNEL_UNREAD="EVENT_CHANNEL_UNREAD",t.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",t.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",t.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",t.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",t.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",t.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",t.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",t.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",t.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",t.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",t.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",t.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",t.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",t.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",t.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",t.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",t.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",t.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",t.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",t.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",t.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",t.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",t.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",t.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",t.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",t.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",t.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",t.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",t.REQUEST_CHANNEL="REQUEST_CHANNEL",t.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",t.REFRESH_CHANNEL="REFRESH_CHANNEL",t.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",t.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",t.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",t.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",t.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",t.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",t.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",t.EVENT_MESSAGE_FEEDBACK_ADDED="EVENT_MESSAGE_FEEDBACK_ADDED",t.EVENT_MESSAGE_FEEDBACK_UPDATED="EVENT_MESSAGE_FEEDBACK_UPDATED",t.EVENT_MESSAGE_FEEDBACK_DELETED="EVENT_MESSAGE_FEEDBACK_DELETED",t.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",t.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",t.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",t.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",t.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",t.REQUEST_MESSAGE="REQUEST_MESSAGE",t.EVENT_THREAD_INFO_UPDATED="EVENT_THREADINFO_UPDATED",t.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",t.EVENT_POLL_VOTED="EVENT_POLL_VOTED",t.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",t.EVENT_CHANNEL_CSAT_SUBMITTED="EVENT_CHANNEL_CSAT_SUBMITTED",t.EVENT_CHANNEL_CONVERSATION_HANDEDOFF="EVENT_CHANNEL_CONVERSATION_HANDEDOFF",t.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",t.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",t.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",t.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",t.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",t.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",t.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",t.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",t.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",t.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";const s=Object.assign({},exports.CollectionEventSource);class E extends e.BaseCommand{constructor({messages:t,source:e,isWebSocketEventComing:s=!1}){super(),this.messages=t,this.source=e,this.isWebSocketEventComing=s}}class o extends e.BaseCommand{constructor({messageIds:t,source:e,isWebSocketEventComing:s=!1}){super(),this.messageIds=t,this.source=e,this.isWebSocketEventComing=s}}class n extends e.BaseCommand{constructor({messageDeletionTimestamp:t,channelUrl:e,source:s}){super(),this.messageDeletionTimestamp=t,this.channelUrl=e,this.source=s}}class l extends e.BaseCommand{constructor({event:t,source:e,isWebSocketEventComing:s=!1}){super(),this.event=t,this.source=e,this.isWebSocketEventComing=s}}class i extends e.BaseCommand{constructor({event:t,source:e,isWebSocketEventComing:s=!1}){super(),this.event=t,this.source=e,this.isWebSocketEventComing=s}}class a extends e.BaseCommand{constructor({reqId:t,source:e}){super(),this.reqId=t,this.source=e}}class _ extends e.BaseCommand{constructor({polls:t,source:e}){super(),this.polls=t,this.source=e}}class r extends e.BaseCommand{constructor({event:t,source:e}){super(),this.event=t,this.source=e}}class d extends e.BaseCommand{constructor({event:t,source:e}){super(),this.event=t,this.source=e}}var N;exports.PollStatus=void 0,(N=exports.PollStatus||(exports.PollStatus={})).OPEN="open",N.CLOSED="closed";const A=t=>{switch(t){case"open":return exports.PollStatus.OPEN;case"closed":return exports.PollStatus.CLOSED;default:return null}},u=t=>!t||!!t.text&&e.isTypeOf("string",t.text);class p extends e.InstancedObject{constructor(t,e){var s,E,o,n,l,i,a;super(t),this.pollId=0,this.id=0,this.text=null,this.voteCount=0,this.createdBy=null,this.createdAt=0,this.updatedAt=0,this._lastVotedAt=0,this.pollId=null!==(s=e.poll_id)&&void 0!==s?s:0,this.id=null!==(E=e.id)&&void 0!==E?E:0,this.text=null!==(o=e.text)&&void 0!==o?o:null,this.voteCount=null!==(n=e.vote_count)&&void 0!==n?n:0,this.createdBy=null!==(l=e.created_by)&&void 0!==l?l:null,this.createdAt=null!==(i=e.created_at)&&void 0!==i?i:0,this.updatedAt=null!==(a=e.updated_at)&&void 0!==a?a:0}static payloadify(t){return e.deundefined(e.undefineNullProps(Object.assign(Object.assign({},super.payloadify(t)),{vote_count:t.voteCount,poll_id:t.pollId,text:t.text,created_at:t.createdAt,id:t.id,created_by:t.createdBy,updated_at:t.updatedAt})))}}class T extends e.InstancedObject{constructor(t,e){var s,E,o,n,l,i,a,_,r,d,N,u,T;super(t),this.id=0,this.title=null,this.createdAt=0,this.updatedAt=0,this.closeAt=-1,this.status=exports.PollStatus.CLOSED,this.messageId=0,this.data=null,this.voterCount=-1,this.options=[],this.createdBy=null,this.allowUserSuggestion=!1,this.allowMultipleVotes=!1,this.votedPollOptionIds=[],this.id=null!==(s=e.id)&&void 0!==s?s:0,this.title=null!==(E=e.title)&&void 0!==E?E:null,this.createdAt=null!==(o=e.created_at)&&void 0!==o?o:0,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:0,this.closeAt=null!==(l=e.close_at)&&void 0!==l?l:-1,this.status=null!==(i=A(e.status))&&void 0!==i?i:exports.PollStatus.CLOSED,this.messageId=null!==(a=e.message_id)&&void 0!==a?a:0,this.data=null!==(_=e.data)&&void 0!==_?_:null,this.voterCount=null!==(r=e.voter_count)&&void 0!==r?r:-1,this.options=e.options?e.options.map((t=>new p(this._iid,t))):[],this.createdBy=null!==(d=e.created_by)&&void 0!==d?d:null,this.allowUserSuggestion=null!==(N=e.allow_user_suggestion)&&void 0!==N&&N,this.allowMultipleVotes=null!==(u=e.allow_multiple_votes)&&void 0!==u&&u,this.votedPollOptionIds=null!==(T=e.voted_option_ids)&&void 0!==T?T:[]}_applyPollUpdatePayload(t){var e,s,E,o,n,l,i,a;this.title=null!==(e=t.title)&&void 0!==e?e:this.title,this.updatedAt=null!==(s=t.updated_at)&&void 0!==s?s:this.updatedAt,this.closeAt=null!==(E=t.close_at)&&void 0!==E?E:this.closeAt,this.status=null!==(o=A(t.status))&&void 0!==o?o:this.status,this.data=null!==(n=t.data)&&void 0!==n?n:this.data,this.voterCount=null!==(l=t.voter_count)&&void 0!==l?l:this.voterCount,t.options&&(this.options=t.options.map((t=>new p(this._iid,t))),this.votedPollOptionIds=t.options.filter((t=>t.vote_count>0)).map((t=>t.id))),this.allowUserSuggestion=null!==(i=t.allow_user_suggestion)&&void 0!==i?i:this.allowUserSuggestion,this.allowMultipleVotes=null!==(a=t.allow_multiple_votes)&&void 0!==a?a:this.allowMultipleVotes}static payloadify(t){return e.deundefined(e.undefineNullProps(Object.assign(Object.assign({},super.payloadify(t)),{id:t.id,title:t.title,created_at:t.createdAt,updated_at:t.updatedAt,close_at:t.closeAt,status:t.status,message_id:t.messageId,data:t.data,voter_count:t.voterCount,options:t.options.map((t=>p.payloadify(t))),created_by:t.createdBy,allow_user_suggestion:t.allowUserSuggestion,allow_multiple_votes:t.allowMultipleVotes,voted_option_ids:t.votedPollOptionIds})))}applyPollUpdateEvent(t){const e=t._payload.poll;return!(!e||this.id!==e.id||e.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(e),!0)}applyPollVoteEvent(t){if(this.id!==t.pollId)return!1;const e=this.options,s=e.map((t=>t.id)),E=t._payload,o=Math.floor(E.ts/1e3);return E.updated_vote_counts.forEach((t=>{const E=s.indexOf(t.option_id);if(E>-1){const s=e[E];o>=s._lastVotedAt&&(s.voteCount=t.vote_count,s._lastVotedAt=o)}})),E.req_id&&E.voted_option_ids&&(this.votedPollOptionIds=E.voted_option_ids),"number"==typeof E.voter_count&&(this.voterCount=E.voter_count),!0}serialize(){return e.serialize(this)}}class h extends e.BaseListQuery{constructor(t,e,s,E){super(t,E),this.channelUrl=e,this.channelType=s}_validate(){return super._validate()&&e.isTypeOf("string",this.channelUrl)&&e.isEnumOf(e.ChannelType,this.channelType)}}class c extends e.APIRequestCommand{constructor({title:t,optionTexts:s,data:E,allowUserSuggestion:o,allowMultipleVotes:n,closeAt:l}){super(),this.method=e.APIRequestMethod.POST,this.path=e.API_PATH_POLLS,this.params={title:t,options:s,data:E,allow_user_suggestion:o,allow_multiple_votes:n,close_at:l}}}class S extends e.APIResponseCommand{constructor(t,e){super(t,e),this.poll=new T(t,e)}}class C extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,pollId:E}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_POLLS}/${encodeURIComponent(E)}`,this.params={channel_url:t,channel_type:s}}}class D extends e.APIResponseCommand{constructor(t,e){super(t,e),this.poll=new T(t,e)}}class L extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,pollId:E,pollOptionId:o}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_POLLS}/${encodeURIComponent(E)}/options/${encodeURIComponent(o)}`,this.params={channel_url:t,channel_type:s}}}class v extends e.APIResponseCommand{constructor(t,e){super(t,e),this.pollOption=new p(t,e)}}class m extends e.APIRequestCommand{constructor({channelType:t,channelUrl:s,timestamp:E,token:o}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.getChannelApiPathByType(t)}/${encodeURIComponent(s)}/polls/changelogs`,this.params=e.deundefined({change_ts:E,token:o})}}class P extends e.APIResponseCommand{constructor(t,e){super(t,e),this.updatedPolls=e.updated.map((e=>((t,e)=>new T(t,e))(t,e))),this.deletedPollIds=e.deleted.map((t=>t)),this.hasMore=e.has_more,this.nextToken=e.next}}const O={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},V=t=>{return e.isTypeOf("string",t.title)&&(s=t.optionTexts,e.isArrayOf("string",s)&&s.every((t=>""!==t.trim())))&&u(t.data)&&e.isTypeOf("boolean",t.allowUserSuggestion,!0)&&e.isTypeOf("boolean",t.allowMultipleVotes,!0)&&e.isTypeOf("number",t.closeAt,!0);var s},I={channelUrl:"",channelType:e.ChannelType.BASE,pollId:0,pollOptionId:0},U=t=>e.isTypeOf("string",t.channelUrl)&&""!==t.channelUrl&&e.isEnumOf(e.ChannelType,t.channelType)&&e.isTypeOf("number",t.pollId)&&t.pollId>0&&e.isTypeOf("number",t.pollOptionId)&&t.pollOptionId>0,R={channelUrl:"",channelType:e.ChannelType.BASE,pollId:0},H=t=>e.isTypeOf("string",t.channelUrl)&&""!==t.channelUrl&&e.isEnumOf(e.ChannelType,t.channelType)&&e.isTypeOf("number",t.pollId),M={};class G extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,token:E,limit:o}){super(),this.method=e.APIRequestMethod.GET,this.path=e.API_PATH_POLLS,this.params={channel_url:t,channel_type:s,token:E,limit:o}}}class g extends e.APIResponseCommand{constructor(t,e){var s;super(t,e),this.polls=(null!==(s=e.polls)&&void 0!==s?s:[]).map((e=>new T(t,e))),this.token=e.next}}class x extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,pollId:E,pollOptionId:o,token:n,limit:l}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_POLLS}/${encodeURIComponent(E)}/options/${encodeURIComponent(o)}/voters`,this.params={channel_url:t,channel_type:s,token:n,limit:l}}}class y extends e.APIResponseCommand{constructor(t,s){var E;super(t,s),this.voters=(null!==(E=s.voters)&&void 0!==E?E:[]).map((s=>new e.User(t,s))),this.token=s.next}}exports.ChannelDataListQuery=h,exports.MessageEventSource=s,exports.MessageRemoveEventCommand=o,exports.MessageRetentionEventCommand=n,exports.MessageUpdateEventCommand=E,exports.POLL_REMOVED_STATUS="removed",exports.Poll=T,exports.PollChangeLogEventCommand=_,exports.PollCreateParamsDefault=O,exports.PollListQuery=class extends h{constructor(t,e){super(t,e.channelUrl,e.channelType,e)}next(){return e.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw e.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:t}=e.Vault.of(this._iid),s=new G(Object.assign(Object.assign({},this),{token:this._token})),E=yield t.send(s),{polls:o,token:n}=E.as(g);return this._token=n,this._hasNext=!!n,this._isLoading=!1,o}return[]}throw e.SendbirdError.invalidParameters}))}},exports.PollManager=class{constructor(t,{sdkState:e,dispatcher:s,sessionManager:E,requestQueue:o,logger:n}){this._iid=t,this._sdkState=e,this._sessionManager=E,this._requestQueue=o,this._dispatcher=s,this._logger=n,M[t]=this}static of(t){return M[t]}buildPollFromSerializedData(t){const s=e.deserialize(t);return new T(this._iid,T.payloadify(s))}get(t){return e.__awaiter(this,void 0,void 0,(function*(){e.unless(H(t)).throw(e.SendbirdError.invalidParameters);const s=new C(Object.assign({},t)),E=yield this._requestQueue.send(s),{poll:o}=E.as(D);return o}))}create(t){return e.__awaiter(this,void 0,void 0,(function*(){e.unless(V(t)).throw(e.SendbirdError.invalidParameters);const s=new c(Object.assign({},t)),E=yield this._requestQueue.send(s),{poll:o}=E.as(S);return o}))}getOption(t){return e.__awaiter(this,void 0,void 0,(function*(){e.unless(U(t)).throw(e.SendbirdError.invalidParameters);const s=new L(Object.assign({},t)),E=yield this._requestQueue.send(s),{pollOption:o}=E.as(v);return o}))}getPollChangeLogs(t,s,E,o=exports.CollectionEventSource.SYNC_POLL_CHANGELOGS){return e.__awaiter(this,void 0,void 0,(function*(){const n=new m(e.undefineNullProps({channelType:s,channelUrl:t,timestamp:"number"==typeof E?E:null,token:"string"==typeof E?E:null})),l=yield this._requestQueue.send(n),{updatedPolls:i,deletedPollIds:a,hasMore:r,nextToken:d}=l.as(P);return i.length>0&&this._dispatcher.dispatch(new _({polls:i,source:o})),{updatedPolls:i,deletedPollIds:a,hasMore:r,token:d}}))}},exports.PollOption=p,exports.PollOptionRetrievalParamsDefault=I,exports.PollRetrievalParamsDefault=R,exports.PollUpdateInternalEventCommand=r,exports.PollVoteEvent=class{constructor(t){this.pollId=0,this.messageId=0,this.pollId=t.poll_id,this.messageId=t.message_id,this._payload=t}},exports.PollVoteInternalEventCommand=d,exports.PollVoterListQuery=class extends h{constructor(t,e){super(t,e.channelUrl,e.channelType,e),this.pollId=e.pollId,this.pollOptionId=e.pollOptionId}_validate(){return super._validate()&&e.isTypeOf("number",this.pollId)&&e.isTypeOf("number",this.pollOptionId)}next(){return e.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw e.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:t}=e.Vault.of(this._iid),s=new x(Object.assign(Object.assign({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),E=yield t.send(s),{voters:o,token:n}=E.as(y);return this._token=n,this._hasNext=!!n,this._isLoading=!1,o}return[]}throw e.SendbirdError.invalidParameters}))}},exports.ReactionUpdateEventCommand=l,exports.ThreadUpdateEventCommand=i,exports.UnsentMessageRemoveEventCommand=a,exports.parsePollStatusPayload=A,exports.shouldGiveEvent=t=>t.startsWith("EVENT_")||t.startsWith("LOCAL_MESSAGE_")||t===exports.CollectionEventSource.SYNC_MESSAGE_FILL||t===exports.CollectionEventSource.SYNC_MESSAGE_CHANGELOGS||t===exports.CollectionEventSource.SYNC_POLL_CHANGELOGS,exports.validatePollCreateParams=V,exports.validatePollData=u,exports.validatePollOptionRetrievalParams=U,exports.validatePollRetrievalParams=H;
