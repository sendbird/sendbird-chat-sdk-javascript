var e,t=require("./__bundle-64a7bbb4.cjs");class s{constructor(e,t,s){var i,n;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this._requireAuth=!1,this._iid=e,this.plainUrl=t.url,this.width=t.width,this.height=t.height,this.realWidth=null!==(i=t.real_width)&&void 0!==i?i:t.width,this.realHeight=null!==(n=t.real_height)&&void 0!==n?n:t.height,this._requireAuth=s}static payloadify(e){return e instanceof s?t.deundefined(t.undefineNullProps({url:e.plainUrl,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight})):t.deundefined(t.undefineNullProps({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}))}get url(){const{sessionManager:e}=t.Vault.of(this._iid);return this._requireAuth&&e.ekey?`${this.plainUrl}?auth=${e.ekey}`:this.plainUrl}}class i extends t.APIRequestCommand{constructor(e){if(super(),this.method=t.APIRequestMethod.POST,this.path=`${t.API_PATH_UPLOAD}`,this.params=t.deundefined({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(let t=0;t<e.thumbnailSizes.length;t++){const{maxWidth:s,maxHeight:i}=e.thumbnailSizes[t];this.params[`thumbnail${t+1}`]=`${s},${i}`}this.requestId=e.requestId}}class n extends t.APIResponseCommand{constructor(e,t){var i,n,a,r;super(e,t),this.url=t.url,this.fileSize=null!==(i=t.file_size)&&void 0!==i?i:0,this.thumbnails=null!==(a=null===(n=t.thumbnails)||void 0===n?void 0:n.map((t=>new s(e,t,!1))))&&void 0!==a?a:[],this.requireAuth=null!==(r=t.require_auth)&&void 0!==r&&r}}class a extends t.InstancedObject{constructor(e,s){var i,n,a,r,o;super(e),this.replyCount=0,this.memberCount=0,this.lastRepliedAt=0,this.updatedAt=0,this.replyCount=null!==(i=s.reply_count)&&void 0!==i?i:0,this.memberCount=null!==(n=s.member_count)&&void 0!==n?n:0,this.mostRepliedUsers=s.most_replies&&t.isArrayOf("object",s.most_replies)?s.most_replies.map((e=>new t.User(this._iid,e))):[],this.unreadReplyCount=null!==(a=s.unread_message_count)&&void 0!==a?a:0,this.isPushNotificationEnabled="number"==typeof s.push_enabled?s.push_enabled>0:void 0,this.lastRepliedAt=null!==(r=s.last_replied_at)&&void 0!==r?r:0,this.updatedAt=null!==(o=s.updated_at)&&void 0!==o?o:0}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{reply_count:e.replyCount,unread_message_count:e.unreadReplyCount,member_count:e.memberCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((e=>t.User.payloadify(e))):[],push_enabled:"boolean"==typeof e.isPushNotificationEnabled?e.isPushNotificationEnabled?1:0:void 0,last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))}get _isUpdateRequired(){return void 0===this.unreadReplyCount||void 0===this.isPushNotificationEnabled}_updateFrom(e){var t,s;this.unreadReplyCount=null!==(t=e.unreadReplyCount)&&void 0!==t?t:this.unreadReplyCount,this.isPushNotificationEnabled=null!==(s=e.isPushNotificationEnabled)&&void 0!==s?s:this.isPushNotificationEnabled}}exports.ReactionEventOperation=void 0,(e=exports.ReactionEventOperation||(exports.ReactionEventOperation={})).ADD="add",e.DELETE="delete";class r{constructor(e){var s;this.messageId=0,this.operation=null,this.updatedAt=0;const i=t.isTypeOf("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,a=e.operation?e.operation.toLowerCase():null,r=e.reaction,o=e.updated_at,l=e.count,d=e.sampled_user_ids,u=null!==(s=e.sampled_user_info)&&void 0!==s?s:{};i&&t.isTypeOf("string",n)&&t.isTypeOf("string",a)&&t.isEnumOf(exports.ReactionEventOperation,a)&&t.isTypeOf("string",r)&&r&&t.isTypeOf("number",o)&&(this.messageId=i,this.userId=n,this.key=r,this.operation=a,this.updatedAt=o,this._count=l,this._sampledUserIds=d,this._sampledUserInfoList=u)}}class o extends t.InstancedObject{constructor(e,t,s){var i;super(e),this.userId=t,this.nickname=s.nickname,this.plainProfileUrl=s.profile_url,this.requireAuth=null!==(i=s.require_auth_for_profile_image)&&void 0!==i&&i}get profileUrl(){const{sessionManager:e}=t.Vault.of(this._iid);return this.requireAuth&&e.ekey?`${this.plainProfileUrl}?auth=${e.ekey}`:this.plainProfileUrl}static payloadify(e){return{nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth}}}class l extends t.InstancedObject{constructor(e,s){var i,n,a,r,l,d,u;super(e),this._sampledUserInfoList=[],this._count=0,this._hasCurrentUserReacted=!1;const c=s.key,h=[...null!==(n=null!==(i=s.sampled_user_ids)&&void 0!==i?i:s.user_ids)&&void 0!==n?n:[]],p=null!==(r=null!==(a=s.last_ts)&&void 0!==a?a:s.updated_at)&&void 0!==r?r:0,m=null!==(l=s.is_self_included)&&void 0!==l?l:h.includes(t.Vault.of(e).sdkState.userId),_=null!==(d=s.sampled_user_info)&&void 0!==d?d:{};t.isTypeOf("string",c)&&c&&t.isArrayOf("string",h)&&h.length>0&&t.isTypeOf("number",p)&&(this.key=c,this._sampledUserIds=h,this._updatedAt=p,this._count=null!==(u=s.count)&&void 0!==u?u:h.length,this._hasCurrentUserReacted=m,Object.keys(_).forEach((t=>{this._sampledUserInfoList.push(new o(e,t,_[t]))})));const g={};for(const e of this.sampledUserIds)g[e]=this.updatedAt;this._version=g}get isEmpty(){return 0===this._count}get userIds(){return this._sampledUserIds}get sampledUserIds(){return this._sampledUserIds}get sampledUserInfoList(){return this._sampledUserInfoList}get count(){return this._count}get updatedAt(){return this._updatedAt}get hasCurrentUserReacted(){return this._hasCurrentUserReacted}static payloadify(e){const s={};return e._sampledUserInfoList.forEach((e=>{s[e.userId]=o.payloadify(e)})),t.deundefined(t.undefineNullProps({key:e.key,sampled_user_ids:e._sampledUserIds,sampled_user_info:s,count:e._count,is_self_included:e._hasCurrentUserReacted,last_ts:e._updatedAt}))}applyEvent(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt)if(e._sampledUserIds)this._sampledUserIds=e._sampledUserIds,this._sampledUserInfoList=[],Object.keys(e._sampledUserInfoList).forEach((t=>{this._sampledUserInfoList.push(new o(this._iid,t,e._sampledUserInfoList[t]))})),this._count=e._count,void 0!==e._hasCurrentUserReacted&&(this._hasCurrentUserReacted=e._hasCurrentUserReacted),this._updatedAt=e.updatedAt;else{if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){const t=this._sampledUserIds.indexOf(e.userId);switch(e.operation){case exports.ReactionEventOperation.ADD:t<0&&this._sampledUserIds.push(e.userId);break;case exports.ReactionEventOperation.DELETE:t>=0&&this._sampledUserIds.splice(t,1)}this._count=this._sampledUserIds.length,this._version[e.userId]=e.updatedAt}this._updatedAt=Math.max(this.updatedAt,e.updatedAt)}}}class d{constructor(e){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.secure_url&&(this.secureUrl=e.secure_url),e.type&&(this.type=e.type),e.width&&(this.width=e.width),e.height&&(this.height=e.height),e.alt&&(this.alt=e.alt)}static payloadify(e){var s,i;return t.deundefined(t.undefineNullProps({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(s=e.width)&&void 0!==s?s:0,height:null!==(i=e.height)&&void 0!==i?i:0,alt:e.alt}))}}class u{constructor(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e["og:title"]&&(this.title=e["og:title"]),e["og:url"]&&(this.url=e["og:url"]),e["og:description"]&&(this.description=e["og:description"]),e["og:image"]&&(this.defaultImage=new d(e["og:image"]))}static payloadify(e){return t.deundefined(t.undefineNullProps({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?d.payloadify(e.defaultImage):null}))}}class c{constructor(e){var t,s;this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(s=e.volume)&&void 0!==s?s:1}serialize(){return{name:this.name,volume:this.volume}}static payloadify(e){return t.deundefined(t.undefineNullProps({name:e.name,volume:e.volume}))}}var h;exports.FeedbackRating=void 0,(h=exports.FeedbackRating||(exports.FeedbackRating={})).GOOD="good",h.BAD="bad";class p{constructor(e){this.id=e.id,this.rating=e.rating,this.comment=e.comment}static _getStatus(e){return e?"id"in e?"SUBMITTED":"NO_FEEDBACK":"NOT_APPLICABLE"}static _isSubmitted(e){return"SUBMITTED"===p._getStatus(e)}static _getPayloadByStatus(e){return"NO_FEEDBACK"===e?{}:null}static payloadify(e){return t.deundefined(t.undefineNullProps({id:e.id,rating:e.rating,comment:e.comment}))}}class m extends t.User{constructor(e,s){var i;super(e,s),this.isBlockedByMe=!1,this.role=t.isEnumOf(t.Role,s.role)?s.role:t.Role.NONE,this.isBlockedByMe=null!==(i=s.is_blocked_by_me)&&void 0!==i&&i}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))}}class _{constructor(e){this.key=e.key,this.value=t.isArrayOf("string",e.value)?[...e.value]:[]}static payloadify(e){var s;return t.deundefined(t.undefineNullProps({key:e.key,value:null!==(s=e.value)&&void 0!==s?s:[]}))}}const g=e=>{switch(e){case t.MessageType.BASE:return"";case t.MessageType.USER:return"MESG";case t.MessageType.FILE:return"FILE";case t.MessageType.ADMIN:return"ADMM"}};class y extends t.InstancedObject{constructor(e,s){var i,n,a,r,o,l,d,u,c;super(e),this.channelType=t.ChannelType.BASE,this.messageType=t.MessageType.BASE,this.mentionType=null,this.mentionedUsers=null,this.mentionedUserIds=null,this.metaArrays=[],this.extendedMessage={},this.createdAt=0,this.updatedAt=0,this.channelUrl=s.channel_url,this.channelType=t.isEnumOf(t.ChannelType,s.channel_type)?s.channel_type:t.ChannelType.GROUP,s.channel&&(s.channel.channel_url&&(this.channelUrl=s.channel.channel_url),s.channel.channel_type&&(this.channelType=s.channel.channel_type)),this.data=null!==(i=s.data)&&void 0!==i?i:"",this.customType=null!==(n=s.custom_type)&&void 0!==n?n:"",this.mentionType=t.isEnumOf(t.MentionType,s.mention_type)?s.mention_type:null,this.mentionedUsers=s.mentioned_users?s.mentioned_users.map((e=>new t.User(this._iid,e))):null,this.mentionedUserIds=null!==(a=s.mentioned_user_ids)&&void 0!==a?a:null,this.mentionedUsers&&!this.mentionedUserIds&&(this.mentionedUserIds=this.mentionedUsers.map((e=>e.userId)));const h=null!==(r=s.metaarray)&&void 0!==r?r:{},p=null!==(o=s.metaarray_key_order)&&void 0!==o?o:Object.keys(h).sort(((e,t)=>e.localeCompare(t)));this.metaArrays=[];for(let e=0;e<p.length;e++){const t=p[e];this.metaArrays.push(new _({key:t,value:h[t]||[]}))}s.sorted_metaarray&&(this.metaArrays=s.sorted_metaarray.map((e=>new _(e)))),this.extendedMessage=null!==(l=s.extended_message)&&void 0!==l?l:{},this.extendedMessagePayload=s.extended_message_payload,this.createdAt=null!==(u=null!==(d=s.created_at)&&void 0!==d?d:s.ts)&&void 0!==u?u:0,this.updatedAt=null!==(c=s.updated_at)&&void 0!==c?c:0}static payloadify(e){var s,i;return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{channel_url:e.channelUrl,channel_type:e.channelType,type:g(e.messageType),data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(s=e.mentionedUsers)||void 0===s?void 0:s.map((e=>t.User.payloadify(e))),sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((e=>_.payloadify(e))),extended_message:e.extendedMessage,extended_message_payload:e.extendedMessagePayload,created_at:e.createdAt,updated_at:e.updatedAt})))}isIdentical(e){return!0}isEqual(e){return t.deepEqual(this,e)}isUserMessage(){return this.messageType===t.MessageType.USER}isFileMessage(){return this.messageType===t.MessageType.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")}isMultipleFilesMessage(){return this.messageType===t.MessageType.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")}isAdminMessage(){return this.messageType===t.MessageType.ADMIN}serialize(){return t.serialize(this)}getMetaArraysByKeys(e){return this.metaArrays.filter((t=>e.includes(t.key)))}}class f extends t.InstancedObject{constructor(e,s){var i,n;super(e),this.channelUrl=null!==(i=s.channel_url)&&void 0!==i?i:"",this.channelType=null!==(n=s.channel_type)&&void 0!==n?n:t.ChannelType.GROUP,this.reader=new t.User(this._iid,s.user),this.readAt=s.ts}}class v extends t.WebSocketRequestCommand{constructor({channelUrl:e}){super({code:"READ",ackRequired:!0,payload:{channel_url:e}})}}class I extends t.APIRequestCommand{constructor(e){super();const{channelUrl:s,channelType:i,userId:n,notificationIds:a}=e;this.method=t.APIRequestMethod.PUT,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/messages/mark_as_read`,this.params=t.deundefined(t.undefineNullProps({user_id:n,message_ids:a}))}}class E extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"READ",s),this.readStatus=new f(e,s)}}class T extends t.APIResponseCommand{constructor(e,t){super(e,t),this.readAt=t.ts,this.unreadMessageCount=t.unread_message_count}}class b extends t.WebSocketRequestCommand{constructor({channelUrl:e,messageId:t}){super({code:"READ",ackRequired:!0,payload:{channel_url:e,parent_message_id:t}})}}class S extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,pushEnabled:n}){super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/thread_push`,this.params={push_enabled:n}}}class M extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,rating:n,comment:a}){super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/feedbacks`,this.params={rating:n,comment:a}}}class O extends t.APIResponseCommand{constructor(e,t){super(e,t),this.feedback=new p(t)}}class A extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,feedbackId:n,rating:a,comment:r}){super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/feedbacks/${n}`,this.params={rating:a,comment:r}}}class C extends t.APIResponseCommand{constructor(e,t){super(e,t),this.feedback=new p(t)}}class w extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,feedbackId:n}){super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/feedbacks/${n}`}}class N extends t.InstancedObject{constructor(e,t){var i,n,a,r,o;super(e),this.plainUrl="",this.fileName=null,this.mimeType=null,this.fileSize=0,this.thumbnails=[],this._requireAuth=!1,this.plainUrl=null!==(i=t.url)&&void 0!==i?i:"",this.fileName=null!==(n=t.file_name)&&void 0!==n?n:null,this.mimeType=null!==(a=t.file_type)&&void 0!==a?a:null,this.fileSize=null!==(r=t.file_size)&&void 0!==r?r:0,this._requireAuth=null!==(o=t.require_auth)&&void 0!==o&&o,this.thumbnails=t.thumbnails?t.thumbnails.map((e=>{var t;return new s(this._iid,"string"==typeof e?{url:e,width:0,height:0}:Object.assign(Object.assign({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),this._requireAuth)})):[]}static payloadify(e){var s;return t.deundefined(t.undefineNullProps({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(s=e.thumbnails)||void 0===s?void 0:s.map((e=>{var t;return{url:(null!==(t=e.plainUrl)&&void 0!==t?t:"").split("auth=")[0],width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),require_auth:e._requireAuth}))}get url(){const{sessionManager:e}=t.Vault.of(this._iid);return this._requireAuth&&e.ekey?`${this.plainUrl}?auth=${e.ekey}`:this.plainUrl}}class P{constructor({channelUrl:e,channelType:t,parentMessage:s}){this.channelUrl=e,this.channelType=t,this.parentMessage=s}}var U,R,x,k;!function(e){e.NUMBER="number",e.ENUM="enum",e.TEXT="text",e.REGEX="regex",e.DECIMAL_PLACE="decimal_place"}(U||(U={})),exports.MessageFormItemLayout=void 0,(R=exports.MessageFormItemLayout||(exports.MessageFormItemLayout={})).TEXT="text",R.TEXTAREA="textarea",R.NUMBER="number",R.PHONE="phone",R.EMAIL="email",R.CHIP="chip";class L{constructor(e,t){const{id:s,name:i,items:n,version:a,is_submitted:r}=t;this.messageId=e,this.id=s,this.name=i,this.items=n.map((e=>new D(e))).sort(((e,t)=>e.sortOrder-t.sortOrder)),this.version=null!=a?a:1,this._isSubmitted=r}get isSubmitted(){var e;return null!==(e=this._isSubmitted)&&void 0!==e?e:this.items.some((e=>Array.isArray(e.submittedValues)))}get isSubmittable(){return this.items.every((e=>e.required?!!(Array.isArray(e.draftValues)&&e.draftValues.length>0)&&e.isValid(e.draftValues):!(Array.isArray(e.draftValues)&&e.draftValues.length>0)||e.isValid(e.draftValues)))}static payloadify(e){return t.deundefined(t.undefineNullProps({id:e.id,name:e.name,items:e.items.map((e=>D.payloadify(e))),version:e.version,is_submitted:e._isSubmitted}))}static isMessageFormPayload(e){return Boolean(null==e?void 0:e.message_form)}}class D{constructor(e){const{id:s,name:i,required:n,sort_order:a,placeholder:r,style:o,item_type:l,validators:d,value:u,values:c}=e;this.id=s,this.name=i,this.required=n,this.sortOrder=a,this.placeholder=r,0===Object.keys(o).length?this.style={layout:l}:this.style=t.deundefined({layout:o.layout,options:o.options,defaultOptions:o.default_options,resultCount:o.result_count}),c?this.submittedValues=c:u&&(this.submittedValues=[u]),this._validators=d}isValid(e){return e.every((e=>{const t=function(e,t){return t.every((t=>{switch(t.key){case U.NUMBER:{const s=Number(e);return!(isNaN(s)||t.min&&"number"!=typeof t.min||t.max&&"number"!=typeof t.max||"number"==typeof t.min&&s<t.min||"number"==typeof t.max&&s>t.max)}case U.ENUM:return"string"==typeof e&&(!(t.enums&&Array.isArray(t.enums)&&t.enums.length>0&&!t.enums.includes(e))||t.allow_other);case U.TEXT:return!("string"!=typeof e||"number"==typeof t.min_length&&e.length<t.min_length||"number"==typeof t.max_length&&e.length>t.max_length);case U.REGEX:if("string"!=typeof e)return!1;if(t.regex){if("string"!=typeof t.regex)return!1;if(!new RegExp(t.regex).test(e))return!1}return!0;case U.DECIMAL_PLACE:{if(0===e.length)return!1;const s=Number(e);return!(isNaN(s)||(!t.max_decimal_place||"number"==typeof t.max_decimal_place)&&t.max_decimal_place&&!function(e,t){const s=e.toString(),i=s.indexOf(".");return-1===i||s.slice(i+1).length<=t}(s,t.max_decimal_place))}default:return!0}}))}(e,this._validators);return t}))}static payloadify(e){return t.deundefined(t.undefineNullProps({id:e.id,name:e.name,required:e.required,sort_order:e.sortOrder,placeholder:e.placeholder,style:t.deundefined({layout:e.style.layout,options:e.style.options,default_options:e.style.defaultOptions,result_count:e.style.resultCount}),item_type:e.style.layout,validators:e._validators,values:e.submittedValues}))}}class q extends t.APIRequestCommand{constructor(e){super(),this.method=t.APIRequestMethod.POST,this.path=`${t.API_PATH_FORMS}/${e.formId}/submit`,this.params=t.deundefined({message_id:e.messageId,items:e.items})}}exports.ScheduledStatus=void 0,(x=exports.ScheduledStatus||(exports.ScheduledStatus={})).PENDING="pending",x.SENT="sent",x.FAILED="failed",x.CANCELED="canceled",exports.InternalScheduledStatus=void 0,(k=exports.InternalScheduledStatus||(exports.InternalScheduledStatus={})).PENDING="pending",k.IN_QUEUE="in_queue",k.SENT="sent",k.FAILED="failed",k.CANCELED="canceled",k.REMOVED="removed";class F extends y{constructor(e,s){var i,n,r,o,d,h,m,_,g;super(e,s),this.parentMessage=null,this.silent=!1,this.isOperatorMessage=!1,this.threadInfo=null,this.reactions=[],this.appleCriticalAlertOptions=null,this.scheduledInfo=null,this.suggestedReplies=null,this.myFeedback=null,this.myFeedbackStatus="NOT_APPLICABLE",this.messageForm=null,this._isContinuousMessages=!1,this._scheduledStatus=null,this._poll=null,this.messageId=null!==(n=null!==(i=s.msg_id)&&void 0!==i?i:s.message_id)&&void 0!==n?n:0,this.parentMessageId=null!==(r="string"==typeof s.parent_message_id?parseInt(s.parent_message_id):s.parent_message_id)&&void 0!==r?r:0,this.threadInfo=s.thread_info?new a(this._iid,s.thread_info):null,s.reactions_summary?this.reactions=s.reactions_summary.map((t=>new l(e,t))):s.reactions?this.reactions=s.reactions.map((t=>new l(e,t))):this.reactions=[],this.ogMetaData=s.og_tag?new u(s.og_tag):null,this.silent=null!==(o=s.silent)&&void 0!==o&&o,this.isOperatorMessage=null!==(d=s.is_op_msg)&&void 0!==d&&d,this.appleCriticalAlertOptions=s.apple_critical_alert_options?new c(s.apple_critical_alert_options):null,"number"==typeof s.scheduled_message_id&&"number"==typeof s.scheduled_at&&s.scheduled_status&&(this.scheduledInfo={scheduledMessageId:s.scheduled_message_id,scheduledAt:s.scheduled_at},this._scheduledStatus=s.scheduled_status),this._isContinuousMessages=null!==(h=s.is_continuous_messages)&&void 0!==h&&h,this.myFeedback=p._isSubmitted(s.feedback)?new p(s.feedback):null,this.myFeedbackStatus=p._getStatus(s.feedback),this.suggestedReplies=null!==(_=null===(m=s.extended_message_payload)||void 0===m?void 0:m.suggested_replies)&&void 0!==_?_:null,this.messageForm=L.isMessageFormPayload(s.extended_message_payload)?new L(this.messageId,s.extended_message_payload.message_form):null,this.message=null!==(g=s.message)&&void 0!==g?g:"",this._poll=s.poll?new t.Poll(this._iid,s.poll):null}static payloadify(e){var s,i;return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{message_id:e.messageId,parent_message_id:e.parentMessageId,thread_info:e.threadInfo?a.payloadify(e.threadInfo):null,reactions_summary:e.reactions.map((e=>l.payloadify(e))),og_tag:e.ogMetaData?u.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?c.payloadify(e.appleCriticalAlertOptions):null,scheduled_message_id:null===(s=e.scheduledInfo)||void 0===s?void 0:s.scheduledMessageId,scheduled_at:null===(i=e.scheduledInfo)||void 0===i?void 0:i.scheduledAt,scheduled_status:e._scheduledStatus,feedback:e.myFeedback?p.payloadify(e.myFeedback):p._getPayloadByStatus(e.myFeedbackStatus),message:e.message,poll:e._poll?t.Poll.payloadify(e._poll):null})))}static _getParentMessageInfoPayload(e){return t.deundefined(t.undefineNullProps({type:g(e.messageType),ts:e.createdAt,user:e.sender?m.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth},files:Array.isArray(e.fileInfoList)?e.fileInfoList.map((e=>N.payloadify(e))):null}))}isIdentical(e){return this.messageId===e.messageId}applyThreadInfoUpdateEvent(e){return this.messageId===e.targetMessageId&&(e.threadInfo._isUpdateRequired&&this.threadInfo&&e.threadInfo._updateFrom(this.threadInfo),this.threadInfo=e.threadInfo,!0)}_findReactionIndex(e){for(let t=0;t<this.reactions.length;t++)if(this.reactions[t].key===e)return t;return-1}applyReactionEvent(e){const{sdkState:s}=t.Vault.of(this._iid);if(this.messageId===e.messageId)switch(e.operation){case exports.ReactionEventOperation.ADD:{e.userId===s.userId&&(e._hasCurrentUserReacted=!0);const t=this._findReactionIndex(e.key);-1!==t?this.reactions[t].applyEvent(e):e._sampledUserIds?this.reactions.push(new l(this._iid,{key:e.key,sampled_user_ids:e._sampledUserIds,sampled_user_info:e._sampledUserInfoList,count:e._count,is_self_included:e._hasCurrentUserReacted,last_ts:e.updatedAt})):this.reactions.push(new l(this._iid,{key:e.key,user_ids:[e.userId],updated_at:e.updatedAt}));break}case exports.ReactionEventOperation.DELETE:{const t=this._findReactionIndex(e.key);-1!==t&&(e._sampledUserIds?0===e._count?this.reactions.splice(t,1):(e.userId===s.userId&&(e._hasCurrentUserReacted=!1),this.reactions[t].applyEvent(e)):(this.reactions[t].applyEvent(e),this.reactions[t].isEmpty&&this.reactions.splice(t,1)));break}}}applyParentMessage(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){const t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1}applyPoll(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)}get poll(){return this._poll}_triggerThreadInfoUpdatedEvent(){return t.__awaiter(this,void 0,void 0,(function*(){const{dispatcher:e}=t.Vault.of(this._iid);e.dispatch(new P({channelType:t.ChannelType.GROUP,channelUrl:this.channelUrl,parentMessage:this})),e.dispatch(new t.MessageUpdateEventCommand({messages:[this],source:t.CollectionEventSource.EVENT_MESSAGE_THREADINFO_UPDATED}))}))}markThreadAsRead(){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:e}=t.Vault.of(this._iid),s=new b({channelUrl:this.channelUrl,messageId:this.messageId});yield e.send(s),this.threadInfo&&0!==this.threadInfo.unreadReplyCount&&(this.threadInfo.unreadReplyCount=0,yield this._triggerThreadInfoUpdatedEvent())}))}setPushNotificationEnabled(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s}=t.Vault.of(this._iid),i=new S({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,pushEnabled:e});yield s.send(i),this.threadInfo&&this.threadInfo.isPushNotificationEnabled!==e&&(this.threadInfo.isPushNotificationEnabled=e)}))}submitMessageForm(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s}=t.Vault.of(this._iid);let i=null,n=null;const a=this.messageForm;if(!e&&a){if(!a.isSubmittable)throw new t.SendbirdError({code:t.SendbirdErrorCode.INVALID_PARAMETER,message:"The form is not submittable. Please check all form items are valid before submitting."});if(a.isSubmitted)throw new t.SendbirdError({code:t.SendbirdErrorCode.INVALID_PARAMETER,message:"The form has already been submitted."});i=a.id,n=a.items.reduce(((e,t)=>(e.push({form_item_id:t.id,values:Array.isArray(t.draftValues)?t.draftValues:[]}),e)),[])}else e&&(i=e.formId,n=Object.entries(e.answers).reduce(((e,[s,i])=>{const n=Number(s);if(Number.isNaN(n))throw new t.SendbirdError({code:t.SendbirdErrorCode.INVALID_PARAMETER,message:"Keys in answers must be numeric string."});return e.push({form_item_id:n,value:i}),e}),[]));if(!i||!n)throw new t.SendbirdError({code:t.SendbirdErrorCode.INVALID_PARAMETER,message:"Missing one or more required inputs: formId, answers."});const r=new q({messageId:this.messageId,formId:i,items:n});yield s.send(r)}))}submitFeedback(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s,dispatcher:i}=t.Vault.of(this._iid),n=new M({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,rating:e.rating,comment:e.comment}),a=(yield s.send(n)).as(O);this.myFeedback=a.feedback,this.myFeedbackStatus="SUBMITTED",i.dispatch(new t.MessageUpdateEventCommand({messages:[this],source:t.CollectionEventSource.EVENT_MESSAGE_FEEDBACK_ADDED}))}))}updateFeedback(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s,dispatcher:i}=t.Vault.of(this._iid),n=new A({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e.id,rating:e.rating,comment:e.comment}),a=(yield s.send(n)).as(C);this.myFeedback=a.feedback,this.myFeedbackStatus="SUBMITTED",i.dispatch(new t.MessageUpdateEventCommand({messages:[this],source:t.CollectionEventSource.EVENT_MESSAGE_FEEDBACK_UPDATED}))}))}deleteFeedback(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s,dispatcher:i}=t.Vault.of(this._iid),n=new w({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e});yield s.send(n),this.myFeedback=null,this.myFeedbackStatus="NO_FEEDBACK",i.dispatch(new t.MessageUpdateEventCommand({messages:[this],source:t.CollectionEventSource.EVENT_MESSAGE_FEEDBACK_DELETED}))}))}}class B extends F{constructor(e,s){var i,n,a,r;if(super(e,s),this.reqId="",this.replyToChannel=!1,this.errorCode=0,this.sender=s.user?new m(this._iid,s.user):s.sender_id,this.reqId=null!==(n=null!==(i=s.req_id)&&void 0!==i?i:s.request_id)&&void 0!==n?n:"",this.replyToChannel=null!==(a=s.is_reply_to_channel)&&void 0!==a&&a,s.request_state&&t.isEnumOf(t.SendingStatus,s.request_state)&&(this.sendingStatus=s.request_state),!this.sendingStatus)if(this.messageId>0)this.sendingStatus=t.SendingStatus.SUCCEEDED;else if(this.scheduledInfo)switch(s.scheduled_status&&(this._scheduledStatus=s.scheduled_status),s.scheduled_status){case exports.InternalScheduledStatus.SENT:case exports.InternalScheduledStatus.IN_QUEUE:this.sendingStatus=t.SendingStatus.SUCCEEDED;break;case exports.InternalScheduledStatus.PENDING:this.sendingStatus=t.SendingStatus.SCHEDULED;break;case exports.InternalScheduledStatus.FAILED:case exports.InternalScheduledStatus.REMOVED:this.sendingStatus=t.SendingStatus.FAILED;break;case exports.InternalScheduledStatus.CANCELED:this.sendingStatus=t.SendingStatus.CANCELED}else this.sendingStatus=t.SendingStatus.PENDING;this.errorCode=null!==(r=s.error_code)&&void 0!==r?r:0,this._messageToken=s.mesg_token}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{user:m.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode,mesg_token:e._messageToken})))}get isResendable(){return(this.sendingStatus===t.SendingStatus.FAILED||this.sendingStatus===t.SendingStatus.CANCELED)&&t.isResendableError(this.errorCode)}isIdentical(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId}}const j={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:t.MessageTypeFilter.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},V=e=>t.isTypeOf("number",e.prevResultSize)&&t.isTypeOf("number",e.nextResultSize)&&t.isTypeOf("boolean",e.isInclusive)&&t.isTypeOf("boolean",e.reverse)&&t.isTypeOf("string",e.messageTypeFilter)&&t.isEnumOf(t.MessageTypeFilter,e.messageTypeFilter)&&t.isArrayOf("string",e.customTypesFilter,!0)&&t.isArrayOf("string",e.senderUserIdsFilter,!0)&&t.isTypeOf("boolean",e.includeMetaArray)&&t.isTypeOf("boolean",e.includeReactions)&&t.isTypeOf("boolean",e.includeParentMessageInfo);class z extends F{constructor(e,s){var i,n,a;if(super(e,s),this.translations={},this.messageType=t.MessageType.ADMIN,this.translations=null!==(i=s.translations)&&void 0!==i?i:{},s.parent_message_info){const i=s.parent_message_info;this.parentMessage=Y(e,t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},i),{message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:i.file,url:null===(n=i.file)||void 0===n?void 0:n.url,require_auth:null===(a=i.file)||void 0===a?void 0:a.require_auth}))))}}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{translations:e.translations,parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null})))}getThreadedMessagesByTimestamp(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},j),s);t.unless(this.messageId>0&&t.isTypeOf("number",e)&&V(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getThreadedMessagesByTimestamp(this,e,i)}))}}class ${constructor(e){var s,i;this.detail={},this.type=null!==(s=e.type)&&void 0!==s?s:"",this.vendor=null!==(i=e.vendor)&&void 0!==i?i:"",e.detail&&t.isTypeOf("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}static payloadify(e){return t.deundefined(t.undefineNullProps({type:e.type,vendor:e.vendor,detail:e.detail}))}}class Q{constructor(e){this.status=e.status,e.original_message_info&&(this.originalMessageInfo={createdAt:e.original_message_info.ts,messageId:e.original_message_info.id})}static payloadify(e){return t.deundefined({status:e.status,original_message_info:e.originalMessageInfo?{id:e.originalMessageInfo.messageId,ts:e.originalMessageInfo.createdAt}:void 0})}}class G extends B{constructor(e,s){var i,n,a,r,o;if(super(e,s),this.messageParams=null,this.mentionedMessageTemplate=void 0,this.translations={},this.translationTargetLanguages=[],this.messageSurvivalSeconds=-1,this.plugins=[],this.messageType=t.MessageType.USER,this.translations=null!==(i=s.translations)&&void 0!==i?i:{},this.translationTargetLanguages=null!==(n=s.target_langs)&&void 0!==n?n:[],0===Object.keys(this.translations).length&&this.translationTargetLanguages.length>0)for(const e of this.translationTargetLanguages)this.translations[e]="";if(this.mentionedMessageTemplate=s.mentioned_message_template,this.messageSurvivalSeconds=null!==(a=s.message_survival_seconds)&&void 0!==a?a:-1,this.plugins=s.plugins?s.plugins.map((e=>new $(e))):[],s.parent_message_info){const i=s.parent_message_info;this.parentMessage=Y(e,t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},i),{created_at:i.ts,message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:i.file,url:null===(r=i.file)||void 0===r?void 0:r.url,require_auth:null===(o=i.file)||void 0===o?void 0:o.require_auth}))))}s.review_info&&(this.messageReviewInfo=new Q(s.review_info))}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,mentioned_message_template:e.mentionedMessageTemplate,plugins:e.plugins.map((e=>$.payloadify(e))),parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null,review_info:e.messageReviewInfo?Q.payloadify(e.messageReviewInfo):void 0})))}getThreadedMessagesByTimestamp(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},j),s);t.unless(this.messageId>0&&t.isTypeOf("number",e)&&V(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getThreadedMessagesByTimestamp(this,e,i)}))}}class K extends B{constructor(e,s){var i,n,a,r,o,l,d,u;if(super(e,s),this.messageParams=null,this.fileInfoList=[],this.messageSurvivalSeconds=-1,this.messageType=t.MessageType.FILE,this.data=null!==(a=null!==(n=null===(i=s.file)||void 0===i?void 0:i.data)&&void 0!==n?n:s.custom)&&void 0!==a?a:"",this.fileInfoList=null!==(o=null===(r=s.files)||void 0===r?void 0:r.map((t=>new N(e,t))))&&void 0!==o?o:[],this.messageSurvivalSeconds=null!==(l=s.message_survival_seconds)&&void 0!==l?l:-1,s.parent_message_info){const i=s.parent_message_info;this.parentMessage=Y(e,t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},i),{created_at:i.ts,message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:i.file,url:null===(d=i.file)||void 0===d?void 0:d.url,require_auth:null===(u=i.file)||void 0===u?void 0:u.require_auth}))))}}getThreadedMessagesByTimestamp(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},j),s);t.unless(this.messageId>0&&t.isTypeOf("number",e)&&V(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getThreadedMessagesByTimestamp(this,e,i)}))}static payloadify(e){var s,i,n,a,r,o;return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{file:{name:null!==(i=null===(s=e.fileInfoList[0])||void 0===s?void 0:s.fileName)&&void 0!==i?i:"",size:null!==(a=null===(n=e.fileInfoList[0])||void 0===n?void 0:n.fileSize)&&void 0!==a?a:0,type:null!==(o=null===(r=e.fileInfoList[0])||void 0===r?void 0:r.mimeType)&&void 0!==o?o:"",data:e.data},files:Array.isArray(e.fileInfoList)?e.fileInfoList.map((e=>N.payloadify(e))):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null})))}static _isMultipleFilesMessagePayload(e){const t=e.files;return Array.isArray(t)&&t.length>=2}static _isMultipleFilesMessageSerializedData(e){const t=e.fileInfoList;return Array.isArray(t)}}var H;exports.NotificationMessageStatus=void 0,(H=exports.NotificationMessageStatus||(exports.NotificationMessageStatus={})).SENT="SENT",H.READ="READ";class W extends y{constructor(e,s){var i,n;if(super(e,s),this.notificationData=null,this.notificationId=s.notification_message_id,this.messageType=t.MessageType.ADMIN,this.messageStatus=null!==(i=s.message_status)&&void 0!==i?i:exports.NotificationMessageStatus.SENT,this.priority=null!==(n=s.priority)&&void 0!==n?n:t.NotificationPriority.NORMAL,this.notificationEventDeadline=s.notification_event_deadline,0===this.extendedMessage.sub_type)try{const{label:e,tags:t=[],template_key:s,template_variables:i}=JSON.parse(this.extendedMessage.sub_data);this.notificationData={label:e,tags:t,templateKey:s,templateVariables:i}}catch(e){}}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{notification_message_id:e.notificationId,message_status:e.messageStatus,priority:e.priority,notification_event_deadline:e.notificationEventDeadline})))}isIdentical(e){return this.notificationId===e.notificationId}}const Y=(e,t)=>{if(t.notification_message_id)return new W(e,t);switch(t.type){case"MESG":return new G(e,t);case"FILE":return K._isMultipleFilesMessagePayload(t)?new K(e,t):new X(e,t);case"ADMM":case"BRDM":return new z(e,t);default:return null}};class X extends B{constructor(e,i){var n,a,r,o,l,d,u,c,h,p,m,_,g,y;super(e,i),this.messageParams=null,this.plainUrl="",this.requireAuth=!1,this.thumbnails=[],this.messageSurvivalSeconds=-1,this.messageType=t.MessageType.FILE;const f=i.file;if(this.plainUrl=(null!==(a=null!==(n=null==f?void 0:f.url)&&void 0!==n?n:i.url)&&void 0!==a?a:"").split("?auth=")[0],this.name=null!==(o=null!==(r=null==f?void 0:f.name)&&void 0!==r?r:i.name)&&void 0!==o?o:"File",this.size=null!==(d=null!==(l=null==f?void 0:f.size)&&void 0!==l?l:i.size)&&void 0!==d?d:0,this.data=null!==(c=null!==(u=null==f?void 0:f.data)&&void 0!==u?u:i.custom)&&void 0!==c?c:"",this.type=f?null!==(h=f.type)&&void 0!==h?h:"":null!==(p=i.type)&&void 0!==p?p:"",this.requireAuth=null!==(m=i.require_auth)&&void 0!==m&&m,this.thumbnails=i.thumbnails?i.thumbnails.map((e=>{var t;return new s(this._iid,"string"==typeof e?{url:e,width:0,height:0}:Object.assign(Object.assign({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),this.requireAuth)})):[],this.messageSurvivalSeconds=null!==(_=i.message_survival_seconds)&&void 0!==_?_:-1,i.parent_message_info){const s=i.parent_message_info;this.parentMessage=Y(e,t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},s),{created_at:s.ts,message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:s.file,url:null===(g=s.file)||void 0===g?void 0:g.url,require_auth:null===(y=s.file)||void 0===y?void 0:y.require_auth}))))}}static payloadify(e){var s;return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:null===(s=e.thumbnails)||void 0===s?void 0:s.map((e=>({url:e.plainUrl,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}))),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null})))}get url(){const{sessionManager:e}=t.Vault.of(this._iid);return this.requireAuth&&e.ekey?`${this.plainUrl}?auth=${e.ekey}`:this.plainUrl}getThreadedMessagesByTimestamp(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},j),s);t.unless(this.messageId>0&&t.isTypeOf("number",e)&&V(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getThreadedMessagesByTimestamp(this,e,i)}))}}class J extends t.InstancedObject{static getPlainUrl(e){return e instanceof J?e._plainUrl:e.fileUrl}constructor(e,{file:t,fileUrl:s,fileName:i,fileSize:n,mimeType:a,thumbnailSizes:r,_uploadedMetaData:o,_thumbnails:l}){super(e),this._plainUrl=s,this.file=t,this.fileName=i,this.fileSize=n,this.mimeType=a,this.thumbnailSizes=r,this._uploadedMetaData=o,this._thumbnails=l}get fileUrl(){var e;const{sessionManager:s}=t.Vault.of(this._iid);return this._plainUrl&&(null===(e=this._uploadedMetaData)||void 0===e?void 0:e.requireAuth)&&s.ekey?`${this._plainUrl}?auth=${s.ekey}`:this._plainUrl}set fileUrl(e){this._plainUrl=e}toJSON(){return{file:this.file,fileUrl:this._plainUrl,fileName:this.fileName,fileSize:this.fileSize,mimeType:this.mimeType,thumbnailSizes:this.thumbnailSizes,_thumbnails:this._thumbnails,_uploadedMetaData:this._uploadedMetaData}}}class Z extends t.WebSocketRequestCommand{constructor(e){var i,n,a,r;let o=[];e.mentionType===t.MentionType.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map((e=>e.userId)))),super({code:"FILE",ackRequired:!0,payload:t.deundefined(t.undefineNullProps({channel_url:e.channelUrl,files:e.files?ie(e.files):null,url:e.url,name:null!==(i=e.fileName)&&void 0!==i?i:"",type:null!==(n=e.mimeType)&&void 0!==n?n:"",size:null!==(a=e.fileSize)&&void 0!==a?a:0,custom:e.data,custom_type:e.customType,thumbnails:null===(r=e._thumbnails)||void 0===r?void 0:r.map((e=>s.payloadify(e))),require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:o,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==t.PushNotificationDeliveryOption.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?c.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage,message:e.message}))})}}class ee extends t.APIRequestCommand{constructor(e){var i,n;super();let a=[];e.mentionType===t.MentionType.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map((e=>e.userId)))),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(e.channelType)}/${encodeURIComponent(e.channelUrl)}/messages`,this.params=t.deundefined(t.undefineNullProps({message_type:t.MessageType.FILE,user_id:e.userId,files:e.files?ie(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:a,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:null===(i=e._thumbnails)||void 0===i?void 0:i.map((e=>s.payloadify(e))),require_auth:e.requireAuth,sorted_metaarray:null===(n=e.metaArrays)||void 0===n?void 0:n.map((e=>_.payloadify(e))),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?c.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage}))}}class te extends t.WebSocketEventCommand{constructor(e,s,i){var n,a,r,o;super(e,"FILE",i),this.message=i.files&&i.files.length>=2?new K(e,i):new X(e,i);const{sdkState:l}=t.Vault.of(e);this.isMentioned=t.checkIfMentioned(this.message.mentionType,null!==(r=null!==(n=this.message.mentionedUserIds)&&void 0!==n?n:null===(a=this.message.mentionedUsers)||void 0===a?void 0:a.map((e=>e.userId)))&&void 0!==r?r:[],l.userId),this.forceUpdateLastMessage=null!==(o=i.force_update_last_message)&&void 0!==o&&o}}class se extends t.APIResponseCommand{constructor(e,s){var i,n,a,r;super(e,s),this.message=s.files&&s.files.length>=2?new K(e,s):new X(e,s);const{sdkState:o}=t.Vault.of(e);this.isMentioned=t.checkIfMentioned(this.message.mentionType,null!==(a=null!==(i=this.message.mentionedUserIds)&&void 0!==i?i:null===(n=this.message.mentionedUsers)||void 0===n?void 0:n.map((e=>e.userId)))&&void 0!==a?a:[],o.userId),this.forceUpdateLastMessage=null!==(r=s.force_update_last_message)&&void 0!==r&&r}}function ie(e){return e.map((e=>{var i,n;return t.deundefined(t.undefineNullProps({url:J.getPlainUrl(e),file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(i=e._thumbnails)||void 0===i?void 0:i.map((e=>s.payloadify(e))),require_auth:null===(n=e._uploadedMetaData)||void 0===n?void 0:n.requireAuth}))}))}var ne;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(ne||(ne={}));class ae{constructor(e,{sdkState:s,dispatcher:i,requestQueue:n,onlineDetector:a,cacheContext:r}){this._queueMap=new Map,this._iid=e,this._sdkState=s,this._requestQueue=n,this._cacheContext=r,this._dispatcher=i,this._dispatcher.on((e=>{e instanceof t.ConnectionStateChangeCommand&&(this._connectionState=e.stateType)})),this._onlineDetector=a}get _shouldSendThroughWebSocket(){return this._connectionState===t.ConnectionStateType.CONNECTED||this._connectionState===t.ConnectionStateType.CONNECTING||this._connectionState===t.ConnectionStateType.RECONNECTING}_sendFileMessage(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const t=this._createSendFileMessageRequestParams(e,s);if(this._shouldSendThroughWebSocket){const e=new Z(t),s=yield this._requestQueue.send(e),{message:i}=s.as(te);return i}{const e=new ee(Object.assign(Object.assign({},t),{userId:this._sdkState.userId})),s=yield this._requestQueue.send(e),{message:i}=s.as(se);return i}}))}_createSendFileMessageRequestParams(e,t){const s=Object.assign(Object.assign({},t.params),{channelUrl:e.url,channelType:e.channelType,reqId:t.requestId,url:""});if(t.multipleFileUploadInfo){const e=t.params;s.files=e.fileInfoList}else{const e=t.params;s.url=e.fileUrl,s.requireAuth=e.requireAuth}return s}_resolveMessageQueue(e){var s;return t.__awaiter(this,void 0,void 0,(function*(){const i=this._queueMap.get(e.url);if(i)if(i.isResolving)i.isResolveRequestPending=!0;else{i.isResolving=!0;const n=[];let a=!0;for(const r of i.messageQueue)switch(r.state){case ne.PENDING:case ne.UPLOADING:a=!1,n.push(r);break;case ne.UPLOADED:if(a)try{r.state=ne.SENDING;const s=yield this._sendFileMessage(e,r);r.deferred.resolve(s),yield t.sleep(100)}catch(e){r.deferred.reject(e)}else n.push(r);break;case ne.FAILED:{const e=null!==(s=r.error)&&void 0!==s?s:t.SendbirdError.unknown;r.deferred.reject(e.code===t.SendbirdErrorCode.REQUEST_CANCELED?t.SendbirdError.fileUploadCanceled:e);break}}const r=i.isResolveRequestPending;i.messageQueue=n,i.isResolving=!1,i.isResolveRequestPending=!1,r&&(yield this._resolveMessageQueue(e))}}))}_uploadNextPendingItem(e){var s;return t.__awaiter(this,void 0,void 0,(function*(){const i=this._queueMap.get(e.url);if(i){const n=i.messageQueue.find((e=>e.state===ne.PENDING));if(n){if(n.multipleFileUploadInfo){const{uploadIndex:a,uploadCount:r,requestHandler:o}=n.multipleFileUploadInfo,l=n.params,d=l.fileInfoList[a];t.isFile(d.file)&&!(null===(s=d._uploadedMetaData)||void 0===s?void 0:s.isUploaded)?yield this._tryUploadNextItemAndUpdateItemState(e,i,n):n.state=a<r-1?ne.PENDING:ne.UPLOADED;const u=l.fileInfoList[a],c=n.multipleFileUploadInfo.uploadIndex++;n.multipleFileUploadInfo.isCopy||null==o||o._triggerOnFileUploaded(n.requestId,c,u,n.error)}else{const s=n.params;t.isFile(s.file)?yield this._tryUploadNextItemAndUpdateItemState(e,i,n):(s.thumbnailSizes=[],n.state=ne.UPLOADED)}this._uploadNextPendingItem(e),yield this._resolveMessageQueue(e)}}}))}_tryUploadNextItemAndUpdateItemState(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){const n=yield this._onlineDetector.isOnline(),{sessionManager:a}=t.Vault.of(this._iid);if(!a.currentUser||!n)return i.error=t.SendbirdError.connectionRequired,void(i.state=ne.FAILED);if(s.uploadQueue.length<6){i.state=ne.UPLOADING,s.uploadQueue.push(i);try{if(i.multipleFileUploadInfo){const{uploadIndex:t,uploadCount:s}=i.multipleFileUploadInfo,n=i.params;yield this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,i,n),i.state=t<s-1?ne.PENDING:ne.UPLOADED}else{const t=i.params;yield this._uploadNextFileForSingleFileItemAndUpdateParams(e,i,t),i.state=ne.UPLOADED}}catch(e){switch(e.code){case t.SendbirdErrorCode.REQUEST_FAILED:i.error=new t.SendbirdError({code:t.SendbirdErrorCode.NETWORK_ERROR,message:"Failed to upload a file."});break;case t.SendbirdErrorCode.REQUEST_CANCELED:i.error=t.SendbirdError.fileUploadCanceled;break;default:i.error=e}i.state=ne.FAILED}this._dequeueUploadItem(s,i)}}))}_dequeueUploadItem(e,t){const s=e.uploadQueue.findIndex((e=>e.requestId===t.requestId));s>=0&&e.uploadQueue.splice(s,1)}_uploadNextFileForSingleFileItemAndUpdateParams(e,s,a){var r,o,l;return t.__awaiter(this,void 0,void 0,(function*(){const t=new i({file:a.file,channelUrl:e.url,thumbnailSizes:a.thumbnailSizes,requestId:s.requestId}),d=yield this._requestQueue.send(t),{url:u,fileSize:c=a.fileSize,thumbnails:h=[],requireAuth:p=!1}=d.as(n);a.fileName=null!==(r=a.fileName)&&void 0!==r?r:a.file.name,a.mimeType=null!==(o=a.mimeType)&&void 0!==o?o:a.file.type,a.fileSize=null!==(l=a.fileSize)&&void 0!==l?l:a.file.size,a.fileUrl=u,a.fileSize=c,a.requireAuth=p,a._thumbnails=h}))}_uploadNextFileForMultipleFilesItemAndUpdateParams(e,s,a){var r,o,l;return t.__awaiter(this,void 0,void 0,(function*(){const{uploadIndex:t}=s.multipleFileUploadInfo,d=a.fileInfoList[t],u=new i({file:d.file,channelUrl:e.url,thumbnailSizes:d.thumbnailSizes,requestId:s.requestId}),c=yield this._requestQueue.send(u),{url:h,fileSize:p=d.fileSize,thumbnails:m,requireAuth:_=!1}=c.as(n);d.fileName=null!==(r=d.fileName)&&void 0!==r?r:d.file.name,d.mimeType=null!==(o=d.mimeType)&&void 0!==o?o:d.file.type,d.fileSize=null!==(l=d.fileSize)&&void 0!==l?l:d.file.size,d.file=void 0,d.fileUrl=h,d.fileSize=p,d._thumbnails=m,d._uploadedMetaData=Object.assign(Object.assign({},d._uploadedMetaData),{requireAuth:_,isUploaded:!0}),d instanceof J||(a.fileInfoList[t]=new J(this._iid,d))}))}request(e,s,i,n={}){return t.__awaiter(this,void 0,void 0,(function*(){if(!this._queueMap.has(e.url)){const t={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1};this._queueMap.set(e.url,t)}const a=this._queueMap.get(e.url),r=new t.Deferred,o={requestId:s,params:i,state:ne.PENDING,deferred:r};if(function(e){return"fileInfoList"in e}(i)){const e=i,t=Object.assign({uploadIndex:0,uploadCount:e.fileInfoList.length},n);o.multipleFileUploadInfo=t}return a.messageQueue.push(o),this._uploadNextPendingItem(e),r.promise}))}cancel(e,s){const i=this._queueMap.get(e.url);if(i){const n=s?[i.messageQueue.find((e=>e.requestId===s))]:[...i.messageQueue];for(const s of n)if(s)switch(s.state){case ne.PENDING:if(s.state=ne.FAILED,s.error=t.SendbirdError.requestCanceled,s.multipleFileUploadInfo&&!s.multipleFileUploadInfo.isCopy){const{uploadIndex:e,requestHandler:i}=s.multipleFileUploadInfo,n=s.params.fileInfoList[e];null==i||i._triggerOnFileUploaded(s.requestId,e,n,t.SendbirdError.fileUploadCanceled)}this._resolveMessageQueue(e);break;case ne.UPLOADING:this._requestQueue.cancel(s.requestId),this._dispatcher.dispatch(new t.CancelXMLHttpRequestCommand({requestId:s.requestId}))}}else s&&(this._requestQueue.cancel(s),this._dispatcher.dispatch(new t.CancelXMLHttpRequestCommand({requestId:s})))}}const re={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:t.MessageTypeFilter.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:t.ReplyType.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},oe=e=>t.isTypeOf("number",e.prevResultSize)&&t.isTypeOf("number",e.nextResultSize)&&t.isTypeOf("boolean",e.isInclusive)&&t.isTypeOf("boolean",e.reverse)&&t.isTypeOf("string",e.messageTypeFilter)&&t.isEnumOf(t.MessageTypeFilter,e.messageTypeFilter)&&t.isArrayOf("string",e.customTypesFilter,!0)&&t.isArrayOf("string",e.senderUserIdsFilter,!0)&&t.isEnumOf(t.ReplyType,e.replyType)&&t.isTypeOf("boolean",e.includeMetaArray)&&t.isTypeOf("boolean",e.includeReactions)&&t.isTypeOf("boolean",e.includeParentMessageInfo)&&t.isTypeOf("boolean",e.includeThreadInfo)&&t.isTypeOf("boolean",e.showSubchannelMessagesOnly),le={replyType:t.ReplyType.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},de=e=>t.isEnumOf(t.ReplyType,e.replyType)&&t.isTypeOf("boolean",e.includeReactions)&&t.isTypeOf("boolean",e.includeMetaArray)&&t.isTypeOf("boolean",e.includeParentMessageInfo)&&t.isTypeOf("boolean",e.includeThreadInfo);var ue,ce,he;!function(e){e.MESSAGE="message"}(ue||(ue={})),exports.SDKSource=void 0,(ce=exports.SDKSource||(exports.SDKSource={})).INTERNAL_BACKSYNC="internal_backsync",ce.INTERNAL_FILL_GAP="internal_fill_gap",ce.EXTERNAL_LEGACY="external_legacy",ce.EXTERNAL_COLLECTION="external_collection";class pe extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,includeMetaArray:n,includeReactions:a,includeThreadInfo:r,includeParentMessageInfo:o}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${encodeURIComponent(i)}`,this.params={is_sdk:!0,with_sorted_meta_array:n,include_reactions_summary:null!=a&&a,include_thread_info:r,include_parent_message_info:o,include_poll_details:!0}}}class me extends t.APIResponseCommand{constructor(e,t){super(e,t),this.message=t?Y(e,Object.assign({},t)):null}}class _e extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,timestamp:i,token:n,prevResultSize:a,nextResultSize:r,isInclusive:o,reverse:l,messageTypeFilter:d,customTypesFilter:u,senderUserIdsFilter:c,replyType:h,includeMetaArray:p,includeReactions:m,parentMessageId:_,includeThreadInfo:g,includeParentMessageInfo:y,showSubchannelMessagesOnly:f,checkingHasNext:v,checkingContinuousMessages:I,sdkSource:E}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages`,this.params=t.deundefined(t.undefineNullProps({is_sdk:!0,prev_limit:a,next_limit:r,include:o,reverse:l,message_ts:i,message_id:n,message_type:null!=d?d:null,custom_types:u,sender_ids:c,include_reply_type:h,with_sorted_meta_array:p,include_reactions_summary:m,parent_message_id:_,include_thread_info:g,include_parent_message_info:y,show_subchannel_message_only:f,include_poll_details:!0,checking_has_next:v,checking_continuous_messages:I,sdk_source:E}))}}class ge extends t.APIResponseCommand{constructor(e,t){super(e,t),void 0!==t.is_continuous_messages&&(this.isContinuousMessages=t.is_continuous_messages),void 0!==t.has_next&&(this.hasNext=t.has_next),this.messages=t.messages.map((t=>Y(e,t)))}}class ye extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,timestamp:i,token:n,replyType:a,includeMetaArray:r,includeReactions:o,includeThreadInfo:l,includeParentMessageInfo:d}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/changelogs`,this.params={change_ts:i,token:n,with_sorted_meta_array:r,include_reactions_summary:o,include_thread_info:l,include_reply_type:a,include_parent_message_info:d,include_poll_details:!0}}}class fe extends t.APIResponseCommand{constructor(e,t){super(e,t),this.updatedMessages=t.updated.map((t=>Y(e,t))),this.deletedMessagesInfo=t.deleted.map((e=>({messageId:e.message_id,deletedAt:e.deleted_at}))),this.hasMore=t.has_more,this.nextToken=t.next,this.forceUseNextToken=t.force_use_next_token||!1}}class ve extends t.APIRequestCommand{constructor({channelUrl:e,scheduledMessageId:s}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.API_PATH_GROUP_CHANNELS}/${encodeURIComponent(e)}/scheduled_messages/${encodeURIComponent(s)}`,this.params={}}}class Ie extends t.APIResponseCommand{constructor(e,t){super(e,t),this.message=t?Y(e,Object.assign({},t)):null}}exports.RestrictionType=void 0,(he=exports.RestrictionType||(exports.RestrictionType={})).MUTED="muted",he.BANNED="banned";class Ee{constructor(e){var s,i,n,a;this.restrictionType=null,t.isEnumOf(exports.RestrictionType,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(s=e.description)&&void 0!==s?s:null,this.endAt=null!==(n=null!==(i=e.end_at)&&void 0!==i?i:e.muted_end_at)&&void 0!==n?n:-1,this.remainingDuration=null!==(a=e.remaining_duration)&&void 0!==a?a:-1}static payloadify(e){return t.deundefined(t.undefineNullProps({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt,remaining_duration:e.remainingDuration}))}}class Te extends t.User{constructor(e,t){super(e,t),this.restrictionInfo=new Ee(t)}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),Ee.payloadify(e.restrictionInfo))))}}class be{constructor(){this._onPending=t.noop,this._onFailed=t.noop,this._onSucceeded=t.noop}_trigger(e){switch(null==e?void 0:e.sendingStatus){case t.SendingStatus.PENDING:0===e.errorCode&&this._onPending(e);break;case t.SendingStatus.SCHEDULED:case t.SendingStatus.SUCCEEDED:this._onSucceeded(e)}}_triggerFailed(e,s){switch(null==s?void 0:s.sendingStatus){case t.SendingStatus.FAILED:case t.SendingStatus.CANCELED:this._onFailed(e,s.scheduledInfo?null:s)}}onPending(e){return this._onPending=e,this}onFailed(e){return this._onFailed=e,this}onSucceeded(e){return this._onSucceeded=e,this}}const Se={data:void 0,customType:void 0,mentionType:t.MentionType.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1,pollId:void 0},Me=e=>t.isTypeOf("string",e.data,!0)&&t.isTypeOf("string",e.customType,!0)&&t.isEnumOf(t.MentionType,e.mentionType)&&t.isArrayOf("string",e.mentionedUserIds,!0)&&t.isArrayOf(t.User,e.mentionedUsers,!0)&&t.isArrayOf(_,e.metaArrays,!0)&&t.isTypeOf("number",e.parentMessageId,!0)&&t.isTypeOf("boolean",e.isReplyToChannel)&&t.isEnumOf(t.PushNotificationDeliveryOption,e.pushNotificationDeliveryOption,!0)&&t.isTypeOf(c,e.appleCriticalAlertOptions,!0)&&t.isTypeOf("boolean",e.isPinnedMessage,!0)&&t.isTypeOf("number",e.pollId,!0),Oe=e=>({isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}),Ae=Object.assign(Object.assign({},Se),{message:"",mentionedMessageTemplate:void 0,translationTargetLanguages:void 0,extendedMessagePayload:void 0});function Ce(e){var s,i,n;return null!==(s=e.messageParams)&&void 0!==s?s:t.undefineNullProps(Object.assign(Object.assign({},e),{mentionType:e.mentionType,mentionedUserIds:null!==(i=e.mentionedUserIds)&&void 0!==i?i:null===(n=e.mentionedUsers)||void 0===n?void 0:n.map((e=>e.userId)),mentionedMessageTemplate:e.mentionedMessageTemplate,translationTargetLanguages:Object.keys(e.translations),pushNotificationDeliveryOption:t.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}))}const we=e=>{var s;return t.deundefined(t.undefineNullProps({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(s=e.poll)||void 0===s?void 0:s.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations),extendedMessagePayload:e.extendedMessagePayload}))},Ne=e=>Me(e)&&t.isTypeOf("string",e.message)&&t.isTypeOf("string",e.mentionedMessageTemplate,!0)&&t.isArrayOf("string",e.translationTargetLanguages,!0)&&t.isTypeOf("object",e.extendedMessagePayload,!0);var Pe;!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(Pe||(Pe={}));const Ue=e=>"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob,Re=e=>e===Pe.BLOB||e===Pe.FILE,xe=e=>({file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}),ke=Object.assign(Object.assign({},Se),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1,message:void 0});function Le(e){var s,i,n,a;return null!==(s=e.messageParams)&&void 0!==s?s:t.undefineNullProps(Object.assign(Object.assign({},e),{fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,mentionType:e.mentionType,mentionedUserIds:null!==(i=e.mentionedUserIds)&&void 0!==i?i:null===(n=e.mentionedUsers)||void 0===n?void 0:n.map((e=>e.userId)),pushNotificationDeliveryOption:t.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(a=e.thumbnails)||void 0===a?void 0:a.map((e=>({maxWidth:e.width,maxHeight:e.height}))),requireAuth:e.requireAuth,isPinnedMessage:!1,_thumbnails:e.thumbnails,message:e.message}))}const De=(e,s)=>{var i,n;return e.messageParams?(!e.url&&t.isFile(s)&&(e.messageParams.file=s),e.messageParams):t.deundefined(t.undefineNullProps({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:s,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:null===(i=e.thumbnails)||void 0===i?void 0:i.map((e=>({maxWidth:e.width,maxHeight:e.height}))),message:e.message,pollId:null===(n=e.poll)||void 0===n?void 0:n.id}))},qe=e=>Me(e)&&(t.isFile(e.file)||t.isTypeOf("string",e.fileUrl))&&t.isTypeOf("string",e.fileName,!0)&&t.isTypeOf("string",e.mimeType,!0)&&t.isTypeOf("number",e.fileSize,!0)&&t.isTypeOf("string",e.message,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((e=>t.isTypeOf("object",e)&&e.maxWidth>0&&e.maxHeight>0))),Fe={data:void 0,customType:void 0,mentionType:t.MentionType.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},Be=e=>t.isTypeOf("string",e.data,!0)&&t.isTypeOf("string",e.customType,!0)&&t.isEnumOf(t.MentionType,e.mentionType)&&t.isArrayOf("string",e.mentionedUserIds,!0)&&t.isArrayOf(t.User,e.mentionedUsers,!0)&&t.isArrayOf(_,e.metaArrays,!0)&&t.isEnumOf(t.PushNotificationDeliveryOption,e.pushNotificationDeliveryOption,!0)&&t.isTypeOf(c,e.appleCriticalAlertOptions,!0),je=Object.assign(Object.assign({},Fe),{message:void 0,mentionedMessageTemplate:void 0,translationTargetLanguages:void 0,pollId:void 0}),Ve=e=>Be(e)&&t.isTypeOf("string",e.mentionedMessageTemplate,!0)&&t.isTypeOf("string",e.message,!0)&&t.isArrayOf("string",e.translationTargetLanguages,!0)&&t.isTypeOf("number",e.pollId,!0),ze=Object.assign({},Fe);class $e extends t.APIRequestCommand{constructor({channelUrl:e,channelType:s,token:i,limit:n}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(s)}/${encodeURIComponent(e)}/operators`,this.params={token:i,limit:n}}}class Qe extends t.APIResponseCommand{constructor(e,s){super(e,s),this.operators=s.operators.map((s=>new t.User(e,s))),this.token=s.next}}class Ge extends t.ChannelDataListQuery{constructor(e,t,s,i){super(e,t,s,i)}_validate(){return super._validate()}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;{const e=[];if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=t.Vault.of(this._iid),s=new $e(Object.assign(Object.assign({},this),{channelUrl:this.channelUrl,token:this._token})),i=yield e.send(s),{operators:n,token:a}=i.as(Qe);return this._token=a,this._hasNext=!!a,this._isLoading=!1,n}return e}}throw t.SendbirdError.invalidParameters}))}}class Ke extends t.ChannelDataListQuery{constructor(e,s,i,n){var a,r,o,l,d,u,c,h,p,m;super(e,s,i,n),this.reverse=!1,this.messageTypeFilter=t.MessageTypeFilter.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=t.ReplyType.NONE,this.includeMetaArray=!1,this.includeReactions=!1,this.includeParentMessageInfo=!1,this.includeThreadInfo=!1,this.showSubchannelMessagesOnly=!1,this._edge=Number.MAX_SAFE_INTEGER,this.reverse=null!==(a=n.reverse)&&void 0!==a&&a,this.messageTypeFilter=null!==(r=n.messageTypeFilter)&&void 0!==r?r:t.MessageTypeFilter.ALL,this.customTypesFilter=null!==(o=n.customTypesFilter)&&void 0!==o?o:null,this.senderUserIdsFilter=null!==(l=n.senderUserIdsFilter)&&void 0!==l?l:null,this.replyType=null!==(d=n.replyType)&&void 0!==d?d:t.ReplyType.NONE,this.includeMetaArray=null!==(u=n.includeMetaArray)&&void 0!==u&&u,this.includeReactions=null!==(c=n.includeReactions)&&void 0!==c&&c,this.includeParentMessageInfo=null!==(h=n.includeParentMessageInfo)&&void 0!==h&&h,this.includeThreadInfo=null!==(p=n.includeThreadInfo)&&void 0!==p&&p,this.showSubchannelMessagesOnly=null!==(m=n.showSubchannelMessagesOnly)&&void 0!==m&&m}_validate(){return super._validate()&&t.isTypeOf("boolean",this.reverse)&&t.isEnumOf(t.MessageTypeFilter,this.messageTypeFilter)&&t.isEnumOf(t.ReplyType,this.replyType)&&t.isArrayOf("string",this.customTypesFilter,!0)&&t.isArrayOf("string",this.senderUserIdsFilter,!0)&&t.isTypeOf("boolean",this.includeMetaArray)&&t.isTypeOf("boolean",this.includeReactions)&&t.isTypeOf("boolean",this.includeParentMessageInfo)&&t.isTypeOf("boolean",this.includeThreadInfo)&&t.isTypeOf("boolean",this.showSubchannelMessagesOnly)}load(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const e=Xi.of(this._iid),s=yield e.getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,t.undefineNullProps({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}));return this._edge=Math.min(Number.MAX_SAFE_INTEGER,...s.map((e=>e.createdAt))),this._hasNext=s.length>=this.limit,this._isLoading=!1,s}return[]}throw t.SendbirdError.invalidParameters}))}}class He extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,limit:n,token:a}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/mute`,this.params={limit:n,token:a}}}class We extends t.APIResponseCommand{constructor(e,t){super(e,t),this.mutedUsers=[];const{next:s,muted_list:i}=t;this.token=s,i&&i.length>0&&(this.mutedUsers=i.map((t=>new Te(e,t))))}}class Ye extends t.ChannelDataListQuery{constructor(e,t,s,i){super(e,t,s,i)}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=t.Vault.of(this._iid),s=new He(Object.assign(Object.assign({},this),{token:this._token})),i=yield e.send(s),{mutedUsers:n,token:a}=i.as(We);return this._token=a,this._hasNext=!!a,this._isLoading=!1,n}return[]}throw t.SendbirdError.invalidParameters}))}}class Xe extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,limit:n,token:a}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/ban`,this.params=t.deundefined({limit:n,token:a})}}class Je extends t.APIResponseCommand{constructor(e,t){super(e,t),this.bannedUsers=[];const{next:s,banned_list:i}=t;this.token=s,i&&i.length>0&&(this.bannedUsers=i.map((t=>new Te(e,t.user))))}}class Ze extends t.ChannelDataListQuery{constructor(e,t,s,i){super(e,t,s,i)}_validate(){return super._validate()}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=t.Vault.of(this._iid),s=new Xe(Object.assign(Object.assign({},this),{token:this._token})),i=yield e.send(s),{bannedUsers:n,token:a}=i.as(Je);return this._token=a,this._hasNext=!!a,this._isLoading=!1,n}return[]}throw t.SendbirdError.invalidParameters}))}}var et;exports.ReportCategory=void 0,(et=exports.ReportCategory||(exports.ReportCategory={})).SPAM="spam",et.HARASSING="harassing",et.SUSPICIOUS="suspicious",et.INAPPROPRIATE="inappropriate";class tt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,operatorUserIds:n}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/operators`,this.params={operator_ids:n}}}class st extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,operatorUserIds:n}=e;super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/operators`,this.params={operator_ids:n}}}class it extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,userId:n}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/mute/${n}`}}class nt extends t.APIResponseCommand{constructor(e,t){super(e,t),this.isMuted=!1,this.startAt=0,this.endAt=0;const{is_muted:s,start_at:i,end_at:n,remaining_duration:a,description:r}=t;this.isMuted=s,this.startAt=i,this.endAt=n,this.remainingDuration=a,this.description=r}}class at extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,keys:n}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metadata`,this.params={keys:n,include_ts:!0}}}class rt extends t.APIResponseCommand{constructor(e,t){super(e,t);const{metadata:s,ts:i}=t;this.metadata=s,this.ts=i}}class ot extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,metadata:n}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metadata`,this.params={metadata:n,include_ts:!0}}}class lt extends t.APIResponseCommand{constructor(e,t){var s,i;super(e,t),this.metaData=null!==(s=t.metadata)&&void 0!==s?s:{},this.ts=null!==(i=t.ts)&&void 0!==i?i:null}}class dt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,metadata:n,upsert:a}=e;super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metadata`,this.params={metadata:n,include_ts:!0,upsert:null!=a&&a}}}class ut extends t.APIResponseCommand{constructor(e,t){super(e,t);const{metadata:s,ts:i}=t;this.metadata=s,this.ts=i}}class ct extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"SYEV",s),s.data&&(this.created=s.data.created,this.updated=s.data.updated,this.deleted=s.data.deleted)}}class ht extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,key:n}=e;super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metadata/${n}`,this.params={include_ts:!0}}}class pt extends t.APIResponseCommand{constructor(e,t){super(e,t);const{ts:s}=t;this.ts=s}}class mt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i}=e;super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metadata`,this.params={include_ts:!0}}}class _t extends t.APIResponseCommand{constructor(e,t){super(e,t);const{ts:s}=t;this.ts=s}}class gt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,keys:n}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metacounter`,this.params={keys:n}}}class yt extends t.APIResponseCommand{constructor(e,t){super(e,t),this.metaCounter=t}}class ft extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,metaCounter:n}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metacounter`,this.params={metacounter:n}}}class vt extends t.APIResponseCommand{constructor(e,t){super(e,t),this.metaCounter=t}}class It extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,metaCounter:n,upsert:a=!1,mode:r="set"}=e;super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metacounter`,this.params={metacounter:n,upsert:a,mode:r}}}class Et extends t.APIResponseCommand{constructor(e,t){super(e,t),this.metaCounter=t}}class Tt extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"SYEV",s),s.data&&(this.created=s.data.created,this.updated=s.data.updated,this.deleted=s.data.deleted)}}class bt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,key:n}=e;super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metacounter/${n}`,this.params={}}}class St extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i}=e;super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/metacounter`,this.params={}}}class Mt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,userId:n,seconds:a,description:r}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/mute`,this.params={user_id:n,seconds:a,description:r}}}class Ot extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"SYEV",s),this.user=new Te(e,s.data)}}class At extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,userId:n}=e;super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/mute/${encodeURIComponent(n)}`}}class Ct extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"SYEV",s),this.user=new Te(e,s.data)}}class wt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,userId:n,seconds:a,description:r}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/ban`,this.params=t.deundefined({user_id:n,seconds:a,description:r})}}class Nt extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"SYEV",s),this.user=new Te(e,s.data),s.data.member_count&&(this.memberCount=s.data.member_count),s.data.joined_member_count&&(this.joinedMemberCount=s.data.joined_member_count)}}class Pt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,userId:n}=e;super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/ban/${encodeURIComponent(n)}`}}class Ut extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"SYEV",s),this.user=new Te(e,s.data)}}class Rt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,freezing:n}=e;super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.getChannelApiPathByType(i)}/${encodeURIComponent(s)}/freeze`,this.params={freeze:n}}}class xt extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"SYEV",s),this.freeze=s.data.freeze}}const kt=e=>e instanceof t.ReportCategoryInfo?e._custom?"custom":e.name:e,Lt=e=>{if(e instanceof t.ReportCategoryInfo&&e._custom)return e.name};class Dt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,category:n,userId:a,description:r}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getReportApiPathByType(i)}/${encodeURIComponent(s)}`,this.params=t.deundefined({report_category:kt(n),reporting_user_id:a,report_description:r,custom_report_category_name:Lt(n)})}}class qt extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,category:n,userId:a,offendingUserId:r,description:o}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.API_PATH_REPORT}/users/${r}`,this.params=t.deundefined({channel_url:s,channel_type:i===t.ChannelType.OPEN?"open_channels":"group_channels",report_category:kt(n),reporting_user_id:a,report_description:o,custom_report_category_name:Lt(n)})}}class Ft extends t.APIRequestCommand{constructor(e){const{channelUrl:s,channelType:i,category:n,userId:a,offendingUserId:r,messageId:o,description:l}=e;super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getReportApiPathByType(i)}/${encodeURIComponent(s)}/messages/${o}`,this.params=t.deundefined({report_category:kt(n),reporting_user_id:a,report_description:l,offending_user_id:r,custom_report_category_name:Lt(n)})}}class Bt extends t.WebSocketRequestCommand{constructor(e){let s=[];e.mentionType===t.MentionType.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((e=>e.userId)))),super({code:"MESG",ackRequired:!0,payload:t.deundefined(t.undefineNullProps({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:s,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==t.PushNotificationDeliveryOption.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage,extended_message_payload:e.extendedMessagePayload}))})}}class jt extends t.WebSocketEventCommand{constructor(e,s,i){var n,a,r,o;super(e,"MESG",i),this.message=new G(e,i);const{sdkState:l}=t.Vault.of(e);this.isMentioned=t.checkIfMentioned(this.message.mentionType,null!==(r=null!==(n=this.message.mentionedUserIds)&&void 0!==n?n:null===(a=this.message.mentionedUsers)||void 0===a?void 0:a.map((e=>e.userId)))&&void 0!==r?r:[],l.userId),this.forceUpdateLastMessage=null!==(o=i.force_update_last_message)&&void 0!==o&&o}}class Vt extends t.WebSocketRequestCommand{constructor(e){let s=null;e.mentionType===t.MentionType.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((e=>e.userId)))),super({code:"MEDI",ackRequired:!0,payload:t.deundefined(t.undefineNullProps({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:s,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions?c.payloadify(e.appleCriticalAlertOptions):null,poll_id:e.pollId}))})}}class zt extends t.WebSocketEventCommand{constructor(e,s,i){var n,a,r,o,l;super(e,"MEDI",i),this.message=new G(e,i);const{sdkState:d}=t.Vault.of(e);this.mentionCountChange=t.calculateMentionCountChange({mentionType:null===(n=i.old_values)||void 0===n?void 0:n.mention_type,mentionedUserIds:null!==(r=null===(a=i.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==r?r:[]},t.undefineNullProps({mentionType:this.message.mentionType,mentionedUserIds:null!==(o=this.message.mentionedUserIds)&&void 0!==o?o:null===(l=this.message.mentionedUsers)||void 0===l?void 0:l.map((e=>e.userId))}),d.userId)}}class $t extends t.WebSocketRequestCommand{constructor(e){let s=null;e.mentionType===t.MentionType.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((e=>e.userId)))),super({code:"FEDI",ackRequired:!0,payload:t.deundefined(t.undefineNullProps({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:s,apple_critical_alert_options:e.appleCriticalAlertOptions}))})}}class Qt extends t.WebSocketEventCommand{constructor(e,s,i){var n,a,r,o,l;super(e,"FEDI",i),this.message=new X(e,i);const{sdkState:d}=t.Vault.of(e);this.mentionCountChange=t.calculateMentionCountChange({mentionType:null===(n=i.old_values)||void 0===n?void 0:n.mention_type,mentionedUserIds:null!==(r=null===(a=i.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==r?r:[]},t.undefineNullProps({mentionType:this.message.mentionType,mentionedUserIds:null!==(o=this.message.mentionedUserIds)&&void 0!==o?o:null===(l=this.message.mentionedUsers)||void 0===l?void 0:l.map((e=>e.userId))}),d.userId)}}class Gt extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,reactionKey:n}){super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/reactions`,this.params={reaction:n}}}class Kt extends t.APIResponseCommand{constructor(e,t){super(e,t),this.reactionEvent=new r(t)}}class Ht extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,reactionKey:n}){super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/reactions`,this.params={reaction:n}}}class Wt extends t.APIResponseCommand{constructor(e,t){super(e,t),this.reactionEvent=new r(Object.assign({},t))}}class Yt extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i,translationTargetLanguages:n}){super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${encodeURIComponent(i)}/translation`,this.params={target_langs:n}}}class Xt extends t.APIResponseCommand{constructor(e,t){super(e,t),this.message=new G(e,t)}}class Jt extends t.APIRequestCommand{constructor(e){var s;super();let i=[];e.mentionType===t.MentionType.USERS&&(e.mentionedUserIds?i=e.mentionedUserIds:e.mentionedUsers&&(i=e.mentionedUsers.map((e=>e.userId))));const{channelType:n,channelUrl:a}=e;this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(n)}/${encodeURIComponent(a)}/scheduled_messages`,this.params=t.deundefined(t.undefineNullProps({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:t.ServerSideMessageType.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(s=e.metaArrays)||void 0===s?void 0:s.map((e=>_.payloadify(e))),apple_critical_alert_options:e.appleCriticalAlertOptions?c.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption}))}}class Zt extends t.APIResponseCommand{constructor(e,t){super(e,t),this.message=new G(e,t)}}class es extends t.APIRequestCommand{constructor(e){var i,n;super();let a=[];e.mentionType===t.MentionType.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map((e=>e.userId))));const{channelType:r,channelUrl:o}=e;this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(r)}/${encodeURIComponent(o)}/scheduled_messages`,this.params=t.undefineNullProps({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:t.ServerSideMessageType.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:null===(i=e._thumbnails)||void 0===i?void 0:i.map((e=>s.payloadify(e))),custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:a,sorted_metaarray:null===(n=e.metaArrays)||void 0===n?void 0:n.map((e=>_.payloadify(e))),apple_critical_alert_options:e.appleCriticalAlertOptions?c.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption})}}class ts extends t.APIResponseCommand{constructor(e,t){super(e,t),this.message=new X(e,t)}}class ss extends t.APIRequestCommand{constructor({pollId:e,title:s,data:i,allowUserSuggestion:n,allowMultipleVotes:a,closeAt:r}){super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(e)}`,this.params={title:s,data:i,allow_user_suggestion:n,allow_multiple_votes:a,close_at:r}}}class is extends t.APIResponseCommand{constructor(e,s){super(e,s),this.poll=new t.Poll(e,s)}}class ns extends t.APIRequestCommand{constructor({pollId:e}){super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(e)}`}}class as extends t.APIRequestCommand{constructor({pollId:e}){super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(e)}/close`}}class rs extends t.APIResponseCommand{constructor(e,s){super(e,s),this.poll=new t.Poll(e,s)}}class os extends t.APIRequestCommand{constructor({channelUrl:e,channelType:s,pollId:i,optionText:n}){super(),this.method=t.APIRequestMethod.POST,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(i)}/options`,this.params={channel_url:e,channel_type:s,text:n}}}class ls extends t.APIResponseCommand{constructor(e,s){super(e,s),this.poll=new t.Poll(e,s)}}class ds extends t.APIRequestCommand{constructor({pollId:e,pollOptionId:s,optionText:i}){super(),this.method=t.APIRequestMethod.PUT,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(e)}/options/${encodeURIComponent(s)}`,this.params={text:i}}}class us extends t.APIResponseCommand{constructor(e,s){super(e,s),this.poll=new t.Poll(e,s)}}class cs extends t.APIRequestCommand{constructor({pollId:e,pollOptionId:s}){super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.API_PATH_POLLS}/${encodeURIComponent(e)}/options/${encodeURIComponent(s)}`}}class hs extends t.WebSocketRequestCommand{constructor({reqId:e,channelType:s,channelUrl:i,pollId:n,pollOptionIds:a}){super({code:"VOTE",ackRequired:!0,payload:t.deundefined({req_id:e,channel_type:s===t.ChannelType.OPEN?"open_channels":"group_channels",channel_url:i,poll_id:n,option_ids:a})})}}class ps extends t.WebSocketEventCommand{constructor(e,s,i){super(e,"VOTE",i),this.event=new t.PollVoteEvent(i),this.channelUrl=i.channel_url,this.channelType=i.channel_type}}const ms="Message",_s="NotificationMessage",gs="UserInfo";const ys=Object.assign(Object.assign({},Se),{fileInfoList:[],message:""}),fs=e=>(t.isFile(e.file)||t.isTypeOf("string",e.fileUrl))&&t.isTypeOf("string",e.fileName,!0)&&t.isTypeOf("string",e.mimeType,!0)&&t.isTypeOf("number",e.fileSize,!0)&&(void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((e=>e.maxWidth>0&&e.maxHeight>0)));class vs extends be{constructor(){super(...arguments),this._onFileUploaded=t.noop}_triggerOnFileUploaded(e,t,s,i){this._onFileUploaded(e,t,s,i)}onFileUploaded(e){return this._onFileUploaded=e,this}onPending(e){return super.onPending(e),this}onFailed(e){return super.onFailed(e),this}onSucceeded(e){return super.onSucceeded(e),this}}class Is extends t.InstancedObject{constructor(e,t){super(e),this.message=null,this.message=Y(e,t.message)}}class Es extends t.APIRequestCommand{constructor(e){const{channelType:s,channelUrl:i,limit:n,token:a,includeReactions:r,includeMetaArray:o,includeParentMessageInfo:l,includeThreadInfo:d,includePollDetails:u}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.getChannelApiPathByType(s)}/${encodeURIComponent(i)}/pinned_messages`,this.params=t.deundefined({limit:n,token:a,include_reactions_summary:r,with_sorted_meta_array:o,include_thread_info:d,include_parent_message_info:l,include_poll_details:u})}}class Ts extends t.APIResponseCommand{constructor(e,t){super(e,t);const{pinned_messages:s,has_more:i,next:n}=t;this.pinnedMessages=s.map((t=>new Is(e,t))),this.hasMore=i,this.token=n}}class bs extends t.ChannelDataListQuery{constructor(e,t,s,i){super(e,t,s,i),this.includeMetaArray=i.includeMetaArray,this.includeReactions=i.includeReactions,this.includeParentMessageInfo=i.includeParentMessageInfo,this.includeThreadInfo=i.includeThreadInfo,this.includePollDetails=i.includePollDetails}_validate(){return super._validate()&&t.isTypeOf("boolean",this.includeMetaArray,!0)&&t.isTypeOf("boolean",this.includeReactions,!0)&&t.isTypeOf("boolean",this.includeParentMessageInfo,!0)&&t.isTypeOf("boolean",this.includeThreadInfo,!0)&&t.isTypeOf("boolean",this.includePollDetails,!0)}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=t.Vault.of(this._iid),s=new Es(Object.assign(Object.assign({},this),{token:this._token})),i=yield e.send(s),{pinnedMessages:n,hasMore:a,token:r}=i.as(Ts);return this._token=r,this._hasNext=!!a,this._isLoading=!1,n}return[]}throw t.SendbirdError.invalidParameters}))}}class Ss extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i}){super(),this.method=t.APIRequestMethod.POST,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/pin`}}class Ms extends t.APIRequestCommand{constructor({channelType:e,channelUrl:s,messageId:i}){super(),this.method=t.APIRequestMethod.DELETE,this.path=`${t.getChannelApiPathByType(e)}/${encodeURIComponent(s)}/messages/${i}/pin`}}var Os;exports.SendMessageRequestType=void 0,(Os=exports.SendMessageRequestType||(exports.SendMessageRequestType={})).SEND="send",Os.RESEND="resend",Os.COPY="copy";class As extends t.InstancedObject{get url(){return this._url}get name(){return this._name}set name(e){this._name=e}get createdAt(){return this._createdAt}toJSON(){return Object.assign(Object.assign({},this),{url:this._url,name:this._name,createdAt:this._createdAt})}constructor(e,s){var i,n,a,r,o,l,d;super(e),this._name="",this._createdAt=0,this.pinnedMessageIds=[],this.channelType=t.ChannelType.BASE,this.coverUrl="",this.customType="",this.data="",this.isFrozen=!1,this.isEphemeral=!1,this.creator=null,this._messageCollectionLastAccessedAt=0,this._url=s.channel_url,this._name=null!==(i=s.name)&&void 0!==i?i:"",this._createdAt=1e3*s.created_at,this.coverUrl=null!==(n=s.cover_url)&&void 0!==n?n:"",this.customType=null!==(a=s.custom_type)&&void 0!==a?a:"",this.data=null!==(r=s.data)&&void 0!==r?r:"",this.isFrozen=null!==(o=s.freeze)&&void 0!==o&&o,this.isEphemeral=null!==(l=s.is_ephemeral)&&void 0!==l&&l,this.creator=s.created_by?new t.User(this._iid,s.created_by):null,s.metadata&&Object.keys(s.metadata).length>0&&s.ts?(this._cachedMetaData=new Map,Object.keys(s.metadata).forEach((e=>{this._cachedMetaData.set(e,{value:s.metadata[e],isRemoved:!1,updatedAt:s.ts})}))):"string"==typeof s.metadata&&(this._cachedMetaData=new Map(Object.entries(JSON.parse(s.metadata)))),this.pinnedMessageIds=null!==(d=s.pinned_message_ids)&&void 0!==d?d:[]}static payloadify(e){return t.deundefined(t.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?t.User.payloadify(e.creator):null,created_at:e.createdAt/1e3,metadata:e.cachedMetaData,pinned_message_ids:e.pinnedMessageIds})))}isGroupChannel(){return this.channelType===t.ChannelType.GROUP}isOpenChannel(){return this.channelType===t.ChannelType.OPEN}isFeedChannel(){return this.channelType===t.ChannelType.FEED}get cachedMetaData(){const e={};return this._cachedMetaData?(this._cachedMetaData.forEach(((t,s)=>{t.isRemoved||(e[s]=t.value)})),e):e}get messageCollectionLastAccessedAt(){return this._messageCollectionLastAccessedAt}_serializeCachedMetaData(){return this._cachedMetaData?{cachedMetaData:JSON.stringify(Object.fromEntries(this._cachedMetaData))}:{}}_updateMessageCollectionLastAccessedAt(){this._messageCollectionLastAccessedAt=Date.now()}_update(e){Object.assign(this,e)}_upsertCachedMetaData(e,t){Object.keys(e).forEach((s=>{this._cachedMetaData||(this._cachedMetaData=new Map);const i=this._cachedMetaData.get(s);(!i||i.updatedAt<=t)&&this._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:t})}))}_updateCachedMetaData(e,t){let s=!1;return this._cachedMetaData?this._cachedMetaData.forEach(((i,n)=>{var a;i.updatedAt<=t&&(this._cachedMetaData.set(n,{value:null!==(a=e[n])&&void 0!==a?a:i.value,isRemoved:!e[n],updatedAt:t}),s=!0)})):(this._cachedMetaData=new Map,Object.keys(e).forEach((s=>{this._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:t})})),s=!0),{isUpdated:s}}_removeFromCachedMetaData(e,t){this._cachedMetaData&&e.forEach((e=>{const s=this._cachedMetaData.get(e);s&&s.updatedAt<t&&(s.isRemoved=!0,s.updatedAt=t)}))}_clearCachedMetaData(){this._cachedMetaData&&this._cachedMetaData.clear()}_runIfHandleableWithGroupChannel(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)}_generateRequestId(){return`rq-${t.uuid()}`}isIdentical(e){return e&&this.url===e.url}isEqual(e){return t.deepEqual(this,e)}createOperatorListQuery(e={}){return new Ge(this._iid,this.url,this.channelType,e)}createMutedUserListQuery(e={}){return new Ye(this._iid,this.url,this.channelType,e)}createBannedUserListQuery(e={}){return new Ze(this._iid,this.url,this.channelType,e)}createPreviousMessageListQuery(e={}){return new Ke(this._iid,this.url,this.channelType,e)}createPinnedMessageListQuery(e={}){return new bs(this._iid,this.url,this.channelType,e)}addOperators(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isArrayOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new tt({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e});yield s.send(i)}))}removeOperators(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isArrayOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new st({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e});yield s.send(i)}))}getMyMutedInfo(){return t.__awaiter(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:s}=t.Vault.of(this._iid),i=new it({channelUrl:this.url,channelType:this.channelType,userId:e.userId}),n=yield s.send(i),{isMuted:a,startAt:r,endAt:o,remainingDuration:l,description:d}=n.as(nt);return{isMuted:a,startAt:r,endAt:o,remainingDuration:l,description:d}}))}getMetaData(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isArrayOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new at({channelUrl:this.url,channelType:this.channelType,keys:e}),n=yield s.send(i),{metadata:a,ts:r}=n.as(rt);return this._upsertCachedMetaData(a,r),a}))}getAllMetaData(){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:e}=t.Vault.of(this._iid),s=new at({channelUrl:this.url,channelType:this.channelType,keys:[]}),i=yield e.send(s),{metadata:n,ts:a}=i.as(rt);return this._updateCachedMetaData(n,a),n}))}createMetaData(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s}=t.Vault.of(this._iid),i=new ot({channelUrl:this.url,channelType:this.channelType,metadata:e}),n=yield s.send(i),{metaData:a}=n.as(lt);return this._upsertCachedMetaData(a,0),a}))}updateMetaData(e,s=!1){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:i}=t.Vault.of(this._iid),n=new dt({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:s}),a=yield i.send(n),{metadata:r,ts:o}=a.as(ut);return this._upsertCachedMetaData(r,o),r}))}deleteMetaData(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new ht({channelUrl:this.url,channelType:this.channelType,key:e}),n=yield s.send(i),{ts:a}=n.as(pt);this._removeFromCachedMetaData([e],a)}))}deleteAllMetaData(){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:e}=t.Vault.of(this._iid),s=new mt({channelUrl:this.url,channelType:this.channelType}),i=yield e.send(s),{ts:n}=i.as(_t);this._removeFromCachedMetaData([...this._cachedMetaData.keys()],n)}))}getMetaCounters(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isArrayOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new gt({channelUrl:this.url,channelType:this.channelType,keys:e}),n=yield s.send(i),{metaCounter:a}=n.as(yt);return a}))}getAllMetaCounters(){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:e}=t.Vault.of(this._iid),s=new gt({channelUrl:this.url,channelType:this.channelType,keys:[]}),i=yield e.send(s),{metaCounter:n}=i.as(yt);return n}))}createMetaCounters(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s}=t.Vault.of(this._iid),i=new ft({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),n=yield s.send(i),{metaCounter:a}=n.as(vt);return a}))}updateMetaCounters(e,s=!1){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:i}=t.Vault.of(this._iid),n=new It({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:s}),a=yield i.send(n),{metaCounter:r}=a.as(Et);return r}))}increaseMetaCounters(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s}=t.Vault.of(this._iid),i=new It({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),n=yield s.send(i),{metaCounter:a}=n.as(Et);return a}))}decreaseMetaCounters(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s}=t.Vault.of(this._iid),i=new It({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),n=yield s.send(i),{metaCounter:a}=n.as(Et);return a}))}deleteMetaCounter(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new bt({channelUrl:this.url,channelType:this.channelType,key:e});yield s.send(i)}))}deleteAllMetaCounters(){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:e}=t.Vault.of(this._iid),s=new St({channelUrl:this.url,channelType:this.channelType});yield e.send(s)}))}muteUser(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){return this.muteUserWithUserId(e.userId,s,i)}))}muteUserWithUserId(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e)&&t.isTypeOf("number",s,!0)&&t.isTypeOf("string",i,!0)).throw(t.SendbirdError.invalidParameters);const{requestQueue:n}=t.Vault.of(this._iid),a=new Mt({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:s,description:i});yield n.send(a)}))}unmuteUser(e){return t.__awaiter(this,void 0,void 0,(function*(){return this.unmuteUserWithUserId(e.userId)}))}unmuteUserWithUserId(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new At({channelUrl:this.url,channelType:this.channelType,userId:e});yield s.send(i)}))}banUser(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){return this.banUserWithUserId(e.userId,s,i)}))}banUserWithUserId(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e)&&t.isTypeOf("number",s,!0)&&t.isTypeOf("string",i,!0)).throw(t.SendbirdError.invalidParameters);const{requestQueue:n}=t.Vault.of(this._iid),a=new wt({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:s,description:i});yield n.send(a)}))}unbanUser(e){return t.__awaiter(this,void 0,void 0,(function*(){return this.unbanUserWithUserId(e.userId)}))}unbanUserWithUserId(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e)).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new Pt({channelUrl:this.url,channelType:this.channelType,userId:e});yield s.send(i)}))}freeze(){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:e}=t.Vault.of(this._iid),s=new Rt({channelUrl:this.url,channelType:this.channelType,freezing:!0});yield e.send(s),this.isFrozen=!0}))}unfreeze(){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:e}=t.Vault.of(this._iid),s=new Rt({channelUrl:this.url,channelType:this.channelType,freezing:!1});yield e.send(s),this.isFrozen=!1}))}getMessagesByMessageId(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},re),s);t.unless(t.isTypeOf("number",e)&&oe(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getMessagesByMessageId(this.url,this.channelType,e,i)}))}getMessagesByTimestamp(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},re),s);t.unless(t.isTypeOf("number",e)&&oe(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getMessagesByTimestamp(this.url,this.channelType,e,i)}))}getMessageChangeLogsSinceTimestamp(e,s={}){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},le),s);t.unless(t.isTypeOf("number",e)&&de(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getMessageChangelogs(this.url,this.channelType,e,i)}))}getMessageChangeLogsSinceToken(e,s={}){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},le),s);t.unless(t.isTypeOf("string",e)&&de(i)).throw(t.SendbirdError.invalidParameters);const n=Xi.of(this._iid);return yield n.getMessageChangelogs(this.url,this.channelType,e,i)}))}_createPendingSendableMessagePayload(e,s,i){var n;const{sessionManager:a}=t.Vault.of(this._iid);return t.deundefined(t.undefineNullProps({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((e=>_.payloadify(e))):null,apple_critical_alert_options:e.appleCriticalAlertOptions?c.payloadify(e.appleCriticalAlertOptions):null,created_at:i,user:a.currentUser?m.payloadify(a.currentUser):null,req_id:s,request_state:t.SendingStatus.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(n=e.mentionedUsers)||void 0===n?void 0:n.map((e=>t.User.payloadify(e)))}))}_createPendingUserMessage(e,s,i){const n={};if(e.translationTargetLanguages)for(const t of e.translationTargetLanguages)n[t]="";const a=t.deundefined(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(e,s,i)),{type:t.MessageType.USER,message:e.message,translations:n,extended_message_payload:e.extendedMessagePayload})),r=new G(this._iid,a);return r.messageParams=e,r}_createPendingScheduledUserMessage(e,t,s){const i=this._createPendingUserMessage(e,t,s);return i.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},i}_createPendingFileMessage(e,i,n){var a,r,o,l,d,u,c;const h=t.deundefined(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(e,i,n)),{type:t.MessageType.FILE,url:e.fileUrl,file:{name:null!==(a=e.fileName)&&void 0!==a?a:null===(r=e.file)||void 0===r?void 0:r.name,size:null!==(o=e.fileSize)&&void 0!==o?o:null===(l=e.file)||void 0===l?void 0:l.size,type:null!==(d=e.mimeType)&&void 0!==d?d:null===(u=e.file)||void 0===u?void 0:u.type,data:e.data},thumbnails:null===(c=e._thumbnails)||void 0===c?void 0:c.map((e=>s.payloadify(e))),message:e.message})),p=new X(this._iid,h);return p.messageParams=e,p}_createPendingMultipleFilesMessage(e,s,i){const n=t.deundefined(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(e,s,i)),{type:t.MessageType.FILE,file:e.fileInfoList.length>0?{name:e.fileInfoList[0].fileName,size:e.fileInfoList[0].fileSize,type:e.fileInfoList[0].mimeType,data:e.data}:void 0,message:e.message})),a=new K(this._iid,n);return a.messageParams=e,a}_validateFailedFileMessageHasFile(e,s){var i;return Boolean(e.url)||t.isFile(s)||t.isFile(null===(i=e.messageParams)||void 0===i?void 0:i.file)}_createPendingScheduledFileMessage(e,t,s){const i=this._createPendingFileMessage(e,t,s);return i.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},i}_markMessageAsFailed(e,s,i=!1){e.errorCode=s.code,s.code===t.SendbirdErrorCode.REQUEST_CANCELED||s.code===t.SendbirdErrorCode.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=t.SendingStatus.CANCELED:i||(e.sendingStatus=t.SendingStatus.FAILED)}sendUserMessage(e){const s=Object.assign(Object.assign({},Ae),e);return t.unless(Ne(s)).throw(t.SendbirdError.invalidParameters),this._sendUserMessage(s)}_sendUserMessage(e,s=exports.SendMessageRequestType.SEND,i){const{dispatcher:n,requestQueue:a}=t.Vault.of(this._iid),r=null!=i?i:this._generateRequestId(),o=Date.now(),l=new be;return t.sleep(2).then((()=>{const i=this._createPendingUserMessage(e,r,o);n.dispatch(new t.MessageUpdateEventCommand({messages:[i],source:s===exports.SendMessageRequestType.RESEND?t.CollectionEventSource.LOCAL_MESSAGE_RESEND_STARTED:t.CollectionEventSource.EVENT_MESSAGE_SENT_PENDING})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._trigger(i)}))));const d=new Bt(Object.assign(Object.assign({},e),{channelUrl:this.url,channelType:this.channelType,reqId:r}));a.send(d).then((e=>{const{message:s}=e.as(jt);n.dispatch(new t.MessageUpdateEventCommand({messages:[s],source:t.CollectionEventSource.EVENT_MESSAGE_SENT_SUCCESS})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._trigger(s)}))))})).catch((s=>{if(t.isThrowingOutside(s))throw s;t.sleep(2).then((()=>{const i=this._createPendingUserMessage(e,r,o),{cacheContext:a}=t.Vault.of(this._iid),d=a.localCacheEnabled&&a.localCacheConfig.enableAutoResend&&t.isAutoResendableError(s.code);this._markMessageAsFailed(i,s,d),n.dispatch(new t.MessageUpdateEventCommand({messages:[i],source:i.sendingStatus===t.SendingStatus.PENDING?t.CollectionEventSource.REQUEST_RESEND_MESSAGE:t.CollectionEventSource.EVENT_MESSAGE_SENT_FAILED})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._triggerFailed(s,i)}))))}))}))})),l}_autoResendUserMessage(e){return t.unless(e instanceof G&&!!e.messageParams).throw(t.SendbirdError.invalidParameters),this._sendUserMessage(e.messageParams,exports.SendMessageRequestType.SEND,e.reqId)}resendUserMessage(e){var s;return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof G&&!e.scheduledInfo).throw(t.SendbirdError.invalidParameters);const i=new t.Deferred,n=null!==(s=e.messageParams)&&void 0!==s?s:we(e);return this._sendUserMessage(n,exports.SendMessageRequestType.RESEND,e.reqId).onFailed((e=>i.reject(e))).onSucceeded((e=>i.resolve(e))),i.promise}))}updateUserMessage(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},je),s);t.unless(t.isTypeOf("number",e)&&Ve(i)).throw(t.SendbirdError.invalidParameters);const{requestQueue:n}=t.Vault.of(this._iid),a=new Vt(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),r=yield n.send(a),{message:o}=r.as(zt);return o}))}copyUserMessage(e,s){var i,n,a;return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof As&&s instanceof G&&s.sendingStatus===t.SendingStatus.SUCCEEDED&&this.url===s.channelUrl&&!s.scheduledInfo).throw(t.SendbirdError.invalidParameters),t.unless(!s.poll).throw(t.SendbirdError.notSupportedError);const r=new t.Deferred,o=null!==(i=s.messageParams)&&void 0!==i?i:t.undefineNullProps(Object.assign(Object.assign({},s),{mentionType:s.mentionType,mentionedUserIds:null!==(n=s.mentionedUserIds)&&void 0!==n?n:null===(a=s.mentionedUsers)||void 0===a?void 0:a.map((e=>e.userId)),translationTargetLanguages:Object.keys(s.translations),pushNotificationDeliveryOption:t.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}));return e._sendUserMessage(o).onSucceeded((e=>{r.resolve(e)})).onFailed((e=>r.reject(e))),r.promise}))}translateUserMessage(e,s){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof G&&e.messageId>0&&t.isArrayOf("string",s)).throw(t.SendbirdError.invalidParameters);const{requestQueue:i}=t.Vault.of(this._iid),n=new Yt({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:s}),a=yield i.send(n),{message:r}=a.as(Xt);return r}))}_createScheduledUserMessage(e,s){const{requestQueue:i}=t.Vault.of(this._iid),n=Date.now(),a=this._generateRequestId();t.sleep(2).then((()=>{const i=this._createPendingScheduledUserMessage(e,a,n);t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return s._trigger(i)}))))}));const r=new Jt(Object.assign({reqId:a,channelType:this.channelType,channelUrl:this.url},e));i.send(r).then((e=>{const{message:i}=e.as(Zt);t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return s._trigger(i)}))))})).catch((i=>{if(t.isThrowingOutside(i))throw i;t.sleep(2).then((()=>{const r=this._createPendingScheduledUserMessage(e,a,n);this._markMessageAsFailed(r,i),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return s._triggerFailed(i,r)}))))}))}))}sendFileMessage(e){const s=Object.assign(Object.assign({},ke),e);return t.unless(qe(s)).throw(t.SendbirdError.invalidParameters),this._sendFileMessage(s)}sendMultipleFilesMessage(e){var s;const i=Object.assign(Object.assign({},ys),e),n=t.Vault.of(this._iid);t.unless(((e,s=t.DEFAULT_MULTIPLE_FILES_MESSAGE_FILE_COUNT_LIMIT)=>Me(e)&&t.isTypeOf("string",e.message,!0)&&Array.isArray(e.fileInfoList)&&e.fileInfoList.length>=2&&e.fileInfoList.length<=s&&e.fileInfoList.every((e=>fs(e))))(i,null===(s=n.appInfo)||void 0===s?void 0:s.multipleFilesMessageFileCountLimit)).throw(t.SendbirdError.invalidParameters);const a=!!e.fileInfoList.find((e=>{const t=n.appInfo.uploadSizeLimit;return e.file instanceof Blob&&e.file.size>t||e.fileSize>t}));return t.unless(!a).throw(t.SendbirdError.fileSizeLimitExceededError),this._sendMultipleFilesMessage(i)}_sendFileMessage(e,s=exports.SendMessageRequestType.SEND,i){const{dispatcher:n}=t.Vault.of(this._iid),{fileMessageQueue:a}=Xi.of(this._iid),r=null!=i?i:this._generateRequestId(),o=Date.now(),l=new be;return t.sleep(2).then((()=>{const i=this._createPendingFileMessage(e,r,o);n.dispatch(new t.MessageUpdateEventCommand({messages:[i],source:s===exports.SendMessageRequestType.RESEND?t.CollectionEventSource.LOCAL_MESSAGE_RESEND_STARTED:t.CollectionEventSource.EVENT_MESSAGE_SENT_PENDING})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._trigger(i)})))),a.request(this,r,e).then((e=>{n.dispatch(new t.MessageUpdateEventCommand({messages:[e],source:t.CollectionEventSource.EVENT_MESSAGE_SENT_SUCCESS})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._trigger(e)}))))})).catch((s=>{if(t.isThrowingOutside(s))throw s;t.sleep(2).then((()=>{const i=this._createPendingFileMessage(e,r,o),{cacheContext:a}=t.Vault.of(this._iid),d=a.localCacheEnabled&&a.localCacheConfig.enableAutoResend&&t.isAutoResendableError(s.code);this._markMessageAsFailed(i,s,d),n.dispatch(new t.MessageUpdateEventCommand({messages:[i],source:i.sendingStatus===t.SendingStatus.PENDING?t.CollectionEventSource.REQUEST_RESEND_MESSAGE:s.code===t.SendbirdErrorCode.FILE_UPLOAD_CANCEL_FAILED?t.CollectionEventSource.LOCAL_MESSAGE_CANCELED:t.CollectionEventSource.EVENT_MESSAGE_SENT_FAILED})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._triggerFailed(s,i)}))))}))}))})),l}_autoResendFileMessage(e){t.unless(e instanceof X&&!!e.messageParams).throw(t.SendbirdError.invalidParameters);const{logger:s}=t.Vault.of(this._iid);return s.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,exports.SendMessageRequestType.SEND,e.reqId).onFailed((e=>{s.debug("autoResendFileMessage failed",e)})).onSucceeded((e=>{s.debug("autoResendFileMessage success",e)}))}_sendMultipleFilesMessage(e,s,i){const{dispatcher:n}=t.Vault.of(this._iid),{fileMessageQueue:a}=Xi.of(this._iid),r=null!=i?i:this._generateRequestId(),o=Date.now(),l=new vs;return t.sleep(2).then((()=>{const i=this._createPendingMultipleFilesMessage(e,r,o);n.dispatch(new t.MessageUpdateEventCommand({messages:[i],source:s===exports.SendMessageRequestType.RESEND?t.CollectionEventSource.LOCAL_MESSAGE_RESEND_STARTED:t.CollectionEventSource.EVENT_MESSAGE_SENT_PENDING})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._trigger(i)})))),a.request(this,r,e,{requestHandler:l,isCopy:s===exports.SendMessageRequestType.COPY}).then((e=>{n.dispatch(new t.MessageUpdateEventCommand({messages:[e],source:t.CollectionEventSource.EVENT_MESSAGE_SENT_SUCCESS})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._trigger(e)}))))})).catch((s=>{if(t.isThrowingOutside(s))throw s;t.sleep(2).then((()=>{const i=this._createPendingMultipleFilesMessage(e,r,o);this._markMessageAsFailed(i,s),n.dispatch(new t.MessageUpdateEventCommand({messages:[i],source:t.CollectionEventSource.EVENT_MESSAGE_SENT_FAILED})),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return l._triggerFailed(s,i)}))))}))}))})),l}_createScheduledFileMessage(e,s,i,n){const{requestQueue:a}=t.Vault.of(this._iid),r=new es(Object.assign(Object.assign({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));a.send(r).then((e=>{const{message:i}=e.as(ts);t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return s._trigger(i)}))))})).catch((a=>{if(t.isThrowingOutside(a))throw a;t.sleep(2).then((()=>{const r=this._createPendingScheduledFileMessage(e,i,n);this._markMessageAsFailed(r,a),t.runAsCallback((()=>t.__awaiter(this,void 0,void 0,(function*(){return s._triggerFailed(a,r)}))))}))}))}sendFileMessages(e){t.unless(e.every((e=>qe(Object.assign(Object.assign({},ke),e))))).throw(t.SendbirdError.invalidParameters);const s=new be;for(const t of e)this.sendFileMessage(t).onPending((e=>s._trigger(e))).onFailed(((e,t)=>s._triggerFailed(e,t))).onSucceeded((e=>s._trigger(e)));return s}resendFileMessage(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=this._validateFailedFileMessageHasFile(e,s);t.unless(e instanceof X&&i&&!e.scheduledInfo).throw(t.SendbirdError.invalidParameters);const n=new t.Deferred,a=De(e,s);return this._sendFileMessage(a,exports.SendMessageRequestType.RESEND,e.reqId).onFailed((e=>n.reject(e))).onSucceeded((e=>n.resolve(e))),n.promise}))}resendMessage(e,s){var i,n;if(t.unless(e instanceof B&&!e.scheduledInfo&&e.isResendable).throw(t.SendbirdError.invalidParameters),e.isUserMessage()){const t=null!==(i=e.messageParams)&&void 0!==i?i:we(e);return this._sendUserMessage(t,exports.SendMessageRequestType.RESEND,e.reqId)}if(e.isFileMessage()){const i=this._validateFailedFileMessageHasFile(e,s);t.unless(i).throw(t.SendbirdError.invalidParameters);const a=null!==(n=e.messageParams)&&void 0!==n?n:De(e,s);return this._sendFileMessage(a,exports.SendMessageRequestType.RESEND,e.reqId)}if(e.isMultipleFilesMessage())throw t.SendbirdError.channelTypeNotSupportedError}updateFileMessage(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},ze),s);t.unless(t.isTypeOf("number",e)&&(e=>Be(e))(i)).throw(t.SendbirdError.invalidParameters);const{requestQueue:n}=t.Vault.of(this._iid),a=new $t(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),r=yield n.send(a),{message:o}=r.as(Qt);return o}))}uploadFile(e){return t.__awaiter(this,void 0,void 0,(function*(){const{requestQueue:s}=t.Vault.of(this._iid),a=t.uuid(),r=new i({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:a});r.uploadProgressHandler=e.progressHandler,e.uploadStartedHandler&&e.uploadStartedHandler(a);const o=yield s.send(r),{url:l,thumbnails:d}=o.as(n);return{requestId:a,url:l,thumbnails:d}}))}cancelUploadingFileMessage(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e)).throw(t.SendbirdError.invalidParameters);const{fileMessageQueue:s}=Xi.of(this._iid);return s.cancel(this,e),!0}))}copyFileMessage(e,s){var i,n,a;return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof As&&s instanceof X&&s.sendingStatus===t.SendingStatus.SUCCEEDED&&this.url===s.channelUrl&&!s.scheduledInfo).throw(t.SendbirdError.invalidParameters);const r=new t.Deferred,o=t.undefineNullProps(Object.assign(Object.assign({},s),{fileUrl:s.url,fileName:s.name,fileSize:s.size,mimeType:s.type,mentionType:s.mentionType,mentionedUserIds:null!==(i=s.mentionedUserIds)&&void 0!==i?i:null===(n=s.mentionedUsers)||void 0===n?void 0:n.map((e=>e.userId)),pushNotificationDeliveryOption:t.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(a=s.thumbnails)||void 0===a?void 0:a.map((e=>({maxWidth:e.width,maxHeight:e.height}))),requireAuth:s.requireAuth,isPinnedMessage:!1}));return e._sendFileMessage(o).onSucceeded((e=>r.resolve(e))).onFailed((e=>r.reject(e))),r.promise}))}copyMessage(e,s){t.unless(e instanceof As&&s instanceof B&&s.sendingStatus===t.SendingStatus.SUCCEEDED&&this.url===s.channelUrl&&!s.scheduledInfo).throw(t.SendbirdError.invalidParameters);const i=s,n=e;if(i.isUserMessage()){t.unless(!i.poll).throw(t.SendbirdError.notSupportedError);const e=Ce(i);return n._sendUserMessage(e)}if(i.isFileMessage()){const e=Le(i);return n._sendFileMessage(e)}if(s.isMultipleFilesMessage())throw t.SendbirdError.channelTypeNotSupportedError}deleteMessage(e){return t.__awaiter(this,void 0,void 0,(function*(){if(t.unless(e instanceof F).throw(t.SendbirdError.invalidParameters),e.messageId>0){const{requestQueue:s}=t.Vault.of(this._iid),i=new t.DeleteMessageRequestCommand({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,messageToken:e instanceof B?e._messageToken:void 0});yield s.send(i)}}))}addReaction(e,s){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof F&&e.messageId>0&&t.isTypeOf("string",s)).throw(t.SendbirdError.invalidParameters);const{requestQueue:i}=t.Vault.of(this._iid),n=new Gt({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:s}),a=yield i.send(n),{reactionEvent:r}=a.as(Kt);return r}))}deleteReaction(e,s){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof F&&e.messageId>0&&t.isTypeOf("string",s)).throw(t.SendbirdError.invalidParameters);const{requestQueue:i}=t.Vault.of(this._iid),n=new Ht({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:s}),a=yield i.send(n),{reactionEvent:r}=a.as(Wt);return r}))}_updateUserMessageMetaArray(e,s,i,n){return t.__awaiter(this,void 0,void 0,(function*(){const{dispatcher:a,requestQueue:r}=t.Vault.of(this._iid),o=new Vt({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:s,mode:i,upsert:n}}),l=yield r.send(o),{message:d}=l.as(zt);return a.dispatch(new t.MessageUpdateEventCommand({messages:[d],source:t.CollectionEventSource.EVENT_MESSAGE_UPDATED})),d}))}_updateFileMessageMetaArray(e,s,i,n){return t.__awaiter(this,void 0,void 0,(function*(){const{dispatcher:a,requestQueue:r}=t.Vault.of(this._iid),o=new $t({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:s,mode:i,upsert:n}}),l=yield r.send(o),{message:d}=l.as(Qt);return a.dispatch(new t.MessageUpdateEventCommand({messages:[d],source:t.CollectionEventSource.EVENT_MESSAGE_UPDATED})),d}))}createMessageMetaArrayKeys(e,s){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof F&&e.messageId>0&&t.isArrayOf("string",s)).throw(t.SendbirdError.invalidParameters);const i=s.map((e=>new _({key:e})));return e instanceof X?this._updateFileMessageMetaArray(e.messageId,i,"add",!0):this._updateUserMessageMetaArray(e.messageId,i,"add",!0)}))}deleteMessageMetaArrayKeys(e,s){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof F&&e.messageId>0&&t.isArrayOf("string",s)).throw(t.SendbirdError.invalidParameters);const i=s.map((e=>new _({key:e})));return e instanceof X?this._updateFileMessageMetaArray(e.messageId,i,"remove",!0):this._updateUserMessageMetaArray(e.messageId,i,"remove",!0)}))}addMessageMetaArrayValues(e,s){return t.__awaiter(this,void 0,void 0,(function*(){return t.unless(e instanceof F&&e.messageId>0&&s.every((e=>e instanceof _))).throw(t.SendbirdError.invalidParameters),e instanceof X?this._updateFileMessageMetaArray(e.messageId,s,"add",!0):this._updateUserMessageMetaArray(e.messageId,s,"add",!0)}))}removeMessageMetaArrayValues(e,s){return t.__awaiter(this,void 0,void 0,(function*(){return t.unless(e instanceof F&&e.messageId>0&&s.every((e=>e instanceof _))).throw(t.SendbirdError.invalidParameters),e instanceof X?this._updateFileMessageMetaArray(e.messageId,s,"remove",!0):this._updateUserMessageMetaArray(e.messageId,s,"remove",!0)}))}report(e,s){return t.__awaiter(this,void 0,void 0,(function*(){t.unless((t.isEnumOf(exports.ReportCategory,e)||e instanceof t.ReportCategoryInfo)&&t.isTypeOf("string",s)).throw(t.SendbirdError.invalidParameters);const{sdkState:i,requestQueue:n}=t.Vault.of(this._iid),a=new Dt({channelUrl:this.url,channelType:this.channelType,userId:i.userId,category:e,description:s});yield n.send(a)}))}reportUser(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof t.User&&(t.isEnumOf(exports.ReportCategory,s)||s instanceof t.ReportCategoryInfo)&&t.isTypeOf("string",i)).throw(t.SendbirdError.invalidParameters);const{sdkState:n,requestQueue:a}=t.Vault.of(this._iid),r=new qt({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:e.userId,category:s,description:i});yield a.send(r)}))}reportMessage(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(e instanceof B&&(t.isEnumOf(exports.ReportCategory,s)||s instanceof t.ReportCategoryInfo)&&t.isTypeOf("string",i)).throw(t.SendbirdError.invalidParameters);const{sdkState:n,requestQueue:a}=t.Vault.of(this._iid),r=new Ft({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:s,description:i,messageToken:e._messageToken});yield a.send(r)}))}updatePoll(e,s){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("number",e)&&(e=>t.isTypeOf("string",e.title,!0)&&t.validatePollData(e.data)&&t.isTypeOf("boolean",e.allowUserSuggestion,!0)&&t.isTypeOf("boolean",e.allowMultipleVotes,!0)&&t.isTypeOf("number",e.closeAt,!0))(s)).throw(t.SendbirdError.invalidParameters);const{requestQueue:i}=t.Vault.of(this._iid),n=new ss(Object.assign({pollId:e},s)),a=yield i.send(n),{poll:r}=a.as(is);return r}))}deletePoll(e){return t.__awaiter(this,void 0,void 0,(function*(){const s=t.isTypeOf("number",e);t.unless(s).throw(t.SendbirdError.invalidParameters);const{requestQueue:i}=t.Vault.of(this._iid),n=new ns({pollId:e});yield i.send(n)}))}closePoll(e){return t.__awaiter(this,void 0,void 0,(function*(){const s=t.isTypeOf("number",e);t.unless(s).throw(t.SendbirdError.invalidParameters);const{requestQueue:i}=t.Vault.of(this._iid),n=new as({pollId:e}),a=yield i.send(n),{poll:r}=a.as(rs);return r}))}addPollOption(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=t.isTypeOf("number",e)&&t.isTypeOf("string",s)&&""!==s.trim();t.unless(i).throw(t.SendbirdError.invalidParameters);const{requestQueue:n}=t.Vault.of(this._iid),a=new os({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:s}),r=yield n.send(a),{poll:o}=r.as(ls);return o}))}updatePollOption(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){const n=t.isTypeOf("number",e)&&t.isTypeOf("number",s)&&t.isTypeOf("string",i)&&""!==i.trim();t.unless(n).throw(t.SendbirdError.invalidParameters);const{requestQueue:a}=t.Vault.of(this._iid),r=new ds({pollId:e,pollOptionId:s,optionText:i}),o=yield a.send(r),{poll:l}=o.as(us);return l}))}deletePollOption(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=t.isTypeOf("number",e)&&t.isTypeOf("number",s);t.unless(i).throw(t.SendbirdError.invalidParameters);const{requestQueue:n}=t.Vault.of(this._iid),a=new cs({pollId:e,pollOptionId:s});yield n.send(a)}))}votePoll(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=t.isTypeOf("number",e)&&t.isArrayOf("number",s);t.unless(i).throw(t.SendbirdError.invalidParameters);const{requestQueue:n,dispatcher:a}=t.Vault.of(this._iid),r=new hs({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:s}),o=yield n.send(r),{event:l}=o.as(ps);return a.dispatch(new t.PollVoteInternalEventCommand({event:l,source:t.CollectionEventSource.EVENT_POLL_VOTED})),l}))}getPollChangeLogsSinceTimestamp(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("number",e)).throw(t.SendbirdError.invalidParameters);const s=t.PollManager.of(this._iid);return yield s.getPollChangeLogs(this.url,this.channelType,e)}))}getPollChangeLogsSinceToken(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("string",e,!0));const s=t.PollManager.of(this._iid);return yield s.getPollChangeLogs(this.url,this.channelType,e)}))}createPollListQuery(e=10){return new t.PollListQuery(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})}createPollVoterListQuery(e,s,i=20){return new t.PollVoterListQuery(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:s,limit:i})}pinMessage(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("number",e)&&e>0).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new Ss({channelType:this.channelType,channelUrl:this.url,messageId:e});yield s.send(i)}))}unpinMessage(e){return t.__awaiter(this,void 0,void 0,(function*(){t.unless(t.isTypeOf("number",e)&&e>0).throw(t.SendbirdError.invalidParameters);const{requestQueue:s}=t.Vault.of(this._iid),i=new Ms({channelType:this.channelType,channelUrl:this.url,messageId:e});yield s.send(i)}))}}const Cs={};class ws{constructor({dbname:e,itemSizeLimit:t=1048576,cacheLimit:s=256,blockHashBase:i=2,blockHashMultiplier:n=10,blockHashConstant:a=11,transactionApplyDelay:r=200,disableLogger:o=!1}){return Cs[e]||(this.itemSizeLimit=t,this.cacheLimit=s,this.blockHashBase=i,this.blockHashMultiplier=n,this.blockHashConstant=a,this.transactionApplyDelay=r,this.disableLogger=o,Cs[e]=this),Cs[e]}static get(e){return Cs[e]}}var Ns,Ps;!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(Ns||(Ns={}));class Us extends Error{constructor({code:e=Ns.UNKNOWN_ERROR,message:t="Unknown error occurred."}){super(t),this.code=e,Object.setPrototypeOf(this,Us.prototype)}static get storeNotDefined(){return new Us({code:Ns.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})}static get storeNotAvailable(){return new Us({code:Ns.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})}static get storeNotAvailableInPrivateBrowsing(){return new Us({code:Ns.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})}static get storeIsFull(){return new Us({code:Ns.STORE_IS_FULL,message:"Store is full."})}static get storeNotInitialized(){return new Us({code:Ns.STORE_NOT_INITIALIZED,message:"Store is not initialized."})}static get storeKeyTypeIsInvalid(){return new Us({code:Ns.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})}static get storeBrokenIntegrity(){return new Us({code:Ns.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})}static get storeBrokenBlob(){return new Us({code:Ns.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})}static get storeEncryptionInvalid(){return new Us({code:Ns.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})}static get storeItemSizeExceeded(){return new Us({code:Ns.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})}static get storeReadFailed(){return new Us({code:Ns.STORE_READ_FAILED,message:"Failed to read from store."})}static get storeWriteFailed(){return new Us({code:Ns.STORE_WRITE_FAILED,message:"Failed to write to store."})}static get databaseSchemaNotOnUpgrade(){return new Us({code:Ns.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})}static get collectionNotReady(){return new Us({code:Ns.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})}static get collectionKeyNotMatch(){return new Us({code:Ns.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})}static get collectionQueryNotValid(){return new Us({code:Ns.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})}static get collectionInsertDuplicate(){return new Us({code:Ns.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})}static get collectionKeyNotFound(){return new Us({code:Ns.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})}static get collectionKeyNotGiven(){return new Us({code:Ns.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})}static get collectionWriteFailed(){return new Us({code:Ns.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})}static get collectionItemSizeExceeded(){return new Us({code:Ns.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})}static get indexTableIsRequired(){return new Us({code:Ns.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})}static get indexTypesNotMatch(){return new Us({code:Ns.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})}static get compareTypesNotMatch(){return new Us({code:Ns.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})}static get circularReferenceFound(){return new Us({code:Ns.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})}}!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(Ps||(Ps={}));const Rs=(e,t=new WeakMap)=>{if("object"==typeof e&&null!==e){if(t.has(e))throw Us.circularReferenceFound;{let s;return t.set(e,!0),Array.isArray(e)?s=e.map((e=>Rs(e,t))):e instanceof RegExp||e instanceof Date?s=e:(s={},Object.keys(e).forEach((i=>{s[i]=Rs(e[i],t)}))),t.delete(e),s}}return e},xs=(e,t)=>{if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw Us.compareTypesNotMatch;let s=0;switch(typeof e){case"boolean":case"number":s=e-t;break;case"string":s=e.localeCompare(t)}return s},ks=(e,t)=>{let s=0;for(let t=0;t<e.length;t++)s=e.charCodeAt(t)+(s<<6)+(s<<16)-s;return(s>>>0)%t},Ls=e=>new Promise((t=>{setTimeout((()=>t()),e)})),Ds=(e,t)=>{if(!t)return!1;if("function"!=typeof e){for(const s in e)if(["/and","&&"].includes(s)){if(e[s].some((e=>!Ds(e,t))))return!1}else if(["/or","||"].includes(s)){if(e[s].every((e=>!Ds(e,t))))return!1}else if("/where"===s){if(!(0,e[s])(t))return!1}else{const i=s;if("object"==typeof e[i]){const s=e[i];for(const e in s)switch(e){case"/eq":case"=":if(t[i]!==s[e])return!1;break;case"/neq":case"!=":if(t[i]===s[e])return!1;break;case"/gt":case">":{const n=t[i],a=s[e];if(!(xs(n,a)>0))return!1;break}case"/gte":case">=":{const n=t[i],a=s[e];if(!(xs(n,a)>=0))return!1;break}case"/lt":case"<":{const n=t[i],a=s[e];if(!(xs(n,a)<0))return!1;break}case"/lte":case"<=":{const n=t[i],a=s[e];if(!(xs(n,a)<=0))return!1;break}case"/in":{const n=t[i];if(!s[e].includes(n))return!1;break}case"/nin":{const n=t[i];if(s[e].includes(n))return!1;break}case"/contain":{const n=t[i],a=s[e];if(!n.includes(a))return!1;break}case"/regex":{const n=t[i];if(!s[e].test(n))return!1;break}case"/where":{const n=t[i];if(!(0,s[e])(n))return!1;break}}}else if("function"==typeof e[i]){if(!e[i](t[i]))return!1}else if(e[i]!==t[i])return!1}return!0}return e(t)},qs=()=>{},Fs=()=>Promise.resolve(),Bs=e=>e,js=(e,t)=>{t()};var Vs;!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(Vs||(Vs={}));class zs{constructor({initialPrevValue:e=null,initialNextValue:t=null,iterator:s,map:i=Bs,backward:n=Fs,forward:a=Fs,complete:r=qs}){this._prevValue=e,this._nextValue=t,this._error=null,this._map=i,this._backward=n,this._forward=a,this._iterator=s,this._complete=r}get prevValue(){return this._map(this._prevValue)}get nextValue(){return this._map(this._nextValue)}get error(){return this._error}get hasPrevious(){return!!this._prevValue}get hasNext(){return!!this._nextValue}prev(){return t.__awaiter(this,void 0,void 0,(function*(){if(this.hasPrevious){try{const e=this._prevValue;this._prevValue=(yield this._backward())||null,this._nextValue=e}catch(e){this._error=e}return yield this._iterator(this)}this._complete()}))}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this.hasNext){try{const e=this._nextValue;this._nextValue=(yield this._forward())||null,this._prevValue=e}catch(e){this._error=e}return yield this._iterator(this)}this._complete()}))}stop(){this._prevValue=null,this._nextValue=null,this._complete()}}class $s{constructor({condition:e={},backward:t=!1,blockManager:s,indexer:i}){this.condition=e,this.backward=t,this._blockManager=s,this._indexer=i}findOptimizedStartPosition(){const e=["=","/eq",">",">=","/gt","/gte"],t=["=","/eq","<","<=","/lt","/lte"];if(this.backward){let s=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(let i=0;i<this._indexer.fields.length;i++){let n=this._indexer.fields[i],a=1;if("-"===n[0]&&(n=n.slice(1),a=-1),this.condition[n])if("object"==typeof this.condition[n]){const r=a>0?t:e;for(const e in this.condition[n])if(r.includes(e))for(let t=s;t>=0;t--)if(a*xs(this._indexer.origin[t].columnValues[i],this.condition[n][e])<=0){s=t;break}}else for(let e=s;e>=0;e--)if(a*xs(this._indexer.origin[e].columnValues[i],this.condition[n])<=0){s=e;break}}return Math.min(s+1,this._indexer.origin.length-1)}{let s=0;if("function"!=typeof this.condition)for(let i=0;i<this._indexer.fields.length;i++){let n=this._indexer.fields[i],a=1;if("-"===n[0]&&(n=n.slice(1),a=-1),this.condition[n])if("object"==typeof this.condition[n])Object.keys(this.condition[n]).forEach((r=>{if((a>0?e:t).includes(r))for(let e=s;e<this._indexer.origin.length;e++)if(a*xs(this._indexer.origin[e].columnValues[i],this.condition[n][r])>=0){s=e;break}}));else for(let e=s;e<this._indexer.origin.length;e++)if(a*xs(this._indexer.origin[e].columnValues[i],this.condition[n])>=0){s=e;break}}return Math.max(s-1,0)}}each(e){return t.__awaiter(this,void 0,void 0,(function*(){let s=this.findOptimizedStartPosition(),i=0;this.backward&&this._indexer.origin[s]&&(i=this._indexer.origin[s].keys.length-1);const n=()=>{if(this._indexer.origin[s]){if(!this._indexer.origin[s].keys[++i]){if(!this._indexer.origin[++s])return!1;i=0}return!0}return!1},a=()=>{if(this._indexer.origin[s]){if(!this._indexer.origin[s].keys[--i]){if(!this._indexer.origin[--s])return!1;i=this._indexer.origin[s].keys.length-1}return!0}return!1};let r=null;if(this._indexer.origin[s]){const e=this.backward?a:n;do{const e=yield this._blockManager.getFromBlock(this._indexer.origin[s].keys[i]);if(e&&Ds(this.condition,e)){r=e;break}}while(e())}return yield new Promise((o=>{const l=new zs({initialNextValue:Rs(r),iterator:e,forward:()=>t.__awaiter(this,void 0,void 0,(function*(){const e=this.backward?a:n;for(;e();){const e=yield this._blockManager.getFromBlock(this._indexer.origin[s].keys[i]);if(e&&Ds(this.condition,e))return Rs(e)}return null})),backward:()=>t.__awaiter(this,void 0,void 0,(function*(){const e=this.backward?n:a;for(;e();){const e=yield this._blockManager.getFromBlock(this._indexer.origin[s].keys[i]);if(e&&Ds(this.condition,e))return Rs(e)}return null})),complete:o});e(l)}))}))}}class Qs{constructor({condition:e={},backward:t=!1,mutex:s,blockManager:i,indexer:n}){this._mutex=s,this._iterator=new $s({condition:e,backward:t,blockManager:i,indexer:n})}fetch(e={}){return t.__awaiter(this,void 0,void 0,(function*(){let s=Math.max(e.offset||0,0);const i="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER;if(0===i)return[];if(i<0)throw Us.collectionQueryNotValid;try{const e=[];return yield this._mutex.lock(),yield this._iterator.each((n=>t.__awaiter(this,void 0,void 0,(function*(){n.error?n.stop():n.hasNext?0===s?(e.push(n.nextValue),0<i&&i<=e.length?n.stop():n.next()):(s--,n.next()):n.stop()})))),this._mutex.unlock(),e}catch(e){throw this._mutex.unlock(),e}}))}count(){return t.__awaiter(this,void 0,void 0,(function*(){try{let e=0;return yield this._mutex.lock(),yield this._iterator.each((s=>t.__awaiter(this,void 0,void 0,(function*(){s.error?s.stop():s.hasNext?(e++,s.next()):s.stop()})))),this._mutex.unlock(),e}catch(e){throw this._mutex.unlock(),e}}))}}const Gs=e=>`nest@${e}`,Ks=(e,t)=>`${Gs(e)}/${t}`,Hs=(e,t)=>`${Ks(e,t)}.metadata`,Ws=(e,t)=>`${Ks(e,t)}/block.`,Ys=(e,t)=>`${Ks(e,t)}/blob.`;class Xs{constructor({dbname:e,collectionName:t,store:s}){this.dbname=e,this.collectionName=t,this.store=s}get(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield this.store.get(e);if(t){const{data:e,type:s}=t;if("undefined"!=typeof fetch){const t=yield fetch(e);return yield t.blob()}{const t=512,i=[],n=atob(e.split(",")[1]);for(let e=0;e<n.length;e+=t){const s=n.slice(e,e+t),a=new Array(s.length);for(let e=0;e<s.length;e++)a[e]=s.charCodeAt(e);i.push(new Uint8Array(a))}return new Blob(i,{type:s})}}return null}))}save(e,s=`${Date.now()}`){return t.__awaiter(this,void 0,void 0,(function*(){const{blobId:t,data:i,type:n}=yield new Promise((t=>{const i=((e,t,s,i=0)=>`${Ys(e,t)}${s}.${i}`)(this.dbname,this.collectionName,s),n=new FileReader;n.onload=()=>{t({blobId:i,data:n.result,type:e.type})},n.readAsDataURL(e)}));return yield this.store.set({key:t,value:{data:i,type:n}}),t}))}remove(e){return t.__awaiter(this,void 0,void 0,(function*(){yield this.store.remove(e)}))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){const e=Ys(this.dbname,this.collectionName),s=yield this.store.getAllKeys();yield Promise.all(s.filter((t=>t.startsWith(e))).map((e=>t.__awaiter(this,void 0,void 0,(function*(){return yield this.store.remove(e)})))))}))}}var Js,Zs,ei;!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(Js||(Js={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(Zs||(Zs={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(ei||(ei={}));const ti=[Zs.PENDING,Zs.VOLATILE],si={};class ii{constructor({dbname:e,limit:t=256}){return si[e]||(this.dbname=e,this._items=[],this._limit=t,si[e]=this),si[e]}static get(e){return si[e]}get items(){return this._items}find(e,s,i=ei.DEFAULT){return t.__awaiter(this,void 0,void 0,(function*(){let t=this.get(s);if(t)i===ei.PERSISTENT&&(t.state=Zs.PERSISTENT);else{const n=yield e.get(s);n&&(t={key:s,value:n,state:i===ei.PERSISTENT?Zs.PERSISTENT:Zs.VOLATILE},this.put(t))}return t}))}get(e,t=ei.DEFAULT){const s=this._items.map((e=>e.key)).indexOf(e);if(s>-1){const e=this._items[s];return t===ei.PERSISTENT&&(e.state=Zs.PERSISTENT),t!==ei.NO_CACHE&&this.put(e),e}return null}put(e){if(this._limit>0){const t=this._items.map((e=>e.key)).indexOf(e.key);if(t>-1)ti.includes(this._items[t].state)&&ti.includes(e.state)?(this._items.splice(t,1),this._items.push(e)):(this._items[t].state=e.state,this._items[t].value=e.value);else{this._items.push(e);const t=this._items.filter((e=>e.state===Zs.VOLATILE));let s=t.length-this._limit;if(s>0){const e=[];for(const t of this._items)t.state===Zs.VOLATILE&&s>0?s--:e.push(t);this._items=e}}}}remove(e){const t=this._items.map((e=>e.key)).indexOf(e);t>-1&&this._items.splice(t,1)}clearByCondition(e){this._items=this._items.filter((t=>!e(t)))}clearForDatabase(e){this.clearByCondition((t=>t.key.startsWith(Gs(e))))}clear(e=!1){this._items=e?[]:this._items.filter((e=>e.state!==Zs.VOLATILE))}}class ni{constructor({dbname:e,collectionName:t,store:s}){this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=e,this.collectionName=t,this.metadataKey=((e,t)=>`${Ks(e,t)}/trans.metadata`)(e,t),this.recordsetKey=((e,t)=>`${Ks(e,t)}/trans.recordset`)(e,t),this._store=s}get generation(){return this._metadata?this._metadata.generation:0}get requestCount(){return this._requests.length}_getReducedRecordset(e=[]){return t.__awaiter(this,void 0,void 0,(function*(){const t=(yield this._store.get(this.recordsetKey))||[];return t.push(...e),this._reduceRecordSet(t)}))}_reduceRecordSet(e){const t=[],s={};for(let i=e.length-1;i>=0;i--){const n=e[i],a=[];for(let e=n.requests.length-1;e>=0;e--){const t=n.requests[e],i=t.data;s[i.key]||(a.unshift(t),s[i.key]=!0)}a.length>0&&(n.requests=a,t.unshift(n))}return t}_applyRecord(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const t=ii.get(this.dbname),{generation:i,requests:n}=s;let a=null;try{const e=yield this._store.setMany(n.map((e=>Object.assign(Object.assign({},e.data),{generation:i}))));for(let s=0;s<n.length;s++)if(e[s]instanceof Error){a||(a=e[s]);const{data:i}=n[s];t.put(Object.assign(Object.assign({},i),{state:Zs.PERSISTENT}))}}catch(e){a=e}if(a)this._onError.forEach((e=>{a&&e(a)}));else{const t=e.filter((e=>e.generation!==i));yield this._store.set({key:this.recordsetKey,value:t}),this._onWrite.forEach((e=>{e(n.map((e=>e.data)))}))}}))}init(){return t.__awaiter(this,void 0,void 0,(function*(){this._metadata=(yield this._store.get(this.metadataKey))||{generation:1};const e=yield this._getReducedRecordset();for(const t of e)yield this._applyRecord(e,t)}))}on(e,t,s){switch(e){case Js.COMMIT:this._onCommit.set(t,s);break;case Js.WRITE:this._onWrite.set(t,s);break;case Js.ERROR:this._onError.set(t,s)}}requestWrite(e,t){this._requests.push({data:e,options:t});ii.get(this.dbname).put(Object.assign({state:Zs.PENDING},e))}requestMultipleWrite(e,t){const s=ii.get(this.dbname);for(const i of e)this._requests.push({data:i,options:t}),s.put(Object.assign({state:Zs.PENDING},i))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){ii.get(this.dbname).clearByCondition((e=>e.state===Zs.PENDING)),this._requests=[]}))}commit(){return t.__awaiter(this,void 0,void 0,(function*(){const e=this._requests;if(e.length>0){const t=[],s={};for(let i=e.length-1;i>=0;i--){const n=e[i],a=n.data;s[a.key]||(s[a.key]=!0,t.unshift(n))}const i={generation:this.generation,requests:t},n=yield this._getReducedRecordset([i]);yield this._store.set({key:this.recordsetKey,value:n}),this._metadata.generation++,yield this._store.set({key:this.metadataKey,value:this._metadata});const a=ii.get(this.dbname);for(let e=0;e<t.length;e++){const{data:s,options:i}=t[e];a.put(Object.assign(Object.assign({},s),{state:i&&i.persistent?Zs.PERSISTENT:Zs.VOLATILE}))}this._requests=[],this._onCommit.forEach((t=>{t(e.map((e=>e.data)))}));const r=ws.get(this.dbname);setTimeout((()=>{try{this._applyRecord(n,i)}catch(e){this._onError.forEach((t=>t(e)))}}),r.transactionApplyDelay)}}))}}class ai{constructor({blockId:e,keyName:t,items:s=[],limit:i}){this.blockId=e,this.keyName=t,this.limit=i,this._items=[...s]}static createFromCacheItem(e){return e?new ai(e.value):null}get isEmpty(){return 0===this._items.length}get items(){return this._items}serialize(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}}getItemByKey(e){const t=this._items.find((t=>{const s=t[this.keyName];return e===s}));return null!=t?t:null}has(e){return this._items.map((e=>e[this.keyName])).includes(e)}add(e){const t=this._items.map((e=>e[this.keyName])).indexOf(e[this.keyName]);return t<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[t]=e,!0)}remove(e){for(let t=0;t<this._items.length;t++)if(this._items[t][this.keyName]===e)return this._items.splice(t,1),!0;return!1}clear(){this._items=[]}}class ri{constructor({dbname:e,collectionName:t,metadata:s,hashFunction:i=ks,transaction:n,store:a}){this.dbname=e,this.collectionName=t,this.hashFunction=i,this.metadata=s,this._transaction=n,this._store=a}get keyName(){return this.metadata.keyName}createBlockId(e,t=this.metadata.blockLevel){return s=this.dbname,i=this.collectionName,n=t,a=`${((e,t,s)=>{const i=s.base*Math.pow(s.multiplier,t)+s.constant;return(s.hashFunction||ks)(e,i)})(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})}`,`${Ws(s,i)}${n}.${a}`;var s,i,n,a}_findBlock(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=ii.get(this.dbname);for(let s=this.metadata.blockLevel;s>0;s--){const i=this.createBlockId(e,s),n=yield t.find(this._store,i);if(n){const t=ai.createFromCacheItem(n);if(null==t?void 0:t.getItemByKey(e))return t}}return null}))}getFromBlock(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield this._findBlock(e);return t?t.getItemByKey(e):null}))}putToBlock(e,s){return t.__awaiter(this,void 0,void 0,(function*(){const t=ws.get(this.dbname),i=this.createBlockId(e),n=Math.floor(this._store.itemSizeLimit/t.itemSizeLimit),a=ii.get(this.dbname),r=yield a.find(this._store,i),o=r?ai.createFromCacheItem(r):new ai({blockId:i,keyName:this.keyName,items:[],limit:n});return!!(null==o?void 0:o.add(s))&&(this._transaction.requestWrite({key:o.blockId,value:o.serialize()}),!0)}))}removeFromBlock(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield this._findBlock(e);return!(!t||!t.remove(e))&&(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),!0)}))}clearAllBlocks(){return t.__awaiter(this,void 0,void 0,(function*(){const e=Ws(this.dbname,this.collectionName),t=(yield this._store.getAllKeys()).filter((t=>t.startsWith(e)));yield this._store.removeMany(t),yield this._transaction.clear();ii.get(this.dbname).clearByCondition((t=>t.key.startsWith(e)))}))}}const oi=e=>{const t=typeof e;return null===e||"undefined"===t||"boolean"===t||"number"===t||"string"===t};class li{constructor({dbname:e,collectionName:t,keyName:s,fields:i,transaction:n,store:a}){this._origin=[],this._table=[];const r=((e,t,s)=>`${Ks(e,t)}/index.${s}`)(e,t,i.join(">"));this.dbname=e,this.collectionName=t,this.keyName=s,this.fields=i,this.indexerKey=r,this._store=a,this._transaction=n,this._transaction.on(Js.COMMIT,this.indexerKey,(()=>this.commit())),this._transaction.on(Js.ERROR,this.indexerKey,(()=>this.abort()))}static createKey(e){return e.join(">")}static parseKey(e){return e.split(">")}_addItem(e){const t=e[this.keyName],s=this.getColumnValues(e),[i,n]=this.indexOf(s);return n?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:s,keys:[t]}),!0)}_removeItem(e){const t=e[this.keyName],s=this.getColumnValues(e),[i,n]=this.indexOf(s);if(n){const e=this._table[i].keys.indexOf(t);if(e>-1)return this._table[i].keys.splice(e,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return!1}get origin(){return this._origin}get table(){return this._table}getColumnValues(e){const t=[];for(let s of this.fields){if("-"===s[0]&&(s=s.slice(1)),!oi(e[s]))throw Us.indexTypesNotMatch;t.push(e[s])}return t}diff(e,t){for(const s in this.fields){const i="-"===this.fields[s][0]?-1:1,n=xs(e[s],t[s]);if(0!==n)return i*n}return 0}indexOf(e){if(this._table.length>0){let t=0,s=this._table.length-1;for(;t<=s;){const i=Math.floor((t+s)/2),n=this.diff(e,this._table[i].columnValues);if(n>0)t=i+1;else{if(!(n<0))return[i,!0];s=i-1}}return[t,!1]}return[0,!1]}ensure(){return t.__awaiter(this,void 0,void 0,(function*(){const e=ii.get(this.dbname),t=yield e.find(this._store,this.indexerKey,ei.PERSISTENT);if(t)this._origin=t.value,this._table=Rs(this._origin);else{const t=Ws(this.dbname,this.collectionName),s=yield this._store.getAllKeys();for(const i of s)if(i.startsWith(t)){const t=yield e.find(this._store,i,ei.NO_CACHE),s=ai.createFromCacheItem(t);if(s)for(const e of s.items)this._addItem(e)}this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0})}}))}drop(){return t.__awaiter(this,void 0,void 0,(function*(){ii.get(this.dbname).remove(this.indexerKey),yield this._store.remove(this.indexerKey)}))}addItem(e){return t.__awaiter(this,void 0,void 0,(function*(){this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0})}))}removeItem(e){return t.__awaiter(this,void 0,void 0,(function*(){this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0})}))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0})}))}commit(){this._origin=this._table,this._table=Rs(this._origin)}abort(){this._table=Rs(this._origin)}}const di=()=>"undefined"!=typeof document&&"undefined"!=typeof navigator&&"ReactNative"!==navigator.product,ui=()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:3&s|8).toString(16)}))};var ci,hi;!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(ci||(ci={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(hi||(hi={}));const pi={};class mi{constructor(e,t={}){return this._state=ci.PROCESSING,this._queue=[],this._activationQueue=[],pi[e]&&!t.forceCreate||(this.nodeId=ui(),this.key=e,di()&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&this.claimHost()})),window.addEventListener("message",(e=>{const t=e.data;if(!(null==t?void 0:t.isNestDbMessage))return;const{nodeId:s,requestId:i,key:n,op:a,data:r}=t;if(s!==this.nodeId&&n===this.key)switch(a){case hi.NEWNODE:this._sendSync();break;case hi.CLAIM_HOST:this._sendSync(),this._hostId=s;break;case hi.SYNC_HOST:if(!this.isInSync){this._activationTimeout&&clearTimeout(this._activationTimeout);const{currentItemRequestId:e,queue:t}=r;for(const e of t){this._queue.findIndex((t=>t.requestId===e.requestId))<0&&this._requestLock({isNestDbMessage:!0,nodeId:e.nodeId,requestId:e.requestId,key:this.key,op:hi.REQUEST_LOCK,ts:e.ts})}this._currentItem=this._queue.find((t=>t.requestId===e)),this._completeSync()}break;case hi.REMOVENODE:this._queue=this._queue.filter((e=>e.nodeId!==t.nodeId)),this._currentItem&&this._currentItem.nodeId===t.nodeId&&(this._currentItem=void 0,this._acquire(this._queue[0]));break;case hi.REQUEST_LOCK:this._requestLock(t);break;case hi.ACQUIRE_LOCK:{const e=this._queue.find((e=>e.requestId===i));this._acquire(e);break}case hi.RELEASE_LOCK:this._release(i)}})),window.addEventListener("beforeunload",(()=>{this._send(hi.REMOVENODE)}))),pi[e]=this),pi[e]}get locked(){return!!this._currentItem}get isHost(){return this._hostId===this.nodeId}get isInSync(){return this._state==ci.DONE}_send(e,t={}){var s;const i={isNestDbMessage:!0,nodeId:this.nodeId,requestId:null!==(s=null==t?void 0:t.requestId)&&void 0!==s?s:ui(),key:this.key,op:e,data:t.data,ts:Date.now()};return di()&&window.postMessage(i,"*"),i}_acquire(e){e?(this._currentItem=e,this._currentItem.onAcquired&&this._currentItem.onAcquired(e.requestId)):this._currentItem=void 0}_release(e){if(this._currentItem&&this._currentItem.requestId===e){const t=this._currentItem;this._currentItem=void 0,t.nodeId===this.nodeId&&this._send(hi.RELEASE_LOCK,{requestId:t.requestId});const s=this._queue.findIndex((t=>t.requestId===e));s>-1&&this._queue.splice(s,1),t.onReleased&&t.onReleased(e)}}_requestLock(e){return new Promise((t=>{const s={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:e=>{this.isHost&&this._send(hi.ACQUIRE_LOCK,{requestId:e}),t()},onReleased:()=>{this._acquire(this._queue[0])}};let i=!1;for(let e=0;e<this._queue.length;e++)if(this._queue[e].ts>s.ts){this._queue.splice(e,0,s),i=!0;break}i||this._queue.push(s),this._currentItem||this._acquire(this._queue[0])}))}_sendSync(){var e;this.isHost&&this._send(hi.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((e=>({nodeId:e.nodeId,requestId:e.requestId,ts:e.ts})))}})}_waitUntilSyncCompleted(){return t.__awaiter(this,void 0,void 0,(function*(){if(this.isHost&&!this.isInSync)return new Promise((e=>{this._activationQueue.push(e)}))}))}_waitSync(){this.isInSync||(this._activationTimeout=setTimeout((()=>{this._completeSync()}),8))}_completeSync(){this.isInSync||(this._state=ci.DONE,this._activationQueue.forEach((e=>e())),this._activationQueue=[])}registerNode(){this._send(hi.NEWNODE),this._waitSync()}claimHost(){this._hostId=this.nodeId,this._send(hi.CLAIM_HOST),this._waitSync()}lock(){return t.__awaiter(this,void 0,void 0,(function*(){yield this._waitUntilSyncCompleted();const e=this._send(hi.REQUEST_LOCK);yield this._requestLock(e)}))}unlock(){var e;(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)&&this._release(this._currentItem.requestId)}}class _i{constructor({dbname:e,collectionName:t,keyName:s,keyHash:i,indexes:n,store:a}){this._state=Ps.INIT,this._indexers=[],this.dbname=e,this.name=t,this.keyName=s,this.indexes=[[s],...n.filter((e=>li.createKey(e)!==this.keyName))],this._keyHash=i,this._store=a,this._mutex=new mi(((e,t)=>`${Ks(e,t)}.lock`)(e,t)),this._blobContainer=new Xs({dbname:e,collectionName:t,store:a}),this._transaction=new ni({dbname:e,collectionName:t,store:a})}static metadataOf(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){const t=Hs(e,s);return yield i.get(t)}))}get state(){return this._state}get isReady(){return this._state===Ps.READY}init(){return t.__awaiter(this,void 0,void 0,(function*(){yield this._mutex.lock();try{const e=ws.get(this.dbname),t=yield _i.metadataOf(this.dbname,this.name,this._store);this._metadata=t||{keyName:this.keyName,blockLevel:1,blockHashBase:e.blockHashBase,blockHashMultiplier:e.blockHashMultiplier,blockHashConstant:e.blockHashConstant,indexes:this.indexes},yield this._transaction.init(),this._blockManager=new ri({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store});const s=[...this.indexes],i=[],n=s.map((e=>li.createKey(e))),a=t?t.indexes.map((e=>li.createKey(e))):[];for(const e of a)n.includes(e)||i.push(li.parseKey(e));const r=[];if(r.push(...s.map((e=>{const t=new li({dbname:this.dbname,collectionName:this.name,keyName:this.keyName,fields:e,transaction:this._transaction,store:this._store});return this._indexers.push(t),t.ensure()}))),r.push(...i.map((e=>new li({dbname:this.dbname,collectionName:this.name,keyName:this.keyName,fields:e,transaction:this._transaction,store:this._store}).drop()))),yield Promise.all(r),yield this._transaction.commit(),n.sort().join(",")!==a.sort().join(",")){const e=Hs(this.dbname,this.name);this._metadata.indexes=s,yield this._store.set({key:e,value:this._metadata})}this._state=Ps.READY,this._mutex.unlock()}catch(e){throw this._mutex.unlock(),e}}))}close(){this._state=Ps.CLOSED}_hasPropertyOfKeyName(e){const t=e[this.keyName];return"string"==typeof t&&!!t}_getIndexerBy(e=null){e||(e=[this.keyName]);const t=li.createKey(e);for(const e of this._indexers)if(t===li.createKey(e.fields))return e;throw Us.indexTableIsRequired}_upgradeBlockLevel(){return t.__awaiter(this,void 0,void 0,(function*(){const e=Hs(this.dbname,this.name);this._metadata.blockLevel++,yield this._store.set({key:e,value:this._metadata})}))}_requestInsert(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=e[this.keyName];if(yield this._blockManager.getFromBlock(t))throw Us.collectionInsertDuplicate;(yield this._blockManager.putToBlock(t,e))||(yield this._upgradeBlockLevel(),yield this._blockManager.putToBlock(t,e));for(const t of this._indexers)yield t.addItem(e)}))}_requestUpsert(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=e[this.keyName],s=yield this._blockManager.getFromBlock(t);if(s){yield this._blockManager.putToBlock(t,e);for(const t of this._indexers)0!==t.diff(t.getColumnValues(s),t.getColumnValues(e))&&(yield t.removeItem(s),yield t.addItem(e))}else{(yield this._blockManager.putToBlock(t,e))||(yield this._upgradeBlockLevel(),yield this._blockManager.putToBlock(t,e));for(const t of this._indexers)yield t.addItem(e)}}))}_requestUpdate(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=e[this.keyName],s=yield this._blockManager.getFromBlock(t);if(s){yield this._blockManager.putToBlock(t,e);for(const t of this._indexers)0!==t.diff(t.getColumnValues(s),t.getColumnValues(e))&&(yield t.removeItem(s),yield t.addItem(e))}}))}_requestRemove(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield this._blockManager.getFromBlock(e);if(t){yield this._blockManager.removeFromBlock(e);for(const e of this._indexers)yield e.removeItem(t)}}))}_requestClear(){return t.__awaiter(this,void 0,void 0,(function*(){yield this._blockManager.clearAllBlocks();for(const e of this._indexers)yield e.clear()}))}getByKey(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{const t=yield this._blockManager.getFromBlock(e);return this._mutex.unlock(),Rs(t)}catch(e){throw this._mutex.unlock(),e}}))}query(e={}){if(this.isReady)return new Qs({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward});throw Us.collectionNotReady}insertOne(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{if(!this._hasPropertyOfKeyName(e))throw Us.collectionKeyNotGiven;return yield this._requestInsert(Rs(e)),yield this._transaction.commit(),this._mutex.unlock(),e}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}insertMany(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{if(e.some((e=>!this._hasPropertyOfKeyName(e))))throw Us.collectionKeyNotGiven;for(const t of e)yield this._requestInsert(Rs(t));return yield this._transaction.commit(),this._mutex.unlock(),e}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}upsertOne(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{if(!this._hasPropertyOfKeyName(e))throw Us.collectionKeyNotGiven;return yield this._requestUpsert(Rs(e)),yield this._transaction.commit(),this._mutex.unlock(),e}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}upsertMany(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{if(e.some((e=>!this._hasPropertyOfKeyName(e))))throw Us.collectionKeyNotGiven;for(const t of e)yield this._requestUpsert(Rs(t));return yield this._transaction.commit(),this._mutex.unlock(),e}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}update(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{if(!this._hasPropertyOfKeyName(e))throw Us.collectionKeyNotGiven;return yield this._requestUpdate(Rs(e)),yield this._transaction.commit(),this._mutex.unlock(),e}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}updateIf(e,s){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw this._transaction.clear(),Us.collectionNotReady;yield this._mutex.lock();try{const{where:i={},index:n=null,backward:a=!1}=e,r=[],o=new $s({condition:i,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(n)});yield o.each((e=>t.__awaiter(this,void 0,void 0,(function*(){if(e.error)throw e.stop(),e.error;if(e.hasNext){const t=e.nextValue;Ds(i,t)&&s.set&&("function"!=typeof s.set?Object.keys(s.set).forEach((e=>{var i;t[e]=null===(i=s.set)||void 0===i?void 0:i[e]})):s.set(t),r.push(t)),e.next()}else e.stop()}))));for(const e of r)yield this._requestUpdate(Rs(e));return yield this._transaction.commit(),this._mutex.unlock(),r}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}remove(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{yield this._requestRemove(e),yield this._transaction.commit(),this._mutex.unlock()}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}removeIf(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw this._transaction.clear(),Us.collectionNotReady;yield this._mutex.lock();try{const{where:s={},index:i=null,backward:n=!1}=e,a=[],r=new $s({condition:s,blockManager:this._blockManager,backward:n,indexer:this._getIndexerBy(i)});yield r.each((e=>t.__awaiter(this,void 0,void 0,(function*(){if(e.error)throw e.stop(),e.error;if(e.hasNext){const t=e.nextValue;if(Ds(s,t)){const e=t[this.keyName];a.push(e)}e.next()}else e.stop()}))));for(const e of a)yield this._requestRemove(e);return yield this._transaction.commit(),this._mutex.unlock(),a}catch(e){throw this._mutex.unlock(),e}}))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.isReady)throw Us.collectionNotReady;yield this._mutex.lock();try{yield this._requestClear(),yield this._transaction.commit(),this._mutex.unlock()}catch(e){throw yield this._transaction.clear(),this._mutex.unlock(),e}}))}getBlob(e){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._blobContainer.get(e)}))}saveBlob(e,s){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._blobContainer.save(e,s)}))}removeBlob(e){return t.__awaiter(this,void 0,void 0,(function*(){yield this._blobContainer.remove(e)}))}removeAllBlobs(){return t.__awaiter(this,void 0,void 0,(function*(){yield this._blobContainer.clear()}))}}const gi="[NESTDB]";let yi=!0;class fi{static off(){yi=!1}static log(...e){yi&&console.log(`${gi}[LOG]`,...e)}static warning(...e){yi&&console.warn(`${gi}[WARNING]`,...e)}static error(...e){yi&&console.error(`${gi}[ERROR]`,...e)}}const vi=[{},{a:700400,n:"error"}];class Ii{constructor(e){var s,i,n;this.encryption=null!==(s=e.encryption)&&void 0!==s?s:t.DEFAULT_ENCRYPTION,this.itemSizeLimit=null!==(i=e.itemSizeLimit)&&void 0!==i?i:4194304,this.metadataBuffer=null!==(n=e.metadataBuffer)&&void 0!==n?n:256}get _encryptionCheckKey(){return`${this.dbname}.encrypt`}get _reservedKeys(){return[this._encryptionCheckKey]}_getRawKey(e,t=""){return`${e}${t}`}_generateShardPostfixArray(e=1){return[...Array(e).keys()]}_shardify(e){const{key:t,value:s}=e,i=JSON.stringify(this.encryption.encrypt(s)),n=Math.ceil(i.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(n).map((e=>{const s={key:this._getRawKey(t,`.${e}`),data:i.substring(e*this.adjustedItemSizeLimit,(e+1)*this.adjustedItemSizeLimit)};return 0===e&&(s.metadata={shards:n}),s}))}_resetIfEncryptionChanged(){return t.__awaiter(this,void 0,void 0,(function*(){const e=yield this.get(this._encryptionCheckKey),t={encrypted:vi.map((e=>{var t;return null===(t=this.encryption)||void 0===t?void 0:t.encrypt(e)}))};if(e)if(e.encrypted&&Array.isArray(e.encrypted))for(const s in e.encrypted){if(JSON.stringify(e.encrypted[s])!==JSON.stringify(t.encrypted[s])){fi.warning("Encryption algorithm has changed. Stored data would be cleared."),yield this.clear();break}}else yield this.clear();yield this.set({key:this._encryptionCheckKey,value:t})}))}get adjustedItemSizeLimit(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)}usage(){return t.__awaiter(this,void 0,void 0,(function*(){let e=0;const t=yield this._getAllRawKeys();for(const s of t){const t=yield this._getRaw(s);t&&(e+=JSON.stringify(t).length)}return e}))}getAllKeys(){return t.__awaiter(this,void 0,void 0,(function*(){return(yield this._getAllRawKeys()).filter((e=>e.endsWith(".0"))).map((e=>e.replace(/\.0$/,""))).filter((e=>!this._reservedKeys.includes(e)))}))}get(e){return t.__awaiter(this,void 0,void 0,(function*(){const s=this._getRawKey(e,".0"),i=yield this._getRaw(s);if(i)try{const{data:s,metadata:n}=i,a=(null==n?void 0:n.shards)&&n.shards>1?yield Promise.all(this._generateShardPostfixArray(null==n?void 0:n.shards).map((i=>t.__awaiter(this,void 0,void 0,(function*(){if(i>0){const t=this._getRawKey(e,`.${i}`),s=yield this._getRaw(t);if(!s)throw Us.storeBrokenIntegrity;return s.data}return s}))))):[s];return this.encryption.decrypt(JSON.parse(a.join("")))}catch(e){return null}return null}))}set(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=this._shardify(e);return yield this._setRaw(t),Object.assign({},e.value)}))}setMany(e){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._setRaw([].concat(...e.map((e=>this._shardify(e))))),e.map((e=>e.value))}))}remove(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=this._getRawKey(e,".0"),s=yield this._getRaw(t);if(s){const{metadata:t}=s,i=this._generateShardPostfixArray(null==t?void 0:t.shards).map((t=>this._getRawKey(e,`.${t}`)));yield this._removeRaw(i);const n=ii.get(this.dbname);return null==n||n.remove(e),!0}return!1}))}removeMany(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=ii.get(this.dbname),s=[];for(const i of e){const e=this._getRawKey(i,".0"),n=yield this._getRaw(e);if(n){const{metadata:e}=n;s.push(...this._generateShardPostfixArray(null==e?void 0:e.shards).map((e=>this._getRawKey(i,`.${e}`))))}null==t||t.remove(i)}return s.length>0&&(yield this._removeRaw(s)),e}))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){const e=ii.get(this.dbname);null==e||e.clearForDatabase(this.dbname)}))}}const Ei=1,Ti={};class bi extends Ii{constructor(e={}){var t;super(Object.assign(Object.assign({},e),{itemSizeLimit:null!==(t=e.itemSizeLimit)&&void 0!==t?t:4194304}));const{delay:s=Ei}=e;this.delay=s,this.observer={}}get rawData(){return Ti[this.dbname]}set rawData(e){Ti[this.dbname]=e}_getAllRawKeys(){return t.__awaiter(this,void 0,void 0,(function*(){if(Ti[this.dbname])return Object.keys(Ti[this.dbname]);throw Us.storeNotAvailable}))}_getRaw(e){return t.__awaiter(this,void 0,void 0,(function*(){if(Ti[this.dbname])return yield Ls(this.delay),Ti[this.dbname][e]?Object.assign({key:e},Ti[this.dbname][e]):null;throw Us.storeNotAvailable}))}_setRaw(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!Ti[this.dbname])throw Us.storeNotAvailable;yield Ls(this.delay);for(const t of e){const{key:e,data:s,metadata:i}=t;Ti[this.dbname][e]=Object.freeze({data:s,metadata:i})}}))}_removeRaw(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!Ti[this.dbname])throw Us.storeNotAvailable;yield Ls(this.delay);for(const t of e)Ti[this.dbname][t]&&delete Ti[this.dbname][t]}))}observe(e,t,s){this.observer[e]||(this.observer[e]={}),t.forEach((t=>this.observer[e][t]=s))}checkAvailability(){return t.__awaiter(this,void 0,void 0,(function*(){}))}init(e){return t.__awaiter(this,void 0,void 0,(function*(){this.dbname=e,Ti[this.dbname]||(Ti[this.dbname]={}),yield this._resetIfEncryptionChanged()}))}set(e){const s=Object.create(null,{set:{get:()=>super.set}});return t.__awaiter(this,void 0,void 0,(function*(){const t=this.observer[e.key];if(t&&"function"==typeof t.set){const e=t.set();if(e)throw e}return s.set.call(this,e)}))}setMany(e){const s=Object.create(null,{setMany:{get:()=>super.setMany}});return t.__awaiter(this,void 0,void 0,(function*(){for(const t of e){const e=this.observer[t.key];if(e&&"function"==typeof e.set){const t=e.set();if(t)throw t}}return s.setMany.call(this,e)}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return t.__awaiter(this,void 0,void 0,(function*(){yield e.clear.call(this),yield Ls(this.delay),Ti[this.dbname]={}}))}}const Si="NestDBStore";var Mi;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.OPENING=1]="OPENING",e[e.OPEN=2]="OPEN",e[e.CLOSED=3]="CLOSED"}(Mi||(Mi={}));var Oi,Ai,Ci;exports.NestDBState=void 0,(Oi=exports.NestDBState||(exports.NestDBState={})).INIT="INIT",Oi.OPENING="OPENING",Oi.OPENED="OPENED",Oi.CLOSED="CLOSED";exports.LogLevel=void 0,(Ai=exports.LogLevel||(exports.LogLevel={}))[Ai.VERBOSE=0]="VERBOSE",Ai[Ai.DEBUG=1]="DEBUG",Ai[Ai.INFO=2]="INFO",Ai[Ai.WARN=3]="WARN",Ai[Ai.ERROR=4]="ERROR",Ai[Ai.NONE=5]="NONE";class wi{constructor(e){var s,i,n,a;this.messageTypeFilter=null!==(s=null==e?void 0:e.messageTypeFilter)&&void 0!==s?s:t.MessageTypeFilter.ALL,this.customTypesFilter=null!==(i=null==e?void 0:e.customTypesFilter)&&void 0!==i?i:null,this.senderUserIdsFilter=null!==(n=null==e?void 0:e.senderUserIdsFilter)&&void 0!==n?n:null,this.replyType=null!==(a=null==e?void 0:e.replyType)&&void 0!==a?a:t.ReplyType.NONE}clone(){const e=new wi,t=JSON.parse(JSON.stringify(this));return Object.keys(t).forEach((s=>{e[s]=t[s]})),e}match(e){switch(this.messageTypeFilter){case t.MessageTypeFilter.USER:if(e.messageType!==t.MessageType.USER)return!1;break;case t.MessageTypeFilter.FILE:if(e.messageType!==t.MessageType.FILE)return!1;break;case t.MessageTypeFilter.ADMIN:if(e.messageType!==t.MessageType.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof B))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}if(e instanceof F)switch(this.replyType){case t.ReplyType.NONE:if(e.parentMessageId>0)return!1;break;case t.ReplyType.ONLY_REPLY_TO_CHANNEL:if(e instanceof B&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0}}exports.MessageListOrder=void 0,(Ci=exports.MessageListOrder||(exports.MessageListOrder={})).CHANNEL_LATEST="channel_latest",Ci.NEWEST_CHILD_MESSAGE="newest_child_message";const Ni=e=>{switch(e){case exports.MessageListOrder.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case exports.MessageListOrder.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Pi=()=>["channelUrl","-createdAt","-notificationId"],Ui=Object.assign(Object.assign({},Ae),{scheduledAt:void 0}),Ri=Object.assign(Object.assign({},Se),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),xi="UnsentMessage",ki={};class Li extends t.InstancedObject{get _cacheContext(){return t.Vault.of(this._iid).cacheContext}constructor(e){super(e),this._mutex=new mi("unsendmessagecache.lock"),ki[e]=this}static of(e,t=!1){return ki[e]&&!t||(ki[e]=new Li(e)),ki[e]}get collection(){const{nestdb:e}=this._cacheContext,s=null==e?void 0:e.collection(xi);if(!s)throw t.SendbirdError.databaseError;return s}get localCacheEnabled(){const{localCacheEnabled:e}=this._cacheContext;return e&&!!this.collection}_serialize(e){if(e.messageId>0)throw t.SendbirdError.invalidParameters;const s=Object.assign({},e.serialize());var i;return e instanceof G?(e.messageParams&&(s.messageParams=Oe(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(s.scheduledInfo.scheduledMessageParams=(i=e.scheduledInfo.scheduledMessageParams,Object.assign(Object.assign({},Oe(i)),{scheduledAt:i.scheduledAt})))):e instanceof X?(e.messageParams&&(s.messageParams=xe(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(s.scheduledInfo.scheduledMessageParams=(e=>Object.assign(Object.assign({},xe(e)),{scheduledAt:e.scheduledAt}))(e.scheduledInfo.scheduledMessageParams))):e instanceof K&&e.messageParams&&(s.messageParams=(e=>t.deundefined({fileInfoList:e.fileInfoList,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}))(e.messageParams)),s}_deserialize(e){e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)});return Xi.of(this._iid).buildMessageFromSerializedData(e)}_deserializeWithMessageCreateParams(e){var s,i,n;return t.__awaiter(this,void 0,void 0,(function*(){const a=Xi.of(this._iid),r=this._deserialize(e);if(e.messageParams)if(r instanceof G){const t=e.messageParams;r.messageParams=a.buildUserMessageCreateParamsFromSerializedData(t,r)}else if(r instanceof X){const t=e.messageParams;t.fileKey&&"string"==typeof t.fileKey&&Re(null!==(s=t.fileType)&&void 0!==s?s:"")&&(t.file=null!==(i=yield this.collection.getBlob(t.fileKey))&&void 0!==i?i:void 0),r.messageParams=a.buildFileMessageCreateParamsFromSerializedData(t,r)}else if(r instanceof K){const s=e.messageParams;s&&s.fileInfoList&&(r.messageParams=a.buildMultipleFilesMessageCreateParamsFromSerializedData(s,r),yield Promise.all(r.messageParams.fileInfoList.map((e=>t.__awaiter(this,void 0,void 0,(function*(){var t,s,i,n;"string"==typeof(null===(t=e._uploadedMetaData)||void 0===t?void 0:t.fileKey)&&Re(null!==(i=null===(s=e._uploadedMetaData)||void 0===s?void 0:s.fileType)&&void 0!==i?i:"")&&(e.file=null!==(n=yield this.collection.getBlob(e._uploadedMetaData.fileKey))&&void 0!==n?n:void 0)}))))))}if(r.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams)if(r instanceof G){const t=e.scheduledInfo.scheduledMessageParams;r.scheduledInfo.scheduledMessageParams=a.buildScheduledUserMessageCreateParamsFromSerializedData(t,r)}else if(r instanceof X){const t=e.scheduledInfo.scheduledMessageParams;t.fileKey&&"string"==typeof t.fileKey&&"string"==typeof t.fileType&&Re(t.fileType)&&(t.file=null!==(n=yield this.collection.getBlob(t.fileKey))&&void 0!==n?n:void 0),r.scheduledInfo.scheduledMessageParams=a.buildScheduledFileMessageCreateParamsFromSerializedData(t,r)}return r}))}_getFileInfoBlobKey(e,t){return`${e}.${t}`}get(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=yield this.collection.getByKey(`${e}`);if(t)return this._deserializeWithMessageCreateParams(t)}}))}fetch({channelUrl:e,filter:s=new wi,order:i=exports.MessageListOrder.CHANNEL_LATEST,sendingStatus:n,backward:a=!1,parentMessageId:r}){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const o=Ni(i),l={"/where":e=>!!(i!==exports.MessageListOrder.NEWEST_CHILD_MESSAGE||r&&0!==e.parentMessageId&&e.parentMessageId===r)&&s.match(this._deserialize(e))};e&&(l.channelUrl=e),n&&(l.sendingStatus=n);const d={where:l,index:o,backward:a},u=yield this.collection.query(d),c=yield u.fetch({});return Promise.all(c.map((e=>t.__awaiter(this,void 0,void 0,(function*(){return yield this._deserializeWithMessageCreateParams(e)})))))}return[]}))}getAllChildMessages(e,s=new wi){return t.__awaiter(this,void 0,void 0,(function*(){return yield this.fetch({filter:s,order:exports.MessageListOrder.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})}))}upsert(e){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield Promise.all(e.map((e=>t.__awaiter(this,void 0,void 0,(function*(){(e instanceof X||e instanceof K)&&(yield this._mutex.lock(),yield this.saveBlob(e),yield this._mutex.unlock());const t=this._serialize(e);yield this.collection.upsertOne(t)}))))))}))}upsertChildMessages(e){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield Promise.all(e.map((e=>t.__awaiter(this,void 0,void 0,(function*(){let t=[];e.threadInfo&&e.threadInfo.replyCount>0&&(t=yield this.getAllChildMessages(e)),t.length>0&&(t.forEach((t=>t.applyParentMessage(e))),yield this.upsert(t))}))))))}))}remove(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled)for(const t of e)yield this.collection.remove(t)}))}removeMessagesOfChannel(e){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.removeIf({where:{channelUrl:e}}))}))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.clear())}))}saveBlob(e){return t.__awaiter(this,void 0,void 0,(function*(){if(e instanceof X){if(e.messageParams){const t=e.messageParams;if(t.file&&Ue(t.file)){const s=yield this.collection.saveBlob(t.file,e.reqId);t.fileKey=s,t.fileType=Pe.BLOB}}if(e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams){const t=e.scheduledInfo.scheduledMessageParams;if(t.file&&Ue(t.file)){const s=yield this.collection.saveBlob(t.file,e.reqId);t.fileKey=s,t.fileType=Pe.BLOB}}}else if(e instanceof K){const s=e.messageParams;s&&s.fileInfoList&&Array.isArray(s.fileInfoList)&&(yield Promise.all(s.fileInfoList.map(((s,i)=>t.__awaiter(this,void 0,void 0,(function*(){if(s.file&&Ue(s.file)){const t=yield this.collection.saveBlob(s.file,this._getFileInfoBlobKey(e.reqId,i));s._uploadedMetaData||(s._uploadedMetaData={}),s._uploadedMetaData.fileKey=t,s._uploadedMetaData.fileType=Pe.BLOB}}))))))}}))}}const Di={};class qi extends t.InstancedObject{get _sdkState(){return t.Vault.of(this._iid).sdkState}get _cacheContext(){return t.Vault.of(this._iid).cacheContext}get _unsentMessageCache(){return Li.of(this._iid)}constructor(e){super(e),Di[e]=this}static of(e,t=!1){return Di[e]&&!t||(Di[e]=new qi(e)),Di[e]}get collection(){const{nestdb:e}=this._cacheContext;return t.unless(!!e).throw(t.SendbirdError.databaseError),e.collection(ms)}get localCacheEnabled(){const{localCacheEnabled:e}=this._cacheContext;return e&&!!this.collection}_serialize(e){return Object.assign(Object.assign({},e.serialize()),{messageId:`${e.messageId}`})}_deserialize(e){e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)});return Xi.of(this._iid).buildMessageFromSerializedData(e)}get(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=yield this.collection.getByKey(`${e}`);if(t)return this._deserialize(t)}}))}fetch({channelUrl:e,token:s,limit:i=100,filter:n=new wi,order:a=exports.MessageListOrder.CHANNEL_LATEST,backward:r=!1,parentMessageId:o,isPollOnly:l=!1,exactMatch:d=!1,inclusive:u=!0}){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const c=Ni(a),h={where:{channelUrl:e,"/where":e=>{if(null!=s&&""!==s)switch(a){case exports.MessageListOrder.CHANNEL_LATEST:if(d&&e.createdAt!==s)return!1;if(r){if(u&&e.createdAt<s||!u&&e.createdAt<=s)return!1}else if(u&&e.createdAt>s||!u&&e.createdAt>=s)return!1;break;case exports.MessageListOrder.NEWEST_CHILD_MESSAGE:if(!o||0===e.parentMessageId||e.parentMessageId!==o)return!1}return!(l&&!e._poll)&&n.match(this._deserialize(e))}},index:c,backward:r},p=yield this.collection.query(h),m=yield p.fetch({limit:null!=i?i:void 0});return Promise.all(m.map((e=>t.__awaiter(this,void 0,void 0,(function*(){return this._deserialize(e)})))))}return[]}))}getAllChildMessages(e,s=new wi){return t.__awaiter(this,void 0,void 0,(function*(){return yield this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:s,order:exports.MessageListOrder.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})}))}upsert(e){var s;return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){yield this.saveBlobs(e);for(const t of e)if(null===(s=t.threadInfo)||void 0===s?void 0:s._isUpdateRequired){const e=yield this.get(t.messageId);(null==e?void 0:e.threadInfo)&&t.threadInfo._updateFrom(e.threadInfo)}const t=e.map((e=>this._serialize(e)));yield this.collection.upsertMany(t),yield this.upsertChildMessages(e),yield this._unsentMessageCache.upsertChildMessages(e)}}))}upsertChildMessages(e){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield Promise.all(e.map((e=>t.__awaiter(this,void 0,void 0,(function*(){var t;let s=[];(null===(t=e.threadInfo)||void 0===t?void 0:t.replyCount)&&e.threadInfo.replyCount>0&&(s=yield this.getAllChildMessages(e)),s.length>0&&(s.forEach((t=>t.applyParentMessage(e))),yield this.upsert(s))}))))))}))}remove(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled)for(const t of e)yield this.collection.remove(`${t}`)}))}removeMessagesOfChannel(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){yield this.collection.removeIf({where:{channelUrl:e},index:Ni(exports.MessageListOrder.CHANNEL_LATEST)});const{preference:t}=this._cacheContext;yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/sync`),yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/sync.meta`),yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/changelogs`),yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/changelogs.meta`)}}))}removeUnderOffset(e,s,i=!1){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.removeIf({where:{channelUrl:e,createdAt:i?{"<=":s}:{"<":s}},index:Ni(exports.MessageListOrder.CHANNEL_LATEST)}))}))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.clear())}))}countBetween(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=Ni(exports.MessageListOrder.CHANNEL_LATEST),n=this.collection.query({where:{channelUrl:e,"/where":e=>{const t=this._deserialize(e);return i.includes(t.createdAt)&&s.match(t)}},index:t});return yield n.count()}return 0}))}saveBlobs(e){return t.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(e.map((e=>t.__awaiter(this,void 0,void 0,(function*(){if(e instanceof X&&e.messageParams){const t=e.messageParams;if(t.file&&Ue(t.file)){const s=yield this.collection.saveBlob(t.file,e.reqId);t.fileKey=s}}})))))}))}_getGroupChannelPreferenceSize(e){return t.__awaiter(this,void 0,void 0,(function*(){let t=0;const{preference:s}=this._cacheContext,i=yield s.get(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/sync`),n=yield s.get(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/sync.meta`),a=yield s.get(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/changelogs`),r=yield s.get(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/changelogs.meta`);return i&&(t+=JSON.stringify(i).length),n&&(t+=JSON.stringify(n).length),a&&(t+=JSON.stringify(a).length),r&&(t+=JSON.stringify(r).length),t}))}}const Fi={};class Bi extends t.InstancedObject{get _sdkState(){return t.Vault.of(this._iid).sdkState}get _cacheContext(){return t.Vault.of(this._iid).cacheContext}constructor(e){super(e),Fi[e]=this}static of(e,t=!1){return Fi[e]&&!t||(Fi[e]=new Bi(e)),Fi[e]}get collection(){const{nestdb:e}=this._cacheContext;return t.unless(!!e).throw(t.SendbirdError.databaseError),e.collection(_s)}get localCacheEnabled(){const{localCacheEnabled:e}=this._cacheContext;return e&&!!this.collection}_serialize(e){return Object.assign({},e.serialize())}_deserialize(e){return Xi.of(this._iid).buildMessageFromSerializedData(e)}get(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=yield this.collection.getByKey(e);if(t)return this._deserialize(t)}}))}fetch({channelUrl:e,token:s,limit:i=100,filter:n=new wi,backward:a=!1,exactMatch:r=!1,inclusive:o=!0}){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t={where:{channelUrl:e,"/where":e=>{if(s){if(r&&e.createdAt!==s)return!1;if(a){if(o&&e.createdAt<s||!o&&e.createdAt<=s)return!1}else if(o&&e.createdAt>s||!o&&e.createdAt>=s)return!1}return n.match(this._deserialize(e))}},index:["channelUrl","-createdAt","-notificationId"],backward:a},l=yield this.collection.query(t);return(yield l.fetch({limit:null!=i?i:void 0})).map((e=>this._deserialize(e)))}return[]}))}upsert(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=e.map((e=>this._serialize(e)));yield this.collection.upsertMany(t)}}))}remove(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled)for(const t of e)yield this.collection.remove(t)}))}markAsReadByTimestamp(e,s){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.updateIf({where:{channelUrl:e,messageStatus:exports.NotificationMessageStatus.SENT,createdAt:{"<":s}}},{set:{messageStatus:exports.NotificationMessageStatus.READ}}))}))}markAsReadByMessageIds(e,s){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){return(yield this.collection.updateIf({where:{channelUrl:e,notificationId:{"/in":s},messageStatus:exports.NotificationMessageStatus.SENT}},{set:{messageStatus:exports.NotificationMessageStatus.READ}})).length}return 0}))}removeMessagesOfChannel(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){yield this.collection.removeIf({where:{channelUrl:e},index:["channelUrl","-createdAt","-notificationId"]});const{preference:t}=this._cacheContext;yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/sync`),yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/sync.meta`),yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/changelogs`),yield t.remove(`sendbird:${this._sdkState.userId}@groupchannel/${e}/message/changelogs.meta`)}}))}removeUnderOffset(e,s){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":s}},index:Ni(exports.MessageListOrder.CHANNEL_LATEST)}))}))}clear(){return t.__awaiter(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.clear())}))}countBetween(e,s,i){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=["channelUrl","-createdAt","-notificationId"],n=this.collection.query({where:{channelUrl:e,"/where":e=>{const t=this._deserialize(e);return i.includes(t.createdAt)&&s.match(t)}},index:t});return yield n.count()}return 0}))}}const ji={};class Vi extends t.InstancedObject{get _cacheContext(){return t.Vault.of(this._iid).cacheContext}get _dispatcher(){return t.Vault.of(this._iid).dispatcher}get _messageCache(){return qi.of(this._iid)}get _unsentMessageCache(){return Li.of(this._iid)}get _notificationCache(){return Bi.of(this._iid)}constructor(e){super(e),this._observers=new Map,this._dispatcherContext=this._dispatcher.on((e=>t.__awaiter(this,void 0,void 0,(function*(){if(e instanceof t.MessageUpdateEventCommand){const{messages:s,source:i,isWebSocketEventComing:n}=e,a=s.filter((e=>e instanceof F&&e.channelType!==t.ChannelType.OPEN&&e.messageId>0)),r=s.filter((e=>e instanceof F&&e.channelType!==t.ChannelType.OPEN&&0===e.messageId)),o=s.filter((e=>e instanceof W));a.length>0&&(yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){yield this._messageCache.upsert(a),yield this._unsentMessageCache.remove(a.map((e=>e instanceof B?e.reqId:null)).filter((e=>null!==e)))})))),n||this._broadcastUpdateEvent(a,i)),r.length>0&&(yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){yield this._unsentMessageCache.upsert(r)})))),n||this._broadcastUpdateEvent(r,i)),o.length>0&&(yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){yield this._notificationCache.upsert(o)})))),n||this._broadcastUpdateEvent(o,i))}else if(e instanceof t.MessageRemoveEventCommand){const{messageIds:s,source:i,isWebSocketEventComing:n}=e,a=s.filter((e=>"number"==typeof e)),r=s.filter((e=>"string"==typeof e));yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){a.length>0&&(yield this._messageCache.remove(a)),r.length>0&&(yield this._notificationCache.remove(r))})))),n||this._broadcastRemoveEvent(s,i)}else if(e instanceof t.UnsentMessageRemoveEventCommand){const{reqId:s,source:i}=e;yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){yield this._unsentMessageCache.remove([s])})))),this._broadcastRemoveUnsentEvent(s,i)}else if(e instanceof t.PollChangeLogEventCommand){const{polls:s,source:i}=e;if(this._cacheContext.localCacheEnabled){const e=s.map((e=>e.messageId)),i=(yield Promise.all(e.map((e=>this._messageCache.get(e))))).filter((e=>e));i.length>0&&s.forEach((e=>{const t=i.find((t=>t.messageId===e.messageId));t&&t.applyPoll(e)})),yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){return yield this._messageCache.upsert(i)}))))}this._broadcastPollChangeLogEvent(s,i)}else if(e instanceof t.PollUpdateInternalEventCommand){const{event:s,source:i}=e,n=yield this._messageCache.get(s.messageId);n&&n.isUserMessage()&&n.poll&&n.poll.applyPollUpdateEvent(s)&&(yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){return yield this._messageCache.upsert([n])}))))),this._broadcastPollUpdateEvent(s,i)}else if(e instanceof t.PollVoteInternalEventCommand){const{event:s,source:i}=e,n=yield this._messageCache.get(s.messageId);n&&n.isUserMessage()&&n.poll&&n.poll.applyPollVoteEvent(s)&&(yield t.runOrNothing((()=>t.__awaiter(this,void 0,void 0,(function*(){return yield this._messageCache.upsert([n])}))))),this._broadcastPollVoteEvent(s,i)}else if(e instanceof t.ReactionUpdateEventCommand){const{event:t,source:s}=e;t.messageId>0&&this._broadcastReactionUpdateEvent(t,s)}else if(e instanceof t.ThreadUpdateEventCommand){const{event:t,source:s}=e;this._broadcastThreadUpdateEvent(t,s)}else if(e instanceof t.MessageRetentionEventCommand){const{messageDeletionTimestamp:t,channelUrl:s,source:i}=e;this._broadcastMessageRetentionEvent(t,s,i)}}))))}static of(e,t=!1){var s;return ji[e]&&!t||(ji[e]&&(null===(s=ji[e]._dispatcherContext)||void 0===s||s.close()),ji[e]=new Vi(e)),ji[e]}_broadcastUpdateEvent(e,t){for(const s of this._observers.values())s.onUpdate&&s.onUpdate(e,t)}_broadcastPollChangeLogEvent(e,t){for(const s of this._observers.values())s.onPollChangeLogUpdate&&s.onPollChangeLogUpdate(e,t)}_broadcastPollUpdateEvent(e,t){for(const s of this._observers.values())s.onPollUpdate&&s.onPollUpdate(e,t)}_broadcastPollVoteEvent(e,t){for(const s of this._observers.values())s.onPollVote&&s.onPollVote(e,t)}_broadcastRemoveEvent(e,t){for(const s of this._observers.values())s.onRemove&&s.onRemove(e,t)}_broadcastRemoveUnsentEvent(e,t){for(const s of this._observers.values())s.onRemoveUnsent&&s.onRemoveUnsent(e,t)}_broadcastReactionUpdateEvent(e,t){for(const s of this._observers.values())s.onReactionUpdate&&s.onReactionUpdate(e,t)}_broadcastThreadUpdateEvent(e,t){for(const s of this._observers.values())s.onThreadInfoUpdate&&s.onThreadInfoUpdate(e,t)}_broadcastMessageRetentionEvent(e,t,s){for(const i of this._observers.values())i.onDeletedByRetentionPolicy&&i.onDeletedByRetentionPolicy(e,t,s)}subscribe(e,t){this._observers.set(e,t)}unsubscribe(e){this._observers.delete(e)}unsubscribeAll(){this._observers.clear()}}const zi={};class $i extends t.InstancedObject{constructor(e,{sdkState:t,cacheContext:s}){super(e),this._users=new Map,this._sdkState=t,this._cacheContext=s,zi[e]=this}static of(e){return zi[e]}get collection(){const{nestdb:e}=this._cacheContext;return t.unless(!!e).throw(t.SendbirdError.databaseError),e.collection(gs)}get localCacheEnabled(){const{localCacheEnabled:e}=this._cacheContext;return e&&!!this.collection}get users(){return[...this._users.values()]}_serialize(e,t){return Object.assign(Object.assign({},e.serialize()),{updatedAt:t})}_deserialize(e){return t.User._buildUserFromSerializedData(e)}isCachedInMemory(e){return this._users.has(e)}getUserInfoFromCache(e){if(this._users.has(e))return this._users.get(e)}get(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this._users.has(e))return this._users.get(e);if(this.localCacheEnabled){const t=yield this.collection.getByKey(e);if(t){const e=this._deserialize(t);return this._users.set(e.userId,e),e}}}))}fetch({limit:e=100,backward:s=!1}){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.localCacheEnabled)return[];try{const t={index:["-userId","-updatedAt"],backward:s},i=yield this.collection.query(t),n=(yield i.fetch({limit:e})).map((e=>this._deserialize(e)));return n.forEach((e=>{this._users.has(e.userId)||this._users.set(e.userId,e)})),n}catch(e){return[]}}))}upsert(e,s){return t.__awaiter(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const i=this._serialize(e,s),n=this._users.get(e.userId);if(n){if(n._hashValue===e._hashValue)return;if(n._updatedAt>s)return}this._users.set(e.userId,t.User._buildUserFromSerializedData(i)),yield this.collection.upsertOne(i)}}))}remove(e){return t.__awaiter(this,void 0,void 0,(function*(){this._users.has(e)&&this._users.delete(e),this.localCacheEnabled&&(yield this.collection.remove(e))}))}clearMemoryCache(){this._users.clear()}clear(){return t.__awaiter(this,void 0,void 0,(function*(){this.clearMemoryCache(),this.localCacheEnabled&&(yield this.collection.clear())}))}}const Qi=20;class Gi extends t.APIRequestCommand{constructor(e){const{reverse:s=!1,limit:i=Qi,keys:n,token:a}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.API_PATH_MESSAGE_TEMPLATE}`,this.params=t.deundefined({token:a,limit:i,reverse:s,order:t.MessageTemplateListOrder.UPDATED_AT,show_ui_template:!0,show_color_variables:!0,keys:n})}}class Ki extends t.APIResponseCommand{constructor(e,t){super(e,t);const{next:s,has_more:i=!1,templates:n}=t;this.nextToken=s,this.hasMore=i,this.templates=n.map((e=>({template:JSON.stringify(e)})))}}class Hi extends t.APIRequestCommand{constructor(e){const{key:s}=e;super(),this.method=t.APIRequestMethod.GET,this.path=`${t.API_PATH_MESSAGE_TEMPLATE}/${s}`}}class Wi extends t.APIResponseCommand{constructor(e,t){super(e,t),this.template=JSON.stringify(t)}}const Yi={};class Xi{constructor(e,{sdkState:t,dispatcher:s,requestQueue:i,onlineDetector:n,cacheContext:a}){this._iid=e,this._sdkState=t,this._requestQueue=i,this._dispatcher=s,this._cacheContext=a,qi.of(e),Li.of(e),Vi.of(e),this.fileMessageQueue=new ae(e,{sdkState:t,dispatcher:s,requestQueue:i,onlineDetector:n,cacheContext:a}),Yi[e]=this}static of(e){return Yi[e]}_setSenderInfo(e){if(this._cacheContext.localCacheEnabled&&(e.messageType===t.MessageType.USER||e.messageType===t.MessageType.FILE)){const s=e.sender;if(s){const i=$i.of(this._iid).getUserInfoFromCache(s.user_id);i&&(e.sender=t.User.payloadify(i))}}}buildMessageFromSerializedData(e){const s=t.deserialize(e);if(s.notificationId)return new W(this._iid,W.payloadify(s));switch(this._setSenderInfo(s),s.messageType){case t.MessageType.USER:return new G(this._iid,G.payloadify(s));case t.MessageType.FILE:return K._isMultipleFilesMessageSerializedData(s)?new K(this._iid,K.payloadify(s)):new X(this._iid,X.payloadify(s));case t.MessageType.ADMIN:return new z(this._iid,z.payloadify(s))}throw t.SendbirdError.invalidParameters}buildUserMessageCreateParamsFromSerializedData(e,s){return t.deundefined(t.undefineNullProps({data:s.data,customType:s.customType,mentionType:s.mentionType,mentionedUserIds:s.mentionedUserIds,mentionedUsers:s.mentionedUsers,mentionedMessageTemplate:s.mentionedMessageTemplate,metaArrays:s.metaArrays,parentMessageId:s.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:s.appleCriticalAlertOptions,reqId:s.reqId,message:s.message,translationTargetLanguages:Object.keys(s.translations),pollId:e.pollId}))}buildFileMessageCreateParamsFromSerializedData(e,s){var i;return t.deundefined(t.undefineNullProps({data:s.data,customType:s.customType,mentionType:s.mentionType,mentionedUserIds:s.mentionedUserIds,mentionedUsers:s.mentionedUsers,metaArrays:s.metaArrays,parentMessageId:s.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:s.appleCriticalAlertOptions,reqId:s.reqId,file:e.file,fileKey:e.fileKey,fileUrl:s.plainUrl,fileName:s.name,fileSize:s.size,mimeType:s.type,thumbnailSizes:null===(i=s.thumbnails)||void 0===i?void 0:i.map((e=>({maxWidth:e.width,maxHeight:e.height}))),fileType:e.fileType,requireAuth:s.requireAuth}))}buildMultipleFilesMessageCreateParamsFromSerializedData(e,s){return t.deundefined({data:s.data,customType:s.customType,mentionType:s.mentionType,mentionedUserIds:s.mentionedUserIds,mentionedUsers:s.mentionedUsers,metaArrays:s.metaArrays,parentMessageId:s.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:s.appleCriticalAlertOptions,reqId:s.reqId,fileInfoList:e.fileInfoList.map((e=>new J(this._iid,e)))})}buildScheduledUserMessageCreateParamsFromSerializedData(e,t){return Object.assign(Object.assign({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}buildScheduledFileMessageCreateParamsFromSerializedData(e,t){return Object.assign(Object.assign({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}buildSenderFromSerializedData(e){const s=t.deserialize(e);return new m(this._iid,m.payloadify(s))}getMessage(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=new pe(e),s=yield this._requestQueue.send(t),{message:i}=s.as(me);return i}))}getScheduledMessage(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=new ve(e),s=yield this._requestQueue.send(t),{message:i}=s.as(Ie);return i}))}getMessagesByMessageId(e,s,i,n,a=t.CollectionEventSource.REQUEST_MESSAGE){return t.__awaiter(this,void 0,void 0,(function*(){const r=new _e(Object.assign(Object.assign(Object.assign({channelType:s,channelUrl:e,token:String(i)},re),n),{sdkSource:exports.SDKSource.EXTERNAL_LEGACY})),o=yield this._requestQueue.send(r),{messages:l}=o.as(ge);return this._dispatcher.dispatch(new t.MessageUpdateEventCommand({messages:l,source:a})),l}))}getMessagesByTimestamp(e,s,i,n,a=t.CollectionEventSource.REQUEST_MESSAGE){return t.__awaiter(this,void 0,void 0,(function*(){const r=new _e(Object.assign(Object.assign(Object.assign({channelType:s,channelUrl:e,timestamp:i},re),n),{sdkSource:exports.SDKSource.EXTERNAL_LEGACY})),o=yield this._requestQueue.send(r),{messages:l}=o.as(ge);return this._dispatcher.dispatch(new t.MessageUpdateEventCommand({messages:l,source:a})),l}))}_getMessagesByTimestampForCollection(e,s,i,n,a=t.CollectionEventSource.REQUEST_MESSAGE,r,o,l){return t.__awaiter(this,void 0,void 0,(function*(){const d=new _e(Object.assign(Object.assign(Object.assign({channelType:s,channelUrl:e,timestamp:i},re),n),{checkingHasNext:r,checkingContinuousMessages:o,sdkSource:l})),u=yield this._requestQueue.send(d),{messages:c,isContinuousMessages:h,hasNext:p}=u.as(ge);return this._dispatcher.dispatch(new t.MessageUpdateEventCommand({messages:c,source:a})),{messages:c,isContinuousMessages:h,hasNext:p}}))}getThreadedMessagesByTimestamp(e,s,i,n=t.CollectionEventSource.REQUEST_THREADED_MESSAGE){return t.__awaiter(this,void 0,void 0,(function*(){const a=new _e(Object.assign(Object.assign(Object.assign({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:s},j),i),{replyType:t.ReplyType.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),r=yield this._requestQueue.send(a),{messages:o}=r.as(ge),l=o.slice(1);return l.forEach((t=>{t.parentMessage=e})),this._dispatcher.dispatch(new t.MessageUpdateEventCommand({messages:l,source:n})),{parentMessage:o[0],threadedMessages:l}}))}getMessageTemplatesByToken(e,s={}){return t.__awaiter(this,void 0,void 0,(function*(){const t=new Gi(Object.assign({token:e},s)),i=yield this._requestQueue.send(t),{hasMore:n,nextToken:a,templates:r}=i.as(Ki);return{hasMore:n,token:a,templates:r}}))}getMessageTemplate(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=new Hi({key:e}),s=yield this._requestQueue.send(t),{template:i}=s.as(Wi);return{template:i}}))}getMessageChangelogs(e,s,i,n,a=t.CollectionEventSource.REQUEST_MESSAGE_CHANGELOGS){return t.__awaiter(this,void 0,void 0,(function*(){const r=new ye(t.deundefined(t.undefineNullProps(Object.assign(Object.assign({channelType:s,channelUrl:e,timestamp:"number"==typeof i?i:null,token:"string"==typeof i?i:null},le),n)))),o=yield this._requestQueue.send(r),{updatedMessages:l,deletedMessagesInfo:d,hasMore:u,nextToken:c,forceUseNextToken:h}=o.as(fe),p=d.map((e=>e.messageId));return l.length>0&&this._dispatcher.dispatch(new t.MessageUpdateEventCommand({messages:l,source:a})),p.length>0&&this._dispatcher.dispatch(new t.MessageRemoveEventCommand({messageIds:p,source:a})),{updatedMessages:l,deletedMessageIds:p,hasMore:u,token:c,forceUseNextToken:h}}))}}class Ji extends t.InstancedObject{constructor(e,s){super(e),this.targetMessageId=0;const i=s.thread_info,n=s.parent_message_id,r=s.channel_url,o=s.channel_type;i&&t.isTypeOf("object",i)&&t.isTypeOf("number",n)&&t.isTypeOf("string",r)&&t.isTypeOf("string",o)&&(this.threadInfo=new a(e,i),this.targetMessageId=n,this.channelUrl=r,this.channelType=o)}}const Zi={channelUrl:"",channelType:t.ChannelType.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1};class en extends t.APIRequestCommand{constructor({channelCustomType:e,keyword:s,limit:i,reverse:n,exactMatch:a,channelUrl:r,order:o,messageTimestampFrom:l,messageTimestampTo:d,advancedQuery:u,targetFields:c,nextToken:h}){super(),this.method=t.APIRequestMethod.GET,this.path=`${t.API_PATH_SEARCH}/messages`,this.params=t.deundefined({custom_type:e,query:s,limit:i,reverse:n,exact_match:a,channel_url:r,message_ts_from:l,message_ts_to:d,sort_field:o,advanced_query:u,target_fields:c,after:h})}}class tn extends t.APIResponseCommand{constructor(e,t){super(e,t),this.messages=t.results.map((t=>Y(e,t))),this.hasNext=t.has_next,this.nextToken=t.end_cursor,this.totalCount=t.total_count}}var sn;exports.MessageSearchOrder=void 0,(sn=exports.MessageSearchOrder||(exports.MessageSearchOrder={})).SCORE="score",sn.TIMESTAMP="ts";class nn extends t.BaseListQuery{constructor(e,t){var s,i,n,a,r,o,l,d,u;super(e,t),this.keyword="",this.reverse=!1,this.exactMatch=!1,this.channelUrl=null,this.channelCustomType=null,this.messageTimestampFrom=null,this.messageTimestampTo=null,this.order=exports.MessageSearchOrder.SCORE,this.advancedQuery=!1,this.targetFields=null,this._nextToken="",this.totalCount=-1,this.keyword=t.keyword,this.reverse=null!==(s=t.reverse)&&void 0!==s&&s,this.exactMatch=null!==(i=t.exactMatch)&&void 0!==i&&i,this.channelUrl=null!==(n=t.channelUrl)&&void 0!==n?n:null,this.channelCustomType=null!==(a=t.channelCustomType)&&void 0!==a?a:null,this.messageTimestampFrom=null!==(r=t.messageTimestampFrom)&&void 0!==r?r:null,this.messageTimestampTo=null!==(o=t.messageTimestampTo)&&void 0!==o?o:null,this.order=null!==(l=t.order)&&void 0!==l?l:exports.MessageSearchOrder.SCORE,this.advancedQuery=null!==(d=t.advancedQuery)&&void 0!==d&&d,this.targetFields=null!==(u=t.targetFields)&&void 0!==u?u:null}_validate(){return super._validate()&&t.isTypeOf("string",this.keyword)&&this.keyword.length>0&&t.isTypeOf("boolean",this.reverse)&&t.isTypeOf("boolean",this.exactMatch)&&t.isTypeOf("string",this.channelUrl,!0)&&t.isTypeOf("string",this.channelCustomType,!0)&&t.isTypeOf("number",this.messageTimestampFrom,!0)&&t.isTypeOf("number",this.messageTimestampTo,!0)&&t.isEnumOf(exports.MessageSearchOrder,this.order)&&t.isTypeOf("boolean",this.advancedQuery)&&t.isArrayOf("string",this.targetFields,!0)}next(){return t.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw t.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=t.Vault.of(this._iid),s=new en(t.undefineNullProps(Object.assign(Object.assign({},this),{nextToken:this._nextToken?this._nextToken:null}))),i=yield e.send(s),{messages:n,hasNext:a,nextToken:r,totalCount:o}=i.as(tn);return this._nextToken=r,this._hasNext=a,this._isLoading=!1,this.totalCount=o,n}return[]}throw t.SendbirdError.invalidParameters}))}}exports.AdminMessage=z,exports.AppleCriticalAlertOptions=c,exports.BanUserEventCommand=Nt,exports.BannedUserListQuery=Ze,exports.BaseChannel=As,exports.BaseMessage=F,exports.BaseMessageUpdateParamsDefault=Fe,exports.BaseStore=Ii,exports.Config=ws,exports.CreateScheduledUserMessageResponseCommand=Zt,exports.DEFAULT_FEED_LIMIT=100,exports.DEFAULT_GROUPCHANNEL_LIMIT=100,exports.DEFAULT_MESSAGE_LIMIT=100,exports.DEFAULT_NOTIFICATION_LIMIT=100,exports.Feedback=p,exports.FileMessage=X,exports.FileMessageEventCommand=te,exports.FreezeEventCommand=xt,exports.IndexedDbStore=class extends Ii{constructor(e={}){var t;super(Object.assign(Object.assign({},e),{itemSizeLimit:null!==(t=e.itemSizeLimit)&&void 0!==t?t:104857600})),this._storeName=Si,this._state=Mi.UNINITIALIZED,this._openJobQueue=[],this._window="undefined"!=typeof window?window:void 0,this._indexedDb=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:void 0}get state(){return this._state}isTransactionInactiveError(e){return e instanceof Error&&e.message.includes("The transaction is inactive")}_putToObjectStore(e,s){return t.__awaiter(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const n=e.put(s);n.addEventListener("success",(e=>{t(e.target.result)})),n.addEventListener("error",(()=>{i("Failed to write.")}))}))}))}_deleteFromObjectStore(e,s){return t.__awaiter(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const n=e.delete(s);n.addEventListener("success",(()=>t(s))),n.addEventListener("error",(e=>i(e.target.error)))}))}))}_openDatabase(e){return new Promise(((t,s)=>{if(this._indexedDb){this._state=Mi.OPENING;const i=this._indexedDb.open(e);i.addEventListener("upgradeneeded",(e=>{e.target.result.createObjectStore(Si,{keyPath:"key"})})),i.addEventListener("success",(s=>{this._state=Mi.OPEN,this._database=s.target.result,this._openJobQueue.forEach((e=>e())),this._openJobQueue=[],this._database.onclose=()=>{this._database=void 0,this._state=Mi.OPENING,setTimeout((()=>{this._openDatabase(e)}),5)},t(this._database)})),i.addEventListener("error",(e=>{this._state=Mi.UNINITIALIZED,s(e.target.error)}))}else s(Us.storeNotAvailable)}))}_getObjectStore(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this._database)return this._database.transaction(this._storeName,e).objectStore(this._storeName);switch(this._state){case Mi.UNINITIALIZED:case Mi.OPEN:throw Us.storeNotInitialized;case Mi.OPENING:case Mi.CLOSED:return new Promise((t=>{this._openJobQueue.push((()=>t(this._getObjectStore(e))))}));default:return yield this._getObjectStore(e)}}))}_getAllRawKeys(){return t.__awaiter(this,void 0,void 0,(function*(){const e=yield this._getObjectStore("readonly");return yield new Promise(((t,s)=>{const i=e.getAllKeys();i.addEventListener("success",(e=>{t(e.target.result)})),i.addEventListener("error",(e=>s(e.target.error)))}))}))}_getRaw(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield this._getObjectStore("readonly");return yield new Promise(((s,i)=>{const n=t.get(e);n.addEventListener("success",(e=>{var t;s(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)})),n.addEventListener("error",(e=>i(e.target.error)))}))}))}_setRaw(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield this._getObjectStore("readwrite");try{yield Promise.all(e.map((e=>this._putToObjectStore(t,e))))}catch(s){if(!this.isTransactionInactiveError(s))throw s;for(const s of e)yield this._putToObjectStore(t,s)}}))}_removeRaw(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield this._getObjectStore("readwrite");try{yield Promise.all(e.map((e=>this._deleteFromObjectStore(t,e))))}catch(s){if(!this.isTransactionInactiveError(s))throw s;for(const s of e)yield this._deleteFromObjectStore(t,s)}}))}_triggerDatabaseClose(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))}checkAvailability(){return t.__awaiter(this,void 0,void 0,(function*(){const e="undefined"!=typeof window?window:null;if(!((null==e?void 0:e.indexedDB)||(null==e?void 0:e.mozIndexedDB)||(null==e?void 0:e.webkitIndexedDB)||(null==e?void 0:e.msIndexedDB)))throw Us.storeNotAvailable;if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!di())throw Us.storeNotAvailable;if(di()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")){if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw Us.storeNotAvailableInPrivateBrowsing}else yield new Promise(((e,t)=>{if(this._indexedDb)try{const s=this._indexedDb.open("_testMozilla");s.onerror=()=>t(Us.storeNotAvailableInPrivateBrowsing),s.onsuccess=s=>{if(s.target.result.close(),this._indexedDb){const t=this._indexedDb.deleteDatabase("_testMozilla");t.onerror=()=>e(),t.onsuccess=()=>e()}else t(Us.storeNotAvailable)}}catch(e){t(Us.storeNotAvailableInPrivateBrowsing)}else t(Us.storeNotAvailable)}))}))}init(e){return t.__awaiter(this,void 0,void 0,(function*(){this.dbname=e,yield this.checkAvailability(),yield this._openDatabase(e),yield this._resetIfEncryptionChanged()}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return t.__awaiter(this,void 0,void 0,(function*(){yield e.clear.call(this);const t=yield this._getObjectStore("readwrite");return yield new Promise(((e,s)=>{const i=t.clear();i.addEventListener("success",(()=>e())),i.addEventListener("error",(e=>s(e.target.error)))}))}))}},exports.Logger=class{constructor(){this.level=exports.LogLevel.WARN}verbose(...e){this.level<=exports.LogLevel.VERBOSE&&console.log("[verbose]",...e)}debug(...e){this.level<=exports.LogLevel.DEBUG&&console.log("[debug]",...e)}info(...e){this.level<=exports.LogLevel.INFO&&console.log("[info]",...e)}warn(...e){this.level<=exports.LogLevel.WARN&&console.warn("[warn]",...e)}error(...e){this.level<=exports.LogLevel.ERROR&&console.error("[error]",...e)}},exports.MemoryStore=bi,exports.MessageBroadcast=Vi,exports.MessageCache=qi,exports.MessageFilter=wi,exports.MessageForm=L,exports.MessageFormItem=D,exports.MessageManager=Xi,exports.MessageMetaArray=_,exports.MessageRequestHandler=be,exports.MessageRetrievalParamsDefault=Zi,exports.MessageReviewInfo=Q,exports.MessageSearchQuery=nn,exports.MessageThreadInfoUpdatedEventCommand=P,exports.MultipleFilesMessage=K,exports.MultipleFilesMessageRequestHandler=vs,exports.MuteUserEventCommand=Ot,exports.MutedUserListQuery=Ye,exports.NESTDB_FEEDCHANNEL_COLLECTION_KEY="url",exports.NESTDB_FEEDCHANNEL_COLLECTION_NAME="FeedChannel",exports.NESTDB_GROUPCHANNEL_COLLECTION_KEY="url",exports.NESTDB_GROUPCHANNEL_COLLECTION_NAME="GroupChannel",exports.NESTDB_MESSAGE_COLLECTION_KEY="messageId",exports.NESTDB_MESSAGE_COLLECTION_NAME=ms,exports.NESTDB_NOTIFICATION_COLLECTION_KEY="notificationId",exports.NESTDB_NOTIFICATION_COLLECTION_NAME=_s,exports.NESTDB_POLL_COLLECTION_KEY="pollId",exports.NESTDB_POLL_COLLECTION_NAME="Poll",exports.NESTDB_UNSENT_MESSAGE_COLLECTION_KEY="reqId",exports.NESTDB_UNSENT_MESSAGE_COLLECTION_NAME=xi,exports.NESTDB_USER_INFO_COLLECTION_KEY="userId",exports.NESTDB_USER_INFO_COLLECTION_NAME=gs,exports.NestDB=class{constructor({name:e,version:t,store:s,config:i}){this.name=e,this._version=t,this._state=exports.NestDBState.INIT,this._config=i||new ws({dbname:e}),this._store=s,this._event={success:qs,error:qs,storeReplaced:qs,upgrade:js},this._collections=new Map,this._globalMutex=new mi(`${this.name}.lock`),this._config.disableLogger&&fi.off(),new ii({dbname:e,limit:this._config.cacheLimit})}get version(){return this._version}get state(){return this._state}get store(){return this._store}_initializeCollection(e,s){var i;return t.__awaiter(this,void 0,void 0,(function*(){let t;const n=this._collections.get(e);if(s)t=new _i({dbname:this.name,collectionName:e,keyName:s.keyName,indexes:null!==(i=s.index)&&void 0!==i?i:[[s.keyName]],store:this._store});else if(!n||n.state!==Ps.READY){const s=yield _i.metadataOf(this.name,e,this._store);s&&(t=new _i({dbname:this.name,collectionName:e,keyName:s.keyName,indexes:s.indexes,store:this._store}))}t&&(this._collections.set(e,t),yield t.init())}))}estimateUsage(){return t.__awaiter(this,void 0,void 0,(function*(){return yield(e=this._store,t.__awaiter(void 0,void 0,void 0,(function*(){return yield e.usage()})));var e}))}commitSchema(e){return t.__awaiter(this,void 0,void 0,(function*(){if(this._state!==exports.NestDBState.OPENING)throw Us.databaseSchemaNotOnUpgrade;yield Promise.all(e.map((e=>t.__awaiter(this,void 0,void 0,(function*(){yield this._initializeCollection(e.collectionName,e)})))))}))}open(){var e;return t.__awaiter(this,void 0,void 0,(function*(){if(yield this._globalMutex.lock(),this._state!==exports.NestDBState.OPENED){this._state=exports.NestDBState.OPENING;try{yield this._store.init(this.name);const i=(s=this.name,`${Gs(s)}.metadata`),n={version:0,collectionNames:[]},a=null!==(e=yield this._store.get(i))&&void 0!==e?e:n;for(const e of a.collectionNames)yield this._initializeCollection(e);return new Promise(((e,s)=>{const n=e=>{a.version<this._version?this._event.upgrade(a.version,(s=>t.__awaiter(this,void 0,void 0,(function*(){if(s)e({continued:!1,err:s});else{a.version++,a.collectionNames=Array.from(this._collections.keys());try{yield this._store.set({key:i,value:a}),e({continued:!0})}catch(t){e({continued:!1,err:t})}}})))):e({continued:!1})},r=t=>{const{continued:i=!1,err:o=null}=t;i?setTimeout((()=>n(r)),10):o?(fi.error(o.message),this._globalMutex.unlock(),this._event.error(o),s(o)):Promise.all(a.collectionNames.map((e=>this._initializeCollection(e)))).then((()=>{this._state=exports.NestDBState.OPENED,this._globalMutex.unlock(),this._event.success(),e()})).catch((e=>{fi.error(e.message),this._globalMutex.unlock(),this._event.error(e),s(e)}))};n(r)}))}catch(e){switch(e.code){case Ns.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:fi.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new bi({}),this._globalMutex.unlock(),this._event.error(e),this._event.storeReplaced(this._store),yield this.open();break;case Ns.STORE_NOT_AVAILABLE:fi.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new bi({}),this._globalMutex.unlock(),this._event.error(e),this._event.storeReplaced(this._store),yield this.open();break;default:throw fi.error(e.message),this._globalMutex.unlock(),this._event.error(e),e}}}var s}))}close(){this._collections.forEach((e=>e.close())),this._state=exports.NestDBState.CLOSED}clear(){return t.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(Array.from(this._collections.values()).map((e=>e.clear())))}))}reset(){return t.__awaiter(this,void 0,void 0,(function*(){const e=ii.get(this.name);e&&e.clearForDatabase(this.name),yield this._store.clear()}))}on(e,t){this._event[e]=t}off(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=js;else this._event[e]=qs}collection(e){const t=this._collections.get(e);if(t)return t;throw Us.collectionNotReady}},exports.NestDBError=Us,exports.NotificationMessage=W,exports.NotificationMessageCache=Bi,exports.OGImage=d,exports.OGMetaData=u,exports.OperatorListQuery=Ge,exports.PENDING_MESSAGE_DELAY=2,exports.PinnedMessage=Is,exports.PinnedMessageListQuery=bs,exports.Plugin=$,exports.PollVoteEventCommand=ps,exports.PreviousMessageListQuery=Ke,exports.ReactedUserInfo=o,exports.Reaction=l,exports.ReactionEvent=r,exports.ReadAPIRequestCommand=I,exports.ReadAPIResponseCommand=T,exports.ReadEventCommand=E,exports.ReadRequestCommand=v,exports.ReadStatus=f,exports.RestrictedUser=Te,exports.RestrictionInfo=Ee,exports.ScheduledFileMessageCreateParamsDefault=Ri,exports.ScheduledUserMessageCreateParamsDefault=Ui,exports.SendableMessage=B,exports.Sender=m,exports.ThreadInfo=a,exports.ThreadInfoUpdateEvent=Ji,exports.Thumbnail=s,exports.UnbanUserEventCommand=Ut,exports.UnmuteUserEventCommand=Ct,exports.UnsentMessageCache=Li,exports.UpdateFileMessageEventCommand=Qt,exports.UpdateMetaCounterEventCommand=Tt,exports.UpdateMetaDataEventCommand=ct,exports.UpdateUserMessageEventCommand=zt,exports.UploadFileRequestCommand=i,exports.UploadFileResponseCommand=n,exports.UploadedFileInfo=N,exports.UserInfoCache=$i,exports.UserMessage=G,exports.UserMessageEventCommand=jt,exports.UserMessageUpdateParamsDefault=je,exports.createFileMessageCreateParams=Le,exports.createFileMessageCreateParamsFromFailedFileMessage=De,exports.createMultipleFilesMessageCreateParams=function(e){var s,i,n;return null!==(s=e.messageParams)&&void 0!==s?s:t.undefineNullProps(Object.assign(Object.assign({},e),{isReplyToChannel:!1,mentionedUserIds:null!==(i=e.mentionedUserIds)&&void 0!==i?i:null===(n=e.mentionedUsers)||void 0===n?void 0:n.map((e=>e.userId)),pushNotificationDeliveryOption:t.PushNotificationDeliveryOption.DEFAULT,isPinnedMessage:!1,fileInfoList:e.fileInfoList.map((e=>{var t;return{fileUrl:e.plainUrl,fileName:e.fileName,fileSize:e.fileSize,mimeType:e.mimeType,thumbnailSizes:null===(t=e.thumbnails)||void 0===t?void 0:t.map((e=>({maxWidth:e.width,maxHeight:e.height}))),_thumbnails:e.thumbnails,_uploadedMetaData:{requireAuth:e._requireAuth,isUploaded:!0}}}))}))},exports.createUserMessageCreateParams=Ce,exports.createUserMessageCreateParamsFromFailedUserMessage=we,exports.getMessageIndexBy=Ni,exports.getNotificationMessageIndexBy=Pi,exports.parseMessagePayload=Y,exports.payloadifyMessage=e=>{if(e.notificationId)return W.payloadify(e);switch(e.messageType){case t.MessageType.USER:return G.payloadify(e);case t.MessageType.FILE:return e.fileInfoList?K.payloadify(e):X.payloadify(e);case t.MessageType.ADMIN:return z.payloadify(e);default:throw t.SendbirdError.unknown}},exports.validateBaseMessageUpdateParams=Be,exports.validateMessageRetrievalParams=e=>t.isTypeOf("string",e.channelUrl)&&t.isEnumOf(t.ChannelType,e.channelType)&&t.isTypeOf("number",e.messageId)&&t.isTypeOf("boolean",e.includeReactions,!0)&&t.isTypeOf("boolean",e.includeMetaArray,!0)&&t.isTypeOf("boolean",e.includeParentMessageInfo,!0)&&t.isTypeOf("boolean",e.includeThreadInfo,!0),exports.validateScheduledFileMessageCreateParams=e=>Me(e)&&t.isTypeOf("number",e.scheduledAt)&&(t.isFile(e.file)||t.isTypeOf("string",e.fileUrl))&&t.isTypeOf("string",e.fileName,!0)&&t.isTypeOf("string",e.mimeType,!0)&&t.isTypeOf("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((e=>t.isTypeOf("object",e)&&e.maxWidth>0&&e.maxHeight>0))),exports.validateScheduledUserMessageCreateParams=e=>Ne(e)&&t.isTypeOf("number",e.scheduledAt,!0),exports.validateUserMessageUpdateParams=Ve;
