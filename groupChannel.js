import{_ as e,h as t,af as n,e as a,l as o,C as u,U as l,I as c,aH as h,Z as d,Y as f,j as p,k as _,z as m,T as v,i as g,q as y,s as E,aI as C,B as N,aJ as b,aK as T,aL as S,m as U,aM as A,aN as I,L as w,w as L,A as D,N as R,b as P,c as O,aO as k,aP as F,aQ as x,aR as H,an as V,W as q,aS as K,aT as B,X as j,S as Q,a5 as z,V as W,x as Y,F as J,ax as X,a6 as Z,M as $,aU as ee,u as te,aV as ne,aW as re,ab as se,aw as ie,E as ae,H as oe,J as ue,y as le,R as ce,g as he,aX as de,D as fe,aY as pe,aZ as _e,n as me,ah as ve,ar as ge,as as ye,ai as Ee,ak as Ce,f as Ne,a as be,P as Me,a_ as Te,ay as Se,a$ as Ue,b0 as Ae,r as Ie,o as we}from"./__bundle-355c0e46.js";export{M as MessageEventSource,aI as ScheduledStatus}from"./__bundle-355c0e46.js";import{N as Le,G as De,g as Re,D as Pe,a as Oe,P as ke,b as Fe,U as xe,M as He,A as Ve,c as Ge,d as qe,e as Ke,f as Be,h as je,i as Qe,j as ze,S as We,v as Ye,k as Je,l as Xe,m as Ze,n as $e,o as et,p as tt,q as nt,r as rt,s as st}from"./__bundle-d597243b.js";export{G as GroupChannelListOrder,i as MessageFilter,r as PublicGroupChannelListOrder,s as ScheduledMessageListOrder}from"./__bundle-d597243b.js";import{f as it,j as at,k as ot,l as ut,m as lt,n as ct,o as ht,p as dt,D as ft,q as pt,r as _t,t as mt,u as vt,w as gt,x as yt,y as Et,e as Ct,C as Nt,P as bt}from"./__bundle-c491791b.js";import{C as Mt,a as Tt,O as St,M as Ut,T as At,R as It,U as wt,A as Lt,B as Dt}from"./__bundle-71216a79.js";var Rt;!function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited",e.LEFT="left"}(Rt||(Rt={}));var Pt,Ot,kt,Ft,xt,Ht,Vt,Gt,qt=function(r){function s(e,s){var i=r.call(this,e,s)||this;return i.state=null,i.role=null,i.isMuted=!1,i.isBlockedByMe=!1,i.isBlockingMe=!1,i.state=t(Rt,s.state)?s.state:null,i.role=t(n,s.role)?s.role:null,s.hasOwnProperty("is_muted")&&(i.isMuted=s.is_muted),s.hasOwnProperty("is_blocked_by_me")&&(i.isBlockedByMe=s.is_blocked_by_me),s.hasOwnProperty("is_blocking_me")&&(i.isBlockingMe=s.is_blocking_me),i}return e(s,r),s.payloadify=function(e){return e?a(o(o({},r.payloadify.call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})):null},s}(it),Kt=function(t){function n(e,n){var r,s,i=this;return(i=t.call(this,e)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",i.channelType=null!==(s=n.channel_type)&&void 0!==s?s:u.GROUP,i.reader=new l(i._iid,n.user),i.readAt=n.ts,i}return e(n,t),n}(c);!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(Pt||(Pt={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(Ot||(Ot={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only",e.EXCLUSIVE_ONLY="exclusive_only"}(kt||(kt={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(Ft||(Ft={})),function(e){e.ALL="all",e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(xt||(xt={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(Ht||(Ht={})),function(e){e.AND="AND",e.OR="OR"}(Vt||(Vt={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}(Gt||(Gt={}));var Bt,jt=function(){function e(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=Ot.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=kt.ALL,this.publicChannelFilter=Pt.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=Ft.ALL,this.hiddenChannelFilter=xt.UNHIDDEN,this.includeFrozen=!0}return e.prototype._isFriend=function(e){return!!e.friendDiscoveryKey||!!e.friendName},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=Vt.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t=new e;this.searchFilter&&t.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&t.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,r=n.query,s=n.fields;if(r&&s&&s.length>0&&!s.some((function(t){switch(t){case Gt.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case Gt.MEMBER_NICKNAME:return e.members.some((function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var i=this._userIdsFilter,a=i.userIds,o=i.includeMode,u=i.queryType,l=e.members.map((function(e){return e.userId}));if(o){if(a.length>0)switch(u){case Vt.AND:if(a.some((function(e){return!l.includes(e)})))return!1;break;case Vt.OR:if(a.every((function(e){return!l.includes(e)})))return!1}}else{if(a.includes(t)||a.push(t),e.members.length>a.length)return!1;if(!h(a,l))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var c=this.nicknameContainsFilter.toLowerCase();if(e.members.every((function(e){return!e.nickname.toLowerCase().includes(c)})))return!1}if(this.nicknameStartsWithFilter){var d=this.nicknameStartsWithFilter.toLowerCase();if(e.members.every((function(e){return!e.nickname.toLowerCase().startsWith(d)})))return!1}if(this.nicknameExactMatchFilter){var f=this.nicknameExactMatchFilter.toLowerCase();if(e.members.every((function(e){return e.nickname.toLowerCase()!=f})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case Ot.JOINED:if("joined"!==e.myMemberState)return!1;break;case Ot.INVITED:if("invited"!==e.myMemberState)return!1;break;case Ot.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case Ot.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case xt.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case xt.HIDDEN:if(!e.isHidden)return!1;break;case xt.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case xt.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===Ft.UNREAD_MESSAGE)if(0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case Pt.PUBLIC:if(!e.isPublic)return!1;break;case Pt.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case kt.SUPER:if(!e.isSuper)return!1;break;case kt.NON_SUPER:if(e.isSuper)return!1}return!0},e}(),Qt=function(t){function n(e,n){var r=n.sdkState,s=n.cacheContext,i=t.call(this,e)||this;return i._channels=new Map,i._sdkState=r,i._cacheContext=s,i}return e(n,t),Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection(Le):null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e,t){return void 0===t&&(t=0),o(o({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},n.prototype._deserialize=function(e){return sr.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(n.prototype,"channels",{get:function(){return d([],f(this._channels.values()),!1)},enumerable:!1,configurable:!0}),n.prototype.isCachedInMemory=function(e){return this._channels.has(e)},n.prototype.filterOffsetChanged=function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))},n.prototype.get=function(e){return p(this,void 0,void 0,(function(){var t,n;return _(this,(function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,null];case 3:return[2,this._channels.get(e)]}}))}))},n.prototype.fetch=function(e){var t=e.token,n=e.limit,r=void 0===n?Pe:n,s=e.backward,i=void 0!==s&&s,a=e.filter,o=void 0===a?new jt:a,u=e.order,l=void 0===u?De.LATEST_LAST_MESSAGE:u;return p(this,void 0,void 0,(function(){var e,n,s,a,u=this;return _(this,(function(c){switch(c.label){case 0:return this.localCacheEnabled?(e=Re(l),n={where:function(e){if(t)switch(l){case De.CHANNEL_NAME_ALPHABETICAL:if(!i&&e.name.localeCompare(t)<0||i&&e.name.localeCompare(t)>0)return!1;break;case De.CHRONOLOGICAL:if(!i&&e.createdAt>t||i&&e.createdAt<t)return!1;break;case De.LATEST_LAST_MESSAGE:if(!i&&e.lastMessageUpdatedAt>t||i&&e.lastMessageUpdatedAt<t)return!1}return o.match(u._deserialize(e),u._sdkState.userId)},index:e,backward:i},[4,this.collection.query(n)]):[3,3];case 1:return[4,c.sent().fetch({limit:r})];case 2:return s=c.sent(),(a=s.map((function(e){return u._deserialize(e)}))).forEach((function(e){u._channels.has(e.url)||u._channels.set(e.url,e)})),[2,a];case 3:return[2,[]]}}))}))},n.prototype.upsert=function(e){return p(this,void 0,void 0,(function(){var t,n,r=this;return _(this,(function(s){switch(s.label){case 0:if(e.forEach((function(e){if(r._channels.has(e.url)){var t=r._channels.get(e.url);Object.assign(t,e,{_iid:r._iid})}else r._channels.set(e.url,e)})),!this.localCacheEnabled)return[3,2];for(n in t=[],e)t.push(this._serialize(e[n],parseInt(n)));return[4,this.collection.upsertMany(t)];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},n.prototype.remove=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,i,a;return _(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),t=m(e),n=t.next(),o.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return s=o.sent(),i={error:s},[3,7];case 6:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}}))}))},n.prototype.clear=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.clearMemoryCache=function(){this._channels.clear()},n.prototype._setBlockStateOfAllChannels=function(e,t,n){return p(this,void 0,void 0,(function(){var r,s,i,a,o,u,l,c,h,d,f,p,v,g,y,E,C,N,b;return _(this,(function(_){switch(_.label){case 0:if(r=[],e===this._sdkState.userId)try{for(s=m(this._channels.values()),i=s.next();!i.done;i=s.next()){c=i.value;try{for(g=void 0,a=m(c.members),o=a.next();!o.done;o=a.next())if((f=o.value).userId===t){f.isBlockedByMe=n,r.push(c);break}}catch(e){g={error:e}}finally{try{o&&!o.done&&(y=a.return)&&y.call(a)}finally{if(g)throw g.error}}}}catch(e){p={error:e}}finally{try{i&&!i.done&&(v=s.return)&&v.call(s)}finally{if(p)throw p.error}}else if(t===this._sdkState.userId)try{for(u=m(this._channels.values()),l=u.next();!l.done;l=u.next()){c=l.value;try{for(N=void 0,h=m(c.members),d=h.next();!d.done;d=h.next())if((f=d.value).userId===e){f.isBlockingMe=n,r.push(c);break}}catch(e){N={error:e}}finally{try{d&&!d.done&&(b=h.return)&&b.call(h)}finally{if(N)throw N.error}}}}catch(e){E={error:e}}finally{try{l&&!l.done&&(C=u.return)&&C.call(u)}finally{if(E)throw E.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:_.sent(),_.label=2;case 2:return[2]}}))}))},n.prototype.block=function(e,t){return p(this,void 0,void 0,(function(){return _(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},n.prototype.unblock=function(e,t){return p(this,void 0,void 0,(function(){return _(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},n.prototype.markAsRead=function(e,t){return void 0===t&&(t=d([],f(this._channels.keys()),!1)),p(this,void 0,void 0,(function(){var n,r,s,i,a,o,u,l;return _(this,(function(c){switch(c.label){case 0:n=[],c.label=1;case 1:c.trys.push([1,6,7,8]),r=m(t),s=r.next(),c.label=2;case 2:return s.done?[3,5]:(i=s.value,[4,this.get(i)]);case 3:(a=c.sent())._updateUnreadMemberState(this._sdkState.userId,e)&&(a._updateUnreadCount(0,0),n.push(a)),c.label=4;case 4:return s=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),u={error:o},[3,8];case 7:try{s&&!s.done&&(l=r.return)&&l.call(r)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:c.sent(),c.label=10;case 10:return[2]}}))}))},n}(c),zt={invitedUserIds:null,channelUrl:null,coverUrl:null,coverImage:null,isDistinct:null,isSuper:null,isBroadcast:null,isExclusive:null,isPublic:null,isDiscoverable:null,isStrict:null,isEphemeral:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},Wt=function(e){return v("string",e.invitedUserIds,!0)&&g("string",e.channelUrl,!0)&&g("string",e.coverUrl,!0)&&(y(e.coverImage)||g("string",e.coverImage)||null===e.coverImage)&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isSuper,!0)&&g("boolean",e.isBroadcast,!0)&&g("boolean",e.isExclusive,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isStrict,!0)&&g("boolean",e.isDiscoverable,!0)&&g("boolean",e.isEphemeral,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&v("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)},Yt={customTypes:null,includeEmpty:!1,includeFrozen:!0},Jt=function(e){return v("string",e.customTypes,!0)&&g("boolean",e.includeEmpty)&&g("boolean",e.includeFrozen)},Xt={myMemberStateFilter:Ot.ALL},Zt=function(e){return t(Ot,e.myMemberStateFilter)};!function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}(Bt||(Bt={}));var $t,en={keys:[]},tn={channelCustomTypesFilter:null,superChannelFilter:kt.ALL},nn={channelUrl:null,scheduledStatus:null,messageTypeFilter:E.ALL};!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",e.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",e.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",e.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",e.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",e.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",e.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",e.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",e.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",e.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",e.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",e.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",e.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",e.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",e.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",e.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",e.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",e.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",e.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.REQUEST_CHANNEL="REQUEST_CHANNEL",e.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",e.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",e.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS"}($t||($t={}));var rn=function(e){return e.startsWith("EVENT_")||e===$t.SYNC_CHANNEL_BACKGROUND||e===$t.SYNC_CHANNEL_CHANGELOGS},sn=function(t){function n(e){var n=e.channels,r=e.source,s=t.call(this)||this;return s.channels=n,s.source=r,s}return e(n,t),n}(N),an=function(t){function n(e){var n=e.channelUrls,r=e.source,s=t.call(this)||this;return s.channelUrls=n,s.source=r,s}return e(n,t),n}(N),on=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,r=e.unsentMessageCache,s=e.dispatcher,i=this;this._observers=new Map,s.on((function(e){return p(i,void 0,void 0,(function(){var s,i,a,o,u,l,c,h,d,f,v=this;return _(this,(function(g){switch(g.label){case 0:if(!(e instanceof sn))return[3,2];s=e.channels,h=e.source,i=s.filter((function(e){return e instanceof ys})),a=t.filterOffsetChanged(i);try{for(o=m(a),u=o.next();!u.done;u=o.next())l=u.value,n.removeUnderOffset(l.url,l.messageOffsetTimestamp)}catch(e){d={error:e}}finally{try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}}return[4,t.upsert(i)];case 1:return g.sent(),this._broadcastUpdateEvent(i,h),[3,7];case 2:return e instanceof an?(c=e.channelUrls,h=e.source,[4,t.remove(c)]):[3,5];case 3:return g.sent(),[4,b((function(){return p(v,void 0,void 0,(function(){var e,t,s,i,a,o;return _(this,(function(u){switch(u.label){case 0:u.trys.push([0,6,7,8]),e=m(c),t=e.next(),u.label=1;case 1:return t.done?[3,5]:(s=t.value,[4,n.removeMessagesOfChannel(s)]);case 2:return u.sent(),[4,r.removeMessagesOfChannel(s)];case 3:u.sent(),u.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return i=u.sent(),a={error:i},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))}))];case 4:return g.sent(),this._broadcastRemoveEvent(c,h),[3,7];case 5:return e instanceof Oe?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,7];case 6:g.sent(),g.label=7;case 7:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),un=function(){function e(e){var t=e.cacheContext,n=e.messageCache,r=e.unsentMessageCache,s=e.dispatcher,i=e.logger,a=this;this._cacheContext=null,this._observers=new Map,this._logger=null,this._cacheContext=t,this._logger=i,s.on((function(e){return p(a,void 0,void 0,(function(){var t,s,i,a,o,u,l,c,h,d,f,m,v,g=this;return _(this,(function(y){switch(y.label){case 0:return e instanceof w?(t=e.messages,m=e.source,s=t.filter((function(e){return e.messageId>0})),i=t.filter((function(e){return 0===e.messageId})),s.length>0?[4,b((function(){return p(g,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,n.upsert(s)];case 1:return e.sent(),[4,r.remove(s.map((function(e){return e instanceof L?e.reqId:null})).filter((function(e){return null!==e})))];case 2:return e.sent(),[2]}}))}))}))]:[3,2]):[3,5];case 1:y.sent(),this._broadcastUpdateEvent(s,m),y.label=2;case 2:return i.length>0?[4,b((function(){return p(g,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,r.upsert(i)];case 1:return e.sent(),[2]}}))}))}))]:[3,4];case 3:y.sent(),this._broadcastUpdateEvent(i,m),y.label=4;case 4:return[3,21];case 5:return e instanceof I?(a=e.messageIds,m=e.source,[4,b((function(){return p(g,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,n.remove(a)];case 1:return e.sent(),[2]}}))}))}))]):[3,7];case 6:return y.sent(),this._broadcastRemoveEvent(a,m),[3,21];case 7:return e instanceof A?(o=e.reqId,m=e.source,[4,b((function(){return p(g,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,r.remove([o])];case 1:return e.sent(),[2]}}))}))}))]):[3,9];case 8:return y.sent(),this._broadcastRemoveUnsentEvent(o,m),[3,21];case 9:return e instanceof U?(u=e.polls,m=e.source,this._cacheContext.localCacheEnabled?(l=u.map((function(e){return e.messageId})),[4,Promise.all(l.map((function(e){return n.get(e)})))]):[3,12]):[3,13];case 10:return(c=y.sent().filter((function(e){return e}))).length>0&&u.forEach((function(e){var t=c.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),[4,b((function(){return p(g,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,n.upsert(c)];case 1:return[2,e.sent()]}}))}))}))];case 11:y.sent(),y.label=12;case 12:return this._broadcastPollChangeLogEvent(u,m),[3,21];case 13:return e instanceof S?(h=e.event,m=e.source,[4,n.get(h.messageId)]):[3,17];case 14:return(d=y.sent())&&d.isUserMessage()&&d.poll&&d.poll.applyPollUpdateEvent(h)?[4,b((function(){return p(g,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,n.upsert([d])];case 1:return[2,e.sent()]}}))}))}))]:[3,16];case 15:y.sent(),y.label=16;case 16:return this._broadcastPollUpdateEvent(h,m),[3,21];case 17:return e instanceof T?(f=e.event,m=e.source,[4,n.get(f.messageId)]):[3,21];case 18:return(v=y.sent())&&v.isUserMessage()&&v.poll&&v.poll.applyPollVoteEvent(f)?[4,b((function(){return p(g,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,n.upsert([v])];case 1:return[2,e.sent()]}}))}))}))]:[3,20];case 19:y.sent(),y.label=20;case 20:this._broadcastPollVoteEvent(f,m),y.label=21;case 21:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onPollChangeLogUpdate(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onPollUpdate(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onPollVote(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var s=m(this._observers.values()),i=s.next();!i.done;i=s.next()){i.value.onRemoveUnsent(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),ln=function(t){function n(e){var n=e.userId,r=e.ts,s=e.token,i=e.filter,u=t.call(this)||this,l=o(o({},Yt),i),c=l.customTypes,h=l.includeEmpty,d=l.includeFrozen;return u.method=D.GET,u.path="".concat(R,"/").concat(encodeURIComponent(n),"/my_group_channels/changelogs"),u.params=a({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:r>0?r:null,token:s,custom_types:c,show_empty:h,show_frozen:d}),u}return e(n,t),n}(P),cn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.updatedChannels=n.updated.map((function(t){return new ys(e,t)})),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r}return e(n,t),n}(O),hn=function(t){function n(e){var n=e.channelUrl,r=e.isInternalCall,s=t.call(this)||this;return s.method=D.GET,s.path="".concat(r?k:F,"/").concat(encodeURIComponent(n)),s.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},s}return e(n,t),n}(P),dn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=null,r.channel=new ys(e,n),r}return e(n,t),n}(O),fn=function(t){function n(e){var n=this,r=e.userId,s=e.token,i=e.limit,o=e.order,u=e.includeEmpty,l=e.myMemberStateFilter,c=e.superChannelFilter,h=e.publicChannelFilter,d=e.unreadChannelFilter,f=e.nicknameContainsFilter,p=e.nicknameStartsWithFilter,_=e.nicknameExactMatchFilter,m=e.channelNameContainsFilter,v=e.channelUrlsFilter,g=e.customTypesFilter,y=e.customTypeStartsWithFilter,E=e.hiddenChannelFilter,C=e.metadataOrderKeyFilter,N=e.metadataKey,b=e.metadataValues,M=e.metadataValueStartsWith,T=e.includeFrozen,S=e.includeMetaData,U=e.searchFilter,A=e.userIdsFilter;return(n=t.call(this)||this).method=D.GET,n.path="".concat(R,"/").concat(encodeURIComponent(r),"/my_group_channels"),n.params=a({token:s,limit:i,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:u,member_state_filter:l,super_mode:c,public_mode:h,unread_filter:d,members_nickname_contains:f,members_nickname_startswith:p,members_nickname:_,name_contains:m,channel_urls:v,custom_types:g,custom_type_startswith:y,hidden_mode:E,metadata_order_key:C,metadata_key:N,metadata_values:b,metadata_value_startswith:M,show_frozen:T,show_metadata:S}),U&&U.query&&U.fields&&(n.params.search_query=U.query,n.params.search_fields=U.fields),A&&A.userIds&&A.userIds.length>0&&(A.includeMode?(n.params.members_include_in=A.userIds,n.params.query_type=A.queryType.toUpperCase()):n.params.members_exactly_in=A.userIds),n}return e(n,t),n}(P),pn=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,i=n.channels,a=n.ts;return r.token=s,i&&i.length>0&&(r.channels=i.map((function(t){return t.ts=a,new ys(e,t)}))),r.ts=null!=a?a:null,r}return e(n,t),n}(O),_n=function(t){function n(e){var n=e.userId,r=e.filter,s=t.call(this)||this,i=r.myMemberStateFilter;return s.method=D.GET,s.path="".concat(R,"/").concat(encodeURIComponent(n),"/group_channel_count"),s.params={state:null!=i?i:Ot.ALL},s}return e(n,t),n}(P),mn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.groupChannelCount=n.group_channel_count,r}return e(n,t),n}(O),vn=function(t){function n(e){var n=e.userId,r=e.filter,s=t.call(this)||this,i=r.keys;return s.method=D.GET,s.path="".concat(R,"/").concat(encodeURIComponent(n),"/unread_item_count"),s.params={item_keys:i},s}return e(n,t),n}(P),gn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return"number"==typeof n[Bt.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(r.groupChannelUnreadMentionCount=n[Bt.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[Bt.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(r.groupChannelUnreadMessageCount=n[Bt.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Bt.GROUP_CHANNEL_INVITATION_COUNT]&&(r.groupChannelInvitationCount=n[Bt.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[Bt.SUPER_UNREAD_MENTION_COUNT]&&(r.superGroupChannelUnreadMentionCount=n[Bt.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[Bt.SUPER_UNREAD_MESSAGE_COUNT]&&(r.superGroupChannelUnreadMessageCount=n[Bt.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Bt.SUPER_INVITATION_COUNT]&&(r.superGroupChannelInvitationCount=n[Bt.SUPER_INVITATION_COUNT]),"number"==typeof n[Bt.NONSUPER_UNREAD_MENTION_COUNT]&&(r.nonSuperGroupChannelUnreadMentionCount=n[Bt.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[Bt.NONSUPER_UNREAD_MESSAGE_COUNT]&&(r.nonSuperGroupChannelUnreadMessageCount=n[Bt.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Bt.NONSUPER_INVITATION_COUNT]&&(r.nonSuperGroupChannelInvitationCount=n[Bt.NONSUPER_INVITATION_COUNT]),r}return e(n,t),n}(O),yn=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=D.GET,r.path="".concat(R,"/").concat(encodeURIComponent(n),"/unread_channel_count"),r}return e(n,t),n}(P),En=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.unreadCount=n.unread_count,r}return e(n,t),n}(O),Cn=function(t){function n(e){var n=e.userId,r=e.filter,s=t.call(this)||this,i=r.channelCustomTypesFilter,a=r.superChannelFilter;return s.method=D.GET,s.path="".concat(R,"/").concat(encodeURIComponent(n),"/unread_message_count"),s.params={super_mode:null!=a?a:kt.ALL,custom_types:i},s}return e(n,t),n}(P),Nn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.unreadCount=n.unread_count,r}return e(n,t),n}(O),bn=function(t){function n(e){var n=e.channelUrl,r=e.scheduledStatus,s=e.messageTypeFilter,i=t.call(this)||this;return i.method=D.GET,i.path="".concat(x,"/count"),i.params={channel_url:n,status:Tn(r)},s&&(i.params.message_type=s),i}return e(n,t),n}(P),Mn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.count=n.count,r}return e(n,t),n}(O),Tn=function(e){if(e){var t=[];return e.forEach((function(e){switch(e){case C.PENDING:t.push(H.PENDING);break;case C.SENT:t.push(H.IN_QUEUE),t.push(H.SENT);break;case C.CANCELED:t.push(H.CANCELED);break;case C.FAILED:t.push(H.FAILED)}})),t}},Sn=function(t){function n(e){var n=this,r=e.userId,s=e.channelUrl,i=e.coverUrl,o=e.coverImage,u=e.isDistinct,l=e.isSuper,c=e.isBroadcast,h=e.isPublic,p=e.isExclusive,_=e.isDiscoverable,m=e.isStrict,v=e.isEphemeral,g=e.accessCode,y=e.name,E=e.data,C=e.customType,N=e.messageSurvivalSeconds,b=e.invitedUserIds,M=e.operatorUserIds;return(n=t.call(this)||this).method=D.POST,n.path=F,n.params=a({user_ids:d([r],f(null!=b?b:[]),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:s,cover_url:i,cover_file:o,is_distinct:u,is_super:l,is_broadcast:c,is_exclusive:p,is_public:h,is_discoverable:_,strict:m,is_ephemeral:v,access_code:g,name:y,data:E,custom_type:C,operator_ids:M,message_survival_seconds:N}),n}return e(n,t),n}(P),Un=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new ys(e,n),r.isCreated=n.is_created,r}return e(n,t),n}(O),An=function(t){function n(e){var n=e.userId,r=e.channelUrls,s=t.call(this)||this;return s.method=D.PUT,s.path="".concat(R,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),s.params={channel_urls:r},s}return e(n,t),n}(P);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(O);var In=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,i=e.accessCode;return(n=t.call(this)||this).method=D.PUT,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:s,access_code:i},n}return e(n,t),n}(P),wn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new ys(e,n),r}return e(n,t),n}(O),Ln=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,l=void 0===u?null:u,c=i.users,h=void 0===c?null:c;return s.memberCount=o,s.joinedMemberCount=l,s.members=Array.isArray(h)?h.map((function(t){return new qt(e,t)})):[new qt(e,r.data)],s}return e(n,t),n}(Mt),Dn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,i=e.shouldRemoveOperatorStatus;return(n=t.call(this)||this).method=D.PUT,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:s,should_remove_operator_status:i},n}return e(n,t),n}(P);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(O);var Rn=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,l=void 0===u?null:u;return s.memberCount=o,s.joinedMemberCount=l,s.member=new qt(s._iid,r.data),s}return e(n,t),n}(Mt),Pn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userIds;return(n=t.call(this)||this).method=D.POST,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:s},n}return e(n,t),n}(P),On=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new ys(e,n),r}return e(n,t),n}(O),kn=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u,h=i.inviter,d=void 0===h?null:h,f=i.invitees,p=void 0===f?[]:f;return s.memberCount=o,s.joinedMemberCount=c,s.inviter=d?new l(e,d):null,s.invitees=p.map((function(t){return new qt(e,t)})),s}return e(n,t),n}(Mt),Fn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId;return(n=t.call(this)||this).method=D.PUT,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:s},n}return e(n,t),n}(P),xn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new ys(e,n),r.channel.myMemberState=Rt.NONE,r}return e(n,t),n}(O),Hn=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u,h=i.inviter,d=void 0===h?null:h,f=i.invitee,p=void 0===f?null:f;return s.memberCount=o,s.joinedMemberCount=c,s.inviter=d?new l(e,d):null,s.invitee=p?new qt(e,p):null,s}return e(n,t),n}(Mt),Vn=function(t){function n(e){var n=e.channelUrl;return t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return e(n,t),n}(V),Gn=function(t){function n(e,n,r){var s=t.call(this,e,"READ",r)||this;return s.readStatus=new Kt(e,r),s}return e(n,t),n}(q),qn=function(t){function n(e){var n=e.channelUrl,r=e.userId,s=t.call(this)||this;return(s=t.call(this)||this).method=D.PUT,s.path="".concat(F,"/").concat(encodeURIComponent(n),"/messages/mark_as_delivered"),s.params=a({userId:r}),s}return e(n,t),n}(P);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(O);var Kn,Bn=function(t){function n(e,n,r){var s=t.call(this,e,"DLVR",r)||this;return s.channelUrl=r.channel_url,s.deliveredStateUpdate=r.updated,s}return e(n,t),n}(q),jn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,i=e.hidePreviousMessages,a=e.allowAutoUnhide;return(n=t.call(this)||this).method=D.PUT,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:s,hide_previous_messages:i,allow_auto_unhide:a},n}return e(n,t),n}(P),Qn=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return e(n,t),n}(O),zn=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.allowAutoUnhide=null,s.hidePreviousMessages=null,s.messageOffsetTimestamp=null,r.data&&(s.allowAutoUnhide=r.data.allow_auto_unhide,s.hidePreviousMessages=r.data.hide_previous_messages),s.messageOffsetTimestamp=r.ts_message_offset,s}return e(n,t),n}(q),Wn=function(t){function n(e){var n=e.channelUrl,r=e.time;return t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return e(n,t),n}(V),Yn=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.user=new l(e,r.data),s}return e(n,t),n}(q),Jn=function(t){function n(e){var n=e.channelUrl,r=e.time;return t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return e(n,t),n}(V),Xn=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.user=new l(e,r.data),s}return e(n,t),n}(q),Zn=function(t){function n(e){var n=e.channelUrl,r=e.messageId;return t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return e(n,t),n}(V),$n=function(t){function n(e,n,r){var s=t.call(this,e,"PEDI",r)||this;return s.event=null,s.status=null,s.channelUrl=null,s.channelType=null,s.event=new ke(e,r),s.status=K(r.poll.status)||r.poll.status,s.channelUrl=r.channel_url,s.channelType=r.channel_type,s}return e(n,t),n}(q),er=function(t){function n(e,n,r){var s=t.call(this,e,"VOTE",r)||this;return s.event=null,s.channelUrl=null,s.channelType=null,s.event=new Fe(r),s.channelUrl=r.channel_url,s.channelType=r.channel_type,s}return e(n,t),n}(q),tr=function(n){function r(e,t){var r,s,i,a,o,u,l,c,h,d,f,p,_,m,v,g,y,E,C,N,b,M,T=this;return(T=n.call(this,e,t)||this).includeEmpty=!1,T.includeFrozen=!0,T.includeMetaData=!0,T.channelUrlsFilter=null,T.customTypesFilter=null,T.customTypeStartsWithFilter=null,T.nicknameContainsFilter=null,T.nicknameStartsWithFilter=null,T.nicknameExactMatchFilter=null,T.channelNameContainsFilter="",T.myMemberStateFilter=Ot.ALL,T.unreadChannelFilter=Ft.ALL,T.superChannelFilter=kt.ALL,T.publicChannelFilter=Pt.ALL,T.hiddenChannelFilter=xt.UNHIDDEN,T.searchFilter={fields:[],query:null},T.userIdsFilter={userIds:[],includeMode:!0,queryType:Vt.AND},T.metadataKey=null,T.metadataValues=null,T.metadataOrderKeyFilter=null,T.metadataValueStartsWith=null,T.order=De.LATEST_LAST_MESSAGE,T.includeEmpty=null!==(r=t.includeEmpty)&&void 0!==r&&r,T.includeFrozen=null===(s=t.includeFrozen)||void 0===s||s,T.includeMetaData=null===(i=t.includeMetaData)||void 0===i||i,T.channelUrlsFilter=null!==(a=t.channelUrlsFilter)&&void 0!==a?a:null,T.customTypesFilter=null!==(o=t.customTypesFilter)&&void 0!==o?o:null,T.customTypeStartsWithFilter=null!==(u=t.customTypeStartsWithFilter)&&void 0!==u?u:"",T.nicknameContainsFilter=null!==(l=t.nicknameContainsFilter)&&void 0!==l?l:null,T.nicknameStartsWithFilter=null!==(c=t.nicknameStartsWithFilter)&&void 0!==c?c:null,T.nicknameExactMatchFilter=null!==(h=t.nicknameExactMatchFilter)&&void 0!==h?h:null,T.channelNameContainsFilter=null!==(d=t.channelNameContainsFilter)&&void 0!==d?d:"",T.myMemberStateFilter=null!==(f=t.myMemberStateFilter)&&void 0!==f?f:Ot.ALL,T.unreadChannelFilter=null!==(p=t.unreadChannelFilter)&&void 0!==p?p:Ft.ALL,T.superChannelFilter=null!==(_=t.superChannelFilter)&&void 0!==_?_:kt.ALL,T.publicChannelFilter=null!==(m=t.publicChannelFilter)&&void 0!==m?m:Pt.ALL,T.hiddenChannelFilter=null!==(v=t.hiddenChannelFilter)&&void 0!==v?v:xt.UNHIDDEN,T.searchFilter=null!==(g=t.searchFilter)&&void 0!==g?g:{fields:[],query:null},T.userIdsFilter=null!==(y=t.userIdsFilter)&&void 0!==y?y:{userIds:[],includeMode:!0,queryType:Vt.AND},T.metadataKey=null!==(E=t.metadataKey)&&void 0!==E?E:null,T.metadataValues=null!==(C=t.metadataValues)&&void 0!==C?C:null,T.metadataOrderKeyFilter=null!==(N=t.metadataOrderKeyFilter)&&void 0!==N?N:null,T.metadataValueStartsWith=null!==(b=t.metadataValueStartsWith)&&void 0!==b?b:null,T.order=null!==(M=t.order)&&void 0!==M?M:De.LATEST_LAST_MESSAGE,T}return e(r,n),r.prototype._validate=function(){return n.prototype._validate.call(this)&&g("boolean",this.includeEmpty)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.channelNameContainsFilter)&&v("string",this.channelUrlsFilter,!0)&&v("string",this.customTypesFilter,!0)&&g("string",this.customTypeStartsWithFilter)&&g("string",this.nicknameContainsFilter,!0)&&g("string",this.nicknameStartsWithFilter,!0)&&g("string",this.nicknameExactMatchFilter,!0)&&t(Ot,this.myMemberStateFilter)&&t(kt,this.superChannelFilter)&&t(Pt,this.publicChannelFilter)&&t(Ft,this.unreadChannelFilter)&&t(xt,this.hiddenChannelFilter)&&v(Gt,this.searchFilter.fields)&&g("string",this.searchFilter.query,!0)&&v("string",this.userIdsFilter.userIds)&&g("boolean",this.userIdsFilter.includeMode)&&t(Vt,this.userIdsFilter.queryType)&&t(De,this.order)&&g("string",this.metadataOrderKeyFilter,!0)&&g("string",this.metadataKey,!0)&&v("string",this.metadataValues,!0)&&g("string",this.metadataValueStartsWith,!0)},r.prototype.serialize=function(){return B(this)},r.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,n;return _(this,(function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,sr.of(this._iid).getMyGroupChannels(this._token,this,this.limit)]):[3,2]:[3,5];case 1:return e=r.sent(),t=e.channels,n=e.token,this._token=n,this._hasNext=!!n,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw Q.queryInProgress;case 4:return[3,6];case 5:throw Q.invalidParameters;case 6:return[2]}}))}))},r}(j),nr=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,r=e.bottom,s=void 0===r?0:r;this.top=n,this.bottom=s}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,d([this.top],f(e),!1)),this.bottom=Math.max.apply(Math,d([this.bottom],f(e),!1))},e}(),rr={},sr=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,s=t.dispatcher,i=t.sessionManager,a=t.requestQueue,o=t.logger,u=this;this._leftChannels=new Map,this._markAsReadAllLastSentAt=0,this._iid=e,this._sdkState=n,this._sessionManager=i,this._requestQueue=a,this._dispatcher=s,this._logger=o,this._groupChannelHandlers=new Map,this._groupChannelCache=new Qt(this._iid,{sdkState:n,cacheContext:r}),this._unsentMessageCache=new xe(this._iid,{sdkState:n,cacheContext:r}),this._messageCache=new He(this._iid,{sdkState:n,cacheContext:r,unsentMessageCache:this._unsentMessageCache}),this._groupChannelBroadcast=new on({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:s}),this._messageBroadcast=new un({cacheContext:r,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:s,logger:o}),setInterval((function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(u._dispatcher.dispatch(new sn({channels:[e],source:$t.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),u._groupChannelHandlers.forEach((function(t){t.onTypingStatusUpdated(e)})))};try{for(var r=m(u._groupChannelCache.channels),s=r.next();!s.done;s=r.next()){n(s.value)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}),1e3),this._dispatcher.on((function(e){e instanceof q?u._handleEvent(e):e instanceof Ve&&p(u,void 0,void 0,(function(){var t,n;return _(this,(function(r){switch(r.label){case 0:return t=e.message,[4,this.getChannel(t.channelUrl,!0)];case 1:return n=r.sent(),t instanceof Y?n._autoResendUserMessage(t):t instanceof J&&n._autoResendFileMessage(t),[2]}}))}))})),rr[e]=this}return e.of=function(e){return rr[e]},Object.defineProperty(e.prototype,"handlers",{get:function(){return d([],f(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),e.prototype.buildGroupChannelFromSerializedData=function(e){var t=z(e);return new ys(this._iid,ys.payloadify(t))},e.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=z(e);return new tr(this._iid,t)},e.prototype.buildMemberFromSerializedData=function(e){var t=z(e);return new qt(this._iid,qt.payloadify(t))},e.prototype.getChannelFromCache=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getChannelsFromCache=function(e,t,n){return p(this,void 0,void 0,(function(){return _(this,(function(r){switch(r.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n})];case 1:return[2,r.sent()]}}))}))},e.prototype._handleEvent=function(e){return p(this,void 0,void 0,(function(){var t,r,s,i,a,o,l,c,h,d,f,v,g,y,E,C,N,M,U,A,D,R,P,O,k,F,x,H,V,G,q,K,B,j,Q,z,Y,J,te,re,se,ie,ae,oe,ue,le,ce,he,de,fe,pe,_e,me,ve,ge,ye,Ee,Ce,Ne,be,Me,Te,Se,Ue,Ae,Ie,we,Le,De,Re,Pe,Oe,ke,Fe,xe,He,Ve,Be,je,Qe,ze,We,Ye,Je,Xe,Ze,$e,et,tt,nt,rt,st,it,vt,gt,yt,Et,Ct,Nt,bt,Dt,Pt,Ot,kt,Ft,xt,Ht,Vt,Gt,qt,Kt,Bt,jt,Qt,zt,Wt,Yt,Jt,Xt,Zt,en,tn,nn,rn,on,un,ln,cn,hn,dn,fn=this;return _(this,(function(pn){switch(pn.label){case 0:switch(pn.trys.push([0,76,,77]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"PEDI":return[3,32];case"VOTE":return[3,34];case"SYEV":return[3,36];case"USEV":return[3,74]}return[3,75];case 1:return c=null,"MESG"===e.code?c=e.as(mt):"FILE"===e.code?c=e.as(ee):"ADMM"!==e.code&&"BRDM"!=e.code||(c=e.as(Lt)),c?(t=c.message,r=c.isMentioned,s=c.forceUpdateLastMessage,t.channelType!==u.GROUP?[3,3]:(b((function(){return p(fn,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new Zn(t),this._requestQueue.send(e),[2]}))}))})),P=this._groupChannelCache.isCachedInMemory(t.channelUrl),v=t instanceof L&&t.sender.userId===this._sdkState.userId,[4,this.getChannel(t.channelUrl,!0)])):[3,3];case 2:if((i=pn.sent()).hiddenState=ms.UNHIDDEN,t instanceof L){a=W.of(this._iid).useMemberInfoInMessage;try{for(o=m(i.members),l=o.next();!l.done;l=o.next())if((et=l.value).userId===t.sender.userId){a||(t.sender.nickname=et.nickname,t.sender.plainProfileUrl=et.plainProfileUrl,t.sender.metaData=et.metaData,t.sender.isBlockedByMe=et.isBlockedByMe);break}}catch(e){en={error:e}}finally{try{l&&!l.done&&(tn=o.return)&&tn.call(o)}finally{if(en)throw en.error}}!a&&r&&t.mentionedUsers.forEach((function(e){var t,n;try{for(var r=m(i.members),s=r.next();!s.done;s=r.next()){var a=s.value;if(e.userId===a.userId){e.nickname=a.nickname,e.plainProfileUrl=a.plainProfileUrl,e.metaData=a.metaData;break}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),v&&(y=this._sessionManager.currentUser)&&(y.nickname=t.sender.nickname,y.plainProfileUrl=t.sender.plainProfileUrl,y.metaData=t.sender.metaData)}t.silent&&!v||(i.isEphemeral||P)&&((!i.lastMessage||i.lastMessage.createdAt<t.createdAt)&&(i.lastMessage=t),v||i._updateUnreadCount(i.unreadMessageCount+1,i.unreadMentionCount+(r?1:0))),s&&(!i.lastMessage||i.lastMessage.createdAt<t.createdAt)&&(i.lastMessage=t),this._dispatcher.dispatch(new sn({channels:[i],source:$t.EVENT_MESSAGE_RECEIVED})),t.silent&&!v||Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(i)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),this._dispatcher.dispatch(new w({messages:[t],source:$.EVENT_MESSAGE_RECEIVED})),Z((function(){return p(fn,void 0,void 0,(function(){var e,n,s,a,o;return _(this,(function(u){try{for(e=m(this._groupChannelHandlers.values()),n=e.next();!n.done;n=e.next())(s=n.value).onMessageReceived(i,t),r&&s.onMentionReceived(i,t)}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=e.return)&&o.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),pn.label=3;case 3:return[3,75];case 4:return c=null,"MEDI"===e.code?c=e.as(pt):"FEDI"===e.code?c=e.as(_t):"AEDI"===e.code&&(c=e.as(wt)),c?(h=c.message,d=c.mentionCountChange,h.channelType!==u.GROUP?[3,6]:(P=this._groupChannelCache.isCachedInMemory(h.channelUrl),[4,this.getChannel(h.channelUrl,!0)])):[3,6];case 5:f=pn.sent(),v=h instanceof L&&h.sender.userId===this._sdkState.userId,g=!1,v?(y=this._sessionManager.currentUser)&&(y.nickname=h.sender.nickname,y.plainProfileUrl=h.sender.plainProfileUrl,y.metaData=h.sender.metaData):f.isReadMessage(h)||0!==d&&!h.silent&&P&&(f._updateUnreadCount(f.unreadMessageCount,f.unreadMentionCount+d),g=!0),!f.lastMessage||f.lastMessage.createdAt<h.createdAt?(f.lastMessage=h,g=!0):f.lastMessage.isIdentical(h)&&(P?f.lastMessage.updatedAt<h.updatedAt&&(f.lastMessage=h,g=!0):g=!0),g&&(this._dispatcher.dispatch(new sn({channels:[f],source:$t.EVENT_MESSAGE_UPDATED})),h.silent&&!v||Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(f)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),this._dispatcher.dispatch(new w({messages:[h],source:$.EVENT_MESSAGE_UPDATED})),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r,s;return _(this,(function(i){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated(f,h),0!==d&&n.onMentionReceived(f,h)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),pn.label=6;case 6:return[3,75];case 7:return E=e.as(ft),le=E.channelUrl,ce=E.channelType,C=E.messageId,ce!==u.GROUP?[3,9]:[4,this.getChannel(le,!0)];case 8:N=pn.sent(),this._dispatcher.dispatch(new I({messageIds:[C],source:$.EVENT_MESSAGE_DELETED})),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onMessageDeleted(N,C)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),pn.label=9;case 9:return[3,75];case 10:return(M=e.as(Gn).readStatus).channelType!==u.GROUP?[3,12]:(P=this._groupChannelCache.isCachedInMemory(M.channelUrl),[4,this.getChannel(M.channelUrl,!0)]);case 11:U=pn.sent(),P&&U._updateUnreadMemberState(M.reader.userId,M.readAt),M.reader.userId===this._sdkState.userId?P?(U.unreadMessageCount>0||U.unreadMentionCount>0)&&(U._updateUnreadCount(0,0),this._dispatcher.dispatch(new sn({channels:[U],source:$t.EVENT_CHANNEL_READ})),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(U)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):0!==U.unreadMessageCount&&0!==U.unreadMentionCount||(this._dispatcher.dispatch(new sn({channels:[U],source:$t.EVENT_CHANNEL_READ})),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(U)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):(this._dispatcher.dispatch(new sn({channels:[U],source:$t.EVENT_CHANNEL_READ})),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUnreadMemberStatusUpdated(U)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),pn.label=12;case 12:return[3,75];case 13:return A=e.as(Bn),le=A.channelUrl,D=A.deliveredStateUpdate,R=void 0===D?{}:D,P=this._groupChannelCache.isCachedInMemory(le),[4,this.getChannel(le,!0)];case 14:if(O=pn.sent(),P)for(k in R)O._updateUndeliveredMemberState(k,R[k]);return this._dispatcher.dispatch(new sn({channels:[O],source:$t.EVENT_CHANNEL_DELIVERED})),Object.keys(R).some((function(e){return e!==fn._sdkState.userId}))&&Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUndeliveredMemberStatusUpdated(O)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),[3,75];case 15:return F=e.as(It),le=F.channelUrl,ce=F.channelType,x=F.event,ce!==u.GROUP?[3,18]:[4,this.getChannel(le,!0)];case 16:return H=pn.sent(),[4,this.getMessageFromCache(x.messageId)];case 17:(q=pn.sent())&&(q.applyReactionEvent(x),this._dispatcher.dispatch(new w({messages:[q],source:$.EVENT_MESSAGE_REACTION_UPDATED}))),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onReactionUpdated(H,x)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),pn.label=18;case 18:return[3,75];case 19:return(V=e.as(At).event).channelType!==u.GROUP?[3,22]:[4,this.getChannel(V.channelUrl,!0)];case 20:return G=pn.sent(),[4,this.getMessageFromCache(V.targetMessageId)];case 21:(q=pn.sent())&&(q.applyThreadInfoUpdateEvent(V),this._dispatcher.dispatch(new w({messages:[q],source:$.EVENT_MESSAGE_THREADINFO_UPDATED}))),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onThreadInfoUpdated(G,V)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),pn.label=22;case 22:return[3,75];case 23:K=e.as(Ut).groupChannelMemberCounts,B=[],pn.label=24;case 24:pn.trys.push([24,29,30,31]),j=m(K),Q=j.next(),pn.label=25;case 25:return Q.done?[3,28]:(z=Q.value,le=z.channelUrl,He=z.memberCount,Ve=z.joinedMemberCount,Y=z.updatedAt,[4,this.getChannelFromCache(le)]);case 26:(J=pn.sent())&&J._setLatestMemberCount(He,Ve,Y)&&B.push(J),pn.label=27;case 27:return Q=j.next(),[3,25];case 28:return[3,31];case 29:return te=pn.sent(),nn={error:te},[3,31];case 30:try{Q&&!Q.done&&(rn=j.return)&&rn.call(j)}finally{if(nn)throw nn.error}return[7];case 31:return B.length>0&&(this._dispatcher.dispatch(new sn({channels:B,source:$t.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelMemberCountChanged(B)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),[3,75];case 32:return re=e.as($n),se=re.event,ie=re.status,le=re.channelUrl,ce=re.channelType,le&&ce?[4,this.getChannel(le,!0)]:[3,75];case 33:return ae=pn.sent(),this._dispatcher.dispatch(new S({event:se,source:$.EVENT_POLL_UPDATED})),Z(ie===ne?function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onPollDeleted(ae,se.pollId)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}:function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onPollUpdated(ae,se)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}),[3,75];case 34:return oe=e.as(er),ue=oe.event,le=oe.channelUrl,ce=oe.channelType,le&&ce?[4,this.getChannel(le,!0)]:[3,75];case 35:return he=pn.sent(),this._dispatcher.dispatch(new T({event:ue,source:$.EVENT_POLL_VOTED})),Z((function(){return p(fn,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){try{for(e=m(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onPollVoted(he,ue)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),[3,75];case 36:if(!(de=e.as(Mt).event).isGroupChannelEvent)return[3,73];switch(de.category){case Tt.CHANNEL_JOIN:return[3,37];case Tt.CHANNEL_LEAVE:return[3,39];case Tt.CHANNEL_OPERATOR_UPDATE:return[3,43];case Tt.CHANNEL_INVITE:return[3,45];case Tt.CHANNEL_DECLINE_INVITE:return[3,47];case Tt.TYPING_START:case Tt.TYPING_END:return[3,49];case Tt.USER_CHANNEL_MUTE:case Tt.USER_CHANNEL_UNMUTE:return[3,51];case Tt.USER_CHANNEL_BAN:return[3,53];case Tt.USER_CHANNEL_UNBAN:return[3,57];case Tt.CHANNEL_FREEZE:case Tt.CHANNEL_UNFREEZE:return[3,59];case Tt.CHANNEL_HIDE:return[3,61];case Tt.CHANNEL_UNHIDE:return[3,63];case Tt.CHANNEL_DELETED:return[3,65];case Tt.CHANNEL_PROP_CHANGED:return[3,67];case Tt.CHANNEL_META_DATA_CHANGED:return[3,69];case Tt.CHANNEL_META_COUNTERS_CHANGED:return[3,71]}return[3,73];case 37:return[4,this.getChannel(de.channelUrl,!0)];case 38:return fe=pn.sent(),pe=e.as(Ln),_e=pe.memberCount,me=pe.joinedMemberCount,ve=pe.members,ge=!1,ve.forEach((function(e){fe.isExclusive||fe.isSuper||fe.isBroadcast?ge=ge||fe._setLatestMemberCount(_e,me,de.ts):(e.state=Rt.JOINED,fe.addMember(e,de.ts),fn._updateJoinedMemberCount(fe)),e.userId===fn._sdkState.userId&&(fe.myMemberState=Rt.JOINED)})),this._dispatcher.dispatch(new sn({channels:[fe],source:$t.EVENT_CHANNEL_JOINED})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var r=m(ve),s=r.next();!s.done;s=r.next()){var i=s.value;e.onUserJoined(fe,i)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}fe.isBroadcast&&ge&&e.onChannelMemberCountChanged([fe])})),[2]}))}))})),[3,73];case 39:return(tt=this._leftChannels.get(de.channelUrl))?(Ee=tt.channel,[3,42]):[3,40];case 40:return[4,this.getChannel(de.channelUrl,!0)];case 41:Ee=pn.sent(),pn.label=42;case 42:return ye=Ee,Ce=e.as(Rn),He=Ce.memberCount,Ve=Ce.joinedMemberCount,Ne=Ce.member,be=!1,Me=W.of(this._iid).appInfo,ye.isExclusive||ye.isSuper||ye.isBroadcast?be=ye._setLatestMemberCount(He,Ve,de.ts):(Me.enabledChannelMemberShipHistory?(ye.members.find((function(e){return e.userId===Ne.userId})).state=Rt.LEFT,ye.memberCount=He):ye.removeMember(Ne),this._updateJoinedMemberCount(ye)),Ne.userId===this._sdkState.userId?(ye.myMemberState=Rt.NONE,ye.invitedAt=0,ye.joinedAt=0,ye._updateUnreadCount(0,0),ye.isPublic?this._dispatcher.dispatch(new sn({channels:[ye],source:$t.EVENT_CHANNEL_LEFT})):(this._markAsLeave(ye),this._dispatcher.dispatch(new an({channelUrls:[ye.url],source:$t.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new sn({channels:[ye],source:$t.EVENT_CHANNEL_LEFT})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft(ye,Ne),ye.isBroadcast&&be&&e.onChannelMemberCountChanged([ye])})),[2]}))}))})),[3,73];case 43:return[4,this.getChannel(de.channelUrl,!0)];case 44:Te=pn.sent(),Se=e.as(St).operators,Ue=Se.map((function(e){return e.userId}));try{for(Ae=m(Te.members),Ie=Ae.next();!Ie.done;Ie=Ae.next())(et=Ie.value).role=Ue.includes(et.userId)?n.OPERATOR:n.NONE}catch(e){on={error:e}}finally{try{Ie&&!Ie.done&&(un=Ae.return)&&un.call(Ae)}finally{if(on)throw on.error}}return Te.myRole=Ue.includes(this._sdkState.userId)?n.OPERATOR:n.NONE,this._dispatcher.dispatch(new sn({channels:[Te],source:$t.EVENT_CHANNEL_OPERATOR_UPDATED})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated(Te,Se)})),[2]}))}))})),[3,73];case 45:return[4,this.getChannel(de.channelUrl,!0)];case 46:we=pn.sent(),Le=e.as(kn),He=Le.memberCount,Ve=Le.joinedMemberCount,De=Le.inviter,(Re=Le.invitees).forEach((function(e){return e.state=Rt.INVITED}));try{for(Pe=m(Re),Oe=Pe.next();!Oe.done;Oe=Pe.next())ke=Oe.value,we.isExclusive||we.isSuper||we.isBroadcast?we._setLatestMemberCount(He,Ve,de.ts):we.addMember(ke,de.ts),this._sdkState.userId===ke.userId&&(we.hiddenState=ms.UNHIDDEN,we.myMemberState!==Rt.JOINED&&(we.myMemberState=Rt.INVITED),we.invitedAt=de.ts)}catch(e){ln={error:e}}finally{try{Oe&&!Oe.done&&(cn=Pe.return)&&cn.call(Pe)}finally{if(ln)throw ln.error}}return this._dispatcher.dispatch(new sn({channels:[we],source:$t.EVENT_CHANNEL_INVITED})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation(we,De,Re)})),[2]}))}))})),[3,73];case 47:return[4,this.getChannel(de.channelUrl,!0)];case 48:return Fe=pn.sent(),xe=e.as(Hn),He=xe.memberCount,Ve=xe.joinedMemberCount,Be=xe.inviter,je=xe.invitee,Fe.isExclusive||Fe.isSuper||Fe.isBroadcast?Fe._setLatestMemberCount(He,Ve,de.ts):Fe.removeMember(je),this._sdkState.userId===je.userId?(Fe.invitedAt=0,Fe.myMemberState=Rt.NONE,Fe.isPublic?this._dispatcher.dispatch(new sn({channels:[Fe],source:$t.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new an({channelUrls:[Fe.url],source:$t.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new sn({channels:[Fe],source:$t.EVENT_CHANNEL_DECLINED_INVITE})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation(Fe,Be,je)})),[2]}))}))})),[3,73];case 49:return[4,this.getChannel(de.channelUrl,!0)];case 50:return Qe=pn.sent(),ze=de.category===Tt.TYPING_START,We=e.as(ze?Yn:Xn).user,Qe._updateTypingStatus(We,ze?de.ts:0),this._dispatcher.dispatch(new sn({channels:[Qe],source:$t.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(Qe)})),[2]}))}))})),[3,73];case 51:return[4,this.getChannel(de.channelUrl,!0)];case 52:Ye=pn.sent(),Je=de.category===Tt.USER_CHANNEL_MUTE,(Xe=e.as(Je?ht:dt).user).userId===this._sdkState.userId&&(Ye.myMutedState=Je?_s.MUTED:_s.UNMUTED);try{for(Ze=m(Ye.members),$e=Ze.next();!$e.done;$e=Ze.next())if((et=$e.value).userId===Xe.userId){et.isMuted=Je;break}}catch(e){hn={error:e}}finally{try{$e&&!$e.done&&(dn=Ze.return)&&dn.call(Ze)}finally{if(hn)throw hn.error}}return this._dispatcher.dispatch(new sn({channels:[Ye],source:Je?$t.EVENT_CHANNEL_MUTED:$t.EVENT_CHANNEL_UNMUTED})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Je?e.onUserMuted(Ye,Xe):e.onUserUnmuted(Ye,Xe)})),[2]}))}))})),[3,73];case 53:return(tt=this._leftChannels.get(de.channelUrl))?(rt=tt.channel,[3,56]):[3,54];case 54:return[4,this.getChannel(de.channelUrl,!0)];case 55:rt=pn.sent(),pn.label=56;case 56:return nt=rt,this._markAsLeave(nt),st=e.as(ct).user,Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned(nt,st)})),[2]}))}))})),[3,73];case 57:return[4,this.getChannel(de.channelUrl,!0)];case 58:return it=pn.sent(),vt=e.as(lt).user,Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned(it,vt)})),[2]}))}))})),[3,73];case 59:return[4,this.getChannel(de.channelUrl,!0)];case 60:return gt=pn.sent(),yt=e.as(ut).freeze,gt.isFrozen=yt,this._dispatcher.dispatch(new sn({channels:[gt],source:yt?$t.EVENT_CHANNEL_FROZEN:$t.EVENT_CHANNEL_UNFROZEN})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){yt?e.onChannelFrozen(gt):e.onChannelUnfrozen(gt)})),[2]}))}))})),[3,73];case 61:return[4,this.getChannel(de.channelUrl,!0)];case 62:return Et=pn.sent(),Ct=e.as(zn),Nt=Ct.allowAutoUnhide,bt=Ct.hidePreviousMessages,Dt=Ct.messageOffsetTimestamp,null!==Nt&&(Et.hiddenState=Nt?ms.HIDDEN_ALLOW_AUTO_UNHIDE:ms.HIDDEN_PREVENT_AUTO_UNHIDE),null!==bt&&bt&&Et._updateUnreadCount(0,0),null!==Dt&&(Et.messageOffsetTimestamp=Dt),this._dispatcher.dispatch(new sn({channels:[Et],source:$t.EVENT_CHANNEL_HIDDEN})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden(Et)})),[2]}))}))})),[3,73];case 63:return[4,this.getChannel(de.channelUrl,!0)];case 64:return(Pt=pn.sent()).hiddenState=ms.UNHIDDEN,this._dispatcher.dispatch(new sn({channels:[Pt],source:$t.EVENT_CHANNEL_UNHIDDEN})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(Pt)})),[2]}))}))})),[3,73];case 65:return[4,this.getChannel(de.channelUrl,!0)];case 66:return Ot=pn.sent(),this._dispatcher.dispatch(new an({channelUrls:[de.channelUrl],source:$t.EVENT_CHANNEL_DELETED})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted(Ot.url,Ot.channelType)})),[2]}))}))})),[3,73];case 67:return[4,this.getChannelWithoutCache(de.channelUrl,!0)];case 68:return kt=pn.sent(),this._dispatcher.dispatch(new sn({channels:[kt],source:$t.EVENT_CHANNEL_UPDATED})),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(kt)})),[2]}))}))})),[3,73];case 69:return[4,this.getChannel(de.channelUrl,!0)];case 70:return Ft=pn.sent(),xt=e.as(ot),Ht=xt.created,Vt=xt.updated,Gt=xt.deleted,Ht&&Ft._upsertCachedMetaData(Ht,de.ts),Vt&&Ft._upsertCachedMetaData(Vt,de.ts),Gt&&Ft._removeFromCachedMetaData(Gt,de.ts),Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Ht&&e.onMetaDataCreated(Ft,Ht),Vt&&e.onMetaDataUpdated(Ft,Vt),Gt&&e.onMetaDataDeleted(Ft,Gt)})),[2]}))}))})),[3,73];case 71:return[4,this.getChannel(de.channelUrl,!0)];case 72:return qt=pn.sent(),Kt=e.as(at),Bt=Kt.created,jt=Kt.updated,Qt=Kt.deleted,Z((function(){return p(fn,void 0,void 0,(function(){return _(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Bt&&e.onMetaCounterCreated(qt,Bt),jt&&e.onMetaCounterUpdated(qt,jt),Qt&&e.onMetaCounterDeleted(qt,Qt)})),[2]}))}))})),[3,73];case 73:return[3,75];case 74:switch((zt=e.as(Ge).event).category){case qe.USER_BLOCK:Wt=Ke.getDataAsUserBlockEvent(this._iid,zt),Jt=Wt.blocker,Xt=Wt.blockee,this._groupChannelCache.block(Jt.userId,Xt.userId);break;case qe.USER_UNBLOCK:Yt=Ke.getDataAsUserBlockEvent(this._iid,zt),Jt=Yt.blocker,Xt=Yt.blockee,this._groupChannelCache.unblock(Jt.userId,Xt.userId)}return[3,75];case 75:return[3,77];case 76:if(Zt=pn.sent(),X(Zt))throw Zt;return[3,77];case 77:return[2]}}))}))},e.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)},e.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},e.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},e.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},e.prototype.subscribeGroupChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},e.prototype.unsubscribeGroupChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},e.prototype.subscribeMessageEvent=function(e,t){this._messageBroadcast.subscribe(e,t)},e.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},e.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter((function(e){return e.state===Rt.JOINED})).length},e.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n;return _(this,(function(r){switch(r.label){case 0:te(g("string",e)).throw(Q.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}}))}))},e.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n,r,s,i,a;return _(this,(function(o){switch(o.label){case 0:return te(g("string",e)).throw(Q.invalidParameters),n=new hn({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(r=o.sent(),s=r.as(dn).channel,i=s.unreadMessageCount,a=s.unreadMentionCount,s.myCountPreference){case ps.UNREAD_MESSAGE_COUNT_ONLY:a=0;break;case ps.UNREAD_MENTION_COUNT_ONLY:i=0;break;case ps.OFF:i=0,a=0}return s._updateUnreadCount(i,a),[4,this._groupChannelCache.upsert([s])];case 2:return o.sent(),[2,s]}}))}))},e.prototype.getMyGroupChannels=function(e,t,n,r){return void 0===r&&(r=$t.REQUEST_CHANNEL),p(this,void 0,void 0,(function(){var s,i,a,u,l;return _(this,(function(c){switch(c.label){case 0:return s=new fn(o(o({},t),{userId:this._sdkState.userId,token:e,limit:n})),[4,this._requestQueue.send(s)];case 1:return i=c.sent(),a=i.as(pn),u=a.channels,l=a.token,this._dispatcher.dispatch(new sn({channels:u,source:r})),[2,{channels:u,token:l}]}}))}))},e.prototype.getMessageFromCache=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getMessagesFromCache=function(e,t,n,r,s){return void 0===s&&(s=Be),p(this,void 0,void 0,(function(){return _(this,(function(i){switch(i.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:s,filter:r,backward:"next"===n})];case 1:return[2,i.sent()]}}))}))},e.prototype.getPollMessagesFromCache=function(e,t,n,r){return void 0===r&&(r=Be),p(this,void 0,void 0,(function(){return _(this,(function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:n,backward:!1,isPollOnly:!0})];case 1:return[2,s.sent()]}}))}))},e.prototype.getUnsentMessagesFromCache=function(e,t){return p(this,void 0,void 0,(function(){return _(this,(function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t})];case 1:return[2,n.sent()]}}))}))},e.prototype.removeFailedMessageFromCache=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}}))}))},e.prototype.getCachedMessageCountBetween=function(e,t,n,r){return p(this,void 0,void 0,(function(){return _(this,(function(s){switch(s.label){case 0:return[4,this._messageCache.countBetween(e,t,new nr({top:n,bottom:r}))];case 1:return[2,s.sent()]}}))}))},e.prototype.getMyGroupChannelChangeLogs=function(e,t,n){return void 0===n&&(n=$t.REQUEST_CHANNEL_CHANGELOGS),p(this,void 0,void 0,(function(){var r,s,i,u,l,c;return _(this,(function(h){switch(h.label){case 0:return r=o(o({},Yt),t),te((g("string",e)||g("number",e))&&Jt(r)).throw(Q.invalidParameters),s=new ln(a({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:r})),[4,this._requestQueue.send(s)];case 1:return i=h.sent(),u=i.as(cn),l=u.updatedChannels,c=u.deletedChannelUrls,l.length>0&&this._dispatcher.dispatch(new sn({channels:l,source:n})),c.length>0&&this._dispatcher.dispatch(new an({channelUrls:c,source:n})),[2,u]}}))}))},e.prototype.getGroupChannelCount=function(e){return p(this,void 0,void 0,(function(){var t,n,r;return _(this,(function(s){switch(s.label){case 0:return t=o(o({},Xt),e),te(Zt(t)).throw(Q.invalidParameters),n=new _n({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return r=s.sent(),[2,r.as(mn).groupChannelCount]}}))}))},e.prototype.getUnreadItemCount=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return t=o(o({},en),e),te(function(e){return v(Bt,e.keys)}(t)).throw(Q.invalidParameters),n=W.of(this._iid),r=n.sdkState,s=n.requestQueue,i=new vn({userId:r.userId,filter:t}),[4,s.send(i)];case 1:return[2,a.sent().as(gn)]}}))}))},e.prototype.getTotalUnreadChannelCount=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s;return _(this,(function(i){switch(i.label){case 0:return e=W.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new yn({userId:t.userId}),[4,n.send(r)];case 1:return s=i.sent(),[2,s.as(En).unreadCount]}}))}))},e.prototype.getTotalUnreadMessageCount=function(e){return p(this,void 0,void 0,(function(){var n,r,s,i,a,u;return _(this,(function(l){switch(l.label){case 0:return n=o(o({},tn),e),te(function(e){return v("string",e.channelCustomTypesFilter,!0)&&t(kt,e.superChannelFilter)}(n)).throw(Q.invalidParameters),r=W.of(this._iid),s=r.sdkState,i=r.requestQueue,a=new Cn({userId:s.userId,filter:n}),[4,i.send(a)];case 1:return u=l.sent(),[2,u.as(Nn).unreadCount]}}))}))},e.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){var n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return n=o(o({},nn),e),te(function(e){return g("string",e.channelUrl,!0)&&v(C,e.scheduledStatus,!0)&&t(E,e.messageTypeFilter)}(n)).throw(Q.invalidParameters),r=W.of(this._iid).requestQueue,s=new bn(n),[4,r.send(s)];case 1:return i=a.sent(),[2,i.as(Mn).count]}}))}))},e.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=W.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},e.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=W.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e},e.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=W.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},e.prototype.createChannel=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s;return _(this,(function(i){switch(i.label){case 0:return t=o(o({},zt),e),te(Wt(t)).throw(Q.invalidParameters),t.isPublic||(t.accessCode=null),n=new Sn(o({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return r=i.sent(),s=r.as(Un).channel,[4,this._groupChannelCache.upsert([s])];case 2:return i.sent(),[2,s]}}))}))},e.prototype.markAsReadAll=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i,a,o;return _(this,(function(u){switch(u.label){case 0:return e=Date.now(),te(e-this._markAsReadAllLastSentAt>=1e3).throw(Q.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new An({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:u.sent(),n=this._groupChannelCache.channels;try{for(r=m(n),s=r.next();!s.done;s=r.next())(i=s.value)._updateUnreadMemberState(this._sdkState.userId,e),i._updateUnreadCount(0,0)}catch(e){a={error:e}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}return n.length>0?[4,this._groupChannelCache.upsert(n)]:[3,3];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},e.prototype.markAsReadWithChannelUrls=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,i,a,o,u,l;return _(this,(function(c){switch(c.label){case 0:return t=Date.now(),te(v("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(Q.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new An({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:c.sent(),r=this._groupChannelCache.channels,s=[];try{for(i=m(r),a=i.next();!a.done;a=i.next())o=a.value,e.includes(o.url)&&(o._updateUnreadMemberState(this._sdkState.userId,t),o._updateUnreadCount(0,0),s.push(o))}catch(e){u={error:e}}finally{try{a&&!a.done&&(l=i.return)&&l.call(i)}finally{if(u)throw u.error}}return s.length>0?[4,this._groupChannelCache.upsert(s)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))},e.prototype.markAsDelivered=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},e}(),ir=new Map,ar=new Map,or=new Map,ur=function(){function e(t){var n=t.key,r=t.concurrentCallLimit,s=void 0===r?2:r,i=t.backOffDelay,a=void 0===i?0:i,o=this;this._holdersKey=e.createSemaphoreHoldersKey(n),this._resolversKey=e.createSemaphoreResolversKey(n),this._chainProcessStateKey=e.createChainProcessStateKey(n),this._numLocks=s,this._backOffDelay=a,this._localAcquiredKeys=[],this._localResolversData=[],re()?(ir[this._holdersKey]||(ir[this._holdersKey]=[]),ar[this._resolversKey]||(ar[this._resolversKey]=[])):(window.addEventListener("storage",(function(e){return p(o,void 0,void 0,(function(){var t,n;return _(this,(function(r){if(this._localResolversData.length>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()&&this._hasHighestPriorityResolver())switch(e.key){case this._holdersKey:if(t=JSON.parse(e.oldValue),n=JSON.parse(e.newValue),!t||!n||n.length>=t.length)return[2];this._processChainResolve();break;case this._chainProcessStateKey:if(JSON.parse(e.newValue))return[2];this._processChainResolve();break;default:return[2]}return[2]}))}))})),window.addEventListener("beforeunload",(function(){var e=o._getLocalResolversData(),t=o._localResolversData.map((function(e){return e.key})),n=e.filter((function(e){return t.indexOf(e.key)<0}));window.localStorage.setItem(o._resolversKey,JSON.stringify(n)),o._localAcquiredKeys.forEach((function(e){return o.release(e)}))})))}return e.createSemaphoreHoldersKey=function(e){return"collection@semaphore_holders_for:"+e},e.createSemaphoreResolversKey=function(e){return"collection@semaphore_resolvers_for:"+e},e.createChainProcessStateKey=function(e){return"collection@semaphore_chain_process_state_for:"+e},Object.defineProperty(e.prototype,"numLocks",{get:function(){return this._numLocks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backOffDelay",{get:function(){return this._backOffDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numLocksAvailable",{get:function(){if(re())return this.numLocks-ir[this._holdersKey].length;var e=this._getLocalHoldersData();return this.numLocks-e.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waitCount",{get:function(){return re()?ar[this._resolversKey].length:this._getLocalResolversData().length},enumerable:!1,configurable:!0}),e.prototype._hasHighestPriorityResolver=function(){var e=this._getLocalResolversData();return e.length>0&&this._localResolversData.map((function(e){return e.key})).indexOf(e[0].key)>=0},e.prototype._isProcessChainAcquireRunning=function(){if(re())return or[this._chainProcessStateKey];var e=window.localStorage[this._chainProcessStateKey];return void 0!==e&&JSON.parse(e)},e.prototype._setProcessChainAcquireRunning=function(e){re()?or[this._chainProcessStateKey]=e:e?window.localStorage.setItem(this._chainProcessStateKey,JSON.stringify(e)):window.localStorage.removeItem(this._chainProcessStateKey)},e.prototype._processChainResolve=function(){return p(this,void 0,void 0,(function(){var e;return _(this,(function(t){switch(t.label){case 0:return this.waitCount>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()?(this._setProcessChainAcquireRunning(!0),this._tryResolve()?[4,ie(this._backOffDelay)]:[3,2]):[3,3];case 1:t.sent(),t.label=2;case 2:this._setProcessChainAcquireRunning(!1),re()?this._processChainResolve():(e=new StorageEvent("storage",{key:this._chainProcessStateKey,oldValue:JSON.stringify(!0),newValue:JSON.stringify(!1)}),dispatchEvent(e)),t.label=3;case 3:return[2]}}))}))},e.prototype.acquire=function(e){return void 0===e&&(e=0),p(this,void 0,void 0,(function(){var t,n=this;return _(this,(function(r){return re()?[2,new Promise((function(t){for(var r={key:se(),resolver:function(e){return t(e)},priority:e},s=ar[n._resolversKey],i=-1,a=0;a<s.length;a++)if(e>s[a].priority){i=a;break}i>=0?ar[n._resolversKey].splice(i,0,r):ar[n._resolversKey].push(r),n._processChainResolve()}))]:(t=this._getLocalResolversData(),[2,new Promise((function(r){for(var s=se(),i={key:s,priority:e},a={key:s,resolver:function(e){return r(e)},priority:e},o=-1,u=0;u<t.length;u++)if(e>t[u].priority){o=u;break}o>=0?(t.splice(o,0,i),n._localResolversData.splice(o,0,a)):(t.push(i),n._localResolversData.push(a)),window.localStorage.setItem(n._resolversKey,JSON.stringify(t)),n._processChainResolve()}))])}))}))},e.prototype.release=function(e){if(re()){if((t=ir[this._holdersKey].indexOf(e))>=0)return ir[this._holdersKey].splice(t,1),this._processChainResolve(),!0}else if(window.localStorage[this._holdersKey]){var t,n=JSON.parse(window.localStorage[this._holdersKey]),r=d([],f(n),!1);if((t=n.indexOf(e))>=0){n.splice(t,1),window.localStorage.setItem(this._holdersKey,JSON.stringify(n)),this._localAcquiredKeys.splice(this._localAcquiredKeys.indexOf(e),1);var s=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(r),newValue:JSON.stringify(n)});return dispatchEvent(s),!0}}return!1},e.prototype._tryResolve=function(){if(re()){if(ir[this._holdersKey].length<this.numLocks){var e=se();return ir[this._holdersKey]=d(d([],f(ir[this._holdersKey]),!1),[e],!1),(n=ar[this._resolversKey].shift()).resolver(e),!0}}else{var t=this._getLocalHoldersData();if(t.length<this.numLocks){e=se();var n=this._localResolversData.shift(),r=this._getLocalResolversData(),s=r.map((function(e){return e.key})).indexOf(n.key);r.splice(s,1),window.localStorage.setItem(this._resolversKey,JSON.stringify(r)),window.localStorage.setItem(this._holdersKey,JSON.stringify(d(d([],f(t),!1),[e],!1))),this._localAcquiredKeys.push(e);var i=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(d([],f(t),!1)),newValue:JSON.stringify(d(d([],f(t),!1),[e],!1))});return dispatchEvent(i),(0,n.resolver)(e),!0}}return!1},e.prototype._getLocalHoldersData=function(){var e=window.localStorage[this._holdersKey];return void 0!==e?JSON.parse(e):[]},e.prototype._getLocalResolversData=function(){var e=window.localStorage[this._resolversKey];return void 0!==e?JSON.parse(e):[]},e}();!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(Kn||(Kn={}));var lr,cr=function(t){function n(e,n,r,s){void 0===r&&(r=2),void 0===s&&(s=10);var i=t.call(this)||this;return i._worker=null,i._state=Kn.IDLE,i._semaphore=null,i._retryCount=0,i._retryLimit=3,i.priority=0,i._worker=n,i._semaphore=new ur({key:e,concurrentCallLimit:r,backOffDelay:s}),i}return e(n,t),Object.defineProperty(n.prototype,"isIdle",{get:function(){return this._state===Kn.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRunning",{get:function(){return this._state===Kn.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isDone",{get:function(){return this._state===Kn.END},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),n.prototype._run=function(e){return p(this,void 0,void 0,(function(){var t,n;return _(this,(function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}}))}))},n.prototype.start=function(e){this.isIdle&&(this._state=Kn.RUNNING,this._run(e))},n.prototype.stop=function(){this._state=Kn.IDLE,this.dispatch("stop")},n.prototype.end=function(){this._state=Kn.END,this.dispatch("end")},n}(ae),hr=function(e){this.source=e},dr=function(e){this.source=e},fr={},pr=function(){function e(e){var t=e._iid,n=e.channel,r=this;this._prevSync=null,this._nextSync=null,this._metadata=null,this._iid=t,this._channel=n;var s,i,a=W.of(this._iid),o=a.sdkState,u=a.logger;this._metadataKey=(s=o.userId,i=n.url,"sendbird:".concat(s,"@groupchannel/").concat(i,"/message/sync.meta"));var l=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(o.userId,n.url);this._prevSync=new cr(l,(function(e){return p(r,void 0,void 0,(function(){var t,n,r,s,i,a;return _(this,(function(o){switch(o.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:if(o.sent(),u.debug("message background prev sync from",null===(s=this._metadata)||void 0===s?void 0:s.range.top),this._metadata.previousComplete)return[3,9];o.label=2;case 2:return o.trys.push([2,5,,8]),[4,le.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(a=null===(i=this._metadata.range)||void 0===i?void 0:i.top)&&void 0!==a?a:e,{prevResultSize:100,nextResultSize:0,replyType:ce.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},$.SYNC_MESSAGE_BACKGROUND)];case 3:return n=o.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.top,this._metadata.previousComplete=!t.hasNext,u.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return o.sent(),[3,8];case 5:return r=o.sent(),u.debug("message background prev sync error",r),r instanceof Q&&r.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[3,10];case 9:t.hasNext=!1,o.label=10;case 10:return[2,t]}}))}))})),this._nextSync=new cr(l,(function(e){return p(r,void 0,void 0,(function(){var t,n,r,s,i,a;return _(this,(function(o){switch(o.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:o.sent(),u.debug("message background next sync from",null===(s=this._metadata)||void 0===s?void 0:s.range.bottom),o.label=2;case 2:return o.trys.push([2,5,,6]),[4,le.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(a=null===(i=this._metadata.range)||void 0===i?void 0:i.bottom)&&void 0!==a?a:e,{prevResultSize:0,nextResultSize:100,replyType:ce.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},$.SYNC_MESSAGE_BACKGROUND)];case 3:return n=o.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.bottom,u.debug("message background next sync progress",t),[4,this.saveMetadata()];case 4:return o.sent(),[3,6];case 5:throw r=o.sent(),u.debug("message background next sync error",r),r;case 6:return[2,t]}}))}))}))}return e.of=function(t,n){if(fr[t]||(fr[t]={}),!fr[t][n.url]){var r=fr[t][n.url]=new e({_iid:t,channel:n});W.of(t).dispatcher.on((function(e){if(e instanceof oe)if(e.stateType===ue.CONNECTED)r.resume();else r.pause()}))}return fr[t][n.url]},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,d([],f(e.map((function(e){return e.createdAt}))),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,d([],f(e.map((function(e){return e.createdAt}))),!1))},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e;return _(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,W.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={range:new nr(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:Number.MAX_SAFE_INTEGER}),previousComplete:!!e&&e.previousComplete},t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return this._metadata?[4,W.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,W.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},e.prototype.resume=function(){var e,t,n,r;W.of(this._iid).logger.debug("message background sync resume()"),this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:Date.now())},e.prototype.pause=function(){W.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e}(),_r={},mr=function(){function e(e){var t=e._iid,n=e.channel,r=this;this._sync=null,this._metadata=null,this._iid=t,this._channel=n;var s,i,a=W.of(this._iid),o=a.logger,u=a.sdkState;this._metadataKey=(s=u.userId,i=n.url,"sendbird:".concat(s,"@groupchannel/").concat(i,"/message/changelogs.meta"));var l=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(u.userId,this._channel.url);this._sync=new cr(l,(function(){return p(r,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:a.sent(),o.debug("message changelog sync from",null===(i=this._metadata)||void 0===i?void 0:i.token),a.label=2;case 2:return a.trys.push([2,5,,8]),[4,le.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:ce.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},$.SYNC_MESSAGE_CHANGELOGS)];case 3:return t=a.sent(),n=t.hasMore,r=t.token,e.hasNext=n,e.nextToken=r,this._metadata.token=r,o.debug("message changelog sync progress",e),[4,this.saveMetadata()];case 4:return a.sent(),[3,8];case 5:return s=a.sent(),o.debug("message changelog sync error",s),s instanceof Q&&s.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:a.sent(),a.label=7;case 7:throw s;case 8:return[2,e]}}))}))}))}return e.of=function(t,n){if(_r[t]||(_r[t]={}),!_r[t][n.url]){var r=_r[t][n.url]=new e({_iid:t,channel:n});W.of(t).dispatcher.on((function(e){if(e instanceof oe)if(e.stateType===ue.CONNECTED)r.resume();else r.pause()}))}return _r[t][n.url]},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){switch(s.label){case 0:return this._metadata?[3,2]:(e=W.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=s.sent(),this._metadata={token:r?r.token:n/1e3},s.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return this._metadata?[4,W.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,W.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},e.prototype.resume=function(){W.of(this._iid).logger.debug("message changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){W.of(this._iid).logger.debug("message changelog sync pause()"),this._sync.stop()},e}(),vr=function(t){function n(e){var n,r,s,i,o,u,l=this;return(l=t.call(this)||this).method=D.GET,l.path="".concat(he(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),l.params=a({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(n=e.threshold)&&void 0!==n?n:null,reverse:!0,custom_types:null!==(r=e.customTypes)&&void 0!==r?r:["*"],message_type:null!==(s=e.messageType)&&void 0!==s?s:null,include_reactions:null===(i=e.includeReactions)||void 0===i||i,with_sorted_meta_array:null===(o=e.includeMetaArray)||void 0===o||o,show_subchannel_messages_only:null!==(u=e.showSubchannelMessagesOnly)&&void 0!==u&&u,include_poll_details:!0}),l}return e(n,t),n}(P),gr=function(t){function n(e,n){var r,s,i,a,o=this;return(o=t.call(this,e,n)||this).isHugeGap=n.is_huge_gap,o.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map((function(t){return de(e,t)})),o.prevHasMore=null!==(s=n.prev_hasmore)&&void 0!==s&&s,o.nextMessages=(null!==(i=n.next_messages)&&void 0!==i?i:[]).map((function(t){return de(e,t)})),o.nextHasmore=null!==(a=n.next_hasmore)&&void 0!==a&&a,o}return e(n,t),n}(O),yr=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},Er=function(e,t,n){if(e.length>0){var r=yr(e,t);if(r<0){for(var s=0,i=e.length-1,a=Math.floor((s+i)/2);s<i;){var o=Cr(e[a],t,n);if(o>0)i=a,a=Math.floor((s+i)/2);else{if(!(o<0))return{place:a,contains:e[a].isIdentical(t)};s=a+1,a=Math.floor((s+i)/2)}}return{place:Cr(e[a],t,n)>0?a:a+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},Cr=function(e,t,n){switch(n){case De.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?t.lastMessage.createdAt-e.lastMessage.createdAt:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case De.CHRONOLOGICAL:return t.createdAt-e.createdAt;case De.CHANNEL_NAME_ALPHABETICAL:return e.name.localeCompare(t.name)}},Nr=function(e,t){return t instanceof L?e.findIndex((function(e){return e instanceof L&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},br=function(e,t){return e.findIndex((function(e){return e.messageId===t}))},Mr=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,s=Math.floor((n+r)/2);n<r;){var i=e[s].createdAt-t.createdAt;if(i>0)r=s,s=Math.floor((n+r)/2);else{if(!(i<0))return s;n=s+1,s=Math.floor((n+r)/2)}}return e[s].createdAt>t.createdAt?s:s+1}return e.length},Tr={},Sr=function(){function e(e){var t=e._iid,n=e.channel,r=e.hasPollMessage,s=this;this._sync=null,this._metadata=null,this._iid=t,this._channel=n;var i,a,o=W.of(this._iid),u=o.logger,l=o.sdkState;this._metadataKey=(i=l.userId,a=n.url,"sendbird:".concat(i,"@groupchannel/").concat(a,"/poll/changelogs.meta"));var c=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(l.userId,this._channel.url);this._sync=new cr(c,(function(){return p(s,void 0,void 0,(function(){var e,t,n,s,i,a,o,l;return _(this,(function(c){switch(c.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return c.sent(),u.debug("poll changelog sync from",null===(l=this._metadata)||void 0===l?void 0:l.token),(t=!this._metadata||!this._metadata.token)?[4,r()]:[3,3];case 2:t=!c.sent(),c.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];this._metadata||(n=W.of(this._iid).firstConnectedAt,this._metadata={token:n/1e3}),c.label=4;case 4:return c.trys.push([4,7,,10]),[4,je.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return s=c.sent(),i=s.hasMore,a=s.token,e.hasNext=i,e.nextToken=a,this._metadata.token=a,u.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return c.sent(),[3,10];case 7:return o=c.sent(),u.debug("poll changelog sync error",o),o instanceof Q&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:c.sent(),c.label=9;case 9:throw o;case 10:return[2,e]}}))}))}))}return e.of=function(t,n,r){if(Tr[t]||(Tr[t]={}),!Tr[t][n.url]){var s=Tr[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r});W.of(t).dispatcher.on((function(e){if(e instanceof oe)if(e.stateType===ue.CONNECTED)s.resume();else s.pause()}))}return Tr[t][n.url]},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e;return _(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,W.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{token:e.token}:null,t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return this._metadata?[4,W.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,W.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},e.prototype.resume=function(){W.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){W.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e}();!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api"}(lr||(lr={}));var Ur,Ar,Ir,wr=function(){function e(){}return e.prototype._invokeResponse=function(e,t,n){var r=this;Z((function(){return p(r,void 0,void 0,(function(){return _(this,(function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),Lr=function(){function e(e,t){var n=t.channel,r=t.filter,s=t.startingPoint,i=t.limit,a=this;this._channel=null,this._messages=[],this._unsentMessages=[],this._readReceiptMap=new Map,this._deliveryReceiptMap=new Map,this._iid=e,this._key="mc-".concat(se()),this.filter=null!=r?r:new Qe,this._channel=n,this._syncRange=new nr({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint=s||Date.now()+6e5,this._limit=i||Be;var o=sr.of(this._iid);o.subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n,r,s,i,o=yr(e,a._channel);if(o>=0)switch(Z((function(){return p(a,void 0,void 0,(function(){var n;return _(this,(function(r){return n=new hr(t),this._channel=e[o],this._handler.onChannelUpdated(n,this.channel),[2]}))}))})),t){case $t.EVENT_CHANNEL_UPDATED:var u=!1;for(var l in a._messages){if((g=a._messages[l]).createdAt>=a._channel.messageOffsetTimestamp){u=!0;var c=parseInt(l);if(c>0){var h=a._messages.splice(0,c);a._removeMessagesFromView(h.map((function(e){return e.messageId})),$.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!u&&a._messages.length>0&&a._removeMessagesFromView(a._messages.map((function(e){return e.messageId})),$.EVENT_MESSAGE_OFFSET_UPDATED);break;case $t.EVENT_CHANNEL_READ:var d=[];try{for(var f=m(a._messages),v=f.next();!v.done;v=f.next()){var g=v.value;if((C=a._readReceiptMap.get(g.messageId))>0)C!==a._channel.getUnreadMemberCount(g)&&d.push(g)}}catch(e){n={error:e}}finally{try{v&&!v.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}d.length>0&&a._updateMessagesToView(d,$.EVENT_MESSAGE_READ);break;case $t.EVENT_CHANNEL_DELIVERED:d=[];try{for(var y=m(a._messages),E=y.next();!E.done;E=y.next()){var C;g=E.value;if((C=a._deliveryReceiptMap.get(g.messageId))>0)C!==a._channel.getUndeliveredMemberCount(g)&&d.push(g)}}catch(e){s={error:e}}finally{try{E&&!E.done&&(i=y.return)&&i.call(y)}finally{if(s)throw s.error}}d.length>0&&a._updateMessagesToView(d,$.EVENT_MESSAGE_READ)}},onRemove:function(e,t){e.indexOf(a.channel.url)>=0&&Z((function(){return p(a,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new hr(t),this._handler.onChannelDeleted(e,this.channel.url),[2]}))}))}))}}),o.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,r,s=[],i=[];try{for(var o=m(e),u=o.next();!u.done;u=o.next()){var l=u.value;l.channelUrl===a._channel.url&&(a.filter.match(l)?s.push(l):i.push(l.messageId))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}if(pe(t)){if(s.length>0)switch(t){case $.EVENT_MESSAGE_SENT_FAILED:case $.EVENT_MESSAGE_SENT_SUCCESS:case $.EVENT_MESSAGE_UPDATED:case $.EVENT_MESSAGE_THREADINFO_UPDATED:case $.EVENT_MESSAGE_REACTION_UPDATED:case $.SYNC_MESSAGE_CHANGELOGS:a._updateMessagesToView(s,t);break;case $.EVENT_MESSAGE_SENT_PENDING:case $.EVENT_MESSAGE_RECEIVED:case $.SYNC_MESSAGE_FILL:a._addMessagesToView(s,t)}i.length>0&&a._removeMessagesFromView(i,t)}},onRemove:function(e,t){a._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){a._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){a._updatePollsToView(e,t)},onPollUpdate:function(e,t){a._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){a._applyPollVoteEventToView(e,t)}});var u=W.of(this._iid).cacheContext;!this._channel.isSuper&&u.localCacheEnabled&&pr.of(this._iid,this._channel).resume(),mr.of(this._iid,this._channel).resume(),Sr.of(this._iid,this._channel,this._hasPollMessage.bind(this)).resume(),this._prevFill=new cr(this._key,(function(e){return p(a,void 0,void 0,(function(){var t,n;return _(this,(function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._limit,source:$.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.min.apply(Math,d([],f(t.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(n),[2,{hasNext:t.length>=this._limit&&this.viewTop<n,nextToken:this._syncRange.top}]):[2,{hasNext:!1,nextToken:0}]}}))}))})),this._nextFill=new cr(this._key,(function(e){return p(a,void 0,void 0,(function(){var t,n;return _(this,(function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._limit,source:$.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.max.apply(Math,d([],f(t.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(n),[2,{hasNext:!(t.length>=this._limit&&this._hasNext)||this.viewBottom>n,nextToken:this._syncRange.bottom}]):[2,{hasNext:!1,nextToken:0}]}}))}))}));var l=W.of(this._iid),c=l.dispatcher,h=l.logger;c.on((function(e){if(e instanceof oe)if(e.stateType===ue.CONNECTED)h.debug("check huge gap"),a._checkHugeGap();else a._prevFill.stop(),a._nextFill.stop()}))}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return d([],f(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===fe.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===fe.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,d(d([],f(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,d(d([],f(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype.setMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){return e},e.prototype._addMessagesToView=function(e,t){var n,r,s=this,i=this._filterUnderOffsetMessage(e),a=[],o=[];try{for(var u=m(i),l=u.next();!l.done;l=u.next()){var c=l.value;if(t===$.SYNC_MESSAGE_FILL){if(c.messageId>0){if((y=Nr(this._messages,c))<0){Nr(this._unsentMessages,c)<0&&a.push(c);var h=Mr(this._messages,c);this._messages.splice(h,0,c)}this._readReceiptMap.set(c.messageId,this._channel.getUnreadMemberCount(c)),this._deliveryReceiptMap.set(c.messageId,this._channel.getUndeliveredMemberCount(c))}else if(c instanceof L){(y=Nr(this._unsentMessages,c))<0&&Nr(this._messages,c)<0&&(this._unsentMessages.push(c),a.push(c))}}else if(c.messageId>0){if((y=Nr(this._messages,c))<0){var v=Nr(this._unsentMessages,c);v<0?a.push(c):(this._unsentMessages.splice(v,1),o.push(c));h=Mr(this._messages,c);this._messages.splice(h,0,c)}else o.push(c),this._messages[y]=c;if(this._readReceiptMap.set(c.messageId,this._channel.getUnreadMemberCount(c)),this._deliveryReceiptMap.set(c.messageId,this._channel.getUndeliveredMemberCount(c)),c.updatedAt>0){var g=this._updateChildMessagesInView(c);o.push.apply(o,d([],f(g),!1))}}else if(c instanceof L){var y;(y=Nr(this._unsentMessages,c))<0?Nr(this._messages,c)<0&&(this._unsentMessages.push(c),a.push(c)):(o.push(c),this._unsentMessages[y]=c)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}pe(t)&&Z((function(){return p(s,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new dr(t),a.length>0&&this._handler.onMessagesAdded(e,this.channel,a),o.length>0&&this._handler.onMessagesUpdated(e,this.channel,o),[2]}))}))}))},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach((function(n){n.applyParentMessage(e)&&t.push(n)})),t},e.prototype._updatePollsToView=function(e,t){var n,r,s=this,i=[];try{for(var a=m(e),o=a.next();!o.done;o=a.next()){var u=o.value,l=br(this._messages,u.messageId);if(l>=0){var c=this._messages[l];c&&c.applyPoll(u),i.push(c)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i.length>0&&pe(t)&&Z((function(){return p(s,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new dr(t),i.length>0&&this._handler.onMessagesUpdated(e,this.channel,i),[2]}))}))})),i},e.prototype._applyPollUpdateEventToView=function(e,t){var n=this,r=br(this._messages,e.messageId);if(r>=0){var s=this._messages[r];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollUpdateEvent(e)&&pe(t)&&Z((function(){return p(n,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new dr(t),this._handler.onMessagesUpdated(e,this.channel,[s]),[2]}))}))}))}},e.prototype._applyPollVoteEventToView=function(e,t){var n=this,r=br(this._messages,e.messageId);if(r>=0){var s=this._messages[r];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollVoteEvent(e)&&pe(t)&&Z((function(){return p(n,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new dr(t),this._handler.onMessagesUpdated(e,this.channel,[s]),[2]}))}))}))}},e.prototype._updateMessagesToView=function(e,t){var n,r,s=this,i=[];try{for(var a=m(e),o=a.next();!o.done;o=a.next()){var u,l=o.value;if(l.messageId>0)if((u=Nr(this._messages,l))>=0)i.push(l),this._messages[u]=l;else{var c=Nr(this._unsentMessages,l);if(c>=0){i.push(l),this._unsentMessages.splice(c,1);var h=Mr(this._messages,l);this._messages.splice(h,0,l)}}else if(l instanceof L)(u=Nr(this._unsentMessages,l))>=0&&(i.push(l),this._unsentMessages[u]=l)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return pe(t)&&Z((function(){return p(s,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new dr(t),i.length>0&&this._handler.onMessagesUpdated(e,this.channel,i),[2]}))}))})),i},e.prototype._removeMessagesFromView=function(e,t){var n,r,s=this,i=[],a=function(e){var t=o._messages.findIndex((function(t){return t.messageId===e}));t>=0&&(i.push(o._messages[t].messageId),o._messages.splice(t,1))},o=this;try{for(var u=m(e),l=u.next();!l.done;l=u.next()){a(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return pe(t)&&i.length>0&&Z((function(){return p(s,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new dr(t),i.length>0&&this._handler.onMessagesDeleted(e,this.channel,i),[2]}))}))})),i},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,s=t.nextLimit,i=void 0===s?0:s;return p(this,void 0,void 0,(function(){var t,n,s,a,o,u,l;return _(this,(function(c){switch(c.label){case 0:return t=sr.of(this._iid),r>0?[4,t.getMessagesFromCache(this._channel.url,e,"prev",this.filter,this._limit)]:[3,2];case 1:return s=c.sent(),[3,3];case 2:s=[],c.label=3;case 3:return n=s,i>0?[4,t.getMessagesFromCache(this._channel.url,e,"next",this.filter,this._limit)]:[3,5];case 4:return o=c.sent(),[3,6];case 5:o=[],c.label=6;case 6:if(a=o,n.length>0&&a.length)for(l in u=n.map((function(e){return e.messageId})),a)if(u.includes(a[l].messageId)){a.splice(parseInt(l),1);break}return[2,d(d([],f(n),!1),f(a),!1).sort((function(e,t){return t.createdAt-e.createdAt}))]}}))}))},e.prototype._getRemoteMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,s=t.nextLimit,i=void 0===s?0:s,a=t.source,u=void 0===a?$.REQUEST_MESSAGE:a,l=t.reverse,c=void 0!==l&&l;return p(this,void 0,void 0,(function(){var t,n;return _(this,(function(s){switch(s.label){case 0:return t=le.of(this._iid),r>0||i>0?[4,t.getMessagesByTimestamp(this._channel.url,this._channel.channelType,e,o(o({},this.filter),{reverse:c,prevResultSize:r,nextResultSize:i,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),u)]:[3,2];case 1:return n=s.sent(),[3,3];case 2:n=[],s.label=3;case 3:return[2,n]}}))}))},e.prototype._checkHugeGap=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i,a,u,l,c,h=this;return _(this,(function(m){switch(m.label){case 0:return this._messages.length>0?(e=this.viewTop,t=this._syncRange.top,n=this._syncRange.bottom,r=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,(s=sr.of(this._iid)).getCachedMessageCountBetween(this._channel.url,this.filter,e,t)]):[3,4];case 1:return i=m.sent(),[4,s.getCachedMessageCountBetween(this._channel.url,this.filter,n,r)];case 2:return a=m.sent(),[4,_e((function(){return p(h,void 0,void 0,(function(){var s,u,l,c,h,m,v,g,y,E,C,N,b,M,T,S,U,A=this;return _(this,(function(I){switch(I.label){case 0:return s=W.of(this._iid),u=s.dispatcher,l=s.requestQueue,c=new vr(o({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:e,prevEnd:t,prevCount:i,nextStart:n,nextEnd:r,nextCount:a},this.filter)),[4,l.send(c)];case 1:return h=I.sent(),m=h.as(gr),v=m.isHugeGap,g=m.prevMessages,y=void 0===g?[]:g,E=m.prevHasMore,C=m.nextMessages,N=void 0===C?[]:C,b=m.nextHasmore,v?Z((function(){return p(A,void 0,void 0,(function(){return _(this,(function(e){return this._handler.onHugeGapDetected(),[2]}))}))})):(this._hasPrevious=E,this._hasNext=b,M=this.viewTop,T=this.viewBottom,S=Math.min.apply(Math,d([Number.MAX_SAFE_INTEGER],f(y.map((function(e){return e.createdAt}))),!1)),U=Math.max.apply(Math,d([0],f(N.map((function(e){return e.createdAt}))),!1)),u.dispatch(new w({messages:y,source:$.SYNC_MESSAGE_FILL})),u.dispatch(new w({messages:N,source:$.SYNC_MESSAGE_FILL})),this._syncRange.extends(S,U),M<S&&this._prevFill.start(S),T>U&&this._nextFill.start(U)),[2]}}))}))}),1)];case 3:return m.sent(),[3,6];case 4:return u=Math.floor(this._limit/2),[4,this._getRemoteMessages(Date.now(),{prevLimit:u,nextLimit:u,source:$.SYNC_MESSAGE_FILL})];case 5:(l=m.sent()).length>0&&((c=this._syncRange).extends.apply(c,d([],f(l.map((function(e){return e.createdAt}))),!1)),l.length<u&&(this._hasPrevious=!1,this._hasNext=!1)),m.label=6;case 6:return[2]}}))}))},e.prototype._loadUnsentMessages=function(){return p(this,void 0,void 0,(function(){var e,t;return _(this,(function(n){switch(n.label){case 0:return e=sr.of(this._iid),t=this,[4,e.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return t._unsentMessages=n.sent(),[2]}}))}))},e.prototype._hasPollMessage=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,sr.of(this._iid).getPollMessagesFromCache(this._channel.url,Date.now()+6e5,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}}))}))},e.prototype.initialize=function(e){var t=this,n=new wr;this._messages=[],this._unsentMessages=[],this._syncRange=new nr({}),this._hasNext=!0,this._hasPrevious=!0;var r=Math.floor(this._limit/2);if(e===lr.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:r,nextLimit:r}).then((function(e){return p(t,void 0,void 0,(function(){var t;return _(this,(function(r){switch(r.label){case 0:return t=this._filterUnderOffsetMessage(e),this._addMessagesToView(t,$.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return r.sent(),n._invokeResponse("local",null,t),[2]}}))}))})).catch((function(e){if(X(e))throw e;n._invokeResponse("local",e,null)})).finally((function(){t._getRemoteMessages(t._startingPoint,{prevLimit:r,nextLimit:r,reverse:!0}).then((function(e){var s;t._messages=[];var i=t._filterUnderOffsetMessage(e);i.length<r&&(t._hasPrevious=!1,t._hasNext=!1),i.length>0&&((s=t._syncRange).extends.apply(s,d([],f(i.map((function(e){return e.createdAt}))),!1)),t._addMessagesToView(i,$.REQUEST_MESSAGE)),n._invokeResponse("remote",null,i)})).catch((function(e){if(X(e))throw e;n._invokeResponse("remote",e,null)}))}));return n},e.prototype.loadPrevious=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s=this;return _(this,(function(i){switch(i.label){case 0:return this._hasPrevious?(e=this.viewTop,t=[],[4,b((function(){return p(s,void 0,void 0,(function(){var n;return _(this,(function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{prevLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}}))}))}))]):[3,5];case 1:return i.sent(),n=pr.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,b((function(){return p(s,void 0,void 0,(function(){var r,s;return _(this,(function(i){switch(i.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{prevLimit:this._limit})];case 1:return t=r.apply(this,[i.sent()]),this._hasPrevious=t.length>=this._limit,t.length>0&&((s=this._syncRange).extends.apply(s,d([],f(t.map((function(e){return e.createdAt}))),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.top)),[2]}}))}))}))];case 2:return i.sent(),this._addMessagesToView(t,$.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=t.length>=this._limit,t.length>0&&((r=this._syncRange).extends.apply(r,d([],f(t.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(t,$.REQUEST_MESSAGE)),i.label=4;case 4:return[2,t];case 5:return[2,[]]}}))}))},e.prototype.loadNext=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s=this;return _(this,(function(i){switch(i.label){case 0:return e=this.viewBottom,t=[],[4,b((function(){return p(s,void 0,void 0,(function(){var n;return _(this,(function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{nextLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}}))}))}))];case 1:return i.sent(),n=pr.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,b((function(){return p(s,void 0,void 0,(function(){var r,s;return _(this,(function(i){switch(i.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{nextLimit:this._limit})];case 1:return t=r.apply(this,[i.sent()]),this._hasNext=t.length>=this._limit,t.length>0&&((s=this._syncRange).extends.apply(s,d([],f(t.map((function(e){return e.createdAt}))),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.bottom)),[2]}}))}))}))];case 2:return i.sent(),this._addMessagesToView(t,$.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=t.length>=this._limit,t.length>0&&((r=this._syncRange).extends.apply(r,d([],f(t.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(t,$.REQUEST_MESSAGE)),i.label=4;case 4:return[2,t]}}))}))},e.prototype.removeFailedMessage=function(e){return p(this,void 0,void 0,(function(){var t;return _(this,(function(n){switch(n.label){case 0:return[4,sr.of(this._iid).removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},e.prototype.dispose=function(){W.of(this._iid).cacheContext.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop(),pr.of(this._iid,this._channel).pause()),mr.of(this._iid,this._channel).pause(),Sr.of(this._iid,this._channel,this._hasPollMessage.bind(this)).pause();var e=sr.of(this._iid);e.unsubscribeGroupChannelEvent(this._key),e.unsubscribeMessageEvent(this._key)},e}(),Dr={coverUrl:null,coverImage:null,isDistinct:null,isPublic:null,isDiscoverable:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},Rr={hidePreviousMessages:!1,allowAutoUnhide:!0},Pr=function(t){function n(e){var n=this,r=e.channelUrl,s=e.token,i=e.limit,a=e.order,o=e.mutedMemberFilter,u=e.memberStateFilter,l=e.nicknameStartsWithFilter,c=e.operatorFilter;return(n=t.call(this)||this).method=D.GET,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/members"),n.params={token:s,limit:i,order:a,muted_member_filter:o,member_state_filter:u,nickname_startswith:l,operator_filter:c,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return e(n,t),n}(P),Or=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.members=[];var s=n.next,i=n.members;return r.token=s,i&&i.length>0&&(r.members=i.map((function(t){return new qt(e,t)}))),r}return e(n,t),n}(O);!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(Ur||(Ur={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(Ar||(Ar={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(Ir||(Ir={}));var kr=function(n){function r(e,t,r){var s,i,a,o,l=this;return(l=n.call(this,e,t,u.GROUP,r)||this).mutedMemberFilter=Ur.ALL,l.memberStateFilter=Ir.ALL,l.nicknameStartsWithFilter=null,l.operatorFilter=Ht.ALL,l.order=Ar.MEMBER_NICKNAME_ALPHABETICAL,l.mutedMemberFilter=null!==(s=r.mutedMemberFilter)&&void 0!==s?s:Ur.ALL,l.memberStateFilter=null!==(i=r.memberStateFilter)&&void 0!==i?i:Ir.ALL,l.nicknameStartsWithFilter=null!==(a=r.nicknameStartsWithFilter)&&void 0!==a?a:null,l.order=null!==(o=r.order)&&void 0!==o?o:Ar.MEMBER_NICKNAME_ALPHABETICAL,l}return e(r,n),r.prototype._validate=function(){return n.prototype._validate.call(this)&&t(Ur,this.mutedMemberFilter)&&t(Ir,this.memberStateFilter)&&(g("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&t(Ht,this.operatorFilter)&&t(Ar,this.order)},r.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=W.of(this._iid).requestQueue,t=new Pr(o(o({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=a.sent(),r=n.as(Or),s=r.members,i=r.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw Q.queryInProgress;case 4:return[3,6];case 5:throw Q.invalidParameters;case 6:return[2]}}))}))},r}(me),Fr=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,i=e.accessCode;return(n=t.call(this)||this).method=D.PUT,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:s,access_code:i},n}return e(n,t),n}(P),xr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new ys(e,n),r.channel.myMemberState=Rt.JOINED,r}return e(n,t),n}(O),Hr=function(t){function n(e){var n=this,r=e.channelUrl,s=e.isDistinct,i=e.isPublic,o=e.isDiscoverable,u=e.coverUrl,l=e.coverImage,c=e.accessCode,h=e.name,d=e.data,f=e.customType,p=e.operatorUserIds,_=e.messageSurvivalSeconds;return(n=t.call(this)||this).method=D.PUT,n.path="".concat(F,"/").concat(encodeURIComponent(r)),n.params=a({is_distinct:s,is_public:i,is_discoverable:o,name:h,data:d,custom_type:f,cover_url:u,cover_file:l,access_code:c,operator_ids:p,message_survival_seconds:_}),n}return e(n,t),n}(P),Vr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new ys(e,n),r}return e(n,t),n}(O),Gr=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=D.DELETE,n.path="".concat(F,"/").concat(encodeURIComponent(r)),n}return e(n,t),n}(P);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(O);var qr=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=D.DELETE,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/hide"),n}return e(n,t),n}(P);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(O);var Kr=function(t){function n(e){var n=e.userId,r=e.channelUrl,s=e.countPreference,i=t.call(this)||this;return i.method=D.PUT,i.path="".concat(R,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),i.params={count_preference:s},i}return e(n,t),n}(P),Br=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.countPreference=ps[n.count_preference],r}return e(n,t),n}(O),jr=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=D.PUT,n.path="".concat(F,"/").concat(encodeURIComponent(r),"/reset_user_history"),n}return e(n,t),n}(P),Qr=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return e(n,t),n}(O),zr=o(o({},vt),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),Wr=o(o({},yt),{scheduledAt:null}),Yr=function(t){function n(e){var n,r=this;r=t.call(this)||this;var s=[];e.mentionType===ve.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((function(e){return e.userId}))));var i=e.channelType,a=e.channelUrl,o=e.scheduledMessageId;return r.method=D.PUT,r.path="".concat(he(i),"/").concat(encodeURIComponent(a),"/scheduled_messages/").concat(encodeURIComponent(o)),r.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:ge.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return ye.payloadify(e)})):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(n=e.metaArrays)||void 0===n?void 0:n.map((function(e){return Ee.payloadify(e)})),apple_critical_alert_options:Ce.payloadify(e.appleCriticalAlertOptions),push_option:e.pushNotificationDeliveryOption},r}return e(n,t),n}(P),Jr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new J(e,n),r}return e(n,t),n}(O),Xr=function(t){function n(e){var n,r=this;r=t.call(this)||this;var s=[];e.mentionType===ve.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((function(e){return e.userId}))));var i=e.channelType,a=e.channelUrl,o=e.scheduledMessageId;return r.method=D.PUT,r.path="".concat(he(i),"/").concat(encodeURIComponent(a),"/scheduled_messages/").concat(encodeURIComponent(o)),r.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:ge.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(n=e.metaArrays)||void 0===n?void 0:n.map((function(e){return Ee.payloadify(e)})),apple_critical_alert_options:Ce.payloadify(e.appleCriticalAlertOptions),target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption},r}return e(n,t),n}(P);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new Y(e,n),r}e(n,t)}(O);var Zr=function(t){function n(e){var n=t.call(this)||this,r=e.channelType,s=e.channelUrl,i=e.scheduledMessageId;return n.method=D.DELETE,n.path="".concat(he(r),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(i)),n}return e(n,t),n}(P),$r=function(t){function n(e){var n=t.call(this)||this,r=e.channelType,s=e.channelUrl,i=e.scheduledMessageId;return n.method=D.POST,n.path="".concat(he(r),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(i),"/send_now"),n}return e(n,t),n}(P),es=function(t){function n(e){var n=e.userId,r=e.channelUrl,s=e.pushTriggerOption,i=t.call(this)||this;return i.method=D.PUT,i.path="".concat(R,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),i.params={push_trigger_option:s},i}return e(n,t),n}(P),ts=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return e(n,t),n}(O),ns=function(t){function n(e){var n=e.userId,r=e.channelUrl,s=t.call(this)||this;return s.method=D.GET,s.path="".concat(R,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),s}return e(n,t),n}(P),rs=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return e(n,t),n}(O),ss=function(t){function n(e){var n=e.pollId,r=e.title,s=e.data,i=e.allowUserSuggestion,a=e.allowMultipleVotes,o=e.closeAt,u=t.call(this)||this;return u.method=D.PUT,u.path="".concat(be,"/").concat(encodeURIComponent(n)),u.params={title:r,data:s,allow_user_suggestion:i,allow_multiple_votes:a,close_at:o},u}return e(n,t),n}(P),is=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new Me(e,n),r}return e(n,t),n}(O),as=function(t){function n(e){var n=e.pollId,r=t.call(this)||this;return r.method=D.DELETE,r.path="".concat(be,"/").concat(encodeURIComponent(n)),r}return e(n,t),n}(P);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(O);var os=function(t){function n(e){var n=e.pollId,r=t.call(this)||this;return r.method=D.PUT,r.path="".concat(be,"/").concat(encodeURIComponent(n),"/close"),r}return e(n,t),n}(P),us=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new Me(e,n),r}return e(n,t),n}(O),ls=function(t){function n(e){var n=e.channelUrl,r=e.channelType,s=e.pollId,i=e.optionText,a=t.call(this)||this;return a.method=D.POST,a.path="".concat(be,"/").concat(encodeURIComponent(s),"/options"),a.params={channel_url:n,channel_type:r,text:i},a}return e(n,t),n}(P),cs=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new Me(e,n),r}return e(n,t),n}(O),hs=function(t){function n(e){var n=e.pollId,r=e.pollOptionId,s=e.optionText,i=t.call(this)||this;return i.method=D.PUT,i.path="".concat(be,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),i.params={text:s},i}return e(n,t),n}(P),ds=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new Me(e,n),r}return e(n,t),n}(O),fs=function(t){function n(e){var n=e.pollId,r=e.pollOptionId,s=t.call(this)||this;return s.method=D.DELETE,s.path="".concat(be,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),s}return e(n,t),n}(P);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(O);var ps,_s,ms,vs=function(t){function n(e){var n=e.reqId,r=e.channelType,s=e.channelUrl,i=e.pollId,o=e.pollOptionIds;return t.call(this,{code:"VOTE",ackRequired:!0,payload:a({req_id:n,channel_type:r===u.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:i,option_ids:o})})||this}return e(n,t),n}(V);!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(ps||(ps={})),function(e){e.MUTED="muted",e.UNMUTED="unmuted"}(_s||(_s={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(ms||(ms={}));var gs,ys=function(r){function s(e,s){var i,a,c,h,p,_,m,v,y,E,C,N,b,M,T,S,U,A,I=this;return(I=r.call(this,e,s)||this)._unreadMemberStateMap=new Map,I._undeliveredMemberStateMap=new Map,I._typingStatus=new Map,I._lastMemberCountUpdated=0,I._typingStarted=0,I._typingEnded=0,I.isDistinct=!1,I.isSuper=!1,I.isBroadcast=!1,I.isExclusive=!1,I.isPublic=!1,I.isDiscoverable=!0,I.isAccessCodeRequired=!1,I.isPushEnabled=!1,I.unreadMessageCount=0,I.unreadMentionCount=0,I.members=[],I.memberCount=0,I.joinedMemberCount=0,I.hiddenState=ms.UNHIDDEN,I.lastMessage=null,I.messageOffsetTimestamp=0,I.messageSurvivalSeconds=-1,I.myMemberState=Rt.NONE,I.myRole=n.NONE,I.myMutedState=_s.UNMUTED,I.myLastRead=0,I.myCountPreference=ps.ALL,I.myPushTriggerOption=et.DEFAULT,I.inviter=null,I.invitedAt=0,I.joinedAt=0,I.channelType=u.GROUP,I.isDistinct=null!==(a=s.is_distinct)&&void 0!==a&&a,I.isSuper=null!==(c=s.is_super)&&void 0!==c&&c,I.isBroadcast=null!==(h=s.is_broadcast)&&void 0!==h&&h,I.isExclusive=null!==(p=s.is_exclusive)&&void 0!==p&&p,I.isPublic=null!==(_=s.is_public)&&void 0!==_&&_,I.isDiscoverable=null!==(m=s.is_discoverable)&&void 0!==m?m:I.isPublic,I.isAccessCodeRequired=null!==(v=s.is_access_code_required)&&void 0!==v&&v,I.isPushEnabled=null!==(y=s.is_push_enabled)&&void 0!==y&&y,Array.isArray(s.members)&&(i=I.members).push.apply(i,d([],f(s.members.map((function(e){return new qt(I._iid,e)}))),!1)),I.memberCount=null!==(E=s.member_count)&&void 0!==E?E:0,I.joinedMemberCount=null!==(C=s.joined_member_count)&&void 0!==C?C:0,I.hiddenState=t(ms,s.hidden_state)?s.hidden_state:ms.UNHIDDEN,I.messageOffsetTimestamp=null!==(N=s.ts_message_offset)&&void 0!==N?N:0,I.messageSurvivalSeconds=null!==(b=s.message_survival_seconds)&&void 0!==b?b:-1,I.lastMessage=s.last_message?de(I._iid,o({channel_type:I.channelType},s.last_message)):null,s.read_receipt&&Object.keys(s.read_receipt).forEach((function(e){g("number",s.read_receipt[e])&&I._updateUnreadMemberState(e,s.read_receipt[e])})),s.delivery_receipt&&Object.keys(s.delivery_receipt).forEach((function(e){g("number",s.delivery_receipt[e])&&I._updateUndeliveredMemberState(e,s.delivery_receipt[e])})),I.myMemberState=t(Rt,s.member_state)?s.member_state:Rt.NONE,I.myRole=t(n,s.my_role)?s.my_role:n.NONE,t(_s,s.is_muted)?I.myMutedState=s.is_muted:g("boolean",s.is_muted)?I.myMutedState=s.is_muted?_s.MUTED:_s.UNMUTED:I.myMutedState=_s.UNMUTED,I.myCountPreference=t(ps,s.count_preference)?s.count_preference:ps.ALL,I.myPushTriggerOption=t(et,s.push_trigger_option)?s.push_trigger_option:et.ALL,I.myLastRead=null!==(M=s.user_last_read)&&void 0!==M?M:0,I.inviter=s.inviter?new l(I._iid,s.inviter):null,I.invitedAt=null!==(T=s.invited_at)&&void 0!==T?T:0,I.joinedAt=null!==(S=s.joined_ts)&&void 0!==S?S:0,I._updateUnreadCount(null!==(U=s.unread_message_count)&&void 0!==U?U:0,null!==(A=s.unread_mention_count)&&void 0!==A?A:0),I}return e(s,r),Object.defineProperty(s.prototype,"isHidden",{get:function(){return this.hiddenState!==ms.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isTyping",{get:function(){return Object.keys(this._typingStatus).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=m(this._unreadMemberStateMap),s=r.next();!s.done;s=r.next()){var i=f(s.value,2),a=i[0],o=i[1];n[a]=o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=m(this._undeliveredMemberStateMap),s=r.next();!s.done;s=r.next()){var i=f(s.value,2),a=i[0],o=i[1];n[a]=o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),s.payloadify=function(e){return e?a(o(o({},r.payloadify.call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return qt.payloadify(e)})),last_message:Te(e.lastMessage),inviter:e.inviter?l.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt})):null},s.prototype._shouldUpdateLastMessageWith=function(e){return!(e instanceof L&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)},s.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===ps.ALL||this.myCountPreference===ps.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var n=W.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===ps.ALL||this.myCountPreference===ps.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},s.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),W.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},s.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);(!n||n<t)&&this._undeliveredMemberStateMap.set(e,t)},s.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus[e.userId]={user:e,ts:t}:delete this._typingStatus[e.userId]},s.prototype._invalidateTypingStatus=function(){var e=(new Date).getTime(),t=!1;for(var n in this._typingStatus){e-this._typingStatus[n].ts>=1e4&&(delete this._typingStatus[n],t=!0)}return t},s.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},s.prototype.isReadMessage=function(e){var t=W.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt},s.prototype.serialize=function(){var e=this;return B(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))},s.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new Lr(this._iid,o({channel:this},e))},s.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new kr(this._iid,this.url,e)},s.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex((function(t){return t.userId===e.userId}));if(n>-1){var r=this.members[n];r.state===Rt.JOINED&&(e.state=r.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},s.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=this.members.findIndex((function(t){return t.userId===e.userId}));if(t>-1)return this.members.splice(t,1),this.memberCount--,!0}return!1},s.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof L&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=W.of(this._iid).sdkState,s=e.createdAt,i=0;try{for(var a=m(this.members),o=a.next();!o.done;o=a.next()){var u=o.value;if(r.userId!==u.userId&&u.state===Rt.JOINED&&e.sender.userId!==u.userId)(this.cachedUnreadMemberState[u.userId]||0)<s&&i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}return 0},s.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof L&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=W.of(this._iid).sdkState,s=e.createdAt,i=0;try{for(var a=m(this.members),o=a.next();!o.done;o=a.next()){var u=o.value;if(r.userId!==u.userId&&u.state===Rt.JOINED&&e.sender.userId!==u.userId)(this.cachedUndeliveredMemberState[u.userId]||0)<s&&i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}return 0},s.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=W.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=e instanceof L?e.sender:null,i=[];return this.members.forEach((function(a){(t||a.userId!==r.userId&&a.userId!==(null==s?void 0:s.userId))&&(n._unreadMemberStateMap.get(a.userId)>=e.createdAt&&i.push(a))})),i},s.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=W.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=e instanceof L?e.sender:null,i=[];return this.members.forEach((function(a){(t||a.userId!==r.userId&&a.userId!==(null==s?void 0:s.userId))&&(n._unreadMemberStateMap.get(a.userId)<e.createdAt&&i.push(a))})),i},s.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=W.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(s){if(e||s.userId!==n.userId){var i=t._unreadMemberStateMap.get(s.userId);r[s.userId]=new Kt(t._iid,{channel_url:t.url,channel_type:t.channelType,user:qt.payloadify(s),ts:i})}})),r},s.prototype.getTypingUsers=function(){var e=[];for(var t in this._typingStatus){var n=this._typingStatus[t].user;e.push(n)}return e},s.prototype.invalidateTypingStatus=function(){var e=W.of(this._iid).typingIndicatorInvalidateTime,t=(new Date).getTime(),n=!1;for(var r in this._typingStatus){t-this._typingStatus[r].ts>=e&&(delete this._typingStatus[r],n=!0)}return n},s.prototype.refresh=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return e=W.of(this._iid),t=e.requestQueue,n=e.dispatcher,r=new hn({channelUrl:this.url}),[4,t.send(r)];case 1:return s=a.sent(),i=s.as(dn).channel,n.dispatch(new sn({channels:[i],source:$t.REQUEST_CHANNEL})),[2,i]}}))}))},s.prototype.freeze=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,r.prototype.freeze.call(this)];case 1:return e.sent(),W.of(this._iid).dispatcher.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_HIDDEN})),[2]}}))}))},s.prototype.unfreeze=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,r.prototype.unfreeze.call(this)];case 1:return e.sent(),W.of(this._iid).dispatcher.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_UNHIDDEN})),[2]}}))}))},s.prototype.updateChannel=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,i,a,u;return _(this,(function(l){switch(l.label){case 0:return t=o(o({},Dr),e),te(function(e){return g("string",e.coverUrl,!0)&&(y(e.coverImage)||g("string",e.coverImage)||null===e.coverImage)&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isDiscoverable,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&v("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)}(t)).throw(Q.invalidParameters),n=W.of(this._iid),r=n.dispatcher,s=n.requestQueue,i=new Hr(o({channelUrl:this.url},t)),[4,s.send(i)];case 1:return a=l.sent(),u=a.as(Vr).channel,r.dispatch(new sn({channels:[u],source:$t.EVENT_CHANNEL_UPDATED})),[2,u]}}))}))},s.prototype.invite=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){return te(e.every((function(e){return e instanceof l}))).throw(Q.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},s.prototype.inviteWithUserIds=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,i,a;return _(this,(function(o){switch(o.label){case 0:return te(v("string",e)).throw(Q.invalidParameters),t=W.of(this._iid),n=t.dispatcher,r=t.requestQueue,s=new Pn({channelUrl:this.url,userIds:e}),[4,r.send(s)];case 1:return i=o.sent(),a=i.as(On).channel,n.dispatch(new sn({channels:[a],source:$t.EVENT_CHANNEL_INVITED})),[2,a]}}))}))},s.prototype.join=function(e){return void 0===e&&(e=null),p(this,void 0,void 0,(function(){var t,n,r,s,i,a,o;return _(this,(function(u){switch(u.label){case 0:return te(g("string",e)||null===e).throw(Q.invalidParameters),t=W.of(this._iid),n=t.dispatcher,r=t.sdkState,s=t.requestQueue,i=new In({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,s.send(i)];case 1:return a=u.sent(),(o=a.as(wn).channel).myMemberState=Rt.JOINED,n.dispatch(new sn({channels:[o],source:$t.EVENT_CHANNEL_JOINED})),[2,this]}}))}))},s.prototype.leave=function(e){return void 0===e&&(e=!1),p(this,void 0,void 0,(function(){var t,n,r,s;return _(this,(function(i){switch(i.label){case 0:return t=W.of(this._iid),n=t.sdkState,r=t.requestQueue,s=new Dn({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,r.send(s)];case 1:return i.sent(),[2]}}))}))},s.prototype.acceptInvitation=function(e){return void 0===e&&(e=null),p(this,void 0,void 0,(function(){var t,n,r,s,i,a,o;return _(this,(function(u){switch(u.label){case 0:return te(g("string",e)||null===e).throw(Q.invalidParameters),t=W.of(this._iid),n=t.dispatcher,r=t.sdkState,s=t.requestQueue,i=new Fr({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,s.send(i)];case 1:return a=u.sent(),(o=a.as(xr).channel).myMemberState=Rt.JOINED,n.dispatch(new sn({channels:[o],source:$t.EVENT_CHANNEL_ACCEPTED_INVITE})),[2,o]}}))}))},s.prototype.declineInvitation=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return e=W.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Fn({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s=a.sent(),(i=s.as(xn).channel).myMemberState=Rt.NONE,[2,i]}}))}))},s.prototype.sendUserMessage=function(e){var t=this,n=new Se,s=W.of(this._iid).dispatcher,i=ze.of(this._iid);return r.prototype.sendUserMessage.call(this,e).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,t){t&&i.completeCurrentAndProcessNextAutoResend(t),n._trigger(e,t)})).onSucceeded((function(e){var r=sr.of(t._iid);i.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),r.handlers.map((function(e){return e.onChannelChanged(t)})),s.dispatch(new sn({channels:[t],source:$t.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},s.prototype.updateUserMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,s,i,a=this;return _(this,(function(o){switch(o.label){case 0:return n=W.of(this._iid).dispatcher,[4,r.prototype.updateUserMessage.call(this,e,t)];case 1:return s=o.sent(),i=!1,!s.silent&&this._shouldUpdateLastMessageWith(s)&&(this.lastMessage=s,i=!0),i&&(sr.of(this._iid).handlers.map((function(e){return e.onChannelChanged(a)})),n.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_UPDATED}))),n.dispatch(new w({messages:[s],source:$.EVENT_MESSAGE_UPDATED})),[2,s]}}))}))},s.prototype._autoResendUserMessage=function(e){var t=this,n=new Se,s=W.of(this._iid).dispatcher,i=ze.of(this._iid);return r.prototype._autoResendUserMessage.call(this,e).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,t){i.completeCurrentAndProcessNextAutoResend(t),n._trigger(e,t)})).onSucceeded((function(e){var r=sr.of(t._iid);i.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),r.handlers.map((function(e){return e.onChannelChanged(t)})),s.dispatch(new sn({channels:[t],source:$t.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},s.prototype.sendFileMessage=function(e){var t=this,n=new Se,s=W.of(this._iid).dispatcher,i=ze.of(this._iid);return r.prototype.sendFileMessage.call(this,e).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,t){t&&i.completeCurrentAndProcessNextAutoResend(t),n._trigger(e,t)})).onSucceeded((function(e){var r=sr.of(t._iid);i.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),r.handlers.map((function(e){return e.onChannelChanged(t)})),s.dispatch(new sn({channels:[t],source:$t.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},s.prototype.updateFileMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,s,i,a=this;return _(this,(function(o){switch(o.label){case 0:return n=W.of(this._iid).dispatcher,[4,r.prototype.updateFileMessage.call(this,e,t)];case 1:return s=o.sent(),i=!1,!s.silent&&this._shouldUpdateLastMessageWith(s)&&(this.lastMessage=s,i=!0),i&&(sr.of(this._iid).handlers.map((function(e){return e.onChannelChanged(a)})),n.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_UPDATED}))),n.dispatch(new w({messages:[s],source:$.EVENT_MESSAGE_UPDATED})),[2,s]}}))}))},s.prototype._autoResendFileMessage=function(e){var t=this,n=new Se,s=W.of(this._iid).dispatcher,i=ze.of(this._iid);return r.prototype._autoResendFileMessage.call(this,e).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),n._trigger(null,e)})).onFailed((function(e,t){i.completeCurrentAndProcessNextAutoResend(t),n._trigger(e,t)})).onSucceeded((function(e){var r=sr.of(t._iid);i.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),r.handlers.map((function(e){return e.onChannelChanged(t)})),s.dispatch(new sn({channels:[t],source:$t.EVENT_MESSAGE_SENT})),n._trigger(null,e)})),n},s.prototype.deleteMessage=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,r.prototype.deleteMessage.call(this,e)];case 1:return t.sent(),0===e.messageId&&e instanceof L&&W.of(this._iid).dispatcher.dispatch(new A({reqId:e.reqId,source:$.EVENT_MESSAGE_DELETED})),[2]}}))}))},s.prototype.hide=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,i,a,u,l;return _(this,(function(c){switch(c.label){case 0:return t=o(o({},Rr),e),te(function(e){return g("boolean",e.hidePreviousMessages)&&g("boolean",e.allowAutoUnhide)}(t)).throw(Q.invalidParameters),n=W.of(this._iid),r=n.dispatcher,s=n.sdkState,i=n.requestQueue,a=new jn(o({channelUrl:this.url,userId:s.userId},t)),[4,i.send(a)];case 1:return u=c.sent(),l=u.as(Qn).messageOffsetTimestamp,this.hiddenState=t.allowAutoUnhide?ms.HIDDEN_ALLOW_AUTO_UNHIDE:ms.HIDDEN_PREVENT_AUTO_UNHIDE,t.hidePreviousMessages&&this._updateUnreadCount(0,0),l&&(this.messageOffsetTimestamp=l),r.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_HIDDEN})),[2,this]}}))}))},s.prototype.unhide=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){switch(s.label){case 0:return e=W.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new qr({channelUrl:this.url}),[4,n.send(r)];case 1:return s.sent(),this.hiddenState=ms.UNHIDDEN,t.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_UNHIDDEN})),[2,this]}}))}))},s.prototype.delete=function(){return p(this,void 0,void 0,(function(){var e,t;return _(this,(function(n){switch(n.label){case 0:return e=W.of(this._iid).requestQueue,t=new Gr({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},s.prototype.markAsRead=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i,a,o=this;return _(this,(function(u){switch(u.label){case 0:return e=W.of(this._iid),t=e.sdkState,n=e.dispatcher,r=e.requestQueue,s=new Vn({channelUrl:this.url}),[4,r.send(s)];case 1:return i=u.sent(),a=i.as(Gn).readStatus,this._updateUnreadMemberState(t.userId,a.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),sr.of(this._iid).handlers.map((function(e){return e.onChannelChanged(o)}))),n.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_READ})),[2]}}))}))},s.prototype.markAsDelivered=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){switch(s.label){case 0:return e=W.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new qn({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s.sent(),[2]}}))}))},s.prototype.startTyping=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s;return _(this,(function(i){return e=W.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n&&(this._typingStarted=r,this._typingEnded=0,s=new Wn({channelUrl:this.url,time:this._typingStarted}),t.send(s)),[2]}))}))},s.prototype.endTyping=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s;return _(this,(function(i){return e=W.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n&&(this._typingStarted=0,this._typingEnded=r,s=new Jn({channelUrl:this.url,time:this._typingStarted}),t.send(s)),[2]}))}))},s.prototype.createScheduledUserMessage=function(e){e=o(o({},We),e),te(Ye(e)).throw(Q.invalidParameters);var t=new Se;return this._createScheduledUserMessage(e,t),t},s.prototype.updateScheduledUserMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return n=o(o({},Wr),t),te(function(e){return Et(e)&&g("number",e.scheduledAt,!0)}(n)).throw(Q.invalidParameters),r=W.of(this._iid).requestQueue,s=new Xr(o({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,r.send(s)];case 1:return i=a.sent(),[2,i.as(Nt).message]}}))}))},s.prototype.createScheduledFileMessage=function(e){var t=this;e=o(o({},Je),e),te(Xe(e)).throw(Q.invalidParameters);var n=Date.now(),r=this._generateRequestId(),s=new Se;return ie(bt).then((function(){var i=t._createPendingScheduledFileMessage(e,r,n);Z((function(){return p(t,void 0,void 0,(function(){return _(this,(function(e){return[2,s._trigger(null,i)]}))}))}))})),y(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return t._createScheduledFileMessage(e,s,r,n)})):this._createScheduledFileMessage(e,s,r,n),s},s.prototype.updateScheduledFileMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s;return _(this,(function(i){switch(i.label){case 0:return n=o(o({},zr),t),te(function(e){return gt(e)&&g("number",e.scheduledAt,!0)&&(y(e.file)||g("string",e.fileUrl))&&g("string",e.fileName,!0)&&g("string",e.mimeType,!0)&&g("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return g("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(n)).throw(Q.invalidParameters),y(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r=new Yr(o({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,W.of(this._iid).requestQueue.send(r)];case 3:return s=i.sent(),[2,s.as(Jr).message]}}))}))},s.prototype.cancelScheduledMessage=function(e){return p(this,void 0,void 0,(function(){var t;return _(this,(function(n){switch(n.label){case 0:return t=new Zr({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,W.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},s.prototype.sendScheduledMessageNow=function(e){return p(this,void 0,void 0,(function(){var t;return _(this,(function(n){switch(n.label){case 0:return t=new $r({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,W.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},s.prototype.getMyPushTriggerOption=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return e=W.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new ns({userId:t.userId,channelUrl:this.url}),[4,n.send(r)];case 1:return s=a.sent(),i=s.as(rs).pushTriggerOption,this.myPushTriggerOption=i,[2,i]}}))}))},s.prototype.setMyPushTriggerOption=function(e){return p(this,void 0,void 0,(function(){var n,r,s,i,a,o;return _(this,(function(u){switch(u.label){case 0:return te(t(et,e)).throw(Q.invalidParameters),n=W.of(this._iid),r=n.sdkState,s=n.requestQueue,i=new es({userId:r.userId,channelUrl:this.url,pushTriggerOption:e}),[4,s.send(i)];case 1:return a=u.sent(),o=a.as(ts).pushTriggerOption,this.myPushTriggerOption=o,[2,o]}}))}))},s.prototype.setMyCountPreference=function(e){return p(this,void 0,void 0,(function(){var n,r,s,i,a,o,u;return _(this,(function(l){switch(l.label){case 0:return te(t(ps,e)).throw(Q.invalidParameters),n=W.of(this._iid),r=n.dispatcher,s=n.sdkState,i=n.requestQueue,a=new Kr({channelUrl:this.url,userId:s.userId,countPreference:e}),[4,i.send(a)];case 1:return o=l.sent(),u=o.as(Br).countPreference,this.myCountPreference=u,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),r.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_CREATED})),[2,u]}}))}))},s.prototype.resetMyHistory=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return e=W.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new jr({channelUrl:this.url}),[4,n.send(r)];case 1:return s=a.sent(),i=s.as(Qr).messageOffsetTimestamp,this.messageOffsetTimestamp=i,t.dispatch(new sn({channels:[this],source:$t.EVENT_CHANNEL_RESET_HISTORY})),[2,this]}}))}))},s.prototype.updatePoll=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s;return _(this,(function(i){switch(i.label){case 0:return te(g("number",e)&&function(e){return g("string",e.title,!0)&&Ne(e.data)&&g("boolean",e.allowUserSuggestion,!0)&&g("boolean",e.allowMultipleVotes,!0)&&g("number",e.closeAt,!0)}(t)).throw(Q.invalidParameters),n=W.of(this._iid).requestQueue,r=new ss(o({pollId:e},t)),[4,n.send(r)];case 1:return s=i.sent(),[2,s.as(is).poll]}}))}))},s.prototype.deletePoll=function(e){return p(this,void 0,void 0,(function(){var t,n,r;return _(this,(function(s){switch(s.label){case 0:return t=g("number",e),te(t).throw(Q.invalidParameters),n=W.of(this._iid).requestQueue,r=new as({pollId:e}),[4,n.send(r)];case 1:return s.sent(),[2]}}))}))},s.prototype.closePoll=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s;return _(this,(function(i){switch(i.label){case 0:return t=g("number",e),te(t).throw(Q.invalidParameters),n=W.of(this._iid).requestQueue,r=new os({pollId:e}),[4,n.send(r)];case 1:return s=i.sent(),[2,s.as(us).poll]}}))}))},s.prototype.addPollOption=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return n=g("number",e)&&g("string",t)&&""!==t.trim(),te(n).throw(Q.invalidParameters),r=W.of(this._iid).requestQueue,s=new ls({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,r.send(s)];case 1:return i=a.sent(),[2,i.as(cs).poll]}}))}))},s.prototype.updatePollOption=function(e,t,n){return p(this,void 0,void 0,(function(){var r,s,i,a;return _(this,(function(o){switch(o.label){case 0:return r=g("number",e)&&g("number",t)&&g("string",n)&&""!==n.trim(),te(r).throw(Q.invalidParameters),s=W.of(this._iid).requestQueue,i=new hs({pollId:e,pollOptionId:t,optionText:n}),[4,s.send(i)];case 1:return a=o.sent(),[2,a.as(ds).poll]}}))}))},s.prototype.deletePollOption=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s;return _(this,(function(i){switch(i.label){case 0:return n=g("number",e)&&g("number",t),te(n).throw(Q.invalidParameters),r=W.of(this._iid).requestQueue,s=new fs({pollId:e,pollOptionId:t}),[4,r.send(s)];case 1:return i.sent(),[2]}}))}))},s.prototype.votePoll=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s,i,a,o,u;return _(this,(function(l){switch(l.label){case 0:return n=g("number",e)&&v("number",t),te(n).throw(Q.invalidParameters),r=W.of(this._iid),s=r.requestQueue,i=r.dispatcher,a=new vs({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:t}),[4,s.send(a)];case 1:return o=l.sent(),u=o.as(er).event,i.dispatch(new T({event:u,source:$.EVENT_POLL_VOTED})),[2,u]}}))}))},s.prototype.getPollChangeLogsSinceTimestamp=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return te(g("number",e)).throw(Q.invalidParameters),[4,je.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},s.prototype.getPollChangeLogsSinceToken=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return te(g("string",e,!0)),[4,je.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},s.prototype.createPollListQuery=function(e){return void 0===e&&(e=tt),new Ze(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},s.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=nt),new $e(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},s.prototype._uploadFileAndUpdateParams=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,i,a,o,u,l,c,h;return _(this,(function(d){switch(d.label){case 0:return y(e.file)?(t=W.of(this._iid).requestQueue,n=new Ae({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:r=d.sent(),s=r.as(Ue),i=s.url,a=s.fileSize,o=void 0===a?e.fileSize:a,u=s.thumbnailSizes,l=void 0===u?e.thumbnailSizes:u,c=s.requireAuth,h=void 0!==c&&c,e.fileUrl=i,e.fileSize=o,e.thumbnailSizes=l,e.requireAuth=h,d.label=2;case 2:return[2]}}))}))},s}(Ct),Es={},Cs=function(){function e(e){var t=e._iid,n=this;this._sync=null,this._metadata=null,this._iid=t;var r,s=W.of(this._iid),i=s.sdkState,a=s.logger;this._metadataKey=(r=i.userId,"sendbird:".concat(r,"@groupchannel/sync.meta"));var o=function(e){return"sendbird:".concat(e,"@groupchannel/sync")}(i.userId);this._sync=new cr(o,(function(){return p(n,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(o){switch(o.label){case 0:return e={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:if(o.sent(),a.debug("channel background sync from",this._metadata.token),this._metadata.completed)return[3,9];o.label=2;case 2:return o.trys.push([2,5,,8]),[4,sr.of(this._iid).getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:De.CHRONOLOGICAL},100,$t.SYNC_CHANNEL_BACKGROUND)];case 3:return t=o.sent(),n=t.channels,r=t.token,e.hasNext=n.length>=100&&!!r,e.nextToken=r,this._metadata.token=r,(i=this._metadata.range).extends.apply(i,d([],f(n.map((function(e){return e.createdAt}))),!1)),this._metadata.completed=!e.hasNext,a.debug("channel background sync progress",e),[4,this.saveMetadata()];case 4:return o.sent(),[3,8];case 5:return s=o.sent(),a.debug("channel background sync error",s),s instanceof Q&&s.isInvalidTokenError?[4,this.clearMetaData()]:[3,7];case 6:o.sent(),o.label=7;case 7:throw s;case 8:return[3,10];case 9:e.hasNext=!1,e.nextToken="",o.label=10;case 10:return[2,e]}}))}))}))}return e.of=function(t){if(!Es[t]){var n=Es[t]=new e({_iid:t});W.of(t).dispatcher.on((function(e){if(e instanceof oe)if(e.stateType===ue.CONNECTED)n.resume();else n.pause()}))}return Es[t]},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)},enumerable:!1,configurable:!0}),e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e;return _(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,W.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:"",range:new nr(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!e&&e.completed},t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return this._metadata?[4,W.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetaData=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,W.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},e.prototype.resume=function(){var e,t;W.of(this._iid).logger.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:"")},e.prototype.pause=function(){W.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},e}(),Ns={},bs=function(){function e(e){var t=e._iid,n=this;this._sync=null,this._metadataKey=null,this._metadata=null,this._iid=t;var r,s=W.of(this._iid),i=s.logger,a=s.sdkState;this._metadataKey=(r=a.userId,"sendbird:".concat(r,"@groupchannel/changelogs.meta"));var o=function(e){return"sendbird:".concat(e,"@groupchannel/changelogs")}(a.userId);this._sync=new cr(o,(function(){return p(n,void 0,void 0,(function(){var e,t,n,r,s;return _(this,(function(a){switch(a.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:a.sent(),i.debug("channel changelog sync from",this._metadata.token),a.label=2;case 2:return a.trys.push([2,5,,8]),[4,sr.of(this._iid).getMyGroupChannelChangeLogs(this._metadata.token,{},$t.SYNC_CHANNEL_CHANGELOGS)];case 3:return t=a.sent(),n=t.hasMore,r=t.token,e.hasNext=n,e.nextToken=r,this._metadata.token=r,i.debug("channel changelog sync progress",e),[4,this.saveMetadata()];case 4:return a.sent(),[3,8];case 5:return s=a.sent(),i.debug("channel changelog sync error",s),s instanceof Q&&s.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:a.sent(),a.label=7;case 7:throw s;case 8:return[2,e]}}))}))}))}return e.of=function(t){if(!Ns[t]){var n=Ns[t]=new e({_iid:t});W.of(t).dispatcher.on((function(e){if(e instanceof oe)if(e.stateType===ue.CONNECTED)n.resume();else n.pause()}))}return Ns[t]},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return _(this,(function(s){switch(s.label){case 0:return this._metadata?[3,2]:(e=W.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=s.sent(),this._metadata={token:r?r.token:n/1e3},s.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return this._metadata?[4,W.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,W.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},e.prototype.resume=function(){this._sync.start(0)},e.prototype.pause=function(){this._sync.stop()},e}(),Ms=function(){function e(e,t){var n=t.filter,r=t.order,s=t.limit,i=this;this.channels=[],this._iid=e,this._key="gcc-".concat(se()),this.filter=null!=n?n:new jt,this.order=null!=r?r:De.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=s?s:Pe;var a=W.of(this._iid),o=a.sdkState;a.cacheContext.localCacheEnabled&&Cs.of(e).resume(),bs.of(e).resume(),sr.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e.filter((function(e){return i.filter.match(e,o.userId)})),r=e.filter((function(e){return!i.filter.match(e,o.userId)})).map((function(e){return e.url}));n.length>0&&i._addChannelsToView(n,t),r.length>0&&i._removeChannelsFromView(r,t)},onRemove:function(e,t){i._removeChannelsFromView(e,t)}})}return Object.defineProperty(e.prototype,"hasMore",{get:function(){return this._hasMore},enumerable:!1,configurable:!0}),e.prototype.setGroupChannelCollectionHandler=function(e){this._handler=e},e.prototype._addChannelsToView=function(e,t,n){var r,s,i=this;void 0===n&&(n=!1);var a=[],o=[];try{for(var u=m(e),l=u.next();!l.done;l=u.next()){var c=l.value,h=Er(this.channels,c,this.order),d=h.place;if(h.contains)switch(o.push(c),t){case $t.EVENT_CHANNEL_UPDATED:case $t.EVENT_MESSAGE_RECEIVED:this.channels.splice(d,1);var f=Er(this.channels,c,this.order).place;this.channels.splice(f,0,c);break;default:this.channels[d]=c}else if(d===this.channels.length){var v=Cs.of(this._iid);(n||v.completed)&&(a.push(c),this.channels.push(c))}else a.push(c),this.channels.splice(d,0,c)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}rn(t)&&Z((function(){return p(i,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new hr(t),a.length>0&&this._handler.onChannelsAdded(e,a),o.length>0&&this._handler.onChannelsUpdated(e,o),[2]}))}))}))},e.prototype._removeChannelsFromView=function(e,t){var n,r,s=this,i=[],a=function(e){var t=o.channels.findIndex((function(t){return t.url===e}));t>=0&&(i.push(o.channels[t].url),o.channels.splice(t,1))},o=this;try{for(var u=m(e),l=u.next();!l.done;l=u.next()){a(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return rn(t)&&i.length>0&&Z((function(){return p(s,void 0,void 0,(function(){var e;return _(this,(function(n){return e=new hr(t),this._handler.onChannelsDeleted(e,i),[2]}))}))})),i},e.prototype._getLocalChannels=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,sr.of(this._iid).getChannelsFromCache(this._token,this.filter,this.order)];case 1:return[2,e.sent()]}}))}))},e.prototype._getRemoteChannels=function(){return p(this,void 0,void 0,(function(){var e,t,n;return _(this,(function(r){switch(r.label){case 0:return[4,sr.of(this._iid).getMyGroupChannels(this._token,o(o({},this.filter),{order:this.order}),this._limit)];case 1:return e=r.sent(),t=e.channels,n=e.token,this._token=n,this._hasMore=!!n,[2,t]}}))}))},e.prototype.loadMore=function(){return p(this,void 0,void 0,(function(){var e,t=this;return _(this,(function(n){switch(n.label){case 0:return this._hasMore?(e=[],[4,b((function(){return p(t,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._getLocalChannels()];case 1:return e=t.sent(),[2]}}))}))}))]):[3,3];case 1:return n.sent(),[4,b((function(){return p(t,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._getRemoteChannels()];case 1:return e=t.sent(),[2]}}))}))}))];case 2:return n.sent(),this._addChannelsToView(e,$t.REQUEST_CHANNEL,!0),[2,e];case 3:return[2,[]]}}))}))},e.prototype.dispose=function(){W.of(this._iid).cacheContext.localCacheEnabled&&Cs.of(this._iid).pause(),bs.of(this._iid).pause(),sr.of(this._iid).unsubscribeGroupChannelEvent(this._key)},e}(),Ts=function(t){function n(e){var n=this,r=e.token,s=e.limit,i=e.order,o=e.includeEmpty,u=e.membershipFilter,l=e.channelNameContainsFilter,c=e.channelUrlsFilter,h=e.customTypesFilter,d=e.customTypeStartsWithFilter,f=e.superChannelFilter,p=e.metadataOrderKeyFilter,_=e.metadataKey,m=e.metadataValues,v=e.metadataValueStartsWith,g=e.includeFrozen,y=e.includeMetaData;return(n=t.call(this)||this).method=D.GET,n.path=F,n.params=a({token:r,limit:s,order:i,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:o,public_mode:Pt.PUBLIC,public_membership_mode:u,name_contains:l,channel_urls:c,custom_types:h,custom_type_startswith:d,super_mode:f,metadata_order_key:p,metadata_key:_,metadata_values:m,metadata_value_startswith:v,show_frozen:g,show_metadata:y}),n}return e(n,t),n}(P),Ss=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,i=n.channels,a=n.ts;return r.token=s,i&&i.length>0&&(r.channels=i.map((function(t){return t.ts=a,new ys(e,t)}))),r.ts="number"==typeof a?a:null,r}return e(n,t),n}(O);!function(e){e.ALL="all",e.JOINED="joined"}(gs||(gs={}));var Us=function(n){function r(e,t){var r,s,i,a,o,u,l,c,h,d,f,p,_,m,v=this;return(v=n.call(this,e,t)||this).includeEmpty=!1,v.includeFrozen=!0,v.includeMetaData=!0,v.channelUrlsFilter=null,v.customTypesFilter=null,v.customTypeStartsWithFilter=null,v.channelNameContainsFilter=null,v.membershipFilter=gs.ALL,v.superChannelFilter=kt.ALL,v.metadataKey=null,v.metadataValues=null,v.metadataOrderKeyFilter=null,v.metadataValueStartsWith=null,v.order=rt.CHRONOLOGICAL,v.includeEmpty=null!==(r=t.includeEmpty)&&void 0!==r&&r,v.includeFrozen=null===(s=t.includeFrozen)||void 0===s||s,v.includeMetaData=null===(i=t.includeMetaData)||void 0===i||i,v.channelUrlsFilter=null!==(a=t.channelUrlsFilter)&&void 0!==a?a:null,v.customTypesFilter=null!==(o=t.customTypesFilter)&&void 0!==o?o:null,v.customTypeStartsWithFilter=null!==(u=t.customTypeStartsWithFilter)&&void 0!==u?u:null,v.channelNameContainsFilter=null!==(l=t.channelNameContainsFilter)&&void 0!==l?l:null,v.membershipFilter=null!==(c=t.membershipFilter)&&void 0!==c?c:gs.ALL,v.superChannelFilter=null!==(h=t.superChannelFilter)&&void 0!==h?h:kt.ALL,v.metadataKey=null!==(d=t.metadataKey)&&void 0!==d?d:null,v.metadataValues=null!==(f=t.metadataValues)&&void 0!==f?f:null,v.metadataOrderKeyFilter=null!==(p=t.metadataOrderKeyFilter)&&void 0!==p?p:null,v.metadataValueStartsWith=null!==(_=t.metadataValueStartsWith)&&void 0!==_?_:null,v.order=null!==(m=t.order)&&void 0!==m?m:rt.CHRONOLOGICAL,v}return e(r,n),r.prototype._validate=function(){return n.prototype._validate.call(this)&&g("boolean",this.includeEmpty)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.channelNameContainsFilter,!0)&&v("string",this.channelUrlsFilter,!0)&&v("string",this.customTypesFilter,!0)&&g("string",this.customTypeStartsWithFilter,!0)&&t(gs,this.membershipFilter)&&t(kt,this.superChannelFilter)&&t(rt,this.order)&&g("string",this.metadataOrderKeyFilter,!0)&&g("string",this.metadataKey,!0)&&v("string",this.metadataValues,!0)&&g("string",this.metadataValueStartsWith,!0)},r.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i,a,u,l;return _(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=W.of(this._iid),n=t.requestQueue,r=t.dispatcher,s=new Ts(o(o({},this),{token:this._token})),[4,n.send(s)]):[3,2]):[3,5];case 1:return i=c.sent(),a=i.as(Ss),u=a.channels,l=a.token,this._token=l,this._hasNext=!!l,r.dispatch(new sn({channels:u,source:$t.REQUEST_CHANNEL})),this._isLoading=!1,[2,u];case 2:return[2,e];case 3:throw Q.queryInProgress;case 4:return[3,6];case 5:throw Q.invalidParameters;case 6:return[2]}}))}))},r}(j),As=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}(function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.onUserJoined=Ie,e.onUserLeft=Ie,e.onUserReceivedInvitation=Ie,e.onUserDeclinedInvitation=Ie,e.onChannelHidden=Ie,e.onUnreadMemberStatusUpdated=Ie,e.onUndeliveredMemberStatusUpdated=Ie,e.onTypingStatusUpdated=Ie,e.onPollUpdated=Ie,e.onPollVoted=Ie,e.onPollDeleted=Ie,e}return e(n,t),n}(Dt)),Is=function(t){function n(e){var n=this,r=e.token,s=e.limit,i=e.order,o=e.reverse,u=e.channelUrl,l=e.messageTypeFilter,c=e.scheduledStatus;return(n=t.call(this)||this).method=D.GET,n.path="".concat(x),n.params=a({limit:s,reverse:o,channel_url:u,order:i,status:c}),r&&(n.params.token=r),l&&(n.params.message_type=l),n}return e(n,t),n}(P),ws=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.scheduledMessages=[];var s=n.next,i=n.scheduled_messages;return r.token=s,r.scheduledMessages=i.map((function(t){return de(e,t)})),r}return e(n,t),n}(O),Ls=function(n){function r(e,t){var r,s,i,a,o,u=this;return(u=n.call(this,e,t)||this).channelUrl=null,u.order=null,u.reverse=!1,u.scheduledStatus=null,u.messageTypeFilter=E.ALL,u.channelUrl=null!==(r=t.channelUrl)&&void 0!==r?r:null,u.order=null!==(s=t.order)&&void 0!==s?s:null,u.reverse=null!==(i=t.reverse)&&void 0!==i&&i,u.scheduledStatus=null!==(a=t.scheduledStatus)&&void 0!==a?a:null,u.messageTypeFilter=null!==(o=t.messageTypeFilter)&&void 0!==o?o:E.ALL,u}return e(r,n),r.prototype._validate=function(){return n.prototype._validate.call(this)&&g("string",this.channelUrl,!0)&&(t(st,this.order)||null===this.order)&&g("boolean",this.reverse)&&(v(C,this.scheduledStatus)||null===this.scheduledStatus)&&t(E,this.messageTypeFilter)},r.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,i;return _(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=W.of(this._iid).requestQueue,t=new Is(o(o({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=a.sent(),r=n.as(ws),s=r.scheduledMessages,i=r.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw Q.queryInProgress;case 4:return[3,6];case 5:throw Q.invalidParameters;case 6:return[2]}}))}))},r}(j),Ds=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="groupChannel",e}return e(n,t),n.prototype.init=function(e,n){var r=n.sdkState,s=n.dispatcher,i=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,l=n.cacheContext;t.prototype.init.call(this,e,{sdkState:r,dispatcher:s,sessionManager:i,requestQueue:a,logger:o,onlineDetector:u,cacheContext:l}),this._manager=new sr(e,{sdkState:r,cacheContext:l,dispatcher:s,sessionManager:i,requestQueue:a,logger:o})},n.prototype.createGroupChannelCollection=function(e){return void 0===e&&(e={}),new Ms(this._iid,e)},n.prototype.createMyGroupChannelListQuery=function(e){return void 0===e&&(e={}),new tr(this._iid,e)},n.prototype.createPublicGroupChannelListQuery=function(e){return void 0===e&&(e={}),new Us(this._iid,e)},n.prototype.createScheduledMessageListQuery=function(e){return void 0===e&&(e={}),new Ls(this._iid,e)},n.prototype.addGroupChannelHandler=function(e,t){te(g("string",e)&&t instanceof As).throw(Q.invalidParameters),this._manager.addHandler(e,t)},n.prototype.removeGroupChannelHandler=function(e){te(g("string",e)).throw(Q.invalidParameters),this._manager.removeHandler(e)},n.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},n.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},n.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},n.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},n.prototype.getChannel=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){return te(g("string",e)).throw(Q.invalidParameters),[2,this._manager.getChannel(e)]}))}))},n.prototype.getChannelWithoutCache=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){return te(g("string",e)).throw(Q.invalidParameters),[2,this._manager.getChannelWithoutCache(e)]}))}))},n.prototype.getMyGroupChannelChangeLogsByToken=function(e,t){return p(this,void 0,void 0,(function(){var n;return _(this,(function(r){switch(r.label){case 0:return n=o(o({},Yt),t),te(g("string",e)&&Jt(n)).throw(Q.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMyGroupChannelChangeLogsByTimestamp=function(e,t){return p(this,void 0,void 0,(function(){var n;return _(this,(function(r){switch(r.label){case 0:return n=o(o({},Yt),t),te(g("number",e)&&Jt(n)).throw(Q.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getGroupChannelCount=function(e){return p(this,void 0,void 0,(function(){var t;return _(this,(function(n){return t=o(o({},Xt),e),te(Zt(t)).throw(Q.invalidParameters),[2,this._manager.getGroupChannelCount(t)]}))}))},n.prototype.getUnreadItemCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._manager.getUnreadItemCount(e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getTotalUnreadChannelCount=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){switch(e.label){case 0:return[4,this._manager.getTotalUnreadChannelCount()];case 1:return[2,e.sent()]}}))}))},n.prototype.getTotalUnreadMessageCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalScheduledMessageCount(e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getSubscribedTotalUnreadMessageCount=function(){return this._manager.getSubscribedTotalUnreadMessageCount()},n.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()},n.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)},n.prototype.createChannel=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){var t;return _(this,(function(n){return t=o(o({},zt),e),te(Wt(t)).throw(Q.invalidParameters),[2,this._manager.createChannel(t)]}))}))},n.prototype.createDistinctChannelIfNotExist=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){var t;return _(this,(function(n){return t=o(o({},zt),e),te(Wt(t)).throw(Q.invalidParameters),t&&(t.isDistinct=!0),[2,this.createChannel(t)]}))}))},n.prototype.createChannelWithUserIds=function(e,t,n,r,s,i){return void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=null),void 0===s&&(s=""),void 0===i&&(i=""),p(this,void 0,void 0,(function(){var a;return _(this,(function(u){return a=o(o({},zt),{invitedUserIds:e,isDistinct:t,name:n,data:s,customType:i}),"string"==typeof r?a.coverUrl=r:a.coverImage=r,[2,this.createChannel(a)]}))}))},n.prototype.markAsReadAll=function(){return p(this,void 0,void 0,(function(){return _(this,(function(e){return this._manager.markAsReadAll(),[2]}))}))},n.prototype.markAsReadWithChannelUrls=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){return te(v("string",e)).throw(Q.invalidParameters),this._manager.markAsReadWithChannelUrls(e),[2]}))}))},n.prototype.markAsDelivered=function(e){return p(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return te(g("string",e)).throw(Q.invalidParameters),[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},n}(we);export{ps as CountPreference,ys as GroupChannel,Ms as GroupChannelCollection,hr as GroupChannelEventContext,$t as GroupChannelEventSource,jt as GroupChannelFilter,As as GroupChannelHandler,tr as GroupChannelListQuery,Ds as GroupChannelModule,Gt as GroupChannelSearchField,xt as HiddenChannelFilter,ms as HiddenState,qt as Member,Ar as MemberListOrder,kr as MemberListQuery,Rt as MemberState,Ir as MemberStateFilter,gs as MembershipFilter,Lr as MessageCollection,wr as MessageCollectionInitHandler,lr as MessageCollectionInitPolicy,dr as MessageEventContext,Ur as MutedMemberFilter,_s as MutedState,Ot as MyMemberStateFilter,Ht as OperatorFilter,Pt as PublicChannelFilter,Us as PublicGroupChannelListQuery,Vt as QueryType,Kt as ReadStatus,Ls as ScheduledMessageListQuery,kt as SuperChannelFilter,Ft as UnreadChannelFilter,Bt as UnreadItemKey};
