import{_ as e,A as t,a7 as n,e as r,f as i,h as s,u as a,g as o,U as u,a8 as c,K as l,a as d,Q as h,o as f,p,r as m,a1 as v,a9 as y,aa as _,ab as g,Y as b,ac as I,ad as E,ae as T,V as w,af as M,b as S,c as N,s as A,q as U,ag as C,ah as O,ai as P,aj as k,ak as R,W as x,y as L,z as D,al as F,am as q,i as z,an as B,ao as K,ap as j,aq as Q,ar as G,as as V,at as H,au as W,av as Y,aw as J,ax as X,ay as Z,az as $,m as ee,aA as te,X as ne,B as re,aB as ie,aC as se,t as ae,w as oe,aD as ue,aE as ce,d as le,aF as de,aG as he,aH as fe,O as pe,aI as me,aJ as ve,aK as ye,aL as _e,x as ge,aM as be,aN as Ie}from"./__bundle-a5600e6c.js";var Ee,Te=function(i){function s(e){var s=i.call(this)||this;if(s.method=t.POST,s.path="".concat(n),s.params=r({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var a=0;a<e.thumbnailSizes.length;a++){var o=e.thumbnailSizes[a],u=o.maxWidth,c=o.maxHeight;s.params["thumbnail".concat(a+1)]="".concat(u,",").concat(c)}return s.requestId=e.requestId,s}return e(s,i),s}(i),we=function(t){function n(e,n){var r,i,s,a=this;return(a=t.call(this,e,n)||this).url=n.url,a.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,a.thumbnailSizes=null!==(i=n.thumbnails)&&void 0!==i?i:[],a.requireAuth=null!==(s=n.require_auth)&&void 0!==s&&s,a}return e(n,t),n}(s),Me=function(t){function n(e,n){var r,i,s,a=this;return(a=t.call(this,e)||this).replyCount=0,a.lastRepliedAt=0,a.updatedAt=0,a.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,a.mostRepliedUsers=n.most_replies&&l("object",n.most_replies)?n.most_replies.map((function(e){return new u(a._iid,e)})):[],a.lastRepliedAt=null!==(i=n.last_replied_at)&&void 0!==i?i:0,a.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,a}return e(n,t),n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((function(e){return u.payloadify(e)})):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))},n}(c);!function(e){e.ADD="add",e.DELETE="delete"}(Ee||(Ee={}));var Se,Ne,Ae=function(e){this.messageId=0,this.operation=null,this.updatedAt=0;var t=d("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,s=e.updated_at;t&&d("string",n)&&d("string",r)&&h(Ee,r)&&d("string",i)&&i&&d("number",s)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=s)},Ue=function(){function e(e){var t,n,r,i=e.key,s=null!==(r=f([],p(e.user_ids),!1))&&void 0!==r?r:[],a=e.updated_at;d("string",i)&&i&&l("string",s)&&s.length>0&&d("number",a)&&(this.key=i,this.userIds=s,this.updatedAt=a);var o={};try{for(var u=m(this.userIds),c=u.next();!c.done;c=u.next()){o[c.value]=this.updatedAt}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}this._version=o}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),e.payloadify=function(e){return r(a({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}))},e.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case Ee.ADD:t<0&&this.userIds.push(e.userId);break;case Ee.DELETE:t>=0&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}},e}(),Ce=function(){function e(e){this.key=e.key,this.value=l("string",e.value)?f([],p(e.value),!1):[]}return e.payloadify=function(e){var t;return r(a({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}))},e}(),Oe=function(){function e(e){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.secure_url&&(this.secureUrl=e.secure_url),e.type&&(this.type=e.type),e.width&&(this.width=e.width),e.height&&(this.height=e.height),e.alt&&(this.alt=e.alt)}return e.payloadify=function(e){var t,n;return r(a({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}))},e}(),Pe=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e["og:title"]&&(this.title=e["og:title"]),e["og:url"]&&(this.url=e["og:url"]),e["og:description"]&&(this.description=e["og:description"]),e["og:image"]&&(this.defaultImage=new Oe(e["og:image"]))}return e.payloadify=function(e){return r(a({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Oe.payloadify(e.defaultImage):null}))},e}(),ke=function(){function e(e){var t,n;this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return e.prototype.serialize=function(){return{name:this.name,volume:this.volume}},e.payloadify=function(e){return r(a({name:e.name,volume:e.volume}))},e}(),Re=function(t){function n(e,n){var r,i=this;return(i=t.call(this,e,n)||this).isBlockedByMe=!1,i.role=h(v,n.role)?n.role:v.NONE,i.isBlockedByMe=null!==(r=n.is_blocked_by_me)&&void 0!==r&&r,i}return e(n,t),n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))},n}(u);!function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled"}(Se||(Se={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(Ne||(Ne={}));var xe=function(e){switch(e){case _.BASE:return"";case _.USER:return"MESG";case _.FILE:return"FILE";case _.ADMIN:return"ADMM"}},Le=function(t){function n(e,n){var r,i,s,a,o,c,l,d,f,p,m,v,y,g,E,T,w=this;(w=t.call(this,e)||this).channelType=b.BASE,w.parentMessage=null,w.silent=!1,w.isOperatorMessage=!1,w.messageType=_.BASE,w.mentionType=null,w.threadInfo=null,w.reactions=[],w.metaArrays=[],w.appleCriticalAlertOptions=null,w.createdAt=0,w.updatedAt=0,w.scheduledInfo=null,w.extendedMessage={},w.notificationData=null,w._isContinuousMessages=!1,w._scheduledStatus=null,w.messageId=null!==(i=null!==(r=n.msg_id)&&void 0!==r?r:n.message_id)&&void 0!==i?i:0,w.channelUrl=n.channel_url,w.channelType=h(b,n.channel_type)?n.channel_type:b.GROUP,n.channel&&(n.channel.channel_url&&(w.channelUrl=n.channel.channel_url),n.channel.channel_type&&(w.channelType=n.channel.channel_type)),w.parentMessageId=null!==(s="string"==typeof n.parent_message_id?parseInt(n.parent_message_id):n.parent_message_id)&&void 0!==s?s:0,w.data=null!==(a=n.data)&&void 0!==a?a:"",w.customType=null!==(o=n.custom_type)&&void 0!==o?o:"",w.mentionType=h(I,n.mention_type)?n.mention_type:null,w.mentionedUsers=n.mentioned_users?n.mentioned_users.map((function(e){return new u(w._iid,e)})):null,w.mentionedUserIds=null!==(c=n.mentioned_user_ids)&&void 0!==c?c:null,w.mentionedUsers&&!w.mentionedUserIds&&(w.mentionedUserIds=w.mentionedUsers.map((function(e){return e.userId}))),w.mentionedMessageTemplate=null!==(l=n.mentioned_message_template)&&void 0!==l?l:"",w.threadInfo=n.thread_info?new Me(w._iid,n.thread_info):null,w.reactions=n.reactions?n.reactions.map((function(e){return new Ue(e)})):[];var M=null!==(d=n.metaarray)&&void 0!==d?d:{},S=null!==(f=n.metaarray_key_order)&&void 0!==f?f:Object.keys(M).sort((function(e,t){return e.localeCompare(t)}));w.metaArrays=[];for(var N=0;N<S.length;N++){var A=S[N];w.metaArrays.push(new Ce({key:A,value:M[A]||[]}))}if(n.sorted_metaarray&&(w.metaArrays=n.sorted_metaarray.map((function(e){return new Ce(e)}))),w.ogMetaData=n.og_tag?new Pe(n.og_tag):null,w.silent=null!==(p=n.silent)&&void 0!==p&&p,w.isOperatorMessage=null!==(m=n.is_op_msg)&&void 0!==m&&m,w.appleCriticalAlertOptions=n.apple_critical_alert_options?new ke(n.apple_critical_alert_options):null,w.createdAt=null!==(y=null!==(v=n.created_at)&&void 0!==v?v:n.ts)&&void 0!==y?y:0,w.updatedAt=null!==(g=n.updated_at)&&void 0!==g?g:0,"number"==typeof n.scheduled_message_id&&"number"==typeof n.scheduled_at&&n.scheduled_status&&(w.scheduledInfo={scheduledMessageId:n.scheduled_message_id,scheduledAt:n.scheduled_at},w._scheduledStatus=n.scheduled_status),w.extendedMessage=null!==(E=n.extended_message)&&void 0!==E?E:{},0===w.extendedMessage.sub_type)try{var U=JSON.parse(w.extendedMessage.sub_data),C=U.label,O=U.tags,P=U.template_key,k=U.template_variables;w.notificationData={label:C,tags:O,templateKey:P,templateVariables:k}}catch(e){}return w._isContinuousMessages=null!==(T=n.is_continuous_messages)&&void 0!==T&&T,w}return e(n,t),n.payloadify=function(e){var n,i,s,c;return r(a(o(o({},t.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:xe(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(n=e.mentionedUsers)||void 0===n?void 0:n.map((function(e){return u.payloadify(e)})),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?Me.payloadify(e.threadInfo):null,reactions:e.reactions.map((function(e){return Ue.payloadify(e)})),sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((function(e){return Ce.payloadify(e)})),og_tag:e.ogMetaData?Pe.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(s=e.scheduledInfo)||void 0===s?void 0:s.scheduledMessageId,scheduled_at:null===(c=e.scheduledInfo)||void 0===c?void 0:c.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})))},n._getParentMessageInfoPayload=function(e){return r(a({type:xe(e.messageType),ts:e.createdAt,user:e.sender?Re.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth}}))},n.prototype.isIdentical=function(e){return this.messageId===e.messageId},n.prototype.isEqual=function(e){return y(this,e)},n.prototype.isUserMessage=function(){return this.messageType===_.USER},n.prototype.isFileMessage=function(){return this.messageType===_.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n.prototype.isMultipleFilesMessage=function(){return this.messageType===_.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n.prototype.isAdminMessage=function(){return this.messageType===_.ADMIN},n.prototype.serialize=function(){return g(this)},n.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},n.prototype.applyThreadInfoUpdateEvent=function(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},n.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new Ue(Ue.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},n.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1},n}(c),De=function(t){function n(e,n){var r,i,s,a,o=this;if((o=t.call(this,e,n)||this).reqId="",o.replyToChannel=!1,o.errorCode=0,o.sender=n.user?new Re(o._iid,n.user):n.sender_id,o.reqId=null!==(i=null!==(r=n.req_id)&&void 0!==r?r:n.request_id)&&void 0!==i?i:"",o.replyToChannel=null!==(s=n.is_reply_to_channel)&&void 0!==s&&s,n.request_state&&h(E,n.request_state)&&(o.sendingStatus=n.request_state),!o.sendingStatus)if(o.messageId>0)o.sendingStatus=E.SUCCEEDED;else if(o.scheduledInfo)switch(n.scheduled_status&&(o._scheduledStatus=n.scheduled_status),n.scheduled_status){case Ne.SENT:case Ne.IN_QUEUE:o.sendingStatus=E.SUCCEEDED;break;case Ne.PENDING:o.sendingStatus=E.SCHEDULED;break;case Ne.FAILED:case Ne.REMOVED:o.sendingStatus=E.FAILED;break;case Ne.CANCELED:o.sendingStatus=E.CANCELED}else o.sendingStatus=E.PENDING;return o.errorCode=null!==(a=n.error_code)&&void 0!==a?a:0,o}return e(n,t),n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),{user:Re.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))},Object.defineProperty(n.prototype,"isResendable",{get:function(){return(this.sendingStatus===E.FAILED||this.sendingStatus===E.CANCELED)&&T(this.errorCode)},enumerable:!1,configurable:!0}),n.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},n}(Le),Fe=function(){function e(e,t,n){var r,i;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this._requireAuth=!1,this._iid=e,this.plainUrl=t.url,this.width=t.width,this.height=t.height,this.realWidth=null!==(r=t.real_width)&&void 0!==r?r:t.width,this.realHeight=null!==(i=t.real_height)&&void 0!==i?i:t.height,this._requireAuth=n}return e.payloadify=function(e){return r(a({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(e.prototype,"url",{get:function(){var e=w.of(this._iid).sessionManager;return this._requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),e}(),qe={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:M.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},ze=function(e){return d("number",e.prevResultSize)&&d("number",e.nextResultSize)&&d("boolean",e.isInclusive)&&d("boolean",e.reverse)&&d("string",e.messageTypeFilter)&&h(M,e.messageTypeFilter)&&l("string",e.customTypesFilter,!0)&&l("string",e.senderUserIdsFilter,!0)&&d("boolean",e.includeMetaArray)&&d("boolean",e.includeReactions)&&d("boolean",e.includeParentMessageInfo)},Be=function(t){function n(e,n){var i,s,u,c,l=this;if((l=t.call(this,e,n)||this).translations={},l.message=null!==(i=n.message)&&void 0!==i?i:"",l.messageType=_.ADMIN,l.translations=null!==(s=n.translations)&&void 0!==s?s:{},n.parent_message_info){var d=n.parent_message_info;l.parentMessage=He(e,r(a(o(o({},d),{message_id:l.parentMessageId,channel_url:l.channelUrl,channel_type:l.channelType,file:d.file,url:null===(u=d.file)||void 0===u?void 0:u.url,require_auth:null===(c=d.file)||void 0===c?void 0:c.require_auth}))))}return l}return e(n,t),n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n.prototype.getThreadedMessagesByTimestamp=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},qe),t),A(this.messageId>0&&d("number",e)&&ze(n)).throw(U.invalidParameters),[4,is.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},n}(Le),Ke=function(){function e(e){var t,n;this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.detail&&d("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return e.payloadify=function(e){return r(a({type:e.type,vendor:e.vendor,detail:e.detail}))},e}(),je=function(t){function n(e,n){var i,s,u,c,l,d,h,f=this;if((f=t.call(this,e,n)||this).message="",f.messageParams=null,f.translations={},f.translationTargetLanguages=[],f.messageSurvivalSeconds=-1,f.plugins=[],f._poll=null,f.message=n.message,f.messageType=_.USER,f.translations=null!==(u=n.translations)&&void 0!==u?u:{},f.translationTargetLanguages=null!==(c=n.target_langs)&&void 0!==c?c:[],0===Object.keys(f.translations).length&&f.translationTargetLanguages.length>0)try{for(var p=m(f.translationTargetLanguages),v=p.next();!v.done;v=p.next()){var y=v.value;f.translations[y]=""}}catch(e){i={error:e}}finally{try{v&&!v.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}if(f.messageSurvivalSeconds=null!==(l=n.message_survival_seconds)&&void 0!==l?l:-1,f.plugins=n.plugins?n.plugins.map((function(e){return new Ke(e)})):[],f._poll=n.poll?new C(f._iid,n.poll):null,n.parent_message_info){var g=n.parent_message_info;f.parentMessage=He(e,r(a(o(o({},g),{created_at:g.ts,message_id:f.parentMessageId,channel_url:f.channelUrl,channel_type:f.channelType,file:g.file,url:null===(d=g.file)||void 0===d?void 0:d.url,require_auth:null===(h=g.file)||void 0===h?void 0:h.require_auth}))))}return f}return e(n,t),n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((function(e){return Ke.payloadify(e)})),poll:e._poll?C.payloadify(e._poll):null,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n.prototype.getThreadedMessagesByTimestamp=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},qe),t),A(this.messageId>0&&d("number",e)&&ze(n)).throw(U.invalidParameters),[4,is.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(n.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),n}(De),Qe=function(t){function n(e,n){var r,i,s,a,u,c=this;return(c=t.call(this,e)||this).plainUrl="",c.fileName=null,c.mimeType=null,c.fileSize=0,c.thumbnails=[],c._requireAuth=!1,c.plainUrl=null!==(r=n.url)&&void 0!==r?r:"",c.fileName=null!==(i=n.file_name)&&void 0!==i?i:null,c.mimeType=null!==(s=n.file_type)&&void 0!==s?s:null,c.fileSize=null!==(a=n.file_size)&&void 0!==a?a:0,c._requireAuth=null!==(u=n.require_auth)&&void 0!==u&&u,w.of(c._iid).sessionManager,c.thumbnails=n.thumbnails?n.thumbnails.map((function(e){var t;return new Fe(c._iid,"string"==typeof e?{url:e,width:0,height:0}:o(o({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),c._requireAuth)})):[],c}return e(n,t),n.payloadify=function(e){var t;return r(a({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),require_auth:e._requireAuth}))},Object.defineProperty(n.prototype,"url",{get:function(){var e=w.of(this._iid).sessionManager;return this._requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n}(c),Ge=function(t){function n(e,n){var i,s,u,c,l,d=this;if((d=t.call(this,e,n)||this).messageParams=null,d.fileInfoList=[],d.messageSurvivalSeconds=-1,d.messageType=_.FILE,d.fileInfoList=null!==(s=null===(i=n.files)||void 0===i?void 0:i.map((function(t){return new Qe(e,t)})))&&void 0!==s?s:[],d.messageSurvivalSeconds=null!==(u=n.message_survival_seconds)&&void 0!==u?u:-1,n.parent_message_info){var h=n.parent_message_info;d.parentMessage=He(e,r(a(o(o({},h),{created_at:h.ts,message_id:d.parentMessageId,channel_url:d.channelUrl,channel_type:d.channelType,file:h.file,url:null===(c=h.file)||void 0===c?void 0:c.url,require_auth:null===(l=h.file)||void 0===l?void 0:l.require_auth}))))}return d}return e(n,t),n.prototype.getThreadedMessagesByTimestamp=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},qe),t),A(this.messageId>0&&d("number",e)&&ze(n)).throw(U.invalidParameters),[4,is.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),{files:e.fileInfoList&&e.fileInfoList&&Array.isArray(e.fileInfoList)?e.fileInfoList.map((function(e){return Qe.payloadify(e)})):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n._isMultipleFilesMessagePayload=function(e){var t=e.files;return Array.isArray(t)&&t.length>=2},n._isMultipleFilesMessageSerializedData=function(e){var t=e.fileInfoList;return Array.isArray(t)},n}(De),Ve=function(e){switch(e.messageType){case _.USER:return je.payloadify(e);case _.FILE:return e.fileInfoList?Ge.payloadify(e):We.payloadify(e);case _.ADMIN:return Be.payloadify(e);default:throw U.unknown}},He=function(e,t){switch(t.type){case"MESG":return new je(e,t);case"FILE":return Ge._isMultipleFilesMessagePayload(t)?new Ge(e,t):new We(e,t);case"ADMM":case"BRDM":return new Be(e,t)}return null},We=function(t){function n(e,n){var i,s,u,c,l,d,h,f,p,m,v,y,g,b,I=this;(I=t.call(this,e,n)||this).messageParams=null,I.plainUrl="",I.requireAuth=!1,I.thumbnails=[],I.messageSurvivalSeconds=-1,I.messageType=_.FILE;var E=n.file;if(I.plainUrl=(null!==(s=null!==(i=null==E?void 0:E.url)&&void 0!==i?i:n.url)&&void 0!==s?s:"").split("?auth=")[0],I.name=null!==(c=null!==(u=null==E?void 0:E.name)&&void 0!==u?u:n.name)&&void 0!==c?c:"File",I.size=null!==(d=null!==(l=null==E?void 0:E.size)&&void 0!==l?l:n.size)&&void 0!==d?d:0,I.data=null!==(f=null!==(h=null==E?void 0:E.data)&&void 0!==h?h:n.custom)&&void 0!==f?f:"",I.type=E?null!==(p=E.type)&&void 0!==p?p:"":null!==(m=n.type)&&void 0!==m?m:"",w.of(I._iid).sessionManager,I.requireAuth=null!==(v=n.require_auth)&&void 0!==v&&v,I.thumbnails=n.thumbnails?n.thumbnails.map((function(e){var t;return new Fe(I._iid,"string"==typeof e?{url:e,width:0,height:0}:o(o({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),I.requireAuth)})):[],I.messageSurvivalSeconds=null!==(y=n.message_survival_seconds)&&void 0!==y?y:-1,n.parent_message_info){var T=n.parent_message_info;I.parentMessage=He(e,r(a(o(o({},T),{created_at:T.ts,message_id:I.parentMessageId,channel_url:I.channelUrl,channel_type:I.channelType,file:T.file,url:null===(g=T.file)||void 0===g?void 0:g.url,require_auth:null===(b=T.file)||void 0===b?void 0:b.require_auth}))))}return I}return e(n,t),n.payloadify=function(e){var n;return r(a(o(o({},t.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:null===(n=e.thumbnails)||void 0===n?void 0:n.map((function(e){return{url:e.plainUrl,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},Object.defineProperty(n.prototype,"url",{get:function(){var e=w.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n.prototype.getThreadedMessagesByTimestamp=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},qe),t),A(this.messageId>0&&d("number",e)&&ze(n)).throw(U.invalidParameters),[4,is.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},n}(De),Ye=function(t){function n(e){var n,i,s,o=[];return e.mentionType===I.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"FILE",ackRequired:!0,payload:r(a({channel_url:e.channelUrl,files:e.files?$e(e.files):null,url:e.url,name:null!==(n=e.fileName)&&void 0!==n?n:"",type:null!==(i=e.mimeType)&&void 0!==i?i:"",size:null!==(s=e.fileSize)&&void 0!==s?s:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:o,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==O.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage}))})||this}return e(n,t),n}(P),Je=function(n){function i(e){var i,s,o=this;o=n.call(this)||this;var u=[];return e.mentionType===I.USERS&&(e.mentionedUserIds?u=e.mentionedUserIds:e.mentionedUsers&&(u=e.mentionedUsers.map((function(e){return e.userId})))),o.method=t.POST,o.path="".concat(k(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),o.params=r(a({message_type:_.FILE,user_id:e.userId,files:e.files?$e(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:u,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:null===(i=e.thumbnailSizes)||void 0===i?void 0:i.map((function(e){return Fe.payloadify(e)})),require_auth:e.requireAuth,sorted_metaarray:null===(s=e.metaArrays)||void 0===s?void 0:s.map((function(e){return Ce.payloadify(e)})),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage})),o}return e(i,n),i}(i),Xe=function(t){function n(e,n,r){var i,s,a,o,u=this;(u=t.call(this,e,"FILE",r)||this).message=r.files&&r.files.length>=2?new Ge(e,r):new We(e,r);var c=w.of(e).sdkState;return u.isMentioned=R(u.message.mentionType,null!==(a=null!==(i=u.message.mentionedUserIds)&&void 0!==i?i:null===(s=u.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})))&&void 0!==a?a:[],c.userId),u.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,u}return e(n,t),n}(x),Ze=function(t){function n(e,n){var r,i,s,a,o=this;(o=t.call(this,e,n)||this).message=n.files&&n.files.length>=2?new Ge(e,n):new We(e,n);var u=w.of(e).sdkState;return o.isMentioned=R(o.message.mentionType,null!==(s=null!==(r=o.message.mentionedUserIds)&&void 0!==r?r:null===(i=o.message.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})))&&void 0!==s?s:[],u.userId),o.forceUpdateLastMessage=null!==(a=n.force_update_last_message)&&void 0!==a&&a,o}return e(n,t),n}(s);function $e(e){return e.map((function(e){var t,n;return r(a({url:e.fileUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnailSizes)||void 0===t?void 0:t.map((function(e){return Fe.payloadify(e)})),require_auth:null===(n=e._uploadedMetaData)||void 0===n?void 0:n.requireAuth}))}))}var et;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(et||(et={}));var tt=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext,o=this;this._queueMap=new Map,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=a,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof L&&(o._connectionState=e.stateType)})),this._onlineDetector=s}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===D.CONNECTED||this._connectionState===D.CONNECTING||this._connectionState===D.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){switch(s.label){case 0:return n=this._createSendFileMessageRequestParams(e,t),this._shouldSendThroughWebSocket?(r=new Ye(n),[4,this._requestQueue.send(r)]):[3,2];case 1:return i=s.sent(),[2,i.as(Xe).message];case 2:return r=new Je(o(o({},n),{userId:this._sdkState.userId})),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),[2,i.as(Ze).message]}}))}))},e.prototype._createSendFileMessageRequestParams=function(e,t){var n=o(o({},t.params),{channelUrl:e.url,channelType:e.channelType,reqId:t.requestId,url:""});if(t.multipleFileUploadInfo){var r=t.params;n.files=r.fileInfoList}else{r=t.params;n.url=r.fileUrl,n.requireAuth=r.requireAuth}return n},e.prototype._resolveMessageQueue=function(e){var t;return S(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,c,l,d,h,f,p;return N(this,(function(v){switch(v.label){case 0:if(!(n=this._queueMap.get(e.url)))return[3,21];if(n.isResolving)return[3,20];n.isResolving=!0,r=[],i=!0,v.label=1;case 1:v.trys.push([1,15,16,17]),s=m(n.messageQueue),a=s.next(),v.label=2;case 2:if(a.done)return[3,14];switch(o=a.value,o.state){case et.PENDING:case et.UPLOADING:return[3,3];case et.UPLOADED:return[3,4];case et.FAILED:return[3,12]}return[3,13];case 3:return i=!1,r.push(o),[3,13];case 4:if(!i)return[3,10];v.label=5;case 5:return v.trys.push([5,8,,9]),o.state=et.SENDING,[4,this._sendFileMessage(e,o)];case 6:return u=v.sent(),o.deferred.resolve(u),[4,q(100)];case 7:return v.sent(),[3,9];case 8:return c=v.sent(),o.deferred.reject(c),[3,9];case 9:return[3,11];case 10:r.push(o),v.label=11;case 11:return[3,13];case 12:return l=null!==(t=o.error)&&void 0!==t?t:U.unknown,o.deferred.reject(l.code===F.REQUEST_CANCELED?U.fileUploadCanceled:l),[3,13];case 13:return a=s.next(),[3,2];case 14:return[3,17];case 15:return d=v.sent(),f={error:d},[3,17];case 16:try{a&&!a.done&&(p=s.return)&&p.call(s)}finally{if(f)throw f.error}return[7];case 17:return h=n.isResolveRequestPending,n.messageQueue=r,n.isResolving=!1,n.isResolveRequestPending=!1,h?[4,this._resolveMessageQueue(e)]:[3,19];case 18:v.sent(),v.label=19;case 19:return[3,21];case 20:n.isResolveRequestPending=!0,v.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){var t;return S(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,c,l;return N(this,(function(d){switch(d.label){case 0:return(n=this._queueMap.get(e.url))&&(r=n.messageQueue.find((function(e){return e.state===et.PENDING})))?r.multipleFileUploadInfo?(i=r.multipleFileUploadInfo,s=i.uploadIndex,a=i.uploadCount,o=i.requestHandler,l=r.params,u=l.fileInfoList[s],!z(u.file)||(null===(t=u._uploadedMetaData)||void 0===t?void 0:t.isUploaded)?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]):[3,4]:[3,9];case 1:return d.sent(),[3,3];case 2:r.state=s<a-1?et.PENDING:et.UPLOADED,d.label=3;case 3:return c=r.multipleFileUploadInfo.uploadIndex++,r.multipleFileUploadInfo.isCopy||null==o||o._triggerOnFileUploaded(r.requestId,c,u,r.error),[3,7];case 4:return l=r.params,z(l.file)?[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]:[3,6];case 5:return d.sent(),[3,7];case 6:l.thumbnailSizes=[],r.state=et.UPLOADED,d.label=7;case 7:return this._uploadNextPendingItem(e),[4,this._resolveMessageQueue(e)];case 8:d.sent(),d.label=9;case 9:return[2]}}))}))},e.prototype._tryUploadNextItemAndUpdateItemState=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i,s,a,o,u;return N(this,(function(c){switch(c.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(r=c.sent(),!w.of(this._iid).sessionManager.currentUser||!r)return n.error=U.connectionRequired,n.state=et.FAILED,[2];if(!(t.uploadQueue.length<6))return[3,9];n.state=et.UPLOADING,t.uploadQueue.push(n),c.label=2;case 2:return c.trys.push([2,7,,8]),n.multipleFileUploadInfo?(i=n.multipleFileUploadInfo,s=i.uploadIndex,a=i.uploadCount,o=n.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,n,o)]):[3,4];case 3:return c.sent(),n.state=s<a-1?et.PENDING:et.UPLOADED,[3,6];case 4:return o=n.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(e,n,o)];case 5:c.sent(),n.state=et.UPLOADED,c.label=6;case 6:return[3,8];case 7:switch((u=c.sent()).code){case F.REQUEST_FAILED:n.error=new U({code:F.NETWORK_ERROR,message:"Failed to upload a file."});break;case F.REQUEST_CANCELED:n.error=U.fileUploadCanceled;break;default:n.error=u}return n.state=et.FAILED,[3,8];case 8:this._dequeueUploadItem(t,n),c.label=9;case 9:return[2]}}))}))},e.prototype._dequeueUploadItem=function(e,t){var n=e.uploadQueue.findIndex((function(e){return e.requestId===t.requestId}));n>=0&&e.uploadQueue.splice(n,1)},e.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(e,t,n){var r,i,s;return S(this,void 0,void 0,(function(){var a,o,u,c,l,d,h,f,p,m;return N(this,(function(v){switch(v.label){case 0:return a=new Te({file:n.file,channelUrl:e.url,thumbnailSizes:n.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(a)];case 1:return o=v.sent(),u=o.as(we),c=u.url,l=u.fileSize,d=void 0===l?n.fileSize:l,h=u.thumbnailSizes,f=void 0===h?n.thumbnailSizes:h,p=u.requireAuth,m=void 0!==p&&p,n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(i=n.mimeType)&&void 0!==i?i:n.file.type,n.fileSize=null!==(s=n.fileSize)&&void 0!==s?s:n.file.size,n.fileUrl=c,n.fileSize=d,n.thumbnailSizes=f,n.requireAuth=m,[2]}}))}))},e.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(e,t,n){var r,i,s;return S(this,void 0,void 0,(function(){var a,u,c,l,d,h,f,p,m,v,y,_;return N(this,(function(g){switch(g.label){case 0:return a=t.multipleFileUploadInfo.uploadIndex,u=n.fileInfoList[a],c=new Te({file:u.file,channelUrl:e.url,thumbnailSizes:u.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(c)];case 1:return l=g.sent(),d=l.as(we),h=d.url,f=d.fileSize,p=void 0===f?u.fileSize:f,m=d.thumbnailSizes,v=void 0===m?u.thumbnailSizes:m,y=d.requireAuth,_=void 0!==y&&y,u.fileName=null!==(r=u.fileName)&&void 0!==r?r:u.file.name,u.mimeType=null!==(i=u.mimeType)&&void 0!==i?i:u.file.type,u.fileSize=null!==(s=u.fileSize)&&void 0!==s?s:u.file.size,u.file=void 0,u.fileUrl=h,u.fileSize=p,u.thumbnailSizes=v,u._uploadedMetaData=o(o({},u._uploadedMetaData),{requireAuth:_,isUploaded:!0}),[2]}}))}))},e.prototype.request=function(e,t,n,r){return void 0===r&&(r={}),S(this,void 0,void 0,(function(){var i,s,a,u,c;return N(this,(function(l){return this._queueMap.has(e.url)||(i={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(e.url,i)),s=this._queueMap.get(e.url),a=new B,u={requestId:t,params:n,state:et.PENDING,deferred:a},function(e){return"fileInfoList"in e}(n)&&(c=o({uploadIndex:0,uploadCount:n.fileInfoList.length},r),u.multipleFileUploadInfo=c),s.messageQueue.push(u),this._uploadNextPendingItem(e),[2,a.promise]}))}))},e.prototype.cancel=function(e,t){var n,r,i=this._queueMap.get(e.url);if(i){var s=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:f([],p(i.messageQueue),!1);try{for(var a=m(s),o=a.next();!o.done;o=a.next()){var u=o.value;if(u)switch(u.state){case et.PENDING:if(u.state=et.FAILED,u.error=U.requestCanceled,u.multipleFileUploadInfo&&!u.multipleFileUploadInfo.isCopy){var c=u.multipleFileUploadInfo,l=c.uploadIndex,d=c.requestHandler,h=u.params.fileInfoList[l];null==d||d._triggerOnFileUploaded(u.requestId,l,h,U.fileUploadCanceled)}this._resolveMessageQueue(e);break;case et.UPLOADING:this._requestQueue.cancel(u.requestId)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}},e}();var nt,rt={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:M.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:K.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},it=function(e){return d("number",e.prevResultSize)&&d("number",e.nextResultSize)&&d("boolean",e.isInclusive)&&d("boolean",e.reverse)&&d("string",e.messageTypeFilter)&&h(M,e.messageTypeFilter)&&l("string",e.customTypesFilter,!0)&&l("string",e.senderUserIdsFilter,!0)&&h(K,e.replyType)&&d("boolean",e.includeMetaArray)&&d("boolean",e.includeReactions)&&d("boolean",e.includeParentMessageInfo)&&d("boolean",e.includeThreadInfo)&&d("boolean",e.showSubchannelMessagesOnly)},st={replyType:K.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},at=function(e){return h(K,e.replyType)&&d("boolean",e.includeReactions)&&d("boolean",e.includeMetaArray)&&d("boolean",e.includeParentMessageInfo)&&d("boolean",e.includeThreadInfo)},ot=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,l=n.call(this)||this;return l.method=t.GET,l.path="".concat(k(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s)),l.params={is_sdk:!0,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_parent_message_info:c,include_poll_details:!0},l}return e(r,n),r}(i),ut=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=n?He(e,o({},n)):null,r}return e(n,t),n}(s),ct=function(n){function i(e){var i=e.channelType,s=e.channelUrl,o=e.timestamp,u=e.token,c=e.prevResultSize,l=e.nextResultSize,d=e.isInclusive,h=e.reverse,f=e.messageTypeFilter,p=e.customTypesFilter,m=e.senderUserIdsFilter,v=e.replyType,y=e.includeMetaArray,_=e.includeReactions,g=e.parentMessageId,b=e.includeThreadInfo,I=e.includeParentMessageInfo,E=e.showSubchannelMessagesOnly,T=e.checkingHasNext,w=e.checkingContinuousMessages,M=n.call(this)||this;return M.method=t.GET,M.path="".concat(k(i),"/").concat(encodeURIComponent(s),"/messages"),M.params=r(a({is_sdk:!0,prev_limit:c,next_limit:l,include:d,reverse:h,message_ts:o,message_id:u,message_type:null!=f?f:null,custom_types:p,sender_ids:m,include_reply_type:v,with_sorted_meta_array:y,include_reactions:_,parent_message_id:g,include_thread_info:b,include_parent_message_info:I,show_subchannel_message_only:E,include_poll_details:!0,checking_has_next:T,checking_continuous_messages:w})),M}return e(i,n),i}(i),lt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return n.is_continuous_messages&&(r.isContinuousMessages=n.is_continuous_messages),n.has_next&&(r.hasNext=n.has_next),r.messages=n.messages.map((function(t){return He(e,t)})),r}return e(n,t),n}(s),dt=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=e.replyType,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,d=e.includeParentMessageInfo,h=n.call(this)||this;return h.method=t.GET,h.path="".concat(k(r),"/").concat(encodeURIComponent(i),"/messages/changelogs"),h.params={change_ts:s,token:a,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_reply_type:o,include_parent_message_info:d,include_poll_details:!0},h}return e(r,n),r}(i),ht=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.updatedMessages=n.updated.map((function(t){return He(e,t)})),r.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r}return e(n,t),n}(s),ft=function(n){function r(e){var r=e.channelUrl,i=e.scheduledMessageId,s=n.call(this)||this;return s.method=t.GET,s.path="".concat(j,"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i)),s.params={},s}return e(r,n),r}(i),pt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=n?He(e,o({},n)):null,r}return e(n,t),n}(s);!function(e){e.MUTED="muted",e.BANNED="banned"}(nt||(nt={}));var mt=function(){function e(e){var t,n,r,i;this.restrictionType=null,h(nt,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(r=null!==(n=e.end_at)&&void 0!==n?n:e.muted_end_at)&&void 0!==r?r:-1,this.remainingDuration=null!==(i=e.remaining_duration)&&void 0!==i?i:-1}return e.payloadify=function(e){return r(a({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt,remaining_duration:e.remainingDuration}))},e}(),vt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.restrictionInfo=new mt(n),r}return e(n,t),n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),mt.payloadify(e.restrictionInfo))))},n}(u),yt=function(t){function n(e,n){var r,i=this;return(i=t.call(this,e,n)||this).isMuted=!1,i.isMuted=null!==(r=n.is_muted)&&void 0!==r&&r,i}return e(n,t),n}(u),_t=function(){function e(){this._onPending=Q,this._onFailed=Q,this._onSucceeded=Q}return e.prototype._trigger=function(e){switch(null==e?void 0:e.sendingStatus){case E.PENDING:0===e.errorCode&&this._onPending(e);break;case E.SCHEDULED:case E.SUCCEEDED:this._onSucceeded(e)}},e.prototype._triggerFailed=function(e,t){switch(null==t?void 0:t.sendingStatus){case E.FAILED:case E.CANCELED:this._onFailed(e,t.scheduledInfo?null:t)}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),gt={data:void 0,customType:void 0,mentionType:I.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1},bt=function(e){return d("string",e.data,!0)&&d("string",e.customType,!0)&&h(I,e.mentionType)&&l("string",e.mentionedUserIds,!0)&&l(u,e.mentionedUsers,!0)&&d("string",e.mentionedMessageTemplate,!0)&&l(Ce,e.metaArrays,!0)&&d("number",e.parentMessageId,!0)&&d("boolean",e.isReplyToChannel)&&h(O,e.pushNotificationDeliveryOption,!0)&&d(ke,e.appleCriticalAlertOptions,!0)&&d("boolean",e.isPinnedMessage,!0)},It=function(e){return{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}},Et=o(o({},gt),{message:"",translationTargetLanguages:void 0,pollId:void 0});function Tt(e){var t,n,r;return null!==(t=e.messageParams)&&void 0!==t?t:a(o(o({},e),{mentionType:e.mentionType,mentionedUserIds:null!==(n=e.mentionedUserIds)&&void 0!==n?n:null===(r=e.mentionedUsers)||void 0===r?void 0:r.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(e.translations),pushNotificationDeliveryOption:O.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}))}var wt,Mt=function(e){var t;return r(a({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)}))},St=function(e){return bt(e)&&d("string",e.message)&&l("string",e.translationTargetLanguages,!0)&&d("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(wt||(wt={}));var Nt=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},At=function(e){return e===wt.BLOB||e===wt.FILE},Ut=function(e){return{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}},Ct=o(o({},gt),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1});function Ot(e){var t,n,r,i;return null!==(t=e.messageParams)&&void 0!==t?t:a(o(o({},e),{fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,mentionType:e.mentionType,mentionedUserIds:null!==(n=e.mentionedUserIds)&&void 0!==n?n:null===(r=e.mentionedUsers)||void 0===r?void 0:r.map((function(e){return e.userId})),pushNotificationDeliveryOption:O.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(i=e.thumbnails)||void 0===i?void 0:i.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:e.requireAuth,isPinnedMessage:!1}))}var Pt,kt=function(e,t){var n;return e.messageParams?(!e.url&&z(t)&&(e.messageParams.file=t),e.messageParams):r(a({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:null===(n=e.thumbnails)||void 0===n?void 0:n.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))}))},Rt=function(e){return bt(e)&&(z(e.file)||d("string",e.fileUrl))&&d("string",e.fileName,!0)&&d("string",e.mimeType,!0)&&d("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return d("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},xt={data:void 0,customType:void 0,mentionType:I.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},Lt=function(e){return d("string",e.data,!0)&&d("string",e.customType,!0)&&h(I,e.mentionType)&&l("string",e.mentionedUserIds,!0)&&l(u,e.mentionedUsers,!0)&&d("string",e.mentionedMessageTemplate,!0)&&l(Ce,e.metaArrays,!0)&&h(O,e.pushNotificationDeliveryOption,!0)&&d(ke,e.appleCriticalAlertOptions,!0)},Dt=o(o({},xt),{message:void 0,translationTargetLanguages:void 0,pollId:void 0}),Ft=function(e){return Lt(e)&&d("string",e.message,!0)&&l("string",e.translationTargetLanguages,!0)&&d("number",e.pollId,!0)},qt=o({},xt),zt=function(n){function r(e){var r=e.channelUrl,i=e.channelType,s=e.token,a=e.limit,o=n.call(this)||this;return o.method=t.GET,o.path="".concat(k(i),"/").concat(encodeURIComponent(r),"/operators"),o.params={token:s,limit:a},o}return e(r,n),r}(i),Bt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.operators=n.operators.map((function(t){return new u(e,t)})),r.token=n.next,r}return e(n,t),n}(s),Kt=function(t){function n(e,n,r,i){return t.call(this,e,n,r,i)||this}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a;return N(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=w.of(this._iid).requestQueue,n=new zt(o(o({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(n)]):[3,2]):[3,5];case 1:return r=u.sent(),i=r.as(Bt),s=i.operators,a=i.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return[2,e];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(G),jt=function(t){function n(e,n,r,i){var s,a,o,u,c,l,d,h,f,p,m=this;return(m=t.call(this,e,n,r,i)||this).reverse=!1,m.messageTypeFilter=M.ALL,m.customTypesFilter=null,m.senderUserIdsFilter=null,m.replyType=K.NONE,m.includeMetaArray=!1,m.includeReactions=!1,m.includeParentMessageInfo=!1,m.includeThreadInfo=!1,m.showSubchannelMessagesOnly=!1,m._edge=Number.MAX_SAFE_INTEGER,m.reverse=null!==(s=i.reverse)&&void 0!==s&&s,m.messageTypeFilter=null!==(a=i.messageTypeFilter)&&void 0!==a?a:M.ALL,m.customTypesFilter=null!==(o=i.customTypesFilter)&&void 0!==o?o:null,m.senderUserIdsFilter=null!==(u=i.senderUserIdsFilter)&&void 0!==u?u:null,m.replyType=null!==(c=i.replyType)&&void 0!==c?c:K.NONE,m.includeMetaArray=null!==(l=i.includeMetaArray)&&void 0!==l&&l,m.includeReactions=null!==(d=i.includeReactions)&&void 0!==d&&d,m.includeParentMessageInfo=null!==(h=i.includeParentMessageInfo)&&void 0!==h&&h,m.includeThreadInfo=null!==(f=i.includeThreadInfo)&&void 0!==f&&f,m.showSubchannelMessagesOnly=null!==(p=i.showSubchannelMessagesOnly)&&void 0!==p&&p,m}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&d("boolean",this.reverse)&&h(M,this.messageTypeFilter)&&h(K,this.replyType)&&l("string",this.customTypesFilter,!0)&&l("string",this.senderUserIdsFilter,!0)&&d("boolean",this.includeMetaArray)&&d("boolean",this.includeReactions)&&d("boolean",this.includeParentMessageInfo)&&d("boolean",this.includeThreadInfo)&&d("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,is.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,a({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,f([Number.MAX_SAFE_INTEGER],p(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(G),Qt=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.limit,o=e.token;return(r=n.call(this)||this).method=t.GET,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={limit:a,token:o},r}return e(r,n),r}(i),Gt=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.mutedUsers=[];var i=n.next,s=n.muted_list;return r.token=i,s&&s.length>0&&(r.mutedUsers=s.map((function(t){return new vt(e,t)}))),r}return e(n,t),n}(s),Vt=function(t){function n(e,n,r,i){return t.call(this,e,n,r,i)||this}return e(n,t),n.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=w.of(this._iid).requestQueue,t=new Qt(o(o({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=a.sent(),r=n.as(Gt),i=r.mutedUsers,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(G),Ht=function(n){function i(e){var i=this,s=e.channelUrl,a=e.channelType,o=e.limit,u=e.token;return(i=n.call(this)||this).method=t.GET,i.path="".concat(k(a),"/").concat(encodeURIComponent(s),"/ban"),i.params=r({limit:o,token:u}),i}return e(i,n),i}(i),Wt=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.bannedUsers=[];var i=n.next,s=n.banned_list;return r.token=i,s&&s.length>0&&(r.bannedUsers=s.map((function(t){return new vt(e,t.user)}))),r}return e(n,t),n}(s),Yt=function(t){function n(e,n,r,i){return t.call(this,e,n,r,i)||this}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=w.of(this._iid).requestQueue,t=new Ht(o(o({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=a.sent(),r=n.as(Wt),i=r.bannedUsers,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(G);!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate"}(Pt||(Pt={}));var Jt=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return(r=n.call(this)||this).method=t.POST,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Xt=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return e(r,n),r}(i);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(s);var Zt=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=t.GET,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/mute/").concat(a),r}return e(r,n),r}(i),$t=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.isMuted=!1,r.startAt=0,r.endAt=0;var i=n.is_muted,s=n.start_at,a=n.end_at,o=n.remaining_duration,u=n.description;return r.isMuted=i,r.startAt=s,r.endAt=a,r.remainingDuration=o,r.description=u,r}return e(n,t),n}(s),en=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return(r=n.call(this)||this).method=t.GET,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={keys:a,include_ts:!0},r}return e(r,n),r}(i),tn=function(t){function n(e,n){var r=t.call(this,e,n)||this,i=n.metadata,s=n.ts;return r.metadata=i,r.ts=s,r}return e(n,t),n}(s),nn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata;return(r=n.call(this)||this).method=t.POST,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0},r}return e(r,n),r}(i),rn=function(t){function n(e,n){var r,i,s=this;return(s=t.call(this,e,n)||this).metaData=null!==(r=n.metadata)&&void 0!==r?r:{},s.ts=null!==(i=n.ts)&&void 0!==i?i:null,s}return e(n,t),n}(s),sn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata,o=e.upsert;return(r=n.call(this)||this).method=t.PUT,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0,upsert:null!=o&&o},r}return e(r,n),r}(i),an=function(t){function n(e,n){var r=t.call(this,e,n)||this,i=n.metadata,s=n.ts;return r.metadata=i,r.ts=s,r}return e(n,t),n}(s),on=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return e(n,t),n}(x),un=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(a),r.params={include_ts:!0},r}return e(r,n),r}(i),cn=function(t){function n(e,n){var r=t.call(this,e,n)||this,i=n.ts;return r.ts=i,r}return e(n,t),n}(s),ln=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={include_ts:!0},r}return e(r,n),r}(i),dn=function(t){function n(e,n){var r=t.call(this,e,n)||this,i=n.ts;return r.ts=i,r}return e(n,t),n}(s),hn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return(r=n.call(this)||this).method=t.GET,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={keys:a},r}return e(r,n),r}(i),fn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.metaCounter=n,r}return e(n,t),n}(s),pn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter;return(r=n.call(this)||this).method=t.POST,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a},r}return e(r,n),r}(i),mn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.metaCounter=n,r}return e(n,t),n}(s),vn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter,o=e.upsert,u=void 0!==o&&o,c=e.mode,l=void 0===c?"set":c;return(r=n.call(this)||this).method=t.PUT,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a,upsert:u,mode:l},r}return e(r,n),r}(i),yn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.metaCounter=n,r}return e(n,t),n}(s),_n=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return e(n,t),n}(x),gn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(a),r.params={},r}return e(r,n),r}(i);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(s);var bn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={},r}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var In=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId,o=e.seconds,u=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={user_id:a,seconds:o,description:u},r}return e(r,n),r}(i);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(s);var En=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.user=new vt(e,r.data),i}return e(n,t),n}(x),Tn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(a)),r}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var wn=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.user=new vt(e,r.data),i}return e(n,t),n}(x),Mn=function(n){function i(e){var i=this,s=e.channelUrl,a=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(i=n.call(this)||this).method=t.POST,i.path="".concat(k(a),"/").concat(encodeURIComponent(s),"/ban"),i.params=r({user_id:o,seconds:u,description:c}),i}return e(i,n),i}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Sn=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.user=new vt(e,r.data),r.data.member_count&&(i.memberCount=r.data.member_count),r.data.joined_member_count&&(i.joinedMemberCount=r.data.joined_member_count),i}return e(n,t),n}(x),Nn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(a)),r}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var An=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.user=new vt(e,r.data),i}return e(n,t),n}(x),Un=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.freezing;return(r=n.call(this)||this).method=t.PUT,r.path="".concat(k(s),"/").concat(encodeURIComponent(i),"/freeze"),r.params={freeze:a},r}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Cn=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.freeze=r.data.freeze,i}return e(n,t),n}(x),On=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(V(s),"/").concat(encodeURIComponent(i)),r.params={report_category:a,reporting_user_id:o,report_description:u},r}return e(r,n),r}(i),Pn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(H,"/users/").concat(u),r.params={channel_url:i,channel_type:s===b.OPEN?"open_channels":"group_channels",report_category:a,reporting_user_id:o,report_description:c},r}return e(r,n),r}(i),kn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.messageId,l=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(V(s),"/").concat(encodeURIComponent(i),"/messages/").concat(c),r.params={report_category:a,reporting_user_id:o,report_description:l,offending_user_id:u},r}return e(r,n),r}(i),Rn=function(t){function n(e){var n=[];return e.mentionType===I.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"MESG",ackRequired:!0,payload:r(a({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==O.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage}))})||this}return e(n,t),n}(P),xn=function(t){function n(e,n,r){var i,s,a,o,u=this;(u=t.call(this,e,"MESG",r)||this).message=new je(e,r);var c=w.of(e).sdkState;return u.isMentioned=R(u.message.mentionType,null!==(a=null!==(i=u.message.mentionedUserIds)&&void 0!==i?i:null===(s=u.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})))&&void 0!==a?a:[],c.userId),u.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,u}return e(n,t),n}(x),Ln=function(t){function n(e){var n=null;return e.mentionType===I.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"MEDI",ackRequired:!0,payload:r(a({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:n,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,poll_id:e.pollId}))})||this}return e(n,t),n}(P),Dn=function(t){function n(e,n,r){var i,s,o,u,c,l=this;(l=t.call(this,e,"MEDI",r)||this).message=new je(e,r);var d=w.of(e).sdkState;return l.mentionCountChange=W({mentionType:null===(i=r.old_values)||void 0===i?void 0:i.mention_type,mentionedUserIds:null!==(o=null===(s=r.old_values)||void 0===s?void 0:s.mentioned_user_ids)&&void 0!==o?o:[]},a({mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))}),d.userId),l}return e(n,t),n}(x),Fn=function(t){function n(e){var n=null;return e.mentionType===I.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"FEDI",ackRequired:!0,payload:r(a({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:n,apple_critical_alert_options:e.appleCriticalAlertOptions}))})||this}return e(n,t),n}(P),qn=function(t){function n(e,n,r){var i,s,o,u,c,l=this;(l=t.call(this,e,"FEDI",r)||this).message=new We(e,r);var d=w.of(e).sdkState;return l.mentionCountChange=W({mentionType:null===(i=r.old_values)||void 0===i?void 0:i.mention_type,mentionedUserIds:null!==(o=null===(s=r.old_values)||void 0===s?void 0:s.mentioned_user_ids)&&void 0!==o?o:[]},a({mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))}),d.userId),l}return e(n,t),n}(x),zn=function(n){function r(e){var r=n.call(this)||this;return r.method=t.DELETE,r.path="".concat(k(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),r}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Bn=function(t){function n(e,n,r){var i=t.call(this,e,"DELM",r)||this;return i.channelUrl=r.channel_url,i.channelType=r.channel_type,i.messageId=Number(r.msg_id),i}return e(n,t),n}(x),Kn=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=t.POST,o.path="".concat(k(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return e(r,n),r}(i),jn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.reactionEvent=new Ae(n),r}return e(n,t),n}(s),Qn=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=t.DELETE,o.path="".concat(k(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return e(r,n),r}(i),Gn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.reactionEvent=new Ae(o({},n)),r}return e(n,t),n}(s),Vn=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.translationTargetLanguages,o=n.call(this)||this;return o.method=t.POST,o.path="".concat(k(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s),"/translation"),o.params={target_langs:a},o}return e(r,n),r}(i),Hn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new je(e,n),r}return e(n,t),n}(s),Wn=function(n){function i(e){var i,s=this;s=n.call(this)||this;var o=[];e.mentionType===I.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map((function(e){return e.userId}))));var u=e.channelType,c=e.channelUrl;return s.method=t.POST,s.path="".concat(k(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),s.params=r(a({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Y.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((function(e){return Ce.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),s}return e(i,n),i}(i),Yn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new je(e,n),r}return e(n,t),n}(s),Jn=function(n){function r(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===I.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl;return i.method=t.POST,i.path="".concat(k(o),"/").concat(encodeURIComponent(u),"/scheduled_messages"),i.params=a({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Y.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return Fe.payloadify(e)})):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=e.metaArrays)||void 0===r?void 0:r.map((function(e){return Ce.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption}),i}return e(r,n),r}(i),Xn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new We(e,n),r}return e(n,t),n}(s),Zn=function(n){function r(e){var r=e.pollId,i=e.title,s=e.data,a=e.allowUserSuggestion,o=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=t.PUT,c.path="".concat(X,"/").concat(encodeURIComponent(r)),c.params={title:i,data:s,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},c}return e(r,n),r}(i),$n=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new C(e,n),r}return e(n,t),n}(s),er=function(n){function r(e){var r=e.pollId,i=n.call(this)||this;return i.method=t.DELETE,i.path="".concat(X,"/").concat(encodeURIComponent(r)),i}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var tr=function(n){function r(e){var r=e.pollId,i=n.call(this)||this;return i.method=t.PUT,i.path="".concat(X,"/").concat(encodeURIComponent(r),"/close"),i}return e(r,n),r}(i),nr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new C(e,n),r}return e(n,t),n}(s),rr=function(n){function r(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.optionText,o=n.call(this)||this;return o.method=t.POST,o.path="".concat(X,"/").concat(encodeURIComponent(s),"/options"),o.params={channel_url:r,channel_type:i,text:a},o}return e(r,n),r}(i),ir=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new C(e,n),r}return e(n,t),n}(s),sr=function(n){function r(e){var r=e.pollId,i=e.pollOptionId,s=e.optionText,a=n.call(this)||this;return a.method=t.PUT,a.path="".concat(X,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),a.params={text:s},a}return e(r,n),r}(i),ar=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new C(e,n),r}return e(n,t),n}(s),or=function(n){function r(e){var r=e.pollId,i=e.pollOptionId,s=n.call(this)||this;return s.method=t.DELETE,s.path="".concat(X,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),s}return e(r,n),r}(i);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var ur=function(t){function n(e){var n=e.reqId,i=e.channelType,s=e.channelUrl,a=e.pollId,o=e.pollOptionIds;return t.call(this,{code:"VOTE",ackRequired:!0,payload:r({req_id:n,channel_type:i===b.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:a,option_ids:o})})||this}return e(n,t),n}(P),cr=function(t){function n(e,n,r){var i=t.call(this,e,"VOTE",r)||this;return i.event=new Z(r),i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return e(n,t),n}(x),lr=100,dr="GroupChannel",hr="url",fr=100,pr="Message",mr="messageId",vr="Poll",yr="pollId",_r=100,gr="FeedChannel",br="url";function Ir(e){var t,n,r;return null!==(t=e.messageParams)&&void 0!==t?t:a(o(o({},e),{isReplyToChannel:!1,mentionedUserIds:null!==(n=e.mentionedUserIds)&&void 0!==n?n:null===(r=e.mentionedUsers)||void 0===r?void 0:r.map((function(e){return e.userId})),pushNotificationDeliveryOption:O.DEFAULT,isPinnedMessage:!1,fileInfoList:e.fileInfoList.map((function(e){var t;return{fileUrl:e.plainUrl,fileName:e.fileName,fileSize:e.fileSize,mimeType:e.mimeType,thumbnailSizes:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),_uploadedMetaData:{requireAuth:e._requireAuth,isUploaded:!0}}}))}))}var Er,Tr=o(o({},gt),{fileInfoList:[]}),wr=function(e){return(z(e.file)||d("string",e.fileUrl))&&d("string",e.fileName,!0)&&d("string",e.mimeType,!0)&&d("number",e.fileSize,!0)&&(void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return e.maxWidth>0&&e.maxHeight>0})))},Mr=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._onFileUploaded=Q,e}return e(n,t),n.prototype._triggerOnFileUploaded=function(e,t,n,r){this._onFileUploaded(e,t,n,r)},n.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},n.prototype.onPending=function(e){return t.prototype.onPending.call(this,e),this},n.prototype.onFailed=function(e){return t.prototype.onFailed.call(this,e),this},n.prototype.onSucceeded=function(e){return t.prototype.onSucceeded.call(this,e),this},n}(_t),Sr=2;!function(e){e.SEND="send",e.RESEND="resend",e.COPY="copy"}(Er||(Er={}));var Nr,Ar=function(t){function n(e,n){var r,i,s,a,o,c,l=this;return(l=t.call(this,e)||this)._name="",l._createdAt=0,l.channelType=b.BASE,l.coverUrl="",l.customType="",l.data="",l.isFrozen=!1,l.isEphemeral=!1,l.creator=null,l._messageCollectionLastAccessedAt=0,l._url=n.channel_url,l._name=null!==(r=n.name)&&void 0!==r?r:"",l._createdAt=1e3*n.created_at,l.coverUrl=null!==(i=n.cover_url)&&void 0!==i?i:"",l.customType=null!==(s=n.custom_type)&&void 0!==s?s:"",l.data=null!==(a=n.data)&&void 0!==a?a:"",l.isFrozen=null!==(o=n.freeze)&&void 0!==o&&o,l.isEphemeral=null!==(c=n.is_ephemeral)&&void 0!==c&&c,l.creator=n.created_by?new u(l._iid,n.created_by):null,n.metadata&&Object.keys(n.metadata).length>0&&n.ts&&(l._cachedMetaData=new Map,Object.keys(n.metadata).forEach((function(e){l._cachedMetaData.set(e,{value:n.metadata[e],isRemoved:!1,updatedAt:n.ts})}))),l}return e(n,t),Object.defineProperty(n.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return o(o({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},n.payloadify=function(e){return r(a(o(o({},t.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?u.payloadify(e.creator):null,created_at:e.createdAt/1e3})))},n.prototype.isGroupChannel=function(){return this.channelType===b.GROUP},n.prototype.isOpenChannel=function(){return this.channelType===b.OPEN},n.prototype.isFeedChannel=function(){return this.channelType===b.FEED},Object.defineProperty(n.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData?(this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e):e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),n.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now()},n.prototype._update=function(e){var t=r(e);Object.assign(this,t)},n.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){n._cachedMetaData||(n._cachedMetaData=new Map);var i=n._cachedMetaData.get(r);(!i||i.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))},n.prototype._updateCachedMetaData=function(e,t){var n=this;this._cachedMetaData?this._cachedMetaData.forEach((function(r,i){var s;r.updatedAt<=t&&n._cachedMetaData.set(i,{value:null!==(s=e[i])&&void 0!==s?s:r.value,isRemoved:!e[i],updatedAt:t})})):(this._cachedMetaData=new Map,Object.keys(e).forEach((function(r){n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})})))},n.prototype._removeFromCachedMetaData=function(e,t){var n=this;this._cachedMetaData&&e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!0,r.updatedAt=t)}))},n.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)},n.prototype._generateRequestId=function(){return"rq-".concat(ee())},n.prototype.isIdentical=function(e){return e&&this.url===e.url},n.prototype.isEqual=function(e){return y(this,e)},n.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new Kt(this._iid,this.url,this.channelType,e)},n.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new Vt(this._iid,this.url,this.channelType,e)},n.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new Yt(this._iid,this.url,this.channelType,e)},n.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new jt(this._iid,this.url,this.channelType,e)},n.prototype.addOperators=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return A(l("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new Jt({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.removeOperators=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return A(l("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new Xt({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.getMyMutedInfo=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u,c,l;return N(this,(function(d){switch(d.label){case 0:return e=w.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Zt({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,n.send(r)];case 1:return i=d.sent(),s=i.as($t),a=s.isMuted,o=s.startAt,u=s.endAt,c=s.remainingDuration,l=s.description,[2,{isMuted:a,startAt:o,endAt:u,remainingDuration:c,description:l}]}}))}))},n.prototype.getMetaData=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return A(l("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new en({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=o.sent(),i=r.as(tn),s=i.metadata,a=i.ts,this._upsertCachedMetaData(s,a),[2,s]}}))}))},n.prototype.getAllMetaData=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return e=w.of(this._iid).requestQueue,t=new en({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=a.sent(),r=n.as(tn),i=r.metadata,s=r.ts,this._updateCachedMetaData(i,s),[2,i]}}))}))},n.prototype.createMetaData=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i;return N(this,(function(s){switch(s.label){case 0:return t=w.of(this._iid).requestQueue,n=new nn({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(rn).metaData,this._upsertCachedMetaData(i,0),[2,i]}}))}))},n.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),S(this,void 0,void 0,(function(){var n,r,i,s,a,o;return N(this,(function(u){switch(u.label){case 0:return n=w.of(this._iid).requestQueue,r=new sn({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,n.send(r)];case 1:return i=u.sent(),s=i.as(an),a=s.metadata,o=s.ts,this._upsertCachedMetaData(a,o),[2,a]}}))}))},n.prototype.deleteMetaData=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i;return N(this,(function(s){switch(s.label){case 0:return A(d("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new un({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(cn).ts,this._removeFromCachedMetaData([e],i),[2]}}))}))},n.prototype.deleteAllMetaData=function(){return S(this,void 0,void 0,(function(){var e,t,n,r;return N(this,(function(i){switch(i.label){case 0:return e=w.of(this._iid).requestQueue,t=new ln({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n=i.sent(),r=n.as(dn).ts,this._removeFromCachedMetaData(f([],p(this._cachedMetaData.keys()),!1),r),[2]}}))}))},n.prototype.getMetaCounters=function(e){return S(this,void 0,void 0,(function(){var t,n,r;return N(this,(function(i){switch(i.label){case 0:return A(l("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new hn({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(fn).metaCounter]}}))}))},n.prototype.getAllMetaCounters=function(){return S(this,void 0,void 0,(function(){var e,t,n;return N(this,(function(r){switch(r.label){case 0:return e=w.of(this._iid).requestQueue,t=new hn({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(fn).metaCounter]}}))}))},n.prototype.createMetaCounters=function(e){return S(this,void 0,void 0,(function(){var t,n,r;return N(this,(function(i){switch(i.label){case 0:return t=w.of(this._iid).requestQueue,n=new pn({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(mn).metaCounter]}}))}))},n.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){switch(s.label){case 0:return n=w.of(this._iid).requestQueue,r=new vn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(yn).metaCounter]}}))}))},n.prototype.increaseMetaCounters=function(e){return S(this,void 0,void 0,(function(){var t,n,r;return N(this,(function(i){switch(i.label){case 0:return t=w.of(this._iid).requestQueue,n=new vn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(yn).metaCounter]}}))}))},n.prototype.decreaseMetaCounters=function(e){return S(this,void 0,void 0,(function(){var t,n,r;return N(this,(function(i){switch(i.label){case 0:return t=w.of(this._iid).requestQueue,n=new vn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(yn).metaCounter]}}))}))},n.prototype.deleteMetaCounter=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return A(d("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new gn({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.deleteAllMetaCounters=function(){return S(this,void 0,void 0,(function(){var e,t;return N(this,(function(n){switch(n.label){case 0:return e=w.of(this._iid).requestQueue,t=new bn({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},n.prototype.muteUser=function(e,t,n){return S(this,void 0,void 0,(function(){return N(this,(function(r){return[2,this.muteUserWithUserId(e.userId,t,n)]}))}))},n.prototype.muteUserWithUserId=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i;return N(this,(function(s){switch(s.label){case 0:return A(d("string",e)&&d("number",t,!0)&&d("string",n,!0)).throw(U.invalidParameters),r=w.of(this._iid).requestQueue,i=new In({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n.prototype.unmuteUser=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){return[2,this.unmuteUserWithUserId(e.userId)]}))}))},n.prototype.unmuteUserWithUserId=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return A(d("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new Tn({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.banUser=function(e,t,n){return S(this,void 0,void 0,(function(){return N(this,(function(r){return[2,this.banUserWithUserId(e.userId,t,n)]}))}))},n.prototype.banUserWithUserId=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i;return N(this,(function(s){switch(s.label){case 0:return A(d("string",e)&&d("number",t,!0)&&d("string",n,!0)).throw(U.invalidParameters),r=w.of(this._iid).requestQueue,i=new Mn({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n.prototype.unbanUser=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){return[2,this.unbanUserWithUserId(e.userId)]}))}))},n.prototype.unbanUserWithUserId=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return A(d("string",e)).throw(U.invalidParameters),t=w.of(this._iid).requestQueue,n=new Nn({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.freeze=function(){return S(this,void 0,void 0,(function(){var e,t;return N(this,(function(n){switch(n.label){case 0:return e=w.of(this._iid).requestQueue,t=new Un({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!0,[2]}}))}))},n.prototype.unfreeze=function(){return S(this,void 0,void 0,(function(){var e,t;return N(this,(function(n){switch(n.label){case 0:return e=w.of(this._iid).requestQueue,t=new Un({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!1,[2]}}))}))},n.prototype.getMessagesByMessageId=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},rt),t),A(d("number",e)&&it(n)).throw(U.invalidParameters),[4,is.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMessagesByTimestamp=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},rt),t),A(d("number",e)&&it(n)).throw(U.invalidParameters),[4,is.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMessageChangeLogsSinceTimestamp=function(e,t){return void 0===t&&(t={}),S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},st),t),A(d("number",e)&&at(n)).throw(U.invalidParameters),[4,is.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMessageChangeLogsSinceToken=function(e,t){return void 0===t&&(t={}),S(this,void 0,void 0,(function(){var n;return N(this,(function(r){switch(r.label){case 0:return n=o(o({},st),t),A(d("string",e)&&at(n)).throw(U.invalidParameters),[4,is.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype._createPendingSendableMessagePayload=function(e,t,n){var i,s=w.of(this._iid).sessionManager;return r(a({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((function(e){return Ce.payloadify(e)})):null,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:s.currentUser?Re.payloadify(s.currentUser):null,req_id:t,request_state:E.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(i=e.mentionedUsers)||void 0===i?void 0:i.map((function(e){return u.payloadify(e)}))}))},n.prototype._createPendingUserMessage=function(e,t,n){var i,s,a={};if(e.translationTargetLanguages)try{for(var u=m(e.translationTargetLanguages),c=u.next();!c.done;c=u.next()){a[c.value]=""}}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}var l=r(o(o({},this._createPendingSendableMessagePayload(e,t,n)),{type:_.USER,message:e.message,translations:a})),d=new je(this._iid,l);return d.messageParams=e,d},n.prototype._createPendingScheduledUserMessage=function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},n.prototype._createPendingFileMessage=function(e,t,n){var i,s,a,u,c,l,d=r(o(o({},this._createPendingSendableMessagePayload(e,t,n)),{type:_.FILE,url:e.fileUrl,file:{name:null!==(i=e.fileName)&&void 0!==i?i:null===(s=e.file)||void 0===s?void 0:s.name,size:null!==(a=e.fileSize)&&void 0!==a?a:null===(u=e.file)||void 0===u?void 0:u.size,type:null!==(c=e.mimeType)&&void 0!==c?c:null===(l=e.file)||void 0===l?void 0:l.type,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),h=new We(this._iid,d);return h.messageParams=e,h},n.prototype._createPendingMultipleFilesMessage=function(e,t,n){var i=r(o(o({},this._createPendingSendableMessagePayload(e,t,n)),{type:_.FILE})),s=new Ge(this._iid,i);return s.messageParams=e,s},n.prototype._validateFailedFileMessageHasFile=function(e,t){var n;return Boolean(e.url)||z(t)||z(null===(n=e.messageParams)||void 0===n?void 0:n.file)},n.prototype._createPendingScheduledFileMessage=function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},n.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===F.REQUEST_CANCELED||t.code===F.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=E.CANCELED:n||(e.sendingStatus=E.FAILED)},n.prototype.sendUserMessage=function(e){var t=o(o({},Et),e);return A(St(t)).throw(U.invalidParameters),this._sendUserMessage(t)},n.prototype._sendUserMessage=function(e,t,n){var r=this;void 0===t&&(t=Er.SEND);var i=w.of(this._iid),s=i.dispatcher,a=i.requestQueue,u=null!=n?n:this._generateRequestId(),c=Date.now(),l=new _t;return q(2).then((function(){var n=r._createPendingUserMessage(e,u,c);s.dispatch(new te({messages:[n],source:t===Er.RESEND?ne.LOCAL_MESSAGE_RESEND_STARTED:ne.EVENT_MESSAGE_SENT_PENDING})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(e){return[2,l._trigger(n)]}))}))}));var i=new Rn(o(o({},e),{channelUrl:r.url,channelType:r.channelType,reqId:u}));a.send(i).then((function(e){var t=e.as(xn).message;s.dispatch(new te({messages:[t],source:ne.EVENT_MESSAGE_SENT_SUCCESS})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(e){return[2,l._trigger(t)]}))}))}))})).catch((function(t){if(ie(t))throw t;q(2).then((function(){var n=r._createPendingUserMessage(e,u,c),i=w.of(r._iid).cacheContext,a=i.localCacheEnabled&&i.localCacheConfig.enableAutoResend&&se(t.code);r._markMessageAsFailed(n,t,a),s.dispatch(new te({messages:[n],source:n.sendingStatus===E.PENDING?ne.REQUEST_RESEND_MESSAGE:ne.EVENT_MESSAGE_SENT_FAILED})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(e){return[2,l._triggerFailed(t,n)]}))}))}))}))}))})),l},n.prototype._autoResendUserMessage=function(e){return A(e instanceof je&&!!e.messageParams).throw(U.invalidParameters),this._sendUserMessage(e.messageParams,Er.SEND,e.reqId)},n.prototype.resendUserMessage=function(e){var t;return S(this,void 0,void 0,(function(){var n,r;return N(this,(function(i){return A(e instanceof je&&!e.scheduledInfo).throw(U.invalidParameters),n=new B,r=null!==(t=e.messageParams)&&void 0!==t?t:Mt(e),this._sendUserMessage(r,Er.RESEND,e.reqId).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},n.prototype.updateUserMessage=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return n=o(o({},Dt),t),A(d("number",e)&&Ft(n)).throw(U.invalidParameters),r=w.of(this._iid).requestQueue,i=new Ln(o({channelType:this.channelType,channelUrl:this.url,messageId:e},n)),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(Dn).message]}}))}))},n.prototype.copyUserMessage=function(e,t){var r,i,s;return S(this,void 0,void 0,(function(){var u,c;return N(this,(function(l){return A(e instanceof n&&t instanceof je&&t.sendingStatus===E.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(U.invalidParameters),A(!t.poll).throw(U.notSupportedError),u=new B,c=null!==(r=t.messageParams)&&void 0!==r?r:a(o(o({},t),{mentionType:t.mentionType,mentionedUserIds:null!==(i=t.mentionedUserIds)&&void 0!==i?i:null===(s=t.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(t.translations),pushNotificationDeliveryOption:O.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(c).onSucceeded((function(e){u.resolve(e)})).onFailed((function(e){return u.reject(e)})),[2,u.promise]}))}))},n.prototype.translateUserMessage=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){switch(s.label){case 0:return A(e instanceof je&&e.messageId>0&&l("string",t)).throw(U.invalidParameters),n=w.of(this._iid).requestQueue,r=new Vn({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Hn).message]}}))}))},n.prototype._createScheduledUserMessage=function(e,t){var n=this,r=w.of(this._iid).requestQueue,i=Date.now(),s=this._generateRequestId();q(2).then((function(){var r=n._createPendingScheduledUserMessage(e,s,i);re((function(){return S(n,void 0,void 0,(function(){return N(this,(function(e){return[2,t._trigger(r)]}))}))}))}));var a=new Wn(o({reqId:s,channelType:this.channelType,channelUrl:this.url},e));r.send(a).then((function(e){var r=e.as(Yn).message;re((function(){return S(n,void 0,void 0,(function(){return N(this,(function(e){return[2,t._trigger(r)]}))}))}))})).catch((function(r){if(ie(r))throw r;q(2).then((function(){var a=n._createPendingScheduledUserMessage(e,s,i);n._markMessageAsFailed(a,r),re((function(){return S(n,void 0,void 0,(function(){return N(this,(function(e){return[2,t._trigger(a)]}))}))}))}))}))},n.prototype.sendFileMessage=function(e){var t=o(o({},Ct),e);return A(Rt(t)).throw(U.invalidParameters),this._sendFileMessage(t)},n.prototype.sendMultipleFilesMessage=function(e){var t,n=o(o({},Tr),e),r=w.of(this._iid);A(function(e,t){return void 0===t&&(t=$),bt(e)&&Array.isArray(e.fileInfoList)&&e.fileInfoList.length>=2&&e.fileInfoList.length<=t&&e.fileInfoList.every((function(e){return wr(e)}))}(n,null===(t=r.appInfo)||void 0===t?void 0:t.multipleFilesMessageFileCountLimit)).throw(U.invalidParameters);var i=!!e.fileInfoList.find((function(e){var t=r.appInfo.uploadSizeLimit;return e.file instanceof Blob&&e.file.size>t||e.fileSize>t}));return A(!i).throw(U.fileSizeLimitExceededError),this._sendMultipleFilesMessage(n)},n.prototype._sendFileMessage=function(e,t,n){var r=this;void 0===t&&(t=Er.SEND);var i=w.of(this._iid).dispatcher,s=is.of(this._iid).fileMessageQueue,a=null!=n?n:this._generateRequestId(),o=Date.now(),u=new _t;return q(2).then((function(){var n=r._createPendingFileMessage(e,a,o);i.dispatch(new te({messages:[n],source:t===Er.RESEND?ne.LOCAL_MESSAGE_RESEND_STARTED:ne.EVENT_MESSAGE_SENT_PENDING})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(e){return[2,u._trigger(n)]}))}))})),s.request(r,a,e).then((function(e){i.dispatch(new te({messages:[e],source:ne.EVENT_MESSAGE_SENT_SUCCESS})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(t){return[2,u._trigger(e)]}))}))}))})).catch((function(t){if(ie(t))throw t;q(2).then((function(){var n=r._createPendingFileMessage(e,a,o),s=w.of(r._iid).cacheContext,c=s.localCacheEnabled&&s.localCacheConfig.enableAutoResend&&se(t.code);r._markMessageAsFailed(n,t,c),i.dispatch(new te({messages:[n],source:n.sendingStatus===E.PENDING?ne.REQUEST_RESEND_MESSAGE:t.code===F.FILE_UPLOAD_CANCEL_FAILED?ne.LOCAL_MESSAGE_CANCELED:ne.EVENT_MESSAGE_SENT_FAILED})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(e){return[2,u._triggerFailed(t,n)]}))}))}))}))}))})),u},n.prototype._autoResendFileMessage=function(e){A(e instanceof We&&!!e.messageParams).throw(U.invalidParameters);var t=w.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,Er.SEND,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))},n.prototype._sendMultipleFilesMessage=function(e,t,n){var r=this,i=w.of(this._iid).dispatcher,s=is.of(this._iid).fileMessageQueue,a=null!=n?n:this._generateRequestId(),o=Date.now(),u=new Mr;return q(2).then((function(){var n=r._createPendingMultipleFilesMessage(e,a,o);i.dispatch(new te({messages:[n],source:t===Er.RESEND?ne.LOCAL_MESSAGE_RESEND_STARTED:ne.EVENT_MESSAGE_SENT_PENDING})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(e){return[2,u._trigger(n)]}))}))})),s.request(r,a,e,{requestHandler:u,isCopy:t===Er.COPY}).then((function(e){i.dispatch(new te({messages:[e],source:ne.EVENT_MESSAGE_SENT_SUCCESS})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(t){return[2,u._trigger(e)]}))}))}))})).catch((function(t){if(ie(t))throw t;q(2).then((function(){var n=r._createPendingMultipleFilesMessage(e,a,o);r._markMessageAsFailed(n,t),i.dispatch(new te({messages:[n],source:ne.EVENT_MESSAGE_SENT_FAILED})),re((function(){return S(r,void 0,void 0,(function(){return N(this,(function(e){return[2,u._triggerFailed(t,n)]}))}))}))}))}))})),u},n.prototype._createScheduledFileMessage=function(e,t,n,r){var i=this,s=w.of(this._iid).requestQueue,a=new Jn(o(o({reqId:n,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));s.send(a).then((function(e){var n=e.as(Xn).message;re((function(){return S(i,void 0,void 0,(function(){return N(this,(function(e){return[2,t._trigger(n)]}))}))}))})).catch((function(s){if(ie(s))throw s;q(2).then((function(){var a=i._createPendingScheduledFileMessage(e,n,r);i._markMessageAsFailed(a,s),re((function(){return S(i,void 0,void 0,(function(){return N(this,(function(e){return[2,t._triggerFailed(s,a)]}))}))}))}))}))},n.prototype.sendFileMessages=function(e){var t,n;A(e.every((function(e){return Rt(o(o({},Ct),e))}))).throw(U.invalidParameters);var r=new _t;try{for(var i=m(e),s=i.next();!s.done;s=i.next()){var a=s.value;this.sendFileMessage(a).onPending((function(e){return r._trigger(e)})).onFailed((function(e,t){return r._triggerFailed(e,t)})).onSucceeded((function(e){return r._trigger(e)}))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},n.prototype.resendFileMessage=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){return n=this._validateFailedFileMessageHasFile(e,t),A(e instanceof We&&n&&!e.scheduledInfo).throw(U.invalidParameters),r=new B,i=kt(e,t),this._sendFileMessage(i,Er.RESEND,e.reqId).onFailed((function(e){return r.reject(e)})).onSucceeded((function(e){return r.resolve(e)})),[2,r.promise]}))}))},n.prototype.resendMessage=function(e,t){var n,r;if(A(e instanceof De&&!e.scheduledInfo&&e.isResendable).throw(U.invalidParameters),e.isUserMessage()){var i=null!==(n=e.messageParams)&&void 0!==n?n:Mt(e);return this._sendUserMessage(i,Er.RESEND,e.reqId)}if(e.isFileMessage()){var s=this._validateFailedFileMessageHasFile(e,t);A(s).throw(U.invalidParameters);i=null!==(r=e.messageParams)&&void 0!==r?r:kt(e,t);return this._sendFileMessage(i,Er.RESEND,e.reqId)}if(e.isMultipleFilesMessage())throw U.channelTypeNotSupportedError},n.prototype.updateFileMessage=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return n=o(o({},qt),t),A(d("number",e)&&function(e){return Lt(e)}(n)).throw(U.invalidParameters),r=w.of(this._iid).requestQueue,i=new Fn(o({channelType:this.channelType,channelUrl:this.url,messageId:e},n)),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(qn).message]}}))}))},n.prototype.cancelUploadingFileMessage=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){return A(d("string",e)).throw(U.invalidParameters),is.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},n.prototype.copyFileMessage=function(e,t){var r,i,s;return S(this,void 0,void 0,(function(){var u,c;return N(this,(function(l){return A(e instanceof n&&t instanceof We&&t.sendingStatus===E.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(U.invalidParameters),u=new B,c=a(o(o({},t),{fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,mentionType:t.mentionType,mentionedUserIds:null!==(r=t.mentionedUserIds)&&void 0!==r?r:null===(i=t.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),pushNotificationDeliveryOption:O.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(s=t.thumbnails)||void 0===s?void 0:s.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:t.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(c).onSucceeded((function(e){return u.resolve(e)})).onFailed((function(e){return u.reject(e)})),[2,u.promise]}))}))},n.prototype.copyMessage=function(e,t){A(e instanceof n&&t instanceof De&&t.sendingStatus===E.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(U.invalidParameters);var r=t,i=e;if(r.isUserMessage()){A(!r.poll).throw(U.notSupportedError);var s=Tt(r);return i._sendUserMessage(s)}if(r.isFileMessage()){s=Ot(r);return i._sendFileMessage(s)}if(t.isMultipleFilesMessage())throw U.channelTypeNotSupportedError},n.prototype.deleteMessage=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return A(e instanceof Le).throw(U.invalidParameters),e.messageId>0?(t=w.of(this._iid).requestQueue,n=new zn({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,t.send(n)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},n.prototype.addReaction=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){switch(s.label){case 0:return A(e instanceof Le&&e.messageId>0&&d("string",t)).throw(U.invalidParameters),n=w.of(this._iid).requestQueue,r=new Kn({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(jn).reactionEvent]}}))}))},n.prototype.deleteReaction=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){switch(s.label){case 0:return A(e instanceof Le&&e.messageId>0&&d("string",t)).throw(U.invalidParameters),n=w.of(this._iid).requestQueue,r=new Qn({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Gn).reactionEvent]}}))}))},n.prototype._updateUserMessageMetaArray=function(e,t,n,r){return S(this,void 0,void 0,(function(){var i,s,a,o,u,c;return N(this,(function(l){switch(l.label){case 0:return i=w.of(this._iid),s=i.dispatcher,a=i.requestQueue,o=new Ln({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,a.send(o)];case 1:return u=l.sent(),c=u.as(Dn).message,s.dispatch(new te({messages:[c],source:ne.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},n.prototype._updateFileMessageMetaArray=function(e,t,n,r){return S(this,void 0,void 0,(function(){var i,s,a,o,u,c;return N(this,(function(l){switch(l.label){case 0:return i=w.of(this._iid),s=i.dispatcher,a=i.requestQueue,o=new Fn({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,a.send(o)];case 1:return u=l.sent(),c=u.as(qn).message,s.dispatch(new te({messages:[c],source:ne.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},n.prototype.createMessageMetaArrayKeys=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){return A(e instanceof Le&&e.messageId>0&&l("string",t)).throw(U.invalidParameters),n=t.map((function(e){return new Ce({key:e})})),e instanceof We?[2,this._updateFileMessageMetaArray(e.messageId,n,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"add",!0)]}))}))},n.prototype.deleteMessageMetaArrayKeys=function(e,t){return S(this,void 0,void 0,(function(){var n;return N(this,(function(r){return A(e instanceof Le&&e.messageId>0&&l("string",t)).throw(U.invalidParameters),n=t.map((function(e){return new Ce({key:e})})),e instanceof We?[2,this._updateFileMessageMetaArray(e.messageId,n,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},n.prototype.addMessageMetaArrayValues=function(e,t){return S(this,void 0,void 0,(function(){return N(this,(function(n){return A(e instanceof Le&&e.messageId>0&&t.every((function(e){return e instanceof Ce}))).throw(U.invalidParameters),e instanceof We?[2,this._updateFileMessageMetaArray(e.messageId,t,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"add",!0)]}))}))},n.prototype.removeMessageMetaArrayValues=function(e,t){return S(this,void 0,void 0,(function(){return N(this,(function(n){return A(e instanceof Le&&e.messageId>0&&t.every((function(e){return e instanceof Ce}))).throw(U.invalidParameters),e instanceof We?[2,this._updateFileMessageMetaArray(e.messageId,t,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},n.prototype.report=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return A(h(Pt,e)&&d("string",t)).throw(U.invalidParameters),n=w.of(this._iid),r=n.sdkState,i=n.requestQueue,s=new On({channelUrl:this.url,channelType:this.channelType,userId:r.userId,category:e,description:t}),[4,i.send(s)];case 1:return a.sent(),[2]}}))}))},n.prototype.reportUser=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return A(e instanceof u&&h(Pt,t)&&d("string",n)).throw(U.invalidParameters),r=w.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new Pn({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.userId,category:t,description:n}),[4,s.send(a)];case 1:return o.sent(),[2]}}))}))},n.prototype.reportMessage=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return A(e instanceof De&&h(Pt,t)&&d("string",n)).throw(U.invalidParameters),r=w.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new kn({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:t,description:n}),[4,s.send(a)];case 1:return o.sent(),[2]}}))}))},n.prototype.updatePoll=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){switch(s.label){case 0:return A(d("number",e)&&function(e){return d("string",e.title,!0)&&J(e.data)&&d("boolean",e.allowUserSuggestion,!0)&&d("boolean",e.allowMultipleVotes,!0)&&d("number",e.closeAt,!0)}(t)).throw(U.invalidParameters),n=w.of(this._iid).requestQueue,r=new Zn(o({pollId:e},t)),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as($n).poll]}}))}))},n.prototype.deletePoll=function(e){return S(this,void 0,void 0,(function(){var t,n,r;return N(this,(function(i){switch(i.label){case 0:return t=d("number",e),A(t).throw(U.invalidParameters),n=w.of(this._iid).requestQueue,r=new er({pollId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},n.prototype.closePoll=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i;return N(this,(function(s){switch(s.label){case 0:return t=d("number",e),A(t).throw(U.invalidParameters),n=w.of(this._iid).requestQueue,r=new tr({pollId:e}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(nr).poll]}}))}))},n.prototype.addPollOption=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return n=d("number",e)&&d("string",t)&&""!==t.trim(),A(n).throw(U.invalidParameters),r=w.of(this._iid).requestQueue,i=new rr({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(ir).poll]}}))}))},n.prototype.updatePollOption=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return r=d("number",e)&&d("number",t)&&d("string",n)&&""!==n.trim(),A(r).throw(U.invalidParameters),i=w.of(this._iid).requestQueue,s=new sr({pollId:e,pollOptionId:t,optionText:n}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(ar).poll]}}))}))},n.prototype.deletePollOption=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i;return N(this,(function(s){switch(s.label){case 0:return n=d("number",e)&&d("number",t),A(n).throw(U.invalidParameters),r=w.of(this._iid).requestQueue,i=new or({pollId:e,pollOptionId:t}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n.prototype.votePoll=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s,a,o,u;return N(this,(function(c){switch(c.label){case 0:return n=d("number",e)&&l("number",t),A(n).throw(U.invalidParameters),r=w.of(this._iid),i=r.requestQueue,s=r.dispatcher,a=new ur({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:t}),[4,i.send(a)];case 1:return o=c.sent(),u=o.as(cr).event,s.dispatch(new ue({event:u,source:ne.EVENT_POLL_VOTED})),[2,u]}}))}))},n.prototype.getPollChangeLogsSinceTimestamp=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return A(d("number",e)).throw(U.invalidParameters),[4,ce.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getPollChangeLogsSinceToken=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return A(d("string",e,!0)),[4,ce.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},n.prototype.createPollListQuery=function(e){return void 0===e&&(e=10),new ae(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},n.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=20),new oe(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},n}(c),Ur=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}((function(){this.onConnected=Q,this.onReconnectStarted=Q,this.onReconnectSucceeded=Q,this.onReconnectFailed=Q,this.onDisconnected=Q})),Cr=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}((function(){this.onSessionExpired=Q,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=Q,this.onSessionRefreshed=Q,this.onSessionClosed=Q})),Or=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}((function(){this.onFriendsDiscovered=Q,this.onTotalUnreadMessageCountChanged=Q,this.onTotalUnreadMessageCountUpdated=Q})),Pr=function(n){function i(e){var i=e.limit,s=e.token,a=e.userIdsFilter,o=e.metaDataKeyFilter,u=e.metaDataValuesFilter,c=e.nicknameStartsWithFilter,l=n.call(this)||this;return l.method=t.GET,l.path=le,l.params=r({limit:i,token:s,user_ids:a,metadatakey:o,metadatavalues_in:u,nickname_startswith:c}),l}return e(i,n),i}(i),kr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new u(e,t)})),r.next=n.next,r}return e(n,t),n}(s),Rr=function(t){function n(e,n){var r,i,s,a=this;return(a=t.call(this,e,n)||this).userIdsFilter=null,a.metaDataKeyFilter=null,a.metaDataValuesFilter=null,a.nicknameStartsWithFilter=null,a.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,a.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,a.metaDataValuesFilter=null!==(s=n.metaDataValuesFilter)&&void 0!==s?s:null,a.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,a}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&l("string",this.userIdsFilter,!0)&&d("string",this.metaDataKeyFilter,!0)&&l("string",this.metaDataValuesFilter,!0)&&d("string",this.metaDataKeyFilter,!0)},n.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s;return N(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=w.of(this._iid).requestQueue,t=new Pr(a(o(o({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=u.sent(),r=n.as(kr),i=r.users,s=r.next,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(de),xr=function(n){function i(e){var i=e.userId,s=e.limit,a=e.token,o=e.userIdsFilter,u=n.call(this)||this;return u.method=t.GET,u.path="".concat(le,"/").concat(i,"/block"),u.params=r({limit:s,token:a,user_ids:o}),u}return e(i,n),i}(i),Lr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new u(e,t)})),r.next=n.next,r}return e(n,t),n}(s),Dr=function(t){function n(e,n){var r,i=this;return(i=t.call(this,e,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&l("string",this.userIdsFilter,!0)},n.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,u,c;return N(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=w.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new xr(a(o(o({},this),{userId:t.userId,token:this._token}))),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(Lr),u=s.users,c=s.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(de),Fr=function(n){function r(e){var r=e.userId,i=e.limit,s=e.token,a=n.call(this)||this;return a.method=t.GET,a.path="".concat(le,"/").concat(encodeURIComponent(r),"/friends"),a.params={limit:i,token:s},a}return e(r,n),r}(i),qr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(t){return new u(e,t)})),r.next=n.next,r}return e(n,t),n}(s),zr=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,u,c;return N(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=w.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Fr(o(o({},this),{userId:t.userId,token:this._token})),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(qr),a=s.users,u=s.hasMore,c=s.next,this._token=c,this._hasNext=u,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(de),Br={},Kr=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,s=void 0===i?256:i,a=e.blockHashBase,o=void 0===a?2:a,u=e.blockHashMultiplier,c=void 0===u?10:u,l=e.blockHashConstant,d=void 0===l?11:l,h=e.transactionApplyDelay,f=void 0===h?200:h,p=e.disableLogger,m=void 0!==p&&p;return Br[t]||(this.itemSizeLimit=r,this.cacheLimit=s,this.blockHashBase=o,this.blockHashMultiplier=c,this.blockHashConstant=d,this.transactionApplyDelay=f,this.disableLogger=m,Br[t]=this),Br[t]}return e.get=function(e){return Br[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(Nr||(Nr={}));var jr,Qr=function(t){function n(e){var r=e.code,i=void 0===r?Nr.UNKNOWN_ERROR:r,s=e.message,a=void 0===s?"Unknown error occurred.":s,o=t.call(this,a)||this;return o.code=i,Object.setPrototypeOf(o,n.prototype),o}return e(n,t),Object.defineProperty(n,"storeNotDefined",{get:function(){return new n({code:Nr.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailable",{get:function(){return new n({code:Nr.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailableInPrivateBrowsing",{get:function(){return new n({code:Nr.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeIsFull",{get:function(){return new n({code:Nr.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotInitialized",{get:function(){return new n({code:Nr.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeKeyTypeIsInvalid",{get:function(){return new n({code:Nr.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenIntegrity",{get:function(){return new n({code:Nr.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenBlob",{get:function(){return new n({code:Nr.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeEncryptionInvalid",{get:function(){return new n({code:Nr.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeItemSizeExceeded",{get:function(){return new n({code:Nr.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeReadFailed",{get:function(){return new n({code:Nr.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeWriteFailed",{get:function(){return new n({code:Nr.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseSchemaNotOnUpgrade",{get:function(){return new n({code:Nr.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionNotReady",{get:function(){return new n({code:Nr.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotMatch",{get:function(){return new n({code:Nr.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionQueryNotValid",{get:function(){return new n({code:Nr.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionInsertDuplicate",{get:function(){return new n({code:Nr.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotFound",{get:function(){return new n({code:Nr.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotGiven",{get:function(){return new n({code:Nr.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionWriteFailed",{get:function(){return new n({code:Nr.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionItemSizeExceeded",{get:function(){return new n({code:Nr.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTableIsRequired",{get:function(){return new n({code:Nr.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTypesNotMatch",{get:function(){return new n({code:Nr.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"compareTypesNotMatch",{get:function(){return new n({code:Nr.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"circularReferenceFound",{get:function(){return new n({code:Nr.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),n}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(jr||(jr={}));var Gr,Vr=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw Qr.circularReferenceFound;t.set(e,!0);var n=void 0;if(Array.isArray(e))n=e.map((function(e){return Vr(e,t)}));else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=Vr(e[r],t);return t.delete(e),n}return e},Hr=function(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw Qr.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n},Wr=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},Yr=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},Jr=function(e,t){if(!t)return!1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return!Jr(e,t)})))return!1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return!Jr(e,t)})))return!1}else if("/where"===n){if(!(0,e[n])(t))return!1}else{var r=n;if("object"==typeof e[r]){var i=e[r];for(var s in i)switch(s){case"/eq":case"=":if((a=t[r])!==(o=i[s]))return!1;break;case"/neq":case"!=":if((a=t[r])===(o=i[s]))return!1;break;case"/gt":case">":var a=t[r],o=i[s];if(!(Hr(a,o)>0))return!1;break;case"/gte":case">=":a=t[r],o=i[s];if(!(Hr(a,o)>=0))return!1;break;case"/lt":case"<":a=t[r],o=i[s];if(!(Hr(a,o)<0))return!1;break;case"/lte":case"<=":a=t[r],o=i[s];if(!(Hr(a,o)<=0))return!1;break;case"/in":a=t[r];if(!(o=i[s]).includes(a))return!1;break;case"/nin":a=t[r];if((o=i[s]).includes(a))return!1;break;case"/contain":a=t[r],o=i[s];if(!a.includes(o))return!1;break;case"/regex":a=t[r];if(!(o=i[s]).test(a))return!1;break;case"/where":a=t[r];if(!(0,i[s])(a))return!1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return!1}else if(e[r]!==t[r])return!1}}return!0}return e(t)},Xr=function(){},Zr=function(){return Promise.resolve()},$r=function(e){return e},ei=function(e,t){t()};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(Gr||(Gr={}));var ti,ni,ri,ii=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,s=e.iterator,a=e.map,o=void 0===a?$r:a,u=e.backward,c=void 0===u?Zr:u,l=e.forward,d=void 0===l?Zr:l,h=e.complete,f=void 0===h?Xr:h;this._prevValue=n,this._nextValue=i,this._error=null,this._map=o,this._backward=c,this._forward=d,this._iterator=s,this._complete=f}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return S(this,void 0,void 0,(function(){var e,t,n;return N(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n;return N(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},e}(),si=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.blockManager,a=e.indexer;this.condition=n,this.backward=i,this._blockManager=s,this._indexer=a}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],a=1;if("-"===s[0]&&(s=s.slice(1),a=-1),this.condition[s])if("object"==typeof this.condition[s]){var o=a>0?n:t;for(var u in this.condition[s])if(o.includes(u))for(var c=r;c>=0;c--)if(a*Hr(this._indexer.origin[c].columnValues[i],this.condition[s][u])<=0){r=c;break}}else for(c=r;c>=0;c--)if(a*Hr(this._indexer.origin[c].columnValues[i],this.condition[s])<=0){r=c;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var d=function(r){var i=h._indexer.fields[r],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),h.condition[i])if("object"==typeof h.condition[i])Object.keys(h.condition[i]).forEach((function(a){if((s>0?t:n).includes(a))for(var o=l;o<e._indexer.origin.length;o++)if(s*Hr(e._indexer.origin[o].columnValues[r],e.condition[i][a])>=0){l=o;break}}));else for(var a=l;a<h._indexer.origin.length;a++)if(s*Hr(h._indexer.origin[a].columnValues[r],h.condition[i])>=0){l=a;break}},h=this,i=0;i<this._indexer.fields.length;i++)d(i);return Math.max(l-1,0)},e.prototype.each=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u=this;return N(this,(function(c){switch(c.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[++n]){if(!u._indexer.origin[++t])return!1;n=0}return!0}return!1},i=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[--n]){if(!u._indexer.origin[--t])return!1;n=u._indexer.origin[t].keys.length-1}return!0}return!1},s=null,!this._indexer.origin[t])return[3,4];a=this.backward?i:r,c.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if((o=c.sent())&&Jr(this.condition,o))return s=o,[3,4];c.label=3;case 3:if(a())return[3,1];c.label=4;case 4:return[4,new Promise((function(a){var o=new ii({initialNextValue:Vr(s),iterator:e,forward:function(){return S(u,void 0,void 0,(function(){var e,s;return N(this,(function(a){switch(a.label){case 0:e=this.backward?i:r,a.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return(s=a.sent())&&Jr(this.condition,s)?[2,Vr(s)]:[3,1];case 3:return[2,null]}}))}))},backward:function(){return S(u,void 0,void 0,(function(){var e,s;return N(this,(function(a){switch(a.label){case 0:e=this.backward?r:i,a.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return(s=a.sent())&&Jr(this.condition,s)?[2,Vr(s)]:[3,1];case 3:return[2,null]}}))}))},complete:a});e(o)}))];case 5:return[2,c.sent()]}}))}))},e}(),ai=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.mutex,a=e.blockManager,o=e.indexer;this._mutex=s,this._iterator=new si({condition:n,backward:i,blockManager:a,indexer:o})}return e.prototype.fetch=function(e){return void 0===e&&(e={}),S(this,void 0,void 0,(function(){var t,n,r,i,s=this;return N(this,(function(a){switch(a.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(n<0)throw Qr.collectionQueryNotValid;a.label=1;case 1:return a.trys.push([1,4,,5]),r=[],[4,this._mutex.lock()];case 2:return a.sent(),[4,this._iterator.each((function(e){return S(s,void 0,void 0,(function(){return N(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r.push(e.nextValue),0<n&&n<=r.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return a.sent(),this._mutex.unlock(),[2,r];case 4:throw i=a.sent(),this._mutex.unlock(),i;case 5:return[2]}}))}))},e.prototype.count=function(){return S(this,void 0,void 0,(function(){var e,t,n=this;return N(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r.sent(),[4,this._iterator.each((function(t){return S(n,void 0,void 0,(function(){return N(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r.sent(),this._mutex.unlock(),t;case 4:return[2]}}))}))},e}(),oi=function(e){return"".concat("nest","@").concat(e)},ui=function(e,t){return"".concat(oi(e),"/").concat(t)},ci=function(e,t){return"".concat(ui(e,t),".metadata")},li=function(e,t){return"".concat(ui(e,t),"/block.")},di=function(e,t){return"".concat(ui(e,t),"/blob.")},hi=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this.store=r}return e.prototype.get=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,c;return N(this,(function(l){switch(l.label){case 0:return[4,this.store.get(e)];case 1:return(t=l.sent())?(n=t.data,r=t.type,"undefined"==typeof fetch?[3,4]:[4,fetch(n)]):[3,5];case 2:return[4,l.sent().blob()];case 3:return[2,l.sent()];case 4:for(512,i=[],s=atob(n.split(",")[1]),a=0;a<s.length;a+=512){for(o=s.slice(a,a+512),u=new Array(o.length),c=0;c<o.length;c++)u[c]=o.charCodeAt(c);i.push(new Uint8Array(u))}return[2,new Blob(i,{type:r})];case 5:return[2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),S(this,void 0,void 0,(function(){var n,r,i,s,a=this;return N(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(n){var r=function(e,t,n,r){return void 0===r&&(r=0),"".concat(di(e,t)).concat(n,".").concat(r)}(a.dbname,a.collectionName,t),i=new FileReader;i.onload=function(){n({blobId:r,data:i.result,type:e.type})},i.readAsDataURL(e)}))];case 1:return n=o.sent(),r=n.blobId,i=n.data,s=n.type,[4,this.store.set({key:r,value:{data:i,type:s}})];case 2:return o.sent(),[2,r]}}))}))},e.prototype.remove=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return S(this,void 0,void 0,(function(){var e,t,n=this;return N(this,(function(r){switch(r.label){case 0:return e=di(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return t=r.sent(),[4,Promise.all(t.filter((function(t){return t.startsWith(e)})).map((function(e){return S(n,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return[2,t.sent()]}}))}))})))];case 2:return r.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(ti||(ti={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(ni||(ni={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(ri||(ri={}));var fi,pi,mi=[ni.PENDING,ni.VOLATILE],vi={},yi=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return vi[t]||(this.dbname=t,this._items=[],this._limit=r,vi[t]=this),vi[t]}return e.get=function(e){return vi[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=ri.DEFAULT),S(this,void 0,void 0,(function(){var r,i;return N(this,(function(s){switch(s.label){case 0:return(r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return(i=s.sent())&&(r={key:t,value:i,state:n===ri.PERSISTENT?ni.PERSISTENT:ni.VOLATILE},this.put(r)),[3,3];case 2:n===ri.PERSISTENT&&(r.state=ni.PERSISTENT),s.label=3;case 3:return[2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=ri.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===ri.PERSISTENT&&(r.state=ni.PERSISTENT),t!==ri.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)mi.includes(this._items[r].state)&&mi.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter((function(e){return e.state===ni.VOLATILE})),s=i.length-this._limit;if(s>0){var a=[];try{for(var o=m(this._items),u=o.next();!u.done;u=o.next()){var c=u.value;c.state===ni.VOLATILE&&s>0?s--:a.push(c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._items=a}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return!e(t)}))},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==ni.VOLATILE}))},e}(),_i=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return"".concat(ui(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return"".concat(ui(e,t),"/trans.recordset")}(t,n),this._store=r}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=n.sent()||[]).push.apply(t,f([],p(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],s=[],a=i.requests.length-1;a>=0;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}s.length>0&&(i.requests=s,t.unshift(i))}return t},e.prototype._applyRecord=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s,a,u,c,l,d;return N(this,(function(h){switch(h.label){case 0:n=yi.get(this.dbname),r=t.generation,i=t.requests,s=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(i.map((function(e){return o(o({},e.data),{generation:r})})))];case 2:for(a=h.sent(),u=0;u<i.length;u++)a[u]instanceof Error&&(s||(s=a[u]),c=i[u].data,n.put(o(o({},c),{state:ni.PERSISTENT})));return[3,4];case 3:return l=h.sent(),s=l,[3,4];case 4:return s?[3,6]:(d=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:d})]);case 5:return h.sent(),this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})))})),[3,7];case 6:this._onError.forEach((function(e){s&&e(s)})),h.label=7;case 7:return[2]}}))}))},e.prototype.init=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o;return N(this,(function(u){switch(u.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=u.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),n=m(t),r=n.next(),u.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._applyRecord(t,i)]);case 5:u.sent(),u.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return s=u.sent(),a={error:s},[3,10];case 9:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 10:return[2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case ti.COMMIT:this._onCommit.set(t,n);break;case ti.WRITE:this._onWrite.set(t,n);break;case ti.ERROR:this._onError.set(t,n)}},e.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t}),yi.get(this.dbname).put(o({state:ni.PENDING},e))},e.prototype.requestMultipleWrite=function(e,t){var n,r,i=yi.get(this.dbname);try{for(var s=m(e),a=s.next();!a.done;a=s.next()){var u=a.value;this._requests.push({data:u,options:t}),i.put(o({state:ni.PENDING},u))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.clear=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){return yi.get(this.dbname).clearByCondition((function(e){return e.state===ni.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,u,c,l,d,h,f=this;return N(this,(function(p){switch(p.label){case 0:if(!((e=this._requests).length>0))return[3,4];for(t=[],n={},u=e.length-1;u>=0;u--)r=e[u],l=r.data,n[l.key]||(n[l.key]=!0,t.unshift(r));return i={generation:this.generation,requests:t},[4,this._getReducedRecordset([i])];case 1:return s=p.sent(),[4,this._store.set({key:this.recordsetKey,value:s})];case 2:return p.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(p.sent(),a=yi.get(this.dbname),u=0;u<t.length;u++)c=t[u],l=c.data,d=c.options,a.put(o(o({},l),{state:d&&d.persistent?ni.PERSISTENT:ni.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})))})),h=Kr.get(this.dbname),setTimeout((function(){try{f._applyRecord(s,i)}catch(e){f._onError.forEach((function(t){return t(e)}))}}),h.transactionApplyDelay),p.label=4;case 4:return[2]}}))}))},e}(),gi=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,s=e.limit;this.blockId=t,this.keyName=n,this.limit=s,this._items=f([],p(i),!1)}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this,n=this._items.find((function(n){var r=n[t.keyName];return e===r}));return null!=n?n:null},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},e.prototype.clear=function(){this._items=[]},e}(),bi=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,s=void 0===i?Wr:i,a=e.transaction,o=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=a,this._store=o}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,s="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||Wr)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(li(n,r)).concat(i,".").concat(s);var n,r,i,s},e.prototype._findBlock=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s;return N(this,(function(a){switch(a.label){case 0:t=yi.get(this.dbname),n=this.metadata.blockLevel,a.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i=a.sent())&&(s=gi.createFromCacheItem(i),null==s?void 0:s.getItemByKey(e)))return[2,s];a.label=3;case 3:return n--,[3,1];case 4:return[2,null]}}))}))},e.prototype.getFromBlock=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return[2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return n=Kr.get(this.dbname),r=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,yi.get(this.dbname).find(this._store,r)];case 1:return s=o.sent(),(null==(a=s?gi.createFromCacheItem(s):new gi({blockId:r,keyName:this.keyName,items:[],limit:i}))?void 0:a.add(t))?(this._transaction.requestWrite({key:a.blockId,value:a.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return(t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return S(this,void 0,void 0,(function(){var e,t,n;return N(this,(function(r){switch(r.label){case 0:return e=li(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=r.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:return r.sent(),[4,this._transaction.clear()];case 3:return r.sent(),yi.get(this.dbname).clearByCondition((function(t){return t.key.startsWith(e)})),[2]}}))}))},e}(),Ii={},Ei=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,a=e.store,o=this;this._origin=[],this._table=[];var u=function(e,t,n){return"".concat(ui(e,t),"/index.").concat(n)}(t,n,i.join(">"));return Ii[u]||(this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=u,this._transaction=s,this._store=a,this._transaction.on(ti.COMMIT,this.indexerKey,(function(){return o.commit()})),this._transaction.on(ti.ERROR,this.indexerKey,(function(){return o.abort()}))),Ii[u]}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.clearIndexerMap=function(){for(var e in Ii)delete Ii[e]},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=p(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=p(this.indexOf(n),2),i=r[0];if(r[1]){var s=this._table[i].keys.indexOf(t);if(s>-1)return this._table[i].keys.splice(s,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return!1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,s=[];try{for(var a=m(this.fields),o=a.next();!o.done;o=a.next()){var u=o.value;if("-"===u[0]&&(u=u.slice(1)),r=e[u],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw Qr.indexTypesNotMatch;s.push(e[u])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return s},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=Hr(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},e.prototype.ensure=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u,c,l,d,h,f,p,v,y;return N(this,(function(_){switch(_.label){case 0:return[4,(e=yi.get(this.dbname)).find(this._store,this.indexerKey,ri.PERSISTENT)];case 1:return(t=_.sent())?[3,11]:(n=li(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=_.sent(),_.label=3;case 3:_.trys.push([3,8,9,10]),i=m(r),s=i.next(),_.label=4;case 4:return s.done?[3,7]:(a=s.value).startsWith(n)?[4,e.find(this._store,a,ri.NO_CACHE)]:[3,6];case 5:if(o=_.sent(),u=gi.createFromCacheItem(o))try{for(v=void 0,c=m(u.items),l=c.next();!l.done;l=c.next())d=l.value,this._addItem(d)}catch(e){v={error:e}}finally{try{l&&!l.done&&(y=c.return)&&y.call(c)}finally{if(v)throw v.error}}_.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return h=_.sent(),f={error:h},[3,10];case 9:try{s&&!s.done&&(p=i.return)&&p.call(i)}finally{if(f)throw f.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=Vr(this._origin),_.label=12;case 12:return Ii[this.indexerKey]=this,[2]}}))}))},e.prototype.drop=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return yi.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),delete Ii[this.indexerKey],[2]}}))}))},e.prototype.addItem=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=Vr(this._origin)},e.prototype.abort=function(){this._table=Vr(this._origin)},e}(),Ti=function(){return"undefined"!=typeof document&&"undefined"!=typeof navigator&&"ReactNative"!==navigator.product},wi=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(fi||(fi={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(pi||(pi={}));var Mi,Si={},Ni=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=fi.PROCESSING,this._queue=[],this._activationQueue=[],Si[e]&&!t.forceCreate||(this.nodeId=wi(),this.key=e,Ti()&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t,r,i=e.data,s=i.nodeId,a=i.requestId,o=i.key,u=i.op,c=i.data;if(s!==n.nodeId&&o===n.key)switch(u){case pi.NEWNODE:n._sendSync();break;case pi.CLAIM_HOST:n._sendSync(),n._hostId=s;break;case pi.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var l=c,d=l.currentItemRequestId,h=l.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:pi.REQUEST_LOCK,ts:e.ts})};try{for(var p=m(h),v=p.next();!v.done;v=p.next()){f(v.value)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===d})),n._completeSync()}break;case pi.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=void 0,n._acquire(n._queue[0]));break;case pi.REQUEST_LOCK:n._requestLock(i);break;case pi.ACQUIRE_LOCK:var y=n._queue.find((function(e){return e.requestId===a}));n._acquire(y);break;case pi.RELEASE_LOCK:n._release(a)}})),window.addEventListener("beforeunload",(function(){n._send(pi.REMOVENODE)}))),Si[e]=this),Si[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==fi.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n;void 0===t&&(t={});var r={nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:wi(),key:this.key,op:e,data:t.data,ts:Date.now()};return Ti()&&window.postMessage(r,"*"),r},e.prototype._acquire=function(e){e?(this._currentItem=e,this._currentItem.onAcquired&&this._currentItem.onAcquired(e.requestId)):this._currentItem=void 0},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=void 0,t.nodeId===this.nodeId&&this._send(pi.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased&&t.onReleased(e)}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(pi.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},i=!1;for(var s in t._queue)if(t._queue[s].ts>r.ts){t._queue.splice(parseInt(s),0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(pi.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})},e.prototype._waitUntilSyncCompleted=function(){return S(this,void 0,void 0,(function(){var e=this;return N(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t)}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))},e.prototype._completeSync=function(){this.isInSync||(this._state=fi.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])},e.prototype.registerNode=function(){this._send(pi.NEWNODE),this._waitSync()},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(pi.CLAIM_HOST),this._waitSync()},e.prototype.lock=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(pi.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)&&this._release(this._currentItem.requestId)},e}(),Ai=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,a=e.store,o=this;this._state=jr.INIT,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=f([[r]],p(s.filter((function(e){return Ei.createKey(e)!==o.keyName}))),!1),this._keyHash=i,this._store=a,this._mutex=new Ni(function(e,t){return"".concat(ui(e,t),".lock")}(t,n)),this._blobContainer=new hi({dbname:t,collectionName:n,store:a}),this._transaction=new _i({dbname:t,collectionName:n,store:a})}return e.metadataOf=function(e,t,n){return S(this,void 0,void 0,(function(){var r;return N(this,(function(i){switch(i.label){case 0:return r=ci(e,t),[4,n.get(r)];case 1:return[2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===jr.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,c,l,d,h,v,y,_=this;return N(this,(function(g){switch(g.label){case 0:return[4,this._mutex.lock()];case 1:g.sent(),g.label=2;case 2:return g.trys.push([2,9,,10]),t=Kr.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=g.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:g.sent(),this._blockManager=new bi({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=f([],p(this.indexes),!1),i=[],s=r.map((function(e){return Ei.createKey(e)})),a=n?n.indexes.map((function(e){return Ei.createKey(e)})):[];try{for(o=m(a),u=o.next();!u.done;u=o.next())c=u.value,s.includes(c)||i.push(Ei.parseKey(c))}catch(e){v={error:e}}finally{try{u&&!u.done&&(y=o.return)&&y.call(o)}finally{if(v)throw v.error}}return(l=[]).push.apply(l,f([],p(r.map((function(e){var t=new Ei({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store});return _._indexers.push(t),t.ensure()}))),!1)),l.push.apply(l,f([],p(i.map((function(e){return new Ei({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store}).drop()}))),!1)),[4,Promise.all(l)];case 5:return g.sent(),[4,this._transaction.commit()];case 6:return g.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(d=ci(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:g.sent(),g.label=8;case 8:return this._state=jr.READY,this._mutex.unlock(),[3,10];case 9:throw h=g.sent(),this._mutex.unlock(),h;case 10:return[2]}}))}))},e.prototype.close=function(){this._state=jr.CLOSED},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return"string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=Ei.createKey(e);try{for(var i=m(this._indexers),s=i.next();!s.done;s=i.next()){var a=s.value;if(r===Ei.createKey(a.fields))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}throw Qr.indexTableIsRequired},e.prototype._upgradeBlockLevel=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return e=ci(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return o.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return o.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return o.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:o.sent(),o.label=5;case 5:o.trys.push([5,10,11,12]),n=m(this._indexers),r=n.next(),o.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:o.sent(),o.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=o.sent(),s={error:i},[3,12];case 11:try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}return[7];case 12:return[3,14];case 13:throw Qr.collectionInsertDuplicate;case 14:return[2]}}))}))},e.prototype._requestUpsert=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,c,l,d,h,f;return N(this,(function(p){switch(p.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=p.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return p.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return p.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:p.sent(),p.label=5;case 5:p.trys.push([5,10,11,12]),r=m(this._indexers),i=r.next(),p.label=6;case 6:return i.done?[3,9]:[4,(u=i.value).addItem(e)];case 7:p.sent(),p.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=p.sent(),l={error:s},[3,12];case 11:try{i&&!i.done&&(d=r.return)&&d.call(r)}finally{if(l)throw l.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,e)];case 14:p.sent(),p.label=15;case 15:p.trys.push([15,21,22,23]),a=m(this._indexers),o=a.next(),p.label=16;case 16:return o.done?[3,20]:0===(u=o.value).diff(u.getColumnValues(n),u.getColumnValues(e))?[3,19]:[4,u.removeItem(n)];case 17:return p.sent(),[4,u.addItem(e)];case 18:p.sent(),p.label=19;case 19:return o=a.next(),[3,16];case 20:return[3,23];case 21:return c=p.sent(),h={error:c},[3,23];case 22:try{o&&!o.done&&(f=a.return)&&f.call(a)}finally{if(h)throw h.error}return[7];case 23:return[2]}}))}))},e.prototype._requestUpdate=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u;return N(this,(function(c){switch(c.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=c.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:c.sent(),c.label=3;case 3:c.trys.push([3,9,10,11]),r=m(this._indexers),i=r.next(),c.label=4;case 4:return i.done?[3,8]:0===(s=i.value).diff(s.getColumnValues(n),s.getColumnValues(e))?[3,7]:[4,s.removeItem(n)];case 5:return c.sent(),[4,s.addItem(e)];case 6:c.sent(),c.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return a=c.sent(),o={error:a},[3,11];case 10:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 11:return[2]}}))}))},e.prototype._requestRemove=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return[4,this._blockManager.getFromBlock(e)];case 1:return(t=o.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:o.sent(),o.label=3;case 3:o.trys.push([3,8,9,10]),n=m(this._indexers),r=n.next(),o.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:o.sent(),o.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=o.sent(),s={error:i},[3,10];case 9:try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}return[7];case 10:return[2]}}))}))},e.prototype._requestClear=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i;return N(this,(function(s){switch(s.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:s.sent(),s.label=2;case 2:s.trys.push([2,7,8,9]),e=m(this._indexers),t=e.next(),s.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:s.sent(),s.label=5;case 5:return t=e.next(),[3,3];case 6:return[3,9];case 7:return n=s.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}return[7];case 9:return[2]}}))}))},e.prototype.getByKey=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,Vr(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return[3,7];case 6:throw Qr.collectionNotReady;case 7:return[2]}}))}))},e.prototype.query=function(e){if(void 0===e&&(e={}),this.isReady)return new ai({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward});throw Qr.collectionNotReady},e.prototype.insertOne=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Qr.collectionKeyNotGiven;return[4,this._requestInsert(Vr(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Qr.collectionNotReady;case 9:return[2]}}))}))},e.prototype.insertMany=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u=this;return N(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Qr.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=m(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(Vr(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=c.sent(),a={error:i},[3,10];case 9:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw Qr.collectionNotReady;case 16:return[2]}}))}))},e.prototype.upsertOne=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Qr.collectionKeyNotGiven;return[4,this._requestUpsert(Vr(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Qr.collectionNotReady;case 9:return[2]}}))}))},e.prototype.upsertMany=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u=this;return N(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Qr.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=m(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(Vr(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=c.sent(),a={error:i},[3,10];case 9:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw Qr.collectionNotReady;case 16:return[2]}}))}))},e.prototype.update=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Qr.collectionKeyNotGiven;return[4,this._requestUpdate(Vr(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Qr.collectionNotReady;case 9:return[2]}}))}))},e.prototype.updateIf=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,c,l,d,h,f,p,v,y=this;return N(this,(function(_){switch(_.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:_.sent(),_.label=2;case 2:return _.trys.push([2,13,,15]),n=e.where,r=void 0===n?{}:n,i=e.index,s=void 0===i?null:i,a=e.backward,o=void 0!==a&&a,u=[],[4,new si({condition:r,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(s)}).each((function(e){return S(y,void 0,void 0,(function(){var n,i;return N(this,(function(s){if(e.error)throw e.stop(),e.error;if(e.hasNext){if(n=e.nextValue,Jr(r,n)&&t.set){if("function"!=typeof t.set)for(i in t.set)n[i]=t.set[i];else t.set(n);u.push(n)}e.next()}else e.stop();return[2]}))}))}))];case 3:_.sent(),_.label=4;case 4:_.trys.push([4,9,10,11]),c=m(u),l=c.next(),_.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestUpdate(Vr(d))]);case 6:_.sent(),_.label=7;case 7:return l=c.next(),[3,5];case 8:return[3,11];case 9:return h=_.sent(),p={error:h},[3,11];case 10:try{l&&!l.done&&(v=c.return)&&v.call(c)}finally{if(p)throw p.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return _.sent(),this._mutex.unlock(),[2,u];case 13:return f=_.sent(),[4,this._transaction.clear()];case 14:throw _.sent(),this._mutex.unlock(),f;case 15:return[3,17];case 16:throw this._transaction.clear(),Qr.collectionNotReady;case 17:return[2]}}))}))},e.prototype.remove=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Qr.collectionNotReady;case 9:return[2]}}))}))},e.prototype.removeIf=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,c,l,d,h,f,p,v=this;return N(this,(function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r=e.index,i=void 0===r?null:r,s=e.backward,a=void 0!==s&&s,o=[],[4,new si({condition:n,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(i)}).each((function(e){return S(v,void 0,void 0,(function(){var t,r;return N(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,Jr(n,t)&&(r=t[this.keyName],o.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),u=m(o),c=u.next(),y.label=5;case 5:return c.done?[3,8]:(l=c.value,[4,this._requestRemove(l)]);case 6:y.sent(),y.label=7;case 7:return c=u.next(),[3,5];case 8:return[3,11];case 9:return d=y.sent(),f={error:d},[3,11];case 10:try{c&&!c.done&&(p=u.return)&&p.call(u)}finally{if(f)throw f.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,o];case 13:throw h=y.sent(),this._mutex.unlock(),h;case 14:return[3,16];case 15:throw this._transaction.clear(),Qr.collectionNotReady;case 16:return[2]}}))}))},e.prototype.clear=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Qr.collectionNotReady;case 9:return[2]}}))}))},e.prototype.getBlob=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return S(this,void 0,void 0,(function(){return N(this,(function(n){switch(n.label){case 0:return[4,this._blobContainer.save(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),Ui="[NESTDB]",Ci=!0,Oi=function(){function e(){}return e.off=function(){Ci=!1},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Ci&&console.log.apply(console,f(["".concat(Ui,"[LOG]")],p(e),!1))},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Ci&&console.warn.apply(console,f(["".concat(Ui,"[WARNING]")],p(e),!1))},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Ci&&console.error.apply(console,f(["".concat(Ui,"[ERROR]")],p(e),!1))},e}(),Pi=[{},{a:700400,n:"error"}],ki=function(){function e(e){var t,n,r;this.encryption=null!==(t=e.encryption)&&void 0!==t?t:he,this.itemSizeLimit=null!==(n=e.itemSizeLimit)&&void 0!==n?n:4194304,this.metadataBuffer=null!==(r=e.metadataBuffer)&&void 0!==r?r:256}return Object.defineProperty(e.prototype,"_encryptionCheckKey",{get:function(){return"".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_reservedKeys",{get:function(){return[this._encryptionCheckKey]},enumerable:!1,configurable:!0}),e.prototype._getRawKey=function(e,t){return void 0===t&&(t=""),"".concat(e).concat(t)},e.prototype._generateShardPostfixArray=function(e){return void 0===e&&(e=1),f([],p(Array(e).keys()),!1)},e.prototype._shardify=function(e){var t=this,n=e.key,r=e.value,i=JSON.stringify(this.encryption.encrypt(r)),s=Math.ceil(i.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(s).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:i.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:s}),r}))},e.prototype._resetIfEncryptionChanged=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u,c=this;return N(this,(function(l){switch(l.label){case 0:return[4,this.get(this._encryptionCheckKey)];case 1:if(e=l.sent(),t={encrypted:Pi.map((function(e){var t;return null===(t=c.encryption)||void 0===t?void 0:t.encrypt(e)}))},!(e&&e.encrypted&&Array.isArray(e.encrypted)))return[3,6];for(i in n=e.encrypted,r=[],n)r.push(i);s=0,l.label=2;case 2:return s<r.length?(i=r[s])in n?(a=i,o=JSON.stringify(e.encrypted[a]),u=JSON.stringify(t.encrypted[a]),o===u?[3,4]:(Oi.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return l.sent(),[3,5];case 4:return s++,[3,2];case 5:return[3,8];case 6:return e?[3,8]:[4,this.clear()];case 7:l.sent(),l.label=8;case 8:return[4,this.set({key:this._encryptionCheckKey,value:t})];case 9:return l.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),e.prototype.usage=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u;return N(this,(function(c){switch(c.label){case 0:return e=0,[4,this._getAllRawKeys()];case 1:t=c.sent(),c.label=2;case 2:c.trys.push([2,7,8,9]),n=m(t),r=n.next(),c.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._getRaw(i)]);case 4:(s=c.sent())&&(e+=JSON.stringify(s).length),c.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return a=c.sent(),o={error:a},[3,9];case 8:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}return[7];case 9:return[2,e]}}))}))},e.prototype.getAllKeys=function(){return S(this,void 0,void 0,(function(){var e=this;return N(this,(function(t){switch(t.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,t.sent().filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")})).filter((function(t){return!e._reservedKeys.includes(t)}))]}}))}))},e.prototype.get=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o=this;return N(this,(function(u){switch(u.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:if(!(n=u.sent()))return[3,7];u.label=2;case 2:return u.trys.push([2,6,,7]),r=n.data,(null==(i=n.metadata)?void 0:i.shards)&&i.shards>1?[4,Promise.all(this._generateShardPostfixArray(null==i?void 0:i.shards).map((function(t){return S(o,void 0,void 0,(function(){var n,i;return N(this,(function(s){switch(s.label){case 0:return t>0?(n=this._getRawKey(e,".".concat(t)),[4,this._getRaw(n)]):[3,2];case 1:if(!(i=s.sent()))throw Qr.storeBrokenIntegrity;return[2,i.data];case 2:return[2,r]}}))}))})))]:[3,4];case 3:return a=u.sent(),[3,5];case 4:a=[r],u.label=5;case 5:return s=a,[2,this.encryption.decrypt(JSON.parse(s.join("")))];case 6:return u.sent(),[2,null];case 7:return[2,null]}}))}))},e.prototype.set=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return t=this._shardify(e),[4,this._setRaw(t)];case 1:return n.sent(),[2,o({},e.value)]}}))}))},e.prototype.setMany=function(e){return S(this,void 0,void 0,(function(){var t,n=this;return N(this,(function(r){switch(r.label){case 0:return t=[],[4,this._setRaw(t.concat.apply(t,f([],p(e.map((function(e){return n._shardify(e)}))),!1)))];case 1:return r.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i=this;return N(this,(function(s){switch(s.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:return(n=s.sent())?(r=n.metadata,[4,this._removeRaw(this._generateShardPostfixArray(null==r?void 0:r.shards).map((function(t){return i._getRawKey(e,".".concat(t))})))]):[3,3];case 2:return s.sent(),[2,!0];case 3:return[2,!1]}}))}))},e.prototype.removeMany=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,c,l=this;return N(this,(function(d){switch(d.label){case 0:t=[],n=function(e){var n,i,s;return N(this,(function(a){switch(a.label){case 0:return n=r._getRawKey(e,".0"),[4,r._getRaw(n)];case 1:return(i=a.sent())&&(s=i.metadata,t.push.apply(t,f([],p(r._generateShardPostfixArray(null==s?void 0:s.shards).map((function(t){return l._getRawKey(e,".".concat(t))}))),!1))),[2]}}))},r=this,d.label=1;case 1:d.trys.push([1,6,7,8]),i=m(e),s=i.next(),d.label=2;case 2:return s.done?[3,5]:(a=s.value,[5,n(a)]);case 3:d.sent(),d.label=4;case 4:return s=i.next(),[3,2];case 5:return[3,8];case 6:return o=d.sent(),u={error:o},[3,8];case 7:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 8:return t.length>0?[4,this._removeRaw(t)]:[3,10];case 9:d.sent(),d.label=10;case 10:return[2,e]}}))}))},e}(),Ri={},xi=function(t){function n(e){void 0===e&&(e={});var n,r=this;r=t.call(this,o(o({},e),{itemSizeLimit:null!==(n=e.itemSizeLimit)&&void 0!==n?n:4194304}))||this;var i=e.delay,s=void 0===i?1:i;return r.delay=s,r.observer={},r}return e(n,t),Object.defineProperty(n.prototype,"rawData",{get:function(){return Ri[this.dbname]},set:function(e){Ri[this.dbname]=e},enumerable:!1,configurable:!0}),n.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){if(Ri[this.dbname])return[2,Object.keys(Ri[this.dbname])];throw Qr.storeNotAvailable}))}))},n.prototype._getRaw=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return Ri[this.dbname]?[4,Yr(this.delay)]:[3,2];case 1:return t.sent(),[2,Ri[this.dbname][e]?o({key:e},Ri[this.dbname][e]):null];case 2:throw Qr.storeNotAvailable}}))}))},n.prototype._setRaw=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u;return N(this,(function(c){switch(c.label){case 0:return Ri[this.dbname]?[4,Yr(this.delay)]:[3,2];case 1:c.sent();try{for(t=m(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,s=r.data,a=r.metadata,Ri[this.dbname][i]=Object.freeze({data:s,metadata:a})}catch(e){o={error:e}}finally{try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}}return[3,3];case 2:throw Qr.storeNotAvailable;case 3:return[2]}}))}))},n.prototype._removeRaw=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return Ri[this.dbname]?[4,Yr(this.delay)]:[3,2];case 1:a.sent();try{for(t=m(e),n=t.next();!n.done;n=t.next())r=n.value,Ri[this.dbname][r]&&delete Ri[this.dbname][r]}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[3,3];case 2:throw Qr.storeNotAvailable;case 3:return[2]}}))}))},n.prototype.observe=function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}))},n.prototype.checkAvailability=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){return[2]}))}))},n.prototype.init=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return this.dbname=e,Ri[this.dbname]||(Ri[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},n.prototype.set=function(e){return S(this,void 0,void 0,(function(){var n,r;return N(this,(function(i){if((n=this.observer[e.key])&&"function"==typeof n.set&&(r=n.set()))throw r;return[2,t.prototype.set.call(this,e)]}))}))},n.prototype.setMany=function(e){return S(this,void 0,void 0,(function(){var n,r,i,s,a,o,u;return N(this,(function(c){try{for(n=m(e),r=n.next();!r.done;r=n.next())if(i=r.value,(s=this.observer[i.key])&&"function"==typeof s.set&&(a=s.set()))throw a}catch(e){o={error:e}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}}return[2,t.prototype.setMany.call(this,e)]}))}))},n.prototype.clear=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,Yr(this.delay)];case 1:return e.sent(),Ri[this.dbname]={},[2]}}))}))},n}(ki),Li="NestDBStore";!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.OPENING=1]="OPENING",e[e.OPEN=2]="OPEN",e[e.CLOSED=3]="CLOSED"}(Mi||(Mi={}));var Di=function(t){function n(e){void 0===e&&(e={});var n,r=this;return(r=t.call(this,o(o({},e),{itemSizeLimit:null!==(n=e.itemSizeLimit)&&void 0!==n?n:104857600}))||this)._storeName=Li,r._state=Mi.UNINITIALIZED,r._openJobQueue=[],r._window="undefined"!=typeof window?window:void 0,r._indexedDb=r._window?r._window.indexedDB||r._window.mozIndexedDB||r._window.webkitIndexedDB||r._window.msIndexedDB:void 0,r}return e(n,t),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),n.prototype._openDatabase=function(e){var t=this;return new Promise((function(n,r){if(t._indexedDb){t._state=Mi.OPENING;var i=t._indexedDb.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(Li,{keyPath:"key"})})),i.addEventListener("success",(function(r){t._state=Mi.OPEN,t._database=r.target.result,t._openJobQueue.forEach((function(e){return e()})),t._openJobQueue=[],t._database.onclose=function(){t._database=void 0,t._state=Mi.OPENING,setTimeout((function(){t._openDatabase(e)}),5)},n(t._database)})),i.addEventListener("error",(function(e){t._state=Mi.UNINITIALIZED,r(e.target.error)}))}else r(Qr.storeNotAvailable)}))},n.prototype._getObjectStore=function(e){return S(this,void 0,void 0,(function(){var t=this;return N(this,(function(n){switch(n.label){case 0:return this._database?[2,this._database.transaction(this._storeName,e).objectStore(this._storeName)]:[3,1];case 1:switch(this._state){case Mi.UNINITIALIZED:case Mi.OPEN:return[3,2];case Mi.OPENING:case Mi.CLOSED:return[3,3]}return[3,4];case 2:throw Qr.storeNotInitialized;case 3:return[2,new Promise((function(n){t._openJobQueue.push((function(){return n(t._getObjectStore(e))}))}))];case 4:return[4,this._getObjectStore(e)];case 5:return[2,n.sent()]}}))}))},n.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return e=t.sent(),[4,new Promise((function(t,n){var r=e.getAllKeys();r.addEventListener("success",(function(e){t(e.target.result)})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 2:return[2,t.sent()]}}))}))},n.prototype._getRaw=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return t=n.sent(),[4,new Promise((function(n,r){var i=t.get(e);i.addEventListener("success",(function(e){var t;n(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 2:return[2,n.sent()]}}))}))},n.prototype._setRaw=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return t=n.sent(),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.put(e);i.addEventListener("success",(function(e){n(e.target.result)})),i.addEventListener("error",(function(){r("Failed to write.")}))}))})))];case 2:return n.sent(),[2]}}))}))},n.prototype._removeRaw=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return t=n.sent(),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))})))];case 2:return n.sent(),[2]}}))}))},n.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))},n.prototype.checkAvailability=function(){return S(this,void 0,void 0,(function(){var e,t=this;return N(this,(function(n){switch(n.label){case 0:if(!((null==(e="undefined"!=typeof window?window:null)?void 0:e.indexedDB)||(null==e?void 0:e.mozIndexedDB)||(null==e?void 0:e.webkitIndexedDB)||(null==e?void 0:e.msIndexedDB)))return[3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!Ti())return[3,4];if(!(Ti()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return[3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw Qr.storeNotAvailableInPrivateBrowsing;return[3,3];case 1:return[4,new Promise((function(e,n){if(t._indexedDb)try{var r=t._indexedDb.open("_testMozilla");r.onerror=function(){return n(Qr.storeNotAvailableInPrivateBrowsing)},r.onsuccess=function(){return e()}}catch(e){n(Qr.storeNotAvailableInPrivateBrowsing)}else n(Qr.storeNotAvailable)}))];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:throw Qr.storeNotAvailable;case 5:return[3,7];case 6:throw Qr.storeNotAvailable;case 7:return[2]}}))}))},n.prototype.init=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return t.sent(),[4,this._openDatabase(e)];case 2:return t.sent(),[4,this._resetIfEncryptionChanged()];case 3:return t.sent(),[2]}}))}))},n.prototype.clear=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return e=t.sent(),[4,new Promise((function(t,n){var r=e.clear();r.addEventListener("success",(function(){return t()})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 2:return[2,t.sent()]}}))}))},n}(ki),Fi=function(t){function n(e){var n=this,r=e.AsyncStorage,i=e.itemSizeLimit,s=void 0===i?6291456:i,a=fe(e,["AsyncStorage","itemSizeLimit"]);return(n=t.call(this,o(o({},a),{itemSizeLimit:s}))||this)._asyncStorage=r,n}return e(n,t),n.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},n.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,(function(){var e,t=this;return N(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},n.prototype._getRaw=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},n.prototype._setRaw=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a,o;return N(this,(function(u){switch(u.label){case 0:t=[];try{for(n=m(e),r=n.next();!r.done;r=n.next())i=r.value,s=i.key,i.data.length<=this.adjustedItemSizeLimit&&t.push([this._getActualKey(s),JSON.stringify(i)])}catch(e){a={error:e}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}}return[4,this._asyncStorage.multiSet(t)];case 1:return u.sent(),[2]}}))}))},n.prototype._removeRaw=function(e){return S(this,void 0,void 0,(function(){var t=this;return N(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2]}}))}))},n.prototype.checkAvailability=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){if(!this._asyncStorage)throw Qr.storeNotAvailable;return[2]}))}))},n.prototype.init=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},n.prototype.clear=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return[4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[2]}}))}))},n}(ki);!function(t){function n(e){var n,r=this;return(r=t.call(this,o(o({},e),{itemSizeLimit:null!==(n=e.itemSizeLimit)&&void 0!==n?n:6291456}))||this)._mmkv=e.MMKV,r}e(n,t),n.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},n.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,(function(){var e,t=this;return N(this,(function(n){switch(n.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},n.prototype._getRaw=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},n.prototype._setRaw=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a;return N(this,(function(o){try{for(t=m(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,r.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(i),JSON.stringify(r))}catch(e){s={error:e}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}}return[2]}))}))},n.prototype._removeRaw=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s;return N(this,(function(a){try{for(t=m(e),n=t.next();!n.done;n=t.next())r=n.value,this._mmkv.delete(this._getActualKey(r))}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]}))}))},n.prototype.checkAvailability=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){if(!this._mmkv)throw Qr.storeNotAvailable;return[2]}))}))},n.prototype.init=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},n.prototype.clear=function(){return S(this,void 0,void 0,(function(){var e;return N(this,(function(t){switch(t.label){case 0:return[4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[2]}}))}))}}(ki);var qi;!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(qi||(qi={}));var zi,Bi=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=qi.INIT,this._config=i||new Kr({dbname:t}),this._store=r,this._event={success:Xr,error:Xr,storeReplaced:Xr,upgrade:ei},this._collections=new Map,this._globalMutex=new Ni("".concat(this.name,".lock")),this._config.disableLogger&&Oi.off(),new yi({dbname:t,limit:this._config.cacheLimit})}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),e.prototype.estimateUsage=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,(t=this._store,S(void 0,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,t.usage()];case 1:return[2,e.sent()]}}))})))];case 1:return[2,e.sent()]}var t}))}))},e.prototype.commitSchema=function(e){return S(this,void 0,void 0,(function(){var t=this;return N(this,(function(n){switch(n.label){case 0:return this._state!==qi.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return S(t,void 0,void 0,(function(){var t,n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return t=e.collectionName,n=e.keyName,r=e.index,i=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new Ai({dbname:this.name,collectionName:t,keyName:n,indexes:i,store:this._store})),(s=this._collections.get(t))?[4,s.init()]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw Qr.databaseSchemaNotOnUpgrade;case 3:return[2]}}))}))},e.prototype.open=function(){var e;return S(this,void 0,void 0,(function(){var t,n,r,i,s=this;return N(this,(function(a){switch(a.label){case 0:return[4,this._globalMutex.lock()];case 1:if(a.sent(),this._state===qi.OPENED)return[3,12];this._state=qi.OPENING,a.label=2;case 2:return a.trys.push([2,5,,12]),[4,this._store.init(this.name)];case 3:return a.sent(),o=this.name,t="".concat(oi(o),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:return r=null!==(e=a.sent())&&void 0!==e?e:n,[2,new Promise((function(e,n){var i=function(e){r.version<s._version?s._event.upgrade(r.version,(function(n){return S(s,void 0,void 0,(function(){var i;return N(this,(function(s){switch(s.label){case 0:if(n)return[3,5];r.version++,r.collectionNames=Array.from(this._collections.keys()),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r})];case 2:return s.sent(),e({continued:!0}),[3,4];case 3:return i=s.sent(),e({continued:!1,err:i}),[3,4];case 4:return[3,6];case 5:e({continued:!1,err:n}),s.label=6;case 6:return[2]}}))}))})):e({continued:!1})},a=function(t){var o=t.continued,u=void 0!==o&&o,c=t.err,l=void 0===c?null:c;if(u)setTimeout((function(){return i(a)}),10);else if(l)Oi.error(l.message),s._globalMutex.unlock(),s._event.error(l),n(l);else{var d=[];r.collectionNames.forEach((function(e){var t=s._collections.get(e);t&&t.state===jr.READY||d.push(S(s,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return[4,Ai.metadataOf(this.name,e,this._store)];case 1:return(t=r.sent())?(n=new Ai({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(e,n),[4,n.init()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))})))})),Promise.all(d).then((function(){s._state=qi.OPENED,s._globalMutex.unlock(),s._event.success(),e()})).catch((function(e){Oi.error(e.message),s._globalMutex.unlock(),s._event.error(e),n(e)}))}};i(a)}))];case 5:switch(i=a.sent(),i.code){case Nr.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case Nr.STORE_NOT_AVAILABLE:return[3,8]}return[3,10];case 6:return Oi.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new xi({}),this._globalMutex.unlock(),this._event.error(i),this._event.storeReplaced(this._store),[4,this.open()];case 7:return a.sent(),[3,11];case 8:return Oi.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new xi({}),this._globalMutex.unlock(),this._event.error(i),this._event.storeReplaced(this._store),[4,this.open()];case 9:return a.sent(),[3,11];case 10:throw Oi.error(i.message),this._globalMutex.unlock(),this._event.error(i),i;case 11:return[3,12];case 12:return[2]}var o}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=qi.CLOSED},e.prototype.clear=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return S(this,void 0,void 0,(function(){var e,t=this;return N(this,(function(n){switch(n.label){case 0:return this.close(),(e=yi.get(this.name))&&e.clearByCondition((function(e){return e.key.startsWith(oi(t.name))})),[4,this._store.clear()];case 1:return n.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=ei;else this._event[e]=Xr},e.prototype.collection=function(e){var t=this._collections.get(e);if(t)return t;throw Qr.collectionNotReady},e}(),Ki=function(){function e(){this.messageTypeFilter=M.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=K.NONE}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case M.USER:if(e.messageType!==_.USER)return!1;break;case M.FILE:if(e.messageType!==_.FILE)return!1;break;case M.ADMIN:if(e.messageType!==_.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof De))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case K.NONE:if(e.parentMessageId>0)return!1;break;case K.ONLY_REPLY_TO_CHANNEL:if(e instanceof De&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},e}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(zi||(zi={}));var ji,Qi=function(e){switch(e){case zi.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case zi.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Gi=o(o({},Et),{scheduledAt:void 0}),Vi=function(e){return St(e)&&d("number",e.scheduledAt,!0)},Hi=o(o({},gt),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),Wi=function(e){return bt(e)&&d("number",e.scheduledAt)&&(z(e.file)||d("string",e.fileUrl))&&d("string",e.fileName,!0)&&d("string",e.mimeType,!0)&&d("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return d("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Yi="UnsentMessage",Ji="reqId",Xi={},Zi=function(t){function n(e){var n=t.call(this,e)||this;return n._mutex=new Ni("unsendmessagecache.lock"),Xi[e]=n,n}return e(n,t),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return w.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),n.of=function(e,t){return void 0===t&&(t=!1),Xi[e]&&!t||(Xi[e]=new n(e)),Xi[e]},Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,t=null==e?void 0:e.collection(Yi);if(!t)throw U.databaseError;return t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){if(e.messageId>0)throw U.invalidParameters;var t,n=o({},e.serialize());return e instanceof je?(e.messageParams&&(n.messageParams=It(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,o(o({},It(t)),{scheduledAt:t.scheduledAt})))):e instanceof We?(e.messageParams&&(n.messageParams=Ut(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=function(e){return o(o({},Ut(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof Ge&&e.messageParams&&(n.messageParams=function(e){return r({fileInfoList:e.fileInfoList,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption})}(e.messageParams)),n},n.prototype._deserialize=function(e){return e=o(o({},e),{messageId:parseInt(e.messageId)}),is.of(this._iid).buildMessageFromSerializedData(e)},n.prototype._deserializeWithMessageCreateParams=function(e){var t,n,r;return S(this,void 0,void 0,(function(){var i,s,a,o,u,c,l=this;return N(this,(function(d){switch(d.label){case 0:return i=is.of(this._iid),s=this._deserialize(e),e.messageParams?s instanceof je?(o=e.messageParams,s.messageParams=i.buildUserMessageCreateParamsFromSerializedData(o,s),[3,6]):[3,1]:[3,6];case 1:return s instanceof We?(o=e.messageParams).fileKey&&"string"==typeof o.fileKey&&At(null!==(t=o.fileType)&&void 0!==t?t:"")?(a=o,[4,this.collection.getBlob(o.fileKey)]):[3,3]:[3,4];case 2:a.file=null!==(n=d.sent())&&void 0!==n?n:void 0,d.label=3;case 3:return s.messageParams=i.buildFileMessageCreateParamsFromSerializedData(o,s),[3,6];case 4:return s instanceof Ge&&((o=e.messageParams)&&o.fileInfoList)?(s.messageParams=i.buildMultipleFilesMessageCreateParamsFromSerializedData(o,s),[4,Promise.all(s.messageParams.fileInfoList.map((function(e){return S(l,void 0,void 0,(function(){var t,n,r,i,s;return N(this,(function(a){switch(a.label){case 0:return"string"==typeof(null===(n=e._uploadedMetaData)||void 0===n?void 0:n.fileKey)&&At(null!==(i=null===(r=e._uploadedMetaData)||void 0===r?void 0:r.fileType)&&void 0!==i?i:"")?(t=e,[4,this.collection.getBlob(e._uploadedMetaData.fileKey)]):[3,2];case 1:t.file=null!==(s=a.sent())&&void 0!==s?s:void 0,a.label=2;case 2:return[2]}}))}))})))]):[3,6];case 5:d.sent(),d.label=6;case 6:return s.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?s instanceof je?(u=e.scheduledInfo.scheduledMessageParams,s.scheduledInfo.scheduledMessageParams=i.buildScheduledUserMessageCreateParamsFromSerializedData(u,s),[3,10]):[3,7]:[3,10];case 7:return s instanceof We?(u=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof u.fileKey&&"string"==typeof u.fileType&&At(u.fileType)?(c=u,[4,this.collection.getBlob(u.fileKey)]):[3,9]:[3,10];case 8:c.file=null!==(r=d.sent())&&void 0!==r?r:void 0,d.label=9;case 9:s.scheduledInfo.scheduledMessageParams=i.buildScheduledFileMessageCreateParamsFromSerializedData(u,s),d.label=10;case 10:return[2,s]}}))}))},n.prototype._getFileInfoBlobKey=function(e,t){return"".concat(e,".").concat(t)},n.prototype.get=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserializeWithMessageCreateParams(t)];n.label=2;case 2:return[2,void 0]}}))}))},n.prototype.fetch=function(e){var t=e.channelUrl,n=e.filter,r=void 0===n?new Ki:n,i=e.order,s=void 0===i?zi.CHANNEL_LATEST:i,a=e.sendingStatus,o=e.backward,u=void 0!==o&&o,c=e.parentMessageId;return S(this,void 0,void 0,(function(){var e,n,i,o,l=this;return N(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?(e=Qi(s),n={"/where":function(e){return!!(s!==zi.NEWEST_CHILD_MESSAGE||c&&0!==e.parentMessageId&&e.parentMessageId===c)&&r.match(l._deserialize(e))}},t&&(n.channelUrl=t),a&&(n.sendingStatus=a),i={where:n,index:e,backward:u},[4,this.collection.query(i)]):[3,3];case 1:return[4,d.sent().fetch({})];case 2:return o=d.sent(),[2,Promise.all(o.map((function(e){return S(l,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return[4,this._deserializeWithMessageCreateParams(e)];case 1:return[2,t.sent()]}}))}))})))];case 3:return[2,[]]}}))}))},n.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ki),S(this,void 0,void 0,(function(){return N(this,(function(n){switch(n.label){case 0:return[4,this.fetch({filter:t,order:zi.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},n.prototype.upsert=function(e){return S(this,void 0,void 0,(function(){var t=this;return N(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return S(t,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return e instanceof We||e instanceof Ge?[4,this._mutex.lock()]:[3,4];case 1:return n.sent(),[4,this.saveBlob(e)];case 2:return n.sent(),[4,this._mutex.unlock()];case 3:n.sent(),n.label=4;case 4:return t=this._serialize(e),[4,this.collection.upsertOne(t)];case 5:return n.sent(),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.upsertChildMessages=function(e){return S(this,void 0,void 0,(function(){var t=this;return N(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return S(t,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return t=[],e.threadInfo&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=n.sent(),n.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.remove=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a;return N(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=m(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},n.prototype.removeMessagesOfChannel=function(e){return S(this,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.saveBlob=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i=this;return N(this,(function(s){switch(s.label){case 0:return e instanceof We?e.messageParams&&(r=e.messageParams).file&&Nt(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,2]:[3,5];case 1:n=s.sent(),r.fileKey=n,r.fileType=wt.BLOB,s.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&((t=e.scheduledInfo.scheduledMessageParams).file&&Nt(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,4];case 3:n=s.sent(),t.fileKey=n,t.fileType=wt.BLOB,s.label=4;case 4:return[3,7];case 5:return e instanceof Ge&&((r=e.messageParams)&&r.fileInfoList&&Array.isArray(r.fileInfoList))?[4,Promise.all(r.fileInfoList.map((function(t,n){return S(i,void 0,void 0,(function(){var r;return N(this,(function(i){switch(i.label){case 0:return t.file&&Nt(t.file)?[4,this.collection.saveBlob(t.file,this._getFileInfoBlobKey(e.reqId,n))]:[3,2];case 1:r=i.sent(),t._uploadedMetaData||(t._uploadedMetaData={}),t._uploadedMetaData.fileKey=r,t._uploadedMetaData.fileType=wt.BLOB,i.label=2;case 2:return[2]}}))}))})))]:[3,7];case 6:s.sent(),s.label=7;case 7:return[2]}}))}))},n}(c),$i={},es=function(t){function n(e){var n=t.call(this,e)||this;return $i[e]=n,n}return e(n,t),Object.defineProperty(n.prototype,"_sdkState",{get:function(){return w.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return w.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_unsentMessageCache",{get:function(){return Zi.of(this._iid)},enumerable:!1,configurable:!0}),n.of=function(e,t){return void 0===t&&(t=!1),$i[e]&&!t||($i[e]=new n(e)),$i[e]},Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return A(!!e).throw(U.databaseError),e.collection(pr)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){return o(o({},e.serialize()),{messageId:"".concat(e.messageId)})},n.prototype._deserialize=function(e){return e=o(o({},e),{messageId:parseInt(e.messageId)}),is.of(this._iid).buildMessageFromSerializedData(e)},n.prototype.get=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,void 0]}}))}))},n.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,i=void 0===r?100:r,s=e.filter,a=void 0===s?new Ki:s,o=e.order,u=void 0===o?zi.CHANNEL_LATEST:o,c=e.backward,l=void 0!==c&&c,d=e.parentMessageId,h=e.isPollOnly,f=void 0!==h&&h,p=e.exactMatch,m=void 0!==p&&p,v=e.inclusive,y=void 0===v||v;return S(this,void 0,void 0,(function(){var e,r,s,o=this;return N(this,(function(c){switch(c.label){case 0:return this.localCacheEnabled?(e=Qi(u),r={where:{channelUrl:t,"/where":function(e){if(n)switch(u){case zi.CHANNEL_LATEST:if(m&&e.createdAt!==n)return!1;if(l){if(y&&e.createdAt<n||!y&&e.createdAt<=n)return!1}else if(y&&e.createdAt>n||!y&&e.createdAt>=n)return!1;break;case zi.NEWEST_CHILD_MESSAGE:if(!d||0===e.parentMessageId||e.parentMessageId!==d)return!1}return!(f&&!e._poll)&&a.match(o._deserialize(e))}},index:e,backward:l},[4,this.collection.query(r)]):[3,3];case 1:return[4,c.sent().fetch({limit:null!=i?i:void 0})];case 2:return s=c.sent(),[2,Promise.all(s.map((function(e){return S(o,void 0,void 0,(function(){return N(this,(function(t){return[2,this._deserialize(e)]}))}))})))];case 3:return[2,[]]}}))}))},n.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ki),S(this,void 0,void 0,(function(){return N(this,(function(n){switch(n.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:zi.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},n.prototype.upsert=function(e){return S(this,void 0,void 0,(function(){var t,n=this;return N(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:return r.sent(),[4,this.upsertChildMessages(e)];case 3:return r.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},n.prototype.upsertChildMessages=function(e){return S(this,void 0,void 0,(function(){var t=this;return N(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return S(t,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.remove=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a;return N(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=m(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},n.prototype.removeMessagesOfChannel=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:Qi(zi.CHANNEL_LATEST)})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},n.prototype.removeUnderOffset=function(e,t){return S(this,void 0,void 0,(function(){return N(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:Qi(zi.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return S(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.countBetween=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i=this;return N(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=Qi(zi.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,s.sent()];case 2:return[2,0]}}))}))},n.prototype.saveBlobs=function(e){return S(this,void 0,void 0,(function(){var t=this;return N(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return S(t,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return e instanceof We&&e.messageParams&&((t=e.messageParams).file&&Nt(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},n.prototype._getGroupChannelPreferenceSize=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,s,a;return N(this,(function(o){switch(o.label){case 0:return t=0,[4,(n=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return r=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return i=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return s=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return a=o.sent(),r&&(t+=JSON.stringify(r).length),i&&(t+=JSON.stringify(i).length),s&&(t+=JSON.stringify(s).length),a&&(t+=JSON.stringify(a).length),[2,t]}}))}))},n}(c),ts={},ns=function(t){function n(e){var n=t.call(this,e)||this;return n._observers=new Map,n._dispatcherContext=n._dispatcher.on((function(e){return S(n,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,c,l,d,h,f,p,m=this;return N(this,(function(v){switch(v.label){case 0:return e instanceof te?(t=e.messages,f=e.source,s=e.isWebSocketEventComing,n=t.filter((function(e){return e.messageId>0})),r=t.filter((function(e){return 0===e.messageId})),n.length>0?[4,pe((function(){return S(m,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert(n)];case 1:return e.sent(),[4,this._unsentMessageCache.remove(n.map((function(e){return e instanceof De?e.reqId:null})).filter((function(e){return null!==e})))];case 2:return e.sent(),[2]}}))}))}))]:[3,2]):[3,5];case 1:v.sent(),s||this._broadcastUpdateEvent(n,f),v.label=2;case 2:return r.length>0?[4,pe((function(){return S(m,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._unsentMessageCache.upsert(r)];case 1:return e.sent(),[2]}}))}))}))]:[3,4];case 3:v.sent(),s||this._broadcastUpdateEvent(r,f),v.label=4;case 4:return[3,21];case 5:return e instanceof _e?(i=e.messageIds,f=e.source,s=e.isWebSocketEventComing,[4,pe((function(){return S(m,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.remove(i)];case 1:return e.sent(),[2]}}))}))}))]):[3,7];case 6:return v.sent(),s||this._broadcastRemoveEvent(i,f),[3,21];case 7:return e instanceof ye?(a=e.reqId,f=e.source,[4,pe((function(){return S(m,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._unsentMessageCache.remove([a])];case 1:return e.sent(),[2]}}))}))}))]):[3,9];case 8:return v.sent(),this._broadcastRemoveUnsentEvent(a,f),[3,21];case 9:return e instanceof ve?(o=e.polls,f=e.source,this._cacheContext.localCacheEnabled?(u=o.map((function(e){return e.messageId})),[4,Promise.all(u.map((function(e){return m._messageCache.get(e)})))]):[3,12]):[3,13];case 10:return(c=v.sent().filter((function(e){return e}))).length>0&&o.forEach((function(e){var t=c.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),[4,pe((function(){return S(m,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert(c)];case 1:return[2,e.sent()]}}))}))}))];case 11:v.sent(),v.label=12;case 12:return this._broadcastPollChangeLogEvent(o,f),[3,21];case 13:return e instanceof me?(l=e.event,f=e.source,[4,this._messageCache.get(l.messageId)]):[3,17];case 14:return(d=v.sent())&&d.isUserMessage()&&d.poll&&d.poll.applyPollUpdateEvent(l)?[4,pe((function(){return S(m,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert([d])];case 1:return[2,e.sent()]}}))}))}))]:[3,16];case 15:v.sent(),v.label=16;case 16:return this._broadcastPollUpdateEvent(l,f),[3,21];case 17:return e instanceof ue?(h=e.event,f=e.source,[4,this._messageCache.get(h.messageId)]):[3,21];case 18:return(p=v.sent())&&p.isUserMessage()&&p.poll&&p.poll.applyPollVoteEvent(h)?[4,pe((function(){return S(m,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert([p])];case 1:return[2,e.sent()]}}))}))}))]:[3,20];case 19:v.sent(),v.label=20;case 20:this._broadcastPollVoteEvent(h,f),v.label=21;case 21:return[2]}}))}))})),n}return e(n,t),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return w.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_dispatcher",{get:function(){return w.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_messageCache",{get:function(){return es.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_unsentMessageCache",{get:function(){return Zi.of(this._iid)},enumerable:!1,configurable:!0}),n.of=function(e,t){var r;return void 0===t&&(t=!1),ts[e]&&!t||(ts[e]&&(null===(r=ts[e]._dispatcherContext)||void 0===r||r.close()),ts[e]=new n(e)),ts[e]},n.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=m(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onUpdate&&a.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},n.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var i=m(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onPollChangeLogUpdate&&a.onPollChangeLogUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},n.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var i=m(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onPollUpdate&&a.onPollUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},n.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var i=m(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onPollVote&&a.onPollVote(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},n.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=m(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onRemove&&a.onRemove(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},n.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var i=m(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onRemoveUnsent&&a.onRemoveUnsent(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},n.prototype.subscribe=function(e,t){this._observers.set(e,t)},n.prototype.unsubscribe=function(e){this._observers.delete(e)},n.prototype.unsubscribeAll=function(){this._observers.clear()},n}(c),rs={},is=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._cacheContext=a,es.of(e),Zi.of(e),ns.of(e),this.fileMessageQueue=new tt(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:a}),rs[e]=this}return e.of=function(e){return rs[e]},e.prototype.buildMessageFromSerializedData=function(e){var t=ge(e);switch(t.messageType){case _.USER:return new je(this._iid,je.payloadify(t));case _.FILE:return Ge._isMultipleFilesMessageSerializedData(t)?new Ge(this._iid,Ge.payloadify(t)):new We(this._iid,We.payloadify(t));case _.ADMIN:return new Be(this._iid,Be.payloadify(t))}throw U.invalidParameters},e.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return r(a({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId}))},e.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){var n;return r(a({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:null===(n=t.thumbnails)||void 0===n?void 0:n.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth}))},e.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(e,t){return r({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,fileInfoList:e.fileInfoList})},e.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return o(o({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return o(o({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildSenderFromSerializedData=function(e){var t=ge(e);return new Re(this._iid,Re.payloadify(t))},e.prototype.getMessage=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return t=new ot(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(ut).message]}}))}))},e.prototype.getScheduledMessage=function(e){return S(this,void 0,void 0,(function(){var t,n;return N(this,(function(r){switch(r.label){case 0:return t=new ft(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(pt).message]}}))}))},e.prototype.getMessagesByMessageId=function(e,t,n,r,i){return void 0===i&&(i=ne.REQUEST_MESSAGE),S(this,void 0,void 0,(function(){var s,a,u;return N(this,(function(c){switch(c.label){case 0:return s=new ct(o(o({channelType:t,channelUrl:e,token:String(n)},rt),r)),[4,this._requestQueue.send(s)];case 1:return a=c.sent(),u=a.as(lt).messages,this._dispatcher.dispatch(new te({messages:u,source:i})),[2,u]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,n,r,i){return void 0===i&&(i=ne.REQUEST_MESSAGE),S(this,void 0,void 0,(function(){var s,a,u;return N(this,(function(c){switch(c.label){case 0:return s=new ct(o(o({channelType:t,channelUrl:e,timestamp:n},rt),r)),[4,this._requestQueue.send(s)];case 1:return a=c.sent(),u=a.as(lt).messages,this._dispatcher.dispatch(new te({messages:u,source:i})),[2,u]}}))}))},e.prototype._getMessagesByTimestampForCollection=function(e,t,n,r,i,s,a){return void 0===i&&(i=ne.REQUEST_MESSAGE),S(this,void 0,void 0,(function(){var u,c,l,d,h,f;return N(this,(function(p){switch(p.label){case 0:return u=new ct(o(o(o({channelType:t,channelUrl:e,timestamp:n},rt),r),{checkingHasNext:s,checkingContinuousMessages:a})),[4,this._requestQueue.send(u)];case 1:return c=p.sent(),l=c.as(lt),d=l.messages,h=l.isContinuousMessages,f=l.hasNext,this._dispatcher.dispatch(new te({messages:d,source:i})),[2,{messages:d,isContinuousMessages:h,hasNext:f}]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,n,r){return void 0===r&&(r=ne.REQUEST_THREADED_MESSAGE),S(this,void 0,void 0,(function(){var i,s,a,u;return N(this,(function(c){switch(c.label){case 0:return i=new ct(o(o(o({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},qe),n),{replyType:K.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(i)];case 1:return s=c.sent(),a=s.as(lt).messages,(u=a.slice(1)).forEach((function(t){t.parentMessage=e})),this._dispatcher.dispatch(new te({messages:u,source:r})),[2,{parentMessage:a[0],threadedMessages:u}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,n,i,s){return void 0===s&&(s=ne.REQUEST_MESSAGE_CHANGELOGS),S(this,void 0,void 0,(function(){var u,c,l,d,h,f,p,m;return N(this,(function(v){switch(v.label){case 0:return u=new dt(r(a(o(o({channelType:t,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null},st),i)))),[4,this._requestQueue.send(u)];case 1:return c=v.sent(),l=c.as(ht),d=l.updatedMessages,h=l.deletedMessagesInfo,f=l.hasMore,p=l.nextToken,m=h.map((function(e){return e.messageId})),d.length>0&&this._dispatcher.dispatch(new te({messages:d,source:s})),m.length>0&&this._dispatcher.dispatch(new _e({messageIds:m,source:s})),[2,{updatedMessages:d,deletedMessageIds:m,hasMore:f,token:p}]}}))}))},e}(),ss=function(t){function n(e,n){var r=t.call(this,e)||this;r.targetMessageId=0;var i=n.thread_info,s=n.parent_message_id,a=n.channel_url,o=n.channel_type;return i&&d("object",i)&&d("number",s)&&d("string",a)&&d("string",o)&&(r.threadInfo=new Me(e,i),r.targetMessageId=s,r.channelUrl=a,r.channelType=o),r}return e(n,t),n}(c),as={channelUrl:"",channelType:b.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},os=function(n){function r(e){var r=e.channelCustomType,i=e.keyword,s=e.limit,a=e.reverse,o=e.exactMatch,u=e.channelUrl,c=e.order,l=e.messageTimestampFrom,d=e.messageTimestampTo,h=e.advancedQuery,f=e.targetFields,p=e.nextToken,m=n.call(this)||this;return m.method=t.GET,m.path="".concat(be,"/messages"),m.params={custom_type:r,query:i,limit:s,reverse:a,exact_match:o,channel_url:u,message_ts_from:l,message_ts_to:d,sort_field:c,advanced_query:h,target_fields:f,after:p},m}return e(r,n),r}(i),us=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.messages=n.results.map((function(t){return He(e,t)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r.totalCount=n.total_count,r}return e(n,t),n}(s);!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(ji||(ji={}));var cs=function(t){function n(e,n){var r,i,s,a,o,u,c,l,d,h=this;return(h=t.call(this,e,n)||this).keyword="",h.reverse=!1,h.exactMatch=!1,h.channelUrl="",h.channelCustomType="",h.messageTimestampFrom=null,h.messageTimestampTo=null,h.order=ji.SCORE,h.advancedQuery=!1,h.targetFields=null,h._nextToken="",h.totalCount=-1,h.keyword=n.keyword,h.reverse=null!==(r=n.reverse)&&void 0!==r&&r,h.exactMatch=null!==(i=n.exactMatch)&&void 0!==i&&i,h.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:"",h.channelCustomType=null!==(a=n.channelCustomType)&&void 0!==a?a:"",h.messageTimestampFrom=null!==(o=n.messageTimestampFrom)&&void 0!==o?o:null,h.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,h.order=null!==(c=n.order)&&void 0!==c?c:ji.SCORE,h.advancedQuery=null!==(l=n.advancedQuery)&&void 0!==l&&l,h.targetFields=null!==(d=n.targetFields)&&void 0!==d?d:null,h}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&d("string",this.keyword)&&this.keyword.length>0&&d("boolean",this.reverse)&&d("boolean",this.exactMatch)&&d("string",this.channelUrl)&&d("string",this.channelCustomType)&&(d("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(d("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&h(ji,this.order)&&d("boolean",this.advancedQuery)&&l("string",this.targetFields,!0)},n.prototype.next=function(){return S(this,void 0,void 0,(function(){var e,t,n,r,i,s,u,c;return N(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=w.of(this._iid).requestQueue,t=new os(a(o(o({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=l.sent(),r=n.as(us),i=r.messages,s=r.hasNext,u=r.nextToken,c=r.totalCount,this._nextToken=u,this._hasNext=s,this._isLoading=!1,this.totalCount=c,[2,i];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}}))}))},n}(de),ls={channelUrl:"",scheduledMessageId:0},ds=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="message",e}return e(n,t),n.prototype.init=function(e,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;t.prototype.init.call(this,e,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new is(e,{sdkState:r,dispatcher:i,requestQueue:a,onlineDetector:u,cacheContext:c})},n.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},n.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},n.prototype.getMessage=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){return t=o(o({},as),e),A(function(e){return d("string",e.channelUrl)&&h(b,e.channelType)&&d("number",e.messageId)&&d("boolean",e.includeReactions,!0)&&d("boolean",e.includeMetaArray,!0)&&d("boolean",e.includeParentMessageInfo,!0)&&d("boolean",e.includeThreadInfo,!0)}(t)).throw(U.invalidParameters),[2,this._manager.getMessage(t)]}))}))},n.prototype.getScheduledMessage=function(e){return S(this,void 0,void 0,(function(){var t;return N(this,(function(n){return t=o(o({},ls),e),A(function(e){return d("string",e.channelUrl)&&""!==e.channelUrl&&d("number",e.scheduledMessageId)&&e.scheduledMessageId>0}(t)).throw(U.invalidParameters),[2,this._manager.getScheduledMessage(t)]}))}))},n}(Ie);export{De as $,Fi as A,Dr as B,Ur as C,lr as D,He as E,zr as F,Se as G,Ne as H,Di as I,je as J,We as K,_n as L,zi as M,dr as N,Kt as O,yt as P,on as Q,Pt as R,Cr as S,Cn as T,Or as U,An as V,Sn as W,En as X,wn as Y,cr as Z,Bn as _,hr as a,Dn as a0,qn as a1,xn as a2,Xe as a3,is as a4,fr as a5,xt as a6,Lt as a7,Dt as a8,Ft as a9,ji as aA,Ge as aB,Oe as aC,Pe as aD,jt as aE,Ue as aF,Ee as aG,Re as aH,Me as aI,Qe as aJ,Fe as aa,Ce as ab,ke as ac,Ve as ad,Mr as ae,Gi as af,Vi as ag,Hi as ah,Wi as ai,Mt as aj,Er as ak,kt as al,Tt as am,Ot as an,Ir as ao,_t as ap,Yn as aq,Sr as ar,we as as,Te as at,ns as au,Be as av,Ae as aw,ss as ax,_r as ay,Le as az,pr as b,mr as c,Yi as d,Ji as e,vr as f,Qi as g,yr as h,gr as i,br as j,xi as k,ds as l,Rr as m,cs as n,Bi as o,es as p,Zi as q,qi as r,Yt as s,Ar as t,Vt as u,Ke as v,vt as w,mt as x,nt as y,Ki as z};
