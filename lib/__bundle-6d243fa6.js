var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)};function i(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function r(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function s(e,t){var n,i,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function c(e,t,n){if(n||2===arguments.length)for(var i,r=0,s=t.length;r<s;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var u,l="4.20.0",h=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return l},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),e}();!function(e){e[e.NON_AUTHORIZED=400108]="NON_AUTHORIZED",e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",e[e.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",e[e.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",e[e.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",e[e.APPLICATION_NOT_FOUND=400304]="APPLICATION_NOT_FOUND",e[e.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",e[e.SESSION_REVOKED=400310]="SESSION_REVOKED",e[e.INVALID_SESSION_TYPE=400312]="INVALID_SESSION_TYPE",e[e.INVALID_AUTH_FOR_SERVICE=400313]="INVALID_AUTH_FOR_SERVICE",e[e.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",e[e.NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE=400940]="NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.INVALID_REQUIRED_FORM_VALUE=400105]="INVALID_REQUIRED_FORM_VALUE",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE=901500]="NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE",e[e.ERR_DUPLICATED_DATA=400202]="ERR_DUPLICATED_DATA",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_COMMAND=700700]="INVALID_COMMAND",e[e.XMLHTTPREQUEST_NOT_SUPPORTED=700800]="XMLHTTPREQUEST_NOT_SUPPORTED",e[e.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.DELAYED_CONNECTING=800221]="DELAYED_CONNECTING",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED=800270]="ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",e[e.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",e[e.DATABASE_ERROR=800700]="DATABASE_ERROR",e[e.USER_DEACTIVATED=900021]="USER_DEACTIVATED",e[e.CHANNEL_IS_FROZEN=900050]="CHANNEL_IS_FROZEN",e[e.RECEIVER_USER_DEACTIVATED=900081]="RECEIVER_USER_DEACTIVATED"}(u||(u={}));var d,_,f,p,E,g,v=function(e){return!(e instanceof m&&!e.shouldThrowOutside)},m=function(e){function n(t){var i=t.code,r=void 0===i?0:i,s=t.message,o=void 0===s?"":s,a=e.call(this,o)||this;return a.shouldThrowOutside=!1,a._detail="",a.name="SendbirdError",a.code=r,Object.setPrototypeOf(a,n.prototype),a}return t(n,e),Object.defineProperty(n.prototype,"detail",{get:function(){return this._detail},enumerable:!1,configurable:!0}),n.prototype.setDetail=function(e){this._detail=e},Object.defineProperty(n.prototype,"isInvalidTokenError",{get:function(){return this.code===u.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionExpiredError",{get:function(){return this.isSessionTokenExpiredError||this.isSessionKeyExpiredError},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===u.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===u.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionInvalidatedError",{get:function(){return this.isSessionRevokedError||this.isUserAuthDeactivedError||this.isUserAuthDeletedOrNotFoundError},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionRevokedError",{get:function(){return this.code===u.SESSION_REVOKED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isUserAuthDeactivedError",{get:function(){return this.code===u.USER_AUTH_DEACTIVATED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isUserAuthDeletedOrNotFoundError",{get:function(){return this.code===u.USER_AUTH_DELETED_OR_NOT_FOUND},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isNetworkError",{get:function(){return this.code===u.NETWORK_ERROR||this.code===u.NETWORK_ROUTING_ERROR},enumerable:!1,configurable:!0}),Object.defineProperty(n,"debugModeRequired",{get:function(){return new n({code:u.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"lostInstance",{get:function(){return new n({code:u.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidCommand",{get:function(){return new n({code:u.INVALID_COMMAND,message:"Cannot send invalid command."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"unknown",{get:function(){return new n({code:u.UNKNOWN_ERROR,message:"Unknown error occurred."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRenew",{get:function(){return new n({code:u.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidConnectionStateTransition",{get:function(){return new n({code:u.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"xmlHttpRequestNotSupported",{get:function(){return new n({code:u.XMLHTTPREQUEST_NOT_SUPPORTED,message:"Cannot upload file. XMLHttpRequest is not defined in this environment."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRequired",{get:function(){return new n({code:u.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionCanceled",{get:function(){return new n({code:u.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidParameters",{get:function(){return new n({code:u.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"notSupportedError",{get:function(){return new n({code:u.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"channelTypeNotSupportedError",{get:function(){return new n({code:u.NOT_SUPPORTED_ERROR,message:"Called method is not supported in the current channel's channel type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"networkError",{get:function(){return new n({code:u.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"markAsReadAllRateLimitExceeded",{get:function(){return new n({code:u.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"queryInProgress",{get:function(){return new n({code:u.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"noAckTimeout",{get:function(){return new n({code:u.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loginTimeout",{get:function(){return new n({code:u.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionClosed",{get:function(){return new n({code:u.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestFailed",{get:function(){return new n({code:u.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"tooManyRequests",{get:function(){return new n({code:u.REQUEST_DUPLICATED,message:"Too many requests."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"alreadyConnectedAsAnotherUser",{get:function(){return new n({code:u.REQUEST_FAILED,message:"Already logged in as a different user. Call disconnect() first."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileUploadCanceled",{get:function(){return new n({code:u.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestCanceled",{get:function(){return new n({code:u.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRefreshFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRequestFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseError",{get:function(){return new n({code:u.DATABASE_ERROR,message:"Database error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileSizeLimitExceededError",{get:function(){return new n({code:u.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"statLogUploadLimitExceededError",{get:function(){return new n({code:u.ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED,message:"The upload request failed due to the retry count being exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"malformedDataError",{get:function(){return new n({code:u.MALFORMED_DATA,message:"Malformed data."})},enumerable:!1,configurable:!0}),n.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},n}(Error),y=[u.CONNECTION_REQUIRED,u.NETWORK_ERROR,u.ACK_TIMEOUT,u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.FILE_UPLOAD_CANCEL_FAILED,u.REQUEST_CANCELED,u.INTERNAL_SERVER_ERROR,u.RATE_LIMIT_EXCEEDED,u.UNKNOWN_SERVER_ERROR,u.USER_DEACTIVATED,u.CHANNEL_IS_FROZEN,u.RECEIVER_USER_DEACTIVATED],b=[u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.CONNECTION_REQUIRED,u.CHANNEL_IS_FROZEN],T=function(e,t){if(e!==t){var i=n({},e),r=n({},t);return(!i.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||i.messageId===r.messageId)&&((!i.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||i.reqId===r.reqId)&&(i.hasOwnProperty("messageId")&&delete i.messageId,i.hasOwnProperty("reqId")&&delete i.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(i)===JSON.stringify(r)))}return!0},C=function(e,t,n){return void 0===n&&(n=!1),!(!n||!R(t))||("string"!=typeof e?"object"==typeof e?w(e,t):S(e,t):typeof t===e)},w=function(e,t,n){return void 0===n&&(n=!1),!(!n||!R(t))||Object.values(e).includes(t)},S=function(e,t){return t instanceof e},N=function(e,t,n){return void 0===n&&(n=!1),!(!n||!R(t))||Array.isArray(t)&&t.every((function(t){return C(e,t)}))},A=function(e,t){return void 0===t&&(t=!1),!(!t||!R(e))||"number"==typeof e&&13===e.toString().length},D=function(e){return e>0&&y.indexOf(e)>=0},I=function(e){return e>0&&b.indexOf(e)>=0},O=function(e,t){if(void 0===t&&(t=!1),t&&R(e))return!0;var n="object"==typeof e&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},k=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=c([],a(e),!1).sort(),i=c([],a(t),!1).sort(),r=0;r<n.length;++r)if(n[r]!==i[r])return!1;return!0},R=function(e){return null==e},L=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberInfoInMessage,i=void 0===n||n,r=t.typingIndicatorInvalidateTime,s=void 0===r?1e4:r,o=t.typingIndicatorThrottle,a=void 0===o?1e3:o,c=t.websocketResponseTimeout,u=void 0===c?1e4:c,l=t.websocketPayloadDecompression,h=void 0===l||l,d=t.sessionTokenRefreshTimeout,_=void 0===d?60:d;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=i,this._typingIndicatorInvalidateTime=s,this._typingIndicatorThrottle=a,this._websocketResponseTimeout=u,this._sessionTokenRefreshTimeout=_,this.websocketPayloadDecompression=h}return Object.defineProperty(e.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){C("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){C("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){C("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){C("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionTokenRefreshTimeout",{get:function(){return this._sessionTokenRefreshTimeout},set:function(e){C("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e)},enumerable:!1,configurable:!0}),e}(),x={encrypt:function(e){return e},decrypt:function(e){return e}},U=function(){function e(e){var t=e.store;this._preference=new Map,this._store=t}return e.prototype._savePreferenceKeys=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:c([],a(this._preference.keys()),!1)})];case 1:return e.sent(),[2]}}))}))},e.prototype.init=function(e,t){var n;return void 0===t&&(t=1),r(this,void 0,void 0,(function(){var i,r,a,c,u,l,h,d,_,f,p;return s(this,(function(s){switch(s.label){case 0:return this._version=t,this._keysAddress=e,i="".concat(e,".metadata.version"),[4,this._store.get(i)];case 1:return r=s.sent(),[4,this._store.get(e)];case 2:return a=null!==(n=s.sent())&&void 0!==n?n:[],!r||r.version<this._version?9===this._version?[3,3]:[3,6]:[3,10];case 3:return c=a.find((function(e){return e.includes("groupchannel/sync.meta")})),c?[4,this._store.remove(c)]:[3,5];case 4:s.sent(),s.label=5;case 5:return[3,8];case 6:return[4,this._resetPreferenceData(a)];case 7:s.sent(),s.label=8;case 8:return[4,this._updatePreferenceVersionInfo(i)];case 9:return s.sent(),[3,17];case 10:s.trys.push([10,15,16,17]),u=o(a),l=u.next(),s.label=11;case 11:return l.done?[3,14]:(h=l.value,[4,this._store.get(h)]);case 12:(d=s.sent())&&this._preference.set(h,d),s.label=13;case 13:return l=u.next(),[3,11];case 14:return[3,17];case 15:return _=s.sent(),f={error:_},[3,17];case 16:try{l&&!l.done&&(p=u.return)&&p.call(u)}finally{if(f)throw f.error}return[7];case 17:return[2]}}))}))},e.prototype._updatePreferenceVersionInfo=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._store.set({key:e,value:{version:this._version}})];case 1:return t.sent(),[2]}}))}))},e.prototype._resetPreferenceData=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._preference=new Map,[4,this._store.removeMany(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this._preference.get(e)]}))}))},e.prototype.set=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=!this._preference.has(e),[4,this._store.set({key:e,value:t})];case 1:return i.sent(),this._preference.set(e,t),n?[4,this._savePreferenceKeys()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._store.remove(e)];case 1:return t.sent(),this._preference.delete(e),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._store.removeMany(c([],a(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}}))}))},e}(),P=function(){function e(e){var t=e.encryption,n=e.store,i=e.localCacheEnabled,r=e.localCacheConfig;this.store=n,this.preference=new U({store:n}),this.encryption=null!=t?t:x,this.localCacheEnabled=i,this.localCacheConfig=r}return e.prototype.replaceStore=function(e){this.store=e,this.preference=new U({store:e})},e}();!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error"}(d||(d={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off"}(_||(_={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown"}(f||(f={})),function(e){e.SESSION_TOKEN="session_token",e.ACCESS_TOKEN="access_token"}(p||(p={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default"}(E||(E={})),function(e){e.CUSTOM="custom",e.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(g||(g={}));var M,q=function(){function e(e){var t=e.channel,n=e.cachedMessageCount;this._cachedMessageCount=0,this._channel=t,this._cachedMessageCount=n}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cachedMessageCount",{get:function(){return this._cachedMessageCount},enumerable:!1,configurable:!0}),e}(),F=function(){function e(e){var t=void 0===e?{}:e,n=t.maxSize,i=void 0===n?256:n,r=t.clearOrder,s=void 0===r?g.MESSAGE_COLLECTION_ACCESSED_AT:r,o=t.customClearOrderComparator,a=t.enableAutoResend,c=void 0===a||a;this._clearOrderComparatorUseMessageCollectionAccessedAt=function(e,t){return e.channel.messageCollectionLastAccessedAt===t.channel.messageCollectionLastAccessedAt?e.channel.lastMessage&&!t.channel.lastMessage?1:!e.channel.lastMessage&&t.channel.lastMessage?-1:e.channel.lastMessage||t.channel.lastMessage?e.channel.lastMessage.createdAt-t.channel.lastMessage.createdAt:0:e.channel.messageCollectionLastAccessedAt>t.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(i,64),o?(this._clearOrder=s,this._customClearOrderComparator=o):this._clearOrder=g.MESSAGE_COLLECTION_ACCESSED_AT,this._enableAutoResend=c}return Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearOrder",{get:function(){return this._clearOrder},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearOrderComparator",{get:function(){var e;return this._clearOrder===g.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:null!==(e=this._customClearOrderComparator)&&void 0!==e?e:this._clearOrderComparatorUseMessageCollectionAccessedAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableAutoResend",{get:function(){return this._enableAutoResend},enumerable:!1,configurable:!0}),e}();!function(e){e.FEED="feed",e.CHAT="chat",e.CHAT_API="chat_api"}(M||(M={}));var H,V,G,z,j,K,B,Q,W,Z,Y,X,J,$=function(){function e(){this.isRefreshing=!1}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasChatServicePermission",{get:function(){var e;return!!(null===(e=this.services)||void 0===e?void 0:e.includes(M.CHAT))},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=void 0,this.sessionKey=void 0,this.services=[]},e}(),ee=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},te=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=ee()}return e.prototype._register=function(e,t,n){var i;return e in this._container||(this._container[e]=new Map),null===(i=this._container[e])||void 0===i||i.set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){var e=this;Object.keys(this._container).forEach((function(t){var n;null===(n=e._container[t])||void 0===n||n.delete(e.key)}))},e}(),ne=function(){function e(){this._container={}}return e.prototype.on=function(e,t){return new te({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new te({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,i,r=this._container[e];if(r){var s=[];try{for(var a=o(r.keys()),c=a.next();!c.done;c=a.next()){var u=c.value,l=r.get(u);l.handler(t),l.occurence>0&&(l.occurence--,0===l.occurence&&s.push(u))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}s.forEach((function(e){return r.delete(e)}))}},e}(),ie=function(){function e(){this._dispatcher=new ne}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},e}(),re=function(){},se=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0===e[n]||Number.isNaN(e[n])||null===e[n]||(t[n]=e[n])})),t},oe=function(e){if(null!=e){if("object"==typeof e){if(Array.isArray(e)){for(var t=c([],a(e),!1),n=0;n<t.length;n++)t[n]=oe(t[n]);return t}return Object.keys(e).forEach((function(t){null===e[t]&&delete e[t]})),e}return e}};!function(e){e.BASE="base",e.GROUP="group",e.OPEN="open",e.FEED="feed"}(H||(H={})),function(e){e.OPERATOR="operator",e.NONE="none"}(V||(V={})),function(e){e.MUTED="muted",e.UNMUTED="unmuted"}(G||(G={})),function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin"}(z||(z={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(j||(j={})),function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(K||(K={})),function(e){e.USERS="users",e.CHANNEL="channel"}(B||(B={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(Q||(Q={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress"}(W||(W={})),function(e){e.PENDING="pending",e.SCHEDULED="scheduled",e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled"}(Z||(Z={})),function(e){e.INREVIEW="InReview",e.APPROVED="Approved"}(Y||(Y={})),function(e){e.HIGH="high",e.NORMAL="normal",e.LOW="low"}(X||(X={})),function(e){e.CREATED_AT="created_at",e.UPDATED_AT="updated_at"}(J||(J={}));var ae,ce="v3",ue="/".concat(ce,"/users"),le="/".concat(ce,"/sdk/users"),he="/".concat(ce,"/storage/file"),de="/".concat(ce,"/group_channels"),_e="/".concat(ce,"/sdk/group_channels"),fe="/".concat(ce,"/open_channels"),pe="/".concat(ce,"/sdk/open_channels"),Ee="/".concat(ce,"/search"),ge="/".concat(ce,"/report"),ve="/".concat(ce,"/emojis"),me="/".concat(ce,"/emoji_categories"),ye="/".concat(ce,"/polls"),be="/".concat(ce,"/scheduled_messages"),Te="/".concat(ce,"/sdk/ui_kit/configuration"),Ce="/".concat(ce,"/sdk/statistics"),we="/".concat(ce,"/sdk/notification_statistics"),Se="/".concat(ce,"/notifications"),Ne="/".concat(ce,"/notifications/users"),Ae="/".concat(ce,"/message_templates"),De="/".concat(ce,"/sdk/push_delivery"),Ie="/".concat(ce,"/forms"),Oe="/".concat(ce,"/report_category"),ke="/".concat(ce,"/sdk/applications/settings"),Re="/".concat(ce,"/ai_agent"),Le="/".concat(ce,"/ai_agent/group_channels"),xe="/".concat(ce,"/ai_agent/users"),Ue=function(e){switch(e){case H.FEED:case H.GROUP:return de;case H.OPEN:return fe;default:return null}},Pe=function(e){switch(e){case H.GROUP:return"".concat(ge,"/group_channels");case H.OPEN:return"".concat(ge,"/open_channels");default:return null}},Me=function(e,t,n){var i,r;switch(e){case B.CHANNEL:return!0;case B.USERS:if(t)try{for(var s=o(t),a=s.next();!a.done;a=s.next()){if(a.value===n)return!0}}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}}return!1},qe=function(e,t,n){var i,r,s,o,a=Me(null!==(i=e.mentionType)&&void 0!==i?i:null,null!==(r=e.mentionedUserIds)&&void 0!==r?r:[],n),c=Me(null!==(s=t.mentionType)&&void 0!==s?s:null,null!==(o=t.mentionedUserIds)&&void 0!==o?o:[],n);return!a&&c?1:a&&!c?-1:0},Fe=function(e,t,n){var i,r=t||new FormData;for(var s in e)if(e.hasOwnProperty(s)){var o=e[s],a=n?"".concat(n,"[").concat(s,"]"):s;O(o)?r.append(a,o,null!==(i=o.name)&&void 0!==i?i:"filename"):"object"!=typeof o||null===o||Array.isArray(o)||o instanceof Blob?r.append(a,String(o)):r=Fe(o,r,a)}return r};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e.PATCH="PATCH"}(ae||(ae={}));var He,Ve=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=ee(),t}return t(n,e),n.prototype.encodeParams=function(e){var t=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return t.encodeParams(e)})).join(","):"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))},Object.defineProperty(n.prototype,"query",{get:function(){var e=this,t=se(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"payload",{get:function(){var e=se(this.params);return Object.keys(e).some((function(t){return O(e[t])}))?Fe(e):JSON.stringify(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasSessionKey",{get:function(){return void 0!==this.headers["Session-Key"]},enumerable:!1,configurable:!0}),n}(re),Ge=function(e){function i(t,n){var i=e.call(this)||this;return i._iid=t,i._payload=n,i}return t(i,e),Object.defineProperty(i.prototype,"payload",{get:function(){return n({},this._payload)},enumerable:!1,configurable:!0}),i.prototype.as=function(e){return new e(this._iid,this.payload)},i}(re),ze=function(e){function n(t){var n=e.call(this)||this;return n.requestId=t,n}return t(n,e),n}(re),je=function(e){function n(t){var n=t.expires_in,i=t.reason,r=void 0===i?u.SESSION_KEY_EXPIRED:i,s=t.message,o=void 0===s?"":s,a=e.call(this)||this;switch(a.expiresIn=null!=n?n:0,r){case u.SESSION_KEY_EXPIRED:case u.SESSION_TOKEN_EXPIRED:case u.SESSION_REVOKED:case u.USER_AUTH_DEACTIVATED:case u.USER_AUTH_DELETED_OR_NOT_FOUND:a.error=new m({code:r,message:o})}return a}return t(n,e),Object.defineProperty(n.prototype,"invalidateSessionToken",{get:function(){var e;return!!(null===(e=this.error)||void 0===e?void 0:e.isSessionTokenExpiredError)},enumerable:!1,configurable:!0}),n}(re),Ke=function(e){function n(t,n,i,r){void 0===r&&(r="");var s,o=this;return(o=e.call(this)||this)._iid=t,o.code=n,o.payload=i,o.requestId=null!==(s=i.req_id)&&void 0!==s?s:r,o}return t(n,e),n.createFromRawMessage=function(e,t){var i=t.substring(0,4),r={};try{r=JSON.parse(t.substring(4))}catch(e){i="NOOP"}finally{return new n(e,i,r)}},n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},n}(re),Be=function(e){function n(t){var n,i=t.code,r=t.ackRequired,s=t.payload,o=void 0===s?{}:s,a=this;return(a=e.call(this)||this).code=i,a.payload=o,a.requestId=null!==(n=a.payload.req_id)&&void 0!==n?n:ee(),a.ackRequired=r,a.payload.req_id=a.requestId,a}return t(n,e),n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n}(re),Qe=function(e){function n(t){var n=t.userId,i=t.authToken,r=t.services,s=t.expiringSession,o=void 0===s||s,a=e.call(this)||this;return a.path="".concat(ue,"/").concat(encodeURIComponent(n),"/session_key"),a.method=ae.POST,a.params=se({token:i,services:r,expiring_session:!!o}),a.requireAuth=!1,a}return t(n,e),n}(Ve),We=function(e){function n(t){var n=t.authToken,i=t.expiringSession,r=void 0===i||i,s=t.requestId,o=void 0===s?void 0:s;return e.call(this,{code:"LOGI",payload:se({token:n,expiring_session:r?1:0,req_id:o}),ackRequired:!0})||this}return t(n,e),n}(Be),Ze=function(e){function n(t,n){var i=e.call(this,t,n)||this,r=n.key,s=n.expires_at,o=n.services;return i.key=r,i.expiresAt=s,i.services=o,i}return t(n,e),n}(Ge),Ye=function(e){function n(t,n,i){var r,s=this;return(s=e.call(this,t,"LOGI",i)||this).error=null,s.newKey=null,s.newKey=null!==(r=i.new_key)&&void 0!==r?r:null,s.error=i.error?new m(i):null,s}return t(n,e),n}(Ke),Xe=function(e){function n(t){var n=e.call(this)||this;return n.statLog=t,n}return t(n,e),n}(re),Je=function(e){function n(t){var n=t.request,i=t.deferred,r=t.error,s=void 0===r?m.requestFailed:r,o=e.call(this)||this;return o.request=n,o.deferred=i,o.error=s,o}return t(n,e),n}(re);!function(e){e.FEATURE_LOCALCACHE="feature:local_cache",e.FEATURE_LOCALCACHE_EVENT="feature:local_cache_event",e.NOTIFICATION="noti:stats",e.WEBSOCKET_CONNECT="ws:connect",e.WEBSOCKET_DISCONNECT="ws:disconnect",e.API_RESULT="api:result"}(He||(He={}));var $e,et,tt,nt=function(){function e(e){var t=e.type,n=e.data,i=e.ts,r=void 0===i?Date.now():i;this.type=t,this.createdAt=r,this.data=n}return e.payloadify=function(e){return se({stat_type:e.type,ts:e.createdAt,data:se(e.data)})},e}(),it=function(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},rt=function(){return!("undefined"==typeof navigator||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};!function(e){e.CHAT="chat",e.CALLS="calls",e.DESK="desk",e.LIVE="live",e.UIKIT_CHAT="uikit-chat",e.UIKIT_LIVE="uikit-live",e.AI_AGENT="ai-agent"}($e||($e={})),function(e){e.ANDROID="android",e.IOS="ios",e.JS="js",e.UNREAL="unreal",e.UNITY="unity",e.REACT_NATIVE="react-native",e.FLUTTER="flutter"}(et||(et={})),function(e){e.ANDROID="android",e.IOS="ios",e.WEB="web",e.MOBILE_WEB="mobile_web",e.WINDOWS="windows"}(tt||(tt={}));var st="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",ot=function(){function e(){}var t;return t=e,e._getFrameWork=function(){if("undefined"!=typeof window){if(window.__REACT__)return"react";if(window.__VUE__)return"vue";var e=window.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(e&&e.getFiberRoots&&e.getFiberRoots(1).size>0)return"react";if(window.__NUXT__)return"vue(SSR)";if(window.__NEXT_DATA__||window.__NEXT_P||window.__NEXT_F)return"nextjs"}return""},e.sendbirdSdkUserAgentWithExtension=function(e){var i=it()?et.REACT_NATIVE:et.JS,r={main_sdk_info:"chat/".concat(i,"/").concat(h.SDK_VERSION),device_os_platform:rt()?"mobile-web":"web",os_version:h.OS_VERSION};if(e){var s=e.sendbirdExtensions,o=e.deviceOS,c=e.customData,u=void 0===c?{}:c;o.version&&(r.os_version=o.version),o.platform&&(r.device_os_platform=o.platform),s.length>0&&(r.extension_sdk_info=s.map((function(e){var t=e.product,n=e.platform,i=e.version;return"".concat(t,"/").concat(n,"/").concat(i)})).join(",")),Object.keys(r).forEach((function(e){return delete u[e]})),Object.keys(u).length>0&&(r=n(n({},r),u))}var l=t._getFrameWork();return l&&(r.javascript_framework=l),Object.entries(r).map((function(e){var t=a(e,2),n=t[0],i=t[1];return"".concat(n,"=").concat(i)})).join("&")},e.userAgentWithExtension=function(e){var t=it()?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",i=e.sb_uikit?"u".concat(e.sb_uikit):"",r=e["device-os-platform"]?"o".concat(e["device-os-platform"]):rt()?"omobile-web":"oweb";return"".concat(t,"/c").concat(h.SDK_VERSION,"/").concat(n,"/").concat(i,"/").concat(r)},e}(),at=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=function(e){n(e)}}))},ct=function(e){function n(t){var n=e.call(this)||this;return n.requestId=t.requestId,n}return t(n,e),n}(re),ut=function(e){function n(t){var n=e.call(this)||this;return n.method=ae.DELETE,n.path="".concat(Ue(t.channelType),"/").concat(t.channelUrl,"/messages/").concat(t.messageId),t.messageToken&&(n.params=se({mesg_token:t.messageToken})),n}return t(n,e),n}(Ve);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(Ge);var lt=function(e){function n(t,n,i){var r,s=this;return(s=e.call(this,t,"DELM",i)||this).channelUrl=i.channel_url,s.channelType=i.channel_type,s.messageId=Number(i.msg_id),s.silent=i.silent,s.messageCreatedAt=i.message_created_at?Number(i.message_created_at):-1,s.senderId=null!==(r=i.sender_id)&&void 0!==r?r:void 0,s}return t(n,e),n}(Ke),ht=function(){function e(e,t){var n=t.session,i=t.sdkState,r=t.dispatcher,s=t.logger,o=t.useFetchCompat,a=void 0!==o&&o,c=this;this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=e,this._session=n,this._sdkState=i,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof ze&&c.cancel(e.requestId)})),this._logger=s,this._shouldImportFetchCompat=a}return e.prototype._createHeader=function(e,t){var i=this._sdkState,r=i.appId,s=i.appVersion,o=i.sendbirdRuntimeEnvironment,a=n(n({},e.headers),{SendBird:"JS,".concat(h.OS_VERSION,",").concat(h.SDK_VERSION,",").concat(r).concat(s?",".concat(s):""),"SB-User-Agent":ot.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":ot.sendbirdSdkUserAgentWithExtension(o)});return t||(a["Content-Type"]="application/json; charset=utf-8"),a["App-Id"]=r,e.requireAuth?!e.hasSessionKey&&this._session.hasSession&&(a["Session-key"]=this._session.sessionKey):this._session.authToken&&(a["Access-token"]=this._session.authToken),a},e.prototype._statLogApiResult=function(e,t,n){e.path.includes("/sdk/statistics")||this._dispatcher.dispatch(new Xe(new nt({type:He.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},e.prototype._isBodyRequired=function(e){var t=e.method;return t!==ae.GET&&(t!==ae.DELETE||e instanceof ut)},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,o,a,c,l,h,d,_,f,p,E,g,v,y,b,T;return s(this,(function(s){switch(s.label){case 0:t=e.path,n=e.method,i=e.uploadProgressHandler,r=this._isBodyRequired(e),o=this._sdkState.api,a="".concat(o.host).concat(t).concat(r?"":e.query),c=r?e.payload:null,l=this._createHeader(e,c instanceof FormData?c:void 0),h=new AbortController,d=h.signal,this._abortControl.set(e.requestId,h),_=Date.now(),s.label=1;case 1:return s.trys.push([1,13,,14]),i?[4,import("./__bundle-5a6cc298.js")]:[3,6];case 2:f=s.sent().xmlHttpRequest,s.label=3;case 3:return s.trys.push([3,5,,6]),[4,f(this._iid,{requestId:e.requestId,method:e.method,url:a,headers:l,data:null!=c?c:void 0,uploadProgressHandler:i})];case 4:return p=s.sent(),this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,_),[2,p];case 5:if(!((E=s.sent())instanceof m&&E.code===u.XMLHTTPREQUEST_NOT_SUPPORTED))throw E;return this._logger.debug("XMLHttpRequest is not available in this environment. progressHandler is ignored."),[3,6];case 6:return this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,("undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global||{fetch:null}).fetch=null),"undefined"!=typeof AbortController?[3,8]:[4,import("./__bundle-8b4f432b.js")];case 7:s.sent(),s.label=8;case 8:return"function"==typeof fetch?[3,10]:[4,import("./__bundle-46d64517.js")];case 9:s.sent(),s.label=10;case 10:return[4,fetch(a,{method:n,body:c,headers:l,signal:d})];case 11:return[4,(g=s.sent()).json()];case 12:if(v=s.sent(),g.ok||g.redirected)return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,_),[2,new Ge(this._iid,v)];if(v){if((y=new m(v)).isSessionExpiredError){if(this._dispatcher.dispatch(new je({reason:y.code,message:y.message})),!(e instanceof Qe))return b=new at,this._dispatcher.dispatch(new Je({request:e,deferred:b,error:y})),[2,b.promise];throw y}throw y.isSessionInvalidatedError?(this._dispatcher.dispatch(new je({reason:y.code,message:y.message})),y):y}throw m.requestFailed;case 13:throw T=s.sent(),this._statLogApiResult(e,_,T),T instanceof m?(this._logger.debug("fail api request",T),T):"AbortError"===(null==T?void 0:T.name)?m.requestCanceled:(this._logger.debug("fail api request",T),m.networkError);case 14:return[2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e));this._dispatcher.dispatch(new ct({requestId:e}))},e.prototype.cancelAll=function(){var e,t;try{for(var n=o(this._abortControl.values()),i=n.next();!i.done;i=n.next()){i.value.abort()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear(),this._dispatcher.dispatch(new ct({}))},e}(),dt=function(){};function _t(e){let t=e.length;for(;--t>=0;)e[t]=0}const ft=256,pt=286,Et=30,gt=15,vt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),mt=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),yt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tt=new Array(576);_t(Tt);const Ct=new Array(60);_t(Ct);const wt=new Array(512);_t(wt);const St=new Array(256);_t(St);const Nt=new Array(29);_t(Nt);const At=new Array(Et);function Dt(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}let It,Ot,kt;function Rt(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}_t(At);const Lt=e=>e<256?wt[e]:wt[256+(e>>>7)],xt=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ut=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,xt(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Pt=(e,t,n)=>{Ut(e,n[2*t],n[2*t+1])},Mt=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},qt=(e,t,n)=>{const i=new Array(16);let r,s,o=0;for(r=1;r<=gt;r++)o=o+n[r-1]<<1,i[r]=o;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=Mt(i[t]++,t))}},Ft=e=>{let t;for(t=0;t<pt;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Et;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Ht=e=>{e.bi_valid>8?xt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Vt=(e,t,n,i)=>{const r=2*t,s=2*n;return e[r]<e[s]||e[r]===e[s]&&i[t]<=i[n]},Gt=(e,t,n)=>{const i=e.heap[n];let r=n<<1;for(;r<=e.heap_len&&(r<e.heap_len&&Vt(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!Vt(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i},zt=(e,t,n)=>{let i,r,s,o,a=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+a++],i+=(255&e.pending_buf[e.sym_buf+a++])<<8,r=e.pending_buf[e.sym_buf+a++],0===i?Pt(e,r,t):(s=St[r],Pt(e,s+ft+1,t),o=vt[s],0!==o&&(r-=Nt[s],Ut(e,r,o)),i--,s=Lt(i),Pt(e,s,n),o=mt[s],0!==o&&(i-=At[s],Ut(e,i,o)))}while(a<e.sym_next);Pt(e,256,t)},jt=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,a,c,u=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)0!==n[2*o]?(e.heap[++e.heap_len]=u=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,r&&(e.static_len-=i[2*c+1]);for(t.max_code=u,o=e.heap_len>>1;o>=1;o--)Gt(e,n,o);c=s;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Gt(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,n[2*c]=n[2*o]+n[2*a],e.depth[c]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,n[2*o+1]=n[2*a+1]=c,e.heap[1]=c++,Gt(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,i=t.max_code,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let u,l,h,d,_,f,p=0;for(d=0;d<=gt;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)l=e.heap[u],d=n[2*n[2*l+1]+1]+1,d>c&&(d=c,p++),n[2*l+1]=d,l>i||(e.bl_count[d]++,_=0,l>=a&&(_=o[l-a]),f=n[2*l],e.opt_len+=f*(d+_),s&&(e.static_len+=f*(r[2*l+1]+_)));if(0!==p){do{for(d=c-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[c]--,p-=2}while(p>0);for(d=c;0!==d;d--)for(l=e.bl_count[d];0!==l;)h=e.heap[--u],h>i||(n[2*h+1]!==d&&(e.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),l--)}})(e,t),qt(n,u,e.bl_count)},Kt=(e,t,n)=>{let i,r,s=-1,o=t[1],a=0,c=7,u=4;for(0===o&&(c=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=t[2*(i+1)+1],++a<c&&r===o||(a<u?e.bl_tree[2*r]+=a:0!==r?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,s=r,0===o?(c=138,u=3):r===o?(c=6,u=3):(c=7,u=4))},Bt=(e,t,n)=>{let i,r,s=-1,o=t[1],a=0,c=7,u=4;for(0===o&&(c=138,u=3),i=0;i<=n;i++)if(r=o,o=t[2*(i+1)+1],!(++a<c&&r===o)){if(a<u)do{Pt(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==s&&(Pt(e,r,e.bl_tree),a--),Pt(e,16,e.bl_tree),Ut(e,a-3,2)):a<=10?(Pt(e,17,e.bl_tree),Ut(e,a-3,3)):(Pt(e,18,e.bl_tree),Ut(e,a-11,7));a=0,s=r,0===o?(c=138,u=3):r===o?(c=6,u=3):(c=7,u=4)}};let Qt=!1;const Wt=(e,t,n,i)=>{Ut(e,0+(i?1:0),3),Ht(e),xt(e,n),xt(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Zt=(e,t,n,i)=>{let r,s,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<ft;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),jt(e,e.l_desc),jt(e,e.d_desc),o=(e=>{let t;for(Kt(e,e.dyn_ltree,e.l_desc.max_code),Kt(e,e.dyn_dtree,e.d_desc.max_code),jt(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*bt[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),r=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&-1!==t?Wt(e,t,n,i):4===e.strategy||s===r?(Ut(e,2+(i?1:0),3),zt(e,Tt,Ct)):(Ut(e,4+(i?1:0),3),((e,t,n,i)=>{let r;for(Ut(e,t-257,5),Ut(e,n-1,5),Ut(e,i-4,4),r=0;r<i;r++)Ut(e,e.bl_tree[2*bt[r]+1],3);Bt(e,e.dyn_ltree,t-1),Bt(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),zt(e,e.dyn_ltree,e.dyn_dtree)),Ft(e),i&&Ht(e)},Yt={_tr_init:e=>{Qt||((()=>{let e,t,n,i,r;const s=new Array(16);for(n=0,i=0;i<28;i++)for(Nt[i]=n,e=0;e<1<<vt[i];e++)St[n++]=i;for(St[n-1]=i,r=0,i=0;i<16;i++)for(At[i]=r,e=0;e<1<<mt[i];e++)wt[r++]=i;for(r>>=7;i<Et;i++)for(At[i]=r<<7,e=0;e<1<<mt[i]-7;e++)wt[256+r++]=i;for(t=0;t<=gt;t++)s[t]=0;for(e=0;e<=143;)Tt[2*e+1]=8,e++,s[8]++;for(;e<=255;)Tt[2*e+1]=9,e++,s[9]++;for(;e<=279;)Tt[2*e+1]=7,e++,s[7]++;for(;e<=287;)Tt[2*e+1]=8,e++,s[8]++;for(qt(Tt,287,s),e=0;e<Et;e++)Ct[2*e+1]=5,Ct[2*e]=Mt(e,5);It=new Dt(Tt,vt,257,pt,gt),Ot=new Dt(Ct,mt,0,Et,gt),kt=new Dt(new Array(0),yt,0,19,7)})(),Qt=!0),e.l_desc=new Rt(e.dyn_ltree,It),e.d_desc=new Rt(e.dyn_dtree,Ot),e.bl_desc=new Rt(e.bl_tree,kt),e.bi_buf=0,e.bi_valid=0,Ft(e)},_tr_stored_block:Wt,_tr_flush_block:Zt,_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(St[n]+ft+1)]++,e.dyn_dtree[2*Lt(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Ut(e,2,3),Pt(e,256,Tt),(e=>{16===e.bi_valid?(xt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Xt=(e,t,n,i)=>{let r=65535&e,s=e>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{r=r+t[i++]|0,s=s+r|0}while(--o);r%=65521,s%=65521}return r|s<<16};const Jt=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var $t=(e,t,n,i)=>{const r=Jt,s=i+n;e^=-1;for(let n=i;n<s;n++)e=e>>>8^r[255&(e^t[n])];return~e},en={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},tn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:nn,_tr_stored_block:rn,_tr_flush_block:sn,_tr_tally:on,_tr_align:an}=Yt,{Z_NO_FLUSH:cn,Z_PARTIAL_FLUSH:un,Z_FULL_FLUSH:ln,Z_FINISH:hn,Z_BLOCK:dn,Z_OK:_n,Z_STREAM_END:fn,Z_STREAM_ERROR:pn,Z_DATA_ERROR:En,Z_BUF_ERROR:gn,Z_DEFAULT_COMPRESSION:vn,Z_FILTERED:mn,Z_HUFFMAN_ONLY:yn,Z_RLE:bn,Z_FIXED:Tn,Z_DEFAULT_STRATEGY:Cn,Z_UNKNOWN:wn,Z_DEFLATED:Sn}=tn,Nn=258,An=262,Dn=42,In=113,On=666,kn=(e,t)=>(e.msg=en[t],t),Rn=e=>2*e-(e>4?9:0),Ln=e=>{let t=e.length;for(;--t>=0;)e[t]=0},xn=e=>{let t,n,i,r=e.w_size;t=e.hash_size,i=t;do{n=e.head[--i],e.head[i]=n>=r?n-r:0}while(--t);t=r,i=t;do{n=e.prev[--i],e.prev[i]=n>=r?n-r:0}while(--t)};let Un=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Pn=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Mn=(e,t)=>{sn(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Pn(e.strm)},qn=(e,t)=>{e.pending_buf[e.pending++]=t},Fn=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Hn=(e,t,n,i)=>{let r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),n),1===e.state.wrap?e.adler=Xt(e.adler,t,r,n):2===e.state.wrap&&(e.adler=$t(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)},Vn=(e,t)=>{let n,i,r=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-An?e.strstart-(e.w_size-An):0,u=e.window,l=e.w_mask,h=e.prev,d=e.strstart+Nn;let _=u[s+o-1],f=u[s+o];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,u[n+o]===f&&u[n+o-1]===_&&u[n]===u[s]&&u[++n]===u[s+1]){s+=2,n++;do{}while(u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&s<d);if(i=Nn-(d-s),s=d-Nn,i>o){if(e.match_start=t,o=i,i>=a)break;_=u[s+o-1],f=u[s+o]}}}while((t=h[t&l])>c&&0!=--r);return o<=e.lookahead?o:e.lookahead},Gn=e=>{const t=e.w_size;let n,i,r;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-An)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),xn(e),i+=t),0===e.strm.avail_in)break;if(n=Hn(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Un(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Un(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<An&&0!==e.strm.avail_in)},zn=(e,t)=>{let n,i,r,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(n=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r)break;if(r=e.strm.avail_out-r,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>r&&(n=r),n<s&&(0===n&&t!==hn||t===cn||n!==i+e.strm.avail_in))break;o=t===hn&&n===i+e.strm.avail_in?1:0,rn(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Pn(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(Hn(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==cn&&t!==hn&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(Hn(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,s=r>e.w_size?e.w_size:r,i=e.strstart-e.block_start,(i>=s||(i||t===hn)&&t!==cn&&0===e.strm.avail_in&&i<=r)&&(n=i>r?r:i,o=t===hn&&0===e.strm.avail_in&&n===i?1:0,rn(e,e.block_start,n,o),e.block_start+=n,Pn(e.strm)),o?3:1)},jn=(e,t)=>{let n,i;for(;;){if(e.lookahead<An){if(Gn(e),e.lookahead<An&&t===cn)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Un(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-An&&(e.match_length=Vn(e,n)),e.match_length>=3)if(i=on(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Un(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Un(e,e.ins_h,e.window[e.strstart+1]);else i=on(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Mn(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===hn?(Mn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mn(e,!1),0===e.strm.avail_out)?1:2},Kn=(e,t)=>{let n,i,r;for(;;){if(e.lookahead<An){if(Gn(e),e.lookahead<An&&t===cn)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Un(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-An&&(e.match_length=Vn(e,n),e.match_length<=5&&(e.strategy===mn||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=on(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=Un(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Mn(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=on(e,0,e.window[e.strstart-1]),i&&Mn(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=on(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===hn?(Mn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mn(e,!1),0===e.strm.avail_out)?1:2};function Bn(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}const Qn=[new Bn(0,0,0,0,zn),new Bn(4,4,8,4,jn),new Bn(4,5,16,8,jn),new Bn(4,6,32,32,jn),new Bn(4,4,16,16,Kn),new Bn(8,16,32,32,Kn),new Bn(8,16,128,128,Kn),new Bn(8,32,128,256,Kn),new Bn(32,128,258,1024,Kn),new Bn(32,258,258,4096,Kn)];function Wn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Sn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ln(this.dyn_ltree),Ln(this.dyn_dtree),Ln(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ln(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ln(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Zn=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Dn&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==In&&t.status!==On?1:0},Yn=e=>{if(Zn(e))return kn(e,pn);e.total_in=e.total_out=0,e.data_type=wn;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Dn:In,e.adler=2===t.wrap?0:1,t.last_flush=-2,nn(t),_n},Xn=e=>{const t=Yn(e);var n;return t===_n&&((n=e.state).window_size=2*n.w_size,Ln(n.head),n.max_lazy_match=Qn[n.level].max_lazy,n.good_match=Qn[n.level].good_length,n.nice_match=Qn[n.level].nice_length,n.max_chain_length=Qn[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Jn=(e,t,n,i,r,s)=>{if(!e)return pn;let o=1;if(t===vn&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||n!==Sn||i<8||i>15||t<0||t>9||s<0||s>Tn||8===i&&1!==o)return kn(e,pn);8===i&&(i=9);const a=new Wn;return e.state=a,a.strm=e,a.status=Dn,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=s,a.method=n,Xn(e)};var $n={deflateInit:(e,t)=>Jn(e,t,Sn,15,8,Cn),deflateInit2:Jn,deflateReset:Xn,deflateResetKeep:Yn,deflateSetHeader:(e,t)=>Zn(e)||2!==e.state.wrap?pn:(e.state.gzhead=t,_n),deflate:(e,t)=>{if(Zn(e)||t>dn||t<0)return e?kn(e,pn):pn;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===On&&t!==hn)return kn(e,0===e.avail_out?gn:pn);const i=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Pn(e),0===e.avail_out)return n.last_flush=-1,_n}else if(0===e.avail_in&&Rn(t)<=Rn(i)&&t!==hn)return kn(e,gn);if(n.status===On&&0!==e.avail_in)return kn(e,gn);if(n.status===Dn&&0===n.wrap&&(n.status=In),n.status===Dn){let t=Sn+(n.w_bits-8<<4)<<8,i=-1;if(i=n.strategy>=yn||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=i<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Fn(n,t),0!==n.strstart&&(Fn(n,e.adler>>>16),Fn(n,65535&e.adler)),e.adler=1,n.status=In,Pn(e),0!==n.pending)return n.last_flush=-1,_n}if(57===n.status)if(e.adler=0,qn(n,31),qn(n,139),qn(n,8),n.gzhead)qn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),qn(n,255&n.gzhead.time),qn(n,n.gzhead.time>>8&255),qn(n,n.gzhead.time>>16&255),qn(n,n.gzhead.time>>24&255),qn(n,9===n.level?2:n.strategy>=yn||n.level<2?4:0),qn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(qn(n,255&n.gzhead.extra.length),qn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=$t(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(qn(n,0),qn(n,0),qn(n,0),qn(n,0),qn(n,0),qn(n,9===n.level?2:n.strategy>=yn||n.level<2?4:0),qn(n,3),n.status=In,Pn(e),0!==n.pending)return n.last_flush=-1,_n;if(69===n.status){if(n.gzhead.extra){let t=n.pending,i=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+i>n.pending_buf_size;){let r=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=$t(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=r,Pn(e),0!==n.pending)return n.last_flush=-1,_n;t=0,i-=r}let r=new Uint8Array(n.gzhead.extra);n.pending_buf.set(r.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending+=i,n.gzhead.hcrc&&n.pending>t&&(e.adler=$t(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=$t(e.adler,n.pending_buf,n.pending-i,i)),Pn(e),0!==n.pending)return n.last_flush=-1,_n;i=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,qn(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>i&&(e.adler=$t(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=$t(e.adler,n.pending_buf,n.pending-i,i)),Pn(e),0!==n.pending)return n.last_flush=-1,_n;i=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,qn(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>i&&(e.adler=$t(e.adler,n.pending_buf,n.pending-i,i))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Pn(e),0!==n.pending))return n.last_flush=-1,_n;qn(n,255&e.adler),qn(n,e.adler>>8&255),e.adler=0}if(n.status=In,Pn(e),0!==n.pending)return n.last_flush=-1,_n}if(0!==e.avail_in||0!==n.lookahead||t!==cn&&n.status!==On){let i=0===n.level?zn(n,t):n.strategy===yn?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Gn(e),0===e.lookahead)){if(t===cn)return 1;break}if(e.match_length=0,n=on(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Mn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===hn?(Mn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mn(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===bn?((e,t)=>{let n,i,r,s;const o=e.window;for(;;){if(e.lookahead<=Nn){if(Gn(e),e.lookahead<=Nn&&t===cn)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=e.strstart-1,i=o[r],i===o[++r]&&i===o[++r]&&i===o[++r])){s=e.strstart+Nn;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<s);e.match_length=Nn-(s-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=on(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=on(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Mn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===hn?(Mn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mn(e,!1),0===e.strm.avail_out)?1:2})(n,t):Qn[n.level].func(n,t);if(3!==i&&4!==i||(n.status=On),1===i||3===i)return 0===e.avail_out&&(n.last_flush=-1),_n;if(2===i&&(t===un?an(n):t!==dn&&(rn(n,0,0,!1),t===ln&&(Ln(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Pn(e),0===e.avail_out))return n.last_flush=-1,_n}return t!==hn?_n:n.wrap<=0?fn:(2===n.wrap?(qn(n,255&e.adler),qn(n,e.adler>>8&255),qn(n,e.adler>>16&255),qn(n,e.adler>>24&255),qn(n,255&e.total_in),qn(n,e.total_in>>8&255),qn(n,e.total_in>>16&255),qn(n,e.total_in>>24&255)):(Fn(n,e.adler>>>16),Fn(n,65535&e.adler)),Pn(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?_n:fn)},deflateEnd:e=>{if(Zn(e))return pn;const t=e.state.status;return e.state=null,t===In?kn(e,En):_n},deflateSetDictionary:(e,t)=>{let n=t.length;if(Zn(e))return pn;const i=e.state,r=i.wrap;if(2===r||1===r&&i.status!==Dn||i.lookahead)return pn;if(1===r&&(e.adler=Xt(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){0===r&&(Ln(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(n-i.w_size,n),0),t=e,n=i.w_size}const s=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Gn(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=Un(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,Gn(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=a,e.avail_in=s,i.wrap=r,_n},deflateInfo:"pako deflate (from Nodeca project)"};const ei=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ti=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)ei(n,t)&&(e[t]=n[t])}}return e},ni=e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,i=0,r=e.length;t<r;t++){let r=e[t];n.set(r,i),i+=r.length}return n};let ii=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){ii=!1}const ri=new Uint8Array(256);for(let e=0;e<256;e++)ri[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ri[254]=ri[254]=1;var si=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,r,s,o=e.length,a=0;for(r=0;r<o;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),s=0,r=0;s<a;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},oi=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let t=e[i++];if(t<128){s[r++]=t;continue}let o=ri[t];if(o>4)s[r++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<n;)t=t<<6|63&e[i++],o--;o>1?s[r++]=65533:t<65536?s[r++]=t:(t-=65536,s[r++]=55296|t>>10&1023,s[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&ii)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n})(s,r)},ai=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+ri[e[n]]>t?n:t};var ci=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ui=Object.prototype.toString,{Z_NO_FLUSH:li,Z_SYNC_FLUSH:hi,Z_FULL_FLUSH:di,Z_FINISH:_i,Z_OK:fi,Z_STREAM_END:pi,Z_DEFAULT_COMPRESSION:Ei,Z_DEFAULT_STRATEGY:gi,Z_DEFLATED:vi}=tn;function mi(e){this.options=ti({level:Ei,method:vi,chunkSize:16384,windowBits:15,memLevel:8,strategy:gi},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ci,this.strm.avail_out=0;let n=$n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==fi)throw new Error(en[n]);if(t.header&&$n.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?si(t.dictionary):"[object ArrayBuffer]"===ui.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=$n.deflateSetDictionary(this.strm,e),n!==fi)throw new Error(en[n]);this._dict_set=!0}}function yi(e,t){const n=new mi(t);if(n.push(e,!0),n.err)throw n.msg||en[n.err];return n.result}mi.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?_i:li,"string"==typeof e?n.input=si(e):"[object ArrayBuffer]"===ui.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===hi||s===di)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=$n.deflate(n,s),r===pi)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=$n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===fi;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},mi.prototype.onData=function(e){this.chunks.push(e)},mi.prototype.onEnd=function(e){e===fi&&(this.result=ni(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bi={Deflate:mi,deflate:yi,deflateRaw:function(e,t){return(t=t||{}).raw=!0,yi(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,yi(e,t)},constants:tn};const Ti=16209;var Ci=function(e,t){let n,i,r,s,o,a,c,u,l,h,d,_,f,p,E,g,v,m,y,b,T,C,w,S;const N=e.state;n=e.next_in,w=e.input,i=n+(e.avail_in-5),r=e.next_out,S=e.output,s=r-(t-e.avail_out),o=r+(e.avail_out-257),a=N.dmax,c=N.wsize,u=N.whave,l=N.wnext,h=N.window,d=N.hold,_=N.bits,f=N.lencode,p=N.distcode,E=(1<<N.lenbits)-1,g=(1<<N.distbits)-1;e:do{_<15&&(d+=w[n++]<<_,_+=8,d+=w[n++]<<_,_+=8),v=f[d&E];t:for(;;){if(m=v>>>24,d>>>=m,_-=m,m=v>>>16&255,0===m)S[r++]=65535&v;else{if(!(16&m)){if(64&m){if(32&m){N.mode=16191;break e}e.msg="invalid literal/length code",N.mode=Ti;break e}v=f[(65535&v)+(d&(1<<m)-1)];continue t}for(y=65535&v,m&=15,m&&(_<m&&(d+=w[n++]<<_,_+=8),y+=d&(1<<m)-1,d>>>=m,_-=m),_<15&&(d+=w[n++]<<_,_+=8,d+=w[n++]<<_,_+=8),v=p[d&g];;){if(m=v>>>24,d>>>=m,_-=m,m=v>>>16&255,16&m){if(b=65535&v,m&=15,_<m&&(d+=w[n++]<<_,_+=8,_<m&&(d+=w[n++]<<_,_+=8)),b+=d&(1<<m)-1,b>a){e.msg="invalid distance too far back",N.mode=Ti;break e}if(d>>>=m,_-=m,m=r-s,b>m){if(m=b-m,m>u&&N.sane){e.msg="invalid distance too far back",N.mode=Ti;break e}if(T=0,C=h,0===l){if(T+=c-m,m<y){y-=m;do{S[r++]=h[T++]}while(--m);T=r-b,C=S}}else if(l<m){if(T+=c+l-m,m-=l,m<y){y-=m;do{S[r++]=h[T++]}while(--m);if(T=0,l<y){m=l,y-=m;do{S[r++]=h[T++]}while(--m);T=r-b,C=S}}}else if(T+=l-m,m<y){y-=m;do{S[r++]=h[T++]}while(--m);T=r-b,C=S}for(;y>2;)S[r++]=C[T++],S[r++]=C[T++],S[r++]=C[T++],y-=3;y&&(S[r++]=C[T++],y>1&&(S[r++]=C[T++]))}else{T=r-b;do{S[r++]=S[T++],S[r++]=S[T++],S[r++]=S[T++],y-=3}while(y>2);y&&(S[r++]=S[T++],y>1&&(S[r++]=S[T++]))}break}if(64&m){e.msg="invalid distance code",N.mode=Ti;break e}v=p[(65535&v)+(d&(1<<m)-1)]}}break}}while(n<i&&r<o);y=_>>3,n-=y,_-=y<<3,d&=(1<<_)-1,e.next_in=n,e.next_out=r,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=r<o?o-r+257:257-(r-o),N.hold=d,N.bits=_};const wi=15,Si=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ni=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ai=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Di=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ii=(e,t,n,i,r,s,o,a)=>{const c=a.bits;let u,l,h,d,_,f,p=0,E=0,g=0,v=0,m=0,y=0,b=0,T=0,C=0,w=0,S=null;const N=new Uint16Array(16),A=new Uint16Array(16);let D,I,O,k=null;for(p=0;p<=wi;p++)N[p]=0;for(E=0;E<i;E++)N[t[n+E]]++;for(m=c,v=wi;v>=1&&0===N[v];v--);if(m>v&&(m=v),0===v)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(g=1;g<v&&0===N[g];g++);for(m<g&&(m=g),T=1,p=1;p<=wi;p++)if(T<<=1,T-=N[p],T<0)return-1;if(T>0&&(0===e||1!==v))return-1;for(A[1]=0,p=1;p<wi;p++)A[p+1]=A[p]+N[p];for(E=0;E<i;E++)0!==t[n+E]&&(o[A[t[n+E]]++]=E);if(0===e?(S=k=o,f=20):1===e?(S=Si,k=Ni,f=257):(S=Ai,k=Di,f=0),w=0,E=0,p=g,_=s,y=m,b=0,h=-1,C=1<<m,d=C-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){D=p-b,o[E]+1<f?(I=0,O=o[E]):o[E]>=f?(I=k[o[E]-f],O=S[o[E]-f]):(I=96,O=0),u=1<<p-b,l=1<<y,g=l;do{l-=u,r[_+(w>>b)+l]=D<<24|I<<16|O}while(0!==l);for(u=1<<p-1;w&u;)u>>=1;if(0!==u?(w&=u-1,w+=u):w=0,E++,0==--N[p]){if(p===v)break;p=t[n+o[E]]}if(p>m&&(w&d)!==h){for(0===b&&(b=m),_+=g,y=p-b,T=1<<y;y+b<v&&(T-=N[y+b],!(T<=0));)y++,T<<=1;if(C+=1<<y,1===e&&C>852||2===e&&C>592)return 1;h=w&d,r[h]=m<<24|y<<16|_-s}}return 0!==w&&(r[_+w]=p-b<<24|64<<16),a.bits=m,0};const{Z_FINISH:Oi,Z_BLOCK:ki,Z_TREES:Ri,Z_OK:Li,Z_STREAM_END:xi,Z_NEED_DICT:Ui,Z_STREAM_ERROR:Pi,Z_DATA_ERROR:Mi,Z_MEM_ERROR:qi,Z_BUF_ERROR:Fi,Z_DEFLATED:Hi}=tn,Vi=16180,Gi=16190,zi=16191,ji=16192,Ki=16194,Bi=16199,Qi=16200,Wi=16206,Zi=16209,Yi=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Xi(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ji=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Vi||t.mode>16211?1:0},$i=e=>{if(Ji(e))return Pi;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Vi,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Li},er=e=>{if(Ji(e))return Pi;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,$i(e)},tr=(e,t)=>{let n;if(Ji(e))return Pi;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Pi:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,er(e))},nr=(e,t)=>{if(!e)return Pi;const n=new Xi;e.state=n,n.strm=e,n.window=null,n.mode=Vi;const i=tr(e,t);return i!==Li&&(e.state=null),i};let ir,rr,sr=!0;const or=e=>{if(sr){ir=new Int32Array(512),rr=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ii(1,e.lens,0,288,ir,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ii(2,e.lens,0,32,rr,0,e.work,{bits:5}),sr=!1}e.lencode=ir,e.lenbits=9,e.distcode=rr,e.distbits=5},ar=(e,t,n,i)=>{let r;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(t.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(t.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var cr={inflateReset:er,inflateReset2:tr,inflateResetKeep:$i,inflateInit:e=>nr(e,15),inflateInit2:nr,inflate:(e,t)=>{let n,i,r,s,o,a,c,u,l,h,d,_,f,p,E,g,v,m,y,b,T,C,w=0;const S=new Uint8Array(4);let N,A;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ji(e)||!e.output||!e.input&&0!==e.avail_in)return Pi;n=e.state,n.mode===zi&&(n.mode=ji),o=e.next_out,r=e.output,c=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,u=n.hold,l=n.bits,h=a,d=c,C=Li;e:for(;;)switch(n.mode){case Vi:if(0===n.wrap){n.mode=ji;break}for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,S[0]=255&u,S[1]=u>>>8&255,n.check=$t(n.check,S,2,0),u=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=Zi;break}if((15&u)!==Hi){e.msg="unknown compression method",n.mode=Zi;break}if(u>>>=4,l-=4,T=8+(15&u),0===n.wbits&&(n.wbits=T),T>15||T>n.wbits){e.msg="invalid window size",n.mode=Zi;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:zi,u=0,l=0;break;case 16181:for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(n.flags=u,(255&n.flags)!==Hi){e.msg="unknown compression method",n.mode=Zi;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Zi;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=$t(n.check,S,2,0)),u=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,S[2]=u>>>16&255,S[3]=u>>>24&255,n.check=$t(n.check,S,4,0)),u=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=$t(n.check,S,2,0)),u=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=$t(n.check,S,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(_=n.length,_>a&&(_=a),_&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+_),T)),512&n.flags&&4&n.wrap&&(n.check=$t(n.check,i,_,s)),a-=_,s+=_,n.length-=_),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===a)break e;_=0;do{T=i[s+_++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&_<a);if(512&n.flags&&4&n.wrap&&(n.check=$t(n.check,i,_,s)),a-=_,s+=_,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===a)break e;_=0;do{T=i[s+_++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&_<a);if(512&n.flags&&4&n.wrap&&(n.check=$t(n.check,i,_,s)),a-=_,s+=_,T)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Zi;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=zi;break;case 16189:for(;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}e.adler=n.check=Yi(u),u=0,l=0,n.mode=Gi;case Gi:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=u,n.bits=l,Ui;e.adler=n.check=1,n.mode=zi;case zi:if(t===ki||t===Ri)break e;case ji:if(n.last){u>>>=7&l,l-=7&l,n.mode=Wi;break}for(;l<3;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}switch(n.last=1&u,u>>>=1,l-=1,3&u){case 0:n.mode=16193;break;case 1:if(or(n),n.mode=Bi,t===Ri){u>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Zi}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Zi;break}if(n.length=65535&u,u=0,l=0,n.mode=Ki,t===Ri)break e;case Ki:n.mode=16195;case 16195:if(_=n.length,_){if(_>a&&(_=a),_>c&&(_=c),0===_)break e;r.set(i.subarray(s,s+_),o),a-=_,s+=_,c-=_,o+=_,n.length-=_;break}n.mode=zi;break;case 16196:for(;l<14;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Zi;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.lens[D[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,N={bits:n.lenbits},C=Ii(0,n.lens,0,19,n.lencode,0,n.work,N),n.lenbits=N.bits,C){e.msg="invalid code lengths set",n.mode=Zi;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;w=n.lencode[u&(1<<n.lenbits)-1],E=w>>>24,g=w>>>16&255,v=65535&w,!(E<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(v<16)u>>>=E,l-=E,n.lens[n.have++]=v;else{if(16===v){for(A=E+2;l<A;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(u>>>=E,l-=E,0===n.have){e.msg="invalid bit length repeat",n.mode=Zi;break}T=n.lens[n.have-1],_=3+(3&u),u>>>=2,l-=2}else if(17===v){for(A=E+3;l<A;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}u>>>=E,l-=E,T=0,_=3+(7&u),u>>>=3,l-=3}else{for(A=E+7;l<A;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}u>>>=E,l-=E,T=0,_=11+(127&u),u>>>=7,l-=7}if(n.have+_>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Zi;break}for(;_--;)n.lens[n.have++]=T}}if(n.mode===Zi)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Zi;break}if(n.lenbits=9,N={bits:n.lenbits},C=Ii(1,n.lens,0,n.nlen,n.lencode,0,n.work,N),n.lenbits=N.bits,C){e.msg="invalid literal/lengths set",n.mode=Zi;break}if(n.distbits=6,n.distcode=n.distdyn,N={bits:n.distbits},C=Ii(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,N),n.distbits=N.bits,C){e.msg="invalid distances set",n.mode=Zi;break}if(n.mode=Bi,t===Ri)break e;case Bi:n.mode=Qi;case Qi:if(a>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=u,n.bits=l,Ci(e,d),o=e.next_out,r=e.output,c=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,u=n.hold,l=n.bits,n.mode===zi&&(n.back=-1);break}for(n.back=0;w=n.lencode[u&(1<<n.lenbits)-1],E=w>>>24,g=w>>>16&255,v=65535&w,!(E<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(g&&!(240&g)){for(m=E,y=g,b=v;w=n.lencode[b+((u&(1<<m+y)-1)>>m)],E=w>>>24,g=w>>>16&255,v=65535&w,!(m+E<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}u>>>=m,l-=m,n.back+=m}if(u>>>=E,l-=E,n.back+=E,n.length=v,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=zi;break}if(64&g){e.msg="invalid literal/length code",n.mode=Zi;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(A=n.extra;l<A;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;w=n.distcode[u&(1<<n.distbits)-1],E=w>>>24,g=w>>>16&255,v=65535&w,!(E<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(!(240&g)){for(m=E,y=g,b=v;w=n.distcode[b+((u&(1<<m+y)-1)>>m)],E=w>>>24,g=w>>>16&255,v=65535&w,!(m+E<=l);){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}u>>>=m,l-=m,n.back+=m}if(u>>>=E,l-=E,n.back+=E,64&g){e.msg="invalid distance code",n.mode=Zi;break}n.offset=v,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(A=n.extra;l<A;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Zi;break}n.mode=16204;case 16204:if(0===c)break e;if(_=d-c,n.offset>_){if(_=n.offset-_,_>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Zi;break}_>n.wnext?(_-=n.wnext,f=n.wsize-_):f=n.wnext-_,_>n.length&&(_=n.length),p=n.window}else p=r,f=o-n.offset,_=n.length;_>c&&(_=c),c-=_,n.length-=_;do{r[o++]=p[f++]}while(--_);0===n.length&&(n.mode=Qi);break;case 16205:if(0===c)break e;r[o++]=n.length,c--,n.mode=Qi;break;case Wi:if(n.wrap){for(;l<32;){if(0===a)break e;a--,u|=i[s++]<<l,l+=8}if(d-=c,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?$t(n.check,r,d,o-d):Xt(n.check,r,d,o-d)),d=c,4&n.wrap&&(n.flags?u:Yi(u))!==n.check){e.msg="incorrect data check",n.mode=Zi;break}u=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===a)break e;a--,u+=i[s++]<<l,l+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Zi;break}u=0,l=0}n.mode=16208;case 16208:C=xi;break e;case Zi:C=Mi;break e;case 16210:return qi;default:return Pi}return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=u,n.bits=l,(n.wsize||d!==e.avail_out&&n.mode<Zi&&(n.mode<Wi||t!==Oi))&&ar(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?$t(n.check,r,d,e.next_out-d):Xt(n.check,r,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===zi?128:0)+(n.mode===Bi||n.mode===Ki?256:0),(0===h&&0===d||t===Oi)&&C===Li&&(C=Fi),C},inflateEnd:e=>{if(Ji(e))return Pi;let t=e.state;return t.window&&(t.window=null),e.state=null,Li},inflateGetHeader:(e,t)=>{if(Ji(e))return Pi;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Li):Pi},inflateSetDictionary:(e,t)=>{const n=t.length;let i,r,s;return Ji(e)?Pi:(i=e.state,0!==i.wrap&&i.mode!==Gi?Pi:i.mode===Gi&&(r=1,r=Xt(r,t,n,0),r!==i.check)?Mi:(s=ar(e,t,n,n),s?(i.mode=16210,qi):(i.havedict=1,Li)))},inflateInfo:"pako inflate (from Nodeca project)"};var ur=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const lr=Object.prototype.toString,{Z_NO_FLUSH:hr,Z_FINISH:dr,Z_OK:_r,Z_STREAM_END:fr,Z_NEED_DICT:pr,Z_STREAM_ERROR:Er,Z_DATA_ERROR:gr,Z_MEM_ERROR:vr}=tn;function mr(e){this.options=ti({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ci,this.strm.avail_out=0;let n=cr.inflateInit2(this.strm,t.windowBits);if(n!==_r)throw new Error(en[n]);if(this.header=new ur,cr.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=si(t.dictionary):"[object ArrayBuffer]"===lr.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=cr.inflateSetDictionary(this.strm,t.dictionary),n!==_r)))throw new Error(en[n])}function yr(e,t){const n=new mr(t);if(n.push(e),n.err)throw n.msg||en[n.err];return n.result}mr.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?dr:hr,"[object ArrayBuffer]"===lr.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=cr.inflate(n,o),s===pr&&r&&(s=cr.inflateSetDictionary(n,r),s===_r?s=cr.inflate(n,o):s===gr&&(s=pr));n.avail_in>0&&s===fr&&n.state.wrap>0&&0!==e[n.next_in];)cr.inflateReset(n),s=cr.inflate(n,o);switch(s){case Er:case gr:case pr:case vr:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||s===fr))if("string"===this.options.to){let e=ai(n.output,n.next_out),t=n.next_out-e,r=oi(n.output,e);n.next_out=t,n.avail_out=i-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==_r||0!==a){if(s===fr)return s=cr.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},mr.prototype.onData=function(e){this.chunks.push(e)},mr.prototype.onEnd=function(e){e===_r&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ni(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var br={Inflate:mr,inflate:yr,inflateRaw:function(e,t){return(t=t||{}).raw=!0,yr(e,t)},ungzip:yr,constants:tn};const{Deflate:Tr,deflate:Cr,deflateRaw:wr,gzip:Sr}=bi,{Inflate:Nr,inflate:Ar,inflateRaw:Dr,ungzip:Ir}=br;var Or,kr={Deflate:Tr,deflate:Cr,deflateRaw:wr,gzip:Sr,Inflate:Nr,inflate:Ar,inflateRaw:Dr,ungzip:Ir,constants:tn},Rr=function(e){return r(void 0,void 0,void 0,(function(){var t,n;return s(this,(function(i){if(t=kr.ungzip(e),"undefined"!=typeof TextDecoder)try{return[2,new TextDecoder("utf-8").decode(new Uint8Array(t))]}catch(e){}return n=8192,[2,Array.from({length:Math.ceil(t.length/n)},(function(e,i){var r=i*n,s=t.slice(r,r+n);return String.fromCharCode.apply(null,s)})).join("")]}))}))},Lr=function(e){return r(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof m))throw t;return t.throwOutside(),[3,3];case 3:return[2]}}))}))},xr=function(e){return r(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))}))},Ur=function(e){function n(t){var n=e.call(this)||this;return n.retryAfterTime=1e3*t.retry_after,n.reasonCode=t.reason_code,n.message=t.message,n}return t(n,e),n}(re);!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED"}(Or||(Or={}));var Pr,Mr=function(e){function n(t,n){var i=n.sdkState,r=n.dispatcher,s=n.logger,o=e.call(this)||this;return o.lastActive=0,o._iid=t,o._sdkState=i,o._dispatcher=r,o._logger=s,o}return t(n,e),Object.defineProperty(n.prototype,"isOpen",{get:function(){return this.connectionState===Or.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return Or.CONNECTING;case 1:return Or.OPEN}return Or.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ws",{get:function(){var e;return null!==(e=this._ws)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),n.prototype._handleMessage=function(e){var t=this;e.split("\n").forEach((function(e){if(e){var n=Ke.createFromRawMessage(t._iid,e);if(t._logger.debug("receive websocket event",n),"LOGI"===n.code)t.dispatch("message",n);else if("PONG"===n.code)t.dispatch("pong");else if("EXPR"===n.code){if(n.payload){var i=new je(n.payload);i.expiresIn>=0&&t._dispatcher.dispatch(i)}}else if("BUSY"===n.code){if(n.payload){var r=new Ur(n.payload);t._dispatcher.dispatch(r)}}else"NOOP"===n.code||t.dispatch("message",n)}}))},n.prototype.connect=function(e,t){return void 0===t&&(t=""),r(this,void 0,void 0,(function(){var n=this;return s(this,(function(i){switch(i.label){case 0:return"function"==typeof fetch?[3,2]:[4,import("./__bundle-46d64517.js")];case 1:i.sent(),i.label=2;case 2:return xr((function(){return r(n,void 0,void 0,(function(){return s(this,(function(e){return fetch(this._sdkState.api.host),[2]}))}))})),this._ws=new WebSocket(e,encodeURIComponent(t)),this._ws.onopen=function(){n._logger.debug("websocket open"),n.dispatch("open")},this._ws.onmessage=function(e){return r(n,void 0,void 0,(function(){var t,n,i,o,a,c,u,l=this;return s(this,(function(h){switch(h.label){case 0:return(null===(u=this._sdkState.websocket)||void 0===u?void 0:u.compression)?e.data instanceof Blob?((t=new FileReader).readAsArrayBuffer(e.data),t.onloadend=function(){return r(l,void 0,void 0,(function(){var e,n;return s(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Rr(t.result)];case 1:return e=i.sent(),this._handleMessage(e),[3,3];case 2:return n=i.sent(),this.error(n),[3,3];case 3:return[2]}}))}))},[3,12]):[3,1]:[3,13];case 1:if(!(e.data instanceof ArrayBuffer))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,Rr(new Uint8Array(e.data))];case 3:return a=h.sent(),this._handleMessage(a),[3,5];case 4:return n=h.sent(),this.error(n),[3,5];case 5:return[3,12];case 6:if(!("undefined"!=typeof Buffer&&e.data instanceof Buffer))return[3,11];h.label=7;case 7:return h.trys.push([7,9,,10]),i=e.data,o=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength),[4,Rr(o)];case 8:return a=h.sent(),this._handleMessage(a),[3,10];case 9:return c=h.sent(),this.error(c),[3,10];case 10:return[3,12];case 11:"string"==typeof e.data&&this._handleMessage(e.data),h.label=12;case 12:return[3,14];case 13:this._handleMessage(e.data),h.label=14;case 14:return[2]}}))}))},this._ws.onerror=function(){n._logger.debug("websocket error"),n.dispatch("error",m.networkError)},this._ws.onclose=function(e){n._logger.debug("websocket close",e.code,e.reason),n.cleanUpWebSocket(),n.dispatch("close")},this.lastActive=Date.now(),[2]}}))}))},n.prototype.cleanUpWebSocket=function(){this._ws&&(this._ws.onopen=dt,this._ws.onmessage=dt,this._ws.onerror=dt,this._ws.onclose=dt,this.connectionState===Or.OPEN&&this._ws.close(1e3,"Normal Closure"),this._ws=void 0)},n.prototype.disconnect=function(){var e=this;return new Promise((function(t){if(e._ws){if(e.connectionState===Or.CLOSED)return e.cleanUpWebSocket(),void t();e._ws.onclose=null,e._ws.onclose=function(){e.cleanUpWebSocket(),e.dispatch("close"),t()},e._ws.close()}else t()}))},n.prototype.send=function(e){if(!this._ws)throw m.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},n.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)},n}(ne),qr=function(e){function n(t){var n=t.all,i=t.feed,r=t.custom_types,s=t.ts,o=e.call(this)||this;return o.all=n,o.feed=i,o.customTypes=r,o.ts=s,o}return t(n,e),n}(re),Fr=function(){function e(e,t){var n=t.session,i=t.sdkState,r=t.dispatcher,s=t.logger,c=t.useFetchCompat,u=void 0!==c&&c,l=this;this._ackStateMap=new Map,this._batchableCommandAckStateMap=new Map,this._redundantActionCommands=new Map,this._sdkState=i,this._dispatcher=r,this._logger=s,this.apiClient=new ht(e,{session:n,sdkState:i,dispatcher:r,logger:s,useFetchCompat:u}),this.websocketClient=new Mr(e,{sdkState:i,dispatcher:r,logger:s}),this.websocketClient.on("message",(function(e){var t,n;if(e.payload.unread_cnt&&l._dispatcher.dispatch(new qr(e.payload.unread_cnt)),e.requestId){if(l._ackStateMap.has(e.requestId)){var i=l._ackStateMap.get(e.requestId);"EROR"!==e.code?i.resolve(e):i.reject(new m({code:e.payload.code,message:e.payload.message}))}else if(l._batchableCommandAckStateMap.has(e.requestId)){var r=Date.now();try{for(var s=o(l._batchableCommandAckStateMap.entries()),c=s.next();!c.done;c=s.next()){var u=a(c.value,2),h=(u[0],u[1]);if(h.channelUrl===e.payload.channel_url&&h.requestTime<r){i=h.ackState;"EROR"!==e.code?i.resolve(e):i.reject(new m({code:e.payload.code,message:e.payload.message}))}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}}}else if(l._redundantActionCommands.has(e.payload.unique_id)){var d=l._redundantActionCommands.get(e.payload.unique_id),_=null==d?void 0:d.indexOf(e.code);-1!==_&&(null==d||d.splice(_,1)),0===d.length&&l._redundantActionCommands.delete(e.payload.unique_id)}else l._dispatcher.dispatch(e)})).on("close",(function(){l._ackStateMap.forEach((function(e){e.reject(m.connectionClosed)})),l._ackStateMap.clear(),l._batchableCommandAckStateMap.clear(),l._redundantActionCommands.clear()}))}return e.prototype._sendApiRequest=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e.params.unique_id&&this._redundantActionCommands.set(e.params.unique_id,["SYEV","READ"]),[4,this.apiClient.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r=this;return s(this,(function(s){if(!this._sdkState.websocket)throw m.connectionRequired;if(t=new at,e.ackRequired){i=function(i,s){var o="READ"===e.code?r._batchableCommandAckStateMap:r._ackStateMap;o.has(e.requestId)&&(o.delete(e.requestId),n&&(clearTimeout(n),n=null),i?(r._logger.debug("fail websocket request",e.requestId,i),t.reject(i)):(r._logger.debug("receive websocket ack",e.requestId,e),r._logger.debug("receive websocket ack",s),t.resolve(s)))};try{n=setTimeout((function(){return i(m.noAckTimeout)}),this._sdkState.websocket.responseTimeout),"READ"===e.code?this._batchableCommandAckStateMap.set(e.requestId,{ackState:{resolve:function(e){return i(void 0,e)},reject:function(e){return i(e)}},channelUrl:e.payload.channel_url,requestTime:Date.now()}):this._ackStateMap.set(e.requestId,{resolve:function(e){return i(void 0,e)},reject:function(e){return i(e)}}),this.websocketClient.send(e)}catch(e){i(e)}}else try{this.websocketClient.send(e),t.resolve()}catch(e){t.reject(e)}return[2,t.promise]}))}))},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e instanceof Ve?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return e instanceof Be?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw m.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e)},e.prototype.cancelAll=function(){this.apiClient.cancelAll()},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",e[e.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",e[e.LOGOUT=7]="LOGOUT",e[e.DELAYED_CONNECTING=8]="DELAYED_CONNECTING"}(Pr||(Pr={}));var Hr,Vr,Gr=function(e){function n(t){var n=t.stateType,i=e.call(this)||this;return i.stateType=n,i}return t(n,e),n}(re),zr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(re),jr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(re),Kr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(re),Br=function(){function e(e){var t,n,i,r;this.isEnabled=null!==(t=e.enabled)&&void 0!==t&&t,this.feedChannels=null!==(n=e.feed_channels)&&void 0!==n?n:{},this.templateListToken=null!==(i=e.template_list_token)&&void 0!==i?i:null,this.settingsUpdatedAt=null!==(r=e.settings_updated_at)&&void 0!==r?r:0}return e.payloadify=function(e){return se(oe({enabled:e.isEnabled,feed_channels:e.feedChannels,template_list_token:e.templateListToken,settings_updated_at:e.settingsUpdatedAt}))},e}(),Qr=function(e){return"sendbird@".concat(e,"/changelog_include_chat_notifications")},Wr=function(){function e(e){var t;this.lastUpdatedAt=null!==(t=e.last_updated_at)&&void 0!==t?t:0}return e.payloadify=function(e){return se(oe({last_updated_at:e.lastUpdatedAt}))},e}(),Zr=function(){function e(e){var t;this.token=null!==(t=e.template_list_token)&&void 0!==t?t:""}return e.payloadify=function(e){return se(oe({template_list_token:e.token}))},e}(),Yr=function(){function e(e){void 0===e&&(e={min_stat_count:100,min_interval:10800,max_stat_count_per_request:1e3,lower_threshold:10,request_delay_range:180}),this.minStatCount=e.min_stat_count,this.minInterval=1e3*e.min_interval,this.maxStatCountPerRequest=e.max_stat_count_per_request,this.lowerThreshold=e.lower_threshold,this.requestDelayRange=1e3*e.request_delay_range}return e.payloadify=function(e){return se(oe({min_stat_count:e.minStatCount,min_interval:e.minInterval/1e3,max_stat_count_per_request:e.maxStatCountPerRequest,lower_threshold:e.lowerThreshold,request_delay_range:e.requestDelayRange/1e3}))},e}(),Xr=function(){function e(e){void 0===e&&(e={default:{min_stat_count:100,min_interval:10800,max_stat_count_per_request:1e3,lower_threshold:10,request_delay_range:180}}),this.default=new Yr(e.default),this.realTime=new Yr(e.realtime)}return e.payloadify=function(e){return se(oe({default:Yr.payloadify(e.default),realtime:Yr.payloadify(e.realTime)}))},e}(),Jr=function(){function e(e){var t;this.templateListToken=null!==(t=e.template_list_token)&&void 0!==t?t:null}return e.payloadify=function(e){return se(oe({template_list_token:e.templateListToken}))},e}(),$r=function(){function e(e){this.enabled=e.enabled,this.orderBy=e.order_by.type,this.excludeRecentHours=e.order_by.exclude_recent_hours,this.bufferRatio=e.buffer_ratio}return e.payloadify=function(e){return se(oe({enabled:e.enabled,order_by:{type:e.orderBy,exclude_recent_hours:e.excludeRecentHours},buffer_ratio:e.bufferRatio}))},e}(),es=1048576,ts=5;!function(e){e[e.NONE=0]="NONE",e[e.INCLUDE_REPLY=1]="INCLUDE_REPLY",e[e.EXCLUDE_REPLY=2]="EXCLUDE_REPLY",e[e.INCLUDE_REPLY_TO_CHANNEL=3]="INCLUDE_REPLY_TO_CHANNEL"}(Hr||(Hr={})),function(e){e[e.NONE=0]="NONE",e[e.INCLUDE_REPLY=1]="INCLUDE_REPLY",e[e.EXCLUDE_REPLY=2]="EXCLUDE_REPLY",e[e.INCLUDE_REPLY_TO_CHANNEL=3]="INCLUDE_REPLY_TO_CHANNEL"}(Vr||(Vr={}));var ns=function(){function e(e){var t,n,i,r,s,o,a,c,u,l;void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?e.file_upload_size_limit*es:Number.MAX_SAFE_INTEGER,this.useReaction=!!e.use_reaction,this.applicationAttributes=null!==(t=e.application_attributes)&&void 0!==t?t:[],this.premiumFeatureList=null!==(n=e.premium_feature_list)&&void 0!==n?n:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=null!==(i=e.multiple_file_send_max_size)&&void 0!==i?i:5,this.allowSdkStatsUpload=null===(r=e.allow_sdk_log_ingestion)||void 0===r||r,this.unreadCountThreadingPolicy=null!==(s=e.unread_cnt_threading_policy)&&void 0!==s?s:Hr.NONE,this.lastMessageThreadingPolicy=null!==(o=e.last_msg_threading_policy)&&void 0!==o?o:Vr.NONE,this.channelRotationInfo=e.channel_rotation?new $r(e.channel_rotation):null,this.uikitConfigInfo=new Wr(null!==(a=e.uikit_config)&&void 0!==a?a:{}),this.notificationInfo=e.notifications?new Br(e.notifications):null,this.messageTemplateInfo=e.message_template?new Zr(e.message_template):null,this.aiAgentInfo=e.ai_agent?new Jr(e.ai_agent):null,this.statConfigInfo=e.log_publish_config?new Xr(e.log_publish_config):new Xr,this.disableSuperGroupMack=null!==(c=e.disable_supergroup_mack)&&void 0!==c&&c,this.configSyncNeeded=null!==(u=e.config_sync_needed)&&void 0!==u&&u,this.requestDedupIntervalMs=null!==(l=e.request_dedup_interval_ms)&&void 0!==l?l:500}return e.payloadify=function(e){return se(oe({emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/es,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction,allow_sdk_log_ingestion:e.allowSdkStatsUpload,unread_cnt_threading_policy:e.unreadCountThreadingPolicy,last_msg_threading_policy:e.lastMessageThreadingPolicy,channel_rotation:e.channelRotationInfo?$r.payloadify(e.channelRotationInfo):null,uikit_config:e.uikitConfigInfo?Wr.payloadify(e.uikitConfigInfo):null,notifications:e.notificationInfo?Br.payloadify(e.notificationInfo):null,message_template:e.messageTemplateInfo?Zr.payloadify(e.messageTemplateInfo):null,log_publish_config:e.statConfigInfo?Xr.payloadify(e.statConfigInfo):null,disable_supergroup_mack:e.disableSuperGroupMack,config_sync_needed:e.configSyncNeeded,request_dedup_interval_ms:e.requestDedupIntervalMs}))},e}(),is=function(e){return"sendbird@".concat(e,"/app_configs_info")},rs=function(){function e(e){this._iid="",this._iid=e}return e.payloadify=function(e){return{}},e}(),ss=function(e){function n(t){var n=t.userId,i=t.metadata,r=e.call(this)||this;return r.method=ae.POST,r.path="".concat(ue,"/").concat(encodeURIComponent(n),"/metadata"),r.params={metadata:i},r}return t(n,e),n}(Ve),os=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.metaData=n,i}return t(n,e),n}(Ge),as=function(e){function n(t){var n=t.userId,i=t.metadata,r=t.upsert,s=e.call(this)||this;return s.method=ae.PUT,s.path="".concat(ue,"/").concat(encodeURIComponent(n),"/metadata"),s.params={metadata:i,upsert:r},s}return t(n,e),n}(Ve),cs=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.metadata=n,i}return t(n,e),n}(Ge),us=function(e){function n(t){var n=t.userId,i=t.metadataKey,r=e.call(this)||this;return r.method=ae.DELETE,r.path="".concat(ue,"/").concat(encodeURIComponent(n),"/metadata/").concat(i),r}return t(n,e),n}(Ve);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(Ge);var ls=function(e){function n(t){var n=t.userId,i=e.call(this)||this;return i.method=ae.DELETE,i.path="".concat(ue,"/").concat(encodeURIComponent(n),"/metadata"),i}return t(n,e),n}(Ve);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(Ge);var hs,ds=function(e,t){var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},_s=function(e,t){var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},fs=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable"}(hs||(hs={}));var ps,Es=function(e){function i(t,n){var i,r,s,o,u,l,h,d,_,f,p,E,g,v=this;return(v=e.call(this,t)||this).userId=null!==(r=null!==(i=n.guest_id)&&void 0!==i?i:n.user_id)&&void 0!==r?r:"",v.nickname=null!==(o=null!==(s=n.nickname)&&void 0!==s?s:n.name)&&void 0!==o?o:"",v.plainProfileUrl=null!==(l=null!==(u=n.profile_url)&&void 0!==u?u:n.image)&&void 0!==l?l:"",v.requireAuth=null!==(h=n.require_auth_for_profile_image)&&void 0!==h&&h,v.metaData=null!==(d=n.metadata)&&void 0!==d?d:{},v.connectionStatus=hs.NON_AVAILABLE,w(hs,n.is_online)?v.connectionStatus=n.is_online:C("boolean",n.is_online)&&(v.connectionStatus=n.is_online?hs.ONLINE:hs.OFFLINE),v.isActive=null===(_=n.is_active)||void 0===_||_,v.lastSeenAt=null!==(f=n.last_seen_at)&&void 0!==f?f:null,v.preferredLanguages=n.preferred_languages?c([],a(n.preferred_languages),!1):null,v.friendDiscoveryKey=null!==(p=n.friend_discovery_key)&&void 0!==p?p:null,v.friendName=null!==(E=n.friend_name)&&void 0!==E?E:null,v._hashValue=v._generateHashValue(),v._updatedAt=null!==(g=n.updatedat)&&void 0!==g?g:0,v}return t(i,e),i.payloadify=function(t){return se(oe(n(n({},e.payloadify.call(this,t)),{user_id:t.userId,nickname:t.nickname,profile_url:t.plainProfileUrl,require_auth_for_profile_image:t.requireAuth,metadata:t.metaData,is_online:t.connectionStatus,is_active:t.isActive,last_seen_at:t.lastSeenAt,preferred_languages:t.preferredLanguages,friend_discovery_key:t.friendDiscoveryKey,friend_name:t.friendName})))},i._buildUserFromSerializedData=function(e){var t=_s(e);return new i(t._iid,i.payloadify(t))},i.prototype._generateHashValue=function(){for(var e,t=JSON.stringify({userId:this.userId,nickname:this.nickname,plainProfileUrl:this.plainProfileUrl,friendDiscoveryKey:this.friendDiscoveryKey,friendName:this.friendName,metaData:JSON.stringify(this.metaData),performanceLanguages:null===(e=this.preferredLanguages)||void 0===e?void 0:e.toString(),requireAuth:this.requireAuth}),n=0,i=0;i<t.length;i++){n=(n<<5)-n+t.charCodeAt(i),n|=0}return n},Object.defineProperty(i.prototype,"profileUrl",{get:function(){var e=vo.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),i.prototype.serialize=function(){return ds(this)},i.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return C("string",e)}))},i.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(i){t?delete n.metaData[i]:n.metaData[i]=e[i]}))},i.prototype.createMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,o,a;return s(this,(function(s){switch(s.label){case 0:return fs(this._isValidMetaData(e)).throw(m.invalidParameters),t=vo.of(this._iid),n=t.sdkState,i=t.requestQueue,r=new ss({userId:n.userId,metadata:e}),[4,i.send(r)];case 1:return o=s.sent(),a=o.as(os).metaData,this._applyMetaData(a),[2,this.metaData]}}))}))},i.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,i,r,o,a,c;return s(this,(function(s){switch(s.label){case 0:return fs(this._isValidMetaData(e)).throw(m.invalidParameters),n=vo.of(this._iid),i=n.sdkState,r=n.requestQueue,o=new as({userId:i.userId,metadata:e,upsert:t}),[4,r.send(o)];case 1:return a=s.sent(),c=a.as(cs).metadata,this._applyMetaData(c),[2,this.metaData]}}))}))},i.prototype.deleteMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,o;return s(this,(function(s){switch(s.label){case 0:return fs(C("string",e)).throw(m.invalidParameters),t=vo.of(this._iid),n=t.sdkState,i=t.requestQueue,r=new us({userId:n.userId,metadataKey:e}),[4,i.send(r)];case 1:return s.sent(),this._applyMetaData(((o={})[e]=!0,o),!0),[2,this.metaData]}}))}))},i.prototype.deleteAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,i;return s(this,(function(r){switch(r.label){case 0:return e=vo.of(this._iid),t=e.sdkState,n=e.requestQueue,i=new ls({userId:t.userId}),[4,n.send(i)];case 1:return r.sent(),this.metaData={},[2]}}))}))},i}(rs),gs=function(e){function n(t){var n=t.userProfile,i=e.call(this)||this;return i.userProfile=n,i}return t(n,e),n}(re),vs=function(){function e(e,t){var n,i,r,s,o,a,c,u,l,h,d,_,f,p;this._iid=e,this.appInfo=new ns(t),this.user=new Es(e,t),this.connectedAt=null!==(n=t.login_ts)&&void 0!==n?n:0,this.firstConnectedAt=0,this.pingInterval=null!==(i=t.ping_interval)&&void 0!==i?i:15,this.pongTimeout=null!==(r=t.pong_timeout)&&void 0!==r?r:5,this.reconnectInterval=null!==(o=null===(s=t.reconnect)||void 0===s?void 0:s.interval)&&void 0!==o?o:3e3,this.reconnectMaxInterval=null!==(c=null===(a=t.reconnect)||void 0===a?void 0:a.max_interval)&&void 0!==c?c:6e4,this.reconnectRetryCount=null!==(l=null===(u=t.reconnect)||void 0===u?void 0:u.retry_cnt)&&void 0!==l?l:5,this.reconnectIntervalMultiple=null!==(d=null===(h=t.reconnect)||void 0===h?void 0:h.mul)&&void 0!==d?d:2,this.maxUnreadCountOnSuperGroup=null!==(_=t.max_unread_cnt_on_super_group)&&void 0!==_?_:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(f=t.concurrent_call_limit)&&void 0!==f?f:5,this.backOffDelay=null!==(p=t.back_off_delay)&&void 0!==p?p:100}return e.payloadify=function(e){return se(oe(n(n(n({},Es.payloadify(e.user)),ns.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})))},e.prototype.apply=function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,i=vo.of(this._iid);i.sdkState.websocket&&(i.sdkState.websocket.pingInterval=1e3*this.pingInterval,i.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,i.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,i.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(i){return i>0?1e3*Math.min(e*Math.pow(n,i-1),t):10}}),i.appInfo=this.appInfo,i.sessionManager.currentUser=this.user,i.connectedAt=this.connectedAt,this.firstConnectedAt||(i.firstConnectedAt=this.connectedAt),i.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,i.concurrentCallLimit=this.concurrentCallLimit,i.backOffDelay=this.backOffDelay,i.requestDeduplicator.requestDedupInterval=this.appInfo.requestDedupIntervalMs,i.dispatcher.dispatch(new gs({userProfile:this}))},e}(),ms=function(e){function i(t){var i=t.request,r=void 0===i||i,s=t.features,o=void 0===s?{}:s,a=t.options,c=void 0===a?{}:a,u=t.statConfigInfo,l=e.call(this)||this;return l.request=r,l.features=n({localCache:!0,notification:!0},o),l.options=n({ingestion:!0},c),l.statConfigInfo=u,l}return t(i,e),i}(re),ys=function(e){function n(t){var n=e.call(this)||this;return n.configSyncNeeded=!1,n.configSyncNeeded=t,n}return t(n,e),n}(re),bs=function(e){function i(t,n,i){var r,s,o,a,c=this;return(c=e.call(this,t,n,i)||this).error=null,c.services=[],c.userProfile=new vs(t,i),c.deviceTokenLastDeletedAt=null!==(r=i.device_token_last_deleted_at)&&void 0!==r?r:0,c.key=null!==(s=i.key)&&void 0!==s?s:"",c.ekey=null!==(o=i.ekey)&&void 0!==o?o:"",c.error=i.error?new m(i):null,c.services=null!==(a=i.services)&&void 0!==a?a:[],c.isSessionRefresh="new_key"in i,c}return t(i,e),i.asError=function(e){return new i("","LOGI",n({user_id:"",error:!0},e))},i.prototype.applyTo=function(e){return r(this,void 0,void 0,(function(){var t,n,i;return s(this,(function(r){switch(r.label){case 0:return this.isSessionRefresh?[2]:this.error?[3,4]:(t=vo.of(e))?(n=t.sessionManager,i=t.dispatcher,[4,n.login(this)]):[3,2];case 1:return r.sent(),this.userProfile.apply(),i.dispatch(new ys(this.userProfile.appInfo.configSyncNeeded)),i.dispatch(new ms({request:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish"),notification:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_noti_stats_log_publish")},options:{ingestion:this.userProfile.appInfo.allowSdkStatsUpload},statConfigInfo:this.userProfile.appInfo.statConfigInfo})),[3,3];case 2:throw m.lostInstance;case 3:return[3,5];case 4:throw this.error;case 5:return[2]}}))}))},i}(Ke),Ts=function(){function e(){this.type=Pr.NONE,this.name="none"}return e.prototype.run=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onReconnect=function(e,t){return t.resetReconnectCount,r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,t.cause,r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onDisconnectWebSocket=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onLogout=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onDelayedConnecting=function(e,t){return t.retryAfterTime,t.reasonCode,t.message,r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e}(),Cs=function(e){function n(t){void 0===t&&(t={});var n,i=this;return(i=e.call(this)||this).type=Pr.LOGOUT,i.name="logout",i._wasPreviouslyConnected=null===(n=t.wasPreviouslyConnected)||void 0===n||n,i}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,i=this;return s(this,(function(o){switch(o.label){case 0:return t=Date.now(),n=e.sdkState.userId,[4,e.logout()];case 1:return o.sent(),[4,e.changeState(new Ps,t)];case 2:return o.sent(),this._wasPreviouslyConnected&&Lr((function(){return r(i,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onDisconnected&&e.onDisconnected(n)})),[2]}))}))})),[2]}}))}))},n}(Ts),ws=function(e){function n(){var t=e.call(this)||this;return t.type=Pr.EXTERNAL_DISCONNECTED,t.name="externaldisconnected",t}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.disconnect()];case 1:return t.sent(),[2]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=Date.now(),[4,e.disconnect()];case 1:return i.sent(),[4,e.changeState(new Ls({authToken:t}),n)];case 2:return i.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new ks,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Cs,t)];case 1:return n.sent(),[2]}}))}))},n}(Ts);!function(e){e.ExternalSetBackground="ExternalSetBackground",e.ExternalDisconnectWebSocket="ExternalDisconnectWebSocket",e.MaxReconnectRetry="MaxReconnectRetry"}(ps||(ps={}));var Ss=function(){function e(e,t){var n=t.sdkState,i=t.cacheContext,r=t.connectionHandlers,s=t.sessionManager,o=t.websocketClient,a=t.dispatcher,c=t.logger,u=t.disableWebSocketCloseEventHandling,l=void 0!==u&&u,h=this;this._disableWebSocketCloseEventHandling=!1,this._webSocketClosedCause=null,this._logger=c,this._disableWebSocketCloseEventHandling=l,this._context=new Hs(e,{sdkState:n,cacheContext:i,connectionHandlers:r,sessionManager:s,websocketClient:o,dispatcher:a,logger:c}),this._sdkState=n,this._sessionManager=s,this._websocketClient=o,this._commandDispatcher=a,this._commandDispatcher.on((function(e){var t=h._context.currentState;if(e instanceof Ur&&t.type===Pr.CONNECTED){var n=e.retryAfterTime,i=e.reasonCode,r=e.message;t.onDelayedConnecting(h._context,{retryAfterTime:n,reasonCode:i,message:r})}}))}return e.prototype._registerEventDispatcher=function(){var e=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh",(function(){e.isConnecting||e.isConnected||(e._logger.debug("try reconnect by session key refresh"),xr((function(){return r(e,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.reconnect()];case 1:return e.sent(),[2]}}))}))})))})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(function(){"foreground"!==e._sdkState.appState||e._webSocketClosedCause||xr((function(){return r(e,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._sessionManager.isSessionKeyRefreshing?[3,2]:(this._logger.debug("try reconnect by websocket connection closed"),[4,this.reconnect()]);case 1:return e.sent(),[3,4];case 2:return[4,this.disconnectWebSocket()];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))}))})))},e.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===Pr.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===Pr.CONNECTING||e.type===Pr.RECONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketClient",{get:function(){return this._websocketClient},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=null,[4,t.onConnect(this._context,e)];case 1:return n.sent(),this._registerEventDispatcher(),[2]}}))}))},e.prototype.reconnect=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=null,[4,e.onReconnect(this._context,{})];case 1:return t.sent(),[2]}}))}))},e.prototype.resetAndReconnect=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=null,[4,e.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.background=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=ps.ExternalSetBackground,[4,e.onDisconnect(this._context,{autoReconnect:!1,cause:this._webSocketClosedCause})];case 1:return t.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0,cause:this._webSocketClosedCause})];case 1:return t.sent(),[2]}}))}))},e.prototype.disconnectWebSocket=function(e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this._context.currentState,e&&(this._webSocketClosedCause=ps.ExternalDisconnectWebSocket),[4,t.onDisconnectWebSocket(this._context,{cause:this._webSocketClosedCause})];case 1:return n.sent(),[2]}}))}))},e.prototype.logout=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this._context.currentState,this._clearEventDispatcher(),[4,t.onLogout(this._context,e)];case 1:return n.sent(),[2]}}))}))},e}(),Ns=function(e){function n(t){var n=t.retryAfterTime,i=t.reasonCode,r=t.message,s=t.authToken,o=e.call(this)||this;return o.type=Pr.DELAYED_CONNECTING,o.name="delayedconnecting",o._timerStartTime=0,o._retryAfterTime=n,o._reasonCode=i,o._message=r,o._authToken=s,o}return t(n,e),n.prototype._clearDelayConnectTimer=function(){this._delayConnectTimer&&(clearTimeout(this._delayConnectTimer),this._delayConnectTimer=void 0),this._timerStartTime=0},n.prototype._startDelayedConnectTimer=function(e){var t=this;this._clearDelayConnectTimer(),this._timerStartTime=Date.now(),this._delayConnectTimer=setTimeout((function(){return r(t,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),clearTimeout(this._delayConnectTimer),this._delayConnectTimer=void 0,this._timerStartTime=0,[4,e.changeState(new ks({authToken:this._authToken,isSoftRateLimited:!0}),t)];case 1:return n.sent(),[2]}}))}))}),this._retryAfterTime),e.connectionHandlers.forEach((function(e){e.onConnectionDelayed&&e.onConnectionDelayed(Math.ceil(t._retryAfterTime/1e3))}))},n.prototype._calculateRemainDelayConnectTime=function(){this._delayConnectTimer&&(this._retryAfterTime=this._retryAfterTime-(Date.now()-this._timerStartTime))},n.prototype._throwDelayedConnectingError=function(){var e=new m({code:u.DELAYED_CONNECTING,message:this._message});throw e.setDetail(JSON.stringify({retry_after:Math.ceil(this._retryAfterTime/1e3),reason_code:this._reasonCode,message:this._message})),e},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return this._startDelayedConnectTimer(e),[2]}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(t){return this._delayConnectTimer&&(this._calculateRemainDelayConnectTime(),this._startDelayedConnectTimer(e),this._throwDelayedConnectingError()),[2]}))}))},n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return this._delayConnectTimer&&(this._calculateRemainDelayConnectTime(),this._startDelayedConnectTimer(e),this._throwDelayedConnectingError()),[2]}))}))},n.prototype.onDelayedConnecting=function(e,t){var n=t.retryAfterTime,i=t.reasonCode,o=t.message;return r(this,void 0,void 0,(function(){return s(this,(function(t){return this._retryAfterTime=n,this._reasonCode=i,this._message=o,this._startDelayedConnectTimer(e),[2]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.autoReconnect,i=void 0!==n&&n,o=t.cause,a=void 0===o?null:o;return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._clearDelayConnectTimer(),a!==ps.ExternalSetBackground?[3,2]:[4,e.changeState(new As({autoReconnect:i,retryAfterTime:this._retryAfterTime,disconnectedTime:t,reasonCode:this._reasonCode,message:this._message}),t)];case 1:return n.sent(),[3,6];case 2:return e.hasSession?[4,e.changeState(new As({autoReconnect:i}),t)]:[3,4];case 3:return n.sent(),[3,6];case 4:return[4,e.changeState(new Cs,t)];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._clearDelayConnectTimer(),[4,e.changeState(new ws,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._clearDelayConnectTimer(),[4,e.changeState(new Cs,t)];case 1:return n.sent(),[2]}}))}))},n}(Ts),As=function(e){function n(t){var n=e.call(this)||this;return n.type=Pr.INTERNAL_DISCONNECTED,n.name="internaldisconnected",n._autoReconnect=!1,n._autoReconnect=t.autoReconnect,n._retryAfter=t.retryAfterTime,n._disconnectedTime=t.disconnectedTime,n._reasonCode=t.reasonCode,n._message=t.message,n}return t(n,e),n.prototype._getDelayedConnectTime=function(e){return this._retryAfter&&this._disconnectedTime?Math.ceil((this._retryAfter-(e-this._disconnectedTime))/1e3):-1},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),this._autoReconnect?[4,e.changeState(new ks,t)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=Date.now(),[4,e.disconnect()];case 1:return i.sent(),[4,e.changeState(new Ls({authToken:t}),n)];case 2:return i.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(i){switch(i.label){case 0:return t=Date.now(),(n=this._getDelayedConnectTime(t))>0?[4,e.changeState(new Ns({retryAfterTime:n,reasonCode:this._reasonCode,message:this._message}),t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,e.changeState(new ks,t)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new ws,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Cs,t)];case 1:return n.sent(),[2]}}))}))},n}(Ts),Ds=function(e){return r(void 0,void 0,void 0,(function(){return s(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},Is=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),Os=function(e,t,n){return void 0===n&&(n=new Is),r(void 0,void 0,void 0,(function(){var i,r,o,a,c,u;return s(this,(function(s){switch(s.label){case 0:i=0,r=null,o=function(e){return r=null!=e?e:new Error("Halted")},a=function(){i=0},s.label=1;case 1:if(!(-1===t||i<t))return[3,9];s.label=2;case 2:return s.trys.push([2,4,,8]),[4,e(o,a)];case 3:if(c=s.sent(),r)throw r;return[2,c];case 4:if(u=s.sent(),r)return[3,6];if(++i===t)throw u;return[4,Ds(n.calcTimeout(i))];case 5:return s.sent(),[3,7];case 6:throw r;case 7:return[3,8];case 8:return[3,1];case 9:throw"It should not happen."}}))}))},ks=function(e){function n(t){var n=void 0===t?{}:t,i=n.authToken,r=n.isSoftRateLimited,s=e.call(this)||this;return s.type=Pr.RECONNECTING,s.name="reconnecting",s._callbacks=[],s._authToken=i,s._isSoftRateLimited=null!=r?r:void 0,s}return t(n,e),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},n.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,i,o,a,c,l,h,d,_=this;return s(this,(function(f){switch(f.label){case 0:t=Date.now(),n=new at,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),Lr((function(){return r(_,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted&&e.onReconnectStarted()})),[2]}))}))})),f.label=1;case 1:return f.trys.push([1,4,,12]),i=ee(),o=0,a=e.sdkState.websocket,c=a.reconnectMaxRetry,l=a.reconnectRetryStrategy,[4,Os((function(t,n){return r(_,void 0,void 0,(function(){var r;return s(this,(function(s){switch(s.label){case 0:this._haltConnect=t,this._resetConnect=n,s.label=1;case 1:return s.trys.push([1,3,,4]),o++,[4,e.connect({authToken:this._authToken,connectionKey:i,connectionRetryCount:o,isSoftRateLimited:this._isSoftRateLimited})];case 2:return s.sent(),[3,4];case 3:if(r=s.sent(),e.clearLoginTimer(),r instanceof m){switch(r.code){case u.CONNECTION_CANCELED:case u.DELAYED_CONNECTING:return t(r),[2]}if(r.isSessionExpiredError||r.isSessionInvalidatedError)return t(r),[2]}throw r;case 4:return[2]}}))}))}),c,l)];case 2:return f.sent(),[4,e.changeState(new Rs,t)];case 3:return f.sent(),this._flushCallbacks(),Lr((function(){return r(_,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded&&e.onReconnectSucceeded()})),[2]}))}))})),[3,12];case 4:return h=f.sent(),v(h)?[3,10]:[4,e.disconnect()];case 5:return f.sent(),h instanceof m?h.code!==u.DELAYED_CONNECTING?[3,7]:(d=JSON.parse(h.detail),[4,e.changeState(new Ns({retryAfterTime:1e3*d.retry_after,reasonCode:d.reason_code,message:d.message,authToken:this._authToken}),t)]):[3,9];case 6:return f.sent(),[3,9];case 7:return h.code===u.CONNECTION_CANCELED?[3,9]:[4,e.changeState(new As({autoReconnect:!1}),t)];case 8:f.sent(),f.label=9;case 9:return this._flushCallbacks(h),Lr((function(){return r(_,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectFailed&&e.onReconnectFailed()})),[2]}))}))})),[3,11];case 10:throw h;case 11:return[3,12];case 12:return[2,n.promise]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){return n=new at,this._halt(m.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push((function(){var i=Date.now();e.changeState(new Ls({authToken:t}),i).then((function(){n.resolve()})).catch((function(e){n.reject(e)}))})),[2,n.promise]}))}))},n.prototype.onReconnect=function(e,t){var n=t.resetReconnectCount,i=void 0!==n&&n;return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new at,this._resetConnect&&i&&this._resetConnect(),this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){t._error;var n=t.autoReconnect,i=void 0===n||n;return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(m.connectionCanceled),[4,e.changeState(new As({autoReconnect:i}),t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(m.connectionCanceled),[4,e.changeState(new ws,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(m.connectionCanceled),[4,e.changeState(new Cs,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onDelayedConnecting=function(e,t){var n=t.retryAfterTime,i=t.reasonCode,o=t.message;return r(this,void 0,void 0,(function(){var t,r;return s(this,(function(s){switch(s.label){case 0:return t=Date.now(),(r=new m({code:u.DELAYED_CONNECTING,message:o})).setDetail(JSON.stringify({retry_after:n/1e3,reason_code:i,message:o})),this._halt(r),[4,e.changeState(new Ns({retryAfterTime:n,reasonCode:i,message:o,authToken:this._authToken}),t)];case 1:return s.sent(),[2]}}))}))},n}(Ts),Rs=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Pr.CONNECTED,t.name="connected",t}return t(n,e),n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),[4,e.changeState(new ks,t)];case 2:return n.sent(),[2]}}))}))},n.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return r(this,void 0,void 0,(function(){var t;return s(this,(function(i){switch(i.label){case 0:return t=Date.now(),[4,e.changeState(new As({autoReconnect:n}),t)];case 1:return i.sent(),[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new ws,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Cs,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onDelayedConnecting=function(e,t){var n=t.retryAfterTime,i=t.reasonCode,o=t.message;return r(this,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return t=Date.now(),[4,e.changeState(new Ns({retryAfterTime:n,reasonCode:i,message:o}),t)];case 1:return r.sent(),[2]}}))}))},n}(Ts),Ls=function(e){function n(t){var n=t.authToken,i=e.call(this)||this;return i.type=Pr.CONNECTING,i.name="connecting",i._authToken="",i._callbacks=[],i._authToken=n,i}return t(n,e),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},n.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,i,o,a,c,l=this;return s(this,(function(h){switch(h.label){case 0:t=Date.now(),n=new at,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),h.label=1;case 1:return h.trys.push([1,4,,12]),i=ee(),o=0,[4,Os((function(t){return r(l,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),o++,[4,e.connect({authToken:this._authToken,connectionKey:i,connectionRetryCount:o})];case 2:return r.sent(),[3,4];case 3:if(n=r.sent(),e.clearLoginTimer(),n instanceof m)switch(n.code){case u.CONNECTION_CANCELED:case u.SESSION_KEY_EXPIRED:case u.SESSION_TOKEN_EXPIRED:case u.SESSION_REVOKED:case u.USER_AUTH_DEACTIVATED:case u.USER_AUTH_DELETED_OR_NOT_FOUND:case u.USER_DEACTIVATED:case u.DELAYED_CONNECTING:return t(n),[2]}throw n;case 4:return[2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return h.sent(),[4,e.changeState(new Rs,t)];case 3:return h.sent(),Lr((function(){return r(l,void 0,void 0,(function(){return s(this,(function(t){return this._flushCallbacks(),e.connectionHandlers.forEach((function(t){t.onConnected&&t.onConnected(e.sdkState.userId)})),[2]}))}))})),[3,12];case 4:return a=h.sent(),v(a)?[3,10]:[4,e.disconnect()];case 5:return h.sent(),a instanceof m?a.code!==u.DELAYED_CONNECTING?[3,7]:(c=JSON.parse(a.detail),[4,e.changeState(new Ns({retryAfterTime:1e3*c.retry_after,reasonCode:c.reason_code,message:c.message,authToken:this._authToken}),t)]):[3,9];case 6:return h.sent(),[3,9];case 7:return a.code===u.CONNECTION_CANCELED?[3,9]:[4,e.changeState(new Ps,t)];case 8:h.sent(),h.label=9;case 9:return Lr((function(){return r(l,void 0,void 0,(function(){return s(this,(function(e){return this._flushCallbacks(a),[2]}))}))})),[3,11];case 10:throw a;case 11:return[3,12];case 12:return[2,n.promise]}}))}))},n.prototype.onConnect=function(e){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new at,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,i=void 0===n?null:n,o=t.autoReconnect,a=void 0!==o&&o,c=t.cause,u=void 0===c?null:c;return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(null!=i?i:xs(u)),e.hasSession?[4,e.changeState(new As({autoReconnect:a}),t)]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,e.changeState(new Cs,t)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return this._halt(xs((null==t?void 0:t.cause)||null)),n=Date.now(),e.hasSession?[4,e.changeState(new ws,n)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,e.changeState(new Cs,n)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},n.prototype.onLogout=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=Date.now(),this._halt(null!=t?t:m.connectionCanceled),[4,e.changeState(new Cs,n)];case 1:return i.sent(),[2]}}))}))},n.prototype.onDelayedConnecting=function(e,t){var n=t.retryAfterTime,i=t.reasonCode,o=t.message;return r(this,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return t=Date.now(),[4,e.changeState(new Ns({retryAfterTime:n,reasonCode:i,message:o,authToken:this._authToken}),t)];case 1:return r.sent(),[2]}}))}))},n}(Ts);function xs(e){var t=m.connectionCanceled;if(e){var n=null;switch(e){case ps.ExternalSetBackground:n="Connection has been canceled due to the application having externally moved to background while in ConnectingState.";break;case ps.ExternalDisconnectWebSocket:n="Connection has been canceled because sb.disconnectWebSocket() was called while in ConnectingState."}n&&t.setDetail(n)}return t}var Us,Ps=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Pr.INITIALIZED,t.name="initialized",t}return t(n,e),n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=Date.now(),[4,e.changeState(new Ls({authToken:t}),n)];case 1:return i.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Cs({wasPreviouslyConnected:!1}),t)];case 1:return n.sent(),[2]}}))}))},n}(Ts),Ms=function(e){function n(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return t(n,e),n}(Be),qs=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,i=e.logger;this.pingDelegate=t,this.sdkState=n,this._logger=i}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this;if(!this.sdkState.websocket)throw m.connectionRequired;var n=new Ms;try{var i=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error()}),i),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},e.prototype.refreshTimer=function(){var e,t=this;if(!this.sdkState.websocket)throw m.connectionRequired;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},e}(),Fs=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications","message_template","ai_agent"],Hs=function(e){function n(t,n){var i,r=n.sdkState,s=n.cacheContext,o=n.connectionHandlers,a=n.sessionManager,c=n.websocketClient,l=n.dispatcher,h=n.logger,d=n.entryState,_=void 0===d?new Ps:d,f=this;return(f=e.call(this)||this)._currentConnectionRetryCount=0,f._stateUpdatedAt=0,f._connectingAt=0,f._connectedAt=0,f._logiReceivedAt=0,f._connectionRequestQueue=[],f._iid=t,f.sdkState=r,f.cacheContext=s,f.connectionHandlers=o,f._sessionManager=a,f._websocketClient=c,f._dispatcher=l,f._logger=h,f._currentState=_,(null===(i=f.sdkState.websocket)||void 0===i?void 0:i.pingerDisabled)||(f._pinger=new qs({pingDelegate:{send:function(e){return f._websocketClient.send(e)},error:function(e){l.dispatch(new Xe(new nt({type:He.WEBSOCKET_DISCONNECT,data:{success:!0,error_code:u.NETWORK_ERROR,error_description:"cause=ping_pong_timedout"}}))),f._websocketClient.error(e)}},sdkState:f.sdkState,logger:h})),f._websocketClient.on("open",(function(){f._connectedAt=Date.now(),f._tryResolveConnectionRequest()})).on("message",(function(e){if("LOGI"===e.code)f.clearLoginTimer(),f._dispatcher.dispatch(e.as(bs))})).on("ping-refresh",(function(){var e;return null===(e=f._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(function(){var e;return null===(e=f._pinger)||void 0===e?void 0:e.pong()})).on("error",(function(){var e;return null===(e=f._pinger)||void 0===e?void 0:e.stop()})).on("close",(function(){f._logiProcessingTimer=setTimeout((function(){f._logiProcessingTimer=void 0,f._unresolvedLogi||f._rejectConnectionRequest(m.networkError)}),500)})),f._dispatcher.on((function(e){if(e instanceof bs)f._unresolvedLogi=e,f._tryResolveConnectionRequest();else if(e instanceof Ur){var t=e.retryAfterTime,n=e.reasonCode,i=e.message,r=new m({code:u.DELAYED_CONNECTING,message:i});r.setDetail(JSON.stringify({retry_after:t/1e3,reason_code:n,message:i})),f._rejectConnectionRequest(r)}})),f}return t(n,e),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasSession",{get:function(){return this._sessionManager.session.hasSession},enumerable:!1,configurable:!0}),n.prototype.changeState=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return t>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=t,this._dispatcher.dispatch(new Gr({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return n.sent(),[2,!0];case 2:return[2,!1]}}))}))},n.prototype._tryResolveConnectionRequest=function(){var e;return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this._unresolvedLogi,this._websocketClient.isOpen&&t?(this._unresolvedLogi=void 0,this._logiReceivedAt=Date.now(),t.error?[3,2]:[4,t.applyTo(this._iid)]):[3,3];case 1:return n.sent(),this._statLogConnection(),null===(e=this._pinger)||void 0===e||e.start(),this._connectionRequestQueue.forEach((function(e){return e.resolve()})),this._connectionRequestQueue=[],this.sdkState.appState="foreground",[3,3];case 2:t.error.isSessionExpiredError||t.error.isSessionInvalidatedError?this._dispatcher.dispatch(new je({reason:t.error.code,message:t.error.message})):this._logger.warn("login failed: ".concat(t.error)),this._rejectConnectionRequest(t.error),n.label=3;case 3:return[2]}}))}))},n.prototype._rejectConnectionRequest=function(e){var t;if(null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var n=this._connectionRequestQueue;this._connectionRequestQueue=[],n.forEach((function(t){return t.reject(e)})),this._statLogConnection(e)}},n.prototype._url=function(e){var t,n=e.configTs,i=this.sdkState,r=i.appId,s=i.appVersion,o=i.userId,a=i.extensions,c=i.sendbirdRuntimeEnvironment,u=this.cacheContext.localCacheEnabled,l=this._sessionManager.session,d=null===(t=this.sdkState.websocket)||void 0===t?void 0:t.compression,_=!!(null!=a?a:{}).sb_uikit,f=ot.userAgentWithExtension(a);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(h.OS_VERSION),"&sv=").concat(encodeURIComponent(h.SDK_VERSION),"&ai=").concat(r).concat(s?"&av=".concat(s):"").concat(l.hasSession?"":"&user_id=".concat(encodeURIComponent(o)),"&pmce=").concat(d?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(f,"&SB-SDK-User-Agent=").concat(encodeURIComponent(ot.sendbirdSdkUserAgentWithExtension(c)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(Fs))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(u?1:0,"&include_poll_details=1").concat(_?"&uikit_config=1":"","&config_ts=").concat(n)},n.prototype._statLogConnection=function(e){var t,n;this._dispatcher.dispatch(new Xe(new nt({type:He.WEBSOCKET_CONNECT,data:{host_url:null===(t=this.sdkState.websocket)||void 0===t?void 0:t.host,success:!e,latency:this._connectedAt>0?this._connectedAt-this._connectingAt:Date.now()-this._connectingAt,logi_latency:this._logiReceivedAt>0?this._logiReceivedAt-this._connectingAt:void 0,connection_id:this._currentConnectionKey,accum_trial:this._currentConnectionRetryCount,is_soft_rate_limited:null!==(n=this._isSoftRateLimited)&&void 0!==n?n:void 0,error_code:null==e?void 0:e.code,error_description:(null==e?void 0:e.code)===u.DELAYED_CONNECTING?null==e?void 0:e.detail:null==e?void 0:e.message}})))},n.prototype.connect=function(e){var t;return void 0===e&&(e={}),r(this,void 0,void 0,(function(){var n,i,r,o,a,c,u,l,h,d,_,f,p=this;return s(this,(function(s){switch(s.label){case 0:return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(m.connectionCanceled)),n=new at,i=e.authToken,r=void 0===i?"":i,o=e.connectionKey,a=void 0===o?ee():o,c=e.connectionRetryCount,u=void 0===c?1:c,l=e.isSoftRateLimited,this._connectionRequestQueue.push(n),1!==this._connectionRequestQueue.length?[3,2]:(this._currentConnectionKey=a,this._currentConnectionRetryCount=u,this._isSoftRateLimited=l,this._connectingAt=Date.now(),this._connectedAt=0,this._logiReceivedAt=0,this._loginTimer=setTimeout((function(){p._loginTimer=void 0,p._rejectConnectionRequest(m.loginTimeout)}),null===(t=this.sdkState.websocket)||void 0===t?void 0:t.responseTimeout),h=this._sessionManager.session,r&&(h.authToken=r,h.sessionKey=void 0),d=0,[4,this.cacheContext.preference.get(is(this.sdkState.appId))]);case 1:(_=s.sent())&&(d=_.configTs),f=this._url({configTs:d}),h.sessionKey||h.authToken?this._websocketClient.connect(f,JSON.stringify(h.hasSession?{auth:h.sessionKey}:{token:h.authToken})):this._websocketClient.connect(f,JSON.stringify({})),s.label=2;case 2:return[2,n.promise]}}))}))},n.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(bs.asError(m.connectionRenew))},n.prototype.disconnect=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}}))}))},n.prototype.logout=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,[4,this.disconnect()];case 1:return e.sent(),[4,this._sessionManager.clear()];case 2:return e.sent(),[2]}}))}))},n.prototype.clearLoginTimer=function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)},n}(ne),Vs=function(e){function n(t){var n=t.appId,i=t.userId,r=t.includeUIKitConfig,s=void 0!==r&&r,o=t.localCacheEnabled,a=void 0===o||o,c=t.expiringSession,u=void 0===c||c,l=t.configTs,h=void 0===l?0:l,d=e.call(this)||this;return d.path="".concat(le,"/").concat(encodeURIComponent(i),"/authentication"),d.method=ae.POST,d.params=se({expiring_session:!!u,include_logi:!0,include_extra_data:String(Fs),uikit_config:s,use_local_cache:a,app_id:n,config_ts:h}),d.requireAuth=!1,d}return t(n,e),n}(Ve),Gs=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.logi=new bs(t,"LOGI",n),i}return t(n,e),n}(Ge);!function(e){e[e.ALL=0]="ALL",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.API=2]="API"}(Us||(Us={}));var zs,js,Ks=[Qe,Vs],Bs=function(){function e(e,t){var n=t.session,i=t.sdkState,r=t.dispatcher,s=t.logger,a=t.useFetchCompat,c=void 0!==a&&a,u=this;this._currentConnectionStateType=Pr.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new Fr(e,{session:n,sdkState:i,dispatcher:r,logger:s,useFetchCompat:c}),this._session=n,this._logger=s,this._dispatcher=r,this._dispatcher.on((function(e){var t,n,i;if(e instanceof Gr){var r=e.stateType;switch(u._currentConnectionStateType=r,r){case Pr.CONNECTED:u._resolveLazyCallQueue();break;case Pr.INITIALIZED:case Pr.INTERNAL_DISCONNECTED:case Pr.EXTERNAL_DISCONNECTED:case Pr.LOGOUT:u._session.isRefreshing||u._rejectLazyCallQueue((null===(i=u._session)||void 0===i?void 0:i.hasSession)?m.connectionClosed:m.connectionRequired)}}else if(e instanceof zr)u._session.hasChatServicePermission||u._resolveLazyCallQueue(Us.API);else if(e instanceof jr||e instanceof Kr)u._rejectLazyCallQueue(m.connectionClosed);else if(e instanceof Je){var s=e.request,a=e.deferred,c=e.error;try{for(var l=o(Ks),h=l.next();!h.done;h=l.next()){if(s instanceof h.value)return void a.reject(c)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}u._lazyCallQueue.push({command:s,deferred:a})}}))}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===Pr.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===Pr.CONNECTING||this._currentConnectionStateType===Pr.RECONNECTING||this._session.isRefreshing},enumerable:!1,configurable:!0}),e.prototype._classifyLazyCallQueueByScope=function(e){var t,n=[],i=[];switch(e){case Us.ALL:t=null;break;case Us.WEBSOCKET:t=Be;break;case Us.API:t=Ve}var r=!1;return this._lazyCallQueue.forEach((function(e){!t||e.command instanceof t||(r=!0),r?i.push(e):n.push(e)})),[n,i]},e.prototype._resolveLazyCallQueue=function(e){var t=this;void 0===e&&(e=Us.ALL);var n=a(this._classifyLazyCallQueueByScope(e),2),i=n[0],o=n[1];this._lazyCallQueue=o,i.forEach((function(e){return r(t,void 0,void 0,(function(){var t,n,i,r,o;return s(this,(function(s){switch(s.label){case 0:t=e.command,n=e.deferred,(i=e.timeout)&&clearTimeout(i),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.send(t)];case 2:return r=s.sent(),n.resolve(r),[3,4];case 3:return o=s.sent(),n.reject(o),[3,4];case 4:return[2]}}))}))}))},e.prototype._rejectLazyCallQueue=function(e,t){var n=this;void 0===t&&(t=Us.ALL);var i=a(this._classifyLazyCallQueueByScope(t),2),o=i[0],c=i[1];this._lazyCallQueue=c,o.forEach((function(t){return r(n,void 0,void 0,(function(){var n,i;return s(this,(function(r){return n=t.deferred,i=t.timeout,clearTimeout(i),n.reject(e),[2]}))}))}))},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,i=this;return s(this,(function(r){switch(r.label){case 0:return e instanceof Be?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:case 7:return[2,r.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new at,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return i.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),m.connectionRequired;case 3:case 9:return[3,11];case 4:return e instanceof Ve?this._session.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,10];case 6:return e.hasSessionKey?(this._logger.debug("send api request with tmp session key",e),[4,this.commandRouter.send(e)]):[3,8];case 8:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new at,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return i.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=m.connectionRequired,this._logger.debug("fail api request",n),n;case 10:throw m.invalidCommand;case 11:return[2]}}))}))},e.prototype.forceSend=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._logger.debug("send forced request",e),e instanceof Be||e instanceof Ve?[4,this.commandRouter.send(e)]:[3,2];case 1:return[2,t.sent()];case 2:throw m.invalidCommand}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(m.connectionRequired),this._lazyCallQueue.splice(t,1))},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},e}(),Qs="sendbird@devicetokens",Ws=function(){function e(e){var t=e.type,n=e.token,i=e.device_os,r=e.device_manufacturer,s=e.system_push_enabled;this.type=t,this.token=n,this.deviceOS=i,this.deviceManufacturer=r,this.systemPushEnabled=s}return e.payloadify=function(e){return se(oe({type:e.type,token:e.token,device_os:e.deviceOS,device_manufacturer:e.deviceManufacturer,system_push_enabled:e.systemPushEnabled}))},e}(),Zs=new WeakMap,Ys=function(e){function n(t){var n=t._iid,i=t.session,r=t.cacheContext,s=t.sdkState,o=t.dispatcher,a=t.requestQueue,c=t.logger,l=t.pushNotificationAckManager,h=e.call(this)||this;return h._currentConnectionStateType=Pr.INITIALIZED,h._isRefreshingAuthToken=!1,h.currentUser=null,h.session=i,h._iid=n,h._cacheContext=r,h._sdkState=s,h._dispatcher=o,h._requestQueue=a,h._logger=c,h._pushNotificationAckManager=l,h._deviceTokens=[],h._dispatcher.on((function(e){var t,n,i;if(e instanceof Gr){var r=e.stateType;h._currentConnectionStateType=r}else if(e instanceof je&&h.handler&&!h.isSessionKeyRefreshing){if(h._currentConnectionStateType===Pr.CONNECTING)return;(null===(t=e.error)||void 0===t?void 0:t.isSessionInvalidatedError)?h.clear():((null===(n=e.error)||void 0===n?void 0:n.isSessionTokenExpiredError)&&h.refreshAuthToken().catch((function(e){if(v(e)&&"foreground"===h._sdkState.appState)throw e})),(null===(i=e.error)||void 0===i?void 0:i.isSessionKeyExpiredError)&&(h._logger.debug("session expired"),h.handler.onSessionExpired&&h.handler.onSessionExpired(),h._currentConnectionStateType===Pr.CONNECTED&&h._dispatcher.dispatch(new Xe(new nt({type:He.WEBSOCKET_DISCONNECT,data:{success:!0,error_code:u.SESSION_KEY_EXPIRED,error_description:"cause=session_expired"}}))),h.refreshSessionKey().catch((function(e){if(v(e)&&"foreground"===h._sdkState.appState)throw e}))))}})),h}return t(n,e),Object.defineProperty(n.prototype,"ekey",{get:function(){return Zs.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceTokens",{get:function(){return this._deviceTokens},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceTokenLastDeletedAt",{get:function(){return this._deviceTokenLastDeletedAt},enumerable:!1,configurable:!0}),n.prototype.indexOfDeviceToken=function(e,t){return this._deviceTokens.findIndex((function(n){return n.type===e&&n.token===t}))},n.prototype.hasDeviceToken=function(e,t){return this.indexOfDeviceToken(e,t)>=0},n.prototype.createRefreshWebsocketCommand=function(e,t){return new We({authToken:e,expiringSession:!0,requestId:t})},n.prototype._refreshSessionKeyByWebSocket=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,o;return s(this,(function(s){switch(s.label){case 0:return t=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(t)];case 1:if(n=s.sent(),i=n.as(Ye),r=i.newKey,o=i.error)throw o;return this.session.sessionKey=null!=r?r:this.session.sessionKey,[2]}}))}))},n.prototype._refreshSessionKeyByApi=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(i){switch(i.label){case 0:return t=new Qe({userId:this._sdkState.userId,authToken:e,services:this.session.services&&this.session.services.length>0?this.session.services:void 0,expiringSession:!0}),[4,Os((function(e){return r(n,void 0,void 0,(function(){var n,i,r,o,a;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(t)];case 1:return n=s.sent(),i=n.as(Ze),r=i.key,o=i.services,this.session.sessionKey=r,this.session.services=o,[3,3];case 2:if(a=s.sent(),!this._isSessionRelatedError(a))throw a;return e(a),[3,3];case 3:return[2]}}))}))}),3)];case 1:return i.sent(),[2]}}))}))},n.prototype._refreshSessionKey=function(e,t){return void 0===t&&(t=!0),r(this,void 0,void 0,(function(){var n,i;return s(this,(function(r){switch(r.label){case 0:if(this._currentConnectionStateType!==Pr.CONNECTED)return[3,8];r.label=1;case 1:return r.trys.push([1,3,,8]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return r.sent(),this.complete(),[2];case 3:n=r.sent(),r.label=4;case 4:return r.trys.push([4,6,,7]),[4,this._handleSessionRefreshError(n,t)];case 5:return r.sent(),[2];case 6:return r.sent(),[3,7];case 7:return[3,8];case 8:return r.trys.push([8,10,,12]),[4,this._refreshSessionKeyByApi(e)];case 9:return r.sent(),this.complete(),[3,12];case 10:return i=r.sent(),[4,this._handleSessionRefreshError(i,t)];case 11:return r.sent(),[3,12];case 12:return[2]}}))}))},n.prototype._receiveNewAuthToken=function(){var e,t=this,n=new at;if(this._isRefreshingAuthToken=!0,this.session.sessionKey=void 0,this.session.authToken=void 0,null===(e=this.handler)||void 0===e?void 0:e.onSessionTokenRequired){var i=null,o=function(){i&&(clearTimeout(i),i=null)},a=function(e){o(),t._isRefreshingAuthToken&&(t._isRefreshingAuthToken=!1,n.resolve(e))},c=function(e){o(),t._isRefreshingAuthToken&&(t._isRefreshingAuthToken=!1,n.reject(e))};i=setTimeout((function(){return c()}),1e3*this._sdkState.sessionTokenRefreshTimeout),Lr((function(){return r(t,void 0,void 0,(function(){var e;return s(this,(function(t){return(null===(e=this.handler)||void 0===e?void 0:e.onSessionTokenRequired)&&this.handler.onSessionTokenRequired(a,c),[2]}))}))}))}else n.resolve(null);return n.promise},n.prototype._handleSessionRefreshError=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return e instanceof m&&(e.isSessionTokenExpiredError||e.code===u.APPLICATION_NOT_FOUND)?(this.session.authToken=void 0,t?[4,this._receiveNewAuthToken()]:[3,6]):[3,6];case 1:return(n=i.sent())?(this.session.authToken=n,[4,this._refreshSessionKey(this.session.authToken,!1)]):[3,3];case 2:return i.sent(),[3,5];case 3:return[4,this.clear()];case 4:i.sent(),i.label=5;case 5:return[2];case 6:throw e}}))}))},n.prototype._isSessionRelatedError=function(e){return e instanceof m&&(e.isSessionExpiredError||e.isSessionInvalidatedError)},Object.defineProperty(n.prototype,"isSessionKeyRefreshing",{get:function(){return this.session.isRefreshing},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionExpiring",{get:function(){return!!this.handler},enumerable:!1,configurable:!0}),n.prototype.authenticate=function(e,t){var n;return r(this,void 0,void 0,(function(){var i,r,o,a,c;return s(this,(function(s){switch(s.label){case 0:return this.session.authToken=t,i=0,[4,this._cacheContext.preference.get(is(this._sdkState.appId))];case 1:return(r=s.sent())&&(i=r.configTs),o=new Vs({appId:this._sdkState.appId,userId:e,includeUIKitConfig:!!(null!==(n=this._sdkState.extensions)&&void 0!==n?n:{}).sb_uikit,localCacheEnabled:this._cacheContext.localCacheEnabled,expiringSession:this.isSessionExpiring,configTs:i}),[4,this._requestQueue.commandRouter.send(o)];case 2:return a=s.sent(),(c=a.as(Gs).logi).error?[3,5]:this.session.hasChatServicePermission?[3,4]:[4,c.applyTo(this._iid)];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:throw c.error;case 6:return[2]}}))}))},n.prototype.login=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,o,a,c,u,l;return s(this,(function(s){switch(s.label){case 0:return n=e.key,i=e.ekey,r=e.services,o=e.userProfile,a=e.deviceTokenLastDeletedAt,c=void 0===a?0:a,this.session.sessionKey=n,this.session.services=r,Zs.set(this,i),this._deviceTokenCacheEnabled=null===(t=null==o?void 0:o.appInfo)||void 0===t?void 0:t.deviceTokenCache,u=this._cacheContext.preference,this._deviceTokenCacheEnabled?[4,u.get(Qs)]:[3,5];case 1:return!(l=s.sent())||l.lastDeletedAt<c?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=c,[4,this.saveDeviceToken()]):[3,3];case 2:return s.sent(),[3,4];case 3:this._deviceTokens=l.tokens.map((function(e){return new Ws(Ws.payloadify(e))})),this._deviceTokenLastDeletedAt=l.lastDeletedAt,s.label=4;case 4:return[3,7];case 5:return[4,u.remove(Qs)];case 6:s.sent(),s.label=7;case 7:return[2]}}))}))},n.prototype.complete=function(){var e=this;this.dispatch("refresh"),this._dispatcher.dispatch(new zr),Lr((function(){return r(e,void 0,void 0,(function(){var e;return s(this,(function(t){return this._logger.debug("session refreshed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionRefreshed)&&this.handler.onSessionRefreshed(),[2]}))}))}))},n.prototype.error=function(e){var t=this;Lr((function(){return r(t,void 0,void 0,(function(){var t;return s(this,(function(n){return(null===(t=this.handler)||void 0===t?void 0:t.onSessionError)&&this.handler.onSessionError(e),[2]}))}))}))},n.prototype.close=function(){var e=this;this.dispatch("close"),this._dispatcher.dispatch(new Kr),Lr((function(){return r(e,void 0,void 0,(function(){var e;return s(this,(function(t){return this._logger.debug("session closed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionClosed)&&this.handler.onSessionClosed(),[2]}))}))}))},n.prototype.refreshAuthToken=function(){return r(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(e=null,!this.isSessionExpiring||this.session.isRefreshing)return[3,9];this.session.isRefreshing=!0,n.label=1;case 1:return n.trys.push([1,7,8,9]),[4,this._receiveNewAuthToken()];case 2:return(e=n.sent())?(this._logger.debug("session refreshing.."),this.session.authToken=e,[4,this._refreshSessionKey(this.session.authToken)]):[3,4];case 3:return n.sent(),[3,6];case 4:return[4,this.clear()];case 5:n.sent(),n.label=6;case 6:return[3,9];case 7:throw n.sent(),t=e?m.sessionTokenRefreshFailed:m.sessionTokenRequestFailed,this._dispatcher.dispatch(new jr),this.error(t),this._logger.debug("refresh auth token error = ",t),t;case 8:return this.session.isRefreshing=!1,[7];case 9:return[2]}}))}))},n.prototype.refreshSessionKey=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:if(!this.isSessionExpiring||this.session.isRefreshing)return[3,5];this.session.isRefreshing=!0,t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this._refreshSessionKey(this.session.authToken)];case 2:return t.sent(),[3,5];case 3:throw t.sent(),e=m.sessionTokenRefreshFailed,this._dispatcher.dispatch(new jr),this.error(e),e;case 4:return this.session.isRefreshing=!1,[7];case 5:return[2]}}))}))},n.prototype.setDeviceToken=function(e,t,n){if(this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,t)<0){var i=new Ws({type:e,token:t,device_os:null==n?void 0:n.deviceOS,device_manufacturer:null==n?void 0:n.deviceManufacturer,system_push_enabled:null==n?void 0:n.systemPushEnabled});return this._deviceTokens.push(i),!0}return!1},n.prototype.unsetDeviceToken=function(e,t){if(this._deviceTokenCacheEnabled){var n=this.indexOfDeviceToken(e,t);n>=0&&this._deviceTokens.splice(n,1)}},n.prototype.unsetDeviceTokens=function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter((function(t){return t.type!==e})):[])},n.prototype.setDeviceTokenDeletedAt=function(e){e>0&&(this._deviceTokenLastDeletedAt=e)},n.prototype.saveDeviceToken=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._deviceTokenCacheEnabled?[4,this._cacheContext.preference.set(Qs,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.currentUser=null,this.session.clear(),this.close(),Zs.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,[4,this.saveDeviceToken()];case 1:return e.sent(),this._pushNotificationAckManager.clear(),[2]}}))}))},n}(ne),Xs=function(e,t){var n,i;if(null!==e&&null!==t){var r=Object.keys(e),s=Object.keys(t),u=c([],a(new Set(c(c([],a(r),!1),a(s),!1))),!1),l={};try{for(var h=o(u),d=h.next();!d.done;d=h.next()){var _=d.value,f=typeof e[_],p=typeof t[_];"undefined"===f?l[_]=t[_]:"undefined"===p?l[_]=e[_]:f!==p?l[_]=t[_]:"object"===f&&e[_]&&t[_]?l[_]=Xs(e[_],t[_]):l[_]=t[_]}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}return l}return t};!function(e){e[e.PENDING=0]="PENDING",e[e.COLLECT_ONLY=1]="COLLECT_ONLY",e[e.ENABLED=2]="ENABLED",e[e.DISABLED=3]="DISABLED"}(zs||(zs={})),function(e){e.DAILY="daily",e.DEFAULT="default",e.REALTIME="realtime"}(js||(js={}));var Js,$s=100,eo=function(){function e(e){var t=e.deviceId,n=e.cacheContext,i=e.requestQueue;this.queue=[],this.flushWaitQueue=[],this.enabledState=zs.PENDING,this.isFlushing=!1,this._sentLogStats=[],this.deviceId=t,this.cacheContext=n,this.requestQueue=i,this.logInfo={deviceId:t,statLogs:[],generation:1,lastFlushedAt:0},this.limit=$s}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.enabledState===zs.ENABLED},enumerable:!1,configurable:!0}),e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.key=e,[4,this.cacheContext.preference.get(this.key)];case 1:return(t=n.sent())&&(this.logInfo=t),[2]}}))}))},e.prototype._mergeQueue=function(){this.flushWaitQueue.length>0&&(this.queue=this.queue.concat(this.flushWaitQueue),this.flushWaitQueue=[])},e.prototype._isDuplicateStat=function(e){var t=this._sentLogStats.find((function(t){var n;return t.channelUrl===e.data.channel_url&&t.messageId===(null!==(n=e.data.notificationId)&&void 0!==n?n:e.data.message_id)&&t.action===e.data.action}));return t||this._sentLogStats.push({channelUrl:e.data.channel_url,messageId:e.data.message_id,action:e.data.action}),!!t},e.prototype._save=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=c(c([],a(this.queue),!1),a(this.flushWaitQueue),!1),[4,this.cacheContext.preference.set(this.key,{deviceId:this.logInfo.deviceId,statLogs:e.map((function(e){return nt.payloadify(e)})),generation:this.logInfo.generation++,lastFlushedAt:this.logInfo.lastFlushedAt})];case 1:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){return this.queue=[],this.flushWaitQueue=[],this.logInfo.generation=1,this._save(),[2]}))}))},e}(),to=function(e){function n(t){var n,i,r,s,o=t.type,a=t.data,c=t.ts,u=void 0===c?Date.now():c,l=e.call(this,{type:o,data:a,ts:u})||this;return l.date=new Date(u),l.key="".concat((n=l.date,i=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0"),"".concat(i).concat(r).concat(s)),"_").concat(o),l}return t(n,e),n}(nt),no=function(e){function n(t){var n=t.deviceId,i=t.statLogs,r=e.call(this)||this;return r.method=ae.POST,r.path="".concat(Ce),r.params={device_id:n,log_entries:i.map((function(e){return nt.payloadify(e)}))},r}return t(n,e),n}(Ve),io=function(e){function n(t){var n=t.deviceId,i=t.cacheContext,r=t.requestQueue;return e.call(this,{deviceId:n,cacheContext:i,requestQueue:r})||this}return t(n,e),Object.defineProperty(n.prototype,"_isSendable",{get:function(){return 0!==this.queue.length&&Date.now()-this.logInfo.lastFlushedAt>=this.statConfig.minInterval},enumerable:!1,configurable:!0}),n.prototype.init=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,e.prototype.init.call(this,t+".daily")];case 1:return n.sent(),this.queue=this.logInfo.statLogs.map((function(e){return new nt({type:e.stat_type,ts:e.ts,data:e.data})})),[2]}}))}))},n.prototype.setConfig=function(e,t){return r(this,void 0,void 0,(function(){var n,i,r,o;return s(this,(function(s){switch(s.label){case 0:return this.statConfig=e,this.statConfig.minInterval=864e5,this._mergeQueue(),t.localCacheStat?(this.enabledState=t.enabledStat?zs.ENABLED:zs.COLLECT_ONLY,[3,3]):[3,1];case 1:return this.enabledState=zs.DISABLED,[4,this.clear()];case 2:s.sent(),s.label=3;case 3:return this.isEnabled&&this._isSendable?[4,this._getUploadStats()]:[3,9];case 4:n=s.sent(),i=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100),r=0,s.label=5;case 5:return r<n.length?(o=n.slice(r,1+this.statConfig.maxStatCountPerRequest),[4,Ds(i)]):[3,9];case 6:return s.sent(),[4,this._flush(o)];case 7:s.sent(),s.label=8;case 8:return r+=this.statConfig.maxStatCountPerRequest,[3,5];case 9:return[2]}}))}))},n.prototype.put=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return s(this,(function(s){switch(s.label){case 0:return this.enabledState===zs.DISABLED?[2,!0]:(t=this.enabledState===zs.PENDING||this.isFlushing?this.flushWaitQueue:this.queue,n=a(t.filter((function(t){return t instanceof to&&t.key===e.key})),1),(i=n[0])?i.data=Xs(i.data,e.data):t.push(e),this.enabledState===zs.PENDING?[3,2]:[4,this._save()]);case 1:s.sent(),s.label=2;case 2:return this.isEnabled?(this._mergeQueue(),this._isSendable?[4,this._getUploadStats()]:[3,5]):[3,5];case 3:return r=s.sent(),[4,this._flush(r)];case 4:return[2,s.sent()];case 5:return[2,!0]}}))}))},n.prototype._getUploadStats=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){return e=this.queue.filter((function(e){if(e instanceof to){var t=new Date,n=a([e.date.getFullYear(),t.getFullYear()],2),i=n[0],r=n[1];if(i<r)return!0;if(i===r){var s=a([e.date.getMonth(),t.getMonth()],2),o=s[0],c=s[1];if(o<c)return!0;if(o===c){var u=a([e.date.getDate(),t.getDate()],2);return u[0]<u[1]}}}return!1})),[2,e]}))}))},n.prototype._flush=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return s(this,(function(s){switch(s.label){case 0:if(t=!0,!(e.length>0))return[3,10];if(this.isFlushing)return[3,9];this.isFlushing=!0,s.label=1;case 1:return s.trys.push([1,4,8,9]),n=c([],a(e),!1).slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),i=new no({deviceId:this.deviceId,statLogs:n}),[4,this.requestQueue.send(i)];case 2:return s.sent(),this.queue=c([],a(e),!1).slice(n.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=$s,this.logInfo.lastFlushedAt=Date.now(),[4,this._save()];case 3:return s.sent(),[3,9];case 4:return(r=s.sent())instanceof m?r.code!==u.NON_AUTHORIZED?[3,6]:[4,this.clear()]:[3,7];case 5:return s.sent(),this.enabledState=zs.DISABLED,[3,7];case 6:r.code===u.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=zs.COLLECT_ONLY),s.label=7;case 7:return this.limit=this.limit+20,t=!1,[3,9];case 8:return this.isFlushing=!1,[7];case 9:return[3,11];case 10:this.isFlushing=!1,s.label=11;case 11:return[2,t]}}))}))},n}(eo),ro=function(e){function i(t){var n=t.deviceId,i=t.cacheContext,r=t.requestQueue;return e.call(this,{deviceId:n,cacheContext:i,requestQueue:r})||this}return t(i,e),i.prototype._isSendable=function(e){if(void 0===e&&(e=!1),this.queue.length<this.statConfig.lowerThreshold)return!1;if(e){if(Date.now()-this.logInfo.lastFlushedAt<this.statConfig.minInterval)return!1}else if(this.queue.length<this.statConfig.minStatCount)return!1;return!0},i.prototype._filterQueueByType=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){return[2,t?e.filter((function(e){return e.type!==He.FEATURE_LOCALCACHE_EVENT})):e.filter((function(e){return e.type===He.FEATURE_LOCALCACHE_EVENT}))]}))}))},i.prototype.init=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,e.prototype.init.call(this,t+".default")];case 1:return i.sent(),this.queue=this.logInfo.statLogs.map((function(e){return e.data=n({message_init_policy:"",starting_point:0},e.data),new nt({type:e.stat_type,ts:e.ts,data:e.data})})),[2]}}))}))},i.prototype.setConfig=function(e,t){return r(this,void 0,void 0,(function(){var n,i,r,o;return s(this,(function(s){switch(s.label){case 0:return this.statConfig=e,this._mergeQueue(),t.requestStat||t.localCacheStat?(this.enabledState=t.enabledStat?zs.ENABLED:zs.COLLECT_ONLY,n=void 0,t.requestStat||(n=!1),t.localCacheStat||(n=!0),void 0===n?[3,3]:(i=this,[4,this._filterQueueByType(this.queue,n)])):[3,4];case 1:return i.queue=s.sent(),r=this,[4,this._filterQueueByType(this.flushWaitQueue,n)];case 2:r.flushWaitQueue=s.sent(),this._save(),s.label=3;case 3:return[3,6];case 4:return this.enabledState=zs.DISABLED,[4,this.clear()];case 5:s.sent(),s.label=6;case 6:return this.isEnabled&&this._isSendable(!0)?(o=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100),[4,Ds(o)]):[3,9];case 7:return s.sent(),[4,this._flush(this.queue)];case 8:s.sent(),s.label=9;case 9:return[2]}}))}))},i.prototype.put=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.enabledState===zs.DISABLED?[2,!0]:((t=this.enabledState===zs.PENDING||this.isFlushing?this.flushWaitQueue:this.queue).push(e),this.enabledState===zs.PENDING?[3,2]:[4,this._save()]);case 1:n.sent(),n.label=2;case 2:return this.isEnabled?(this._mergeQueue(),this._isSendable()?[4,this._flush(t)]:[3,4]):[3,4];case 3:return[2,n.sent()];case 4:return[2,!0]}}))}))},i.prototype._flush=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return s(this,(function(s){switch(s.label){case 0:if(t=!0,!(e.length>0))return[3,10];if(this.isFlushing)return[3,9];this.isFlushing=!0,s.label=1;case 1:return s.trys.push([1,4,8,9]),n=c([],a(e),!1).slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),i=new no({deviceId:this.deviceId,statLogs:n}),[4,this.requestQueue.send(i)];case 2:return s.sent(),this.queue=c([],a(e),!1).slice(n.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=$s,this.logInfo.lastFlushedAt=Date.now(),[4,this._save()];case 3:return s.sent(),[3,9];case 4:return(r=s.sent())instanceof m?r.code!==u.NON_AUTHORIZED?[3,6]:[4,this.clear()]:[3,7];case 5:return s.sent(),this.enabledState=zs.DISABLED,[3,7];case 6:r.code===u.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=zs.COLLECT_ONLY),s.label=7;case 7:return this.limit=this.limit+20,t=!1,[3,9];case 8:return this.isFlushing=!1,[7];case 9:return[3,11];case 10:this.isFlushing=!1,s.label=11;case 11:return[2,t]}}))}))},i}(eo),so=function(e){function n(t){var n=t.deviceId,i=t.statLogs,r=e.call(this)||this;return r.method=ae.POST,r.path="".concat(we),r.params={device_id:n,log_entries:i.map((function(e){return nt.payloadify(e)}))},r}return t(n,e),n}(Ve),oo=function(e){function i(t){var n=t.deviceId,i=t.cacheContext,r=t.requestQueue;return e.call(this,{deviceId:n,cacheContext:i,requestQueue:r})||this}return t(i,e),Object.defineProperty(i.prototype,"_isSendable",{get:function(){return this.queue.length>=this.statConfig.minStatCount&&this.queue.length>this.statConfig.lowerThreshold||this.logInfo.lastFlushedAt>0&&Date.now()-this.logInfo.lastFlushedAt>=this.statConfig.minInterval},enumerable:!1,configurable:!0}),i.prototype.init=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,e.prototype.init.call(this,t+".realtime")];case 1:return i.sent(),this.queue=this.logInfo.statLogs.map((function(e){var t;return e.data=se(n(n({},e.data),{message_id:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,notificationId:void 0})),new nt({type:e.stat_type,ts:e.ts,data:e.data})})),this._sentLogStats=this.queue.map((function(e){var t;return{channelUrl:e.data.channelUrl,messageId:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,action:e.data.action}})),[2]}}))}))},i.prototype.setConfig=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return this.statConfig=e,this._mergeQueue(),t.notificationStat?(this.enabledState=t.enabledStat?zs.ENABLED:zs.COLLECT_ONLY,[3,3]):[3,1];case 1:return this.enabledState=zs.DISABLED,[4,this.clear()];case 2:i.sent(),i.label=3;case 3:return this.isEnabled&&this._isSendable?(n=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100),[4,Ds(n)]):[3,6];case 4:return i.sent(),[4,this._flush(this.queue)];case 5:i.sent(),i.label=6;case 6:return[2]}}))}))},i.prototype.put=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.enabledState===zs.DISABLED?[2,!0]:(t=this.enabledState===zs.PENDING||this.isFlushing?this.flushWaitQueue:this.queue,this._isDuplicateStat(e)?[2,!0]:(t.push(e),this.enabledState===zs.PENDING?[3,2]:[4,this._save()]));case 1:n.sent(),n.label=2;case 2:return this.isEnabled?(this._mergeQueue(),this.isEnabled&&this._isSendable?[4,this._flush(t)]:[3,4]):[3,4];case 3:return[2,n.sent()];case 4:return[2,!0]}}))}))},i.prototype._flush=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return s(this,(function(s){switch(s.label){case 0:if(t=!0,!(e.length>0))return[3,10];if(this.isFlushing)return[3,9];this.isFlushing=!0,s.label=1;case 1:return s.trys.push([1,4,8,9]),n=c([],a(e),!1).slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),i=new so({deviceId:this.deviceId,statLogs:n}),[4,this.requestQueue.send(i)];case 2:return s.sent(),this.queue=c([],a(e),!1).slice(n.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=$s,this.logInfo.lastFlushedAt=Date.now(),[4,this._save()];case 3:return s.sent(),[3,9];case 4:return(r=s.sent())instanceof m?r.code!==u.NON_AUTHORIZED?[3,6]:[4,this.clear()]:[3,7];case 5:return s.sent(),this.enabledState=zs.DISABLED,[3,7];case 6:r.code===u.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=zs.COLLECT_ONLY),s.label=7;case 7:return this.limit=this.limit+20,t=!1,[3,9];case 8:return this.isFlushing=!1,[7];case 9:return[3,11];case 10:this.isFlushing=!1,s.label=11;case 11:return[2,t]}}))}))},i}(eo),ao=function(){function e(e){var t=e.cacheContext,n=e.requestQueue,i=e.dispatcher,r=e.logger;this._collectRequestStat=!0,this._collectFeatureLocalCacheStat=!0,this._collectionNotificationStat=!0,this._retryCount=0,this.deviceId=ee(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=i,this.logger=r,this._dailyStatCollector=new io({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue}),this._defaultStatCollector=new ro({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue}),this._notificationStatCollector=new oo({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue})}return e.prototype._migration=function(){return r(this,void 0,void 0,(function(){var e,t,i,r;return s(this,(function(s){switch(s.label){case 0:return[4,this.cacheContext.preference.get(this.key)];case 1:return(e=s.sent())?(t=[],e.statLogs.forEach((function(e){e.stat_type===He.FEATURE_LOCALCACHE&&t.push(new nt({type:e.stat_type,ts:e.ts,data:e.data}))})),[4,this.cacheContext.preference.set(this.key+".daily",{deviceId:e.deviceId,statLogs:t.map((function(e){return nt.payloadify(e)})),generation:e.generation,lastFlushedAt:e.lastFlushedAt})]):[3,6];case 2:return s.sent(),i=[],e.statLogs.forEach((function(e){e.stat_type!==He.FEATURE_LOCALCACHE&&e.stat_type!==He.NOTIFICATION&&(e.stat_type===He.FEATURE_LOCALCACHE_EVENT&&(e.data=n({message_init_policy:"",starting_point:0},e.data)),i.push(new nt({type:e.stat_type,ts:e.ts,data:e.data})))})),[4,this.cacheContext.preference.set(this.key+".default",{deviceId:e.deviceId,statLogs:i.map((function(e){return nt.payloadify(e)})),generation:e.generation,lastFlushedAt:e.lastFlushedAt})];case 3:return s.sent(),r=[],e.statLogs.forEach((function(e){var t;e.stat_type===He.NOTIFICATION&&(e.data=se(n(n({},e.data),{message_id:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,notificationId:void 0})),r.push(new nt({type:e.stat_type,ts:e.ts,data:e.data})))})),[4,this.cacheContext.preference.set(this.key+".realtime",{deviceId:e.deviceId,statLogs:r.map((function(e){return nt.payloadify(e)})),generation:e.generation,lastFlushedAt:e.lastFlushedAt})];case 4:return s.sent(),[4,this.cacheContext.preference.remove(this.key)];case 5:s.sent(),s.label=6;case 6:return[2]}}))}))},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return this.key=e,[4,this._migration()];case 1:return n.sent(),[4,this._dailyStatCollector.init(this.key)];case 2:return n.sent(),[4,this._defaultStatCollector.init(this.key)];case 3:return n.sent(),[4,this._notificationStatCollector.init(this.key)];case 4:return n.sent(),this.commandEventContext||(this.commandEventContext=this.dispatcher.on((function(e){return r(t,void 0,void 0,(function(){var t,n,i,r,o,a;return s(this,(function(s){return e instanceof Xe?(t=e.statLog,this.put(t)):e instanceof ms&&(n=e.request,i=e.features,r=e.options,o=e.statConfigInfo,this._retryCount=0,this._collectRequestStat=n,this._collectFeatureLocalCacheStat=null==i?void 0:i.localCache,this._collectionNotificationStat=null==i?void 0:i.notification,this._statConfig=o,this._dailyStatCollector.setConfig(this._statConfig.default,{localCacheStat:this._collectFeatureLocalCacheStat,enabledStat:r.ingestion}),this._defaultStatCollector.setConfig(this._statConfig.default,{requestStat:this._collectRequestStat,localCacheStat:this._collectFeatureLocalCacheStat,enabledStat:r.ingestion}),this._notificationStatCollector.setConfig(null!==(a=this._statConfig.realTime)&&void 0!==a?a:this._statConfig.default,{notificationStat:this._collectionNotificationStat,enabledStat:r.ingestion})),[2]}))}))}))),[2]}}))}))},e.prototype.put=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=!0,e instanceof to?this._collectFeatureLocalCacheStat?[4,this._dailyStatCollector.put(e)]:[3,2]:[3,3];case 1:t=n.sent(),n.label=2;case 2:return[3,13];case 3:switch(e.type){case He.API_RESULT:case He.WEBSOCKET_CONNECT:case He.WEBSOCKET_DISCONNECT:return[3,4];case He.FEATURE_LOCALCACHE:case He.FEATURE_LOCALCACHE_EVENT:return[3,7];case He.NOTIFICATION:return[3,10]}return[3,13];case 4:return this._collectRequestStat?[4,this._defaultStatCollector.put(e)]:[3,6];case 5:t=n.sent(),n.label=6;case 6:return[3,13];case 7:return this._collectFeatureLocalCacheStat?[4,this._defaultStatCollector.put(e)]:[3,9];case 8:t=n.sent(),n.label=9;case 9:return[3,13];case 10:return this._collectionNotificationStat?[4,this._notificationStatCollector.put(e)]:[3,12];case 11:t=n.sent(),n.label=12;case 12:return[3,13];case 13:return t?this._retryCount=0:(this._retryCount++,this._retryCount>20&&(this._dailyStatCollector.enabledState=zs.COLLECT_ONLY,this._defaultStatCollector.enabledState=zs.COLLECT_ONLY,this._notificationStatCollector.enabledState=zs.COLLECT_ONLY,this.logger.debug(m.statLogUploadLimitExceededError))),[2]}}))}))},e.prototype.close=function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)},e}(),co=function(){function e(e){var t=e.limit,n=void 0===t?5:t;this.workersByKey={},this.limit=n}return e.prototype.run=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return this.workersByKey[e]||(this.workersByKey[e]=[]),this.workersByKey[e].length<this.limit?(this.workersByKey[e].push(t),[4,t()]):[3,2];case 1:return n=i.sent(),this.workersByKey[e].pop(),[2,n];case 2:throw m.tooManyRequests}}))}))},e.prototype.clear=function(e){this.workersByKey[e]=[]},e}();!function(e){e.DELIVERY_RECEIPT="delivery_receipt",e.PUSH_ACKNOWLEDGEMENT="push_acknowledgement"}(Js||(Js={}));var uo,lo=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._pushAckedCache={},t}return t(n,e),n.prototype.isAcked=function(e,t){var n,i="".concat(e,"_").concat(t);return null!==(n=this._pushAckedCache[i])&&void 0!==n&&n},n.prototype.markAsAcked=function(e,t){var n="".concat(e,"_").concat(t);this._pushAckedCache[n]=!0},n.prototype.clear=function(){vo.of(this._iid).logger.debug("clear push acked cache"),this._pushAckedCache={}},n.prototype.parseData=function(e){var t,n,i,r,s=vo.of(this._iid).logger,o=e.sendbird;if("string"==typeof o)try{o=JSON.parse(o)}catch(e){throw s.info("push notification payload does not contain sendbird payload in JSON format."),m.malformedDataError}if(!o||"object"!=typeof o)throw s.info("push notification payload does not contain sendbird payload in JSON format."),m.malformedDataError;var a=null!==(t=o.push_tracking_id)&&void 0!==t?t:"",c=o.notification_message_id,u=o.notification_channel_key,l=o.notification_template_key,h=o.notification_event_deadline,d=null!==(n=o.session_key)&&void 0!==n?n:{},_=null!==(i=null==d?void 0:d.key)&&void 0!==i?i:"",f=null!==(r=null==d?void 0:d.topics)&&void 0!==r?r:[];if("string"!=typeof a||0===a.length)throw s.info("push tracking id is not available"),m.malformedDataError;if("string"!=typeof c||0===c.length)throw s.info("message id is not available"),m.malformedDataError;return{pushTrackingId:a,sessionKey:_,sessionTopics:f,messageId:c,channelKey:u,templateKey:l,notificationEventDeadline:h}},n}(rs),ho=function(e){this.name=e.name,this._custom=e.custom,this._usedByModerationEngine=e.used_by_moderation_engine},_o=function(e){function n(){var t=e.call(this)||this;return t.method=ae.GET,t.path=Oe,t}return t(n,e),n}(Ve),fo=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.reportCategories=n.categories,i}return t(n,e),n}(Ge),po=function(e){function n(t){var n=e.call(this,t)||this;return n._categories=[],n}return t(n,e),n.prototype.categories=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return 0!==this._categories.length?[3,2]:[4,this._fetchCategories()];case 1:e.sent(),e.label=2;case 2:return[2,this._categories]}}))}))},n.prototype._fetchCategories=function(){return r(this,void 0,void 0,(function(){var e,t,n,i,r;return s(this,(function(s){switch(s.label){case 0:return e=vo.of(this._iid).requestQueue,t=new _o,[4,e.send(t)];case 1:return n=s.sent(),(i=n.as(fo).reportCategories)&&(r=this._categories).push.apply(r,c([],a(i.map((function(e){return new ho(e)}))),!1)),[2]}}))}))},n}(rs),Eo=function(){function e(){this._enabledRequestDedup=!0,this._requestCache=new Map,this._requestDedupInterval=500}return Object.defineProperty(e.prototype,"requestDedupInterval",{set:function(e){this._requestDedupInterval=e,this._requestDedupInterval<=0?this._enabledRequestDedup=!1:e<50&&(this._requestDedupInterval=50)},enumerable:!1,configurable:!0}),e.prototype.normalizePath=function(e){return e.replace("/v3/sdk/","/v3/")},e.prototype._generateCacheKey=function(e){var t=e.path,n=e.time,i=e.params,r=this.normalizePath(t),s=i?Object.entries(i).sort((function(e,t){var n=a(e,1)[0],i=a(t,1)[0];return n.localeCompare(i)})).map((function(e){var t=a(e,2),n=t[0],i=t[1];return"".concat(n,"=").concat(JSON.stringify(i))})).join("&"):"",o=n?"_".concat(n):"";return"".concat(r,"?").concat(s).concat(o)},e.prototype.requestGetChannel=function(e,t,n,i){var r,s,c=this;if(void 0===i&&(i=!0),!this._enabledRequestDedup)return t();var u=Date.now(),l=this._generateCacheKey({path:e,params:n});if(i)try{for(var h=o(this._requestCache.entries()),d=h.next();!d.done;d=h.next()){var _=a(d.value,2),f=_[0],p=_[1];if(f.startsWith(l))if(u-p.requestTime<=this._requestDedupInterval)return p.pendingResponse?Promise.resolve(p.pendingResponse):p.promise}}catch(e){r={error:e}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(r)throw r.error}}var E=i?this._generateCacheKey({path:e,time:u,params:n}):l,g=t().then((function(e){var t=c._requestCache.get(E);return t&&(t.pendingResponse=e,t.responseTime=Date.now()),Promise.resolve(e)})).catch((function(e){return Promise.reject(e)})).finally((function(){setTimeout((function(){c._requestCache.delete(E)}),c._requestDedupInterval)})),v={requestTime:u,responseTime:null,promise:g,pendingResponse:null};return this._requestCache.set(E,v),g},e.prototype.updatePendingResponse=function(e,t){var i,r;try{for(var s=o(this._requestCache.entries()),c=s.next();!c.done;c=s.next()){var u=a(c.value,2),l=u[0],h=u[1];if(l.includes(e.url)&&h.pendingResponse&&h.responseTime<t){var d=h.pendingResponse.payload,_=e.constructor.payloadify(e,!0),f=n(n({},d),_);h.pendingResponse=new Ge(e._iid,f);break}}}catch(e){i={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}},e}(),go={},vo=function(){function e(e,t){var n,i,r,s,o,a,c,u,l;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!go[e]){go[e]=this;var d=null!==(n=t.options)&&void 0!==n?n:new L,_=this.sdkState={appId:t.appId,appVersion:null!==(i=t.appVersion)&&void 0!==i?i:"",appState:"foreground",userId:void 0,extensions:{},api:{host:null!==(r=t.apiHost)&&void 0!==r?r:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!==(s=t.websocketHost)&&void 0!==s?s:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new Is,responseTimeout:d.websocketResponseTimeout},sessionTokenRefreshTimeout:d.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var f=this.logger=t.logger;this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,"string"==typeof t.localCacheEnabled&&(t.localCacheEnabled="true"===t.localCacheEnabled);var p=this.cacheContext=new P({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(o=t.localCacheEnabled)&&void 0!==o&&o,localCacheConfig:null!==(a=t.localCacheConfig)&&void 0!==a?a:new F});this.debugMode=null!==(c=t.debugMode)&&void 0!==c&&c,this.maxSuperGroupChannelUnreadCount=h.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=d.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=d.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=d.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var E=this.dispatcher=new ie,g=new $;this.requestQueue=new Bs(e,{session:g,sdkState:_,dispatcher:E,logger:f,useFetchCompat:t.useFetchCompat}),this.pushNotificationAckManager=new lo(e),this.sessionManager=new Ys({_iid:e,session:g,cacheContext:p,sdkState:_,dispatcher:E,requestQueue:this.requestQueue,logger:f,pushNotificationAckManager:this.pushNotificationAckManager}),this.connectionManager=new Ss(e,{sdkState:_,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:E,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(u=t.disableWebSocketCloseEventHandling)&&void 0!==u&&u,logger:f}),this.statManager=new ao({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:this.dispatcher,logger:f}),this.appStateToggleEnabled=null===(l=t.appStateToggleEnabled)||void 0===l||l,this.messageBackgroundSyncThrottleController=new co({limit:5}),this.reportCategoryManager=new po(e),this.requestDeduplicator=new Eo}return go[e]}return e.of=function(e){if(go[e])return go[e];throw m.lostInstance},e.clear=function(e){go[e]&&delete go[e]},e.prototype.hasExtension=function(e){return this.sdkState.extensions&&this.sdkState.extensions[e]},e}(),mo=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,i=t.dispatcher,r=t.sessionManager,s=t.requestQueue,o=t.logger;t.onlineDetector;var a=t.cacheContext;this._iid=e,this._cacheContext=a,this._sdkState=n,this._dispatcher=i,this._sessionManager=r,this._requestQueue=s,this._logger=o},e}();!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",e.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",e.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",e.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",e.EVENT_CHANNEL_UNREAD="EVENT_CHANNEL_UNREAD",e.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",e.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",e.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",e.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",e.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",e.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",e.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",e.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",e.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",e.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",e.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",e.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",e.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",e.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",e.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",e.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",e.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",e.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",e.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",e.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",e.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",e.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",e.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",e.REQUEST_CHANNEL="REQUEST_CHANNEL",e.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",e.REFRESH_CHANNEL="REFRESH_CHANNEL",e.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",e.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",e.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_FEEDBACK_ADDED="EVENT_MESSAGE_FEEDBACK_ADDED",e.EVENT_MESSAGE_FEEDBACK_UPDATED="EVENT_MESSAGE_FEEDBACK_UPDATED",e.EVENT_MESSAGE_FEEDBACK_DELETED="EVENT_MESSAGE_FEEDBACK_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.EVENT_THREAD_INFO_UPDATED="EVENT_THREADINFO_UPDATED",e.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",e.EVENT_POLL_VOTED="EVENT_POLL_VOTED",e.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",e.EVENT_CHANNEL_CSAT_SUBMITTED="EVENT_CHANNEL_CSAT_SUBMITTED",e.EVENT_CHANNEL_CONVERSATION_HANDEDOFF="EVENT_CHANNEL_CONVERSATION_HANDEDOFF",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"}(uo||(uo={}));var yo,bo=n({},uo),To=function(e){return e.startsWith("EVENT_")||e.startsWith("LOCAL_MESSAGE_")||e===uo.SYNC_MESSAGE_FILL||e===uo.SYNC_MESSAGE_CHANGELOGS||e===uo.SYNC_POLL_CHANGELOGS},Co=function(e){function n(t){var n=t.messages,i=t.source,r=t.isWebSocketEventComing,s=void 0!==r&&r,o=e.call(this)||this;return o.messages=n,o.source=i,o.isWebSocketEventComing=s,o}return t(n,e),n}(re),wo=function(e){function n(t){var n=t.messageIds,i=t.source,r=t.isWebSocketEventComing,s=void 0!==r&&r,o=e.call(this)||this;return o.messageIds=n,o.source=i,o.isWebSocketEventComing=s,o}return t(n,e),n}(re),So=function(e){function n(t){var n=t.messageDeletionTimestamp,i=t.channelUrl,r=t.source,s=e.call(this)||this;return s.messageDeletionTimestamp=n,s.channelUrl=i,s.source=r,s}return t(n,e),n}(re),No=function(e){function n(t){var n=t.event,i=t.source,r=t.isWebSocketEventComing,s=void 0!==r&&r,o=e.call(this)||this;return o.event=n,o.source=i,o.isWebSocketEventComing=s,o}return t(n,e),n}(re),Ao=function(e){function n(t){var n=t.event,i=t.source,r=t.isWebSocketEventComing,s=void 0!==r&&r,o=e.call(this)||this;return o.event=n,o.source=i,o.isWebSocketEventComing=s,o}return t(n,e),n}(re),Do=function(e){function n(t){var n=t.reqId,i=t.source,r=e.call(this)||this;return r.reqId=n,r.source=i,r}return t(n,e),n}(re),Io=function(e){function n(t){var n=t.polls,i=t.source,r=e.call(this)||this;return r.polls=n,r.source=i,r}return t(n,e),n}(re),Oo=function(e){function n(t){var n=t.event,i=t.source,r=e.call(this)||this;return r.event=n,r.source=i,r}return t(n,e),n}(re),ko=function(e){function n(t){var n=t.event,i=t.source,r=e.call(this)||this;return r.event=n,r.source=i,r}return t(n,e),n}(re);!function(e){e.OPEN="open",e.CLOSED="closed"}(yo||(yo={}));var Ro="removed",Lo=function(e){switch(e){case"open":return yo.OPEN;case"closed":return yo.CLOSED;default:return null}},xo=function(e){return!e||!!e.text&&C("string",e.text)},Uo=function(e){function i(t,n){var i,r,s,o,a,c,u,l=this;return(l=e.call(this,t)||this).pollId=0,l.id=0,l.text=null,l.voteCount=0,l.createdBy=null,l.createdAt=0,l.updatedAt=0,l._lastVotedAt=0,l.pollId=null!==(i=n.poll_id)&&void 0!==i?i:0,l.id=null!==(r=n.id)&&void 0!==r?r:0,l.text=null!==(s=n.text)&&void 0!==s?s:null,l.voteCount=null!==(o=n.vote_count)&&void 0!==o?o:0,l.createdBy=null!==(a=n.created_by)&&void 0!==a?a:null,l.createdAt=null!==(c=n.created_at)&&void 0!==c?c:0,l.updatedAt=null!==(u=n.updated_at)&&void 0!==u?u:0,l}return t(i,e),i.payloadify=function(t){return se(oe(n(n({},e.payloadify.call(this,t)),{vote_count:t.voteCount,poll_id:t.pollId,text:t.text,created_at:t.createdAt,id:t.id,created_by:t.createdBy,updated_at:t.updatedAt})))},i}(rs),Po=function(e){function i(t,n){var i,r,s,o,a,c,u,l,h,d,_,f,p,E=this;return(E=e.call(this,t)||this).id=0,E.title=null,E.createdAt=0,E.updatedAt=0,E.closeAt=-1,E.status=yo.CLOSED,E.messageId=0,E.data=null,E.voterCount=-1,E.options=[],E.createdBy=null,E.allowUserSuggestion=!1,E.allowMultipleVotes=!1,E.votedPollOptionIds=[],E.id=null!==(i=n.id)&&void 0!==i?i:0,E.title=null!==(r=n.title)&&void 0!==r?r:null,E.createdAt=null!==(s=n.created_at)&&void 0!==s?s:0,E.updatedAt=null!==(o=n.updated_at)&&void 0!==o?o:0,E.closeAt=null!==(a=n.close_at)&&void 0!==a?a:-1,E.status=null!==(c=Lo(n.status))&&void 0!==c?c:yo.CLOSED,E.messageId=null!==(u=n.message_id)&&void 0!==u?u:0,E.data=null!==(l=n.data)&&void 0!==l?l:null,E.voterCount=null!==(h=n.voter_count)&&void 0!==h?h:-1,E.options=n.options?n.options.map((function(e){return new Uo(E._iid,e)})):[],E.createdBy=null!==(d=n.created_by)&&void 0!==d?d:null,E.allowUserSuggestion=null!==(_=n.allow_user_suggestion)&&void 0!==_&&_,E.allowMultipleVotes=null!==(f=n.allow_multiple_votes)&&void 0!==f&&f,E.votedPollOptionIds=null!==(p=n.voted_option_ids)&&void 0!==p?p:[],E}return t(i,e),i.prototype._applyPollUpdatePayload=function(e){var t,n,i,r,s,o,a,c,u=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(i=e.close_at)&&void 0!==i?i:this.closeAt,this.status=null!==(r=Lo(e.status))&&void 0!==r?r:this.status,this.data=null!==(s=e.data)&&void 0!==s?s:this.data,this.voterCount=null!==(o=e.voter_count)&&void 0!==o?o:this.voterCount,e.options&&(this.options=e.options.map((function(e){return new Uo(u._iid,e)})),this.votedPollOptionIds=e.options.filter((function(e){return e.vote_count>0})).map((function(e){return e.id}))),this.allowUserSuggestion=null!==(a=e.allow_user_suggestion)&&void 0!==a?a:this.allowUserSuggestion,this.allowMultipleVotes=null!==(c=e.allow_multiple_votes)&&void 0!==c?c:this.allowMultipleVotes},i.payloadify=function(t){return se(oe(n(n({},e.payloadify.call(this,t)),{id:t.id,title:t.title,created_at:t.createdAt,updated_at:t.updatedAt,close_at:t.closeAt,status:t.status,message_id:t.messageId,data:t.data,voter_count:t.voterCount,options:t.options.map((function(e){return Uo.payloadify(e)})),created_by:t.createdBy,allow_user_suggestion:t.allowUserSuggestion,allow_multiple_votes:t.allowMultipleVotes,voted_option_ids:t.votedPollOptionIds})))},i.prototype.applyPollUpdateEvent=function(e){var t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)},i.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var t=this.options,n=t.map((function(e){return e.id})),i=e._payload,r=Math.floor(i.ts/1e3);return i.updated_vote_counts.forEach((function(e){var i=n.indexOf(e.option_id);if(i>-1){var s=t[i];r>=s._lastVotedAt&&(s.voteCount=e.vote_count,s._lastVotedAt=r)}})),i.req_id&&i.voted_option_ids&&(this.votedPollOptionIds=i.voted_option_ids),"number"==typeof i.voter_count&&(this.voterCount=i.voter_count),!0},i.prototype.serialize=function(){return ds(this)},i}(rs),Mo=function(){function e(e,t){var n;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return C("number",this.limit)&&this.limit>0},e}(),qo=function(e){function n(t,n,i,r){var s=e.call(this,t,r)||this;return s.channelUrl=n,s.channelType=i,s}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&C("string",this.channelUrl)&&w(H,this.channelType)},n}(Mo),Fo=function(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e},Ho=function(e){function n(t){var n=t.title,i=t.optionTexts,r=t.data,s=t.allowUserSuggestion,o=t.allowMultipleVotes,a=t.closeAt,c=e.call(this)||this;return c.method=ae.POST,c.path=ye,c.params={title:n,options:i,data:r,allow_user_suggestion:s,allow_multiple_votes:o,close_at:a},c}return t(n,e),n}(Ve),Vo=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.poll=new Po(t,n),i}return t(n,e),n}(Ge),Go=function(e){function n(t){var n=t.channelUrl,i=t.channelType,r=t.pollId,s=e.call(this)||this;return s.method=ae.GET,s.path="".concat(ye,"/").concat(encodeURIComponent(r)),s.params={channel_url:n,channel_type:i},s}return t(n,e),n}(Ve),zo=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.poll=new Po(t,n),i}return t(n,e),n}(Ge),jo=function(e){function n(t){var n=t.channelUrl,i=t.channelType,r=t.pollId,s=t.pollOptionId,o=e.call(this)||this;return o.method=ae.GET,o.path="".concat(ye,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(s)),o.params={channel_url:n,channel_type:i},o}return t(n,e),n}(Ve),Ko=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.pollOption=new Uo(t,n),i}return t(n,e),n}(Ge),Bo=function(e){function n(t){var n=t.channelType,i=t.channelUrl,r=t.timestamp,s=t.token,o=e.call(this)||this;return o.method=ae.GET,o.path="".concat(Ue(n),"/").concat(encodeURIComponent(i),"/polls/changelogs"),o.params=se({change_ts:r,token:s}),o}return t(n,e),n}(Ve),Qo=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.updatedPolls=n.updated.map((function(e){return function(e,t){return new Po(e,t)}(t,e)})),i.deletedPollIds=n.deleted.map((function(e){return e})),i.hasMore=n.has_more,i.nextToken=n.next,i}return t(n,e),n}(Ge),Wo={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},Zo=function(e){return C("string",e.title)&&(t=e.optionTexts,N("string",t)&&t.every((function(e){return""!==e.trim()})))&&xo(e.data)&&C("boolean",e.allowUserSuggestion,!0)&&C("boolean",e.allowMultipleVotes,!0)&&C("number",e.closeAt,!0);var t},Yo={channelUrl:"",channelType:H.BASE,pollId:0,pollOptionId:0},Xo=function(e){return C("string",e.channelUrl)&&""!==e.channelUrl&&w(H,e.channelType)&&C("number",e.pollId)&&e.pollId>0&&C("number",e.pollOptionId)&&e.pollOptionId>0},Jo={channelUrl:"",channelType:H.BASE,pollId:0},$o=function(e){return C("string",e.channelUrl)&&""!==e.channelUrl&&w(H,e.channelType)&&C("number",e.pollId)},ea={},ta=function(){function e(e,t){var n=t.sdkState,i=t.dispatcher,r=t.sessionManager,s=t.requestQueue,o=t.logger;this._iid=e,this._sdkState=n,this._sessionManager=r,this._requestQueue=s,this._dispatcher=i,this._logger=o,ea[e]=this}return e.of=function(e){return ea[e]},e.prototype.buildPollFromSerializedData=function(e){var t=_s(e);return new Po(this._iid,Po.payloadify(t))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t,i;return s(this,(function(r){switch(r.label){case 0:return fs($o(e)).throw(m.invalidParameters),t=new Go(n({},e)),[4,this._requestQueue.send(t)];case 1:return i=r.sent(),[2,i.as(zo).poll]}}))}))},e.prototype.create=function(e){return r(this,void 0,void 0,(function(){var t,i;return s(this,(function(r){switch(r.label){case 0:return fs(Zo(e)).throw(m.invalidParameters),t=new Ho(n({},e)),[4,this._requestQueue.send(t)];case 1:return i=r.sent(),[2,i.as(Vo).poll]}}))}))},e.prototype.getOption=function(e){return r(this,void 0,void 0,(function(){var t,i;return s(this,(function(r){switch(r.label){case 0:return fs(Xo(e)).throw(m.invalidParameters),t=new jo(n({},e)),[4,this._requestQueue.send(t)];case 1:return i=r.sent(),[2,i.as(Ko).pollOption]}}))}))},e.prototype.getPollChangeLogs=function(e,t,n,i){return void 0===i&&(i=uo.SYNC_POLL_CHANGELOGS),r(this,void 0,void 0,(function(){var r,o,a,c,u,l,h;return s(this,(function(s){switch(s.label){case 0:return r=new Bo(oe({channelType:t,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null})),[4,this._requestQueue.send(r)];case 1:return o=s.sent(),a=o.as(Qo),c=a.updatedPolls,u=a.deletedPollIds,l=a.hasMore,h=a.nextToken,c.length>0&&this._dispatcher.dispatch(new Io({polls:c,source:i})),[2,{updatedPolls:c,deletedPollIds:u,hasMore:l,token:h}]}}))}))},e}(),na=function(e){function n(t){var n=t.channelUrl,i=t.channelType,r=t.token,s=t.limit,o=e.call(this)||this;return o.method=ae.GET,o.path=ye,o.params={channel_url:n,channel_type:i,token:r,limit:s},o}return t(n,e),n}(Ve),ia=function(e){function n(t,n){var i,r=this;return(r=e.call(this,t,n)||this).polls=(null!==(i=n.polls)&&void 0!==i?i:[]).map((function(e){return new Po(t,e)})),r.token=n.next,r}return t(n,e),n}(Ge),ra=function(e){function i(t,n){return e.call(this,t,n.channelUrl,n.channelType,n)||this}return t(i,e),i.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,i,r,o,a;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=vo.of(this._iid).requestQueue,t=new na(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return i=s.sent(),r=i.as(ia),o=r.polls,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw m.queryInProgress;case 4:return[3,6];case 5:throw m.invalidParameters;case 6:return[2]}}))}))},i}(qo),sa=function(e){function n(t){var n=t.channelUrl,i=t.channelType,r=t.pollId,s=t.pollOptionId,o=t.token,a=t.limit,c=e.call(this)||this;return c.method=ae.GET,c.path="".concat(ye,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(s),"/voters"),c.params={channel_url:n,channel_type:i,token:o,limit:a},c}return t(n,e),n}(Ve),oa=function(e){function n(t,n){var i,r=this;return(r=e.call(this,t,n)||this).voters=(null!==(i=n.voters)&&void 0!==i?i:[]).map((function(e){return new Es(t,e)})),r.token=n.next,r}return t(n,e),n}(Ge),aa=function(e){function i(t,n){var i=e.call(this,t,n.channelUrl,n.channelType,n)||this;return i.pollId=n.pollId,i.pollOptionId=n.pollOptionId,i}return t(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)&&C("number",this.pollId)&&C("number",this.pollOptionId)},i.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,i,r,o,a;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=vo.of(this._iid).requestQueue,t=new sa(n(n({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return i=s.sent(),r=i.as(oa),o=r.voters,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw m.queryInProgress;case 4:return[3,6];case 5:throw m.invalidParameters;case 6:return[2]}}))}))},i}(qo);export{st as $,ae as A,He as B,H as C,u as D,ne as E,fs as F,ra as G,aa as H,_s as I,xr as J,Gr as K,F as L,Pr as M,Lr as N,qr as O,f as P,gs as Q,vs as R,L as S,Qr as T,Es as U,vo as V,Ke as W,ys as X,is as Y,je as Z,r as _,C as a,So as a$,v as a0,N as a1,M as a2,d as a3,w as a4,tt as a5,Js as a6,_ as a7,E as a8,ns as a9,X as aA,W as aB,Me as aC,ct as aD,Ds as aE,at as aF,Q as aG,de as aH,dt as aI,qo as aJ,Pe as aK,ge as aL,qe as aM,K as aN,xo as aO,ye as aP,Fo as aQ,ts as aR,I as aS,ut as aT,ko as aU,ta as aV,Mo as aW,x as aX,i as aY,No as aZ,Ao as a_,uo as aa,q as ab,g as ac,Vr as ad,Br as ae,ho as af,V as ag,Wr as ah,Hr as ai,hs as aj,$e as ak,et as al,he as am,rs as an,T as ao,z as ap,ds as aq,B as ar,Be as as,Ue as at,Ie as au,Po as av,Co as aw,Z as ax,D as ay,j as az,s as b,Oo as b0,Io as b1,Do as b2,wo as b3,Ae as b4,J as b5,Ee as b6,mo as b7,Y as b8,Wo as b9,xe as bA,Jr as bB,Qe as bC,Je as bD,Zo as ba,Jo as bb,$o as bc,Yo as bd,Xo as be,Uo as bf,yo as bg,re as bh,k as bi,_e as bj,be as bk,A as bl,G as bm,lt as bn,Ro as bo,To as bp,Os as bq,to as br,Le as bs,Re as bt,bo as bu,Lo as bv,pe as bw,fe as bx,Se as by,Ne as bz,t as c,ke as d,se as e,Ve as f,Ge as g,ue as h,O as i,n as j,me as k,ve as l,Te as m,De as n,ee as o,it as p,c as q,a as r,Or as s,m as t,oe as u,l as v,o as w,p as x,Xe as y,nt as z};
