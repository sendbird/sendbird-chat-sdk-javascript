import{f as e,g as t,V as n,c as r,A as i,am as s,h as a,j as o,d as u,U as l,an as c,a1 as d,a as h,a4 as f,q as p,r as m,w as v,ag as _,ao as y,ap as g,aq as b,C as I,ar as E,as as w,at as T,W as M,au as S,_ as U,b as A,av as N,aa as C,t as O,aw as k,ax as P,ay as R,F as x,az as D,aA as L,aB as F,aC as q,K as z,M as B,D as j,aD as K,i as Q,aE as G,aF as V,aG as H,aH as W,aI as Y,aJ as J,aK as X,af as Z,aL as $,aM as ee,aN as te,aO as ne,aP as re,aQ as ie,u as se,N as ae,a0 as oe,aR as ue,G as le,H as ce,aS as de,aT as he,aU as fe,k as pe,aV as me,aW as ve,aX as _e,aY as ye,aZ as ge,a_ as be,J as Ie,a$ as Ee,b0 as we,b1 as Te,b2 as Me,b3 as Se,b4 as Ue,I as Ae,b5 as Ne,b6 as Ce}from"./__bundle-1ec1132d.js";var Oe,ke=function(){function r(e,t,n){var r,i;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this._requireAuth=!1,this._iid=e,this.plainUrl=t.url,this.width=t.width,this.height=t.height,this.realWidth=null!==(r=t.real_width)&&void 0!==r?r:t.width,this.realHeight=null!==(i=t.real_height)&&void 0!==i?i:t.height,this._requireAuth=n}return r.payloadify=function(n){return e(t(n instanceof r?{url:n.plainUrl,width:n.width,height:n.height,real_width:n.realWidth,real_height:n.realHeight}:{url:"",width:n.maxWidth,height:n.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(r.prototype,"url",{get:function(){var e=n.of(this._iid).sessionManager;return this._requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),r}(),Pe=function(t){function n(n){var r=t.call(this)||this;if(r.method=i.POST,r.path="".concat(s),r.params=e({file:n.file,channel_url:n.channelUrl}),n.thumbnailSizes)for(var a=0;a<n.thumbnailSizes.length;a++){var o=n.thumbnailSizes[a],u=o.maxWidth,l=o.maxHeight;r.params["thumbnail".concat(a+1)]="".concat(u,",").concat(l)}return r.requestId=n.requestId,r}return r(n,t),n}(a),Re=function(e){function t(t,n){var r,i,s,a,o=this;return(o=e.call(this,t,n)||this).url=n.url,o.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,o.thumbnails=null!==(s=null===(i=n.thumbnails)||void 0===i?void 0:i.map((function(e){return new ke(t,e,!1)})))&&void 0!==s?s:[],o.requireAuth=null!==(a=n.require_auth)&&void 0!==a&&a,o}return r(t,e),t}(o),xe=function(n){function i(e,t){var r,i,s,a,o,u=this;return(u=n.call(this,e)||this).replyCount=0,u.memberCount=0,u.lastRepliedAt=0,u.updatedAt=0,u.replyCount=null!==(r=t.reply_count)&&void 0!==r?r:0,u.memberCount=null!==(i=t.member_count)&&void 0!==i?i:0,u.mostRepliedUsers=t.most_replies&&d("object",t.most_replies)?t.most_replies.map((function(e){return new l(u._iid,e)})):[],u.unreadReplyCount=null!==(s=t.unread_message_count)&&void 0!==s?s:0,u.isPushNotificationEnabled="number"==typeof t.push_enabled?t.push_enabled>0:void 0,u.lastRepliedAt=null!==(a=t.last_replied_at)&&void 0!==a?a:0,u.updatedAt=null!==(o=t.updated_at)&&void 0!==o?o:0,u}return r(i,n),i.payloadify=function(r){return e(t(u(u({},n.payloadify.call(this,r)),{reply_count:r.replyCount,unread_message_count:r.unreadReplyCount,member_count:r.memberCount,most_replies:Array.isArray(r.mostRepliedUsers)?r.mostRepliedUsers.map((function(e){return l.payloadify(e)})):[],push_enabled:"boolean"==typeof r.isPushNotificationEnabled?r.isPushNotificationEnabled?1:0:void 0,last_replied_at:r.lastRepliedAt,updated_at:r.updatedAt})))},Object.defineProperty(i.prototype,"_isUpdateRequired",{get:function(){return void 0===this.unreadReplyCount||void 0===this.isPushNotificationEnabled},enumerable:!1,configurable:!0}),i.prototype._updateFrom=function(e){var t,n;this.unreadReplyCount=null!==(t=e.unreadReplyCount)&&void 0!==t?t:this.unreadReplyCount,this.isPushNotificationEnabled=null!==(n=e.isPushNotificationEnabled)&&void 0!==n?n:this.isPushNotificationEnabled},i}(c);!function(e){e.ADD="add",e.DELETE="delete"}(Oe||(Oe={}));var De=function(e){var t;this.messageId=0,this.operation=null,this.updatedAt=0;var n=h("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,r=e.user_id,i=e.operation?e.operation.toLowerCase():null,s=e.reaction,a=e.updated_at,o=e.count,u=e.sampled_user_ids,l=null!==(t=e.sampled_user_info)&&void 0!==t?t:{};n&&h("string",r)&&h("string",i)&&f(Oe,i)&&h("string",s)&&s&&h("number",a)&&(this.messageId=n,this.userId=r,this.key=s,this.operation=i,this.updatedAt=a,this._count=o,this._sampledUserIds=u,this._sampledUserInfoList=l)},Le=function(e){function t(t,n,r){var i,s=this;return(s=e.call(this,t)||this).userId=n,s.nickname=r.nickname,s.plainProfileUrl=r.profile_url,s.requireAuth=null!==(i=r.require_auth_for_profile_image)&&void 0!==i&&i,s}return r(t,e),Object.defineProperty(t.prototype,"profileUrl",{get:function(){var e=n.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),t.payloadify=function(e){return{nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth}},t}(c),Fe=function(i){function s(e,t){var r,s,a,o,u,l,c,f,_,y=this;(y=i.call(this,e)||this)._sampledUserInfoList=[],y._count=0,y._hasCurrentUserReacted=!1;var g=t.key,b=p([],m(null!==(o=null!==(a=t.sampled_user_ids)&&void 0!==a?a:t.user_ids)&&void 0!==o?o:[]),!1),I=null!==(l=null!==(u=t.last_ts)&&void 0!==u?u:t.updated_at)&&void 0!==l?l:0,E=null!==(c=t.is_self_included)&&void 0!==c?c:b.includes(n.of(e).sdkState.userId),w=null!==(f=t.sampled_user_info)&&void 0!==f?f:{};h("string",g)&&g&&d("string",b)&&b.length>0&&h("number",I)&&(y.key=g,y._sampledUserIds=b,y._updatedAt=I,y._count=null!==(_=t.count)&&void 0!==_?_:b.length,y._hasCurrentUserReacted=E,Object.keys(w).forEach((function(t){y._sampledUserInfoList.push(new Le(e,t,w[t]))})));var T={};try{for(var M=v(y.sampledUserIds),S=M.next();!S.done;S=M.next()){T[S.value]=y.updatedAt}}catch(e){r={error:e}}finally{try{S&&!S.done&&(s=M.return)&&s.call(M)}finally{if(r)throw r.error}}return y._version=T,y}return r(s,i),Object.defineProperty(s.prototype,"isEmpty",{get:function(){return 0===this._count},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"userIds",{get:function(){return this._sampledUserIds},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"sampledUserIds",{get:function(){return this._sampledUserIds},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"sampledUserInfoList",{get:function(){return this._sampledUserInfoList},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"updatedAt",{get:function(){return this._updatedAt},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"hasCurrentUserReacted",{get:function(){return this._hasCurrentUserReacted},enumerable:!1,configurable:!0}),s.payloadify=function(n){var r={};return n._sampledUserInfoList.forEach((function(e){r[e.userId]=Le.payloadify(e)})),e(t({key:n.key,sampled_user_ids:n._sampledUserIds,sampled_user_info:r,count:n._count,is_self_included:n._hasCurrentUserReacted,last_ts:n._updatedAt}))},s.prototype.applyEvent=function(e){var t=this;if(e.key===this.key&&this.updatedAt<=e.updatedAt)if(e._sampledUserIds)this._sampledUserIds=e._sampledUserIds,this._sampledUserInfoList=[],Object.keys(e._sampledUserInfoList).forEach((function(n){t._sampledUserInfoList.push(new Le(t._iid,n,e._sampledUserInfoList[n]))})),this._count=e._count,void 0!==e._hasCurrentUserReacted&&(this._hasCurrentUserReacted=e._hasCurrentUserReacted),this._updatedAt=e.updatedAt;else{if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var n=this._sampledUserIds.indexOf(e.userId);switch(e.operation){case Oe.ADD:n<0&&this._sampledUserIds.push(e.userId);break;case Oe.DELETE:n>=0&&this._sampledUserIds.splice(n,1)}this._count=this._sampledUserIds.length,this._version[e.userId]=e.updatedAt}this._updatedAt=Math.max(this.updatedAt,e.updatedAt)}},s}(c),qe=function(){function n(e){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.secure_url&&(this.secureUrl=e.secure_url),e.type&&(this.type=e.type),e.width&&(this.width=e.width),e.height&&(this.height=e.height),e.alt&&(this.alt=e.alt)}return n.payloadify=function(n){var r,i;return e(t({url:n.url,secure_url:n.secureUrl,type:n.type,width:null!==(r=n.width)&&void 0!==r?r:0,height:null!==(i=n.height)&&void 0!==i?i:0,alt:n.alt}))},n}(),ze=function(){function n(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e["og:title"]&&(this.title=e["og:title"]),e["og:url"]&&(this.url=e["og:url"]),e["og:description"]&&(this.description=e["og:description"]),e["og:image"]&&(this.defaultImage=new qe(e["og:image"]))}return n.payloadify=function(n){return e(t({"og:title":n.title,"og:url":n.url,"og:description":n.description,"og:image":n.defaultImage?qe.payloadify(n.defaultImage):null}))},n}(),Be=function(){function n(e){var t,n;this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return n.prototype.serialize=function(){return{name:this.name,volume:this.volume}},n.payloadify=function(n){return e(t({name:n.name,volume:n.volume}))},n}(),je=function(n){function i(e,t){var r,i=this;return(i=n.call(this,e,t)||this).isBlockedByMe=!1,i.role=f(_,t.role)?t.role:_.NONE,i.isBlockedByMe=null!==(r=t.is_blocked_by_me)&&void 0!==r&&r,i}return r(i,n),i.payloadify=function(r){return e(t(u(u({},n.payloadify.call(this,r)),{role:r.role,is_blocked_by_me:r.isBlockedByMe})))},i}(l),Ke=function(){function n(e){this.key=e.key,this.value=d("string",e.value)?p([],m(e.value),!1):[]}return n.payloadify=function(n){var r;return e(t({key:n.key,value:null!==(r=n.value)&&void 0!==r?r:[]}))},n}(),Qe=function(e){switch(e){case g.BASE:return"";case g.USER:return"MESG";case g.FILE:return"FILE";case g.ADMIN:return"ADMM"}},Ge=function(n){function i(e,t){var r,i,s,a,o,u,c,d,h,p=this;(p=n.call(this,e)||this).channelType=I.BASE,p.messageType=g.BASE,p.mentionType=null,p.mentionedUsers=null,p.mentionedUserIds=null,p.metaArrays=[],p.extendedMessage={},p.createdAt=0,p.updatedAt=0,p.channelUrl=t.channel_url,p.channelType=f(I,t.channel_type)?t.channel_type:I.GROUP,t.channel&&(t.channel.channel_url&&(p.channelUrl=t.channel.channel_url),t.channel.channel_type&&(p.channelType=t.channel.channel_type)),p.data=null!==(r=t.data)&&void 0!==r?r:"",p.customType=null!==(i=t.custom_type)&&void 0!==i?i:"",p.mentionType=f(E,t.mention_type)?t.mention_type:null,p.mentionedUsers=t.mentioned_users?t.mentioned_users.map((function(e){return new l(p._iid,e)})):null,p.mentionedUserIds=null!==(s=t.mentioned_user_ids)&&void 0!==s?s:null,p.mentionedUsers&&!p.mentionedUserIds&&(p.mentionedUserIds=p.mentionedUsers.map((function(e){return e.userId})));var m=null!==(a=t.metaarray)&&void 0!==a?a:{},v=null!==(o=t.metaarray_key_order)&&void 0!==o?o:Object.keys(m).sort((function(e,t){return e.localeCompare(t)}));p.metaArrays=[];for(var _=0;_<v.length;_++){var y=v[_];p.metaArrays.push(new Ke({key:y,value:m[y]||[]}))}return t.sorted_metaarray&&(p.metaArrays=t.sorted_metaarray.map((function(e){return new Ke(e)}))),p.extendedMessage=null!==(u=t.extended_message)&&void 0!==u?u:{},p.extendedMessagePayload=t.extended_message_payload,p.createdAt=null!==(d=null!==(c=t.created_at)&&void 0!==c?c:t.ts)&&void 0!==d?d:0,p.updatedAt=null!==(h=t.updated_at)&&void 0!==h?h:0,p}return r(i,n),i.payloadify=function(r){var i,s;return e(t(u(u({},n.payloadify.call(this,r)),{channel_url:r.channelUrl,channel_type:r.channelType,type:Qe(r.messageType),data:r.data,custom_type:r.customType,mention_type:r.mentionType,mentioned_user_ids:r.mentionedUserIds,mentioned_users:null===(i=r.mentionedUsers)||void 0===i?void 0:i.map((function(e){return l.payloadify(e)})),sorted_metaarray:null===(s=r.metaArrays)||void 0===s?void 0:s.map((function(e){return Ke.payloadify(e)})),extended_message:r.extendedMessage,extended_message_payload:r.extendedMessagePayload,created_at:r.createdAt,updated_at:r.updatedAt})))},i.prototype.isIdentical=function(e){return!0},i.prototype.isEqual=function(e){return y(this,e)},i.prototype.isUserMessage=function(){return this.messageType===g.USER},i.prototype.isFileMessage=function(){return this.messageType===g.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},i.prototype.isMultipleFilesMessage=function(){return this.messageType===g.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},i.prototype.isAdminMessage=function(){return this.messageType===g.ADMIN},i.prototype.serialize=function(){return b(this)},i.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},i}(c),Ve=function(e){function t(t,n){var r,i,s,a=this;return(a=e.call(this,t)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",a.channelType=null!==(i=n.channel_type)&&void 0!==i?i:I.GROUP,a.reader=new l(a._iid,n.user),a.readAt=n.ts,a.isExcluded=null!==(s=n.is_excluded)&&void 0!==s&&s,a}return r(t,e),t}(c),He=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return r(t,e),t}(w),We=function(n){function s(r){var s=n.call(this)||this,a=r.channelUrl,o=r.channelType,u=r.userId,l=r.notificationIds,c=r.messageId,d=r.isExcluded,h=r.uniqueId;return s.method=i.PUT,s.path="".concat(T(o),"/").concat(encodeURIComponent(a),"/messages/mark_as_read"),s.params=e(t({user_id:u,message_ids:l,message_id:c,is_excluded:d,unique_id:h})),s}return r(s,n),s}(a),Ye=function(e){function t(t,n,r){var i=e.call(this,t,"READ",r)||this;return i.readStatus=new Ve(t,r),i}return r(t,e),t}(M),Je=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.readAt=n.ts,r.unreadMessageCount=n.unread_message_count,r.totalUnreadCount=n.total_unread_count,r.channelUrl=n.channel_url,r.userId=n.user_id,r.isExcluded=n.is_excluded,r.uniqueId=n.unique_id,r}return r(t,e),t}(o),Xe=function(e){function t(t){var n=t.channelUrl,r=t.messageId;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n,parent_message_id:r}})||this}return r(t,e),t}(w),Ze=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,a=t.pushEnabled,o=e.call(this)||this;return o.method=i.PUT,o.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/thread_push"),o.params={push_enabled:a},o}return r(t,e),t}(a);!function(e){function t(t,n){return e.call(this,t,n)||this}r(t,e)}(o);var $e,et,tt=function(i){function s(e,t){var n,r,s,a,o,l=this;return(l=i.call(this,e)||this).plainUrl="",l.fileName=null,l.mimeType=null,l.fileSize=0,l.thumbnails=[],l._requireAuth=!1,l.plainUrl=null!==(n=t.url)&&void 0!==n?n:"",l.fileName=null!==(r=t.file_name)&&void 0!==r?r:null,l.mimeType=null!==(s=t.file_type)&&void 0!==s?s:null,l.fileSize=null!==(a=t.file_size)&&void 0!==a?a:0,l._requireAuth=null!==(o=t.require_auth)&&void 0!==o&&o,l.thumbnails=t.thumbnails?t.thumbnails.map((function(e){var t;return new ke(l._iid,"string"==typeof e?{url:e,width:0,height:0}:u(u({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),l._requireAuth)})):[],l}return r(s,i),s.payloadify=function(n){var r;return e(t({url:n.plainUrl,file_name:n.fileName,file_type:n.mimeType,file_size:n.fileSize,thumbnails:null===(r=n.thumbnails)||void 0===r?void 0:r.map((function(e){var t;return{url:(null!==(t=e.plainUrl)&&void 0!==t?t:"").split("auth=")[0],width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),require_auth:n._requireAuth}))},Object.defineProperty(s.prototype,"url",{get:function(){var e=n.of(this._iid).sessionManager;return this._requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),s}(c),nt=function(e){var t=e.channelUrl,n=e.channelType,r=e.parentMessage;this.channelUrl=t,this.channelType=n,this.parentMessage=r};!function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled"}($e||($e={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(et||(et={}));var rt,it=function(i){function s(e,t){var n,r,s,a,o,u,l,c,d,h=this;return(h=i.call(this,e,t)||this).parentMessage=null,h.silent=!1,h.isOperatorMessage=!1,h.threadInfo=null,h.reactions=[],h.appleCriticalAlertOptions=null,h.scheduledInfo=null,h.suggestedReplies=null,h.myFeedback=null,h.myFeedbackStatus="NOT_APPLICABLE",h.messageForm=null,h._isContinuousMessages=!1,h._scheduledStatus=null,h._poll=null,h.messageId=null!==(r=null!==(n=t.msg_id)&&void 0!==n?n:t.message_id)&&void 0!==r?r:0,h.parentMessageId=null!==(s="string"==typeof t.parent_message_id?parseInt(t.parent_message_id):t.parent_message_id)&&void 0!==s?s:0,h.threadInfo=t.thread_info?new xe(h._iid,t.thread_info):null,t.reactions_summary?h.reactions=t.reactions_summary.map((function(t){return new Fe(e,t)})):t.reactions?h.reactions=t.reactions.map((function(t){return new Fe(e,t)})):h.reactions=[],h.ogMetaData=t.og_tag?new ze(t.og_tag):null,h.silent=null!==(a=t.silent)&&void 0!==a&&a,h.isOperatorMessage=null!==(o=t.is_op_msg)&&void 0!==o&&o,h.appleCriticalAlertOptions=t.apple_critical_alert_options?new Be(t.apple_critical_alert_options):null,"number"==typeof t.scheduled_message_id&&"number"==typeof t.scheduled_at&&t.scheduled_status&&(h.scheduledInfo={scheduledMessageId:t.scheduled_message_id,scheduledAt:t.scheduled_at},h._scheduledStatus=t.scheduled_status),h._isContinuousMessages=null!==(u=t.is_continuous_messages)&&void 0!==u&&u,h.suggestedReplies=null!==(c=null===(l=t.extended_message_payload)||void 0===l?void 0:l.suggested_replies)&&void 0!==c?c:null,h.message=null!==(d=t.message)&&void 0!==d?d:"",h._poll=t.poll?new S(h._iid,t.poll):null,h}return r(s,i),s.payloadify=function(n){var r,s;return e(t(u(u({},i.payloadify.call(this,n)),{message_id:n.messageId,parent_message_id:n.parentMessageId,thread_info:n.threadInfo?xe.payloadify(n.threadInfo):null,reactions_summary:n.reactions.map((function(e){return Fe.payloadify(e)})),og_tag:n.ogMetaData?ze.payloadify(n.ogMetaData):null,silent:n.silent,is_op_msg:n.isOperatorMessage,apple_critical_alert_options:n.appleCriticalAlertOptions?Be.payloadify(n.appleCriticalAlertOptions):null,scheduled_message_id:null===(r=n.scheduledInfo)||void 0===r?void 0:r.scheduledMessageId,scheduled_at:null===(s=n.scheduledInfo)||void 0===s?void 0:s.scheduledAt,scheduled_status:n._scheduledStatus,message:n.message,poll:n._poll?S.payloadify(n._poll):null})))},s._getParentMessageInfoPayload=function(n){var r={type:Qe(n.messageType),ts:n.createdAt,user:n.sender?je.payloadify(n.sender):null,message:n.message,data:n.data,custom_type:n.customType};switch(n.messageType){case g.USER:return e(t(u(u({},r),{translations:n.translations})));case g.FILE:return e(t(u(u({},r),{file:{url:n.plainUrl,name:n.name,type:n.type,require_auth:n.requireAuth},files:Array.isArray(n.fileInfoList)?n.fileInfoList.map((function(e){return tt.payloadify(e)})):null})));case g.ADMIN:return e(t(u(u({},r),{translations:n.translations})));default:return e(t(u({},r)))}},s.prototype.isIdentical=function(e){return this.messageId===e.messageId},s.prototype.applyThreadInfoUpdateEvent=function(e){return this.messageId===e.targetMessageId&&(e.threadInfo._isUpdateRequired&&this.threadInfo&&e.threadInfo._updateFrom(this.threadInfo),this.threadInfo=e.threadInfo,!0)},s.prototype._findReactionIndex=function(e){for(var t=0;t<this.reactions.length;t++)if(this.reactions[t].key===e)return t;return-1},s.prototype.applyReactionEvent=function(e){var t=n.of(this._iid).sdkState;if(this.messageId===e.messageId)switch(e.operation){case Oe.ADD:e.userId===t.userId&&(e._hasCurrentUserReacted=!0),-1!==(r=this._findReactionIndex(e.key))?this.reactions[r].applyEvent(e):e._sampledUserIds?this.reactions.push(new Fe(this._iid,{key:e.key,sampled_user_ids:e._sampledUserIds,sampled_user_info:e._sampledUserInfoList,count:e._count,is_self_included:e._hasCurrentUserReacted,last_ts:e.updatedAt})):this.reactions.push(new Fe(this._iid,{key:e.key,user_ids:[e.userId],updated_at:e.updatedAt}));break;case Oe.DELETE:var r;-1!==(r=this._findReactionIndex(e.key))&&(e._sampledUserIds?0===e._count?this.reactions.splice(r,1):(e.userId===t.userId&&(e._hasCurrentUserReacted=!1),this.reactions[r].applyEvent(e)):(this.reactions[r].applyEvent(e),this.reactions[r].isEmpty&&this.reactions.splice(r,1)))}},s.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1},s.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(s.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),s.prototype._triggerThreadInfoUpdatedEvent=function(){return U(this,void 0,void 0,(function(){var e;return A(this,(function(t){return(e=n.of(this._iid).dispatcher).dispatch(new nt({channelType:I.GROUP,channelUrl:this.channelUrl,parentMessage:this})),e.dispatch(new N({messages:[this],source:C.EVENT_MESSAGE_THREADINFO_UPDATED})),[2]}))}))},s.prototype.markThreadAsRead=function(){return U(this,void 0,void 0,(function(){var e,t;return A(this,(function(r){switch(r.label){case 0:return e=n.of(this._iid).requestQueue,t=new Xe({channelUrl:this.channelUrl,messageId:this.messageId}),[4,e.send(t)];case 1:return r.sent(),this.threadInfo&&0!==this.threadInfo.unreadReplyCount?(this.threadInfo.unreadReplyCount=0,[4,this._triggerThreadInfoUpdatedEvent()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},s.prototype.setPushNotificationEnabled=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return t=n.of(this._iid).requestQueue,r=new Ze({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,pushEnabled:e}),[4,t.send(r)];case 1:return i.sent(),this.threadInfo&&this.threadInfo.isPushNotificationEnabled!==e&&(this.threadInfo.isPushNotificationEnabled=e),[2]}}))}))},s.prototype.submitMessageForm=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(e){throw O.legacyChatbotFeatureNotSupported}))}))},s.prototype.submitFeedback=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(e){throw O.legacyChatbotFeatureNotSupported}))}))},s.prototype.updateFeedback=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(e){throw O.legacyChatbotFeatureNotSupported}))}))},s.prototype.deleteFeedback=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(e){throw O.legacyChatbotFeatureNotSupported}))}))},s}(Ge),st=function(n){function i(e,t){var r,i,s,a,o=this;if((o=n.call(this,e,t)||this).reqId="",o.replyToChannel=!1,o.errorCode=0,o.sender=t.user?new je(o._iid,t.user):t.sender_id,o.reqId=null!==(i=null!==(r=t.req_id)&&void 0!==r?r:t.request_id)&&void 0!==i?i:"",o.replyToChannel=null!==(s=t.is_reply_to_channel)&&void 0!==s&&s,t.request_state&&f(k,t.request_state)&&(o.sendingStatus=t.request_state),!o.sendingStatus)if(o.messageId>0)o.sendingStatus=k.SUCCEEDED;else if(o.scheduledInfo)switch(t.scheduled_status&&(o._scheduledStatus=t.scheduled_status),t.scheduled_status){case et.SENT:case et.IN_QUEUE:o.sendingStatus=k.SUCCEEDED;break;case et.PENDING:o.sendingStatus=k.SCHEDULED;break;case et.FAILED:case et.REMOVED:o.sendingStatus=k.FAILED;break;case et.CANCELED:o.sendingStatus=k.CANCELED}else o.sendingStatus=k.PENDING;return o.errorCode=null!==(a=t.error_code)&&void 0!==a?a:0,o._messageToken=t.mesg_token,o}return r(i,n),i.payloadify=function(r){return e(t(u(u({},n.payloadify.call(this,r)),{user:je.payloadify(r.sender),req_id:r.reqId,is_reply_to_channel:r.replyToChannel,request_state:r.sendingStatus,error_code:r.errorCode,mesg_token:r._messageToken})))},Object.defineProperty(i.prototype,"isResendable",{get:function(){return(this.sendingStatus===k.FAILED||this.sendingStatus===k.CANCELED)&&P(this.errorCode)},enumerable:!1,configurable:!0}),i.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},i}(it),at={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:R.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},ot=function(e){return h("number",e.prevResultSize)&&h("number",e.nextResultSize)&&h("boolean",e.isInclusive)&&h("boolean",e.reverse)&&h("string",e.messageTypeFilter)&&f(R,e.messageTypeFilter)&&d("string",e.customTypesFilter,!0)&&d("string",e.senderUserIdsFilter,!0)&&h("boolean",e.includeMetaArray)&&h("boolean",e.includeReactions)&&h("boolean",e.includeParentMessageInfo)},ut=function(n){function i(r,i){var s,a,o,l=this;if((l=n.call(this,r,i)||this).translations={},l.messageType=g.ADMIN,l.translations=null!==(s=i.translations)&&void 0!==s?s:{},i.parent_message_info){var c=i.parent_message_info;l.parentMessage=mt(r,e(t(u(u({},c),{message_id:l.parentMessageId,channel_url:l.channelUrl,channel_type:l.channelType,file:c.file,url:null===(a=c.file)||void 0===a?void 0:a.url,require_auth:null===(o=c.file)||void 0===o?void 0:o.require_auth}))))}return l}return r(i,n),i.payloadify=function(r){return e(t(u(u({},n.payloadify.call(this,r)),{translations:r.translations,parent_message_info:r.parentMessage?n._getParentMessageInfoPayload.call(this,r.parentMessage):null})))},i.prototype.getThreadedMessagesByTimestamp=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},at),t),x(this.messageId>0&&h("number",e)&&ot(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},i}(it),lt=function(){function n(e){var t,n;this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.detail&&h("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return n.payloadify=function(n){return e(t({type:n.type,vendor:n.vendor,detail:n.detail}))},n}(),ct=function(){function t(e){this.status=e.status,e.original_message_info&&(this.originalMessageInfo={createdAt:e.original_message_info.ts,messageId:e.original_message_info.id})}return t.payloadify=function(t){return e({status:t.status,original_message_info:t.originalMessageInfo?{id:t.originalMessageInfo.messageId,ts:t.originalMessageInfo.createdAt}:void 0})},t}(),dt=function(n){function i(r,i){var s,a,o,l,c,d,h,f=this;if((f=n.call(this,r,i)||this).messageParams=null,f.mentionedMessageTemplate=void 0,f.translations={},f.translationTargetLanguages=[],f.messageSurvivalSeconds=-1,f.plugins=[],f.messageType=g.USER,f.translations=null!==(o=i.translations)&&void 0!==o?o:{},f.translationTargetLanguages=null!==(l=i.target_langs)&&void 0!==l?l:[],0===Object.keys(f.translations).length&&f.translationTargetLanguages.length>0)try{for(var p=v(f.translationTargetLanguages),m=p.next();!m.done;m=p.next()){var _=m.value;f.translations[_]=""}}catch(e){s={error:e}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(s)throw s.error}}if(f.mentionedMessageTemplate=i.mentioned_message_template,f.messageSurvivalSeconds=null!==(c=i.message_survival_seconds)&&void 0!==c?c:-1,f.plugins=i.plugins?i.plugins.map((function(e){return new lt(e)})):[],i.parent_message_info){var y=i.parent_message_info;f.parentMessage=mt(r,e(t(u(u({},y),{created_at:y.ts,message_id:f.parentMessageId,channel_url:f.channelUrl,channel_type:f.channelType,file:y.file,url:null===(d=y.file)||void 0===d?void 0:d.url,require_auth:null===(h=y.file)||void 0===h?void 0:h.require_auth}))))}return i.review_info&&(f.messageReviewInfo=new ct(i.review_info)),f}return r(i,n),i.payloadify=function(r){return e(t(u(u({},n.payloadify.call(this,r)),{translations:r.translations,message_survival_seconds:r.messageSurvivalSeconds,mentioned_message_template:r.mentionedMessageTemplate,plugins:r.plugins.map((function(e){return lt.payloadify(e)})),parent_message_info:r.parentMessage?n._getParentMessageInfoPayload.call(this,r.parentMessage):null,review_info:r.messageReviewInfo?ct.payloadify(r.messageReviewInfo):void 0})))},i.prototype.getThreadedMessagesByTimestamp=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},at),t),x(this.messageId>0&&h("number",e)&&ot(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},i}(st),ht=function(n){function i(r,i){var s,a,o,l,c,d,h,f,p=this;if((p=n.call(this,r,i)||this).messageParams=null,p.fileInfoList=[],p.messageSurvivalSeconds=-1,p.messageType=g.FILE,p.data=null!==(o=null!==(a=null===(s=i.file)||void 0===s?void 0:s.data)&&void 0!==a?a:i.custom)&&void 0!==o?o:"",p.fileInfoList=null!==(c=null===(l=i.files)||void 0===l?void 0:l.map((function(e){return new tt(r,e)})))&&void 0!==c?c:[],p.messageSurvivalSeconds=null!==(d=i.message_survival_seconds)&&void 0!==d?d:-1,i.parent_message_info){var m=i.parent_message_info;p.parentMessage=mt(r,e(t(u(u({},m),{created_at:m.ts,message_id:p.parentMessageId,channel_url:p.channelUrl,channel_type:p.channelType,file:m.file,url:null===(h=m.file)||void 0===h?void 0:h.url,require_auth:null===(f=m.file)||void 0===f?void 0:f.require_auth}))))}return p}return r(i,n),i.prototype.getThreadedMessagesByTimestamp=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},at),t),x(this.messageId>0&&h("number",e)&&ot(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},i.payloadify=function(r){var i,s,a,o,l,c;return e(t(u(u({},n.payloadify.call(this,r)),{file:{name:null!==(s=null===(i=r.fileInfoList[0])||void 0===i?void 0:i.fileName)&&void 0!==s?s:"",size:null!==(o=null===(a=r.fileInfoList[0])||void 0===a?void 0:a.fileSize)&&void 0!==o?o:0,type:null!==(c=null===(l=r.fileInfoList[0])||void 0===l?void 0:l.mimeType)&&void 0!==c?c:"",data:r.data},files:Array.isArray(r.fileInfoList)?r.fileInfoList.map((function(e){return tt.payloadify(e)})):null,message_survival_seconds:r.messageSurvivalSeconds,parent_message_info:r.parentMessage?n._getParentMessageInfoPayload.call(this,r.parentMessage):null})))},i._isMultipleFilesMessagePayload=function(e){var t=e.files;return Array.isArray(t)&&t.length>=2},i._isMultipleFilesMessageSerializedData=function(e){var t=e.fileInfoList;return Array.isArray(t)},i}(st);!function(e){e.SENT="SENT",e.READ="READ"}(rt||(rt={}));var ft=function(n){function i(e,t){var r,i,s=this;if((s=n.call(this,e,t)||this).notificationData=null,s.notificationId=t.notification_message_id,s.messageType=g.ADMIN,s.messageStatus=null!==(r=t.message_status)&&void 0!==r?r:rt.SENT,s.priority=null!==(i=t.priority)&&void 0!==i?i:D.NORMAL,s.notificationEventDeadline=t.notification_event_deadline,0===s.extendedMessage.sub_type)try{var a=JSON.parse(s.extendedMessage.sub_data),o=a.label,u=a.tags,l=void 0===u?[]:u,c=a.template_key,d=a.template_variables;s.notificationData={label:o,tags:l,templateKey:c,templateVariables:d}}catch(e){}return s}return r(i,n),i.payloadify=function(r){return e(t(u(u({},n.payloadify.call(this,r)),{notification_message_id:r.notificationId,message_status:r.messageStatus,priority:r.priority,notification_event_deadline:r.notificationEventDeadline})))},i.prototype.isIdentical=function(e){return this.notificationId===e.notificationId},i}(Ge),pt=function(e){if(e.notificationId)return ft.payloadify(e);switch(e.messageType){case g.USER:return dt.payloadify(e);case g.FILE:return e.fileInfoList?ht.payloadify(e):vt.payloadify(e);case g.ADMIN:return ut.payloadify(e);default:throw O.unknown}},mt=function(e,t){if(t.notification_message_id)return new ft(e,t);switch(t.type){case"MESG":return new dt(e,t);case"FILE":return ht._isMultipleFilesMessagePayload(t)?new ht(e,t):new vt(e,t);case"ADMM":case"BRDM":return new ut(e,t);default:return null}},vt=function(i){function s(n,r){var s,a,o,l,c,d,h,f,p,m,v,_,y,b,I,E=this;(E=i.call(this,n,r)||this).messageParams=null,E.plainUrl="",E.requireAuth=!1,E.thumbnails=[],E.messageSurvivalSeconds=-1,E.messageType=g.FILE;var w=r.file;if(E.plainUrl=(null!==(a=null!==(s=null==w?void 0:w.url)&&void 0!==s?s:r.url)&&void 0!==a?a:"").split("?auth=")[0],E.name=null!==(l=null!==(o=null==w?void 0:w.name)&&void 0!==o?o:r.name)&&void 0!==l?l:"File",E.size=null!==(d=null!==(c=null==w?void 0:w.size)&&void 0!==c?c:r.size)&&void 0!==d?d:0,E.data=null!==(p=null!==(f=null!==(h=null==w?void 0:w.data)&&void 0!==h?h:r.custom)&&void 0!==f?f:E.data)&&void 0!==p?p:"",E.type=w?null!==(m=w.type)&&void 0!==m?m:"":null!==(v=r.type)&&void 0!==v?v:"",E.requireAuth=null!==(_=r.require_auth)&&void 0!==_&&_,E.thumbnails=r.thumbnails?r.thumbnails.map((function(e){var t;return new ke(E._iid,"string"==typeof e?{url:e,width:0,height:0}:u(u({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),E.requireAuth)})):[],E.messageSurvivalSeconds=null!==(y=r.message_survival_seconds)&&void 0!==y?y:-1,r.parent_message_info){var T=r.parent_message_info;E.parentMessage=mt(n,e(t(u(u({},T),{created_at:T.ts,message_id:E.parentMessageId,channel_url:E.channelUrl,channel_type:E.channelType,file:T.file,url:null===(b=T.file)||void 0===b?void 0:b.url,require_auth:null===(I=T.file)||void 0===I?void 0:I.require_auth}))))}return E}return r(s,i),s.payloadify=function(n){var r;return e(t(u(u({},i.payloadify.call(this,n)),{url:n.plainUrl,require_auth:n.requireAuth,file:{name:n.name,size:n.size,type:n.type,data:n.data},thumbnails:null===(r=n.thumbnails)||void 0===r?void 0:r.map((function(e){return{url:e.plainUrl,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:n.messageSurvivalSeconds,parent_message_info:n.parentMessage?i._getParentMessageInfoPayload.call(this,n.parentMessage):null})))},Object.defineProperty(s.prototype,"url",{get:function(){var e=n.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),s.prototype.getThreadedMessagesByTimestamp=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},at),t),x(this.messageId>0&&h("number",e)&&ot(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},s}(st),_t=function(e){function t(t,n){var r=n.file,i=n.fileUrl,s=n.fileName,a=n.fileSize,o=n.mimeType,u=n.thumbnailSizes,l=n._uploadedMetaData,c=n._thumbnails,d=e.call(this,t)||this;return d._plainUrl=i,d.file=r,d.fileName=s,d.fileSize=a,d.mimeType=o,d.thumbnailSizes=u,d._uploadedMetaData=l,d._thumbnails=c,d}return r(t,e),t.getPlainUrl=function(e){return e instanceof t?e._plainUrl:e.fileUrl},Object.defineProperty(t.prototype,"fileUrl",{get:function(){var e,t=n.of(this._iid).sessionManager;return this._plainUrl&&(null===(e=this._uploadedMetaData)||void 0===e?void 0:e.requireAuth)&&t.ekey?"".concat(this._plainUrl,"?auth=").concat(t.ekey):this._plainUrl},set:function(e){this._plainUrl=e},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{file:this.file,fileUrl:this._plainUrl,fileName:this.fileName,fileSize:this.fileSize,mimeType:this.mimeType,thumbnailSizes:this.thumbnailSizes,_thumbnails:this._thumbnails,_uploadedMetaData:this._uploadedMetaData}},t}(c),yt=function(n){function i(r){var i,s,a,o,u=[];return r.mentionType===E.USERS&&(r.mentionedUserIds?u=r.mentionedUserIds:r.mentionedUsers&&(u=r.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"FILE",ackRequired:!0,payload:e(t({channel_url:r.channelUrl,files:r.files?Et(r.files):null,url:r.url,name:null!==(i=r.fileName)&&void 0!==i?i:"",type:null!==(s=r.mimeType)&&void 0!==s?s:"",size:null!==(a=r.fileSize)&&void 0!==a?a:0,custom:r.data,custom_type:r.customType,thumbnails:null===(o=r._thumbnails)||void 0===o?void 0:o.map((function(e){return ke.payloadify(e)})),require_auth:r.requireAuth,metaarray:r.metaArrays,mention_type:r.mentionType,mentioned_user_ids:u,push_option:r.pushNotificationDeliveryOption&&r.pushNotificationDeliveryOption!==L.DEFAULT?r.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:r.appleCriticalAlertOptions?Be.payloadify(r.appleCriticalAlertOptions):null,silent:r.silent,reply_to_channel:r.isReplyToChannel,parent_message_id:r.parentMessageId?r.parentMessageId:null,req_id:r.reqId,poll_id:r.pollId,pin_message:r.isPinnedMessage,message:r.message}))})||this}return r(i,n),i}(w),gt=function(n){function s(r){var s,a,o=this;o=n.call(this)||this;var u=[];return r.mentionType===E.USERS&&(r.mentionedUserIds?u=r.mentionedUserIds:r.mentionedUsers&&(u=r.mentionedUsers.map((function(e){return e.userId})))),o.method=i.POST,o.path="".concat(T(r.channelType),"/").concat(encodeURIComponent(r.channelUrl),"/messages"),o.params=e(t({message_type:g.FILE,user_id:r.userId,files:r.files?Et(r.files):null,url:r.fileUrl,mention_type:r.mentionType,mentioned_user_ids:u,file_name:r.fileName,file_size:r.fileSize,file_type:r.mimeType,data:r.data,custom_type:r.customType,thumbnails:null===(s=r._thumbnails)||void 0===s?void 0:s.map((function(e){return ke.payloadify(e)})),require_auth:r.requireAuth,sorted_metaarray:null===(a=r.metaArrays)||void 0===a?void 0:a.map((function(e){return Ke.payloadify(e)})),push_option:r.pushNotificationDeliveryOption,parent_message_id:r.parentMessageId?r.parentMessageId:null,apple_critical_alert_options:r.appleCriticalAlertOptions?Be.payloadify(r.appleCriticalAlertOptions):null,reply_to_channel:r.isReplyToChannel,req_id:r.reqId,poll_id:r.pollId,pin_message:r.isPinnedMessage})),o}return r(s,n),s}(a),bt=function(e){function t(t,r,i){var s,a,o,u,l=this;(l=e.call(this,t,"FILE",i)||this).message=i.files&&i.files.length>=2?new ht(t,i):new vt(t,i);var c=n.of(t).sdkState;return l.isMentioned=F(l.message.mentionType,null!==(o=null!==(s=l.message.mentionedUserIds)&&void 0!==s?s:null===(a=l.message.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})))&&void 0!==o?o:[],c.userId),l.forceUpdateLastMessage=null!==(u=i.force_update_last_message)&&void 0!==u&&u,l}return r(t,e),t}(M),It=function(e){function t(t,r){var i,s,a,o,u=this;(u=e.call(this,t,r)||this).message=r.files&&r.files.length>=2?new ht(t,r):new vt(t,r);var l=n.of(t).sdkState;return u.isMentioned=F(u.message.mentionType,null!==(a=null!==(i=u.message.mentionedUserIds)&&void 0!==i?i:null===(s=u.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})))&&void 0!==a?a:[],l.userId),u.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,u}return r(t,e),t}(o);function Et(n){return n.map((function(n){var r,i;return e(t({url:_t.getPlainUrl(n),file_name:n.fileName,file_type:n.mimeType,file_size:n.fileSize,thumbnails:null===(r=n._thumbnails)||void 0===r?void 0:r.map((function(e){return ke.payloadify(e)})),require_auth:null===(i=n._uploadedMetaData)||void 0===i?void 0:i.requireAuth}))}))}var wt;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(wt||(wt={}));var Tt=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext,o=this;this._queueMap=new Map,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=a,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof z&&(o._connectionState=e.stateType)})),this._onlineDetector=s}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===B.CONNECTED||this._connectionState===B.CONNECTING||this._connectionState===B.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return U(this,void 0,void 0,(function(){var n,r,i;return A(this,(function(s){switch(s.label){case 0:return n=this._createSendFileMessageRequestParams(e,t),this._shouldSendThroughWebSocket?(r=new yt(n),[4,this._requestQueue.send(r)]):[3,2];case 1:return i=s.sent(),[2,i.as(bt).message];case 2:return r=new gt(u(u({},n),{userId:this._sdkState.userId})),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),[2,i.as(It).message]}}))}))},e.prototype._createSendFileMessageRequestParams=function(e,t){var n=u(u({},t.params),{channelUrl:e.url,channelType:e.channelType,reqId:t.requestId,url:""});if(t.multipleFileUploadInfo){var r=t.params;n.files=r.fileInfoList}else{r=t.params;n.url=r.fileUrl,n.requireAuth=r.requireAuth}return n},e.prototype._resolveMessageQueue=function(e){var t;return U(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,l,c,d,h,f,p;return A(this,(function(m){switch(m.label){case 0:if(!(n=this._queueMap.get(e.url)))return[3,21];if(n.isResolving)return[3,20];n.isResolving=!0,r=[],i=!0,m.label=1;case 1:m.trys.push([1,15,16,17]),s=v(n.messageQueue),a=s.next(),m.label=2;case 2:if(a.done)return[3,14];switch(o=a.value,o.state){case wt.PENDING:case wt.UPLOADING:return[3,3];case wt.UPLOADED:return[3,4];case wt.FAILED:return[3,12]}return[3,13];case 3:return i=!1,r.push(o),[3,13];case 4:if(!i)return[3,10];m.label=5;case 5:return m.trys.push([5,8,,9]),o.state=wt.SENDING,[4,this._sendFileMessage(e,o)];case 6:return u=m.sent(),o.deferred.resolve(u),[4,K(100)];case 7:return m.sent(),[3,9];case 8:return l=m.sent(),o.deferred.reject(l),[3,9];case 9:return[3,11];case 10:r.push(o),m.label=11;case 11:return[3,13];case 12:return c=null!==(t=o.error)&&void 0!==t?t:O.unknown,o.deferred.reject(c.code===j.REQUEST_CANCELED?O.fileUploadCanceled:c),[3,13];case 13:return a=s.next(),[3,2];case 14:return[3,17];case 15:return d=m.sent(),f={error:d},[3,17];case 16:try{a&&!a.done&&(p=s.return)&&p.call(s)}finally{if(f)throw f.error}return[7];case 17:return h=n.isResolveRequestPending,n.messageQueue=r,n.isResolving=!1,n.isResolveRequestPending=!1,h?[4,this._resolveMessageQueue(e)]:[3,19];case 18:m.sent(),m.label=19;case 19:return[3,21];case 20:n.isResolveRequestPending=!0,m.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){var t;return U(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,l,c,d;return A(this,(function(h){switch(h.label){case 0:return(n=this._queueMap.get(e.url))&&(r=n.messageQueue.find((function(e){return e.state===wt.PENDING})))?r.multipleFileUploadInfo?(i=r.multipleFileUploadInfo,s=i.uploadIndex,a=i.uploadCount,o=i.requestHandler,d=r.params,u=d.fileInfoList[s],!Q(u.file)||(null===(t=u._uploadedMetaData)||void 0===t?void 0:t.isUploaded)?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]):[3,4]:[3,9];case 1:return h.sent(),[3,3];case 2:r.state=s<a-1?wt.PENDING:wt.UPLOADED,h.label=3;case 3:return l=d.fileInfoList[s],c=r.multipleFileUploadInfo.uploadIndex++,r.multipleFileUploadInfo.isCopy||null==o||o._triggerOnFileUploaded(r.requestId,c,l,r.error),[3,7];case 4:return d=r.params,Q(d.file)?[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]:[3,6];case 5:return h.sent(),[3,7];case 6:d.thumbnailSizes=[],r.state=wt.UPLOADED,h.label=7;case 7:return this._uploadNextPendingItem(e),[4,this._resolveMessageQueue(e)];case 8:h.sent(),h.label=9;case 9:return[2]}}))}))},e.prototype._tryUploadNextItemAndUpdateItemState=function(e,t,r){return U(this,void 0,void 0,(function(){var i,s,a,o,u,l;return A(this,(function(c){switch(c.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(i=c.sent(),!n.of(this._iid).sessionManager.currentUser||!i)return r.error=O.connectionRequired,r.state=wt.FAILED,[2];if(!(t.uploadQueue.length<6))return[3,9];r.state=wt.UPLOADING,t.uploadQueue.push(r),c.label=2;case 2:return c.trys.push([2,7,,8]),r.multipleFileUploadInfo?(s=r.multipleFileUploadInfo,a=s.uploadIndex,o=s.uploadCount,u=r.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,r,u)]):[3,4];case 3:return c.sent(),r.state=a<o-1?wt.PENDING:wt.UPLOADED,[3,6];case 4:return u=r.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(e,r,u)];case 5:c.sent(),r.state=wt.UPLOADED,c.label=6;case 6:return[3,8];case 7:switch((l=c.sent()).code){case j.REQUEST_FAILED:r.error=new O({code:j.NETWORK_ERROR,message:"Failed to upload a file."});break;case j.REQUEST_CANCELED:r.error=O.fileUploadCanceled;break;default:r.error=l}return r.state=wt.FAILED,[3,8];case 8:this._dequeueUploadItem(t,r),c.label=9;case 9:return[2]}}))}))},e.prototype._dequeueUploadItem=function(e,t){var n=e.uploadQueue.findIndex((function(e){return e.requestId===t.requestId}));n>=0&&e.uploadQueue.splice(n,1)},e.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(e,t,n){var r,i,s;return U(this,void 0,void 0,(function(){var a,o,u,l,c,d,h,f,p,m;return A(this,(function(v){switch(v.label){case 0:return a=new Pe({file:n.file,channelUrl:e.url,thumbnailSizes:n.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(a)];case 1:return o=v.sent(),u=o.as(Re),l=u.url,c=u.fileSize,d=void 0===c?n.fileSize:c,h=u.thumbnails,f=void 0===h?[]:h,p=u.requireAuth,m=void 0!==p&&p,n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(i=n.mimeType)&&void 0!==i?i:n.file.type,n.fileSize=null!==(s=n.fileSize)&&void 0!==s?s:n.file.size,n.fileUrl=l,n.fileSize=d,n.requireAuth=m,n._thumbnails=f,[2]}}))}))},e.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(e,t,n){var r,i,s;return U(this,void 0,void 0,(function(){var a,o,l,c,d,h,f,p,m,v,_;return A(this,(function(y){switch(y.label){case 0:return a=t.multipleFileUploadInfo.uploadIndex,o=n.fileInfoList[a],l=new Pe({file:o.file,channelUrl:e.url,thumbnailSizes:o.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(l)];case 1:return c=y.sent(),d=c.as(Re),h=d.url,f=d.fileSize,p=void 0===f?o.fileSize:f,m=d.thumbnails,v=d.requireAuth,_=void 0!==v&&v,o.fileName=null!==(r=o.fileName)&&void 0!==r?r:o.file.name,o.mimeType=null!==(i=o.mimeType)&&void 0!==i?i:o.file.type,o.fileSize=null!==(s=o.fileSize)&&void 0!==s?s:o.file.size,o.file=void 0,o.fileUrl=h,o.fileSize=p,o._thumbnails=m,o._uploadedMetaData=u(u({},o._uploadedMetaData),{requireAuth:_,isUploaded:!0}),o instanceof _t||(n.fileInfoList[a]=new _t(this._iid,o)),[2]}}))}))},e.prototype.request=function(e,t,n,r){return void 0===r&&(r={}),U(this,void 0,void 0,(function(){var i,s,a,o,l;return A(this,(function(c){return this._queueMap.has(e.url)||(i={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(e.url,i)),s=this._queueMap.get(e.url),a=new G,o={requestId:t,params:n,state:wt.PENDING,deferred:a},function(e){return"fileInfoList"in e}(n)&&(l=u({uploadIndex:0,uploadCount:n.fileInfoList.length},r),o.multipleFileUploadInfo=l),s.messageQueue.push(o),this._uploadNextPendingItem(e),[2,a.promise]}))}))},e.prototype.cancel=function(e,t){var n,r,i=this._queueMap.get(e.url);if(i){var s=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:p([],m(i.messageQueue),!1);try{for(var a=v(s),o=a.next();!o.done;o=a.next()){var u=o.value;if(u)switch(u.state){case wt.PENDING:if(u.state=wt.FAILED,u.error=O.requestCanceled,u.multipleFileUploadInfo&&!u.multipleFileUploadInfo.isCopy){var l=u.multipleFileUploadInfo,c=l.uploadIndex,d=l.requestHandler,h=u.params.fileInfoList[c];null==d||d._triggerOnFileUploaded(u.requestId,c,h,O.fileUploadCanceled)}this._resolveMessageQueue(e);break;case wt.UPLOADING:this._requestQueue.cancel(u.requestId),this._dispatcher.dispatch(new q({requestId:u.requestId}))}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}else t&&(this._requestQueue.cancel(t),this._dispatcher.dispatch(new q({requestId:t})))},e}();var Mt,St,Ut={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:R.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:V.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},At=function(e){return h("number",e.prevResultSize)&&h("number",e.nextResultSize)&&h("boolean",e.isInclusive)&&h("boolean",e.reverse)&&h("string",e.messageTypeFilter)&&f(R,e.messageTypeFilter)&&d("string",e.customTypesFilter,!0)&&d("string",e.senderUserIdsFilter,!0)&&f(V,e.replyType)&&h("boolean",e.includeMetaArray)&&h("boolean",e.includeReactions)&&h("boolean",e.includeParentMessageInfo)&&h("boolean",e.includeThreadInfo)&&h("boolean",e.showSubchannelMessagesOnly)},Nt={replyType:V.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Ct=function(e){return f(V,e.replyType)&&h("boolean",e.includeReactions)&&h("boolean",e.includeMetaArray)&&h("boolean",e.includeParentMessageInfo)&&h("boolean",e.includeThreadInfo)};!function(e){e.MESSAGE="message"}(Mt||(Mt={})),function(e){e.INTERNAL_BACKSYNC="internal_backsync",e.INTERNAL_FILL_GAP="internal_fill_gap",e.EXTERNAL_LEGACY="external_legacy",e.EXTERNAL_COLLECTION="external_collection"}(St||(St={}));var Ot,kt=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,a=t.includeMetaArray,o=t.includeReactions,u=t.includeThreadInfo,l=t.includeParentMessageInfo,c=e.call(this)||this;return c.method=i.GET,c.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(s)),c.params={is_sdk:!0,with_sorted_meta_array:a,include_reactions_summary:null!=o&&o,include_thread_info:u,include_parent_message_info:l,include_poll_details:!0},c}return r(t,e),t}(a),Pt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=n?mt(t,u({},n)):null,r}return r(t,e),t}(o),Rt=function(n){function s(r){var s=r.channelType,a=r.channelUrl,o=r.timestamp,u=r.token,l=r.prevResultSize,c=r.nextResultSize,d=r.isInclusive,h=r.reverse,f=r.messageTypeFilter,p=r.customTypesFilter,m=r.senderUserIdsFilter,v=r.replyType,_=r.includeMetaArray,y=r.includeReactions,g=r.parentMessageId,b=r.includeThreadInfo,I=r.includeParentMessageInfo,E=r.showSubchannelMessagesOnly,w=r.checkingHasNext,M=r.checkingContinuousMessages,S=r.sdkSource,U=n.call(this)||this;return U.method=i.GET,U.path="".concat(T(s),"/").concat(encodeURIComponent(a),"/messages"),U.params=e(t({is_sdk:!0,prev_limit:l,next_limit:c,include:d,reverse:h,message_ts:o,message_id:u,message_type:null!=f?f:null,custom_types:p,sender_ids:m,include_reply_type:v,with_sorted_meta_array:_,include_reactions_summary:y,parent_message_id:g,include_thread_info:b,include_parent_message_info:I,show_subchannel_message_only:E,include_poll_details:!0,checking_has_next:w,checking_continuous_messages:M,sdk_source:S})),U}return r(s,n),s}(a),xt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return void 0!==n.is_continuous_messages&&(r.isContinuousMessages=n.is_continuous_messages),void 0!==n.has_next&&(r.hasNext=n.has_next),r.messages=n.messages.map((function(e){return mt(t,e)})),r}return r(t,e),t}(o),Dt=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.timestamp,a=t.token,o=t.replyType,u=t.includeMetaArray,l=t.includeReactions,c=t.includeThreadInfo,d=t.includeParentMessageInfo,h=e.call(this)||this;return h.method=i.GET,h.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/changelogs"),h.params={change_ts:s,token:a,with_sorted_meta_array:u,include_reactions_summary:l,include_thread_info:c,include_reply_type:o,include_parent_message_info:d,include_poll_details:!0},h}return r(t,e),t}(a),Lt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedMessages=n.updated.map((function(e){return mt(t,e)})),r.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r.forceUseNextToken=n.force_use_next_token||!1,r}return r(t,e),t}(o),Ft=function(e){function t(t){var n=t.channelUrl,r=t.scheduledMessageId,s=e.call(this)||this;return s.method=i.GET,s.path="".concat(H,"/").concat(encodeURIComponent(n),"/scheduled_messages/").concat(encodeURIComponent(r)),s.params={},s}return r(t,e),t}(a),qt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=n?mt(t,u({},n)):null,r}return r(t,e),t}(o);!function(e){e.MUTED="muted",e.BANNED="banned"}(Ot||(Ot={}));var zt=function(){function n(e){var t,n,r,i;this.restrictionType=null,f(Ot,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(r=null!==(n=e.end_at)&&void 0!==n?n:e.muted_end_at)&&void 0!==r?r:-1,this.remainingDuration=null!==(i=e.remaining_duration)&&void 0!==i?i:-1}return n.payloadify=function(n){return e(t({restriction_type:n.restrictionType,description:n.description,end_at:n.endAt,remaining_duration:n.remainingDuration}))},n}(),Bt=function(n){function i(e,t){var r=n.call(this,e,t)||this;return r.restrictionInfo=new zt(t),r}return r(i,n),i.payloadify=function(r){return e(t(u(u({},n.payloadify.call(this,r)),zt.payloadify(r.restrictionInfo))))},i}(l),jt=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).isMuted=!1,i.isMuted=null!==(r=n.is_muted)&&void 0!==r&&r,i}return r(t,e),t}(l),Kt=function(){function e(){this._onPending=W,this._onFailed=W,this._onSucceeded=W}return e.prototype._trigger=function(e){switch(null==e?void 0:e.sendingStatus){case k.PENDING:0===e.errorCode&&this._onPending(e);break;case k.SCHEDULED:case k.SUCCEEDED:this._onSucceeded(e)}},e.prototype._triggerFailed=function(e,t){switch(null==t?void 0:t.sendingStatus){case k.FAILED:case k.CANCELED:this._onFailed(e,t.scheduledInfo?null:t)}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),Qt={data:void 0,customType:void 0,mentionType:E.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1,pollId:void 0},Gt=function(e){return h("string",e.data,!0)&&h("string",e.customType,!0)&&f(E,e.mentionType)&&d("string",e.mentionedUserIds,!0)&&d(l,e.mentionedUsers,!0)&&d(Ke,e.metaArrays,!0)&&h("number",e.parentMessageId,!0)&&h("boolean",e.isReplyToChannel)&&f(L,e.pushNotificationDeliveryOption,!0)&&h(Be,e.appleCriticalAlertOptions,!0)&&h("boolean",e.isPinnedMessage,!0)&&h("number",e.pollId,!0)},Vt=function(e){return{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}},Ht=u(u({},Qt),{message:"",mentionedMessageTemplate:void 0,translationTargetLanguages:void 0,extendedMessagePayload:void 0});function Wt(e){var n,r,i;return null!==(n=e.messageParams)&&void 0!==n?n:t(u(u({},e),{mentionType:e.mentionType,mentionedUserIds:null!==(r=e.mentionedUserIds)&&void 0!==r?r:null===(i=e.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),mentionedMessageTemplate:e.mentionedMessageTemplate,translationTargetLanguages:Object.keys(e.translations),pushNotificationDeliveryOption:L.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}))}var Yt,Jt=function(n){var r;return e(t({data:n.data,customType:n.customType,mentionType:n.mentionType,mentionedUsers:n.mentionedUsers,mentionedUserIds:n.mentionedUserIds,mentionedMessageTemplate:n.mentionedMessageTemplate,metaArrays:n.metaArrays,pollId:null===(r=n.poll)||void 0===r?void 0:r.id,parentMessageId:n.parentMessageId,appleCriticalAlertOptions:n.appleCriticalAlertOptions,message:n.message,translationTargetLanguages:Object.keys(n.translations),extendedMessagePayload:n.extendedMessagePayload}))},Xt=function(e){return Gt(e)&&h("string",e.message)&&h("string",e.mentionedMessageTemplate,!0)&&d("string",e.translationTargetLanguages,!0)&&h("object",e.extendedMessagePayload,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(Yt||(Yt={}));var Zt=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},$t=function(e){return e===Yt.BLOB||e===Yt.FILE},en=function(e){return{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}},tn=u(u({},Qt),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1,message:void 0});function nn(e){var n,r,i,s;return null!==(n=e.messageParams)&&void 0!==n?n:t(u(u({},e),{fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,mentionType:e.mentionType,mentionedUserIds:null!==(r=e.mentionedUserIds)&&void 0!==r?r:null===(i=e.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),pushNotificationDeliveryOption:L.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(s=e.thumbnails)||void 0===s?void 0:s.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:e.requireAuth,isPinnedMessage:!1,_thumbnails:e.thumbnails,message:e.message}))}var rn,sn=function(n,r){var i,s;return n.messageParams?(!n.url&&Q(r)&&(n.messageParams.file=r),n.messageParams):e(t({data:n.data,customType:n.customType,mentionType:n.mentionType,mentionedUsers:n.mentionedUsers,mentionedUserIds:n.mentionedUserIds,metaArrays:n.metaArrays,parentMessageId:n.parentMessageId,appleCriticalAlertOptions:n.appleCriticalAlertOptions,file:r,fileUrl:n.url,fileName:n.name,fileSize:n.size,mimeType:n.type,thumbnailSizes:null===(i=n.thumbnails)||void 0===i?void 0:i.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),message:n.message,pollId:null===(s=n.poll)||void 0===s?void 0:s.id}))},an=function(e){return Gt(e)&&(Q(e.file)||h("string",e.fileUrl))&&h("string",e.fileName,!0)&&h("string",e.mimeType,!0)&&h("number",e.fileSize,!0)&&h("string",e.message,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return h("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},on={data:void 0,customType:void 0,mentionType:E.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},un=function(e){return h("string",e.data,!0)&&h("string",e.customType,!0)&&f(E,e.mentionType)&&d("string",e.mentionedUserIds,!0)&&d(l,e.mentionedUsers,!0)&&d(Ke,e.metaArrays,!0)&&f(L,e.pushNotificationDeliveryOption,!0)&&h(Be,e.appleCriticalAlertOptions,!0)},ln=u(u({},on),{message:void 0,mentionedMessageTemplate:void 0,translationTargetLanguages:void 0,pollId:void 0}),cn=function(e){return un(e)&&h("string",e.mentionedMessageTemplate,!0)&&h("string",e.message,!0)&&d("string",e.translationTargetLanguages,!0)&&h("number",e.pollId,!0)},dn=u({},on),hn=function(e){function t(t){var n=t.channelUrl,r=t.channelType,s=t.token,a=t.limit,o=e.call(this)||this;return o.method=i.GET,o.path="".concat(T(r),"/").concat(encodeURIComponent(n),"/operators"),o.params={token:s,limit:a},o}return r(t,e),t}(a),fn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.operators=n.operators.map((function(e){return new l(t,e)})),r.token=n.next,r}return r(t,e),t}(o),pn=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return r(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a,o;return A(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=n.of(this._iid).requestQueue,r=new hn(u(u({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(r)]):[3,2]):[3,5];case 1:return i=l.sent(),s=i.as(fn),a=s.operators,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,e];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},t}(Y),mn=function(e){function n(t,n,r,i){var s,a,o,u,l,c,d,h,f,p,m=this;return(m=e.call(this,t,n,r,i)||this).reverse=!1,m.messageTypeFilter=R.ALL,m.customTypesFilter=null,m.senderUserIdsFilter=null,m.replyType=V.NONE,m.includeMetaArray=!1,m.includeReactions=!1,m.includeParentMessageInfo=!1,m.includeThreadInfo=!1,m.showSubchannelMessagesOnly=!1,m._edge=Number.MAX_SAFE_INTEGER,m.reverse=null!==(s=i.reverse)&&void 0!==s&&s,m.messageTypeFilter=null!==(a=i.messageTypeFilter)&&void 0!==a?a:R.ALL,m.customTypesFilter=null!==(o=i.customTypesFilter)&&void 0!==o?o:null,m.senderUserIdsFilter=null!==(u=i.senderUserIdsFilter)&&void 0!==u?u:null,m.replyType=null!==(l=i.replyType)&&void 0!==l?l:V.NONE,m.includeMetaArray=null!==(c=i.includeMetaArray)&&void 0!==c&&c,m.includeReactions=null!==(d=i.includeReactions)&&void 0!==d&&d,m.includeParentMessageInfo=null!==(h=i.includeParentMessageInfo)&&void 0!==h&&h,m.includeThreadInfo=null!==(f=i.includeThreadInfo)&&void 0!==f&&f,m.showSubchannelMessagesOnly=null!==(p=i.showSubchannelMessagesOnly)&&void 0!==p&&p,m}return r(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&h("boolean",this.reverse)&&f(R,this.messageTypeFilter)&&f(V,this.replyType)&&d("string",this.customTypesFilter,!0)&&d("string",this.senderUserIdsFilter,!0)&&h("boolean",this.includeMetaArray)&&h("boolean",this.includeReactions)&&h("boolean",this.includeParentMessageInfo)&&h("boolean",this.includeThreadInfo)&&h("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return U(this,void 0,void 0,(function(){var e;return A(this,(function(n){switch(n.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Xs.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,t({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=n.sent(),this._edge=Math.min.apply(Math,p([Number.MAX_SAFE_INTEGER],m(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},n}(Y),vn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.limit,o=t.token;return(n=e.call(this)||this).method=i.GET,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/mute"),n.params={limit:a,token:o},n}return r(t,e),t}(a),_n=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.mutedUsers=[];var i=n.next,s=n.muted_list;return r.token=i,s&&s.length>0&&(r.mutedUsers=s.map((function(e){return new Bt(t,e)}))),r}return r(t,e),t}(o),yn=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return r(t,e),t.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid).requestQueue,t=new vn(u(u({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=o.sent(),i=r.as(_n),s=i.mutedUsers,a=i.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},t}(Y),gn=function(t){function n(n){var r=this,s=n.channelUrl,a=n.channelType,o=n.limit,u=n.token;return(r=t.call(this)||this).method=i.GET,r.path="".concat(T(a),"/").concat(encodeURIComponent(s),"/ban"),r.params=e({limit:o,token:u}),r}return r(n,t),n}(a),bn=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.bannedUsers=[];var i=n.next,s=n.banned_list;return r.token=i,s&&s.length>0&&(r.bannedUsers=s.map((function(e){return new Bt(t,e.user)}))),r}return r(t,e),t}(o),In=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return r(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid).requestQueue,t=new gn(u(u({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=o.sent(),i=r.as(bn),s=i.bannedUsers,a=i.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},t}(Y);!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate"}(rn||(rn={}));var En=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.operatorUserIds;return(n=e.call(this)||this).method=i.POST,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:a},n}return r(t,e),t}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var wn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.operatorUserIds;return(n=e.call(this)||this).method=i.DELETE,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:a},n}return r(t,e),t}(a);!function(e){function t(t,n){return e.call(this,t,n)||this}r(t,e)}(o);var Tn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.userId;return(n=e.call(this)||this).method=i.GET,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/mute/").concat(encodeURIComponent(a)),n}return r(t,e),t}(a),Mn=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.isMuted=!1,r.startAt=0,r.endAt=0;var i=n.is_muted,s=n.start_at,a=n.end_at,o=n.remaining_duration,u=n.description;return r.isMuted=i,r.startAt=s,r.endAt=a,r.remainingDuration=o,r.description=u,r}return r(t,e),t}(o),Sn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.keys;return(n=e.call(this)||this).method=i.GET,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={keys:a,include_ts:!0},n}return r(t,e),t}(a),Un=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.metadata,s=n.ts;return r.metadata=i,r.ts=s,r}return r(t,e),t}(o),An=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.metadata;return(n=e.call(this)||this).method=i.POST,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:a,include_ts:!0},n}return r(t,e),t}(a),Nn=function(e){function t(t,n){var r,i,s=this;return(s=e.call(this,t,n)||this).metaData=null!==(r=n.metadata)&&void 0!==r?r:{},s.ts=null!==(i=n.ts)&&void 0!==i?i:null,s}return r(t,e),t}(o),Cn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.metadata,o=t.upsert;return(n=e.call(this)||this).method=i.PUT,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:a,include_ts:!0,upsert:null!=o&&o},n}return r(t,e),t}(a),On=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.metadata,s=n.ts;return r.metadata=i,r.ts=s,r}return r(t,e),t}(o),kn=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return r(t,e),t}(M),Pn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.key;return(n=e.call(this)||this).method=i.DELETE,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metadata/").concat(a),n.params={include_ts:!0},n}return r(t,e),t}(a),Rn=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.ts;return r.ts=i,r}return r(t,e),t}(o),xn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType;return(n=e.call(this)||this).method=i.DELETE,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={include_ts:!0},n}return r(t,e),t}(a),Dn=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.ts;return r.ts=i,r}return r(t,e),t}(o),Ln=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.keys;return(n=e.call(this)||this).method=i.GET,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={keys:a},n}return r(t,e),t}(a),Fn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return r(t,e),t}(o),qn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.metaCounter;return(n=e.call(this)||this).method=i.POST,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:a},n}return r(t,e),t}(a),zn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return r(t,e),t}(o),Bn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.metaCounter,o=t.upsert,u=void 0!==o&&o,l=t.mode,c=void 0===l?"set":l;return(n=e.call(this)||this).method=i.PUT,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:a,upsert:u,mode:c},n}return r(t,e),t}(a),jn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return r(t,e),t}(o),Kn=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return r(t,e),t}(M),Qn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.key;return(n=e.call(this)||this).method=i.DELETE,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metacounter/").concat(a),n.params={},n}return r(t,e),t}(a);!function(e){function t(t,n){return e.call(this,t,n)||this}r(t,e)}(o);var Gn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType;return(n=e.call(this)||this).method=i.DELETE,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={},n}return r(t,e),t}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var Vn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.userId,o=t.seconds,u=t.description;return(n=e.call(this)||this).method=i.POST,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/mute"),n.params={user_id:a,seconds:o,description:u},n}return r(t,e),t}(a);!function(e){function t(t,n){return e.call(this,t,n)||this}r(t,e)}(o);var Hn=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Bt(t,r.data),i}return r(t,e),t}(M),Wn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.userId;return(n=e.call(this)||this).method=i.DELETE,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/mute/").concat(encodeURIComponent(a)),n}return r(t,e),t}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var Yn=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Bt(t,r.data),i}return r(t,e),t}(M),Jn=function(t){function n(n){var r=this,s=n.channelUrl,a=n.channelType,o=n.userId,u=n.seconds,l=n.description;return(r=t.call(this)||this).method=i.POST,r.path="".concat(T(a),"/").concat(encodeURIComponent(s),"/ban"),r.params=e({user_id:o,seconds:u,description:l}),r}return r(n,t),n}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var Xn=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Bt(t,r.data),r.data.member_count&&(i.memberCount=r.data.member_count),r.data.joined_member_count&&(i.joinedMemberCount=r.data.joined_member_count),i}return r(t,e),t}(M),Zn=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.userId;return(n=e.call(this)||this).method=i.DELETE,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/ban/").concat(encodeURIComponent(a)),n}return r(t,e),t}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var $n=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Bt(t,r.data),i}return r(t,e),t}(M),er=function(e){function t(t){var n=this,r=t.channelUrl,s=t.channelType,a=t.freezing;return(n=e.call(this)||this).method=i.PUT,n.path="".concat(T(s),"/").concat(encodeURIComponent(r),"/freeze"),n.params={freeze:a},n}return r(t,e),t}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var tr=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.freeze=r.data.freeze,i}return r(t,e),t}(M),nr=function(e){return e instanceof Z?e._custom?"custom":e.name:e},rr=function(e){if(e instanceof Z&&e._custom)return e.name},ir=function(t){function n(n){var r=this,s=n.channelUrl,a=n.channelType,o=n.category,u=n.userId,l=n.description;return(r=t.call(this)||this).method=i.POST,r.path="".concat(J(a),"/").concat(encodeURIComponent(s)),r.params=e({report_category:nr(o),reporting_user_id:u,report_description:l,custom_report_category_name:rr(o)}),r}return r(n,t),n}(a),sr=function(t){function n(n){var r=this,s=n.channelUrl,a=n.channelType,o=n.category,u=n.userId,l=n.offendingUserId,c=n.description;return(r=t.call(this)||this).method=i.POST,r.path="".concat(X,"/users/").concat(l),r.params=e({channel_url:s,channel_type:a===I.OPEN?"open_channels":"group_channels",report_category:nr(o),reporting_user_id:u,report_description:c,custom_report_category_name:rr(o)}),r}return r(n,t),n}(a),ar=function(t){function n(n){var r=this,s=n.channelUrl,a=n.channelType,o=n.category,u=n.userId,l=n.offendingUserId,c=n.messageId,d=n.description;return(r=t.call(this)||this).method=i.POST,r.path="".concat(J(a),"/").concat(encodeURIComponent(s),"/messages/").concat(c),r.params=e({report_category:nr(o),reporting_user_id:u,report_description:d,offending_user_id:l,custom_report_category_name:rr(o)}),r}return r(n,t),n}(a),or=function(n){function i(r){var i=[];return r.mentionType===E.USERS&&(r.mentionedUserIds?i=r.mentionedUserIds:r.mentionedUsers&&(i=r.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"MESG",ackRequired:!0,payload:e(t({channel_url:r.channelUrl,message:r.message,data:r.data,custom_type:r.customType,metaarray:r.metaArrays,mention_type:r.mentionType,mentioned_user_ids:i,mentioned_message_template:r.mentionedMessageTemplate,target_langs:r.translationTargetLanguages,push_option:r.pushNotificationDeliveryOption&&r.pushNotificationDeliveryOption!==L.DEFAULT?r.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:r.appleCriticalAlertOptions,silent:r.silent,reply_to_channel:r.isReplyToChannel,parent_message_id:r.parentMessageId?r.parentMessageId:null,req_id:r.reqId,poll_id:r.pollId,pin_message:r.isPinnedMessage,extended_message_payload:r.extendedMessagePayload}))})||this}return r(i,n),i}(w),ur=function(e){function t(t,r,i){var s,a,o,u,l=this;(l=e.call(this,t,"MESG",i)||this).message=new dt(t,i);var c=n.of(t).sdkState;return l.isMentioned=F(l.message.mentionType,null!==(o=null!==(s=l.message.mentionedUserIds)&&void 0!==s?s:null===(a=l.message.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})))&&void 0!==o?o:[],c.userId),l.forceUpdateLastMessage=null!==(u=i.force_update_last_message)&&void 0!==u&&u,l}return r(t,e),t}(M),lr=function(n){function i(r){var i=null;return r.mentionType===E.USERS&&(r.mentionedUserIds?i=r.mentionedUserIds:r.mentionedUsers&&(i=r.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"MEDI",ackRequired:!0,payload:e(t({channel_url:r.channelUrl,msg_id:r.messageId,message:r.message,data:r.data,custom_type:r.customType,metaarray:r.metaArrayParams,mention_type:r.mentionType,mentioned_user_ids:i,mentioned_message_template:r.mentionedMessageTemplate,apple_critical_alert_options:r.appleCriticalAlertOptions?Be.payloadify(r.appleCriticalAlertOptions):null,poll_id:r.pollId}))})||this}return r(i,n),i}(w),cr=function(e){function i(r,i,s){var a,o,u,l,c,d=this;(d=e.call(this,r,"MEDI",s)||this).message=new dt(r,s);var h=n.of(r).sdkState;return d.mentionCountChange=$({mentionType:null===(a=s.old_values)||void 0===a?void 0:a.mention_type,mentionedUserIds:null!==(u=null===(o=s.old_values)||void 0===o?void 0:o.mentioned_user_ids)&&void 0!==u?u:[]},t({mentionType:d.message.mentionType,mentionedUserIds:null!==(l=d.message.mentionedUserIds)&&void 0!==l?l:null===(c=d.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))}),h.userId),d}return r(i,e),i}(M),dr=function(n){function i(r){var i=null;return r.mentionType===E.USERS&&(r.mentionedUserIds?i=r.mentionedUserIds:r.mentionedUsers&&(i=r.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"FEDI",ackRequired:!0,payload:e(t({channel_url:r.channelUrl,msg_id:r.messageId,data:r.data,custom_type:r.customType,metaarray:r.metaArrayParams,mention_type:r.mentionType,mentioned_user_ids:i,apple_critical_alert_options:r.appleCriticalAlertOptions}))})||this}return r(i,n),i}(w),hr=function(e){function i(r,i,s){var a,o,u,l,c,d=this;(d=e.call(this,r,"FEDI",s)||this).message=new vt(r,s);var h=n.of(r).sdkState;return d.mentionCountChange=$({mentionType:null===(a=s.old_values)||void 0===a?void 0:a.mention_type,mentionedUserIds:null!==(u=null===(o=s.old_values)||void 0===o?void 0:o.mentioned_user_ids)&&void 0!==u?u:[]},t({mentionType:d.message.mentionType,mentionedUserIds:null!==(l=d.message.mentionedUserIds)&&void 0!==l?l:null===(c=d.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))}),h.userId),d}return r(i,e),i}(M),fr=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,a=t.reactionKey,o=e.call(this)||this;return o.method=i.POST,o.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return r(t,e),t}(a),pr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.reactionEvent=new De(n),r}return r(t,e),t}(o),mr=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,a=t.reactionKey,o=e.call(this)||this;return o.method=i.DELETE,o.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return r(t,e),t}(a),vr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.reactionEvent=new De(u({},n)),r}return r(t,e),t}(o),_r=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,a=t.translationTargetLanguages,o=e.call(this)||this;return o.method=i.POST,o.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(s),"/translation"),o.params={target_langs:a},o}return r(t,e),t}(a),yr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new dt(t,n),r}return r(t,e),t}(o),gr=function(n){function s(r){var s,a=this;a=n.call(this)||this;var o=[];r.mentionType===E.USERS&&(r.mentionedUserIds?o=r.mentionedUserIds:r.mentionedUsers&&(o=r.mentionedUsers.map((function(e){return e.userId}))));var u=r.channelType,l=r.channelUrl;return a.method=i.POST,a.path="".concat(T(u),"/").concat(encodeURIComponent(l),"/scheduled_messages"),a.params=e(t({req_id:r.reqId,scheduled_at:r.scheduledAt,message_type:ee.USER,message:r.message,custom_type:r.customType,data:r.data,mention_type:r.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(s=r.metaArrays)||void 0===s?void 0:s.map((function(e){return Ke.payloadify(e)})),apple_critical_alert_options:r.appleCriticalAlertOptions?Be.payloadify(r.appleCriticalAlertOptions):null,target_langs:r.translationTargetLanguages,push_option:r.pushNotificationDeliveryOption})),a}return r(s,n),s}(a),br=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new dt(t,n),r}return r(t,e),t}(o),Ir=function(e){function n(n){var r,s,a=this;a=e.call(this)||this;var o=[];n.mentionType===E.USERS&&(n.mentionedUserIds?o=n.mentionedUserIds:n.mentionedUsers&&(o=n.mentionedUsers.map((function(e){return e.userId}))));var u=n.channelType,l=n.channelUrl;return a.method=i.POST,a.path="".concat(T(u),"/").concat(encodeURIComponent(l),"/scheduled_messages"),a.params=t({req_id:n.reqId,scheduled_at:n.scheduledAt,message_type:ee.FILE,url:n.fileUrl,file_name:n.fileName,file_size:n.fileSize,file_type:n.mimeType,thumbnails:null===(r=n._thumbnails)||void 0===r?void 0:r.map((function(e){return ke.payloadify(e)})),custom_type:n.customType,data:n.data,require_auth:n.requireAuth,mention_type:n.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(s=n.metaArrays)||void 0===s?void 0:s.map((function(e){return Ke.payloadify(e)})),apple_critical_alert_options:n.appleCriticalAlertOptions?Be.payloadify(n.appleCriticalAlertOptions):null,push_option:n.pushNotificationDeliveryOption}),a}return r(n,e),n}(a),Er=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new vt(t,n),r}return r(t,e),t}(o),wr=function(e){function t(t){var n=t.pollId,r=t.title,s=t.data,a=t.allowUserSuggestion,o=t.allowMultipleVotes,u=t.closeAt,l=e.call(this)||this;return l.method=i.PUT,l.path="".concat(ne,"/").concat(encodeURIComponent(n)),l.params={title:r,data:s,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},l}return r(t,e),t}(a),Tr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new S(t,n),r}return r(t,e),t}(o),Mr=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=i.DELETE,r.path="".concat(ne,"/").concat(encodeURIComponent(n)),r}return r(t,e),t}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var Sr=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=i.PUT,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/close"),r}return r(t,e),t}(a),Ur=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new S(t,n),r}return r(t,e),t}(o),Ar=function(e){function t(t){var n=t.channelUrl,r=t.channelType,s=t.pollId,a=t.optionText,o=e.call(this)||this;return o.method=i.POST,o.path="".concat(ne,"/").concat(encodeURIComponent(s),"/options"),o.params={channel_url:n,channel_type:r,text:a},o}return r(t,e),t}(a),Nr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new S(t,n),r}return r(t,e),t}(o),Cr=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,s=t.optionText,a=e.call(this)||this;return a.method=i.PUT,a.path="".concat(ne,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),a.params={text:s},a}return r(t,e),t}(a),Or=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new S(t,n),r}return r(t,e),t}(o),kr=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,s=e.call(this)||this;return s.method=i.DELETE,s.path="".concat(ne,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),s}return r(t,e),t}(a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r(t,e)}(o);var Pr=function(t){function n(n){var r=n.reqId,i=n.channelType,s=n.channelUrl,a=n.pollId,o=n.pollOptionIds;return t.call(this,{code:"VOTE",ackRequired:!0,payload:e({req_id:r,channel_type:i===I.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:a,option_ids:o})})||this}return r(n,t),n}(w),Rr=function(e){function t(t,n,r){var i=e.call(this,t,"VOTE",r)||this;return i.event=new re(r),i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return r(t,e),t}(M),xr=100,Dr="GroupChannel",Lr="url",Fr=100,qr="Message",zr="messageId",Br=100,jr="NotificationMessage",Kr="notificationId",Qr="Poll",Gr="pollId",Vr=100,Hr="FeedChannel",Wr="url",Yr="UserInfo",Jr="userId";function Xr(e){var n,r,i;return null!==(n=e.messageParams)&&void 0!==n?n:t(u(u({},e),{isReplyToChannel:!1,mentionedUserIds:null!==(r=e.mentionedUserIds)&&void 0!==r?r:null===(i=e.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),pushNotificationDeliveryOption:L.DEFAULT,isPinnedMessage:!1,fileInfoList:e.fileInfoList.map((function(e){var t;return{fileUrl:e.plainUrl,fileName:e.fileName,fileSize:e.fileSize,mimeType:e.mimeType,thumbnailSizes:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),_thumbnails:e.thumbnails,_uploadedMetaData:{requireAuth:e._requireAuth,isUploaded:!0}}}))}))}var Zr=u(u({},Qt),{fileInfoList:[],message:""}),$r=function(e){return(Q(e.file)||h("string",e.fileUrl))&&h("string",e.fileName,!0)&&h("string",e.mimeType,!0)&&h("number",e.fileSize,!0)&&(void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return e.maxWidth>0&&e.maxHeight>0})))},ei=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onFileUploaded=W,t}return r(t,e),t.prototype._triggerOnFileUploaded=function(e,t,n,r){this._onFileUploaded(e,t,n,r)},t.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},t.prototype.onPending=function(t){return e.prototype.onPending.call(this,t),this},t.prototype.onFailed=function(t){return e.prototype.onFailed.call(this,t),this},t.prototype.onSucceeded=function(t){return e.prototype.onSucceeded.call(this,t),this},t}(Kt),ti=function(e){function t(t,n){var r=e.call(this,t)||this;return r.message=null,r.message=mt(t,n.message),r}return r(t,e),t}(c),ni=function(t){function n(n){var r=this,s=n.channelType,a=n.channelUrl,o=n.limit,u=n.token,l=n.includeReactions,c=n.includeMetaArray,d=n.includeParentMessageInfo,h=n.includeThreadInfo,f=n.includePollDetails;return(r=t.call(this)||this).method=i.GET,r.path="".concat(T(s),"/").concat(encodeURIComponent(a),"/pinned_messages"),r.params=e({limit:o,token:u,include_reactions_summary:l,with_sorted_meta_array:c,include_thread_info:h,include_parent_message_info:d,include_poll_details:f}),r}return r(n,t),n}(a),ri=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.pinned_messages,s=n.has_more,a=n.next;return r.pinnedMessages=i.map((function(e){return new ti(t,e)})),r.hasMore=s,r.token=a,r}return r(t,e),t}(o),ii=function(e){function t(t,n,r,i){var s=e.call(this,t,n,r,i)||this;return s.includeMetaArray=i.includeMetaArray,s.includeReactions=i.includeReactions,s.includeParentMessageInfo=i.includeParentMessageInfo,s.includeThreadInfo=i.includeThreadInfo,s.includePollDetails=i.includePollDetails,s}return r(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&h("boolean",this.includeMetaArray,!0)&&h("boolean",this.includeReactions,!0)&&h("boolean",this.includeParentMessageInfo,!0)&&h("boolean",this.includeThreadInfo,!0)&&h("boolean",this.includePollDetails,!0)},t.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a,o;return A(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid).requestQueue,t=new ni(u(u({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=l.sent(),i=r.as(ri),s=i.pinnedMessages,a=i.hasMore,o=i.token,this._token=o,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},t}(Y),si=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,a=e.call(this)||this;return a.method=i.POST,a.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/pin"),a}return r(t,e),t}(a);!function(e){function t(t,n){return e.call(this,t,n)||this}r(t,e)}(o);var ai=function(e){function t(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,a=e.call(this)||this;return a.method=i.DELETE,a.path="".concat(T(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/pin"),a}return r(t,e),t}(a);!function(e){function t(t,n){return e.call(this,t,n)||this}r(t,e)}(o);var oi,ui=2;!function(e){e.SEND="send",e.RESEND="resend",e.COPY="copy"}(oi||(oi={}));var li,ci=function(i){function s(e,t){var n,r,s,a,o,u,c,d=this;return(d=i.call(this,e)||this)._name="",d._createdAt=0,d.pinnedMessageIds=[],d.channelType=I.BASE,d.coverUrl="",d.customType="",d.data="",d.isFrozen=!1,d.isEphemeral=!1,d.creator=null,d._messageCollectionLastAccessedAt=0,d._url=t.channel_url,d._name=null!==(n=t.name)&&void 0!==n?n:"",d._createdAt=1e3*t.created_at,d.coverUrl=null!==(r=t.cover_url)&&void 0!==r?r:"",d.customType=null!==(s=t.custom_type)&&void 0!==s?s:"",d.data=null!==(a=t.data)&&void 0!==a?a:"",d.isFrozen=null!==(o=t.freeze)&&void 0!==o&&o,d.isEphemeral=null!==(u=t.is_ephemeral)&&void 0!==u&&u,d.creator=t.created_by?new l(d._iid,t.created_by):null,t.metadata&&Object.keys(t.metadata).length>0&&t.ts?(d._cachedMetaData=new Map,Object.keys(t.metadata).forEach((function(e){d._cachedMetaData.set(e,{value:t.metadata[e],isRemoved:!1,updatedAt:t.ts})}))):"string"==typeof t.metadata&&(d._cachedMetaData=new Map(Object.entries(JSON.parse(t.metadata)))),d.pinnedMessageIds=null!==(c=t.pinned_message_ids)&&void 0!==c?c:[],d}return r(s,i),Object.defineProperty(s.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return u(u({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},s.payloadify=function(n,r){void 0===r&&(r=!1);var s=u(u({},i.payloadify.call(this,n)),{channel_url:n.url,name:n.name,cover_url:n.coverUrl,custom_type:n.customType,data:n.data,freeze:n.isFrozen,is_ephemeral:n.isEphemeral,created_by:n.creator?l.payloadify(n.creator):null,created_at:n.createdAt/1e3,metadata:n.cachedMetaData,pinned_message_ids:n.pinnedMessageIds});return r?s:e(t(s))},s.prototype.isGroupChannel=function(){return this.channelType===I.GROUP},s.prototype.isOpenChannel=function(){return this.channelType===I.OPEN},s.prototype.isFeedChannel=function(){return this.channelType===I.FEED},Object.defineProperty(s.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData?(this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e):e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),s.prototype._serializeCachedMetaData=function(){return this._cachedMetaData?{cachedMetaData:JSON.stringify(Object.fromEntries(this._cachedMetaData))}:{}},s.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now()},s.prototype._update=function(e){Object.assign(this,e)},s.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){n._cachedMetaData||(n._cachedMetaData=new Map);var i=n._cachedMetaData.get(r);(!i||i.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))},s.prototype._updateCachedMetaData=function(e,t){var n=this,r=!1;return this._cachedMetaData?this._cachedMetaData.forEach((function(i,s){var a;i.updatedAt<=t&&(n._cachedMetaData.set(s,{value:null!==(a=e[s])&&void 0!==a?a:i.value,isRemoved:!e[s],updatedAt:t}),r=!0)})):(this._cachedMetaData=new Map,Object.keys(e).forEach((function(r){n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})})),r=!0),{isUpdated:r}},s.prototype._removeFromCachedMetaData=function(e,t){var n=this;this._cachedMetaData&&e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!0,r.updatedAt=t)}))},s.prototype._clearCachedMetaData=function(){this._cachedMetaData&&this._cachedMetaData.clear()},s.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)},s.prototype._generateRequestId=function(){return"rq-".concat(se())},s.prototype.isIdentical=function(e){return e&&this.url===e.url},s.prototype.isEqual=function(e){return y(this,e)},s.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new pn(this._iid,this.url,this.channelType,e)},s.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new yn(this._iid,this.url,this.channelType,e)},s.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new In(this._iid,this.url,this.channelType,e)},s.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new mn(this._iid,this.url,this.channelType,e)},s.prototype.createPinnedMessageListQuery=function(e){return void 0===e&&(e={}),new ii(this._iid,this.url,this.channelType,e)},s.prototype.addOperators=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(d("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new En({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(r)];case 1:return i.sent(),[2]}}))}))},s.prototype.removeOperators=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(d("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new wn({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(r)];case 1:return i.sent(),[2]}}))}))},s.prototype.getMyMutedInfo=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a,o,u,l,c,d;return A(this,(function(h){switch(h.label){case 0:return e=n.of(this._iid),t=e.sdkState,r=e.requestQueue,i=new Tn({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,r.send(i)];case 1:return s=h.sent(),a=s.as(Mn),o=a.isMuted,u=a.startAt,l=a.endAt,c=a.remainingDuration,d=a.description,[2,{isMuted:o,startAt:u,endAt:l,remainingDuration:c,description:d}]}}))}))},s.prototype.getMetaData=function(e){return U(this,void 0,void 0,(function(){var t,r,i,s,a,o;return A(this,(function(u){switch(u.label){case 0:return x(d("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new Sn({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(r)];case 1:return i=u.sent(),s=i.as(Un),a=s.metadata,o=s.ts,this._upsertCachedMetaData(a,o),[2,a]}}))}))},s.prototype.getAllMetaData=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return e=n.of(this._iid).requestQueue,t=new Sn({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return r=o.sent(),i=r.as(Un),s=i.metadata,a=i.ts,this._updateCachedMetaData(s,a),[2,s]}}))}))},s.prototype.createMetaData=function(e){return U(this,void 0,void 0,(function(){var t,r,i,s;return A(this,(function(a){switch(a.label){case 0:return t=n.of(this._iid).requestQueue,r=new An({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(r)];case 1:return i=a.sent(),s=i.as(Nn).metaData,this._upsertCachedMetaData(s,0),[2,s]}}))}))},s.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),U(this,void 0,void 0,(function(){var r,i,s,a,o,u;return A(this,(function(l){switch(l.label){case 0:return r=n.of(this._iid).requestQueue,i=new Cn({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,r.send(i)];case 1:return s=l.sent(),a=s.as(On),o=a.metadata,u=a.ts,this._upsertCachedMetaData(o,u),[2,o]}}))}))},s.prototype.deleteMetaData=function(e){return U(this,void 0,void 0,(function(){var t,r,i,s;return A(this,(function(a){switch(a.label){case 0:return x(h("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new Pn({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(r)];case 1:return i=a.sent(),s=i.as(Rn).ts,this._removeFromCachedMetaData([e],s),[2]}}))}))},s.prototype.deleteAllMetaData=function(){return U(this,void 0,void 0,(function(){var e,t,r,i;return A(this,(function(s){switch(s.label){case 0:return e=n.of(this._iid).requestQueue,t=new xn({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return r=s.sent(),i=r.as(Dn).ts,this._removeFromCachedMetaData(p([],m(this._cachedMetaData.keys()),!1),i),[2]}}))}))},s.prototype.getMetaCounters=function(e){return U(this,void 0,void 0,(function(){var t,r,i;return A(this,(function(s){switch(s.label){case 0:return x(d("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new Ln({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(r)];case 1:return i=s.sent(),[2,i.as(Fn).metaCounter]}}))}))},s.prototype.getAllMetaCounters=function(){return U(this,void 0,void 0,(function(){var e,t,r;return A(this,(function(i){switch(i.label){case 0:return e=n.of(this._iid).requestQueue,t=new Ln({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return r=i.sent(),[2,r.as(Fn).metaCounter]}}))}))},s.prototype.createMetaCounters=function(e){return U(this,void 0,void 0,(function(){var t,r,i;return A(this,(function(s){switch(s.label){case 0:return t=n.of(this._iid).requestQueue,r=new qn({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(r)];case 1:return i=s.sent(),[2,i.as(zn).metaCounter]}}))}))},s.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),U(this,void 0,void 0,(function(){var r,i,s;return A(this,(function(a){switch(a.label){case 0:return r=n.of(this._iid).requestQueue,i=new Bn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(jn).metaCounter]}}))}))},s.prototype.increaseMetaCounters=function(e){return U(this,void 0,void 0,(function(){var t,r,i;return A(this,(function(s){switch(s.label){case 0:return t=n.of(this._iid).requestQueue,r=new Bn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(r)];case 1:return i=s.sent(),[2,i.as(jn).metaCounter]}}))}))},s.prototype.decreaseMetaCounters=function(e){return U(this,void 0,void 0,(function(){var t,r,i;return A(this,(function(s){switch(s.label){case 0:return t=n.of(this._iid).requestQueue,r=new Bn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(r)];case 1:return i=s.sent(),[2,i.as(jn).metaCounter]}}))}))},s.prototype.deleteMetaCounter=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(h("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new Qn({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(r)];case 1:return i.sent(),[2]}}))}))},s.prototype.deleteAllMetaCounters=function(){return U(this,void 0,void 0,(function(){var e,t;return A(this,(function(r){switch(r.label){case 0:return e=n.of(this._iid).requestQueue,t=new Gn({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return r.sent(),[2]}}))}))},s.prototype.muteUser=function(e,t,n){return U(this,void 0,void 0,(function(){return A(this,(function(r){return[2,this.muteUserWithUserId(e.userId,t,n)]}))}))},s.prototype.muteUserWithUserId=function(e,t,r){return U(this,void 0,void 0,(function(){var i,s;return A(this,(function(a){switch(a.label){case 0:return x(h("string",e)&&h("number",t,!0)&&h("string",r,!0)).throw(O.invalidParameters),i=n.of(this._iid).requestQueue,s=new Vn({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:r}),[4,i.send(s)];case 1:return a.sent(),[2]}}))}))},s.prototype.unmuteUser=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){return[2,this.unmuteUserWithUserId(e.userId)]}))}))},s.prototype.unmuteUserWithUserId=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(h("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new Wn({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(r)];case 1:return i.sent(),[2]}}))}))},s.prototype.banUser=function(e,t,n){return U(this,void 0,void 0,(function(){return A(this,(function(r){return[2,this.banUserWithUserId(e.userId,t,n)]}))}))},s.prototype.banUserWithUserId=function(e,t,r){return U(this,void 0,void 0,(function(){var i,s;return A(this,(function(a){switch(a.label){case 0:return x(h("string",e)&&h("number",t,!0)&&h("string",r,!0)).throw(O.invalidParameters),i=n.of(this._iid).requestQueue,s=new Jn({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:r}),[4,i.send(s)];case 1:return a.sent(),[2]}}))}))},s.prototype.unbanUser=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){return[2,this.unbanUserWithUserId(e.userId)]}))}))},s.prototype.unbanUserWithUserId=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(h("string",e)).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new Zn({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(r)];case 1:return i.sent(),[2]}}))}))},s.prototype.freeze=function(){return U(this,void 0,void 0,(function(){var e,t;return A(this,(function(r){switch(r.label){case 0:return e=n.of(this._iid).requestQueue,t=new er({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return r.sent(),this.isFrozen=!0,[2]}}))}))},s.prototype.unfreeze=function(){return U(this,void 0,void 0,(function(){var e,t;return A(this,(function(r){switch(r.label){case 0:return e=n.of(this._iid).requestQueue,t=new er({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return r.sent(),this.isFrozen=!1,[2]}}))}))},s.prototype.getMessagesByMessageId=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},Ut),t),x(h("number",e)&&At(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},s.prototype.getMessagesByTimestamp=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},Ut),t),x(h("number",e)&&At(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},s.prototype.getMessageChangeLogsSinceTimestamp=function(e,t){return void 0===t&&(t={}),U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},Nt),t),x(h("number",e)&&Ct(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},s.prototype.getMessageChangeLogsSinceToken=function(e,t){return void 0===t&&(t={}),U(this,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return n=u(u({},Nt),t),x(h("string",e)&&Ct(n)).throw(O.invalidParameters),[4,Xs.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},s.prototype._createPendingSendableMessagePayload=function(r,i,s){var a,o=n.of(this._iid).sessionManager;return e(t({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:r.parentMessageId,data:r.data,custom_type:r.customType,mention_type:r.mentionType,sorted_metaarray:r.metaArrays?r.metaArrays.map((function(e){return Ke.payloadify(e)})):null,apple_critical_alert_options:r.appleCriticalAlertOptions?Be.payloadify(r.appleCriticalAlertOptions):null,created_at:s,user:o.currentUser?je.payloadify(o.currentUser):null,req_id:i,request_state:k.PENDING,mentioned_user_ids:r.mentionedUserIds,mentioned_users:null===(a=r.mentionedUsers)||void 0===a?void 0:a.map((function(e){return l.payloadify(e)}))}))},s.prototype._createPendingUserMessage=function(t,n,r){var i,s,a={};if(t.translationTargetLanguages)try{for(var o=v(t.translationTargetLanguages),l=o.next();!l.done;l=o.next()){a[l.value]=""}}catch(e){i={error:e}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}var c=e(u(u({},this._createPendingSendableMessagePayload(t,n,r)),{type:g.USER,message:t.message,translations:a,extended_message_payload:t.extendedMessagePayload})),d=new dt(this._iid,c);return d.messageParams=t,d},s.prototype._createPendingScheduledUserMessage=function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},s.prototype._createPendingFileMessage=function(t,n,r){var i,s,a,o,l,c,d,h=e(u(u({},this._createPendingSendableMessagePayload(t,n,r)),{type:g.FILE,url:t.fileUrl,file:{name:null!==(i=t.fileName)&&void 0!==i?i:null===(s=t.file)||void 0===s?void 0:s.name,size:null!==(a=t.fileSize)&&void 0!==a?a:null===(o=t.file)||void 0===o?void 0:o.size,type:null!==(l=t.mimeType)&&void 0!==l?l:null===(c=t.file)||void 0===c?void 0:c.type,data:t.data},thumbnails:null===(d=t._thumbnails)||void 0===d?void 0:d.map((function(e){return ke.payloadify(e)})),message:t.message})),f=new vt(this._iid,h);return f.messageParams=t,f},s.prototype._createPendingMultipleFilesMessage=function(t,n,r){var i=e(u(u({},this._createPendingSendableMessagePayload(t,n,r)),{type:g.FILE,file:t.fileInfoList.length>0?{name:t.fileInfoList[0].fileName,size:t.fileInfoList[0].fileSize,type:t.fileInfoList[0].mimeType,data:t.data}:void 0,message:t.message})),s=new ht(this._iid,i);return s.messageParams=t,s},s.prototype._validateFailedFileMessageHasFile=function(e,t){var n;return Boolean(e.url)||Q(t)||Q(null===(n=e.messageParams)||void 0===n?void 0:n.file)},s.prototype._createPendingScheduledFileMessage=function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},s.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===j.REQUEST_CANCELED||t.code===j.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=k.CANCELED:n||(e.sendingStatus=k.FAILED)},s.prototype.sendUserMessage=function(e){var t=u(u({},Ht),e);return x(Xt(t)).throw(O.invalidParameters),this._sendUserMessage(t)},s.prototype._sendUserMessage=function(e,t,r){var i=this;void 0===t&&(t=oi.SEND);var s=n.of(this._iid),a=s.dispatcher,o=s.requestQueue,l=null!=r?r:this._generateRequestId(),c=Date.now(),d=new Kt;return K(2).then((function(){var r=i._createPendingUserMessage(e,l,c);a.dispatch(new N({messages:[r],source:t===oi.RESEND?C.LOCAL_MESSAGE_RESEND_STARTED:C.EVENT_MESSAGE_SENT_PENDING})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(e){return[2,d._trigger(r)]}))}))}));var s=new or(u(u({},e),{channelUrl:i.url,channelType:i.channelType,reqId:l}));o.send(s).then((function(e){var t=e.as(ur).message;a.dispatch(new N({messages:[t],source:C.EVENT_MESSAGE_SENT_SUCCESS})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(e){return[2,d._trigger(t)]}))}))}))})).catch((function(t){if(oe(t))throw t;K(2).then((function(){var r=i._createPendingUserMessage(e,l,c),s=n.of(i._iid).cacheContext,o=s.localCacheEnabled&&s.localCacheConfig.enableAutoResend&&ue(t.code);i._markMessageAsFailed(r,t,o),a.dispatch(new N({messages:[r],source:r.sendingStatus===k.PENDING?C.REQUEST_RESEND_MESSAGE:C.EVENT_MESSAGE_SENT_FAILED})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(e){return[2,d._triggerFailed(t,r)]}))}))}))}))}))})),d},s.prototype._autoResendUserMessage=function(e){return x(e instanceof dt&&!!e.messageParams).throw(O.invalidParameters),this._sendUserMessage(e.messageParams,oi.SEND,e.reqId)},s.prototype.resendUserMessage=function(e){var t;return U(this,void 0,void 0,(function(){var n,r;return A(this,(function(i){return x(e instanceof dt&&!e.scheduledInfo).throw(O.invalidParameters),n=new G,r=null!==(t=e.messageParams)&&void 0!==t?t:Jt(e),this._sendUserMessage(r,oi.RESEND,e.reqId).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},s.prototype.updateUserMessage=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return r=u(u({},ln),t),x(h("number",e)&&cn(r)).throw(O.invalidParameters),i=n.of(this._iid).requestQueue,s=new lr(u({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:r.metaArrays?{array:r.metaArrays,mode:"add",upsert:!0}:void 0},r)),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(cr).message]}}))}))},s.prototype.copyUserMessage=function(e,n){var r,i,a;return U(this,void 0,void 0,(function(){var o,l;return A(this,(function(c){return x(e instanceof s&&n instanceof dt&&n.sendingStatus===k.SUCCEEDED&&this.url===n.channelUrl&&!n.scheduledInfo).throw(O.invalidParameters),x(!n.poll).throw(O.notSupportedError),o=new G,l=null!==(r=n.messageParams)&&void 0!==r?r:t(u(u({},n),{mentionType:n.mentionType,mentionedUserIds:null!==(i=n.mentionedUserIds)&&void 0!==i?i:null===(a=n.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(n.translations),pushNotificationDeliveryOption:L.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(l).onSucceeded((function(e){o.resolve(e)})).onFailed((function(e){return o.reject(e)})),[2,o.promise]}))}))},s.prototype.translateUserMessage=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s;return A(this,(function(a){switch(a.label){case 0:return x(e instanceof dt&&e.messageId>0&&d("string",t)).throw(O.invalidParameters),r=n.of(this._iid).requestQueue,i=new _r({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(yr).message]}}))}))},s.prototype._createScheduledUserMessage=function(e,t){var r=this,i=n.of(this._iid).requestQueue,s=Date.now(),a=this._generateRequestId();K(2).then((function(){var n=r._createPendingScheduledUserMessage(e,a,s);ae((function(){return U(r,void 0,void 0,(function(){return A(this,(function(e){return[2,t._trigger(n)]}))}))}))}));var o=new gr(u({reqId:a,channelType:this.channelType,channelUrl:this.url},e));i.send(o).then((function(e){var n=e.as(br).message;ae((function(){return U(r,void 0,void 0,(function(){return A(this,(function(e){return[2,t._trigger(n)]}))}))}))})).catch((function(n){if(oe(n))throw n;K(2).then((function(){var i=r._createPendingScheduledUserMessage(e,a,s);r._markMessageAsFailed(i,n),ae((function(){return U(r,void 0,void 0,(function(){return A(this,(function(e){return[2,t._triggerFailed(n,i)]}))}))}))}))}))},s.prototype.sendFileMessage=function(e){var t=u(u({},tn),e);return x(an(t)).throw(O.invalidParameters),this._sendFileMessage(t)},s.prototype.sendMultipleFilesMessage=function(e){var t,r=u(u({},Zr),e),i=n.of(this._iid);x(function(e,t){return void 0===t&&(t=ie),Gt(e)&&h("string",e.message,!0)&&Array.isArray(e.fileInfoList)&&e.fileInfoList.length>=2&&e.fileInfoList.length<=t&&e.fileInfoList.every((function(e){return $r(e)}))}(r,null===(t=i.appInfo)||void 0===t?void 0:t.multipleFilesMessageFileCountLimit)).throw(O.invalidParameters);var s=!!e.fileInfoList.find((function(e){var t=i.appInfo.uploadSizeLimit;return e.file instanceof Blob&&e.file.size>t||e.fileSize>t}));return x(!s).throw(O.fileSizeLimitExceededError),this._sendMultipleFilesMessage(r)},s.prototype._sendFileMessage=function(e,t,r){var i=this;void 0===t&&(t=oi.SEND);var s=n.of(this._iid).dispatcher,a=Xs.of(this._iid).fileMessageQueue,o=null!=r?r:this._generateRequestId(),u=Date.now(),l=new Kt;return K(2).then((function(){var r=i._createPendingFileMessage(e,o,u);s.dispatch(new N({messages:[r],source:t===oi.RESEND?C.LOCAL_MESSAGE_RESEND_STARTED:C.EVENT_MESSAGE_SENT_PENDING})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(e){return[2,l._trigger(r)]}))}))})),a.request(i,o,e).then((function(e){s.dispatch(new N({messages:[e],source:C.EVENT_MESSAGE_SENT_SUCCESS})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(t){return[2,l._trigger(e)]}))}))}))})).catch((function(t){if(oe(t))throw t;K(2).then((function(){var r=i._createPendingFileMessage(e,o,u),a=n.of(i._iid).cacheContext,c=a.localCacheEnabled&&a.localCacheConfig.enableAutoResend&&ue(t.code);i._markMessageAsFailed(r,t,c),s.dispatch(new N({messages:[r],source:r.sendingStatus===k.PENDING?C.REQUEST_RESEND_MESSAGE:t.code===j.FILE_UPLOAD_CANCEL_FAILED?C.LOCAL_MESSAGE_CANCELED:C.EVENT_MESSAGE_SENT_FAILED})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(e){return[2,l._triggerFailed(t,r)]}))}))}))}))}))})),l},s.prototype._autoResendFileMessage=function(e){x(e instanceof vt&&!!e.messageParams).throw(O.invalidParameters);var t=n.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,oi.SEND,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))},s.prototype._sendMultipleFilesMessage=function(e,t,r){var i=this,s=n.of(this._iid).dispatcher,a=Xs.of(this._iid).fileMessageQueue,o=null!=r?r:this._generateRequestId(),u=Date.now(),l=new ei;return K(2).then((function(){var n=i._createPendingMultipleFilesMessage(e,o,u);s.dispatch(new N({messages:[n],source:t===oi.RESEND?C.LOCAL_MESSAGE_RESEND_STARTED:C.EVENT_MESSAGE_SENT_PENDING})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(e){return[2,l._trigger(n)]}))}))})),a.request(i,o,e,{requestHandler:l,isCopy:t===oi.COPY}).then((function(e){s.dispatch(new N({messages:[e],source:C.EVENT_MESSAGE_SENT_SUCCESS})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(t){return[2,l._trigger(e)]}))}))}))})).catch((function(t){if(oe(t))throw t;K(2).then((function(){var n=i._createPendingMultipleFilesMessage(e,o,u);i._markMessageAsFailed(n,t),s.dispatch(new N({messages:[n],source:C.EVENT_MESSAGE_SENT_FAILED})),ae((function(){return U(i,void 0,void 0,(function(){return A(this,(function(e){return[2,l._triggerFailed(t,n)]}))}))}))}))}))})),l},s.prototype._createScheduledFileMessage=function(e,t,r,i){var s=this,a=n.of(this._iid).requestQueue,o=new Ir(u(u({reqId:r,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));a.send(o).then((function(e){var n=e.as(Er).message;ae((function(){return U(s,void 0,void 0,(function(){return A(this,(function(e){return[2,t._trigger(n)]}))}))}))})).catch((function(n){if(oe(n))throw n;K(2).then((function(){var a=s._createPendingScheduledFileMessage(e,r,i);s._markMessageAsFailed(a,n),ae((function(){return U(s,void 0,void 0,(function(){return A(this,(function(e){return[2,t._triggerFailed(n,a)]}))}))}))}))}))},s.prototype.sendFileMessages=function(e){var t,n;x(e.every((function(e){return an(u(u({},tn),e))}))).throw(O.invalidParameters);var r=new Kt;try{for(var i=v(e),s=i.next();!s.done;s=i.next()){var a=s.value;this.sendFileMessage(a).onPending((function(e){return r._trigger(e)})).onFailed((function(e,t){return r._triggerFailed(e,t)})).onSucceeded((function(e){return r._trigger(e)}))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},s.prototype.resendFileMessage=function(e,t){return U(this,void 0,void 0,(function(){var n,r,i;return A(this,(function(s){return n=this._validateFailedFileMessageHasFile(e,t),x(e instanceof vt&&n&&!e.scheduledInfo).throw(O.invalidParameters),r=new G,i=sn(e,t),this._sendFileMessage(i,oi.RESEND,e.reqId).onFailed((function(e){return r.reject(e)})).onSucceeded((function(e){return r.resolve(e)})),[2,r.promise]}))}))},s.prototype.resendMessage=function(e,t){var n,r;if(x(e instanceof st&&!e.scheduledInfo&&e.isResendable).throw(O.invalidParameters),e.isUserMessage()){var i=null!==(n=e.messageParams)&&void 0!==n?n:Jt(e);return this._sendUserMessage(i,oi.RESEND,e.reqId)}if(e.isFileMessage()){var s=this._validateFailedFileMessageHasFile(e,t);x(s).throw(O.invalidParameters);i=null!==(r=e.messageParams)&&void 0!==r?r:sn(e,t);return this._sendFileMessage(i,oi.RESEND,e.reqId)}if(e.isMultipleFilesMessage())throw O.channelTypeNotSupportedError},s.prototype.updateFileMessage=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return r=u(u({},dn),t),x(h("number",e)&&function(e){return un(e)}(r)).throw(O.invalidParameters),i=n.of(this._iid).requestQueue,s=new dr(u({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:r.metaArrays?{array:r.metaArrays,mode:"add",upsert:!0}:void 0},r)),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(hr).message]}}))}))},s.prototype.uploadFile=function(e){return U(this,void 0,void 0,(function(){var t,r,i,s,a,o,u;return A(this,(function(l){switch(l.label){case 0:return t=n.of(this._iid).requestQueue,r=se(),(i=new Pe({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:r})).uploadProgressHandler=e.progressHandler,e.uploadStartedHandler&&e.uploadStartedHandler(r),[4,t.send(i)];case 1:return s=l.sent(),a=s.as(Re),o=a.url,u=a.thumbnails,[2,{requestId:r,url:o,thumbnails:u}]}}))}))},s.prototype.cancelUploadingFileMessage=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){return x(h("string",e)).throw(O.invalidParameters),Xs.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},s.prototype.copyFileMessage=function(e,n){var r,i,a;return U(this,void 0,void 0,(function(){var o,l;return A(this,(function(c){return x(e instanceof s&&n instanceof vt&&n.sendingStatus===k.SUCCEEDED&&this.url===n.channelUrl&&!n.scheduledInfo).throw(O.invalidParameters),o=new G,l=t(u(u({},n),{fileUrl:n.url,fileName:n.name,fileSize:n.size,mimeType:n.type,mentionType:n.mentionType,mentionedUserIds:null!==(r=n.mentionedUserIds)&&void 0!==r?r:null===(i=n.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),pushNotificationDeliveryOption:L.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(a=n.thumbnails)||void 0===a?void 0:a.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:n.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(l).onSucceeded((function(e){return o.resolve(e)})).onFailed((function(e){return o.reject(e)})),[2,o.promise]}))}))},s.prototype.copyMessage=function(e,t){x(e instanceof s&&t instanceof st&&t.sendingStatus===k.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(O.invalidParameters);var n=t,r=e;if(n.isUserMessage()){x(!n.poll).throw(O.notSupportedError);var i=Wt(n);return r._sendUserMessage(i)}if(n.isFileMessage()){i=nn(n);return r._sendFileMessage(i)}if(t.isMultipleFilesMessage())throw O.channelTypeNotSupportedError},s.prototype.deleteMessage=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(e instanceof it).throw(O.invalidParameters),e.messageId>0?(t=n.of(this._iid).requestQueue,r=new de({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,messageToken:e instanceof st?e._messageToken:void 0}),[4,t.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},s.prototype.addReaction=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s;return A(this,(function(a){switch(a.label){case 0:return x(e instanceof it&&e.messageId>0&&h("string",t)).throw(O.invalidParameters),r=n.of(this._iid).requestQueue,i=new fr({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(pr).reactionEvent]}}))}))},s.prototype.deleteReaction=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s;return A(this,(function(a){switch(a.label){case 0:return x(e instanceof it&&e.messageId>0&&h("string",t)).throw(O.invalidParameters),r=n.of(this._iid).requestQueue,i=new mr({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(vr).reactionEvent]}}))}))},s.prototype._updateUserMessageMetaArray=function(e,t,r,i){return U(this,void 0,void 0,(function(){var s,a,o,u,l,c;return A(this,(function(d){switch(d.label){case 0:return s=n.of(this._iid),a=s.dispatcher,o=s.requestQueue,u=new lr({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:r,upsert:i}}),[4,o.send(u)];case 1:return l=d.sent(),c=l.as(cr).message,a.dispatch(new N({messages:[c],source:C.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},s.prototype._updateFileMessageMetaArray=function(e,t,r,i){return U(this,void 0,void 0,(function(){var s,a,o,u,l,c;return A(this,(function(d){switch(d.label){case 0:return s=n.of(this._iid),a=s.dispatcher,o=s.requestQueue,u=new dr({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:r,upsert:i}}),[4,o.send(u)];case 1:return l=d.sent(),c=l.as(hr).message,a.dispatch(new N({messages:[c],source:C.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},s.prototype.createMessageMetaArrayKeys=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){return x(e instanceof it&&e.messageId>0&&d("string",t)).throw(O.invalidParameters),n=t.map((function(e){return new Ke({key:e})})),e instanceof vt?[2,this._updateFileMessageMetaArray(e.messageId,n,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"add",!0)]}))}))},s.prototype.deleteMessageMetaArrayKeys=function(e,t){return U(this,void 0,void 0,(function(){var n;return A(this,(function(r){return x(e instanceof it&&e.messageId>0&&d("string",t)).throw(O.invalidParameters),n=t.map((function(e){return new Ke({key:e})})),e instanceof vt?[2,this._updateFileMessageMetaArray(e.messageId,n,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},s.prototype.addMessageMetaArrayValues=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){return x(e instanceof it&&e.messageId>0&&t.every((function(e){return e instanceof Ke}))).throw(O.invalidParameters),e instanceof vt?[2,this._updateFileMessageMetaArray(e.messageId,t,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"add",!0)]}))}))},s.prototype.removeMessageMetaArrayValues=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){return x(e instanceof it&&e.messageId>0&&t.every((function(e){return e instanceof Ke}))).throw(O.invalidParameters),e instanceof vt?[2,this._updateFileMessageMetaArray(e.messageId,t,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},s.prototype.report=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return x((f(rn,e)||e instanceof Z)&&h("string",t)).throw(O.invalidParameters),r=n.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new ir({channelUrl:this.url,channelType:this.channelType,userId:i.userId,category:e,description:t}),[4,s.send(a)];case 1:return o.sent(),[2]}}))}))},s.prototype.reportUser=function(e,t,r){return U(this,void 0,void 0,(function(){var i,s,a,o;return A(this,(function(u){switch(u.label){case 0:return x(e instanceof l&&(f(rn,t)||t instanceof Z)&&h("string",r)).throw(O.invalidParameters),i=n.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new sr({channelUrl:this.url,channelType:this.channelType,userId:s.userId,offendingUserId:e.userId,category:t,description:r}),[4,a.send(o)];case 1:return u.sent(),[2]}}))}))},s.prototype.reportMessage=function(e,t,r){return U(this,void 0,void 0,(function(){var i,s,a,o;return A(this,(function(u){switch(u.label){case 0:return x(e instanceof st&&(f(rn,t)||t instanceof Z)&&h("string",r)).throw(O.invalidParameters),i=n.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new ar({channelUrl:this.url,channelType:this.channelType,userId:s.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:t,description:r,messageToken:e._messageToken}),[4,a.send(o)];case 1:return u.sent(),[2]}}))}))},s.prototype.updatePoll=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s;return A(this,(function(a){switch(a.label){case 0:return x(h("number",e)&&function(e){return h("string",e.title,!0)&&te(e.data)&&h("boolean",e.allowUserSuggestion,!0)&&h("boolean",e.allowMultipleVotes,!0)&&h("number",e.closeAt,!0)}(t)).throw(O.invalidParameters),r=n.of(this._iid).requestQueue,i=new wr(u({pollId:e},t)),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(Tr).poll]}}))}))},s.prototype.deletePoll=function(e){return U(this,void 0,void 0,(function(){var t,r,i;return A(this,(function(s){switch(s.label){case 0:return t=h("number",e),x(t).throw(O.invalidParameters),r=n.of(this._iid).requestQueue,i=new Mr({pollId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},s.prototype.closePoll=function(e){return U(this,void 0,void 0,(function(){var t,r,i,s;return A(this,(function(a){switch(a.label){case 0:return t=h("number",e),x(t).throw(O.invalidParameters),r=n.of(this._iid).requestQueue,i=new Sr({pollId:e}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(Ur).poll]}}))}))},s.prototype.addPollOption=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return r=h("number",e)&&h("string",t)&&""!==t.trim(),x(r).throw(O.invalidParameters),i=n.of(this._iid).requestQueue,s=new Ar({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(Nr).poll]}}))}))},s.prototype.updatePollOption=function(e,t,r){return U(this,void 0,void 0,(function(){var i,s,a,o;return A(this,(function(u){switch(u.label){case 0:return i=h("number",e)&&h("number",t)&&h("string",r)&&""!==r.trim(),x(i).throw(O.invalidParameters),s=n.of(this._iid).requestQueue,a=new Cr({pollId:e,pollOptionId:t,optionText:r}),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(Or).poll]}}))}))},s.prototype.deletePollOption=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s;return A(this,(function(a){switch(a.label){case 0:return r=h("number",e)&&h("number",t),x(r).throw(O.invalidParameters),i=n.of(this._iid).requestQueue,s=new kr({pollId:e,pollOptionId:t}),[4,i.send(s)];case 1:return a.sent(),[2]}}))}))},s.prototype.votePoll=function(e,t){return U(this,void 0,void 0,(function(){var r,i,s,a,o,u,l;return A(this,(function(c){switch(c.label){case 0:return r=h("number",e)&&d("number",t),x(r).throw(O.invalidParameters),i=n.of(this._iid),s=i.requestQueue,a=i.dispatcher,o=new Pr({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:t}),[4,s.send(o)];case 1:return u=c.sent(),l=u.as(Rr).event,a.dispatch(new he({event:l,source:C.EVENT_POLL_VOTED})),[2,l]}}))}))},s.prototype.getPollChangeLogsSinceTimestamp=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return x(h("number",e)).throw(O.invalidParameters),[4,fe.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},s.prototype.getPollChangeLogsSinceToken=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return x(h("string",e,!0)),[4,fe.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},s.prototype.createPollListQuery=function(e){return void 0===e&&(e=10),new le(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},s.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=20),new ce(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},s.prototype.pinMessage=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(h("number",e)&&e>0).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new si({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(r)];case 1:return i.sent(),[2]}}))}))},s.prototype.unpinMessage=function(e){return U(this,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return x(h("number",e)&&e>0).throw(O.invalidParameters),t=n.of(this._iid).requestQueue,r=new ai({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(r)];case 1:return i.sent(),[2]}}))}))},s}(c),di=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return r(t,e),t}((function(){this.onConnected=W,this.onReconnectStarted=W,this.onReconnectSucceeded=W,this.onReconnectFailed=W,this.onConnectionLost=W,this.onDisconnected=W,this.onConnectionDelayed=W})),hi=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return r(t,e),t}((function(){this.onSessionExpired=W,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=W,this.onSessionRefreshed=W,this.onSessionClosed=W})),fi=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return r(t,e),t}((function(){this.onFriendsDiscovered=W,this.onTotalUnreadMessageCountChanged=W,this.onTotalUnreadMessageCountUpdated=W})),pi=function(t){function n(n){var r=n.limit,s=n.token,a=n.userIdsFilter,o=n.metaDataKeyFilter,u=n.metaDataValuesFilter,l=n.nicknameStartsWithFilter,c=t.call(this)||this;return c.method=i.GET,c.path=pe,c.params=e({limit:r,token:s,user_ids:a,metadatakey:o,metadatavalues_in:u,nickname_startswith:l}),c}return r(n,t),n}(a),mi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new l(t,e)})),r.next=n.next,r}return r(t,e),t}(o),vi=function(e){function i(t,n){var r,i,s,a=this;return(a=e.call(this,t,n)||this).userIdsFilter=null,a.metaDataKeyFilter=null,a.metaDataValuesFilter=null,a.nicknameStartsWithFilter=null,a.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,a.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,a.metaDataValuesFilter=null!==(s=n.metaDataValuesFilter)&&void 0!==s?s:null,a.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,a}return r(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)&&d("string",this.userIdsFilter,!0)&&h("string",this.metaDataKeyFilter,!0)&&d("string",this.metaDataValuesFilter,!0)&&h("string",this.nicknameStartsWithFilter,!0)},i.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,r,i,s,a,o;return A(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid).requestQueue,r=new pi(t(u(u({},this),{token:this._token}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(mi),a=s.users,o=s.next,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},i}(me),_i=function(t){function n(n){var r=n.userId,s=n.limit,a=n.token,o=n.userIdsFilter,u=t.call(this)||this;return u.method=i.GET,u.path="".concat(pe,"/").concat(encodeURIComponent(r),"/block"),u.params=e({limit:s,token:a,user_ids:o}),u}return r(n,t),n}(a),yi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new l(t,e)})),r.next=n.next,r}return r(t,e),t}(o),gi=function(e){function i(t,n){var r,i=this;return(i=e.call(this,t,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return r(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)&&d("string",this.userIdsFilter,!0)},i.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,r,i,s,a,o,l,c;return A(this,(function(d){switch(d.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new _i(t(u(u({},this),{userId:r.userId,token:this._token}))),[4,i.send(s)]):[3,2]:[3,5];case 1:return a=d.sent(),o=a.as(yi),l=o.users,c=o.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,l];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},i}(me),bi=function(e){function t(t){var n=t.userId,r=t.limit,s=t.token,a=e.call(this)||this;return a.method=i.GET,a.path="".concat(pe,"/").concat(encodeURIComponent(n),"/friends"),a.params={limit:r,token:s},a}return r(t,e),t}(a),Ii=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(e){return new l(t,e)})),r.next=n.next,r}return r(t,e),t}(o),Ei=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a,o,l,c;return A(this,(function(d){switch(d.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid),t=e.sdkState,r=e.requestQueue,i=new bi(u(u({},this),{userId:t.userId,token:this._token})),[4,r.send(i)]):[3,2]:[3,5];case 1:return s=d.sent(),a=s.as(Ii),o=a.users,l=a.hasMore,c=a.next,this._token=c,this._hasNext=l,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},t}(me),wi={},Ti=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,s=void 0===i?256:i,a=e.blockHashBase,o=void 0===a?2:a,u=e.blockHashMultiplier,l=void 0===u?10:u,c=e.blockHashConstant,d=void 0===c?11:c,h=e.transactionApplyDelay,f=void 0===h?200:h,p=e.disableLogger,m=void 0!==p&&p;return wi[t]||(this.itemSizeLimit=r,this.cacheLimit=s,this.blockHashBase=o,this.blockHashMultiplier=l,this.blockHashConstant=d,this.transactionApplyDelay=f,this.disableLogger=m,wi[t]=this),wi[t]}return e.get=function(e){return wi[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(li||(li={}));var Mi,Si=function(e){function t(n){var r=n.code,i=void 0===r?li.UNKNOWN_ERROR:r,s=n.message,a=void 0===s?"Unknown error occurred.":s,o=e.call(this,a)||this;return o.code=i,Object.setPrototypeOf(o,t.prototype),o}return r(t,e),Object.defineProperty(t,"storeNotDefined",{get:function(){return new t({code:li.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailable",{get:function(){return new t({code:li.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t({code:li.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeIsFull",{get:function(){return new t({code:li.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotInitialized",{get:function(){return new t({code:li.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeKeyTypeIsInvalid",{get:function(){return new t({code:li.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenIntegrity",{get:function(){return new t({code:li.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenBlob",{get:function(){return new t({code:li.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeEncryptionInvalid",{get:function(){return new t({code:li.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeItemSizeExceeded",{get:function(){return new t({code:li.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeReadFailed",{get:function(){return new t({code:li.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeWriteFailed",{get:function(){return new t({code:li.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseSchemaNotOnUpgrade",{get:function(){return new t({code:li.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionNotReady",{get:function(){return new t({code:li.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotMatch",{get:function(){return new t({code:li.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionQueryNotValid",{get:function(){return new t({code:li.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionInsertDuplicate",{get:function(){return new t({code:li.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotFound",{get:function(){return new t({code:li.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotGiven",{get:function(){return new t({code:li.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionWriteFailed",{get:function(){return new t({code:li.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionItemSizeExceeded",{get:function(){return new t({code:li.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTableIsRequired",{get:function(){return new t({code:li.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTypesNotMatch",{get:function(){return new t({code:li.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"compareTypesNotMatch",{get:function(){return new t({code:li.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"circularReferenceFound",{get:function(){return new t({code:li.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(Mi||(Mi={}));var Ui,Ai=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw Si.circularReferenceFound;var n;return t.set(e,!0),Array.isArray(e)?n=e.map((function(e){return Ai(e,t)})):e instanceof RegExp||e instanceof Date?n=e:(n={},Object.keys(e).forEach((function(r){n[r]=Ai(e[r],t)}))),t.delete(e),n}return e},Ni=function(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw Si.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n},Ci=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},Oi=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},ki=function(e,t){if(!t)return!1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return!ki(e,t)})))return!1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return!ki(e,t)})))return!1}else if("/where"===n){if(!(0,e[n])(t))return!1}else{var r=n;if("object"==typeof e[r]){var i=e[r];for(var s in i)switch(s){case"/eq":case"=":if((a=t[r])!==(o=i[s]))return!1;break;case"/neq":case"!=":if((a=t[r])===(o=i[s]))return!1;break;case"/gt":case">":var a=t[r],o=i[s];if(!(Ni(a,o)>0))return!1;break;case"/gte":case">=":a=t[r],o=i[s];if(!(Ni(a,o)>=0))return!1;break;case"/lt":case"<":a=t[r],o=i[s];if(!(Ni(a,o)<0))return!1;break;case"/lte":case"<=":a=t[r],o=i[s];if(!(Ni(a,o)<=0))return!1;break;case"/in":a=t[r];if(!(o=i[s]).includes(a))return!1;break;case"/nin":a=t[r];if((o=i[s]).includes(a))return!1;break;case"/contain":a=t[r],o=i[s];if(!a.includes(o))return!1;break;case"/regex":a=t[r];if(!(o=i[s]).test(a))return!1;break;case"/where":a=t[r];if(!(0,i[s])(a))return!1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return!1}else if(e[r]!==t[r])return!1}}return!0}return e(t)},Pi=function(){},Ri=function(){return Promise.resolve()},xi=function(e){return e},Di=function(e,t){t()};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(Ui||(Ui={}));var Li,Fi,qi,zi=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,s=e.iterator,a=e.map,o=void 0===a?xi:a,u=e.backward,l=void 0===u?Ri:u,c=e.forward,d=void 0===c?Ri:c,h=e.complete,f=void 0===h?Pi:h;this._prevValue=n,this._nextValue=i,this._error=null,this._map=o,this._backward=l,this._forward=d,this._iterator=s,this._complete=f}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return U(this,void 0,void 0,(function(){var e,t,n;return A(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,t,n;return A(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},e}(),Bi=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.blockManager,a=e.indexer;this.condition=n,this.backward=i,this._blockManager=s,this._indexer=a}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(h=0;h<this._indexer.fields.length;h++){var i=this._indexer.fields[h],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),this.condition[i])if("object"==typeof this.condition[i]){var a=s>0?n:t;for(var o in this.condition[i])if(a.includes(o))for(var u=r;u>=0;u--)if(s*Ni(this._indexer.origin[u].columnValues[h],this.condition[i][o])<=0){r=u;break}}else for(u=r;u>=0;u--)if(s*Ni(this._indexer.origin[u].columnValues[h],this.condition[i])<=0){r=u;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var c=function(r){var i=d._indexer.fields[r],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),d.condition[i])if("object"==typeof d.condition[i])Object.keys(d.condition[i]).forEach((function(a){if((s>0?t:n).includes(a))for(var o=l;o<e._indexer.origin.length;o++)if(s*Ni(e._indexer.origin[o].columnValues[r],e.condition[i][a])>=0){l=o;break}}));else for(var a=l;a<d._indexer.origin.length;a++)if(s*Ni(d._indexer.origin[a].columnValues[r],d.condition[i])>=0){l=a;break}},d=this,h=0;h<this._indexer.fields.length;h++)c(h);return Math.max(l-1,0)},e.prototype.each=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u=this;return A(this,(function(l){switch(l.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[++n]){if(!u._indexer.origin[++t])return!1;n=0}return!0}return!1},i=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[--n]){if(!u._indexer.origin[--t])return!1;n=u._indexer.origin[t].keys.length-1}return!0}return!1},s=null,!this._indexer.origin[t])return[3,4];a=this.backward?i:r,l.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if((o=l.sent())&&ki(this.condition,o))return s=o,[3,4];l.label=3;case 3:if(a())return[3,1];l.label=4;case 4:return[4,new Promise((function(a){var o=new zi({initialNextValue:Ai(s),iterator:e,forward:function(){return U(u,void 0,void 0,(function(){var e,s;return A(this,(function(a){switch(a.label){case 0:e=this.backward?i:r,a.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return(s=a.sent())&&ki(this.condition,s)?[2,Ai(s)]:[3,1];case 3:return[2,null]}}))}))},backward:function(){return U(u,void 0,void 0,(function(){var e,s;return A(this,(function(a){switch(a.label){case 0:e=this.backward?r:i,a.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return(s=a.sent())&&ki(this.condition,s)?[2,Ai(s)]:[3,1];case 3:return[2,null]}}))}))},complete:a});e(o)}))];case 5:return[2,l.sent()]}}))}))},e}(),ji=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.mutex,a=e.blockManager,o=e.indexer;this._mutex=s,this._iterator=new Bi({condition:n,backward:i,blockManager:a,indexer:o}),this._indexer=o}return Object.defineProperty(e.prototype,"indexer",{get:function(){return this._indexer},enumerable:!1,configurable:!0}),e.prototype.fetch=function(e){return void 0===e&&(e={}),U(this,void 0,void 0,(function(){var t,n,r,i,s=this;return A(this,(function(a){switch(a.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(n<0)throw Si.collectionQueryNotValid;a.label=1;case 1:return a.trys.push([1,4,,5]),r=[],[4,this._mutex.lock()];case 2:return a.sent(),[4,this._iterator.each((function(e){return U(s,void 0,void 0,(function(){return A(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r.push(e.nextValue),0<n&&n<=r.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return a.sent(),this._mutex.unlock(),[2,r];case 4:throw i=a.sent(),this._mutex.unlock(),i;case 5:return[2]}}))}))},e.prototype.count=function(){return U(this,void 0,void 0,(function(){var e,t,n=this;return A(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r.sent(),[4,this._iterator.each((function(t){return U(n,void 0,void 0,(function(){return A(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r.sent(),this._mutex.unlock(),t;case 4:return[2]}}))}))},e}(),Ki=function(e){return"".concat("nest","@").concat(e)},Qi=function(e,t){return"".concat(Ki(e),"/").concat(t)},Gi=function(e,t){return"".concat(Qi(e,t),".metadata")},Vi=function(e,t){return"".concat(Qi(e,t),"/block.")},Hi=function(e,t){return"".concat(Qi(e,t),"/blob.")},Wi=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this.store=r}return e.prototype.get=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l;return A(this,(function(c){switch(c.label){case 0:return[4,this.store.get(e)];case 1:return(t=c.sent())?(n=t.data,r=t.type,"undefined"==typeof fetch?[3,4]:[4,fetch(n)]):[3,5];case 2:return[4,c.sent().blob()];case 3:return[2,c.sent()];case 4:for(i=[],s=atob(n.split(",")[1]),a=0;a<s.length;a+=512){for(o=s.slice(a,a+512),u=new Array(o.length),l=0;l<o.length;l++)u[l]=o.charCodeAt(l);i.push(new Uint8Array(u))}return[2,new Blob(i,{type:r})];case 5:return[2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),U(this,void 0,void 0,(function(){var n,r,i,s,a=this;return A(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(n){var r=function(e,t,n,r){return void 0===r&&(r=0),"".concat(Hi(e,t)).concat(n,".").concat(r)}(a.dbname,a.collectionName,t),i=new FileReader;i.onload=function(){n({blobId:r,data:i.result,type:e.type})},i.readAsDataURL(e)}))];case 1:return n=o.sent(),r=n.blobId,i=n.data,s=n.type,[4,this.store.set({key:r,value:{data:i,type:s}})];case 2:return o.sent(),[2,r]}}))}))},e.prototype.remove=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return U(this,void 0,void 0,(function(){var e,t,n=this;return A(this,(function(r){switch(r.label){case 0:return e=Hi(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return t=r.sent(),[4,Promise.all(t.filter((function(t){return t.startsWith(e)})).map((function(e){return U(n,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return[2,t.sent()]}}))}))})))];case 2:return r.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(Li||(Li={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(Fi||(Fi={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(qi||(qi={}));var Yi,Ji,Xi=[Fi.PENDING,Fi.VOLATILE],Zi={},$i=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return Zi[t]||(this.dbname=t,this._items=[],this._limit=r,Zi[t]=this),Zi[t]}return e.get=function(e){return Zi[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=qi.DEFAULT),U(this,void 0,void 0,(function(){var r,i;return A(this,(function(s){switch(s.label){case 0:return(r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return(i=s.sent())&&(r={key:t,value:i,state:n===qi.PERSISTENT?Fi.PERSISTENT:Fi.VOLATILE},this.put(r)),[3,3];case 2:n===qi.PERSISTENT&&(r.state=Fi.PERSISTENT),s.label=3;case 3:return[2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=qi.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===qi.PERSISTENT&&(r.state=Fi.PERSISTENT),t!==qi.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)Xi.includes(this._items[r].state)&&Xi.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter((function(e){return e.state===Fi.VOLATILE})),s=i.length-this._limit;if(s>0){var a=[];try{for(var o=v(this._items),u=o.next();!u.done;u=o.next()){var l=u.value;l.state===Fi.VOLATILE&&s>0?s--:a.push(l)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._items=a}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return!e(t)}))},e.prototype.clearForDatabase=function(e){this.clearByCondition((function(t){return t.key.startsWith(Ki(e))}))},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==Fi.VOLATILE}))},e}(),es=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return"".concat(Qi(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return"".concat(Qi(e,t),"/trans.recordset")}(t,n),this._store=r}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=n.sent()||[]).push.apply(t,p([],m(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],s=[],a=i.requests.length-1;a>=0;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}s.length>0&&(i.requests=s,t.unshift(i))}return t},e.prototype._applyRecord=function(e,t){return U(this,void 0,void 0,(function(){var n,r,i,s,a,o,l,c,d;return A(this,(function(h){switch(h.label){case 0:n=$i.get(this.dbname),r=t.generation,i=t.requests,s=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(i.map((function(e){return u(u({},e.data),{generation:r})})))];case 2:for(a=h.sent(),o=0;o<i.length;o++)a[o]instanceof Error&&(s||(s=a[o]),l=i[o].data,n.put(u(u({},l),{state:Fi.PERSISTENT})));return[3,4];case 3:return c=h.sent(),s=c,[3,4];case 4:return s?[3,6]:(d=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:d})]);case 5:return h.sent(),this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})))})),[3,7];case 6:this._onError.forEach((function(e){s&&e(s)})),h.label=7;case 7:return[2]}}))}))},e.prototype.init=function(){return U(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o;return A(this,(function(u){switch(u.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=u.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),n=v(t),r=n.next(),u.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._applyRecord(t,i)]);case 5:u.sent(),u.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return s=u.sent(),a={error:s},[3,10];case 9:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 10:return[2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case Li.COMMIT:this._onCommit.set(t,n);break;case Li.WRITE:this._onWrite.set(t,n);break;case Li.ERROR:this._onError.set(t,n)}},e.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t}),$i.get(this.dbname).put(u({state:Fi.PENDING},e))},e.prototype.requestMultipleWrite=function(e,t){var n,r,i=$i.get(this.dbname);try{for(var s=v(e),a=s.next();!a.done;a=s.next()){var o=a.value;this._requests.push({data:o,options:t}),i.put(u({state:Fi.PENDING},o))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){return $i.get(this.dbname).clearByCondition((function(e){return e.state===Fi.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return U(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,l,c,d,h,f=this;return A(this,(function(p){switch(p.label){case 0:if(!((e=this._requests).length>0))return[3,4];for(t=[],n={},o=e.length-1;o>=0;o--)r=e[o],c=r.data,n[c.key]||(n[c.key]=!0,t.unshift(r));return i={generation:this.generation,requests:t},[4,this._getReducedRecordset([i])];case 1:return s=p.sent(),[4,this._store.set({key:this.recordsetKey,value:s})];case 2:return p.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(p.sent(),a=$i.get(this.dbname),o=0;o<t.length;o++)l=t[o],c=l.data,d=l.options,a.put(u(u({},c),{state:d&&d.persistent?Fi.PERSISTENT:Fi.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})))})),h=Ti.get(this.dbname),setTimeout((function(){try{f._applyRecord(s,i)}catch(e){f._onError.forEach((function(t){return t(e)}))}}),h.transactionApplyDelay),p.label=4;case 4:return[2]}}))}))},e}(),ts=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,s=e.limit;this.blockId=t,this.keyName=n,this.limit=s,this._items=p([],m(i),!1)}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this,n=this._items.find((function(n){var r=n[t.keyName];return e===r}));return null!=n?n:null},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t=0;t<this._items.length;t++)if(this._items[t][this.keyName]===e)return this._items.splice(t,1),!0;return!1},e.prototype.clear=function(){this._items=[]},e}(),ns=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,s=void 0===i?Ci:i,a=e.transaction,o=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=a,this._store=o}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,s="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||Ci)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(Vi(n,r)).concat(i,".").concat(s);var n,r,i,s},e.prototype._findBlock=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s;return A(this,(function(a){switch(a.label){case 0:t=$i.get(this.dbname),n=this.metadata.blockLevel,a.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i=a.sent())&&(s=ts.createFromCacheItem(i),null==s?void 0:s.getItemByKey(e)))return[2,s];a.label=3;case 3:return n--,[3,1];case 4:return[2,null]}}))}))},e.prototype.getFromBlock=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return[2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return U(this,void 0,void 0,(function(){var n,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return n=Ti.get(this.dbname),r=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,$i.get(this.dbname).find(this._store,r)];case 1:return s=o.sent(),(null==(a=s?ts.createFromCacheItem(s):new ts({blockId:r,keyName:this.keyName,items:[],limit:i}))?void 0:a.add(t))?(this._transaction.requestWrite({key:a.blockId,value:a.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return(t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return U(this,void 0,void 0,(function(){var e,t,n;return A(this,(function(r){switch(r.label){case 0:return e=Vi(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=r.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:return r.sent(),[4,this._transaction.clear()];case 3:return r.sent(),$i.get(this.dbname).clearByCondition((function(t){return t.key.startsWith(e)})),[2]}}))}))},e}(),rs=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,a=e.store,o=e.mutex,u=this;this._origin=[],this._table=[],this.restoreInterval=1e3;var l=function(e,t,n){return"".concat(Qi(e,t),"/index.").concat(n)}(t,n,i.join(">"));this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=l,this._store=a,this._transaction=s,this._transaction.on(Li.COMMIT,this.indexerKey,(function(){return u.commit()})),this._transaction.on(Li.ERROR,this.indexerKey,(function(){return u.abort()})),this._lastRestoreIndexerTime=0,this._isRestoringIndexer=!1,this._mutex=o}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=m(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=m(this.indexOf(n),2),i=r[0];if(r[1]){var s=this._table[i].keys.indexOf(t);if(s>-1)return this._table[i].keys.splice(s,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return!1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,s=[];try{for(var a=v(this.fields),o=a.next();!o.done;o=a.next()){var u=o.value;if("-"===u[0]&&(u=u.slice(1)),r=e[u],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw Si.indexTypesNotMatch;s.push(e[u])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return s},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=Ni(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){return this._indexOfInTable(this._table,e)},e.prototype._indexOfInTable=function(e,t){if(e.length>0){for(var n=0,r=e.length-1;n<=r;){var i=Math.floor((n+r)/2),s=this.diff(t,e[i].columnValues);if(s>0)n=i+1;else{if(!(s<0))return[i,!0];r=i-1}}return[n,!1]}return[0,!1]},e.prototype.ensure=function(){return U(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u,l,c,d,h,f,p,m,_;return A(this,(function(y){switch(y.label){case 0:return[4,(e=$i.get(this.dbname)).find(this._store,this.indexerKey,qi.PERSISTENT)];case 1:return(t=y.sent())?[3,11]:(n=Vi(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=y.sent(),y.label=3;case 3:y.trys.push([3,8,9,10]),i=v(r),s=i.next(),y.label=4;case 4:return s.done?[3,7]:(a=s.value).startsWith(n)?[4,e.find(this._store,a,qi.NO_CACHE)]:[3,6];case 5:if(o=y.sent(),u=ts.createFromCacheItem(o))try{for(m=void 0,l=v(u.items),c=l.next();!c.done;c=l.next())d=c.value,this._addItem(d)}catch(e){m={error:e}}finally{try{c&&!c.done&&(_=l.return)&&_.call(l)}finally{if(m)throw m.error}}y.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return h=y.sent(),f={error:h},[3,10];case 9:try{s&&!s.done&&(p=i.return)&&p.call(i)}finally{if(f)throw f.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=Ai(this._origin),y.label=12;case 12:return[2]}}))}))},e.prototype.restoreIndexer=function(){return U(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u,l,c,d,h,f,p,_,y,g,b,I,E,w,T,M,S,U,N,C,O,k,P,R,x,D,L,F,q,z,B,j,K,Q,G;return A(this,(function(A){switch(A.label){case 0:if(e=Date.now(),this._isRestoringIndexer||e-this._lastRestoreIndexerTime<this.restoreInterval)return[2];A.label=1;case 1:return A.trys.push([1,,13,14]),this._mutex.lock(),this._isRestoringIndexer=!0,this._lastRestoreIndexerTime=e,[4,this._store.get(this.indexerKey)];case 2:(t=A.sent())?(this._origin=t,this._table=Ai(this._origin)):this._table=[],n=new Set;try{for(r=v(this._table),i=r.next();!i.done;i=r.next()){s=i.value;try{for(D=void 0,a=v(s.keys),o=a.next();!o.done;o=a.next())C=o.value,n.add(C)}catch(e){D={error:e}}finally{try{o&&!o.done&&(L=a.return)&&L.call(a)}finally{if(D)throw D.error}}}}catch(e){R={error:e}}finally{try{i&&!i.done&&(x=r.return)&&x.call(r)}finally{if(R)throw R.error}}return u=Vi(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 3:l=A.sent(),c=new Set,d=new Map,A.label=4;case 4:A.trys.push([4,9,10,11]),h=v(l),f=h.next(),A.label=5;case 5:return f.done?[3,8]:(C=f.value).startsWith(u)?[4,this._store.get(C)]:[3,7];case 6:if(p=A.sent(),_=p?ts.createFromCacheItem({key:C,value:p,state:Fi.VOLATILE}):null)try{for(z=void 0,y=v(_.items),g=y.next();!g.done;g=y.next())N=g.value,b=N[this.keyName],c.add(b),d.set(b,N)}catch(e){z={error:e}}finally{try{g&&!g.done&&(B=y.return)&&B.call(y)}finally{if(z)throw z.error}}A.label=7;case 7:return f=h.next(),[3,5];case 8:return[3,11];case 9:return I=A.sent(),F={error:I},[3,11];case 10:try{f&&!f.done&&(q=h.return)&&q.call(h)}finally{if(F)throw F.error}return[7];case 11:if(0===c.size)return[2];E=!1,w=[];try{for(T=v(c),M=T.next();!M.done;M=T.next())C=M.value,n.has(C)||(E=!0,console.warn("Indexer restore: missed key detected - ".concat(C)),(N=d.get(C))&&w.push(N))}catch(e){j={error:e}}finally{try{M&&!M.done&&(K=T.return)&&K.call(T)}finally{if(j)throw j.error}}if(!E)return[2];try{for(S=v(w),U=S.next();!U.done;U=S.next())N=U.value,C=N[this.keyName],O=this.getColumnValues(N),k=m(this._indexOfInTable(this._table,O),2),P=k[0],k[1]?this._table[P].keys.includes(C)||this._table[P].keys.push(C):this._table.splice(P,0,{columnValues:O,keys:[C]})}catch(e){Q={error:e}}finally{try{U&&!U.done&&(G=S.return)&&G.call(S)}finally{if(Q)throw Q.error}}return[4,this._store.set({key:this.indexerKey,value:this._table})];case 12:return A.sent(),$i.get(this.dbname).put({key:this.indexerKey,value:this._table,state:Fi.PERSISTENT}),this._origin=Ai(this._table),[3,14];case 13:return this._isRestoringIndexer=!1,this._mutex.unlock(),[7];case 14:return[2]}}))}))},e.prototype.drop=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return $i.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}}))}))},e.prototype.addItem=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=Ai(this._origin)},e.prototype.abort=function(){this._table=Ai(this._origin)},e}(),is=function(){return"undefined"!=typeof document&&"undefined"!=typeof navigator&&"ReactNative"!==navigator.product},ss=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(Yi||(Yi={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(Ji||(Ji={}));var as,os={},us=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=Yi.PROCESSING,this._queue=[],this._activationQueue=[],os[e]&&!t.forceCreate||(this.nodeId=ss(),this.key=e,is()&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t,r,i=e.data;if(null==i?void 0:i.isNestDbMessage){var s=i.nodeId,a=i.requestId,o=i.key,u=i.op,l=i.data;if(s!==n.nodeId&&o===n.key)switch(u){case Ji.NEWNODE:n._sendSync();break;case Ji.CLAIM_HOST:n._sendSync(),n._hostId=s;break;case Ji.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var c=l,d=c.currentItemRequestId,h=c.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({isNestDbMessage:!0,nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:Ji.REQUEST_LOCK,ts:e.ts})};try{for(var p=v(h),m=p.next();!m.done;m=p.next()){f(m.value)}}catch(e){t={error:e}}finally{try{m&&!m.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===d})),n._completeSync()}break;case Ji.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=void 0,n._acquire(n._queue[0]));break;case Ji.REQUEST_LOCK:n._requestLock(i);break;case Ji.ACQUIRE_LOCK:var _=n._queue.find((function(e){return e.requestId===a}));n._acquire(_);break;case Ji.RELEASE_LOCK:n._release(a)}}})),window.addEventListener("beforeunload",(function(){n._send(Ji.REMOVENODE)}))),os[e]=this),os[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==Yi.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n;void 0===t&&(t={});var r={isNestDbMessage:!0,nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:ss(),key:this.key,op:e,data:t.data,ts:Date.now()};return is()&&window.postMessage(r,"*"),r},e.prototype._acquire=function(e){e?(this._currentItem=e,this._currentItem.onAcquired&&this._currentItem.onAcquired(e.requestId)):this._currentItem=void 0},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=void 0,t.nodeId===this.nodeId&&this._send(Ji.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased&&t.onReleased(e)}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){for(var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Ji.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},i=!1,s=0;s<t._queue.length;s++)if(t._queue[s].ts>r.ts){t._queue.splice(s,0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(Ji.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})},e.prototype._waitUntilSyncCompleted=function(){return U(this,void 0,void 0,(function(){var e=this;return A(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t)}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))},e.prototype._completeSync=function(){this.isInSync||(this._state=Yi.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])},e.prototype.registerNode=function(){this._send(Ji.NEWNODE),this._waitSync()},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Ji.CLAIM_HOST),this._waitSync()},e.prototype.lock=function(){return U(this,void 0,void 0,(function(){var e;return A(this,(function(t){switch(t.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(Ji.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)&&this._release(this._currentItem.requestId)},e}(),ls=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,a=e.store,o=this;this._state=Mi.INIT,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=p([[r]],m(s.filter((function(e){return rs.createKey(e)!==o.keyName}))),!1),this._keyHash=i,this._store=a,this._mutex=new us(function(e,t){return"".concat(Qi(e,t),".lock")}(t,n)),this._blobContainer=new Wi({dbname:t,collectionName:n,store:a}),this._transaction=new es({dbname:t,collectionName:n,store:a})}return e.metadataOf=function(e,t,n){return U(this,void 0,void 0,(function(){var r;return A(this,(function(i){switch(i.label){case 0:return r=Gi(e,t),[4,n.get(r)];case 1:return[2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===Mi.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c,d,h,f,_,y=this;return A(this,(function(g){switch(g.label){case 0:return[4,this._mutex.lock()];case 1:g.sent(),g.label=2;case 2:return g.trys.push([2,9,,10]),t=Ti.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=g.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:g.sent(),this._blockManager=new ns({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=p([],m(this.indexes),!1),i=[],s=r.map((function(e){return rs.createKey(e)})),a=n?n.indexes.map((function(e){return rs.createKey(e)})):[];try{for(o=v(a),u=o.next();!u.done;u=o.next())l=u.value,s.includes(l)||i.push(rs.parseKey(l))}catch(e){f={error:e}}finally{try{u&&!u.done&&(_=o.return)&&_.call(o)}finally{if(f)throw f.error}}return(c=[]).push.apply(c,p([],m(r.map((function(e){var t=new rs({dbname:y.dbname,collectionName:y.name,keyName:y.keyName,fields:e,transaction:y._transaction,store:y._store,mutex:y._mutex});return y._indexers.push(t),t.ensure()}))),!1)),c.push.apply(c,p([],m(i.map((function(e){return new rs({dbname:y.dbname,collectionName:y.name,keyName:y.keyName,fields:e,transaction:y._transaction,store:y._store,mutex:y._mutex}).drop()}))),!1)),[4,Promise.all(c)];case 5:return g.sent(),[4,this._transaction.commit()];case 6:return g.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(d=Gi(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:g.sent(),g.label=8;case 8:return this._state=Mi.READY,this._mutex.unlock(),[3,10];case 9:throw h=g.sent(),this._mutex.unlock(),h;case 10:return[2]}}))}))},e.prototype.close=function(){this._state=Mi.CLOSED},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return"string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=rs.createKey(e);try{for(var i=v(this._indexers),s=i.next();!s.done;s=i.next()){var a=s.value;if(r===rs.createKey(a.fields))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}throw Si.indexTableIsRequired},e.prototype._upgradeBlockLevel=function(){return U(this,void 0,void 0,(function(){var e;return A(this,(function(t){switch(t.label){case 0:return e=Gi(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return o.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return o.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return o.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:o.sent(),o.label=5;case 5:o.trys.push([5,10,11,12]),n=v(this._indexers),r=n.next(),o.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:o.sent(),o.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=o.sent(),s={error:i},[3,12];case 11:try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}return[7];case 12:return[3,14];case 13:throw Si.collectionInsertDuplicate;case 14:return[2]}}))}))},e.prototype._requestUpsert=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c,d,h,f;return A(this,(function(p){switch(p.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=p.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return p.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return p.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:p.sent(),p.label=5;case 5:p.trys.push([5,10,11,12]),r=v(this._indexers),i=r.next(),p.label=6;case 6:return i.done?[3,9]:[4,(u=i.value).addItem(e)];case 7:p.sent(),p.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=p.sent(),c={error:s},[3,12];case 11:try{i&&!i.done&&(d=r.return)&&d.call(r)}finally{if(c)throw c.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,e)];case 14:p.sent(),p.label=15;case 15:p.trys.push([15,21,22,23]),a=v(this._indexers),o=a.next(),p.label=16;case 16:return o.done?[3,20]:0===(u=o.value).diff(u.getColumnValues(n),u.getColumnValues(e))?[3,19]:[4,u.removeItem(n)];case 17:return p.sent(),[4,u.addItem(e)];case 18:p.sent(),p.label=19;case 19:return o=a.next(),[3,16];case 20:return[3,23];case 21:return l=p.sent(),h={error:l},[3,23];case 22:try{o&&!o.done&&(f=a.return)&&f.call(a)}finally{if(h)throw h.error}return[7];case 23:return[2]}}))}))},e.prototype._requestUpdate=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u;return A(this,(function(l){switch(l.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=l.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:l.sent(),l.label=3;case 3:l.trys.push([3,9,10,11]),r=v(this._indexers),i=r.next(),l.label=4;case 4:return i.done?[3,8]:0===(s=i.value).diff(s.getColumnValues(n),s.getColumnValues(e))?[3,7]:[4,s.removeItem(n)];case 5:return l.sent(),[4,s.addItem(e)];case 6:l.sent(),l.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return a=l.sent(),o={error:a},[3,11];case 10:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 11:return[2]}}))}))},e.prototype._requestRemove=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return[4,this._blockManager.getFromBlock(e)];case 1:return(t=o.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:o.sent(),o.label=3;case 3:o.trys.push([3,8,9,10]),n=v(this._indexers),r=n.next(),o.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:o.sent(),o.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=o.sent(),s={error:i},[3,10];case 9:try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}return[7];case 10:return[2]}}))}))},e.prototype._requestClear=function(){return U(this,void 0,void 0,(function(){var e,t,n,r,i;return A(this,(function(s){switch(s.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:s.sent(),s.label=2;case 2:s.trys.push([2,7,8,9]),e=v(this._indexers),t=e.next(),s.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:s.sent(),s.label=5;case 5:return t=e.next(),[3,3];case 6:return[3,9];case 7:return n=s.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}return[7];case 9:return[2]}}))}))},e.prototype.getByKey=function(e){return U(this,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,Ai(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return[3,7];case 6:throw Si.collectionNotReady;case 7:return[2]}}))}))},e.prototype.query=function(e){if(void 0===e&&(e={}),this.isReady)return new ji({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward});throw Si.collectionNotReady},e.prototype.insertOne=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Si.collectionKeyNotGiven;return[4,this._requestInsert(Ai(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Si.collectionNotReady;case 9:return[2]}}))}))},e.prototype.insertMany=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u=this;return A(this,(function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Si.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),t=v(e),n=t.next(),l.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(Ai(r))]);case 5:l.sent(),l.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=l.sent(),a={error:i},[3,10];case 9:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,e];case 12:return s=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw Si.collectionNotReady;case 16:return[2]}}))}))},e.prototype.upsertOne=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Si.collectionKeyNotGiven;return[4,this._requestUpsert(Ai(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Si.collectionNotReady;case 9:return[2]}}))}))},e.prototype.upsertMany=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u=this;return A(this,(function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Si.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),t=v(e),n=t.next(),l.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(Ai(r))]);case 5:l.sent(),l.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=l.sent(),a={error:i},[3,10];case 9:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,e];case 12:return s=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw Si.collectionNotReady;case 16:return[2]}}))}))},e.prototype.update=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Si.collectionKeyNotGiven;return[4,this._requestUpdate(Ai(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Si.collectionNotReady;case 9:return[2]}}))}))},e.prototype.updateIf=function(e,t){return U(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,l,c,d,h,f,p,m,_=this;return A(this,(function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,15]),n=e.where,r=void 0===n?{}:n,i=e.index,s=void 0===i?null:i,a=e.backward,o=void 0!==a&&a,u=[],[4,new Bi({condition:r,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(s)}).each((function(e){return U(_,void 0,void 0,(function(){var n;return A(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(n=e.nextValue,ki(r,n)&&t.set&&("function"!=typeof t.set?Object.keys(t.set).forEach((function(e){var r;n[e]=null===(r=t.set)||void 0===r?void 0:r[e]})):t.set(n),u.push(n)),e.next()):e.stop(),[2]}))}))}))];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),l=v(u),c=l.next(),y.label=5;case 5:return c.done?[3,8]:(d=c.value,[4,this._requestUpdate(Ai(d))]);case 6:y.sent(),y.label=7;case 7:return c=l.next(),[3,5];case 8:return[3,11];case 9:return h=y.sent(),p={error:h},[3,11];case 10:try{c&&!c.done&&(m=l.return)&&m.call(l)}finally{if(p)throw p.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,u];case 13:return f=y.sent(),[4,this._transaction.clear()];case 14:throw y.sent(),this._mutex.unlock(),f;case 15:return[3,17];case 16:throw this._transaction.clear(),Si.collectionNotReady;case 17:return[2]}}))}))},e.prototype.remove=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Si.collectionNotReady;case 9:return[2]}}))}))},e.prototype.removeIf=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c,d,h,f,p,m=this;return A(this,(function(_){switch(_.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:_.sent(),_.label=2;case 2:return _.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r=e.index,i=void 0===r?null:r,s=e.backward,a=void 0!==s&&s,o=[],[4,new Bi({condition:n,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(i)}).each((function(e){return U(m,void 0,void 0,(function(){var t,r;return A(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,ki(n,t)&&(r=t[this.keyName],o.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:_.sent(),_.label=4;case 4:_.trys.push([4,9,10,11]),u=v(o),l=u.next(),_.label=5;case 5:return l.done?[3,8]:(c=l.value,[4,this._requestRemove(c)]);case 6:_.sent(),_.label=7;case 7:return l=u.next(),[3,5];case 8:return[3,11];case 9:return d=_.sent(),f={error:d},[3,11];case 10:try{l&&!l.done&&(p=u.return)&&p.call(u)}finally{if(f)throw f.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return _.sent(),this._mutex.unlock(),[2,o];case 13:throw h=_.sent(),this._mutex.unlock(),h;case 14:return[3,16];case 15:throw this._transaction.clear(),Si.collectionNotReady;case 16:return[2]}}))}))},e.prototype.clear=function(){return U(this,void 0,void 0,(function(){var e;return A(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Si.collectionNotReady;case 9:return[2]}}))}))},e.prototype.getBlob=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){switch(n.label){case 0:return[4,this._blobContainer.save(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),cs="[NESTDB]",ds=!0,hs=function(){function e(){}return e.off=function(){ds=!1},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ds&&console.log.apply(console,p(["".concat(cs,"[LOG]")],m(e),!1))},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ds&&console.warn.apply(console,p(["".concat(cs,"[WARNING]")],m(e),!1))},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ds&&console.error.apply(console,p(["".concat(cs,"[ERROR]")],m(e),!1))},e}(),fs=[{},{a:700400,n:"error"}],ps=function(){function e(e){var t,n,r;this.encryption=null!==(t=e.encryption)&&void 0!==t?t:ve,this.itemSizeLimit=null!==(n=e.itemSizeLimit)&&void 0!==n?n:4194304,this.metadataBuffer=null!==(r=e.metadataBuffer)&&void 0!==r?r:256}return Object.defineProperty(e.prototype,"_encryptionCheckKey",{get:function(){return"".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_reservedKeys",{get:function(){return[this._encryptionCheckKey]},enumerable:!1,configurable:!0}),e.prototype._getRawKey=function(e,t){return void 0===t&&(t=""),"".concat(e).concat(t)},e.prototype._generateShardPostfixArray=function(e){return void 0===e&&(e=1),p([],m(Array(e).keys()),!1)},e.prototype._shardify=function(e){var t=this,n=e.key,r=e.value,i=JSON.stringify(this.encryption.encrypt(r)),s=Math.ceil(i.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(s).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:i.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:s}),r}))},e.prototype._resetIfEncryptionChanged=function(){return U(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u,l=this;return A(this,(function(c){switch(c.label){case 0:return[4,this.get(this._encryptionCheckKey)];case 1:if(e=c.sent(),t={encrypted:fs.map((function(e){var t;return null===(t=l.encryption)||void 0===t?void 0:t.encrypt(e)}))},!e)return[3,8];if(!e.encrypted||!Array.isArray(e.encrypted))return[3,6];for(i in n=e.encrypted,r=[],n)r.push(i);s=0,c.label=2;case 2:return s<r.length?(i=r[s])in n?(a=i,o=JSON.stringify(e.encrypted[a]),u=JSON.stringify(t.encrypted[a]),o===u?[3,4]:(hs.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return c.sent(),[3,5];case 4:return s++,[3,2];case 5:return[3,8];case 6:return[4,this.clear()];case 7:c.sent(),c.label=8;case 8:return[4,this.set({key:this._encryptionCheckKey,value:t})];case 9:return c.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),e.prototype.usage=function(){return U(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o,u;return A(this,(function(l){switch(l.label){case 0:return e=0,[4,this._getAllRawKeys()];case 1:t=l.sent(),l.label=2;case 2:l.trys.push([2,7,8,9]),n=v(t),r=n.next(),l.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._getRaw(i)]);case 4:(s=l.sent())&&(e+=JSON.stringify(s).length),l.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return a=l.sent(),o={error:a},[3,9];case 8:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}return[7];case 9:return[2,e]}}))}))},e.prototype.getAllKeys=function(){return U(this,void 0,void 0,(function(){var e=this;return A(this,(function(t){switch(t.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,t.sent().filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")})).filter((function(t){return!e._reservedKeys.includes(t)}))]}}))}))},e.prototype.get=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o=this;return A(this,(function(u){switch(u.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:if(!(n=u.sent()))return[3,7];u.label=2;case 2:return u.trys.push([2,6,,7]),r=n.data,(null==(i=n.metadata)?void 0:i.shards)&&i.shards>1?[4,Promise.all(this._generateShardPostfixArray(null==i?void 0:i.shards).map((function(t){return U(o,void 0,void 0,(function(){var n,i;return A(this,(function(s){switch(s.label){case 0:return t>0?(n=this._getRawKey(e,".".concat(t)),[4,this._getRaw(n)]):[3,2];case 1:if(!(i=s.sent()))throw Si.storeBrokenIntegrity;return[2,i.data];case 2:return[2,r]}}))}))})))]:[3,4];case 3:return a=u.sent(),[3,5];case 4:a=[r],u.label=5;case 5:return s=a,[2,this.encryption.decrypt(JSON.parse(s.join("")))];case 6:return u.sent(),[2,null];case 7:return[2,null]}}))}))},e.prototype.set=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return t=this._shardify(e),[4,this._setRaw(t)];case 1:return n.sent(),[2,u({},e.value)]}}))}))},e.prototype.setMany=function(e){return U(this,void 0,void 0,(function(){var t,n=this;return A(this,(function(r){switch(r.label){case 0:return t=[],[4,this._setRaw(t.concat.apply(t,p([],m(e.map((function(e){return n._shardify(e)}))),!1)))];case 1:return r.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a=this;return A(this,(function(o){switch(o.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:return(n=o.sent())?(r=n.metadata,i=this._generateShardPostfixArray(null==r?void 0:r.shards).map((function(t){return a._getRawKey(e,".".concat(t))})),[4,this._removeRaw(i)]):[3,3];case 2:return o.sent(),null==(s=$i.get(this.dbname))||s.remove(e),[2,!0];case 3:return[2,!1]}}))}))},e.prototype.removeMany=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c,d=this;return A(this,(function(h){switch(h.label){case 0:t=$i.get(this.dbname),n=[],r=function(e){var r,s,a;return A(this,(function(o){switch(o.label){case 0:return r=i._getRawKey(e,".0"),[4,i._getRaw(r)];case 1:return(s=o.sent())&&(a=s.metadata,n.push.apply(n,p([],m(i._generateShardPostfixArray(null==a?void 0:a.shards).map((function(t){return d._getRawKey(e,".".concat(t))}))),!1))),null==t||t.remove(e),[2]}}))},i=this,h.label=1;case 1:h.trys.push([1,6,7,8]),s=v(e),a=s.next(),h.label=2;case 2:return a.done?[3,5]:(o=a.value,[5,r(o)]);case 3:h.sent(),h.label=4;case 4:return a=s.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(c=s.return)&&c.call(s)}finally{if(l)throw l.error}return[7];case 8:return n.length>0?[4,this._removeRaw(n)]:[3,10];case 9:h.sent(),h.label=10;case 10:return[2,e]}}))}))},e.prototype.clear=function(){return U(this,void 0,void 0,(function(){var e;return A(this,(function(t){return null==(e=$i.get(this.dbname))||e.clearForDatabase(this.dbname),[2]}))}))},e}(),ms={},vs=function(e){function t(t){void 0===t&&(t={});var n,r=this;r=e.call(this,u(u({},t),{itemSizeLimit:null!==(n=t.itemSizeLimit)&&void 0!==n?n:4194304}))||this;var i=t.delay,s=void 0===i?1:i;return r.delay=s,r.observer={},r}return r(t,e),Object.defineProperty(t.prototype,"rawData",{get:function(){return ms[this.dbname]},set:function(e){ms[this.dbname]=e},enumerable:!1,configurable:!0}),t.prototype._getAllRawKeys=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){if(ms[this.dbname])return[2,Object.keys(ms[this.dbname])];throw Si.storeNotAvailable}))}))},t.prototype._getRaw=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return ms[this.dbname]?[4,Oi(this.delay)]:[3,2];case 1:return t.sent(),[2,ms[this.dbname][e]?u({key:e},ms[this.dbname][e]):null];case 2:throw Si.storeNotAvailable}}))}))},t.prototype._setRaw=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u;return A(this,(function(l){switch(l.label){case 0:return ms[this.dbname]?[4,Oi(this.delay)]:[3,2];case 1:l.sent();try{for(t=v(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,s=r.data,a=r.metadata,ms[this.dbname][i]=Object.freeze({data:s,metadata:a})}catch(e){o={error:e}}finally{try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}}return[3,3];case 2:throw Si.storeNotAvailable;case 3:return[2]}}))}))},t.prototype._removeRaw=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s;return A(this,(function(a){switch(a.label){case 0:return ms[this.dbname]?[4,Oi(this.delay)]:[3,2];case 1:a.sent();try{for(t=v(e),n=t.next();!n.done;n=t.next())r=n.value,ms[this.dbname][r]&&delete ms[this.dbname][r]}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[3,3];case 2:throw Si.storeNotAvailable;case 3:return[2]}}))}))},t.prototype.observe=function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}))},t.prototype.checkAvailability=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){return[2]}))}))},t.prototype.init=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return this.dbname=e,ms[this.dbname]||(ms[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},t.prototype.set=function(t){return U(this,void 0,void 0,(function(){var n,r;return A(this,(function(i){if((n=this.observer[t.key])&&"function"==typeof n.set&&(r=n.set()))throw r;return[2,e.prototype.set.call(this,t)]}))}))},t.prototype.setMany=function(t){return U(this,void 0,void 0,(function(){var n,r,i,s,a,o,u;return A(this,(function(l){try{for(n=v(t),r=n.next();!r.done;r=n.next())if(i=r.value,(s=this.observer[i.key])&&"function"==typeof s.set&&(a=s.set()))throw a}catch(e){o={error:e}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}}return[2,e.prototype.setMany.call(this,t)]}))}))},t.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return t.sent(),[4,Oi(this.delay)];case 2:return t.sent(),ms[this.dbname]={},[2]}}))}))},t}(ps),_s="NestDBStore";!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.OPENING=1]="OPENING",e[e.OPEN=2]="OPEN",e[e.CLOSED=3]="CLOSED"}(as||(as={}));var ys=function(e){function t(t){void 0===t&&(t={});var n,r=this;return(r=e.call(this,u(u({},t),{itemSizeLimit:null!==(n=t.itemSizeLimit)&&void 0!==n?n:104857600}))||this)._storeName=_s,r._state=as.UNINITIALIZED,r._openJobQueue=[],r._window="undefined"!=typeof window?window:void 0,r._indexedDb=r._window?r._window.indexedDB||r._window.mozIndexedDB||r._window.webkitIndexedDB||r._window.msIndexedDB:void 0,r}return r(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.isTransactionInactiveError=function(e){return e instanceof Error&&e.message.includes("The transaction is inactive")},t.prototype._putToObjectStore=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){return[2,new Promise((function(n,r){var i=e.put(t);i.addEventListener("success",(function(e){n(e.target.result)})),i.addEventListener("error",(function(e){r(e.target.error)}))}))]}))}))},t.prototype._deleteFromObjectStore=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){return[2,new Promise((function(n,r){var i=e.delete(t);i.addEventListener("success",(function(){return n(t)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))]}))}))},t.prototype._openDatabase=function(e){var t=this;return new Promise((function(n,r){if(t._indexedDb){t._state=as.OPENING;var i=t._indexedDb.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(_s,{keyPath:"key"})})),i.addEventListener("success",(function(r){t._state=as.OPEN,t._database=r.target.result,t._openJobQueue.forEach((function(e){return e()})),t._openJobQueue=[],t._database.onclose=function(){t._database=void 0,t._state=as.OPENING,setTimeout((function(){t._openDatabase(e)}),5)},n(t._database)})),i.addEventListener("error",(function(e){t._state=as.UNINITIALIZED,r(e.target.error)}))}else r(Si.storeNotAvailable)}))},t.prototype._getObjectStore=function(e){return U(this,void 0,void 0,(function(){var t,n=this;return A(this,(function(r){switch(r.label){case 0:return this._database?((t=this._database.transaction(this._storeName,e)).addEventListener("abort",(function(e){throw e.target.error})),[2,t.objectStore(this._storeName)]):[3,1];case 1:switch(this._state){case as.UNINITIALIZED:case as.OPEN:return[3,2];case as.OPENING:case as.CLOSED:return[3,3]}return[3,4];case 2:throw Si.storeNotInitialized;case 3:return[2,new Promise((function(t){n._openJobQueue.push((function(){return t(n._getObjectStore(e))}))}))];case 4:return[4,this._getObjectStore(e)];case 5:return[2,r.sent()]}}))}))},t.prototype._getAllRawKeys=function(){return U(this,void 0,void 0,(function(){var e=this;return A(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){return U(e,void 0,void 0,(function(){var e,r;return A(this,(function(i){switch(i.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return e=i.sent(),(r=e.getAllKeys()).addEventListener("success",(function(e){t(e.target.result)})),r.addEventListener("error",(function(e){return n(e.target.error)})),[2]}}))}))}))];case 1:return[2,t.sent()]}}))}))},t.prototype._getRaw=function(e){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,r){return U(t,void 0,void 0,(function(){var t,i;return A(this,(function(s){switch(s.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return t=s.sent(),(i=t.get(e)).addEventListener("success",(function(e){var t;n(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)})),i.addEventListener("error",(function(e){return r(e.target.error)})),[2]}}))}))}))];case 1:return[2,n.sent()]}}))}))},t.prototype._setRaw=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c=this;return A(this,(function(d){switch(d.label){case 0:return d.trys.push([0,3,,15]),[4,this._getObjectStore("readwrite")];case 1:return t=d.sent(),[4,Promise.all(e.map((function(e){return c._putToObjectStore(t,e)})))];case 2:return d.sent(),[3,15];case 3:return n=d.sent(),this.isTransactionInactiveError(n)?[4,this._getObjectStore("readwrite")]:[3,13];case 4:r=d.sent(),d.label=5;case 5:d.trys.push([5,10,11,12]),i=v(e),s=i.next(),d.label=6;case 6:return s.done?[3,9]:(a=s.value,[4,this._putToObjectStore(r,a)]);case 7:d.sent(),d.label=8;case 8:return s=i.next(),[3,6];case 9:return[3,12];case 10:return o=d.sent(),u={error:o},[3,12];case 11:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(u)throw u.error}return[7];case 12:return[3,14];case 13:throw n;case 14:return[3,15];case 15:return[2]}}))}))},t.prototype._removeRaw=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c=this;return A(this,(function(d){switch(d.label){case 0:return d.trys.push([0,3,,15]),[4,this._getObjectStore("readwrite")];case 1:return t=d.sent(),[4,Promise.all(e.map((function(e){return c._deleteFromObjectStore(t,e)})))];case 2:return d.sent(),[3,15];case 3:return n=d.sent(),this.isTransactionInactiveError(n)?[4,this._getObjectStore("readwrite")]:[3,13];case 4:r=d.sent(),d.label=5;case 5:d.trys.push([5,10,11,12]),i=v(e),s=i.next(),d.label=6;case 6:return s.done?[3,9]:(a=s.value,[4,this._deleteFromObjectStore(r,a)]);case 7:d.sent(),d.label=8;case 8:return s=i.next(),[3,6];case 9:return[3,12];case 10:return o=d.sent(),u={error:o},[3,12];case 11:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(u)throw u.error}return[7];case 12:return[3,14];case 13:throw n;case 14:return[3,15];case 15:return[2]}}))}))},t.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))},t.prototype.checkAvailability=function(){return U(this,void 0,void 0,(function(){var e,t=this;return A(this,(function(n){switch(n.label){case 0:if(!((null==(e="undefined"!=typeof window?window:null)?void 0:e.indexedDB)||(null==e?void 0:e.mozIndexedDB)||(null==e?void 0:e.webkitIndexedDB)||(null==e?void 0:e.msIndexedDB)))return[3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!is())return[3,4];if(!(is()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return[3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw Si.storeNotAvailableInPrivateBrowsing;return[3,3];case 1:return[4,new Promise((function(e,n){if(t._indexedDb)try{var r=t._indexedDb.open("_testMozilla");r.onerror=function(){return n(Si.storeNotAvailableInPrivateBrowsing)},r.onsuccess=function(r){if(r.target.result.close(),t._indexedDb){var i=t._indexedDb.deleteDatabase("_testMozilla");i.onerror=function(){return e()},i.onsuccess=function(){return e()}}else n(Si.storeNotAvailable)}}catch(e){n(Si.storeNotAvailableInPrivateBrowsing)}else n(Si.storeNotAvailable)}))];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:throw Si.storeNotAvailable;case 5:return[3,7];case 6:throw Si.storeNotAvailable;case 7:return[2]}}))}))},t.prototype.init=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return t.sent(),[4,this._openDatabase(e)];case 2:return t.sent(),[4,this._resetIfEncryptionChanged()];case 3:return t.sent(),[2]}}))}))},t.prototype.clear=function(){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return n.sent(),[4,new Promise((function(e,n){return U(t,void 0,void 0,(function(){var t,r;return A(this,(function(i){switch(i.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return t=i.sent(),(r=t.clear()).addEventListener("success",(function(){return e()})),r.addEventListener("error",(function(e){return n(e.target.error)})),[2]}}))}))}))];case 2:return[2,n.sent()]}}))}))},t}(ps),gs=function(e){function t(t){var n=this,r=t.AsyncStorage,i=t.itemSizeLimit,s=void 0===i?2097152:i,a=_e(t,["AsyncStorage","itemSizeLimit"]);return(n=e.call(this,u(u({},a),{itemSizeLimit:s}))||this)._asyncStorage=r,n}return r(t,e),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return U(this,void 0,void 0,(function(){var e,t=this;return A(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},t.prototype._getRaw=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},t.prototype._setRaw=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o;return A(this,(function(u){switch(u.label){case 0:t=[];try{for(n=v(e),r=n.next();!r.done;r=n.next())i=r.value,s=i.key,i.data.length<=this.adjustedItemSizeLimit&&t.push([this._getActualKey(s),JSON.stringify(i)])}catch(e){a={error:e}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}}return[4,this._asyncStorage.multiSet(t)];case 1:return u.sent(),[2]}}))}))},t.prototype._removeRaw=function(e){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2]}}))}))},t.prototype.checkAvailability=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){if(!this._asyncStorage)throw Si.storeNotAvailable;return[2]}))}))},t.prototype.init=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},t.prototype.clear=function(){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return n.sent(),[4,this.getAllKeys()];case 2:return t=n.sent(),[4,this.removeMany(t)];case 3:return n.sent(),[2]}}))}))},t}(ps),bs=function(e){function t(t){var n,r,i=this;return(i=e.call(this,u(u({},t),{itemSizeLimit:null!==(n=t.itemSizeLimit)&&void 0!==n?n:6291456}))||this)._mmkv=(r=t.MMKV,{getString:function(e){return r.getString(e)},set:function(e,t){return r.set(e,t)},delete:function(e){return r.remove?r.remove(e):r.delete(e)},getAllKeys:function(){return r.getAllKeys()}}),i}return r(t,e),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return U(this,void 0,void 0,(function(){var e,t=this;return A(this,(function(n){switch(n.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},t.prototype._getRaw=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},t.prototype._setRaw=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a;return A(this,(function(o){try{for(t=v(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,r.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(i),JSON.stringify(r))}catch(e){s={error:e}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}}return[2]}))}))},t.prototype._removeRaw=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s;return A(this,(function(a){try{for(t=v(e),n=t.next();!n.done;n=t.next())r=n.value,this._mmkv.delete(this._getActualKey(r))}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]}))}))},t.prototype.checkAvailability=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){if(!this._mmkv)throw Si.storeNotAvailable;return[2]}))}))},t.prototype.init=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},t.prototype.clear=function(){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return n.sent(),[4,this.getAllKeys()];case 2:return t=n.sent(),[4,this.removeMany(t)];case 3:return n.sent(),[2]}}))}))},t}(ps);var Is;!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(Is||(Is={}));var Es,ws=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=Is.INIT,this._config=i||new Ti({dbname:t}),this._store=r,this._event={success:Pi,error:Pi,storeReplaced:Pi,upgrade:Di},this._collections=new Map,this._globalMutex=new us("".concat(this.name,".lock")),this._config.disableLogger&&hs.off(),new $i({dbname:t,limit:this._config.cacheLimit})}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),e.prototype._initializeCollection=function(e,t){var n;return U(this,void 0,void 0,(function(){var r,i,s;return A(this,(function(a){switch(a.label){case 0:return i=this._collections.get(e),t?(r=new ls({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:null!==(n=t.index)&&void 0!==n?n:[[t.keyName]],store:this._store}),[3,3]):[3,1];case 1:return i&&i.state===Mi.READY?[3,3]:[4,ls.metadataOf(this.name,e,this._store)];case 2:(s=a.sent())&&(r=new ls({dbname:this.name,collectionName:e,keyName:s.keyName,indexes:s.indexes,store:this._store})),a.label=3;case 3:return r?(this._collections.set(e,r),[4,r.init()]):[3,5];case 4:a.sent(),a.label=5;case 5:return[2]}}))}))},e.prototype.estimateUsage=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,(t=this._store,U(void 0,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,t.usage()];case 1:return[2,e.sent()]}}))})))];case 1:return[2,e.sent()]}var t}))}))},e.prototype.commitSchema=function(e){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return this._state!==Is.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return U(t,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,this._initializeCollection(e.collectionName,e)];case 1:return t.sent(),[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw Si.databaseSchemaNotOnUpgrade;case 3:return[2]}}))}))},e.prototype.open=function(){var e;return U(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c,d=this;return A(this,(function(h){switch(h.label){case 0:return[4,this._globalMutex.lock()];case 1:if(h.sent(),this._state===Is.OPENED)return[3,20];this._state=Is.OPENING,h.label=2;case 2:return h.trys.push([2,13,,20]),[4,this._store.init(this.name)];case 3:return h.sent(),f=this.name,t="".concat(Ki(f),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:r=null!==(e=h.sent())&&void 0!==e?e:n,h.label=5;case 5:h.trys.push([5,10,11,12]),i=v(r.collectionNames),s=i.next(),h.label=6;case 6:return s.done?[3,9]:(a=s.value,[4,this._initializeCollection(a)]);case 7:h.sent(),h.label=8;case 8:return s=i.next(),[3,6];case 9:return[3,12];case 10:return o=h.sent(),l={error:o},[3,12];case 11:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(l)throw l.error}return[7];case 12:return[2,new Promise((function(e,n){var i=function(e){r.version<d._version?d._event.upgrade(r.version,(function(n){return U(d,void 0,void 0,(function(){var i;return A(this,(function(s){switch(s.label){case 0:if(n)return[3,5];r.version++,r.collectionNames=Array.from(this._collections.keys()),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r})];case 2:return s.sent(),e({continued:!0}),[3,4];case 3:return i=s.sent(),e({continued:!1,err:i}),[3,4];case 4:return[3,6];case 5:e({continued:!1,err:n}),s.label=6;case 6:return[2]}}))}))})):e({continued:!1})},s=function(t){var a=t.continued,o=void 0!==a&&a,u=t.err,l=void 0===u?null:u;o?setTimeout((function(){return i(s)}),10):l?(hs.error(l.message),d._globalMutex.unlock(),d._event.error(l),n(l)):Promise.all(r.collectionNames.map((function(e){return d._initializeCollection(e)}))).then((function(){d._state=Is.OPENED,d._globalMutex.unlock(),d._event.success(),e()})).catch((function(e){hs.error(e.message),d._globalMutex.unlock(),d._event.error(e),n(e)}))};i(s)}))];case 13:switch(u=h.sent(),u.code){case li.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,14];case li.STORE_NOT_AVAILABLE:return[3,16]}return[3,18];case 14:return hs.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new vs({}),this._globalMutex.unlock(),this._event.error(u),this._event.storeReplaced(this._store),[4,this.open()];case 15:return h.sent(),[3,19];case 16:return hs.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new vs({}),this._globalMutex.unlock(),this._event.error(u),this._event.storeReplaced(this._store),[4,this.open()];case 17:return h.sent(),[3,19];case 18:throw hs.error(u.message),this._globalMutex.unlock(),this._event.error(u),u;case 19:return[3,20];case 20:return[2]}var f}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=Is.CLOSED},e.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return U(this,void 0,void 0,(function(){var e;return A(this,(function(t){switch(t.label){case 0:return(e=$i.get(this.name))&&e.clearForDatabase(this.name),[4,this._store.clear()];case 1:return t.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=Di;else this._event[e]=Pi},e.prototype.collection=function(e){var t=this._collections.get(e);if(t)return t;throw Si.collectionNotReady},e}();!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.NONE=5]="NONE"}(Es||(Es={}));var Ts,Ms=function(){function e(){this.level=Es.WARN}return e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Es.VERBOSE&&console.log.apply(console,p(["[verbose]"],m(e),!1))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Es.DEBUG&&console.log.apply(console,p(["[debug]"],m(e),!1))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Es.INFO&&console.log.apply(console,p(["[info]"],m(e),!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Es.WARN&&console.warn.apply(console,p(["[warn]"],m(e),!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Es.ERROR&&console.error.apply(console,p(["[error]"],m(e),!1))},e}(),Ss=function(){function e(e){var t,n,r,i;this.messageTypeFilter=null!==(t=null==e?void 0:e.messageTypeFilter)&&void 0!==t?t:R.ALL,this.customTypesFilter=null!==(n=null==e?void 0:e.customTypesFilter)&&void 0!==n?n:null,this.senderUserIdsFilter=null!==(r=null==e?void 0:e.senderUserIdsFilter)&&void 0!==r?r:null,this.replyType=null!==(i=null==e?void 0:e.replyType)&&void 0!==i?i:V.NONE}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case R.USER:if(e.messageType!==g.USER)return!1;break;case R.FILE:if(e.messageType!==g.FILE)return!1;break;case R.ADMIN:if(e.messageType!==g.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof st))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}if(e instanceof it)switch(this.replyType){case V.NONE:if(e.parentMessageId>0)return!1;break;case V.ONLY_REPLY_TO_CHANNEL:if(e instanceof st&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},e}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(Ts||(Ts={}));var Us,As=function(e){switch(e){case Ts.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case Ts.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Ns=function(){return["channelUrl","-createdAt","-notificationId"]},Cs=u(u({},Ht),{scheduledAt:void 0}),Os=function(e){return Xt(e)&&h("number",e.scheduledAt,!0)},ks=u(u({},Qt),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),Ps=function(e){return Gt(e)&&h("number",e.scheduledAt)&&(Q(e.file)||h("string",e.fileUrl))&&h("string",e.fileName,!0)&&h("string",e.mimeType,!0)&&h("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return h("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Rs="UnsentMessage",xs="reqId",Ds={},Ls=function(t){function i(e){var n=t.call(this,e)||this;return n._mutex=new us("unsendmessagecache.lock"),Ds[e]=n,n}return r(i,t),Object.defineProperty(i.prototype,"_cacheContext",{get:function(){return n.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),i.of=function(e,t){return void 0===t&&(t=!1),Ds[e]&&!t||(Ds[e]=new i(e)),Ds[e]},Object.defineProperty(i.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,t=null==e?void 0:e.collection(Rs);if(!t)throw O.databaseError;return t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),i.prototype._serialize=function(t){if(t.messageId>0)throw O.invalidParameters;var n,r=u({},t.serialize());return t instanceof dt?(t.messageParams&&(r.messageParams=Vt(t.messageParams)),t.scheduledInfo&&t.scheduledInfo.scheduledMessageParams&&(r.scheduledInfo.scheduledMessageParams=(n=t.scheduledInfo.scheduledMessageParams,u(u({},Vt(n)),{scheduledAt:n.scheduledAt})))):t instanceof vt?(t.messageParams&&(r.messageParams=en(t.messageParams)),t.scheduledInfo&&t.scheduledInfo.scheduledMessageParams&&(r.scheduledInfo.scheduledMessageParams=function(e){return u(u({},en(e)),{scheduledAt:e.scheduledAt})}(t.scheduledInfo.scheduledMessageParams))):t instanceof ht&&t.messageParams&&(r.messageParams=function(t){return e({fileInfoList:t.fileInfoList.map((function(e){return{file:e.file,fileUrl:_t.getPlainUrl(e),fileName:e.fileName,fileSize:e.fileSize,mimeType:e.mimeType,thumbnailSizes:e.thumbnailSizes,_thumbnails:e._thumbnails,_uploadedMetaData:e._uploadedMetaData}})),isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption})}(t.messageParams)),r},i.prototype._deserialize=function(e){return e=u(u({},e),{messageId:parseInt(e.messageId)}),Xs.of(this._iid).buildMessageFromSerializedData(e)},i.prototype._deserializeWithMessageCreateParams=function(e){var t,n,r;return U(this,void 0,void 0,(function(){var i,s,a,o,u,l,c=this;return A(this,(function(d){switch(d.label){case 0:return i=Xs.of(this._iid),s=this._deserialize(e),e.messageParams?s instanceof dt?(o=e.messageParams,s.messageParams=i.buildUserMessageCreateParamsFromSerializedData(o,s),[3,6]):[3,1]:[3,6];case 1:return s instanceof vt?(o=e.messageParams).fileKey&&"string"==typeof o.fileKey&&$t(null!==(t=o.fileType)&&void 0!==t?t:"")?(a=o,[4,this.collection.getBlob(o.fileKey)]):[3,3]:[3,4];case 2:a.file=null!==(n=d.sent())&&void 0!==n?n:void 0,d.label=3;case 3:return s.messageParams=i.buildFileMessageCreateParamsFromSerializedData(o,s),[3,6];case 4:return s instanceof ht&&((o=e.messageParams)&&o.fileInfoList)?(s.messageParams=i.buildMultipleFilesMessageCreateParamsFromSerializedData(o,s),[4,Promise.all(s.messageParams.fileInfoList.map((function(e){return U(c,void 0,void 0,(function(){var t,n,r,i,s;return A(this,(function(a){switch(a.label){case 0:return"string"==typeof(null===(n=e._uploadedMetaData)||void 0===n?void 0:n.fileKey)&&$t(null!==(i=null===(r=e._uploadedMetaData)||void 0===r?void 0:r.fileType)&&void 0!==i?i:"")?(t=e,[4,this.collection.getBlob(e._uploadedMetaData.fileKey)]):[3,2];case 1:t.file=null!==(s=a.sent())&&void 0!==s?s:void 0,a.label=2;case 2:return[2]}}))}))})))]):[3,6];case 5:d.sent(),d.label=6;case 6:return s.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?s instanceof dt?(u=e.scheduledInfo.scheduledMessageParams,s.scheduledInfo.scheduledMessageParams=i.buildScheduledUserMessageCreateParamsFromSerializedData(u,s),[3,10]):[3,7]:[3,10];case 7:return s instanceof vt?(u=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof u.fileKey&&"string"==typeof u.fileType&&$t(u.fileType)?(l=u,[4,this.collection.getBlob(u.fileKey)]):[3,9]:[3,10];case 8:l.file=null!==(r=d.sent())&&void 0!==r?r:void 0,d.label=9;case 9:s.scheduledInfo.scheduledMessageParams=i.buildScheduledFileMessageCreateParamsFromSerializedData(u,s),d.label=10;case 10:return[2,s]}}))}))},i.prototype._getFileInfoBlobKey=function(e,t){return"".concat(e,".").concat(t)},i.prototype.get=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserializeWithMessageCreateParams(t)];n.label=2;case 2:return[2,void 0]}}))}))},i.prototype.fetch=function(e){var t=e.channelUrl,n=e.filter,r=void 0===n?new Ss:n,i=e.order,s=void 0===i?Ts.CHANNEL_LATEST:i,a=e.sendingStatus,o=e.backward,u=void 0!==o&&o,l=e.parentMessageId;return U(this,void 0,void 0,(function(){var e,n,i,o,c=this;return A(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?(e=As(s),n={"/where":function(e){return!!(s!==Ts.NEWEST_CHILD_MESSAGE||l&&0!==e.parentMessageId&&e.parentMessageId===l)&&r.match(c._deserialize(e))}},t&&(n.channelUrl=t),a&&(n.sendingStatus=a),i={where:n,index:e,backward:u},[4,this.collection.query(i)]):[3,3];case 1:return[4,d.sent().fetch({})];case 2:return o=d.sent(),[2,Promise.all(o.map((function(e){return U(c,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,this._deserializeWithMessageCreateParams(e)];case 1:return[2,t.sent()]}}))}))})))];case 3:return[2,[]]}}))}))},i.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ss),U(this,void 0,void 0,(function(){return A(this,(function(n){switch(n.label){case 0:return[4,this.fetch({filter:t,order:Ts.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},i.prototype.upsert=function(e){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return U(t,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return e instanceof vt||e instanceof ht?[4,this._mutex.lock()]:[3,4];case 1:return n.sent(),[4,this.saveBlob(e)];case 2:return n.sent(),[4,this._mutex.unlock()];case 3:n.sent(),n.label=4;case 4:return t=this._serialize(e),[4,this.collection.upsertOne(t)];case 5:return n.sent(),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},i.prototype.upsertChildMessages=function(e){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return U(t,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return t=[],e.threadInfo&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=n.sent(),n.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},i.prototype.remove=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=v(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},i.prototype.removeMessagesOfChannel=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},i.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},i.prototype.saveBlob=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i=this;return A(this,(function(s){switch(s.label){case 0:return e instanceof vt?e.messageParams&&(r=e.messageParams).file&&Zt(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,2]:[3,5];case 1:n=s.sent(),r.fileKey=n,r.fileType=Yt.BLOB,s.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&((t=e.scheduledInfo.scheduledMessageParams).file&&Zt(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,4];case 3:n=s.sent(),t.fileKey=n,t.fileType=Yt.BLOB,s.label=4;case 4:return[3,7];case 5:return e instanceof ht&&((r=e.messageParams)&&r.fileInfoList&&Array.isArray(r.fileInfoList))?[4,Promise.all(r.fileInfoList.map((function(t,n){return U(i,void 0,void 0,(function(){var r;return A(this,(function(i){switch(i.label){case 0:return t.file&&Zt(t.file)?[4,this.collection.saveBlob(t.file,this._getFileInfoBlobKey(e.reqId,n))]:[3,2];case 1:r=i.sent(),t._uploadedMetaData||(t._uploadedMetaData={}),t._uploadedMetaData.fileKey=r,t._uploadedMetaData.fileType=Yt.BLOB,i.label=2;case 2:return[2]}}))}))})))]:[3,7];case 6:s.sent(),s.label=7;case 7:return[2]}}))}))},i}(c),Fs={},qs=function(e){function t(t){var n=e.call(this,t)||this;return Fs[t]=n,n}return r(t,e),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return n.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return n.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return Ls.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,n){return void 0===n&&(n=!1),Fs[e]&&!n||(Fs[e]=new t(e)),Fs[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return x(!!e).throw(O.databaseError),e.collection(qr)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return u(u({},e.serialize()),{messageId:"".concat(e.messageId)})},t.prototype._deserialize=function(e){return e=u(u({},e),{messageId:parseInt(e.messageId)}),Xs.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,void 0]}}))}))},t.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,i=void 0===r?100:r,s=e.filter,a=void 0===s?new Ss:s,o=e.order,u=void 0===o?Ts.CHANNEL_LATEST:o,l=e.backward,c=void 0!==l&&l,d=e.parentMessageId,h=e.isPollOnly,f=void 0!==h&&h,p=e.exactMatch,m=void 0!==p&&p,v=e.inclusive,_=void 0===v||v,y=e.isRestoreIndexedDB,g=void 0!==y&&y;return U(this,void 0,void 0,(function(){var e,r,s,o,l=this;return A(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=As(u),r={where:{channelUrl:t,"/where":function(e){if(null!=n&&""!==n)switch(u){case Ts.CHANNEL_LATEST:if(m&&e.createdAt!==n)return!1;if(c){if(_&&e.createdAt<n||!_&&e.createdAt<=n)return!1}else if(_&&e.createdAt>n||!_&&e.createdAt>=n)return!1;break;case Ts.NEWEST_CHILD_MESSAGE:if(!d||0===e.parentMessageId||e.parentMessageId!==d)return!1}return!(f&&!e._poll)&&a.match(l._deserialize(e))}},index:e,backward:c},[4,this.collection.query(r)]):[3,5];case 1:return s=h.sent(),this._cacheContext.localCacheConfig.enableRestoreDB&&g?[4,s.indexer.restoreIndexer()]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,s.fetch({limit:null!=i?i:void 0})];case 4:return o=h.sent(),[2,Promise.all(o.map((function(e){return U(l,void 0,void 0,(function(){return A(this,(function(t){return[2,this._deserialize(e)]}))}))})))];case 5:return[2,[]]}}))}))},t.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ss),U(this,void 0,void 0,(function(){return A(this,(function(n){switch(n.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:Ts.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},t.prototype.upsert=function(e){var t;return U(this,void 0,void 0,(function(){var n,r,i,s,a,o,u,l,c=this;return A(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,13];case 1:d.sent(),d.label=2;case 2:d.trys.push([2,7,8,9]),n=v(e),r=n.next(),d.label=3;case 3:return r.done?[3,6]:(i=r.value,(null===(t=i.threadInfo)||void 0===t?void 0:t._isUpdateRequired)?[4,this.get(i.messageId)]:[3,5]);case 4:(null==(s=d.sent())?void 0:s.threadInfo)&&i.threadInfo._updateFrom(s.threadInfo),d.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return a=d.sent(),u={error:a},[3,9];case 8:try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(u)throw u.error}return[7];case 9:return o=e.map((function(e){return c._serialize(e)})),[4,this.collection.upsertMany(o)];case 10:return d.sent(),[4,this.upsertChildMessages(e)];case 11:return d.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 12:d.sent(),d.label=13;case 13:return[2]}}))}))},t.prototype.upsertChildMessages=function(e){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return U(t,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=v(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},t.prototype.removeMessagesOfChannel=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:As(Ts.CHANNEL_LATEST)})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},t.prototype.removeUnderOffset=function(e,t,n){return void 0===n&&(n=!1),U(this,void 0,void 0,(function(){return A(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:n?{"<=":t}:{"<":t}},index:As(Ts.CHANNEL_LATEST)})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.countBetween=function(e,t,n){return U(this,void 0,void 0,(function(){var r,i=this;return A(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=As(Ts.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,s.sent()];case 2:return[2,0]}}))}))},t.prototype.saveBlobs=function(e){return U(this,void 0,void 0,(function(){var t=this;return A(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return U(t,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return e instanceof vt&&e.messageParams&&((t=e.messageParams).file&&Zt(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},t.prototype._getGroupChannelPreferenceSize=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return t=0,[4,(n=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return r=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return i=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return s=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return a=o.sent(),r&&(t+=JSON.stringify(r).length),i&&(t+=JSON.stringify(i).length),s&&(t+=JSON.stringify(s).length),a&&(t+=JSON.stringify(a).length),[2,t]}}))}))},t}(c),zs={},Bs=function(e){function t(t){var n=e.call(this,t)||this;return zs[t]=n,n}return r(t,e),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return n.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return n.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,n){return void 0===n&&(n=!1),zs[e]&&!n||(zs[e]=new t(e)),zs[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return x(!!e).throw(O.databaseError),e.collection(jr)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return u({},e.serialize())},t.prototype._deserialize=function(e){return Xs.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,void 0]}}))}))},t.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,i=void 0===r?100:r,s=e.filter,a=void 0===s?new Ss:s,o=e.backward,u=void 0!==o&&o,l=e.exactMatch,c=void 0!==l&&l,d=e.inclusive,h=void 0===d||d;return U(this,void 0,void 0,(function(){var e,r=this;return A(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(e={where:{channelUrl:t,"/where":function(e){if(n){if(c&&e.createdAt!==n)return!1;if(u){if(h&&e.createdAt<n||!h&&e.createdAt<=n)return!1}else if(h&&e.createdAt>n||!h&&e.createdAt>=n)return!1}return a.match(r._deserialize(e))}},index:["channelUrl","-createdAt","-notificationId"],backward:u},[4,this.collection.query(e)]):[3,3];case 1:return[4,s.sent().fetch({limit:null!=i?i:void 0})];case 2:return[2,s.sent().map((function(e){return r._deserialize(e)}))];case 3:return[2,[]]}}))}))},t.prototype.upsert=function(e){return U(this,void 0,void 0,(function(){var t,n=this;return A(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?(t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return U(this,void 0,void 0,(function(){var t,n,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=v(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},t.prototype.markAsReadByTimestamp=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,messageStatus:rt.SENT,createdAt:{"<":t}}},{set:{messageStatus:rt.READ}})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.markAsReadByMessageIds=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,notificationId:{"/in":t},messageStatus:rt.SENT}},{set:{messageStatus:rt.READ}})]:[3,2];case 1:return[2,n.sent().length];case 2:return[2,0]}}))}))},t.prototype.removeMessagesOfChannel=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:["channelUrl","-createdAt","-notificationId"]})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},t.prototype.removeUnderOffset=function(e,t){return U(this,void 0,void 0,(function(){return A(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:As(Ts.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.countBetween=function(e,t,n){return U(this,void 0,void 0,(function(){var r,i=this;return A(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=["channelUrl","-createdAt","-notificationId"],[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,s.sent()];case 2:return[2,0]}}))}))},t}(c),js={},Ks=function(e){function t(t){var n=e.call(this,t)||this;return n._observers=new Map,n._dispatcherContext=n._dispatcher.on((function(e){return U(n,void 0,void 0,(function(){var t,n,r,i,s,a,o,u,l,c,d,h,f,p,m,v,_,y,g,b,E,w=this;return A(this,(function(T){switch(T.label){case 0:return e instanceof N?(t=e.messages,E=e.source,a=e.isWebSocketEventComing,n=t.filter((function(e){return e instanceof it&&e.channelType!==I.OPEN&&e.messageId>0})),r=t.filter((function(e){return e instanceof it&&e.channelType!==I.OPEN&&0===e.messageId})),i=t.filter((function(e){return e instanceof ft})),n.length>0?[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert(n)];case 1:return e.sent(),[4,this._unsentMessageCache.remove(n.map((function(e){return e instanceof st?e.reqId:null})).filter((function(e){return null!==e})))];case 2:return e.sent(),[2]}}))}))}))]:[3,2]):[3,7];case 1:T.sent(),a||this._broadcastUpdateEvent(n,E),T.label=2;case 2:return r.length>0?[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._unsentMessageCache.upsert(r)];case 1:return e.sent(),[2]}}))}))}))]:[3,4];case 3:T.sent(),a||this._broadcastUpdateEvent(r,E),T.label=4;case 4:return i.length>0?[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._notificationCache.upsert(i)];case 1:return e.sent(),[2]}}))}))}))]:[3,6];case 5:T.sent(),a||this._broadcastUpdateEvent(i,E),T.label=6;case 6:return[3,24];case 7:return e instanceof Me?(s=e.messageIds,E=e.source,a=e.isWebSocketEventComing,o=s.filter((function(e){return"number"==typeof e})),u=s.filter((function(e){return"string"==typeof e})),[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return o.length>0?[4,this._messageCache.remove(o)]:[3,2];case 1:e.sent(),e.label=2;case 2:return u.length>0?[4,this._notificationCache.remove(u)]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))}))]):[3,9];case 8:return T.sent(),a||this._broadcastRemoveEvent(s,E),[3,24];case 9:return e instanceof Te?(l=e.reqId,E=e.source,[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._unsentMessageCache.remove([l])];case 1:return e.sent(),[2]}}))}))}))]):[3,11];case 10:return T.sent(),this._broadcastRemoveUnsentEvent(l,E),[3,24];case 11:return e instanceof we?(c=e.polls,E=e.source,this._cacheContext.localCacheEnabled?(d=c.map((function(e){return e.messageId})),[4,Promise.all(d.map((function(e){return w._messageCache.get(e)})))]):[3,14]):[3,15];case 12:return(h=T.sent().filter((function(e){return e}))).length>0&&c.forEach((function(e){var t=h.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert(h)];case 1:return[2,e.sent()]}}))}))}))];case 13:T.sent(),T.label=14;case 14:return this._broadcastPollChangeLogEvent(c,E),[3,24];case 15:return e instanceof Ee?(f=e.event,E=e.source,[4,this._messageCache.get(f.messageId)]):[3,19];case 16:return(p=T.sent())&&p.isUserMessage()&&p.poll&&p.poll.applyPollUpdateEvent(f)?[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert([p])];case 1:return[2,e.sent()]}}))}))}))]:[3,18];case 17:T.sent(),T.label=18;case 18:return this._broadcastPollUpdateEvent(f,E),[3,24];case 19:return e instanceof he?(m=e.event,E=e.source,[4,this._messageCache.get(m.messageId)]):[3,23];case 20:return(v=T.sent())&&v.isUserMessage()&&v.poll&&v.poll.applyPollVoteEvent(m)?[4,Ie((function(){return U(w,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert([v])];case 1:return[2,e.sent()]}}))}))}))]:[3,22];case 21:T.sent(),T.label=22;case 22:return this._broadcastPollVoteEvent(m,E),[3,24];case 23:e instanceof ye?(_=e.event,E=e.source,_.messageId>0&&this._broadcastReactionUpdateEvent(_,E)):e instanceof ge?(y=e.event,E=e.source,this._broadcastThreadUpdateEvent(y,E)):e instanceof be&&(g=e.messageDeletionTimestamp,b=e.channelUrl,E=e.source,this._broadcastMessageRetentionEvent(g,b,E)),T.label=24;case 24:return[2]}}))}))})),n}return r(t,e),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return n.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_dispatcher",{get:function(){return n.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_messageCache",{get:function(){return qs.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return Ls.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_notificationCache",{get:function(){return Bs.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,n){var r;return void 0===n&&(n=!1),js[e]&&!n||(js[e]&&(null===(r=js[e]._dispatcherContext)||void 0===r||r.close()),js[e]=new t(e)),js[e]},t.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onUpdate&&a.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onPollChangeLogUpdate&&a.onPollChangeLogUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onPollUpdate&&a.onPollUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onPollVote&&a.onPollVote(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onRemove&&a.onRemove(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onRemoveUnsent&&a.onRemoveUnsent(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastReactionUpdateEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onReactionUpdate&&a.onReactionUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastThreadUpdateEvent=function(e,t){var n,r;try{for(var i=v(this._observers.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.onThreadInfoUpdate&&a.onThreadInfoUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastMessageRetentionEvent=function(e,t,n){var r,i;try{for(var s=v(this._observers.values()),a=s.next();!a.done;a=s.next()){var o=a.value;o.onDeletedByRetentionPolicy&&o.onDeletedByRetentionPolicy(e,t,n)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t.prototype.subscribe=function(e,t){this._observers.set(e,t)},t.prototype.unsubscribe=function(e){this._observers.delete(e)},t.prototype.unsubscribeAll=function(){this._observers.clear()},t}(c),Qs={},Gs=function(e){function t(t,n){var r=n.sdkState,i=n.cacheContext,s=e.call(this,t)||this;return s._users=new Map,s._sdkState=r,s._cacheContext=i,Qs[t]=s,s}return r(t,e),t.of=function(e){return Qs[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return x(!!e).throw(O.databaseError),e.collection(Yr)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"users",{get:function(){return p([],m(this._users.values()),!1)},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e,t){return u(u({},e.serialize()),{updatedAt:t})},t.prototype._deserialize=function(e){return l._buildUserFromSerializedData(e)},t.prototype.isCachedInMemory=function(e){return this._users.has(e)},t.prototype.getUserInfoFromCache=function(e){if(this._users.has(e))return this._users.get(e)},t.prototype.get=function(e){return U(this,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return this._users.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._users.set(n.userId,n),[2,n];r.label=2;case 2:return[2,void 0];case 3:return[2,this._users.get(e)]}}))}))},t.prototype.fetch=function(e){var t=e.limit,n=void 0===t?100:t,r=e.backward,i=void 0!==r&&r;return U(this,void 0,void 0,(function(){var e,t,r,s=this;return A(this,(function(a){switch(a.label){case 0:if(!this.localCacheEnabled)return[2,[]];a.label=1;case 1:return a.trys.push([1,4,,5]),e={index:["-userId","-updatedAt"],backward:i},[4,this.collection.query(e)];case 2:return[4,a.sent().fetch({limit:n})];case 3:return t=a.sent(),(r=t.map((function(e){return s._deserialize(e)}))).forEach((function(e){s._users.has(e.userId)||s._users.set(e.userId,e)})),[2,r];case 4:return a.sent(),[2,[]];case 5:return[2]}}))}))},t.prototype.upsert=function(e,t){return U(this,void 0,void 0,(function(){var n,r;return A(this,(function(i){switch(i.label){case 0:if(!this.localCacheEnabled)return[3,2];if(n=this._serialize(e,t),r=this._users.get(e.userId)){if(r._hashValue===e._hashValue)return[2];if(r._updatedAt>t)return[2]}return this._users.set(e.userId,l._buildUserFromSerializedData(n)),[4,this.collection.upsertOne(n)];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return this._users.has(e)&&this._users.delete(e),this.localCacheEnabled?[4,this.collection.remove(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.clearMemoryCache=function(){this._users.clear()},t.prototype.clear=function(){return U(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t}(c),Vs=function(t){function n(n){var r=this,s=n.reverse,a=void 0!==s&&s,o=n.limit,u=void 0===o?20:o,l=n.keys,c=n.token;return(r=t.call(this)||this).method=i.GET,r.path="".concat(Se),r.params=e({token:c,limit:u,reverse:a,order:Ue.UPDATED_AT,show_ui_template:!0,show_color_variables:!0,keys:l}),r}return r(n,t),n}(a),Hs=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.next,s=n.has_more,a=void 0!==s&&s,o=n.templates;return r.nextToken=i,r.hasMore=a,r.templates=o.map((function(e){return{template:JSON.stringify(e)}})),r}return r(t,e),t}(o),Ws=function(e){function t(t){var n=this,r=t.key;return(n=e.call(this)||this).method=i.GET,n.path="".concat(Se,"/").concat(r),n}return r(t,e),t}(a),Ys=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.template=JSON.stringify(n),r}return r(t,e),t}(o),Js={},Xs=function(){function n(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._cacheContext=a,qs.of(e),Ls.of(e),Ks.of(e),this.fileMessageQueue=new Tt(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:a}),Js[e]=this}return n.of=function(e){return Js[e]},n.prototype._setSenderInfo=function(e){if(this._cacheContext.localCacheEnabled&&(e.messageType===g.USER||e.messageType===g.FILE)){var t=e.sender;if(t){var n=Gs.of(this._iid),r=n.getUserInfoFromCache(t.userId);if(r){var i=u(u({},e.sender),{nickname:r.nickname,profileUrl:r.plainProfileUrl,requireAuth:r.requireAuth,metadata:r.metaData});e.sender=i}else n.upsert(new l(this._iid,l.payloadify(t)),e.createdAt)}}},n.prototype.buildMessageFromSerializedData=function(e){var t=Ae(e);if(t.notificationId)return new ft(this._iid,ft.payloadify(t));switch(this._setSenderInfo(t),t.messageType){case g.USER:return new dt(this._iid,dt.payloadify(t));case g.FILE:return ht._isMultipleFilesMessageSerializedData(t)?new ht(this._iid,ht.payloadify(t)):new vt(this._iid,vt.payloadify(t));case g.ADMIN:return new ut(this._iid,ut.payloadify(t))}throw O.invalidParameters},n.prototype.buildUserMessageCreateParamsFromSerializedData=function(n,r){return e(t({data:r.data,customType:r.customType,mentionType:r.mentionType,mentionedUserIds:r.mentionedUserIds,mentionedUsers:r.mentionedUsers,mentionedMessageTemplate:r.mentionedMessageTemplate,metaArrays:r.metaArrays,parentMessageId:r.parentMessageId,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,appleCriticalAlertOptions:r.appleCriticalAlertOptions,reqId:r.reqId,message:r.message,translationTargetLanguages:Object.keys(r.translations),pollId:n.pollId}))},n.prototype.buildFileMessageCreateParamsFromSerializedData=function(n,r){var i;return e(t({data:r.data,customType:r.customType,mentionType:r.mentionType,mentionedUserIds:r.mentionedUserIds,mentionedUsers:r.mentionedUsers,metaArrays:r.metaArrays,parentMessageId:r.parentMessageId,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,appleCriticalAlertOptions:r.appleCriticalAlertOptions,reqId:r.reqId,file:n.file,fileKey:n.fileKey,fileUrl:r.plainUrl,fileName:r.name,fileSize:r.size,mimeType:r.type,thumbnailSizes:null===(i=r.thumbnails)||void 0===i?void 0:i.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:n.fileType,requireAuth:r.requireAuth}))},n.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(t,n){var r=this;return e({data:n.data,customType:n.customType,mentionType:n.mentionType,mentionedUserIds:n.mentionedUserIds,mentionedUsers:n.mentionedUsers,metaArrays:n.metaArrays,parentMessageId:n.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:n.appleCriticalAlertOptions,reqId:n.reqId,fileInfoList:t.fileInfoList.map((function(e){return new _t(r._iid,e)}))})},n.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return u(u({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},n.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return u(u({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},n.prototype.buildSenderFromSerializedData=function(e){var t=Ae(e);return new je(this._iid,je.payloadify(t))},n.prototype.getMessage=function(e){return U(this,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return t=new kt(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Pt).message]}}))}))},n.prototype.getScheduledMessage=function(e){return U(this,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return t=new Ft(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(qt).message]}}))}))},n.prototype.getMessagesByMessageId=function(e,t,n,r,i){return void 0===i&&(i=C.REQUEST_MESSAGE),U(this,void 0,void 0,(function(){var s,a,o;return A(this,(function(l){switch(l.label){case 0:return s=new Rt(u(u(u({channelType:t,channelUrl:e,token:String(n)},Ut),r),{sdkSource:St.EXTERNAL_LEGACY})),[4,this._requestQueue.send(s)];case 1:return a=l.sent(),o=a.as(xt).messages,this._dispatcher.dispatch(new N({messages:o,source:i})),[2,o]}}))}))},n.prototype.getMessagesByTimestamp=function(e,t,n,r,i){return void 0===i&&(i=C.REQUEST_MESSAGE),U(this,void 0,void 0,(function(){var s,a,o;return A(this,(function(l){switch(l.label){case 0:return s=new Rt(u(u(u({channelType:t,channelUrl:e,timestamp:n},Ut),r),{sdkSource:St.EXTERNAL_LEGACY})),[4,this._requestQueue.send(s)];case 1:return a=l.sent(),o=a.as(xt).messages,this._dispatcher.dispatch(new N({messages:o,source:i})),[2,o]}}))}))},n.prototype._getMessagesByTimestampForCollection=function(e,t,n,r,i,s,a,o){return void 0===i&&(i=C.REQUEST_MESSAGE),U(this,void 0,void 0,(function(){var l,c,d,h,f,p;return A(this,(function(m){switch(m.label){case 0:return l=new Rt(u(u(u({channelType:t,channelUrl:e,timestamp:n},Ut),r),{checkingHasNext:s,checkingContinuousMessages:a,sdkSource:o})),[4,this._requestQueue.send(l)];case 1:return c=m.sent(),d=c.as(xt),h=d.messages,f=d.isContinuousMessages,p=d.hasNext,this._dispatcher.dispatch(new N({messages:h,source:i})),[2,{messages:h,isContinuousMessages:f,hasNext:p}]}}))}))},n.prototype.getThreadedMessagesByTimestamp=function(e,t,n,r){return void 0===r&&(r=C.REQUEST_THREADED_MESSAGE),U(this,void 0,void 0,(function(){var i,s,a,o;return A(this,(function(l){switch(l.label){case 0:return i=new Rt(u(u(u({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},at),n),{replyType:V.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(i)];case 1:return s=l.sent(),a=s.as(xt).messages,(o=a.slice(1)).forEach((function(t){t.parentMessage=e})),this._dispatcher.dispatch(new N({messages:o,source:r})),[2,{parentMessage:a[0],threadedMessages:o}]}}))}))},n.prototype.getMessageTemplatesByToken=function(e,t){return void 0===t&&(t={}),U(this,void 0,void 0,(function(){var n,r,i,s,a,o;return A(this,(function(l){switch(l.label){case 0:return n=new Vs(u({token:e},t)),[4,this._requestQueue.send(n)];case 1:return r=l.sent(),i=r.as(Hs),s=i.hasMore,a=i.nextToken,o=i.templates,[2,{hasMore:s,token:a,templates:o}]}}))}))},n.prototype.getMessageTemplate=function(e){return U(this,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return t=new Ws({key:e}),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,{template:n.as(Ys).template}]}}))}))},n.prototype.getMessageChangelogs=function(n,r,i,s,a){return void 0===a&&(a=C.REQUEST_MESSAGE_CHANGELOGS),U(this,void 0,void 0,(function(){var o,l,c,d,h,f,p,m,v;return A(this,(function(_){switch(_.label){case 0:return o=new Dt(e(t(u(u({channelType:r,channelUrl:n,timestamp:"number"==typeof i?i:null,token:"string"==typeof i?i:null},Nt),s)))),[4,this._requestQueue.send(o)];case 1:return l=_.sent(),c=l.as(Lt),d=c.updatedMessages,h=c.deletedMessagesInfo,f=c.hasMore,p=c.nextToken,m=c.forceUseNextToken,v=h.map((function(e){return e.messageId})),d.length>0&&this._dispatcher.dispatch(new N({messages:d,source:a})),v.length>0&&this._dispatcher.dispatch(new Me({messageIds:v,source:a})),[2,{updatedMessages:d,deletedMessageIds:v,hasMore:f,token:p,forceUseNextToken:m}]}}))}))},n}(),Zs=function(e){function t(t,n){var r=e.call(this,t)||this;r.targetMessageId=0;var i=n.thread_info,s=n.parent_message_id,a=n.channel_url,o=n.channel_type;return i&&h("object",i)&&h("number",s)&&h("string",a)&&h("string",o)&&(r.threadInfo=new xe(t,i),r.targetMessageId=s,r.channelUrl=a,r.channelType=o),r}return r(t,e),t}(c),$s={channelUrl:"",channelType:I.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},ea=function(t){function n(n){var r=n.channelCustomType,s=n.keyword,a=n.limit,o=n.reverse,u=n.exactMatch,l=n.channelUrl,c=n.order,d=n.messageTimestampFrom,h=n.messageTimestampTo,f=n.advancedQuery,p=n.targetFields,m=n.nextToken,v=t.call(this)||this;return v.method=i.GET,v.path="".concat(Ne,"/messages"),v.params=e({custom_type:r,query:s,limit:a,reverse:o,exact_match:u,channel_url:l,message_ts_from:d,message_ts_to:h,sort_field:c,advanced_query:f,target_fields:p,after:m}),v}return r(n,t),n}(a),ta=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.messages=n.results.map((function(e){return mt(t,e)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r.totalCount=n.total_count,r}return r(t,e),t}(o);!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(Us||(Us={}));var na,ra=function(e){function i(t,n){var r,i,s,a,o,u,l,c,d,h=this;return(h=e.call(this,t,n)||this).keyword="",h.reverse=!1,h.exactMatch=!1,h.channelUrl=null,h.channelCustomType=null,h.messageTimestampFrom=null,h.messageTimestampTo=null,h.order=Us.SCORE,h.advancedQuery=!1,h.targetFields=null,h._nextToken="",h.totalCount=-1,h.keyword=n.keyword,h.reverse=null!==(r=n.reverse)&&void 0!==r&&r,h.exactMatch=null!==(i=n.exactMatch)&&void 0!==i&&i,h.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:null,h.channelCustomType=null!==(a=n.channelCustomType)&&void 0!==a?a:null,h.messageTimestampFrom=null!==(o=n.messageTimestampFrom)&&void 0!==o?o:null,h.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,h.order=null!==(l=n.order)&&void 0!==l?l:Us.SCORE,h.advancedQuery=null!==(c=n.advancedQuery)&&void 0!==c&&c,h.targetFields=null!==(d=n.targetFields)&&void 0!==d?d:null,h}return r(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)&&h("string",this.keyword)&&this.keyword.length>0&&h("boolean",this.reverse)&&h("boolean",this.exactMatch)&&h("string",this.channelUrl,!0)&&h("string",this.channelCustomType,!0)&&h("number",this.messageTimestampFrom,!0)&&h("number",this.messageTimestampTo,!0)&&f(Us,this.order)&&h("boolean",this.advancedQuery)&&d("string",this.targetFields,!0)},i.prototype.next=function(){return U(this,void 0,void 0,(function(){var e,r,i,s,a,o,l,c;return A(this,(function(d){switch(d.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid).requestQueue,r=new ea(t(u(u({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=d.sent(),s=i.as(ta),a=s.messages,o=s.hasNext,l=s.nextToken,c=s.totalCount,this._nextToken=l,this._hasNext=o,this._isLoading=!1,this.totalCount=c,[2,a];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},i}(me),ia=function(n){function s(r){var s=r.channelType,a=r.channelUrl,o=r.limit,u=r.token,l=n.call(this)||this;return l.method=i.GET,l.path="".concat(T(s),"/").concat(encodeURIComponent(a),"/messages/parent_thread_message"),l.params=e(t({limit:o,token:u})),l}return r(s,n),s}(a),sa=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.token=n.next,r.messages=n.messages.map((function(e){return mt(t,e)})),r}return r(t,e),t}(o),aa=function(e){function t(t,n,r,i){var s=e.call(this,t,n,r,i)||this;return s._edge="",s}return r(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.load=function(){return U(this,void 0,void 0,(function(){var e,t,r,i,s,a;return A(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=n.of(this._iid).requestQueue,t=new ia({channelType:this.channelType,channelUrl:this.channelUrl,token:this._edge,limit:this.limit}),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=o.sent(),i=r.as(sa),s=i.messages,a=i.token,this._edge=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw O.queryInProgress;case 4:return[3,6];case 5:throw O.invalidParameters;case 6:return[2]}}))}))},t}(Y),oa={channelUrl:"",scheduledMessageId:0};!function(e){e.GOOD="good",e.BAD="bad"}(na||(na={}));var ua,la={reverse:!1,limit:20};!function(e){e.TEXT="text",e.TEXTAREA="textarea",e.NUMBER="number",e.PHONE="phone",e.EMAIL="email",e.CHIP="chip"}(ua||(ua={}));var ca=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="message",t}return r(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,l=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:l}),this._manager=new Xs(t,{sdkState:r,dispatcher:i,requestQueue:a,onlineDetector:u,cacheContext:l})},t.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},t.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},t.prototype.getMessage=function(e){return U(this,void 0,void 0,(function(){var t,n;return A(this,(function(r){switch(r.label){case 0:return t=u(u({},$s),e),x(function(e){return h("string",e.channelUrl)&&f(I,e.channelType)&&h("number",e.messageId)&&h("boolean",e.includeReactions,!0)&&h("boolean",e.includeMetaArray,!0)&&h("boolean",e.includeParentMessageInfo,!0)&&h("boolean",e.includeThreadInfo,!0)}(t)).throw(O.invalidParameters),[4,this._manager.getMessage(t)];case 1:if((n=r.sent())instanceof it||n instanceof ft||null===n)return[2,n];throw"Unknown message type is given."}}))}))},t.prototype.getScheduledMessage=function(e){return U(this,void 0,void 0,(function(){var t;return A(this,(function(n){return t=u(u({},oa),e),x(function(e){return h("string",e.channelUrl)&&""!==e.channelUrl&&h("number",e.scheduledMessageId)&&e.scheduledMessageId>0}(t)).throw(O.invalidParameters),[2,this._manager.getScheduledMessage(t)]}))}))},t.prototype.getMessageTemplatesByToken=function(e,t){return void 0===t&&(t={}),U(this,void 0,void 0,(function(){var n;return A(this,(function(r){return n=u(u({},la),t),x(h("string",e,!0)&&function(e){return h("boolean",e.reverse,!0)&&h("number",e.limit,!0)&&d("string",e.keys,!0)}(n)).throw(O.invalidParameters),[2,this._manager.getMessageTemplatesByToken(e,n)]}))}))},t.prototype.getMessageTemplate=function(e){return U(this,void 0,void 0,(function(){return A(this,(function(t){return x(h("string",e)).throw(O.invalidParameters),[2,this._manager.getMessageTemplate(e)]}))}))},t}(Ce);export{nt as $,gs as A,gi as B,di as C,In as D,ci as E,Ei as F,yn as G,lt as H,ys as I,Bt as J,zt as K,Ms as L,Ts as M,qr as N,pn as O,jt as P,Ot as Q,rn as R,hi as S,Ss as T,fi as U,xr as V,$e as W,et as X,Xs as Y,St as Z,Gs as _,Dr as a,qe as a$,dt as a0,vt as a1,Zs as a2,xe as a3,Kn as a4,kn as a5,tr as a6,$n as a7,Xn as a8,Hn as a9,ks as aA,Ps as aB,Jt as aC,oi as aD,sn as aE,Wt as aF,nn as aG,Xr as aH,Kt as aI,He as aJ,Je as aK,We as aL,br as aM,ui as aN,Re as aO,Pe as aP,ti as aQ,ii as aR,Ks as aS,De as aT,Vr as aU,Bs as aV,Br as aW,rt as aX,ct as aY,Us as aZ,ht as a_,Yn as aa,Rr as ab,it as ac,Ye as ad,st as ae,cr as af,hr as ag,ut as ah,ur as ai,bt as aj,Fr as ak,ft as al,mt as am,on as an,un as ao,ln as ap,cn as aq,ke as ar,Ke as as,Be as at,pt as au,aa as av,Ve as aw,ei as ax,Cs as ay,Os as az,Lr as b,ze as b0,mn as b1,Fe as b2,Oe as b3,Le as b4,je as b5,tt as b6,na as b7,ua as b8,zr as c,Rs as d,xs as e,Qr as f,As as g,Gr as h,Hr as i,Wr as j,jr as k,Kr as l,Ns as m,Yr as n,Jr as o,Es as p,vs as q,bs as r,ca as s,vi as t,ra as u,qs as v,Ls as w,Is as x,ws as y,Ti as z};
