import{c as e,f as t,g as n,d as s,a4 as r,ag as a,C as i,U as o,an as u,bi as c,F as l,t as h,q as d,r as _,_ as p,b as f,w as v,a1 as m,a as g,i as C,az as y,aa as E,bh as b,J as M,A as N,k as A,h as S,j as U,bj as T,aH as I,bk as w,W as D,as as L,bl as x,aq as R,aW as k,V as F,K as P,M as O,z as H,B as G,aG as V,I as B,a0 as q,bm as z,N as W,ab as j,a$ as Q,aE as K,bn as Y,aU as J,b0 as X,a_ as Z,aw as $,aZ as ee,aI as te,b3 as ne,bo as se,D as re,bp as ae,aV as ie,at as oe,ax as ue,bq as ce,u as le,br as he,bs as de,aJ as _e,ar as pe,aN as fe,bt as ve,bu as me,ad as ge,ai as Ce,a7 as ye,b2 as Ee,O as be,T as Me,E as Ne,b7 as Ae}from"./__bundle-ac383d03.js";import{J as Se,a as Ue,V as Te,W as Ie,X as we,Y as De,Z as Le,v as xe,w as Re,_ as ke,$ as Fe,a0 as Pe,a1 as Oe,a2 as He,a3 as Ge,T as Ve,x as Be,a4 as qe,a5 as ze,a6 as We,a7 as je,a8 as Qe,a9 as Ke,aa as Ye,ab as Je,ac as Xe,ad as Ze,ae as $e,af as et,ag as tt,ah as nt,ai as st,aj as rt,ak as at,al as it,am as ot,an as ut,ao as ct,ap as lt,aq as ht,ar as dt,as as _t,at as pt,au as ft,av as vt,aw as mt,ax as gt,ay as Ct,az as yt,aA as Et,aB as bt,aC as Mt,aD as Nt,aE as At,E as St,aF as Ut,aG as Tt,aH as It,aI as wt,aJ as Dt,aK as Lt,aL as xt,aM as Rt,aN as kt,aO as Ft,aP as Pt}from"./__bundle-04b6b263.js";import{G as Ot,g as Ht,D as Gt,c as Vt,F as Bt,e as qt,R as zt,d as Wt,S as jt,U as Qt,a as Kt,b as Yt,A as Jt,P as Xt,f as Zt}from"./__bundle-855fa83f.js";import{C as $t,B as en,U as tn,a as nn,O as sn,P as rn,M as an,T as on,R as un,b as cn,A as ln,c as hn}from"./__bundle-993bdc6e.js";var dn;!function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited",e.LEFT="left"}(dn||(dn={}));var _n,pn,fn,vn,mn,gn,Cn,yn,En=function(i){function o(e,t){var n=i.call(this,e,t)||this;return n.state=null,n.role=null,n.isMuted=!1,n.isBlockedByMe=!1,n.isBlockingMe=!1,n.state=r(dn,t.state)?t.state:null,n.role=r(a,t.role)?t.role:null,"boolean"==typeof t.is_muted&&(n.isMuted=t.is_muted),"boolean"==typeof t.is_blocked_by_me&&(n.isBlockedByMe=t.is_blocked_by_me),"boolean"==typeof t.is_blocking_me&&(n.isBlockingMe=t.is_blocking_me),n}return e(o,i),o.payloadify=function(e){return t(n(s(s({},i.payloadify.call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})))},o}(Se),bn=function(t){function n(e,n){var s,r,a=this;return(a=t.call(this,e)||this).channelUrl=null!==(s=n.channel_url)&&void 0!==s?s:"",a.channelType=null!==(r=n.channel_type)&&void 0!==r?r:i.GROUP,a.member=new o(a._iid,n.user),a.deliveryAt=n.ts,a}return e(n,t),n}(u);!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(_n||(_n={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(pn||(pn={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only",e.EXCLUSIVE_ONLY="exclusive_only"}(fn||(fn={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(vn||(vn={})),function(e){e.ALL="all",e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(mn||(mn={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(gn||(gn={})),function(e){e.AND="AND",e.OR="OR"}(Cn||(Cn={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}(yn||(yn={}));var Mn,Nn=function(){function e(e){var t,n,s,r,a,i,o,u,c,l,h,d,_,p,f,v,m,g,C,y;this._searchFilter=null,this._userIdsFilter=null,this.metadataKey=null,this.metadataValues=null,this.metadataValueStartsWith=null,this.includeEmpty=null!==(t=null==e?void 0:e.includeEmpty)&&void 0!==t&&t,this.nicknameContainsFilter=null!==(n=null==e?void 0:e.nicknameContainsFilter)&&void 0!==n?n:null,this.nicknameStartsWithFilter=null!==(s=null==e?void 0:e.nicknameStartsWithFilter)&&void 0!==s?s:null,this.nicknameExactMatchFilter=null!==(r=null==e?void 0:e.nicknameExactMatchFilter)&&void 0!==r?r:null,this.channelNameContainsFilter=null!==(a=null==e?void 0:e.channelNameContainsFilter)&&void 0!==a?a:"",this.myMemberStateFilter=null!==(i=null==e?void 0:e.myMemberStateFilter)&&void 0!==i?i:pn.ALL,this.customTypesFilter=null!==(o=null==e?void 0:e.customTypesFilter)&&void 0!==o?o:null,this.channelUrlsFilter=null!==(u=null==e?void 0:e.channelUrlsFilter)&&void 0!==u?u:null,this.superChannelFilter=null!==(c=null==e?void 0:e.superChannelFilter)&&void 0!==c?c:fn.ALL,this.publicChannelFilter=null!==(l=null==e?void 0:e.publicChannelFilter)&&void 0!==l?l:_n.ALL,this.customTypeStartsWithFilter=null!==(h=null==e?void 0:e.customTypeStartsWithFilter)&&void 0!==h?h:null,this.unreadChannelFilter=null!==(d=null==e?void 0:e.unreadChannelFilter)&&void 0!==d?d:vn.ALL,this.hiddenChannelFilter=null!==(_=null==e?void 0:e.hiddenChannelFilter)&&void 0!==_?_:mn.UNHIDDEN,this.includeFrozen=null===(p=null==e?void 0:e.includeFrozen)||void 0===p||p,this.metadataKey=null!==(f=null==e?void 0:e.metadataKey)&&void 0!==f?f:null,this.metadataValues=null!==(v=null==e?void 0:e.metadataValues)&&void 0!==v?v:null,this.metadataValueStartsWith=null!==(m=null==e?void 0:e.metadataValueStartsWith)&&void 0!==m?m:null,this._userIdsFilter=null!==(g=null==e?void 0:e.userIdsFilter)&&void 0!==g?g:null,this._searchFilter=null!==(C=null==e?void 0:e.searchFilter)&&void 0!==C?C:null,(null==e?void 0:e.createdAfter)&&(this.createdAfter=e.createdAfter),(null==e?void 0:e.createdBefore)&&(this.createdBefore=e.createdBefore),this.includeMetaData=null===(y=null==e?void 0:e.includeMetaData)||void 0===y||y}return e.prototype._isFriend=function(e){return!(!e||!e.friendDiscoveryKey&&!e.friendName)},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=Cn.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t,n=new e;this.searchFilter&&n.setSearchFilter(this.searchFilter.fields,null!==(t=this.searchFilter.query)&&void 0!==t?t:void 0),this.userIdsFilter&&n.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var s=JSON.parse(JSON.stringify(this));return Object.keys(s).forEach((function(e){n[e]=s[e]})),n},e.prototype.match=function(e,t){var n;if(this._searchFilter){var s=this._searchFilter,r=s.query,a=s.fields;if(r&&a&&a.length>0&&!a.some((function(t){switch(t){case yn.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case yn.MEMBER_NICKNAME:return e.members.some((function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var i=this._userIdsFilter,o=i.userIds,u=i.includeMode,l=i.queryType,h=e.members.map((function(e){return e.userId}));if(u){if(o.length>0)switch(l){case Cn.AND:if(o.some((function(e){return!h.includes(e)})))return!1;break;case Cn.OR:if(o.every((function(e){return!h.includes(e)})))return!1}}else{if(o.includes(t)||o.push(t),e.members.length>o.length)return!1;if(!c(o,h))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var d=this.nicknameContainsFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().includes(d)})))return!1}if(this.nicknameStartsWithFilter){var _=this.nicknameStartsWithFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().startsWith(_)})))return!1}if(this.nicknameExactMatchFilter){var p=this.nicknameExactMatchFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase()!=p})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case pn.ALL:if("none"===e.myMemberState)return!1;break;case pn.JOINED:if("joined"!==e.myMemberState)return!1;break;case pn.INVITED:if("invited"!==e.myMemberState)return!1;break;case pn.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case pn.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case mn.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case mn.HIDDEN:if(!e.isHidden)return!1;break;case mn.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case mn.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===vn.UNREAD_MESSAGE)if(0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case _n.PUBLIC:if(!e.isPublic)return!1;break;case _n.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case fn.SUPER:if(!e.isSuper)return!1;break;case fn.NON_SUPER:if(e.isSuper)return!1}if(this.includeMetaData&&this.metadataKey){if(void 0===(null===(n=e.cachedMetaData)||void 0===n?void 0:n[this.metadataKey]))return!1;if(this.metadataValues&&!this.metadataValues.includes(e.cachedMetaData[this.metadataKey]))return!1;if(this.metadataValueStartsWith&&!e.cachedMetaData[this.metadataKey].startsWith(this.metadataValueStartsWith))return!1}return!(this.createdAfter&&e.createdAt<this.createdAfter)&&!(this.createdBefore&&e.createdAt>this.createdBefore)},e}(),An=function(t){function n(e,n){var s=n.sdkState,r=n.cacheContext,a=t.call(this,e)||this;return a._channels=new Map,a._sdkState=s,a._cacheContext=r,a}return e(n,t),Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return l(!!e).throw(h.databaseError),e.collection(Ue)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e,t){return void 0===t&&(t=0),s(s({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},n.prototype._deserialize=function(e){return Os.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(n.prototype,"channels",{get:function(){return d([],_(this._channels.values()),!1)},enumerable:!1,configurable:!0}),n.prototype.isCachedInMemory=function(e){return this._channels.has(e)},n.prototype.filterOffsetChanged=function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))},n.prototype.get=function(e){return p(this,void 0,void 0,(function(){var t,n;return f(this,(function(s){switch(s.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=s.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];s.label=2;case 2:return[2,void 0];case 3:return[2,this._channels.get(e)]}}))}))},n.prototype.fetch=function(e){var t=e.token,n=e.offset,s=void 0===n?0:n,r=e.limit,a=void 0===r?Te:r,i=e.backward,o=void 0!==i&&i,u=e.filter,c=void 0===u?new Nn:u,l=e.order,h=void 0===l?Ot.LATEST_LAST_MESSAGE:l,d=e.borderlineChannelUrl;return p(this,void 0,void 0,(function(){var e,n,r,i,u,l=this;return f(this,(function(_){switch(_.label){case 0:return this.localCacheEnabled?(e=!!d,n=Ht(h),r={where:function(n){if(s>0)return s--,!1;if(t)switch(h){case Ot.CHANNEL_NAME_ALPHABETICAL:if(!o&&n.name.localeCompare(t)<0||o&&n.name.localeCompare(t)>0)return!1;break;case Ot.CHRONOLOGICAL:if(!o&&n.createdAt>t||o&&n.createdAt<t)return!1;break;case Ot.LATEST_LAST_MESSAGE:if(!o&&n.lastMessageUpdatedAt>t||o&&n.lastMessageUpdatedAt<t)return!1}return e&&d&&d===n.url?(e=!1,!1):!e&&c.match(l._deserialize(n),l._sdkState.userId)},index:n,backward:o},[4,this.collection.query(r)]):[3,3];case 1:return[4,_.sent().fetch({limit:a})];case 2:return i=_.sent(),(u=i.map((function(e){return l._deserialize(e)}))).forEach((function(e){!c.includeMetaData&&e.cachedMetaData&&e._clearCachedMetaData(),l._channels.has(e.url)||l._channels.set(e.url,e)})),[2,u];case 3:return[2,[]]}}))}))},n.prototype.upsert=function(e,t){return p(this,void 0,void 0,(function(){var n,s,r,a=this;return f(this,(function(i){switch(i.label){case 0:if(n=[],e.forEach((function(e){if(a._channels.has(e.url)){var s=a._channels.get(e.url);if(s._pinnedMessagesUpdatedAt<e._pinnedMessagesUpdatedAt&&(s._pinnedMessagesUpdatedAt=e._pinnedMessagesUpdatedAt),s._messageCollectionLastAccessedAt>e._messageCollectionLastAccessedAt&&(e._messageCollectionLastAccessedAt=s._messageCollectionLastAccessedAt),e.cachedMetaData instanceof Map&&e.cachedMetaData.size>0&&t)s._updateCachedMetaData(e.cachedMetaData,t).isUpdated||Object.assign(e,{_cachedMetaData:s.cachedMetaData});s._update(e),n.push(s)}else a._channels.set(e.url,e),n.push(e)})),!this.localCacheEnabled)return[3,2];for(s=[],r=0;r<n.length;r++)s.push(this._serialize(n[r],r));return[4,this.collection.upsertMany(s)];case 1:i.sent(),i.label=2;case 2:return[2,n]}}))}))},n.prototype.remove=function(e){return p(this,void 0,void 0,(function(){var t,n,s,r,a;return f(this,(function(i){switch(i.label){case 0:try{for(t=v(e),n=t.next();!n.done;n=t.next())s=n.value,this._channels.delete(s)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(r)throw r.error}}return this.localCacheEnabled?[4,this.collection.removeIf({where:{url:{"/in":e}}})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.clearMemoryCache=function(){this._channels.clear()},n.prototype._setBlockStateOfAllChannels=function(e,t,n){return p(this,void 0,void 0,(function(){var s,r,a,i,o,u,c,l,h,d,_,p,m,g,C,y,E,b,M;return f(this,(function(f){switch(f.label){case 0:if(s=[],e===this._sdkState.userId)try{for(r=v(this._channels.values()),a=r.next();!a.done;a=r.next()){l=a.value;try{for(g=void 0,i=v(l.members),o=i.next();!o.done;o=i.next())if((_=o.value).userId===t){_.isBlockedByMe=n,s.push(l);break}}catch(e){g={error:e}}finally{try{o&&!o.done&&(C=i.return)&&C.call(i)}finally{if(g)throw g.error}}}}catch(e){p={error:e}}finally{try{a&&!a.done&&(m=r.return)&&m.call(r)}finally{if(p)throw p.error}}else if(t===this._sdkState.userId)try{for(u=v(this._channels.values()),c=u.next();!c.done;c=u.next()){l=c.value;try{for(b=void 0,h=v(l.members),d=h.next();!d.done;d=h.next())if((_=d.value).userId===e){_.isBlockingMe=n,s.push(l);break}}catch(e){b={error:e}}finally{try{d&&!d.done&&(M=h.return)&&M.call(h)}finally{if(b)throw b.error}}}}catch(e){y={error:e}}finally{try{c&&!c.done&&(E=u.return)&&E.call(u)}finally{if(y)throw y.error}}return s.length>0?[4,this.upsert(s)]:[3,2];case 1:f.sent(),f.label=2;case 2:return[2]}}))}))},n.prototype.block=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},n.prototype.unblock=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},n.prototype.markAsRead=function(e,t){return void 0===t&&(t=d([],_(this._channels.keys()),!1)),p(this,void 0,void 0,(function(){var n,s,r,a,i,o,u,c;return f(this,(function(l){switch(l.label){case 0:n=[],l.label=1;case 1:l.trys.push([1,6,7,8]),s=v(t),r=s.next(),l.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,this.get(a)]);case 3:(null==(i=l.sent())?void 0:i._updateUnreadMemberState(this._sdkState.userId,e))&&(i._updateUnreadCount(0,0),n.push(i)),l.label=4;case 4:return r=s.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),u={error:o},[3,8];case 7:try{r&&!r.done&&(c=s.return)&&c.call(s)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:l.sent(),l.label=10;case 10:return[2]}}))}))},n}(u),Sn={invitedUserIds:void 0,channelUrl:void 0,coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isSuper:void 0,isBroadcast:void 0,isExclusive:void 0,isPublic:void 0,isDiscoverable:void 0,isStrict:void 0,isEphemeral:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},Un=function(e){return m("string",e.invitedUserIds,!0)&&g("string",e.channelUrl,!0)&&g("string",e.coverUrl,!0)&&(C(e.coverImage)||g("string",e.coverImage,!0))&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isSuper,!0)&&g("boolean",e.isBroadcast,!0)&&g("boolean",e.isExclusive,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isStrict,!0)&&g("boolean",e.isDiscoverable,!0)&&g("boolean",e.isEphemeral,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&m("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)},Tn={customTypes:void 0,includeEmpty:!1,includeFrozen:!0,includeMetaData:!0,includeChatNotification:!1},In=function(e){return m("string",e.customTypes,!0)&&g("boolean",e.includeEmpty,!0)&&g("boolean",e.includeFrozen,!0)&&g("boolean",e.includeMetaData,!0)&&g("boolean",e.includeChatNotification,!0)},wn={myMemberStateFilter:pn.ALL},Dn=function(e){return r(pn,e.myMemberStateFilter)};!function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}(Mn||(Mn={}));var Ln={keys:[Mn.GROUP_CHANNEL_UNREAD_MENTION_COUNT,Mn.NONSUPER_UNREAD_MENTION_COUNT,Mn.SUPER_UNREAD_MENTION_COUNT,Mn.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT,Mn.NONSUPER_UNREAD_MESSAGE_COUNT,Mn.SUPER_UNREAD_MESSAGE_COUNT,Mn.GROUP_CHANNEL_INVITATION_COUNT,Mn.NONSUPER_INVITATION_COUNT,Mn.SUPER_INVITATION_COUNT],customTypeFilters:void 0,customTypesFilter:void 0},xn={channelCustomTypesFilter:void 0,superChannelFilter:fn.ALL},Rn=function(e){return m("string",e.channelCustomTypesFilter,!0)&&r(fn,e.superChannelFilter)},kn={channelUrl:void 0,scheduledStatus:void 0,messageTypeFilter:y.ALL},Fn=s({},E),Pn=function(e){return e.startsWith("EVENT_")||e===E.SYNC_CHANNEL_CHANGELOGS||e===E.REFRESH_CHANNEL},On=function(t){function n(e){var n=e.channels,s=e.context,r=e.isWebSocketEventComing,a=void 0!==r&&r,i=e.ts,o=t.call(this)||this;return o.channels=n,o.context=s,o.isWebSocketEventComing=a,o.ts=i,o}return e(n,t),n}(b),Hn=function(t){function n(e){var n=e.channelUrls,s=e.context,r=e.isWebSocketEventComing,a=void 0!==r&&r,i=t.call(this)||this;return i.channelUrls=n,i.context=s,i.isWebSocketEventComing=a,i}return e(n,t),n}(b),Gn=function(t){function n(e){var n=e.channel,s=t.call(this)||this;return s.channel=n,s}return e(n,t),n}(b),Vn=function(){function e(e){var t=e.groupChannelCache,n=e.userInfoCache,s=e.messageCache,r=e.unsentMessageCache,a=e.dispatcher,i=this;this._observers=new Map,a.on((function(e){return p(i,void 0,void 0,(function(){var a,i,o,u,c,l,h,d,_,m,g,C,y,b,N,A,S,U,T=this;return f(this,(function(I){switch(I.label){case 0:if(!(e instanceof On))return[3,19];if(a=e.channels,y=e.context,b=e.isWebSocketEventComing,i=a.filter((function(e){return e instanceof Jr})),y.source!==E.EVENT_CHANNEL_RESET_HISTORY&&y.source!==E.EVENT_CHANNEL_HIDDEN)return[3,9];I.label=1;case 1:I.trys.push([1,6,7,8]),o=v(i),u=o.next(),I.label=2;case 2:return u.done?[3,5]:(_=u.value,[4,s.removeUnderOffset(_.url,_.messageOffsetTimestamp)]);case 3:I.sent(),I.label=4;case 4:return u=o.next(),[3,2];case 5:return[3,8];case 6:return c=I.sent(),N={error:c},[3,8];case 7:try{u&&!u.done&&(A=o.return)&&A.call(o)}finally{if(N)throw N.error}return[7];case 8:return[3,17];case 9:l=t.filterOffsetChanged(i),I.label=10;case 10:I.trys.push([10,15,16,17]),h=v(l),d=h.next(),I.label=11;case 11:return d.done?[3,14]:(_=d.value,[4,s.removeUnderOffset(_.url,_.messageOffsetTimestamp)]);case 12:I.sent(),I.label=13;case 13:return d=h.next(),[3,11];case 14:return[3,17];case 15:return m=I.sent(),S={error:m},[3,17];case 16:try{d&&!d.done&&(U=h.return)&&U.call(h)}finally{if(S)throw S.error}return[7];case 17:return[4,t.upsert(i,e.ts)];case 18:return g=I.sent(),b||this._broadcastUpdateEvent(g,y),[3,25];case 19:return e instanceof Hn?(C=e.channelUrls,y=e.context,b=e.isWebSocketEventComing,[4,t.remove(C)]):[3,22];case 20:return I.sent(),[4,M((function(){return p(T,void 0,void 0,(function(){var e,t,n,a,i,o;return f(this,(function(u){switch(u.label){case 0:u.trys.push([0,6,7,8]),e=v(C),t=e.next(),u.label=1;case 1:return t.done?[3,5]:(n=t.value,[4,s.removeMessagesOfChannel(n)]);case 2:return u.sent(),[4,r.removeMessagesOfChannel(n)];case 3:u.sent(),u.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return a=u.sent(),i={error:a},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))}))];case 21:return I.sent(),b||this._broadcastRemoveEvent(C,y),[3,25];case 22:return e instanceof Gt?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,25];case 23:return I.sent(),[4,n.fetch({limit:Number.MAX_SAFE_INTEGER})];case 24:I.sent(),I.label=25;case 25:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,s;try{for(var r=v(this._observers.values()),a=r.next();!a.done;a=r.next()){var i=a.value;i.onUpdate&&i.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,s;try{for(var r=v(this._observers.values()),a=r.next();!a.done;a=r.next()){var i=a.value;i.onRemove&&i.onRemove(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e.prototype.unsubscribeAll=function(){this._observers.clear()},e}(),Bn=function(r){function a(e){var a=e.userId,i=e.ts,o=e.token,u=e.filter,c=e.includeChatNotification,l=void 0!==c&&c,h=r.call(this)||this,d=s(s({},Tn),u),_=d.customTypes,p=d.includeEmpty,f=d.includeFrozen;return h.method=N.GET,h.path="".concat(A,"/").concat(encodeURIComponent(a),"/my_group_channels/changelogs"),h.params=t(n({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:i||null,token:o,custom_types:_,show_empty:p,show_frozen:f,include_chat_notification:l})),h}return e(a,r),a}(S),qn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.updatedChannels=n.updated.map((function(t){return new Jr(e,Object.assign(t,{ts:n.ts}))})),s.deletedChannelUrls=n.deleted,s.hasMore=n.has_more,s.token=n.next,s.ts=n.ts,s}return e(n,t),n}(U),zn=function(t){function n(e){var n=e.channelUrl,s=e.isInternalCall,r=e.showLatestMessage,a=t.call(this)||this;return a.method=N.GET,a.path="".concat(s?T:I,"/").concat(encodeURIComponent(n)),a.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_latest_message:null!=r&&r,show_conversation:!0},a}return e(n,t),n}(S),Wn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new Jr(e,n),s}return e(n,t),n}(U),jn={includeEmpty:!1,includeFrozen:!0,includeMetaData:!0,includeChatNotification:!1,channelUrlsFilter:void 0,customTypesFilter:void 0,customTypeStartsWithFilter:void 0,nicknameContainsFilter:void 0,nicknameStartsWithFilter:void 0,nicknameExactMatchFilter:void 0,channelNameContainsFilter:void 0,myMemberStateFilter:pn.ALL,unreadChannelFilter:vn.ALL,superChannelFilter:fn.ALL,publicChannelFilter:_n.ALL,hiddenChannelFilter:mn.ALL,userIdsFilter:{userIds:[],includeMode:!0,queryType:Cn.AND},searchFilter:{query:void 0,fields:[]},metadataKey:void 0,metadataValues:void 0,metadataOrderKeyFilter:void 0,metadataValueStartsWith:void 0,order:Ot.LATEST_LAST_MESSAGE,createdAfter:void 0,createdBefore:void 0},Qn=function(n){function s(e){var s=this,r=e.userId,a=e.token,i=e.limit,o=e.order,u=e.includeEmpty,c=e.myMemberStateFilter,l=e.superChannelFilter,h=e.publicChannelFilter,d=e.unreadChannelFilter,_=e.nicknameContainsFilter,p=e.nicknameStartsWithFilter,f=e.nicknameExactMatchFilter,v=e.channelNameContainsFilter,m=e.channelUrlsFilter,g=e.customTypesFilter,C=e.customTypeStartsWithFilter,y=e.hiddenChannelFilter,E=e.metadataOrderKeyFilter,b=e.metadataKey,M=e.metadataValues,S=e.metadataValueStartsWith,U=e.includeFrozen,T=e.includeMetaData,I=e.searchFilter,w=e.userIdsFilter,D=e.includeChatNotification,L=void 0!==D&&D,x=e.includeLeftChannel,R=void 0!==x&&x,k=e.createdAfter,F=e.createdBefore;return(s=n.call(this)||this).method=N.GET,s.path="".concat(A,"/").concat(encodeURIComponent(r),"/my_group_channels"),s.params=t({token:a,limit:i,order:null!=o?o:jn.order,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:null!=u?u:jn.includeEmpty,member_state_filter:null!=c?c:jn.myMemberStateFilter,super_mode:null!=l?l:jn.superChannelFilter,public_mode:null!=h?h:jn.publicChannelFilter,unread_filter:null!=d?d:jn.unreadChannelFilter,members_nickname_contains:_,members_nickname_startswith:p,members_nickname:f,name_contains:v,channel_urls:m,custom_types:g,custom_type_startswith:C,hidden_mode:y,metadata_order_key:E,metadata_key:b,metadata_values:M,metadata_value_startswith:S,show_frozen:U,show_metadata:T,include_chat_notification:L,include_left_channel:R,created_after:k,created_before:F}),I&&I.query&&I.fields&&(s.params.search_query=I.query,s.params.search_fields=I.fields),w&&w.userIds&&w.userIds.length>0&&(w.includeMode?(s.params.members_include_in=w.userIds,s.params.query_type=w.queryType.toUpperCase()):s.params.members_exactly_in=w.userIds),s}return e(s,n),s}(S),Kn=function(t){function n(e,n){var s=t.call(this,e,n)||this;s.channels=[];var r=n.next,a=n.channels,i=n.ts;return s.token=r,a&&a.length>0&&(s.channels=a.map((function(t){return t.ts=i,new Jr(e,t)}))),s.ts=null!=i?i:0,s}return e(n,t),n}(U),Yn=function(t){function n(e){var n=e.userId,s=e.filter,r=t.call(this)||this,a=s.myMemberStateFilter;return r.method=N.GET,r.path="".concat(A,"/").concat(encodeURIComponent(n),"/group_channel_count"),r.params={state:null!=a?a:pn.ALL},r}return e(n,t),n}(S),Jn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.groupChannelCount=n.group_channel_count,s}return e(n,t),n}(U),Xn=function(n){function s(e){var s=e.userId,r=e.filter,a=n.call(this)||this,i=r.keys,o=r.customTypeFilters,u=r.customTypesFilter;return a.method=N.GET,a.path="".concat(A,"/").concat(encodeURIComponent(s),"/unread_item_count"),a.params=t({item_keys:i,custom_types:null!=u?u:o}),a}return e(s,n),s}(S),Zn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return"number"==typeof n[Mn.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(s.groupChannelUnreadMentionCount=n[Mn.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[Mn.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(s.groupChannelUnreadMessageCount=n[Mn.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Mn.GROUP_CHANNEL_INVITATION_COUNT]&&(s.groupChannelInvitationCount=n[Mn.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[Mn.SUPER_UNREAD_MENTION_COUNT]&&(s.superGroupChannelUnreadMentionCount=n[Mn.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[Mn.SUPER_UNREAD_MESSAGE_COUNT]&&(s.superGroupChannelUnreadMessageCount=n[Mn.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Mn.SUPER_INVITATION_COUNT]&&(s.superGroupChannelInvitationCount=n[Mn.SUPER_INVITATION_COUNT]),"number"==typeof n[Mn.NONSUPER_UNREAD_MENTION_COUNT]&&(s.nonSuperGroupChannelUnreadMentionCount=n[Mn.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[Mn.NONSUPER_UNREAD_MESSAGE_COUNT]&&(s.nonSuperGroupChannelUnreadMessageCount=n[Mn.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Mn.NONSUPER_INVITATION_COUNT]&&(s.nonSuperGroupChannelInvitationCount=n[Mn.NONSUPER_INVITATION_COUNT]),s}return e(n,t),n}(U),$n=function(t){function n(e){var n=e.userId,s=t.call(this)||this;return s.method=N.GET,s.path="".concat(A,"/").concat(encodeURIComponent(n),"/unread_channel_count"),s}return e(n,t),n}(S),es=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.unreadCount=n.unread_count,s}return e(n,t),n}(U),ts=function(t){function n(e){var n=e.userId,s=e.filter,r=e.includeFeedChannel,a=void 0!==r&&r,i=t.call(this)||this,o=s.channelCustomTypesFilter,u=s.superChannelFilter;return i.method=N.GET,i.path="".concat(A,"/").concat(encodeURIComponent(n),"/unread_message_count"),i.params={super_mode:null!=u?u:fn.ALL,custom_types:o,include_feed_channel:a},i}return e(n,t),n}(S),ns=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.unreadCount=n.unread_count,s.unreadFeedCount=n.unread_feed_count,s}return e(n,t),n}(U),ss=function(t){function n(e){var n=e.channelUrl,s=e.scheduledStatus,r=e.messageTypeFilter,a=t.call(this)||this;return a.method=N.GET,a.path="".concat(w,"/count"),a.params={channel_url:n,status:as(s)},r&&(a.params.message_type=r),a}return e(n,t),n}(S),rs=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.count=n.count,s}return e(n,t),n}(U),as=function(e){if(!e)return[];var t=[];return e.forEach((function(e){switch(e){case Ie.PENDING:t.push(we.PENDING);break;case Ie.SENT:t.push(we.IN_QUEUE),t.push(we.SENT);break;case Ie.CANCELED:t.push(we.CANCELED);break;case Ie.FAILED:t.push(we.FAILED)}})),t},is=function(n){function s(e){var s=this,r=e.userId,a=e.channelUrl,i=e.coverUrl,o=e.coverImage,u=e.isDistinct,c=e.isSuper,l=e.isBroadcast,h=e.isPublic,p=e.isExclusive,f=e.isDiscoverable,v=e.isStrict,m=e.isEphemeral,g=e.accessCode,C=e.name,y=e.data,E=e.customType,b=e.messageSurvivalSeconds,M=e.invitedUserIds,A=e.operatorUserIds;return(s=n.call(this)||this).method=N.POST,s.path=I,s.params=t({user_ids:d([r],_(null!=M?M:[]),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:a,cover_url:i,cover_file:o,is_distinct:u,is_super:c,is_broadcast:l,is_exclusive:p,is_public:h,is_discoverable:f,strict:v,is_ephemeral:m,access_code:g,name:C,data:y,custom_type:E,operator_ids:A,message_survival_seconds:b}),s}return e(s,n),s}(S),os=function(t){function n(e,n){var s,r=this;return(r=t.call(this,e,n)||this).channel=new Jr(e,n),r.isCreated=null===(s=n.is_created)||void 0===s||s,r}return e(n,t),n}(U),us=function(t){function n(e){var n=e.userId,s=e.channelUrls,r=t.call(this)||this;return r.method=N.PUT,r.path="".concat(A,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),r.params={channel_urls:s},r}return e(n,t),n}(S);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(U);var cs=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,a=e.accessCode;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/join"),n.params={user_id:r,access_code:a},n}return e(n,t),n}(S),ls=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new Jr(e,n),s}return e(n,t),n}(U),hs=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this,a=s.data,i=a.member_count,o=void 0===i?0:i,u=a.joined_member_count,c=void 0===u?0:u,l=a.users,h=void 0===l?null:l;return r.memberCount=o,r.joinedMemberCount=c,r.members=Array.isArray(h)?h.map((function(t){return new En(e,t)})):[new En(e,s.data)],r}return e(n,t),n}($t),ds=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,a=e.shouldRemoveOperatorStatus;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/leave"),n.params={user_id:r,should_remove_operator_status:a},n}return e(n,t),n}(S);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(U);var _s=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this,a=s.data,i=a.member_count,o=void 0===i?0:i,u=a.joined_member_count,c=void 0===u?0:u;return r.memberCount=o,r.joinedMemberCount=c,r.member=new En(r._iid,s.data),r}return e(n,t),n}($t),ps=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userIds;return(n=t.call(this)||this).method=N.POST,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/invite"),n.params={user_ids:r},n}return e(n,t),n}(S),fs=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new Jr(e,n),s}return e(n,t),n}(U),vs=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this;r.inviter=null;var a=s.data,i=a.member_count,u=void 0===i?0:i,c=a.joined_member_count,l=void 0===c?0:c,h=a.inviter,d=a.invitees,_=void 0===d?[]:d;return r.memberCount=u,r.joinedMemberCount=l,h&&Object.keys(h).length>0&&(r.inviter=new o(e,h)),r.invitees=_.map((function(t){return new En(e,t)})),r}return e(n,t),n}($t),ms=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/decline"),n.params={user_id:r},n}return e(n,t),n}(S);!function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new Jr(e,n),s.channel.myMemberState=dn.NONE,s}e(n,t)}(U);var gs=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this,a=s.data,i=a.member_count,u=a.joined_member_count,c=a.inviter,l=a.invitee;return r.memberCount=null!=i?i:0,r.joinedMemberCount=null!=u?u:0,r.inviter=new o(e,c),r.invitee=new En(e,l),r}return e(n,t),n}($t),Cs={hidePreviousMessages:!1,allowAutoUnhide:!0},ys=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,a=e.hidePreviousMessages,i=e.allowAutoUnhide;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/hide"),n.params={user_id:r,hide_previous_messages:null!=a?a:Cs.hidePreviousMessages,allow_auto_unhide:null!=i?i:Cs.allowAutoUnhide},n}return e(n,t),n}(S),Es=function(t){function n(e,n){var s=t.call(this,e,n)||this,r=n.ts_message_offset;return s.messageOffsetTimestamp=r,s}return e(n,t),n}(U),bs=function(t){function n(e,n,s){var r,a,i,o=this;return(o=t.call(this,e,"SYEV",s)||this).allowAutoUnhide=null,o.hidePreviousMessages=null,o.messageOffsetTimestamp=null,s.data&&(o.allowAutoUnhide=null!==(r=s.data.allow_auto_unhide)&&void 0!==r?r:null,o.hidePreviousMessages=null!==(a=s.data.hide_previous_messages)&&void 0!==a?a:null),o.messageOffsetTimestamp=null!==(i=s.ts_message_offset)&&void 0!==i?i:null,o}return e(n,t),n}(D),Ms=function(t){function n(e){var n=e.channelUrl,s=e.time;return t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:s}})||this}return e(n,t),n}(L),Ns=function(t){function n(e,n,s){var r=t.call(this,e,"SYEV",s)||this;return r.user=new o(e,s.data),r}return e(n,t),n}(D),As=function(t){function n(e){var n=e.channelUrl,s=e.time;return t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:s}})||this}return e(n,t),n}(L),Ss=function(t){function n(e,n,s){var r=t.call(this,e,"SYEV",s)||this;return r.user=new o(e,s.data),r}return e(n,t),n}(D),Us=function(t){function n(e){var n=e.channelUrl,s=e.messageId;return t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:s}})||this}return e(n,t),n}(L),Ts=function(t){function a(e,n){var s,r,a,i,o,u,c,l,h,d,_,p,f,v,m,g,C,y,E,b,M,N,A,S=this;return(S=t.call(this,e,n)||this).includeEmpty=!1,S.includeFrozen=!0,S.includeMetaData=!0,S.includeChatNotification=!1,S.channelUrlsFilter=null,S.customTypesFilter=null,S.customTypeStartsWithFilter=null,S.nicknameContainsFilter=null,S.nicknameStartsWithFilter=null,S.nicknameExactMatchFilter=null,S.channelNameContainsFilter="",S.myMemberStateFilter=pn.ALL,S.unreadChannelFilter=vn.ALL,S.superChannelFilter=fn.ALL,S.publicChannelFilter=_n.ALL,S.hiddenChannelFilter=mn.UNHIDDEN,S.searchFilter={fields:[],query:null},S.userIdsFilter={userIds:[],includeMode:!0,queryType:Cn.AND},S.metadataKey=null,S.metadataValues=null,S.metadataOrderKeyFilter=null,S.metadataValueStartsWith=null,S.order=Ot.LATEST_LAST_MESSAGE,S.includeEmpty=null!==(s=n.includeEmpty)&&void 0!==s&&s,S.includeFrozen=null===(r=n.includeFrozen)||void 0===r||r,S.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,S.includeChatNotification=null!==(i=n.includeChatNotification)&&void 0!==i&&i,S.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,S.customTypesFilter=null!==(u=n.customTypesFilter)&&void 0!==u?u:null,S.customTypeStartsWithFilter=null!==(c=n.customTypeStartsWithFilter)&&void 0!==c?c:"",S.nicknameContainsFilter=null!==(l=n.nicknameContainsFilter)&&void 0!==l?l:null,S.nicknameStartsWithFilter=null!==(h=n.nicknameStartsWithFilter)&&void 0!==h?h:null,S.nicknameExactMatchFilter=null!==(d=n.nicknameExactMatchFilter)&&void 0!==d?d:null,S.channelNameContainsFilter=null!==(_=n.channelNameContainsFilter)&&void 0!==_?_:"",S.myMemberStateFilter=null!==(p=n.myMemberStateFilter)&&void 0!==p?p:pn.ALL,S.unreadChannelFilter=null!==(f=n.unreadChannelFilter)&&void 0!==f?f:vn.ALL,S.superChannelFilter=null!==(v=n.superChannelFilter)&&void 0!==v?v:fn.ALL,S.publicChannelFilter=null!==(m=n.publicChannelFilter)&&void 0!==m?m:_n.ALL,S.hiddenChannelFilter=null!==(g=n.hiddenChannelFilter)&&void 0!==g?g:mn.UNHIDDEN,S.searchFilter=null!==(C=n.searchFilter)&&void 0!==C?C:{fields:[],query:null},S.userIdsFilter=null!==(y=n.userIdsFilter)&&void 0!==y?y:{userIds:[],includeMode:!0,queryType:Cn.AND},S.metadataKey=null!==(E=n.metadataKey)&&void 0!==E?E:null,S.metadataValues=null!==(b=n.metadataValues)&&void 0!==b?b:null,S.metadataOrderKeyFilter=null!==(M=n.metadataOrderKeyFilter)&&void 0!==M?M:null,S.metadataValueStartsWith=null!==(N=n.metadataValueStartsWith)&&void 0!==N?N:null,S.order=null!==(A=n.order)&&void 0!==A?A:Ot.LATEST_LAST_MESSAGE,n.createdAfter&&(S.createdAfter=n.createdAfter),n.createdBefore&&(S.createdBefore=n.createdBefore),S}return e(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&g("boolean",this.includeEmpty)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.channelNameContainsFilter)&&m("string",this.channelUrlsFilter,!0)&&m("string",this.customTypesFilter,!0)&&g("string",this.customTypeStartsWithFilter)&&g("string",this.nicknameContainsFilter,!0)&&g("string",this.nicknameStartsWithFilter,!0)&&g("string",this.nicknameExactMatchFilter,!0)&&r(pn,this.myMemberStateFilter)&&r(fn,this.superChannelFilter)&&r(_n,this.publicChannelFilter)&&r(vn,this.unreadChannelFilter)&&r(mn,this.hiddenChannelFilter)&&m(yn,this.searchFilter.fields)&&g("string",this.searchFilter.query,!0)&&m("string",this.userIdsFilter.userIds)&&g("boolean",this.userIdsFilter.includeMode)&&r(Cn,this.userIdsFilter.queryType)&&r(Ot,this.order)&&g("string",this.metadataOrderKeyFilter,!0)&&g("string",this.metadataKey,!0)&&m("string",this.metadataValues,!0)&&g("string",this.metadataValueStartsWith,!0)&&x(this.createdAfter,!0)&&x(this.createdBefore,!0)},a.prototype.serialize=function(){return R(this)},a.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,r;return f(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Os.of(this._iid).getMyGroupChannels(this._token,n(s({},this)),this.limit,E.REQUEST_CHANNEL,!0)]):[3,2]:[3,5];case 1:return e=a.sent(),t=e.channels,r=e.token,this._token=r,this._hasNext=!!r,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw h.queryInProgress;case 4:return[3,6];case 5:throw h.invalidParameters;case 6:return[2]}}))}))},a}(k),Is=function(n){function s(e){var s=e.channelUrl,r=e.userId,a=n.call(this)||this;return a.method=N.PUT,a.path="".concat(I,"/").concat(encodeURIComponent(s),"/messages/mark_as_delivered"),a.params=t({user_id:r}),a}return e(s,n),s}(S);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(U);var ws,Ds=function(t){function n(e,n,s){var r=t.call(this,e,"DLVR",s)||this;return r.channelUrl=s.channel_url,r.deliveredStateUpdate=s.updated,r}return e(n,t),n}(D),Ls=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,s=e.bottom,r=void 0===s?0:s;this.top=n,this.bottom=r}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.intersect=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.some((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,d([this.top],_(e),!1)),this.bottom=Math.max.apply(Math,d([this.bottom],_(e),!1))},e}(),xs={},Rs=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync.meta")},ks=function(){function e(e){var t=e._iid,n=e.channel,s=e.limit,r=void 0===s?100:s,a=this;this.ref=0,this._iid=t,this._channel=n,this._limit=r,this._prevSyncLoopCount=0;var i=F.of(this._iid),o=i.sdkState,u=i.cacheContext,c=i.dispatcher,l=i.logger,v=i.statManager,m=i.messageBackgroundSyncThrottleController;this._metadataKey=Rs(o.userId,n.url);var g,C,y=(g=o.userId,C=n.url,"sendbird:".concat(g,"@groupchannel/").concat(C,"/message/sync"));this._prevSync=new Vt(y,(function(e){return p(a,void 0,void 0,(function(){var t=this;return f(this,(function(s){switch(s.label){case 0:return[4,m.run("message-background-sync-".concat(n.url,"-prev"),(function(){return p(t,void 0,void 0,(function(){var t,s,r,a,i,o,c,p,m,g,C,y;return f(this,(function(f){switch(f.label){case 0:return t={hasNext:!0,nextToken:0},this._prevSyncLoopCount++,[4,this.loadMetadata()];case 1:if(f.sent(),l.debug("message background prev sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.top),null===(c=this._metadata)||void 0===c?void 0:c.previousComplete)return[3,10];f.label=2;case 2:return f.trys.push([2,5,8,9]),[4,De.of(this._iid)._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,(null===(m=null===(p=this._metadata)||void 0===p?void 0:p.range)||void 0===m?void 0:m.top)?this._metadata.range.top:e,{prevResultSize:this._limit,nextResultSize:0,replyType:V.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0,isInclusive:!0},E.SYNC_MESSAGE_BACKGROUND,!1,!1,Le.INTERNAL_BACKSYNC)];case 3:return(s=f.sent().messages).length>0&&(r=s.map((function(e){return e.createdAt})),(null===(g=this._metadata)||void 0===g?void 0:(i=g.range).intersect.apply(i,d([],_(r),!1)))?this.extendRange(s):this._metadata={range:new Ls({top:Math.min.apply(Math,d([],_(r),!1)),bottom:Math.max.apply(Math,d([],_(r),!1))}),previousComplete:!1}),t.hasNext=s.length>=this._limit&&this._prevSyncLoopCount<1,this._metadata&&(t.nextToken=this._metadata.range.top,this._metadata.previousComplete=s.length<this._limit),l.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return f.sent(),[3,9];case 5:return a=f.sent(),l.debug("message background prev sync error",a),a instanceof h&&a.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:f.sent(),f.label=7;case 7:throw a;case 8:return v.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:n.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:null!==(y=null===(C=u.localCacheConfig)||void 0===C?void 0:C.maxSize)&&void 0!==y?y:0,use_local_cache:u.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 9:return[3,11];case 10:t.hasNext=!1,f.label=11;case 11:return[2,t]}}))}))}))];case 1:return[2,s.sent()]}}))}))})),this._nextSync=new Vt(y,(function(e){return p(a,void 0,void 0,(function(){var t=this;return f(this,(function(s){switch(s.label){case 0:return[4,m.run("message-background-sync-".concat(n.url,"-next"),(function(){return p(t,void 0,void 0,(function(){var t,s,r,a,i,o,c,h,p,m,g;return f(this,(function(f){switch(f.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:f.sent(),l.debug("message background next sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.bottom),f.label=2;case 2:return f.trys.push([2,5,6,7]),[4,De.of(this._iid)._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,(null===(h=null===(c=this._metadata)||void 0===c?void 0:c.range)||void 0===h?void 0:h.bottom)?this._metadata.range.bottom:e,{prevResultSize:0,nextResultSize:this._limit,replyType:V.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0,isInclusive:!0},E.SYNC_MESSAGE_BACKGROUND,!1,!1,Le.INTERNAL_BACKSYNC)];case 3:return(s=f.sent().messages).length>0&&(r=s.map((function(e){return e.createdAt})),(null===(p=this._metadata)||void 0===p?void 0:(i=p.range).intersect.apply(i,d([],_(r),!1)))?this.extendRange(s):this._metadata={range:new Ls({top:Math.min.apply(Math,d([],_(r),!1)),bottom:Math.max.apply(Math,d([],_(r),!1))}),previousComplete:!1}),t.hasNext=s.length>=this._limit,this._metadata&&(t.nextToken=this._metadata.range.bottom),l.debug("message background next sync progress",t),[4,this.saveMetadata()];case 4:return f.sent(),[3,7];case 5:throw a=f.sent(),l.debug("message background next sync error",a),a;case 6:return v.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:n.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:null!==(g=null===(m=u.localCacheConfig)||void 0===m?void 0:m.maxSize)&&void 0!==g?g:0,use_local_cache:u.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[2,t]}}))}))}))];case 1:return[2,s.sent()]}}))}))})),this._connectionEventContext=c.on((function(e){if(e instanceof P)if(e.stateType===O.CONNECTED)a.resume();else a.pause();else e instanceof Bt&&a.resume()}))}return e.of=function(t,n){return xs[t]||(xs[t]={}),xs[t][n.url]||(xs[t][n.url]=new e({_iid:t,channel:n})),xs[t][n.url].ref++,xs[t][n.url]},e.clear=function(e,t){xs[e]&&xs[e][t]&&(xs[e][t].close(),delete xs[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new Ls({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,d([],_(e.map((function(e){return e.createdAt}))),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,d([],_(e.map((function(e){return e.createdAt}))),!1))},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,F.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{range:new Ls(e.range),previousComplete:e.previousComplete}:{range:new Ls({}),previousComplete:!1},t.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(e){var t,n,s,r;void 0===e&&(e=Date.now());var a=F.of(this._iid),i=a.logger,o=a.sessionManager;a.cacheContext.localCacheEnabled&&o.session.hasSession&&(i.debug("message background sync resume()"),this._prevSyncLoopCount=0,this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(n=null===(t=this._metadata)||void 0===t?void 0:t.range.top)&&void 0!==n?n:e),this._nextSync.start(null!==(r=null===(s=this._metadata)||void 0===s?void 0:s.range.bottom)&&void 0!==r?r:e))},e.prototype.pause=function(){F.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete xs[this._iid][this._channel.url])},e}(),Fs=function(){function e(e){var t=e._iid,n=e.cacheContext,s=e.groupChannelCache,r=e.messageCache,a=e.unsentMessageCache,i=e.activeChannelCount,o=void 0===i?2e3:i;this._iid=t,this._cacheContext=n,this._groupChannelCache=s,this._messageCache=r,this._unsentMessageCache=a,this.activeChannelCount=o}return e.prototype.removeChannelMessages=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._messageCache.removeMessagesOfChannel(e)];case 1:return t.sent(),[4,this._unsentMessageCache.removeMessagesOfChannel(e)];case 2:return t.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"channelRotationEnabled",{get:function(){var e,t,n=F.of(this._iid).appInfo;return null!==(t=null===(e=null==n?void 0:n.channelRotationInfo)||void 0===e?void 0:e.enabled)&&void 0!==t&&t},enumerable:!1,configurable:!0}),e.prototype.removeChannelsByRotation=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a,i,o,u=this;return f(this,(function(c){switch(c.label){case 0:return e=F.of(this._iid),t=e.appInfo,n=e.connectedAt,(null==t?void 0:t.channelRotationInfo)&&t.channelRotationInfo.enabled?(s=t.channelRotationInfo,r=s.orderBy,a=s.excludeRecentHours,i=s.bufferRatio,"LAST_MESSAGE_TS_EXCLUDING_RECENT_JOINS"===r?[3,1]:[3,5]):[3,5];case 1:return[4,this._groupChannelCache.fetch({token:0,order:Ot.LATEST_LAST_MESSAGE,offset:this.activeChannelCount*i,limit:Number.MAX_SAFE_INTEGER})];case 2:return o=c.sent(),"number"==typeof a&&(o=o.filter((function(e){return 1e3*e.joinedAt<n-3600*a*1e3}))),[4,this._groupChannelCache.remove(o.map((function(e){return e.url})))];case 3:return c.sent(),[4,Promise.all(o.map((function(e){return u.removeChannelMessages(e.url)})))];case 4:return c.sent(),[3,5];case 5:return[2]}}))}))},e}(),Ps={},Os=function(u){function c(e,t){var n,r=this;return(r=u.call(this,e,s(s({},t),{channelType:i.GROUP}))||this)._leftChannels=new Map,r._markAsReadAllLastSentAt=0,r._forceDisableMack=null!==(n=t.forceDisableMack)&&void 0!==n&&n,r._groupChannelHandlers=new Map,r._groupChannelCache=new An(r._iid,{sdkState:t.sdkState,cacheContext:t.cacheContext}),r._groupChannelRotationManager=new Fs({_iid:r._iid,cacheContext:t.cacheContext,groupChannelCache:r._groupChannelCache,messageCache:r._messageCache,unsentMessageCache:r._unsentMessageCache}),r._userInfoCache=new ke(r._iid,{sdkState:t.sdkState,cacheContext:t.cacheContext}),r._groupChannelBroadcast=new Vn({dispatcher:t.dispatcher,groupChannelCache:r._groupChannelCache,userInfoCache:r._userInfoCache,messageCache:xe.of(r._iid),unsentMessageCache:Re.of(r._iid)}),setInterval((function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(r._dispatcher.dispatch(new On({channels:[e],context:{source:E.EVENT_CHANNEL_TYPING_STATUS_UPDATE}})),r._groupChannelHandlers.forEach((function(t){t.onTypingStatusUpdated&&t.onTypingStatusUpdated(e)})))};try{for(var s=v(r._groupChannelCache.channels),a=s.next();!a.done;a=s.next()){n(a.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}}),1e3),r._dispatcher.on((function(e){if(e instanceof D)r._handleEvent(e).catch((function(e){if(q(e)&&"foreground"===r._sdkState.appState)throw e}));else if(e instanceof qt)p(r,void 0,void 0,(function(){var t,n;return f(this,(function(s){switch(s.label){case 0:return t=e.message,[4,this.getChannelFromCache(t.channelUrl)];case 1:return(n=s.sent())&&!n.isFrozen?[3,3]:[4,this.getChannelWithoutCache(t.channelUrl,!0)];case 2:n=s.sent(),s.label=3;case 3:return n.isFrozen||(t instanceof Pe?n._autoResendUserMessage(t):t instanceof Oe&&n._autoResendFileMessage(t)),[2]}}))}));else if(e instanceof zt)r.reduceDBSize();else if(e instanceof Wt){var t=e.appConfigsInfo,n=e.configTs,s=t.message_purge_offset;s&&r._messageDataRetention(s),r._dispatcher.dispatch(new jt({configTs:n}))}else e instanceof Fe?p(r,void 0,void 0,(function(){var t,n,s,r,a,o=this;return f(this,(function(u){switch(u.label){case 0:return t=e.channelUrl,n=e.channelType,s=e.parentMessage,r=new He(this._iid,{channel_type:i.GROUP,channel_url:t,parent_message_id:s.messageId,thread_info:Ge.payloadify(s.threadInfo)}),n!==i.GROUP?[3,2]:[4,this.getChannel(t,!0)];case 1:a=u.sent(),W((function(){return p(o,void 0,void 0,(function(){var e,t,n,s,i;return f(this,(function(o){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onThreadInfoUpdated&&n.onThreadInfoUpdated(a,r)}catch(e){s={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),u.label=2;case 2:return[2]}}))})):e instanceof Gn?p(r,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return t=e.channel,[4,this._groupChannelCache.upsert([t])];case 1:return n.sent(),[2]}}))})):e instanceof z&&p(r,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._expandMessageChunk(e)];case 1:return t.sent(),[2]}}))}))})),Ps[e]||(Ps[e]=r),r}return e(c,u),Object.defineProperty(c.prototype,"_messageCache",{get:function(){return xe.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"_unsentMessageCache",{get:function(){return Re.of(this._iid)},enumerable:!1,configurable:!0}),c.of=function(e){return Ps[e]||(Ps[e]=new c(e,F.of(e))),Ps[e]},c.clear=function(e){Ps[e]&&delete Ps[e]},Object.defineProperty(c.prototype,"handlers",{get:function(){return d([],_(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),c.prototype.buildGroupChannelFromSerializedData=function(e){var t=B(e);return new Jr(this._iid,Jr.payloadify(t))},c.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=B(e);return new Ts(this._iid,t)},c.prototype.buildMemberFromSerializedData=function(e){var t=B(e);return new En(this._iid,En.payloadify(t))},c.prototype.getChannelFromCache=function(e){var t;return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},c.prototype.getChannelsFromCache=function(e,t,n,s,r){return p(this,void 0,void 0,(function(){return f(this,(function(a){switch(a.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n,limit:s,borderlineChannelUrl:r})];case 1:return[2,a.sent()]}}))}))},c.prototype.upsertChannelsToCache=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.upsert(e)];case 1:return[2,t.sent()]}}))}))},c.prototype.removeChannelsFromCache=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.remove(e)];case 1:return t.sent(),[2]}}))}))},c.prototype.clearChannelsFromCache=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._groupChannelCache.clear()];case 1:return e.sent(),[2]}}))}))},c.prototype.removeChannelsByRotation=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._groupChannelRotationManager.removeChannelsByRotation()];case 1:return e.sent(),[2]}}))}))},c.prototype.reduceDBSize=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a,i,o,u,c,l,h,d,_,p;return f(this,(function(f){switch(f.label){case 0:return e=xe.of(this._iid),t=F.of(this._iid).cacheContext,n=t.localCacheConfig,s=t.nestdb,t.localCacheEnabled&&s&&s.state==Be.OPENED?(r=1024*n.maxSize*1024,[4,s.estimateUsage()]):[2];case 1:if((a=f.sent())<r)return[2];i=[],o=this._groupChannelCache.channels,u={},d=0,f.label=2;case 2:return d<o.length?[4,this.getMessagesFromCache(o[d].url,0,"prev",new Ve)]:[3,5];case 3:c=f.sent(),u[o[d].url]=JSON.stringify(c).length,l=new j({channel:o[d],cachedMessageCount:c.length}),i.push(l),f.label=4;case 4:return d++,[3,2];case 5:h=i.sort(n.clearOrderComparator),d=0,f.label=6;case 6:return d<h.length?[4,e.removeMessagesOfChannel(h[d].channel.url)]:[3,10];case 7:return f.sent(),[4,e._getGroupChannelPreferenceSize(h[d].channel.url)];case 8:if(_=f.sent(),p=u[h[d].channel.url]+_,(a-=p)<r)return[3,10];f.label=9;case 9:return d++,[3,6];case 10:return[4,ke.of(this._iid).clear()];case 11:return f.sent(),[2]}}))}))},c.prototype._messageDataRetention=function(e){var t;return p(this,void 0,void 0,(function(){var n,s,r,a,i,o,u,c,l,h,d=this;return f(this,(function(_){switch(_.label){case 0:n=[],s=xe.of(this._iid),r=function(r){var i,o;return f(this,(function(u){switch(u.label){case 0:return i=r.customType,o=null!==(t=e[i])&&void 0!==t?t:e.global,[4,s.removeUnderOffset(r.url,o,!0)];case 1:return u.sent(),r.lastMessage&&r.lastMessage.createdAt<=o&&(r.lastMessage=null,n.push(r),W((function(){return p(d,void 0,void 0,(function(){var e,t,n,s,a;return f(this,(function(i){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(r)}catch(e){s={error:e}}finally{try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),a._dispatcher.dispatch(new Q({channelUrl:r.url,messageDeletionTimestamp:o,source:E.EVENT_MESSAGE_OFFSET_UPDATED})),[2]}}))},a=this,_.label=1;case 1:_.trys.push([1,6,7,8]),i=v(this._groupChannelCache.channels),o=i.next(),_.label=2;case 2:return o.done?[3,5]:(u=o.value,[5,r(u)]);case 3:_.sent(),_.label=4;case 4:return o=i.next(),[3,2];case 5:return[3,8];case 6:return c=_.sent(),l={error:c},[3,8];case 7:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(l)throw l.error}return[7];case 8:return n.length>0&&this._dispatcher.dispatch(new On({channels:n,context:{source:E.EVENT_CHANNEL_UPDATED}})),[2]}}))}))},c.prototype._expandMessageChunk=function(e){var t;return p(this,void 0,void 0,(function(){var n,s,r,a,i,o,u,c;return f(this,(function(l){switch(l.label){case 0:return n=F.of(this._iid).cacheContext,s=e.previousMessageId,r=e.messageCreatedAt,a=e.channelUrl,n.localCacheEnabled&&(null===(t=n.nestdb)||void 0===t?void 0:t.state)===Be.OPENED&&s?[4,this.getMessageFromCache(s)]:[2];case 1:return i=l.sent(),o=Rs(this._sdkState.userId,a),[4,n.preference.get(o)];case 2:return(u=l.sent())?[3,5]:i?(c={range:new Ls({top:i.createdAt,bottom:r}),previousComplete:!1},[4,n.preference.set(o,c)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,7];case 5:return i&&u.range.includes(i.createdAt)?(u.range.extends(i.createdAt,r),[4,n.preference.set(o,u)]):[3,7];case 6:l.sent(),l.label=7;case 7:return[2]}}))}))},c.prototype._isSuperGroupMackDisabled=function(e){var t=F.of(this._iid).appInfo;return!(!e.isSuper||e.isBroadcast||!(null==t?void 0:t.disableSuperGroupMack))},c.prototype._getCachedUserInfo=function(e){return this._userInfoCache.getUserInfoFromCache(e)},c.prototype._upsertCachedUserInfo=function(e,t){F.of(this._iid).useMemberInfoInMessage&&this._userInfoCache.upsert(e,t)},c.prototype._handleEvent=function(e){var t,n;return p(this,void 0,void 0,(function(){var s,r,u,c,l,h,d,_,m,g,C,y,b,N,A,S,U,T,I,w,D,L,x,R,k,P,O,H,G,V,B,z,j,Q,re,ie,oe,ue,ce,le,he,de,_e,pe,fe,ve,me,ge,Ce,ye,Ee,be,Me,Ne,Ae,Se,Ue,Te,Ie,we,De,Le,xe,Re,ke,Fe,Pe,Oe,He,Ge,Ve,Be,at,it,ot,ut,ct,lt,ht,dt,_t,pt,ft,vt,mt,gt,Ct,yt,Et,bt,Mt,Nt,At,St,Ut,Tt,It,wt,Dt,Lt,xt,Rt,kt,Ft,Pt,Ot,Ht,Gt,Vt,Bt,qt,zt,Wt,jt,Jt,Xt,Zt,en,hn,_n,pn,fn,vn,mn,gn,Cn,yn,En,bn,Mn,Nn,An,Sn,Un,Tn,In,wn,Dn,Ln,xn,Rn,kn,Fn,Pn,Gn,Vn,Bn,qn,zn,Wn,jn,Qn,Kn,Yn,Jn,Xn,Zn,$n,es,ts,ns,ss,rs,as,is,os,us,cs,ls,ds,ps,fs,ms=this;return f(this,(function(Cs){switch(Cs.label){case 0:switch(Cs.trys.push([0,88,,89]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,27];case"MCNT":return[3,31];case"PEDI":return[3,40];case"VOTE":return[3,43];case"SYEV":return[3,46];case"USEV":return[3,86]}return[3,87];case 1:return m=null,"MESG"===e.code?m=e.as(st):"FILE"===e.code?m=e.as(rt):"ADMM"!==e.code&&"BRDM"!=e.code||(m=e.as(ln)),m?(s=m.message,r=m.isMentioned,u=m.forceUpdateLastMessage,s.channelType!==i.GROUP?[3,3]:(ue=this._groupChannelCache.isCachedInMemory(s.channelUrl),P=s instanceof $e&&s.sender.userId===this._sdkState.userId,[4,this.getChannel(s.channelUrl,!0)])):[3,3];case 2:if(c=Cs.sent(),l=F.of(this._iid),b=l.useMemberInfoInMessage,Vn=l.requestDeduplicator,this._forceDisableMack||this._isSuperGroupMackDisabled(c)||s instanceof nt||P||M((function(){return p(ms,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return e=new Us(s),[4,this._requestQueue.send(e)];case 1:return t.sent(),[2]}}))}))})),s instanceof $e){h=s.sender,c.isSuper&&this._upsertCachedUserInfo(h,s.createdAt);try{for(d=v(c.members),_=d.next();!_.done;_=d.next())if((jt=_.value).userId===s.sender.userId){b&&(jt.nickname=s.sender.nickname,jt.plainProfileUrl=s.sender.plainProfileUrl,jt.metaData=s.sender.metaData,jt.isBlockedByMe=s.sender.isBlockedByMe);break}}catch(e){Kn={error:e}}finally{try{_&&!_.done&&(Yn=d.return)&&Yn.call(d)}finally{if(Kn)throw Kn.error}}b&&r&&(null===(t=s.mentionedUsers)||void 0===t||t.forEach((function(e){var t,n;try{for(var s=v(c.members),r=s.next();!r.done;r=s.next()){var a=r.value;if(e.userId===a.userId){a.nickname=e.nickname,a.plainProfileUrl=e.plainProfileUrl,a.metaData=e.metaData;break}}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}}))),P&&(T=this._sessionManager.currentUser)&&(T.nickname=s.sender.nickname,T.plainProfileUrl=s.sender.plainProfileUrl,T.metaData=s.sender.metaData)}s.silent&&!P||(c.isEphemeral||ue)&&(c._updateLastMessage(s),P||c._shouldUpdateUnreadCountWith(s)&&c._updateUnreadCount(c.unreadMessageCount+1,c.unreadMentionCount+(r?1:0))),u&&c._updateLastMessage(s),Vn.updatePendingResponse(c,Date.now()),this._dispatcher.dispatch(new On({channels:[c],context:{source:E.EVENT_MESSAGE_RECEIVED}})),s.silent&&!P||W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(c)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),this._dispatcher.dispatch(new $({messages:[s],source:E.EVENT_MESSAGE_RECEIVED})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,a,i;return f(this,(function(o){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageReceived&&n.onMessageReceived(c,s),r&&n.onMentionReceived&&n.onMentionReceived(c,s)}catch(e){a={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),Cs.label=3;case 3:return[3,87];case 4:return m=null,"MEDI"===e.code?m=e.as(et):"FEDI"===e.code?m=e.as(tt):"AEDI"===e.code&&(m=e.as(cn)),m?(g=m.message,C=m.mentionCountChange,y=F.of(this._iid),b=y.useMemberInfoInMessage,Vn=y.requestDeduplicator,g.threadInfo&&(g.threadInfo.unreadReplyCount=void 0),g.channelType!==i.GROUP?[3,6]:(ue=this._groupChannelCache.isCachedInMemory(g.channelUrl),[4,this.getChannel(g.channelUrl,!0)])):[3,6];case 5:if(N=Cs.sent(),P=!1,g instanceof $e){P=g.sender.userId===this._sdkState.userId,N.isSuper&&this._upsertCachedUserInfo(g.sender,g.updatedAt);try{for(A=v(N.members),S=A.next();!S.done;S=A.next())if((jt=S.value).userId===g.sender.userId){b&&(jt.nickname=g.sender.nickname,jt.plainProfileUrl=g.sender.plainProfileUrl,jt.metaData=g.sender.metaData,jt.isBlockedByMe=g.sender.isBlockedByMe);break}}catch(e){Jn={error:e}}finally{try{S&&!S.done&&(Xn=A.return)&&Xn.call(A)}finally{if(Jn)throw Jn.error}}}Q=!1,P?(U=g.sender,(T=this._sessionManager.currentUser)&&(T.nickname=U.nickname,T.plainProfileUrl=U.plainProfileUrl,T.metaData=U.metaData)):N.isReadMessage(g)||0!==C&&!g.silent&&ue&&(N._updateUnreadCount(N.unreadMessageCount,N.unreadMentionCount+C),Q=!0),N._updateLastMessage(g)?Q=!0:(null===(n=N.lastMessage)||void 0===n?void 0:n.isIdentical(g))&&(ue?N._updateLastMessage(g)&&(Q=!0):Q=!0),I=!1,N.lastPinnedMessage&&N.lastPinnedMessage.messageId===g.messageId&&(N.lastPinnedMessage=g,Q=!0,I=!0),Q&&(Vn.updatePendingResponse(N,Date.now()),this._dispatcher.dispatch(new On({channels:[N],context:{source:I?E.EVENT_PINNED_MESSAGE_UPDATED:E.EVENT_MESSAGE_UPDATED}})),g.silent&&!P||W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(N)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),I&&W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPinnedMessageUpdated&&n.onPinnedMessageUpdated(N)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),this._dispatcher.dispatch(new $({messages:[g],source:E.EVENT_MESSAGE_UPDATED})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated&&n.onMessageUpdated(N,g),C>0&&n.onMentionReceived&&n.onMentionReceived(N,g)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Cs.label=6;case 6:return[3,87];case 7:return w=e.as(se),Oe=w.channelUrl,He=w.channelType,D=w.messageId,L=w.silent,x=w.messageCreatedAt,R=w.senderId,He!==i.GROUP?[3,9]:[4,this.getChannel(Oe,!0)];case 8:k=Cs.sent(),P=R===this._sdkState.userId,L||P||x>0&&k.myLastRead<x&&k.unreadMessageCount>0&&(k._updateUnreadCount(k.unreadMessageCount-1,0),(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(k,Date.now())),this._dispatcher.dispatch(new ne({messageIds:[D],source:E.EVENT_MESSAGE_DELETED})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageDeleted&&n.onMessageDeleted(k,D)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Cs.label=9;case 9:return[3,87];case 10:return(O=e.as(Ze).readStatus).channelType!==i.GROUP?[3,12]:(ue=this._groupChannelCache.isCachedInMemory(O.channelUrl),[4,this.getChannel(O.channelUrl,!0)]);case 11:if(H=Cs.sent(),G=O.reader.userId===this._sdkState.userId,V=!0,ue&&(V=H._updateUnreadMemberState(O.reader.userId,O.readAt,O.isExcluded)),O.isExcluded){if(V){try{for(B=v(this._groupChannelHandlers.values()),z=B.next();!z.done;z=B.next())(j=z.value).onUserMarkedUnread!==te?j.onUserMarkedUnread(H,[O.reader.userId]):j.onUnreadMemberStatusUpdated&&j.onUnreadMemberStatusUpdated(H)}catch(e){Zn={error:e}}finally{try{z&&!z.done&&($n=B.return)&&$n.call(B)}finally{if(Zn)throw Zn.error}}this._dispatcher.dispatch(new On({channels:[H],context:{source:E.EVENT_CHANNEL_UNREAD,userIds:[O.reader.userId]}}))}}else Q=!0,G&&(ue?H.unreadMentionCount>0||H.unreadMessageCount>0?H._updateUnreadCount(0,0):Q=!1:0!==H.unreadMessageCount&&0!==H.unreadMentionCount&&(Q=!1)),Q&&(this._dispatcher.dispatch(new On({channels:[H],context:{source:V?E.EVENT_CHANNEL_READ:E.EVENT_CHANNEL_UPDATED,userIds:[O.reader.userId]}})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())n=t.value,G?n.onChannelChanged!==te&&n.onChannelChanged(H):V&&(n.onUserMarkedRead!==te?n.onUserMarkedRead(H,[O.reader.userId]):n.onUnreadMemberStatusUpdated!==te&&n.onUnreadMemberStatusUpdated(H))}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})));Cs.label=12;case 12:return[3,87];case 13:return re=e.as(Ds),Oe=re.channelUrl,ie=re.deliveredStateUpdate,oe=void 0===ie?{}:ie,ue=this._groupChannelCache.isCachedInMemory(Oe),[4,this.getChannel(Oe,!0)];case 14:return ce=Cs.sent(),ue&&Object.keys(oe).forEach((function(e){ce._updateUndeliveredMemberState(e,oe[e])})),Object.keys(oe).some((function(e){return e!==ms._sdkState.userId}))&&(this._dispatcher.dispatch(new On({channels:[ce],context:{source:E.EVENT_CHANNEL_DELIVERED}})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onUndeliveredMemberStatusUpdated&&n.onUndeliveredMemberStatusUpdated(ce)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),[3,87];case 15:return le=e.as(un),Oe=le.channelUrl,He=le.channelType,he=le.event,He!==i.GROUP?[3,26]:[4,this.getChannel(Oe,!0)];case 16:return de=Cs.sent(),[4,this.getMessageFromCache(he.messageId)];case 17:if(Ee=Cs.sent(),!de.isSuper)return[3,25];Cs.label=18;case 18:Cs.trys.push([18,23,24,25]),_e=v(Object.keys(he._sampledUserInfoList)),pe=_e.next(),Cs.label=19;case 19:return pe.done?[3,22]:(fe=pe.value,[4,this._userInfoCache.get(fe)]);case 20:(ve=Cs.sent())?(ve.plainProfileUrl=he._sampledUserInfoList[fe].profile_url,ve.nickname=he._sampledUserInfoList[fe].nickname,this._upsertCachedUserInfo(ve,he.updatedAt)):(me=new o(this._iid,{user_id:fe,nickname:he._sampledUserInfoList[fe].nickname,profile_url:he._sampledUserInfoList[fe].profile_url,require_auth_for_profile_image:he._sampledUserInfoList[fe].require_auth_for_profile_image}),this._upsertCachedUserInfo(me,he.updatedAt)),Cs.label=21;case 21:return pe=_e.next(),[3,19];case 22:return[3,25];case 23:return ge=Cs.sent(),es={error:ge},[3,25];case 24:try{pe&&!pe.done&&(ts=_e.return)&&ts.call(_e)}finally{if(es)throw es.error}return[7];case 25:Ee?Ee instanceof Xe&&(Ee.applyReactionEvent(he),this._dispatcher.dispatch(new $({messages:[Ee],source:E.EVENT_MESSAGE_REACTION_UPDATED}))):this._dispatcher.dispatch(new ee({event:he,source:E.EVENT_MESSAGE_REACTION_UPDATED})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onReactionUpdated&&n.onReactionUpdated(de,he)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Cs.label=26;case 26:return[3,87];case 27:return(Ce=e.as(on).event).channelType!==i.GROUP?[3,30]:[4,this.getChannel(Ce.channelUrl,!0)];case 28:return ye=Cs.sent(),[4,this.getMessageFromCache(Ce.targetMessageId)];case 29:if((Ee=Cs.sent())?Ee instanceof Xe&&(Ee.applyThreadInfoUpdateEvent(Ce),this._dispatcher.dispatch(new $({messages:[Ee],source:E.EVENT_MESSAGE_THREADINFO_UPDATED}))):this._dispatcher.dispatch(new Z({event:Ce,source:E.EVENT_MESSAGE_THREADINFO_UPDATED})),ye.isSuper)try{for(be=v(Ce.threadInfo.mostRepliedUsers),Me=be.next();!Me.done;Me=be.next())Gt=Me.value,this._upsertCachedUserInfo(Gt,Ce.threadInfo.updatedAt)}catch(e){ns={error:e}}finally{try{Me&&!Me.done&&(ss=be.return)&&ss.call(be)}finally{if(ns)throw ns.error}}W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onThreadInfoUpdated&&n.onThreadInfoUpdated(ye,Ce)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Cs.label=30;case 30:return[3,87];case 31:Ne=e.as(an).groupChannelMemberCounts,Ae=[],Cs.label=32;case 32:Cs.trys.push([32,37,38,39]),Se=v(Ne),Ue=Se.next(),Cs.label=33;case 33:return Ue.done?[3,36]:(Te=Ue.value,Oe=Te.channelUrl,Rt=Te.memberCount,kt=Te.joinedMemberCount,Ie=Te.updatedAt,[4,this.getChannelFromCache(Oe)]);case 34:(we=Cs.sent())&&we._setLatestMemberCount(Rt,kt,Ie)&&Ae.push(we),Cs.label=35;case 35:return Ue=Se.next(),[3,33];case 36:return[3,39];case 37:return De=Cs.sent(),rs={error:De},[3,39];case 38:try{Ue&&!Ue.done&&(as=Se.return)&&as.call(Se)}finally{if(rs)throw rs.error}return[7];case 39:return Ae.length>0&&(this._dispatcher.dispatch(new On({channels:Ae,context:{source:E.EVENT_CHANNEL_MEMBER_COUNT_UPDATED}})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelMemberCountChanged&&n.onChannelMemberCountChanged(Ae)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),[3,87];case 40:return Le=e.as(rn),xe=Le.event,Re=Le.status,Oe=Le.channelUrl,He=Le.channelType,Oe&&He===i.GROUP?[4,this.getChannel(Oe,!0)]:[3,42];case 41:ke=Cs.sent(),this._dispatcher.dispatch(new X({event:xe,source:E.EVENT_POLL_UPDATED})),W(Re===ae?function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollDeleted&&n.onPollDeleted(ke,xe.pollId)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}:function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollUpdated&&n.onPollUpdated(ke,xe)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}),Cs.label=42;case 42:return[3,87];case 43:return Fe=e.as(Je),Pe=Fe.event,Oe=Fe.channelUrl,He=Fe.channelType,Oe&&He===i.GROUP?[4,this.getChannel(Oe,!0)]:[3,45];case 44:Ge=Cs.sent(),this._dispatcher.dispatch(new J({event:Pe,source:E.EVENT_POLL_VOTED})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollVoted&&n.onPollVoted(Ge,Pe)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Cs.label=45;case 45:return[3,87];case 46:if(!(Ve=e.as($t).event).isGroupChannelEvent)return[3,85];switch(Ve.category){case nn.CHANNEL_JOIN:return[3,47];case nn.CHANNEL_LEAVE:return[3,49];case nn.CHANNEL_OPERATOR_UPDATE:return[3,53];case nn.CHANNEL_INVITE:return[3,55];case nn.CHANNEL_DECLINE_INVITE:return[3,57];case nn.TYPING_START:case nn.TYPING_END:return[3,59];case nn.USER_CHANNEL_MUTE:case nn.USER_CHANNEL_UNMUTE:return[3,61];case nn.USER_CHANNEL_BAN:return[3,63];case nn.USER_CHANNEL_UNBAN:return[3,67];case nn.CHANNEL_FREEZE:case nn.CHANNEL_UNFREEZE:return[3,69];case nn.CHANNEL_HIDE:return[3,71];case nn.CHANNEL_UNHIDE:return[3,73];case nn.CHANNEL_DELETED:return[3,75];case nn.CHANNEL_PROP_CHANGED:return[3,76];case nn.CHANNEL_META_DATA_CHANGED:return[3,79];case nn.CHANNEL_META_COUNTERS_CHANGED:return[3,81];case nn.PINNED_MESSAGE_CHANGED:return[3,83]}return[3,85];case 47:return[4,this.getChannel(Ve.channelUrl,!0)];case 48:if(Be=Cs.sent(),at=e.as(hs),it=at.memberCount,ot=at.joinedMemberCount,ut=at.members,ct=!1,ut.forEach((function(e){Be.isExclusive||Be.isSuper||Be.isBroadcast?ct=ct||Be._setLatestMemberCount(it,ot,Ve.ts):(e.state=dn.JOINED,Be.addMember(e,Ve.ts),ms._updateJoinedMemberCount(Be)),e.userId===ms._sdkState.userId&&(Be.myMemberState=dn.JOINED)})),Be.isSuper)try{for(lt=v(ut),ht=lt.next();!ht.done;ht=lt.next())jt=ht.value,this._upsertCachedUserInfo(jt,Ve.ts)}catch(e){is={error:e}}finally{try{ht&&!ht.done&&(os=lt.return)&&os.call(lt)}finally{if(is)throw is.error}}return(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(Be,Date.now()),this._dispatcher.dispatch(new On({channels:[Be],context:{source:E.EVENT_CHANNEL_JOINED,users:ut}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var s=v(ut),r=s.next();!r.done;r=s.next()){var a=r.value;e.onUserJoined&&e.onUserJoined(Be,a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}Be.isBroadcast&&ct&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([Be])})),[2]}))}))})),[3,85];case 49:return(Jt=this._leftChannels.get(Ve.channelUrl))?(_t=Jt.channel,[3,52]):[3,50];case 50:return[4,this.getChannel(Ve.channelUrl,!0)];case 51:_t=Cs.sent(),Cs.label=52;case 52:return dt=_t,pt=e.as(_s),Rt=pt.memberCount,kt=pt.joinedMemberCount,ft=pt.member,vt=!1,mt=F.of(this._iid),gt=mt.appInfo,Vn=mt.requestDeduplicator,dt.isExclusive||dt.isSuper||dt.isBroadcast?vt=dt._setLatestMemberCount(Rt,kt,Ve.ts):((null==gt?void 0:gt.enabledChannelMemberShipHistory)?((Ct=dt.members.find((function(e){return e.userId===ft.userId})))&&(Ct.state=dn.LEFT),dt.memberCount=Rt):dt.removeMember(ft),this._updateJoinedMemberCount(dt)),ft.userId===this._sdkState.userId?(dt.myMemberState=dn.NONE,dt.invitedAt=0,dt.joinedAt=0,dt._updateUnreadCount(0,0),dt.isPublic?this._dispatcher.dispatch(new On({channels:[dt],context:{source:E.EVENT_CHANNEL_LEFT,user:ft}})):(this._markAsLeave(dt),this._dispatcher.dispatch(new Hn({channelUrls:[dt.url],context:{source:E.EVENT_CHANNEL_LEFT,user:ft}})))):this._dispatcher.dispatch(new On({channels:[dt],context:{source:E.EVENT_CHANNEL_LEFT,user:ft}})),Vn.updatePendingResponse(dt,Date.now()),dt.isSuper&&this._upsertCachedUserInfo(ft,Ve.ts),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft&&e.onUserLeft(dt,ft),dt.isBroadcast&&vt&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([dt])})),[2]}))}))})),[3,85];case 53:return[4,this.getChannel(Ve.channelUrl,!0)];case 54:yt=Cs.sent(),Et=e.as(sn).operators,bt=Et.map((function(e){return e.userId}));try{for(Mt=v(yt.members),Nt=Mt.next();!Nt.done;Nt=Mt.next())(jt=Nt.value).role=bt.includes(jt.userId)?a.OPERATOR:a.NONE}catch(e){us={error:e}}finally{try{Nt&&!Nt.done&&(cs=Mt.return)&&cs.call(Mt)}finally{if(us)throw us.error}}return yt.myRole=bt.includes(this._sdkState.userId)?a.OPERATOR:a.NONE,(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(yt,Date.now()),this._dispatcher.dispatch(new On({channels:[yt],context:{source:E.EVENT_CHANNEL_OPERATOR_UPDATED,operators:Et}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated&&e.onOperatorUpdated(yt,Et)})),[2]}))}))})),[3,85];case 55:return[4,this.getChannel(Ve.channelUrl,!0)];case 56:At=Cs.sent(),St=e.as(vs),Rt=St.memberCount,kt=St.joinedMemberCount,Ut=St.inviter,(Tt=St.invitees).forEach((function(e){return e.state=dn.INVITED}));try{for(It=v(Tt),wt=It.next();!wt.done;wt=It.next())Dt=wt.value,At.isExclusive||At.isSuper||At.isBroadcast?(At.isSuper&&this._userInfoCache.upsert(Dt,Ve.ts),At._setLatestMemberCount(Rt,kt,Ve.ts)):At.addMember(Dt,Ve.ts),this._sdkState.userId===Dt.userId&&(At.hiddenState=Rr.UNHIDDEN,At.myMemberState!==dn.JOINED&&(At.myMemberState=dn.INVITED),At.invitedAt=Ve.ts)}catch(e){ls={error:e}}finally{try{wt&&!wt.done&&(ds=It.return)&&ds.call(It)}finally{if(ls)throw ls.error}}return(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(At,Date.now()),this._dispatcher.dispatch(new On({channels:[At],context:{source:E.EVENT_CHANNEL_INVITED,inviter:Ut,invitees:Tt}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation&&e.onUserReceivedInvitation(At,Ut,Tt)})),[2]}))}))})),[3,85];case 57:return[4,this.getChannel(Ve.channelUrl,!0)];case 58:return Lt=Cs.sent(),xt=e.as(gs),Rt=xt.memberCount,kt=xt.joinedMemberCount,Ft=xt.inviter,Pt=xt.invitee,Lt.isExclusive||Lt.isSuper||Lt.isBroadcast?(Lt.isSuper&&this._userInfoCache.upsert(Pt,Ve.ts),Lt._setLatestMemberCount(Rt,kt,Ve.ts)):Lt.removeMember(Pt),this._sdkState.userId===Pt.userId?(Lt.invitedAt=0,Lt.myMemberState=dn.NONE,Lt.isPublic?this._dispatcher.dispatch(new On({channels:[Lt],context:{source:E.EVENT_CHANNEL_DECLINED_INVITE,inviter:Ft,invitee:Pt}})):this._dispatcher.dispatch(new Hn({channelUrls:[Lt.url],context:{source:E.EVENT_CHANNEL_DECLINED_INVITE,inviter:Ft,invitee:Pt}}))):this._dispatcher.dispatch(new On({channels:[Lt],context:{source:E.EVENT_CHANNEL_DECLINED_INVITE,inviter:Ft,invitee:Pt}})),(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(Lt,Date.now()),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation&&e.onUserDeclinedInvitation(Lt,Ft,Pt)})),[2]}))}))})),[3,85];case 59:return[4,this.getChannel(Ve.channelUrl,!0)];case 60:return Ot=Cs.sent(),Ht=Ve.category===nn.TYPING_START,Gt=e.as(Ht?Ns:Ss).user,Ot._updateTypingStatus(Gt,Ht?Ve.ts:0),(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(Ot,Date.now()),this._dispatcher.dispatch(new On({channels:[Ot],context:{source:E.EVENT_CHANNEL_TYPING_STATUS_UPDATE}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated&&e.onTypingStatusUpdated(Ot)})),[2]}))}))})),[3,85];case 61:return[4,this.getChannel(Ve.channelUrl,!0)];case 62:Vt=Cs.sent(),Bt=Ve.category===nn.USER_CHANNEL_MUTE,(qt=e.as(Bt?Ke:Ye).user).userId===this._sdkState.userId&&(Vt.myMutedState=Bt?Y.MUTED:Y.UNMUTED,Vt._myMutedRemainingTime=qt.restrictionInfo.remainingDuration);try{for(zt=v(Vt.members),Wt=zt.next();!Wt.done;Wt=zt.next())if((jt=Wt.value).userId===qt.userId){jt.isMuted=Bt;break}}catch(e){ps={error:e}}finally{try{Wt&&!Wt.done&&(fs=zt.return)&&fs.call(zt)}finally{if(ps)throw ps.error}}return Vt.isSuper&&this._userInfoCache.upsert(qt,Ve.ts),(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(Vt,Date.now()),this._dispatcher.dispatch(new On({channels:[Vt],context:{source:Bt?E.EVENT_CHANNEL_MUTED:E.EVENT_CHANNEL_UNMUTED,user:qt}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Bt?e.onUserMuted&&e.onUserMuted(Vt,qt):e.onUserUnmuted&&e.onUserUnmuted(Vt,qt)})),[2]}))}))})),[3,85];case 63:return(Jt=this._leftChannels.get(Ve.channelUrl))?(Zt=Jt.channel,[3,66]):[3,64];case 64:return[4,this.getChannel(Ve.channelUrl,!0)];case 65:Zt=Cs.sent(),Cs.label=66;case 66:return Xt=Zt,this._markAsLeave(Xt),en=e.as(Qe).user,pn=en.userId===this._sdkState.userId,Xt.isSuper&&this._userInfoCache.upsert(en,Ve.ts),pn&&this._dispatcher.dispatch(new Hn({channelUrls:[Xt.url],context:{source:E.EVENT_CHANNEL_BANNED,user:en}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned&&e.onUserBanned(Xt,en)})),[2]}))}))})),[3,85];case 67:return[4,this.getChannel(Ve.channelUrl,!0)];case 68:return hn=Cs.sent(),_n=e.as(je).user,pn=_n.userId===this._sdkState.userId,hn.isSuper&&this._userInfoCache.upsert(_n,Ve.ts),pn&&this._dispatcher.dispatch(new Hn({channelUrls:[hn.url],context:{source:E.EVENT_CHANNEL_UNBANNED,user:_n}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned&&e.onUserUnbanned(hn,_n)})),[2]}))}))})),[3,85];case 69:return[4,this.getChannel(Ve.channelUrl,!0)];case 70:return fn=Cs.sent(),vn=e.as(We).freeze,fn.isFrozen=vn,(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(fn,Date.now()),this._dispatcher.dispatch(new On({channels:[fn],context:{source:vn?E.EVENT_CHANNEL_FROZEN:E.EVENT_CHANNEL_UNFROZEN}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){vn?e.onChannelFrozen&&e.onChannelFrozen(fn):e.onChannelUnfrozen&&e.onChannelUnfrozen(fn)})),[2]}))}))})),[3,85];case 71:return[4,this.getChannel(Ve.channelUrl,!0)];case 72:return mn=Cs.sent(),gn=e.as(bs),Cn=gn.allowAutoUnhide,yn=gn.hidePreviousMessages,En=gn.messageOffsetTimestamp,null!==Cn&&(mn.hiddenState=Cn?Rr.HIDDEN_ALLOW_AUTO_UNHIDE:Rr.HIDDEN_PREVENT_AUTO_UNHIDE),null!==yn&&yn&&mn._updateUnreadCount(0,0),null!==En&&(mn.messageOffsetTimestamp=En),(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(mn,Date.now()),this._dispatcher.dispatch(new On({channels:[mn],context:{source:E.EVENT_CHANNEL_HIDDEN}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden&&e.onChannelHidden(mn)})),[2]}))}))})),[3,85];case 73:return[4,this.getChannel(Ve.channelUrl,!0)];case 74:return(bn=Cs.sent()).hiddenState=Rr.UNHIDDEN,(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(bn,Date.now()),this._dispatcher.dispatch(new On({channels:[bn],context:{source:E.EVENT_CHANNEL_UNHIDDEN}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(bn)})),[2]}))}))})),[3,85];case 75:return this._dispatcher.dispatch(new Hn({channelUrls:[Ve.channelUrl],context:{source:E.EVENT_CHANNEL_DELETED}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(Ve.channelUrl,i.GROUP)})),[2]}))}))})),[3,85];case 76:return[4,K(50)];case 77:return Cs.sent(),[4,this.getChannelWithoutCache(Ve.channelUrl,!0,!1)];case 78:return Mn=Cs.sent(),this._dispatcher.dispatch(new On({channels:[Mn],context:{source:E.EVENT_CHANNEL_UPDATED}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(Mn)})),[2]}))}))})),[3,85];case 79:return[4,this.getChannel(Ve.channelUrl,!0)];case 80:return Nn=Cs.sent(),An=e.as(ze),Sn=An.created,Un=An.updated,Tn=An.deleted,Sn&&(Nn._upsertCachedMetaData(Sn,Ve.ts),this._dispatcher.dispatch(new On({channels:[Nn],context:{source:E.EVENT_CHANNEL_METADATA_CREATED,metaData:Sn},ts:Ve.ts}))),Un&&(Nn._upsertCachedMetaData(Un,Ve.ts),this._dispatcher.dispatch(new On({channels:[Nn],context:{source:E.EVENT_CHANNEL_METADATA_UPDATED,metaData:Un},ts:Ve.ts}))),Tn&&(Nn._removeFromCachedMetaData(Tn,Ve.ts),this._dispatcher.dispatch(new On({channels:[Nn],context:{source:E.EVENT_CHANNEL_METADATA_DELETED,metaDataKeys:Tn},ts:Ve.ts}))),(Sn||Un||Tn)&&(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(Nn,Date.now()),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Sn&&e.onMetaDataCreated&&e.onMetaDataCreated(Nn,Sn),Un&&e.onMetaDataUpdated&&e.onMetaDataUpdated(Nn,Un),Tn&&e.onMetaDataDeleted&&e.onMetaDataDeleted(Nn,Tn)})),[2]}))}))})),[3,85];case 81:return[4,this.getChannel(Ve.channelUrl,!0)];case 82:return In=Cs.sent(),wn=e.as(qe),Dn=wn.created,Ln=wn.updated,xn=wn.deleted,Dn&&this._dispatcher.dispatch(new On({channels:[In],context:{source:E.EVENT_CHANNEL_METACOUNTER_CREATED,metaCounters:Dn}})),Ln&&this._dispatcher.dispatch(new On({channels:[In],context:{source:E.EVENT_CHANNEL_METACOUNTER_UPDATED,metaCounters:Ln}})),xn&&this._dispatcher.dispatch(new On({channels:[In],context:{source:E.EVENT_CHANNEL_METACOUNTER_DELETED,metaCounterKeys:xn}})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Dn&&e.onMetaCounterCreated&&e.onMetaCounterCreated(In,Dn),Ln&&e.onMetaCounterUpdated&&e.onMetaCounterUpdated(In,Ln),xn&&e.onMetaCounterDeleted&&e.onMetaCounterDeleted(In,xn)})),[2]}))}))})),[3,85];case 83:return[4,this.getChannel(Ve.channelUrl,!0)];case 84:return Rn=Cs.sent(),kn=e.as(tn),Fn=kn.pinnedMessageIds,Pn=kn.latestPinnedMessage,(Gn=kn.ts)>Rn._pinnedMessagesUpdatedAt&&(Rn.pinnedMessageIds=null!=Fn?Fn:[],Rn.lastPinnedMessage=Pn,Rn._pinnedMessagesUpdatedAt=Gn,(Vn=F.of(this._iid).requestDeduplicator).updatePendingResponse(Rn,Date.now()),this._dispatcher.dispatch(new On({channels:[Rn],context:{source:E.EVENT_PINNED_MESSAGE_UPDATED}})),W((function(){return p(ms,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(Rn)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),W((function(){return p(ms,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(Rn)})),[2]}))}))}))),[3,85];case 85:return[3,87];case 86:switch((Bn=e.as(Qt).event).category){case Kt.USER_BLOCK:qn=Yt.getDataAsUserBlockEvent(this._iid,Bn),Wn=qn.blocker,jn=qn.blockee,this._groupChannelCache.block(Wn.userId,jn.userId);break;case Kt.USER_UNBLOCK:zn=Yt.getDataAsUserBlockEvent(this._iid,Bn),Wn=zn.blocker,jn=zn.blockee,this._groupChannelCache.unblock(Wn.userId,jn.userId)}return[3,87];case 87:return[3,89];case 88:if(Qn=Cs.sent(),q(Qn))throw Qn;return[3,89];case 89:return[2]}}))}))},c.prototype._markAsLeave=function(e){var t,n=this,s=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};s.ref++,this._leftChannels.set(e.url,s),setTimeout((function(){s.ref--,0===s.ref&&n._leftChannels.delete(e.url)}),1e4)},c.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},c.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},c.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},c.prototype.subscribeChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},c.prototype.unsubscribeChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},c.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter((function(e){return e.state===dn.JOINED})).length},c.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n;return f(this,(function(s){switch(s.label){case 0:l(g("string",e)).throw(h.invalidParameters),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=s.sent())?[2,n]:[3,4];case 3:return s.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,s.sent()]}}))}))},c.prototype.getChannelWithoutCache=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!0),p(this,void 0,void 0,(function(){var s,r,a,i,o,u,c,d,_,p,m,C,y,E=this;return f(this,(function(f){switch(f.label){case 0:return l(g("string",e)).throw(h.invalidParameters),s=F.of(this._iid).requestDeduplicator,r=new zn({channelUrl:e,isInternalCall:t}),[4,s.requestGetChannel(r.path,(function(){return E._requestQueue.send(r)}),r.params,n)];case 1:switch(a=f.sent(),i=a.as(Wn).channel,o=i.unreadMessageCount,u=i.unreadMentionCount,i.myCountPreference){case xr.UNREAD_MESSAGE_COUNT_ONLY:u=0;break;case xr.UNREAD_MENTION_COUNT_ONLY:o=0;break;case xr.OFF:o=0,u=0}i._updateUnreadCount(o,u),c=this._groupChannelCache.filterOffsetChanged([i]),f.label=2;case 2:f.trys.push([2,7,8,9]),d=v(c),_=d.next(),f.label=3;case 3:return _.done?[3,6]:(p=_.value,[4,this._messageCache.removeUnderOffset(p.url,p.messageOffsetTimestamp)]);case 4:f.sent(),f.label=5;case 5:return _=d.next(),[3,3];case 6:return[3,9];case 7:return m=f.sent(),C={error:m},[3,9];case 8:try{_&&!_.done&&(y=d.return)&&y.call(d)}finally{if(C)throw C.error}return[7];case 9:return[4,this._groupChannelCache.upsert([i])];case 10:return[2,f.sent()[0]]}}))}))},c.prototype.refreshChannel=function(e,t,n,s){return void 0===t&&(t=!0),void 0===n&&(n=E.REFRESH_CHANNEL),void 0===s&&(s=!1),p(this,void 0,void 0,(function(){var r,a,i,o,u,c,l=this;return f(this,(function(h){switch(h.label){case 0:return h.trys.push([0,5,,6]),r=F.of(this._iid).requestDeduplicator,a=new zn({channelUrl:e,isInternalCall:t,showLatestMessage:s}),[4,r.requestGetChannel(a.path,(function(){return l._requestQueue.send(a)}),a.params)];case 1:return i=h.sent(),(o=i.as(Wn).channel).myMemberState!==dn.NONE?[3,2]:(this._dispatcher.dispatch(new Hn({channelUrls:[o.url],context:{source:n}})),[3,4]);case 2:return[4,this.upsertChannelsToCache([o])];case 3:u=h.sent(),this._dispatcher.dispatch(new On({channels:u,context:{source:n}})),h.label=4;case 4:return[3,6];case 5:return(c=h.sent()).code!==re.NON_AUTHORIZED&&c.code!==re.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new Hn({channelUrls:[e],context:{source:n}})),[3,6];case 6:return[2]}}))}))},c.prototype.getMyGroupChannels=function(e,t,n,r,a){return void 0===r&&(r=E.REQUEST_CHANNEL),void 0===a&&(a=!1),p(this,void 0,void 0,(function(){var i,o,u,c,l,h,d,_,p;return f(this,(function(f){switch(f.label){case 0:return t.createdAfter&&(t.createdAfter=Math.floor(t.createdAfter/1e3)),t.createdBefore&&(t.createdBefore=Math.floor(t.createdBefore/1e3)),i=!1,a&&(o=F.of(this._iid),u=o.appInfo,(c=o.cacheContext)&&!c.localCacheEnabled&&(null==u?void 0:u.enabledChannelMemberShipHistory)&&(null==u?void 0:u.applicationAttributes.includes("left_user_view_support"))&&(i=!0)),l=new Qn(s(s({},t),{userId:this._sdkState.userId,token:e,limit:n,includeLeftChannel:a&&i})),[4,this._requestQueue.send(l)];case 1:return h=f.sent(),d=h.as(Kn),_=d.channels,p=d.token,this._dispatcher.dispatch(new On({channels:_,context:{source:r}})),[2,{channels:_,token:p}]}}))}))},c.prototype.getMyGroupChannelChangeLogs=function(e,t,r){return void 0===r&&(r=E.REQUEST_CHANNEL_CHANGELOGS),p(this,void 0,void 0,(function(){var a,i,o,u,c,d,_,p;return f(this,(function(f){switch(f.label){case 0:return a=s(s({},Tn),t),l((g("string",e)||g("number",e))&&In(a)).throw(h.invalidParameters),i=new Bn(n({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:a})),[4,this._requestQueue.send(i)];case 1:return o=f.sent(),u=o.as(qn),c=u.updatedChannels,d=u.deletedChannelUrls,_=u.hasMore,p=u.ts,c.length>0&&this._dispatcher.dispatch(new On({channels:c,context:{source:r},ts:p})),d.length>0&&this._dispatcher.dispatch(new Hn({channelUrls:d,context:{source:r}})),[2,{updatedChannels:c,deletedChannelUrls:d,hasMore:_,token:u.token}]}}))}))},c.prototype.getGroupChannelCount=function(e){return p(this,void 0,void 0,(function(){var t,n,r;return f(this,(function(a){switch(a.label){case 0:return t=s(s({},wn),e),l(Dn(t)).throw(h.invalidParameters),n=new Yn({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return r=a.sent(),[2,r.as(Jn).groupChannelCount]}}))}))},c.prototype.getUnreadItemCount=function(e){return p(this,void 0,void 0,(function(){var n,r,a,i,o,u,c,d,_,p,v,g,C,y,E,b;return f(this,(function(f){switch(f.label){case 0:return n=s(s({},Ln),e),l(function(e){return m(Mn,e.keys)&&m("string",e.customTypeFilters,!0)&&m("string",e.customTypesFilter,!0)}(n)).throw(h.invalidParameters),r=F.of(this._iid),a=r.sdkState,i=r.requestQueue,o=new Xn({userId:a.userId,filter:n}),[4,i.send(o)];case 1:return u=f.sent(),c=u.as(Zn),d=c.groupChannelUnreadMentionCount,_=c.groupChannelUnreadMessageCount,p=c.groupChannelInvitationCount,v=c.superGroupChannelUnreadMentionCount,g=c.superGroupChannelUnreadMessageCount,C=c.superGroupChannelInvitationCount,y=c.nonSuperGroupChannelUnreadMentionCount,E=c.nonSuperGroupChannelUnreadMessageCount,b=c.nonSuperGroupChannelInvitationCount,[2,t({groupChannelUnreadMentionCount:d,groupChannelUnreadMessageCount:_,groupChannelInvitationCount:p,superGroupChannelUnreadMentionCount:v,superGroupChannelUnreadMessageCount:g,superGroupChannelInvitationCount:C,nonSuperGroupChannelUnreadMentionCount:y,nonSuperGroupChannelUnreadMessageCount:E,nonSuperGroupChannelInvitationCount:b})]}}))}))},c.prototype.getTotalUnreadChannelCount=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){switch(a.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new $n({userId:t.userId}),[4,n.send(s)];case 1:return r=a.sent(),[2,r.as(es).unreadCount]}}))}))},c.prototype.getTotalUnreadMessageCount=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return t=s(s({},xn),e),l(Rn(t)).throw(h.invalidParameters),n=F.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new ts({userId:r.userId,filter:t}),[4,a.send(i)];case 1:return o=u.sent(),[2,o.as(ns).unreadCount]}}))}))},c.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){var t,n,a,i;return f(this,(function(o){switch(o.label){case 0:return t=s(s({},kn),e),l(function(e){return g("string",e.channelUrl,!0)&&m(Ie,e.scheduledStatus,!0)&&r(y,e.messageTypeFilter)}(t)).throw(h.invalidParameters),n=F.of(this._iid).requestQueue,a=new ss(t),[4,n.send(a)];case 1:return i=o.sent(),[2,i.as(rs).count]}}))}))},c.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=F.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},c.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=F.of(this._iid).subscribedUnreadMessageCount;return Object.keys(t.customTypes).forEach((function(n){e+=t.customTypes[n]})),e},c.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=F.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},c.prototype.createChannel=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a;return f(this,(function(i){switch(i.label){case 0:return t=s(s({},Sn),e),l(Un(t)).throw(h.invalidParameters),t.isPublic||(t.accessCode=void 0),n=new is(s({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return r=i.sent(),a=r.as(os).channel,[4,this.upsertChannelsToCache([a])];case 2:return i.sent(),[2,a]}}))}))},c.prototype.markAsReadAll=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return e=Date.now(),l(e-this._markAsReadAllLastSentAt>=1e3).throw(h.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new us({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:u.sent(),n=this._groupChannelCache.channels;try{for(s=v(n),r=s.next();!r.done;r=s.next())(a=r.value)._updateUnreadMemberState(this._sdkState.userId,e),a._updateUnreadCount(0,0)}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return n.length>0?[4,this.upsertChannelsToCache(n)]:[3,3];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},c.prototype.markAsReadWithChannelUrls=function(e){return p(this,void 0,void 0,(function(){var t,n,s,r,a,i,o,u,c;return f(this,(function(d){switch(d.label){case 0:return t=Date.now(),l(m("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(h.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new us({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:d.sent(),s=this._groupChannelCache.channels,r=[];try{for(a=v(s),i=a.next();!i.done;i=a.next())o=i.value,e.includes(o.url)&&(o._updateUnreadMemberState(this._sdkState.userId,t),o._updateUnreadCount(0,0),r.push(o))}catch(e){u={error:e}}finally{try{i&&!i.done&&(c=a.return)&&c.call(a)}finally{if(u)throw u.error}}return r.length>0?[4,this.upsertChannelsToCache(r)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}}))}))},c.prototype.markAsDelivered=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},c.prototype.getMessageFromCache=function(e){var t;return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},c.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,t,n,s){return p(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,filter:n,exactMatch:!0,isRestoreIndexedDB:s})];case 1:return[2,r.sent()]}}))}))},c.prototype.getMessagesFromCache=function(e,t,n,s,r,a,i){return void 0===r&&(r=at),void 0===a&&(a=!0),void 0===i&&(i=!1),p(this,void 0,void 0,(function(){return f(this,(function(o){switch(o.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:s,backward:"next"===n,inclusive:a,isRestoreIndexedDB:i})];case 1:return[2,o.sent()]}}))}))},c.prototype.getPollMessagesFromCache=function(e,t,n,s){return p(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:s,filter:n,backward:!1,isPollOnly:!0})];case 1:return[2,r.sent()]}}))}))},c.prototype.getCachedMessageCountBetween=function(e,t,n,s){return p(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.countBetween(e,t,new Ls({top:n,bottom:s}))];case 1:return[2,r.sent()]}}))}))},c.prototype.getUnsentMessagesFromCache=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t})];case 1:return[2,n.sent()]}}))}))},c.prototype.removeFailedMessageFromCache=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}}))}))},c}(en),Hs=function(e,t){return t instanceof $e?e.findIndex((function(e){return e instanceof $e&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},Gs=function(e,t){return e.findIndex((function(e){return e instanceof Xe?e.messageId===t:e instanceof it?e.notificationId===t:void 0}))},Vs=function(e,t){if(e.length>0){for(var n=0,s=e.length-1,r=Math.floor((n+s)/2);n<s;){var a=e[r].createdAt-t.createdAt;if(a>0)s=r,r=Math.floor((n+s)/2);else{if(!(a<0))return r;n=r+1,r=Math.floor((n+s)/2)}}return e[r].createdAt>t.createdAt?r:r+1}return e.length},Bs={},qs=function(){function e(e){var t=e._iid,n=e.channel,r=e.includeParams,a=this;this.ref=0,this._iid=t,this._channel=n,this._includeParams=r;var i,o,u=F.of(this._iid),c=u.logger,l=u.sdkState,d=u.dispatcher;this._metadataKey=(i=l.userId,o=n.url,"sendbird:".concat(i,"@groupchannel/").concat(o,"/message/changelogs.meta"));var _=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(l.userId,this._channel.url);this._sync=new Vt(_,(function(){return p(a,void 0,void 0,(function(){var e,t,n,r,a,i,o,u,l;return f(this,(function(d){switch(d.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:d.sent(),c.debug("message changelog sync from",null===(l=this._metadata)||void 0===l?void 0:l.token),d.label=2;case 2:return d.trys.push([2,5,,8]),[4,De.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,s({replyType:V.ALL},this._includeParams),E.SYNC_MESSAGE_CHANGELOGS)];case 3:return t=d.sent(),n=t.updatedMessages,r=t.deletedMessageIds,a=t.hasMore,i=t.token,o=t.forceUseNextToken,e.hasNext=a,e.nextToken=i,n.length>0||r.length>0?this._metadata&&(this._metadata.token=i):o&&this._metadata&&(this._metadata.token=i),c.debug("message changelog sync progress",e),[4,this.saveMetadata()];case 4:return d.sent(),[3,8];case 5:return u=d.sent(),c.debug("message changelog sync error",u),u instanceof h&&u.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:d.sent(),d.label=7;case 7:throw u;case 8:return[2,e]}}))}))})),this._connectionEventContext=d.on((function(e){if(e instanceof P)if(e.stateType===O.CONNECTED)a.resume();else a.pause();else e instanceof Bt&&a.resume()}))}return e.of=function(t,n,s){return Bs[t]||(Bs[t]={}),Bs[t][n.url]||(Bs[t][n.url]=new e({_iid:t,channel:n,includeParams:s})),Bs[t][n.url].ref++,Bs[t][n.url]},e.clear=function(e,t){Bs[e]&&Bs[e][t]&&(Bs[e][t].close(),delete Bs[e])},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e,t,n,s;return f(this,(function(r){switch(r.label){case 0:return this._metadata?[3,2]:(e=F.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:s=r.sent(),this._metadata={token:s?s.token:n},r.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){var e=F.of(this._iid),t=e.logger;e.sessionManager.session.hasSession&&(t.debug("message changelog sync resume()"),this._sync.start(0))},e.prototype.pause=function(){F.of(this._iid).logger.debug("message changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Bs[this._iid][this._channel.url])},e}(),zs={},Ws=function(){function e(e){var t=e._iid,n=e.channel,s=e.hasPollMessage,r=this;this.ref=0,this._iid=t,this._channel=n;var a,i,o=F.of(this._iid),u=o.logger,c=o.sdkState,l=o.dispatcher;this._metadataKey=(a=c.userId,i=n.url,"sendbird:".concat(a,"@groupchannel/").concat(i,"/poll/changelogs.meta"));var d=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(c.userId,this._channel.url);this._sync=new Vt(d,(function(){return p(r,void 0,void 0,(function(){var e,t,n,r,a,i,o,c;return f(this,(function(l){switch(l.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return l.sent(),u.debug("poll changelog sync from",null===(c=this._metadata)||void 0===c?void 0:c.token),(t=!this._metadata||!this._metadata.token)?[4,s()]:[3,3];case 2:t=!l.sent(),l.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];this._metadata||(n=F.of(this._iid).firstConnectedAt,this._metadata={token:n}),l.label=4;case 4:return l.trys.push([4,7,,10]),[4,ie.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return r=l.sent(),a=r.hasMore,i=r.token,e.hasNext=a,e.nextToken=i,this._metadata.token=i,u.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return l.sent(),[3,10];case 7:return o=l.sent(),u.debug("poll changelog sync error",o),o instanceof h&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:l.sent(),l.label=9;case 9:throw o;case 10:return[2,e]}}))}))})),this._connectionEventContext=l.on((function(e){if(e instanceof P)if(e.stateType===O.CONNECTED)r.resume();else r.pause()}))}return e.of=function(t,n,s){return zs[t]||(zs[t]={}),zs[t][n.url]||(zs[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:s})),zs[t][n.url].ref++,zs[t][n.url]},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,F.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{token:e.token}:void 0,t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){F.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){F.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete zs[this._iid][this._channel.url])},e}(),js=function(n){function s(e){var s,r,a,i,o,u,c,l,h,d,_=this;return(_=n.call(this)||this).method=N.GET,_.path="".concat(oe(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),_.params=t({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(s=e.threshold)&&void 0!==s?s:null,reverse:!0,custom_types:null!==(r=e.customTypes)&&void 0!==r?r:["*"],message_type:null!==(a=e.messageType)&&void 0!==a?a:null,include_reply_type:null!==(i=e.replyType)&&void 0!==i?i:V.NONE,include_reactions_summary:null===(o=e.includeReactions)||void 0===o||o,include_meta_array:null===(u=e.includeMetaArray)||void 0===u||u,include_thread_info:null===(c=e.includeThreadInfo)||void 0===c||c,include_parent_message_info:null===(l=e.includeParentMessageInfo)||void 0===l||l,with_sorted_meta_array:null===(h=e.includeMetaArray)||void 0===h||h,show_subchannel_messages_only:null!==(d=e.showSubchannelMessagesOnly)&&void 0!==d&&d,include_poll_details:!0,checking_continuous_messages:e.checkingContinuousMessages}),_}return e(s,n),s}(S),Qs=function(t){function n(e,n){var s,r,a,i,o,u,c=this;return(c=t.call(this,e,n)||this).isHugeGap=n.is_huge_gap,c.prevMessages=(null!==(s=n.prev_messages)&&void 0!==s?s:[]).map((function(t){return ot(e,t)})),c.prevHasMore=null!==(r=n.prev_hasmore)&&void 0!==r&&r,c.isContinuousPrevMessages=null!==(a=n.is_continuous_prev_messages)&&void 0!==a&&a,c.nextMessages=(null!==(i=n.next_messages)&&void 0!==i?i:[]).map((function(t){return ot(e,t)})),c.nextHasmore=null!==(o=n.next_hasmore)&&void 0!==o&&o,c.isContinuousNextMessages=null!==(u=n.is_continuous_next_messages)&&void 0!==u&&u,c}return e(n,t),n}(U),Ks={includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0,includeParentMessageInfo:!0};!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api"}(ws||(ws={}));var Ys,Js,Xs,Zs=function(){function e(){this._onCacheResult=te,this._onApiResult=te}return e.prototype._invokeResponse=function(e,t,n){var s=this;W((function(){return p(s,void 0,void 0,(function(){return f(this,(function(s){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),$s=function(){function e(e,t){var n=t.filter,s=t.startingPoint,r=t.limit,a=t.prevResultLimit,i=t.nextResultLimit,o=t.channel,u=t.channelManager,c=t.disableBackgroundSync,l=void 0!==c&&c,h=this;this._messages=[],this._unsentMessages=[],this._isLoadingPrevious=!1,this._isLoadingNext=!1,this._iid=e,this._key="mc-".concat(le()),this._isDisposed=!1,this.filter=null!=n?n:new Ve,this._channel=o,this._syncRange=new Ls({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof s&&Number.isFinite(s)?s:Number.MAX_SAFE_INTEGER,this._limit=r||at,this._prevResultLimit=null!=a?a:Math.floor(this._limit/2),this._nextResultLimit=null!=i?i:Math.floor(this._limit/2),this._channelManager=u;var m=F.of(this._iid).statManager;this._channelManager.subscribeChannelEvent(this._key,{onUpdate:function(e,t){var n=t.source,s=e.findIndex((function(e){return e.isIdentical(h.channel)}));s>=0&&(h._replaceChannelOfCollection(e[s]),h.channel._runIfHandleableWithGroupChannel((function(e){switch(n){case E.EVENT_CHANNEL_UPDATED:for(var s=!1,r=0;r<h._messages.length;r++){if(h._messages[r].createdAt>=e.messageOffsetTimestamp){s=!0;var a=r;if(a>0){var i=h._messages.splice(0,a);h._removeMessagesFromView(i.map((function(e){return h.keyOf(e)})),E.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!s&&h._messages.length>0&&h._removeMessagesFromView(h._messages.map((function(e){return h.keyOf(e)})),E.EVENT_MESSAGE_OFFSET_UPDATED);break;case E.EVENT_CHANNEL_UNMUTED:var o=F.of(h._iid).sdkState,u=t.user;o.userId===u.userId&&h._clearCheckMyMutedTimer();break;case E.EVENT_CHANNEL_MUTED:o=F.of(h._iid).sdkState,u=t.user;o.userId===u.userId&&-1!==e._myMutedRemainingTime&&h._startCheckMyMutedTimer(e._myMutedRemainingTime);break;case E.EVENT_CHANNEL_LEFT:e.isPublic&&h._clearCheckMyMutedTimer()}W((function(){return p(h,void 0,void 0,(function(){var e;return f(this,(function(s){return Pn(n)&&(null===(e=this._handler)||void 0===e?void 0:e.onChannelUpdated)&&this._handler.onChannelUpdated(t,this.channel),[2]}))}))}))})),h._postprocessChannelUpdateEvent(e[s],n))},onRemove:function(e,t){var n=e.indexOf(h.channel.url);n>=0&&h._channel._runIfHandleableWithGroupChannel((function(s){s.myMemberState=dn.NONE,h._clearCheckMyMutedTimer(),W((function(){return p(h,void 0,void 0,(function(){var e;return f(this,(function(n){return(null===(e=this._handler)||void 0===e?void 0:e.onChannelDeleted)&&this._handler.onChannelDeleted(t,this.channel.url),[2]}))}))})),h._postprocessChannelRemoveEvent(e[n])}))}}),this._channelManager.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,s,r=[],a=[];try{for(var i=v(e),o=i.next();!o.done;o=i.next()){var u=o.value;u.channelUrl===h._channel.url&&(h.filter.match(u)?r.push(u):a.push(h.keyOf(u)))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}if(ce(t)){if(r.length>0)switch(t){case E.LOCAL_MESSAGE_CANCELED:case E.LOCAL_MESSAGE_RESEND_STARTED:case E.EVENT_MESSAGE_SENT_FAILED:case E.EVENT_MESSAGE_SENT_SUCCESS:case E.EVENT_MESSAGE_UPDATED:case E.EVENT_MESSAGE_THREADINFO_UPDATED:case E.EVENT_MESSAGE_REACTION_UPDATED:case E.EVENT_MESSAGE_FEEDBACK_ADDED:case E.EVENT_MESSAGE_FEEDBACK_UPDATED:case E.EVENT_MESSAGE_FEEDBACK_DELETED:case E.SYNC_MESSAGE_CHANGELOGS:h._updateMessagesToView(r,t);break;case E.EVENT_MESSAGE_SENT_PENDING:h._addMessagesToView(r,t);break;case E.EVENT_MESSAGE_RECEIVED:h.hasNext||h._addMessagesToView(r,t);break;case E.SYNC_MESSAGE_FILL:h._addMessagesToView(r,t)}a.length>0&&h._removeMessagesFromView(a,t)}h._postprocessMessageUpdateEvent(e,t)},onRemove:function(e,t){h._removeMessagesFromView(e,t),h._postprocessMessageRemoveEvent(e)},onRemoveUnsent:function(e,t){h._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){h._updatePollsToView(e,t)},onPollUpdate:function(e,t){h._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){h._applyPollVoteEventToView(e,t)},onReactionUpdate:function(e,t){h._applyReactionEventToView(e,t)},onThreadInfoUpdate:function(e,t){h._applyThreadInfoEventToView(e,t)},onDeletedByRetentionPolicy:function(e,t,n){t===h.channel.url&&h._messageRetention(e,n)}});var g=F.of(this._iid),C=g.cacheContext,y=g.dispatcher,b=g.messageBackgroundSyncThrottleController;this._channel._updateMessageCollectionLastAccessedAt(),y.dispatch(new On({channels:[this._channel],context:{source:E.CHANNEL_LASTACCESSEDAT_UPDATED}})),this._backgroundSync=ks.of(this._iid,this._channel),!l&&this._shouldStartBackgroundSync()&&this._backgroundSync.resume(this._startingPoint),this._changelogSync=qs.of(this._iid,this._channel,this.changelogIncludeParams),this._changelogSync.resume(),this._pollChangelogSync=Ws.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new Vt(this._key,(function(e){return p(h,void 0,void 0,(function(){var t=this;return f(this,(function(n){switch(n.label){case 0:return[4,b.run("message-fill-sync-".concat(o.url,"-prev"),(function(){return p(t,void 0,void 0,(function(){var t,n,s,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._prevResultLimit,source:E.SYNC_MESSAGE_FILL,checkingContinuousMessages:C.localCacheEnabled,sdkSource:Le.INTERNAL_FILL_GAP})];case 1:return t=u.sent(),n=t.messages,s=t.isContinuousMessages,n.length>0?(r=Math.min.apply(Math,d([],_(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(r),s&&(null===(a=this._backgroundSync)||void 0===a||a.range.extends(r)),[2,{hasNext:n.length>=this._prevResultLimit&&this.viewTop<r,nextToken:this._syncRange.top}]):(C.localCacheEnabled&&m.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(o=null===(i=C.localCacheConfig)||void 0===i?void 0:i.maxSize)&&void 0!==o?o:0,use_local_cache:C.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}}))}))}))];case 1:return[2,n.sent()]}}))}))})),this._nextFill=new Vt(this._key,(function(e){return p(h,void 0,void 0,(function(){var t=this;return f(this,(function(n){switch(n.label){case 0:return[4,b.run("message-fill-sync-".concat(o.url,"-next"),(function(){return p(t,void 0,void 0,(function(){var t,n,s,r,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._nextResultLimit,source:E.SYNC_MESSAGE_FILL,checkingHasNext:!0,checkingContinuousMessages:C.localCacheEnabled,sdkSource:Le.INTERNAL_FILL_GAP})];case 1:return t=c.sent(),n=t.messages,s=t.isContinuousMessages,r=t.hasNext,n.length>0?(a=Math.max.apply(Math,d([],_(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(a),s&&(null===(i=this._backgroundSync)||void 0===i||i.range.extends(a)),[2,{hasNext:r,nextToken:this._syncRange.bottom}]):(C.localCacheEnabled&&m.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(u=null===(o=C.localCacheConfig)||void 0===o?void 0:o.maxSize)&&void 0!==u?u:0,use_local_cache:C.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}}))}))}))];case 1:return[2,n.sent()]}}))}))})),this._connectionEventContext=y.on((function(e){if(e instanceof P)switch(e.stateType){case O.CONNECTED:M((function(){return p(h,void 0,void 0,(function(){return f(this,(function(e){return this._activate(),[2]}))}))}));break;case O.LOGOUT:h.dispose();break;default:h._clearCheckMyMutedTimer(),h._prevFill.stop(),h._nextFill.stop()}else e instanceof Bt&&h._activate()}))}return e.prototype.keyOf=function(e){return 0},Object.defineProperty(e.prototype,"changelogIncludeParams",{get:function(){return{includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0}},enumerable:!1,configurable:!0}),e.prototype._postprocessChannelUpdateEvent=function(e,t){},e.prototype._postprocessChannelRemoveEvent=function(e){},e.prototype._postprocessMessageUpdateEvent=function(e,t){},e.prototype._postprocessMessageRemoveEvent=function(e){},Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return d([],_(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===ue.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===ue.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,d(d([],_(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,d(d([],_(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype._activate=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return F.of(this._iid).logger.debug("check huge gap"),this._checkHugeGap(),[4,this._refreshChannel(E.SYNC_CHANNEL_CHANGELOGS)];case 1:return e.sent(),[2]}}))}))},e.prototype._replaceChannelOfCollection=function(e){this._channel.isGroupChannel()?this._channel=e:this._channel.isFeedChannel()&&(this._channel._groupChannel=e._groupChannel)},e.prototype._shouldStartBackgroundSync=function(){var e=F.of(this._iid).cacheContext;return this.channel.isGroupChannel()?e.localCacheEnabled&&!this.channel.isSuper:e.localCacheEnabled},e.prototype._setBaseMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){var t;return this._channel._runIfHandleableWithGroupChannel((function(n){t=e.filter((function(e){return e.createdAt>=n.messageOffsetTimestamp}))})),void 0!==t?t:e},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach((function(n){n instanceof Xe&&n.parentMessageId===e.messageId&&n.applyParentMessage(e)&&t.push(n)})),t},e.prototype._updatePollsToView=function(e,t){var n,s,r=this,a=[];try{for(var i=v(e),o=i.next();!o.done;o=i.next()){var u=o.value,c=Gs(this._messages,u.messageId);if(c>=0){var l=this._messages[c];l.isUserMessage()&&l.applyPoll(u),a.push(l)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}return a.length>0&&ce(t)&&W((function(){return p(r,void 0,void 0,(function(){var e,n,s;return f(this,(function(r){return e={source:t},a.length>0&&(null===(s=(n=this._handler).onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,a)),[2]}))}))})),a},e.prototype._applyPollUpdateEventToView=function(e,t){var n=this,s=Gs(this._messages,e.messageId);if(s>=0){var r=this._messages[s];r&&r.isUserMessage()&&r.poll&&r.poll.applyPollUpdateEvent(e)&&ce(t)&&W((function(){return p(n,void 0,void 0,(function(){var e,n,s;return f(this,(function(a){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))}))}},e.prototype._applyPollVoteEventToView=function(e,t){var n=this,s=Gs(this._messages,e.messageId);if(s>=0){var r=this._messages[s];r&&r.isUserMessage()&&r.poll&&r.poll.applyPollVoteEvent(e)&&ce(t)&&W((function(){return p(n,void 0,void 0,(function(){var e,n,s;return f(this,(function(a){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))}))}},e.prototype._applyReactionEventToView=function(e,t){var n=this,s=Gs(this._messages,e.messageId);if(s>=0){var r=this._messages[s];r&&(r.isUserMessage()||r.isFileMessage()||r.isMultipleFilesMessage())&&ce(t)&&(r.applyReactionEvent(e),W((function(){return p(n,void 0,void 0,(function(){var e,n,s;return f(this,(function(a){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))})))}},e.prototype._applyThreadInfoEventToView=function(e,t){var n=this,s=Gs(this._messages,e.targetMessageId);if(s>=0){var r=this._messages[s];r&&(r.isUserMessage()||r.isFileMessage()||r.isMultipleFilesMessage())&&ce(t)&&(r.applyThreadInfoUpdateEvent(e),W((function(){return p(n,void 0,void 0,(function(){var e,n,s;return f(this,(function(a){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))})))}},e.prototype._removeMessagesFromView=function(e,t){var n,s,r=this,a=[],i=[],o=function(e){var t=u._messages.findIndex((function(t){return r.keyOf(t)===e}));if(t>=0){var n=u._messages[t];a.push(u.keyOf(n)),i.push(n),u._messages.splice(t,1)}},u=this;try{for(var c=v(e),l=c.next();!l.done;l=c.next()){o(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(n)throw n.error}}return ce(t)&&i.length>0&&W((function(){return p(r,void 0,void 0,(function(){var e,n,s;return f(this,(function(r){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesDeleted)||void 0===s||s.call(n,e,this.channel,a,i),[2]}))}))})),a},e.prototype._messageRetention=function(e,t){var n,s,r=[];try{for(var a=v(this._messages),i=a.next();!i.done;i=a.next()){var o=i.value;o.createdAt<=e&&r.push(this.keyOf(o))}}catch(e){n={error:e}}finally{try{i&&!i.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}r.length>0&&this._removeMessagesFromView(r,t)},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,s=void 0===n?0:n,r=t.nextLimit,a=void 0===r?0:r,i=t.inclusive,o=void 0===i||i,u=t.isRestoreIndexedDB,c=void 0!==u&&u;return p(this,void 0,void 0,(function(){var t,n,r,i,u;return f(this,(function(l){switch(l.label){case 0:return t=[],o?[4,this._channelManager.getExactlyMatchingMessagesForTokenFromCache(this._channel.url,e,this.filter,c)]:[3,2];case 1:t=l.sent(),l.label=2;case 2:return s>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"prev",this.filter,s,!1,c)]:[3,4];case 3:return r=l.sent(),[3,5];case 4:r=[],l.label=5;case 5:return n=r,a>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"next",this.filter,a,!1,c)]:[3,7];case 6:return u=l.sent(),[3,8];case 7:u=[],l.label=8;case 8:return i=u,[2,{messages:d(d(d([],_(t),!1),_(n),!1),_(i),!1).sort((function(e,t){return t.createdAt-e.createdAt})),prevMessagesCount:n.length,nextMessagesCount:i.length}]}}))}))},e.prototype._getRemoteMessages=function(e,t){var r=t.prevLimit,a=void 0===r?0:r,i=t.nextLimit,o=void 0===i?0:i,u=t.source,c=void 0===u?E.REQUEST_MESSAGE:u,l=t.reverse,h=void 0!==l&&l,d=t.checkingHasNext,_=void 0!==d&&d,v=t.checkingContinuousMessages,m=void 0!==v&&v,g=t.sdkSource;return p(this,void 0,void 0,(function(){var t,r;return f(this,(function(i){switch(i.label){case 0:return t=De.of(this._iid),a>0||o>0?[4,t._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,e,n(s(s(s({},this.filter),Ks),{isInclusive:!0,reverse:h,prevResultSize:a,nextResultSize:o})),c,_,m,g)]:[3,2];case 1:return r=i.sent(),[3,3];case 2:r={messages:[],isContinuousMessages:!1},i.label=3;case 3:return[2,r]}}))}))},e.prototype._checkHugeGap=function(){var e,t,n,r,a;return p(this,void 0,void 0,(function(){var i,o,u,c,l,v,m,g,C,y,b,M,N,A,S,U,T,I,w,D,L,x,R,k,P,O=this;return f(this,(function(V){switch(V.label){case 0:return i=F.of(this._iid),o=i.dispatcher,u=i.requestQueue,c=i.cacheContext,l=i.statManager,v=i.logger,this._messages.length>0?(m=this._syncRange.top,g=this.viewTop,C=this._syncRange.bottom,y=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,g,m)]):[3,8];case 1:return b=V.sent(),[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,C,y)];case 2:M=V.sent(),V.label=3;case 3:return V.trys.push([3,5,6,7]),[4,he((function(){return p(O,void 0,void 0,(function(){var e,t,n,r,a,i,l,h,v,N,A,S,U,T,I,w,D,L=this;return f(this,(function(x){switch(x.label){case 0:return e=new js(s(s({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:g,prevEnd:m,prevCount:b,nextStart:C,nextEnd:y,nextCount:M,checkingContinuousMessages:c.localCacheEnabled},this.filter),Ks)),[4,u.send(e)];case 1:return t=x.sent(),n=t.as(Qs),r=n.isHugeGap,a=n.prevMessages,i=void 0===a?[]:a,l=n.prevHasMore,h=n.isContinuousPrevMessages,v=n.nextMessages,N=void 0===v?[]:v,A=n.nextHasmore,S=n.isContinuousNextMessages,r?W((function(){return p(L,void 0,void 0,(function(){var e;return f(this,(function(t){return(null===(e=this._handler)||void 0===e?void 0:e.onHugeGapDetected)&&this._handler.onHugeGapDetected(),[2]}))}))})):(U=this.viewTop,T=this.viewBottom,I=Math.min.apply(Math,d([Number.MAX_SAFE_INTEGER,U],_(i.map((function(e){return e.createdAt}))),!1)),w=Math.max.apply(Math,d([0,T],_(N.map((function(e){return e.createdAt}))),!1)),o.dispatch(new $({messages:i,source:E.SYNC_MESSAGE_FILL})),o.dispatch(new $({messages:N,source:E.SYNC_MESSAGE_FILL})),this._syncRange.extends(I,w),(h||S)&&(null===(D=this._backgroundSync)||void 0===D||D.range.extends(I,w)),l&&this._prevFill.start(I),A&&this._nextFill.start(w)),[2]}}))}))}),1)];case 4:return V.sent(),[3,7];case 5:return N=V.sent(),v.debug("Failed HugeGap Check ",N),[3,7];case 6:return c.localCacheEnabled&&l.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(t=null===(e=c.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:c.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[3,13];case 8:A=Date.now(),V.label=9;case 9:return V.trys.push([9,11,12,13]),[4,this._getRemoteMessages(A,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit,source:E.SYNC_MESSAGE_FILL,checkingHasNext:!0,checkingContinuousMessages:c.localCacheEnabled,sdkSource:Le.INTERNAL_FILL_GAP})];case 10:if(S=V.sent(),U=S.messages,T=S.isContinuousMessages,I=S.hasNext,U.length>0){for(w=U.map((function(e){return e.createdAt})),D=0,L=0,x=0;x<w.length;x++)(R=w[x])<=A?D++:R>=A&&L++;this._hasPrevious=D>=this._prevResultLimit,this._hasNext=null!=I?I:L>=this._nextResultLimit,(P=this._syncRange).extends.apply(P,d([],_(w),!1)),T&&(null===(n=this._backgroundSync)||void 0===n||n.range.extends(this._syncRange.top,this._syncRange.bottom)),this._addMessagesToView(U,E.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;return[3,13];case 11:return(k=V.sent())instanceof h&&k.code===re.NOT_FOUND_IN_DATABASE&&(this._hasPrevious=!1,this._hasNext=!1),[3,13];case 12:return c.localCacheEnabled&&l.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(a=null===(r=c.localCacheConfig)||void 0===r?void 0:r.maxSize)&&void 0!==a?a:0,use_local_cache:c.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 13:return[2]}}))}))},e.prototype._loadUnsentMessages=function(){return p(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return e=this,[4,this._channelManager.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return e._unsentMessages=t.sent(),[2]}}))}))},e.prototype._hasPollMessage=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._channelManager.getPollMessagesFromCache(this._channel.url,Date.now()+6e5,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}}))}))},e.prototype._refreshChannel=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n,s,r=this;return f(this,(function(a){switch(a.label){case 0:n=F.of(this._iid).logger,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._channelManager.refreshChannel(this.channel.url,!0,e,t)];case 2:return a.sent(),this.channel._runIfHandleableWithGroupChannel((function(e){e.myMutedState===Y.MUTED&&M((function(){return p(r,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(e=t.sent()).isMuted&&-1!==e.remainingDuration&&this._startCheckMyMutedTimer(e.remainingDuration),[2]}}))}))}))})),[3,4];case 3:return s=a.sent(),n.warn("Failed to refresh channel",s),[3,4];case 4:return[2]}}))}))},e.prototype._startCheckMyMutedTimer=function(e){var t=this;this._clearCheckMyMutedTimer(),this._checkMyMutedStateTimer=setTimeout((function(){return p(t,void 0,void 0,(function(){var e,t,n,s=this;return f(this,(function(r){switch(r.label){case 0:this._checkMyMutedStateTimer=void 0,e=!0,r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this._channel.getMyMutedInfo()];case 2:return t=r.sent(),e=!t.isMuted,[3,5];case 3:return r.sent(),e=!0,[3,5];case 4:return e&&(n=F.of(this._iid).sessionManager,this.channel._runIfHandleableWithGroupChannel((function(e){var t,r;e.myMutedState=Y.UNMUTED;var a={source:E.EVENT_CHANNEL_UNMUTED,user:n.currentUser};null===(r=null===(t=s._handler)||void 0===t?void 0:t.onChannelUpdated)||void 0===r||r.call(t,a,s.channel)}))),[7];case 5:return[2]}}))}))}),e+1e3)},e.prototype._clearCheckMyMutedTimer=function(){this._checkMyMutedStateTimer&&(clearTimeout(this._checkMyMutedStateTimer),this._checkMyMutedStateTimer=void 0)},e.prototype._setHasNextAndHasPrevious=function(e,t){for(var n=e.map((function(e){return e.createdAt})),s=0,r=0,a=0;a<n.length;a++){var i=n[a];i<this._startingPoint?s++:i>this._startingPoint&&r++}this._hasPrevious=s>=this._prevResultLimit,this._hasNext=null!=t?t:r>=this._nextResultLimit},e.prototype.initialize=function(e){var t=this,n=new Zs;this._messages=[],this._unsentMessages=[],this._syncRange=new Ls({}),this._hasNext=!0,this._hasPrevious=!0;var s=[],r={messages:[],prevMessagesCount:0,nextMessagesCount:0};return W((function(){return p(t,void 0,void 0,(function(){var t,a,i,o,u,c=this;return f(this,(function(l){switch(l.label){case 0:return[4,null===(u=this._backgroundSync)||void 0===u?void 0:u.loadMetadata()];case 1:if(t=l.sent(),a=F.of(this._iid),i=a.cacheContext,o=a.statManager,e===ws.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit,isRestoreIndexedDB:!0}).then((function(e){return p(c,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return r=e,s=this._filterUnderOffsetMessage(r.messages),this._addMessagesToView(s,E.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return t.sent(),n._invokeResponse("local",null,s),[2]}}))}))})).catch((function(e){if(q(e))throw e;n._invokeResponse("local",e,null)})).finally((function(){return p(c,void 0,void 0,(function(){var a,i,u,c,l,h,p,v=this;return f(this,(function(f){switch(f.label){case 0:return a=F.of(this._iid).cacheContext,i=!0,u=!0,c=!1,a.localCacheEnabled&&(s.length>0&&(l=t.range).includes.apply(l,d([],_(s.map((function(e){return e.createdAt}))),!1))?!t.previousComplete&&r.prevMessagesCount<this._prevResultLimit?u=!0:this._startingPoint>t.range.bottom||r.nextMessagesCount<this._nextResultLimit?c=!0:u=!1:0===s.length&&(c=!0)),[4,this._refreshChannel(E.REFRESH_CHANNEL,c)];case 1:return f.sent(),c&&this._channel._runIfHandleableWithGroupChannel((function(e){var t=Math.max.apply(Math,d([],_(s.map((function(e){return e.createdAt}))),!1));e._latestMessageInfo&&t>=e._latestMessageInfo.createdAt&&(u=!1)})),u?(i=!1,this._getRemoteMessages(this._startingPoint,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:a.localCacheEnabled,sdkSource:Le.EXTERNAL_COLLECTION}).then((function(e){var t,s,r,a=e.messages,i=e.isContinuousMessages,o=e.hasNext,u=v._filterUnderOffsetMessage(a);v._messages=[],u.length>0?(v._setHasNextAndHasPrevious(u,o),(t=v._syncRange).extends.apply(t,d([],_(u.map((function(e){return e.createdAt}))),!1)),i&&(null===(s=v._backgroundSync)||void 0===s?void 0:s.range.overlap(v._syncRange))&&(null===(r=v._backgroundSync)||void 0===r||r.range.extends(v._syncRange.top,v._syncRange.bottom)),v._addMessagesToView(u,E.REQUEST_MESSAGE)):(v._hasPrevious=!1,v._hasNext=!1),n._invokeResponse("remote",null,u)})).catch((function(e){if(q(e))throw e;n._invokeResponse("remote",e,null)}))):(this._setHasNextAndHasPrevious(s),n._invokeResponse("remote",null,s)),a.localCacheEnabled&&o.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"initial_load",event:i?"cache_hit":"cache_miss",max_db_size:null!==(p=null===(h=a.localCacheConfig)||void 0===h?void 0:h.maxSize)&&void 0!==p?p:0,message_init_policy:e,use_local_cache:a.localCacheEnabled,collection_id:this._key}})),[2]}}))}))}));return o.put(new de({type:G.FEATURE_LOCALCACHE,data:{use_local_cache:i.localCacheEnabled,collection_interface:{message_init_policy:e,message:!0}}})),[2]}}))}))})),n},e.prototype.loadPrevious=function(){var e,t,n;return p(this,void 0,void 0,(function(){var s,r,a,i,o,u,c,l,v=this;return f(this,(function(m){switch(m.label){case 0:if(this._isDisposed)throw new h({code:re.COLLECTION_DISPOSED,message:"Collection has been disposed."});return s=F.of(this._iid),r=s.cacheContext,a=s.statManager,i=s.logger,this._hasPrevious?this._isLoadingPrevious?(i.warn("Messages are already fetching."),[2,[]]):(this._isLoadingPrevious=!0,o=this.viewTop,u=[],[4,M((function(){return p(v,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,this._getLocalMessages(o,{prevLimit:this._prevResultLimit,inclusive:!1})];case 1:return e=t.sent(),u=this._filterUnderOffsetMessage(e.messages),[2]}}))}))}))]):[2,[]];case 1:return m.sent(),c=u.length>=this._prevResultLimit,r.localCacheEnabled&&a.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:c?"cache_hit":"cache_miss",max_db_size:null!==(t=null===(e=r.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:r.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),c&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(u))?[3,3]:(l=!1,[4,M((function(){return p(v,void 0,void 0,(function(){var e,t,n,s,r,i,c,h=this;return f(this,(function(p){switch(p.label){case 0:return e=F.of(this._iid).cacheContext,[4,this._getRemoteMessages(o,{prevLimit:this._prevResultLimit,reverse:!0,checkingContinuousMessages:e.localCacheEnabled,sdkSource:Le.EXTERNAL_COLLECTION})];case 1:return t=p.sent(),(u=this._filterUnderOffsetMessage(t.messages)).length>0&&((n=this._syncRange).extends.apply(n,d([],_(u.map((function(e){return e.createdAt}))),!1)),(null===(s=this._backgroundSync)||void 0===s?void 0:s.range.overlap(this._syncRange))&&t.isContinuousMessages&&(l=!0,null===(r=this._backgroundSync)||void 0===r||r.range.extends(this._syncRange.top))),u=u.filter((function(e){return Hs(h._messages,e)<0})),this._hasPrevious=u.length>=this._prevResultLimit,e.localCacheEnabled&&l&&a.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:"cache_fetch",max_db_size:null!==(c=null===(i=e.localCacheConfig)||void 0===i?void 0:i.maxSize)&&void 0!==c?c:0,use_local_cache:e.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}}))}))}))]);case 2:return m.sent(),this._addMessagesToView(u,E.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=u.length>=this._prevResultLimit,u.length>0&&this._addMessagesToView(u,E.REQUEST_MESSAGE),m.label=4;case 4:return this._isLoadingPrevious=!1,[2,u]}}))}))},e.prototype.loadNext=function(){var e,t,n;return p(this,void 0,void 0,(function(){var s,r,a,i,o,u,c,l,v=this;return f(this,(function(m){switch(m.label){case 0:if(this._isDisposed)throw new h({code:re.COLLECTION_DISPOSED,message:"Collection has been disposed."});return s=F.of(this._iid),r=s.cacheContext,a=s.statManager,i=s.logger,this._hasNext?this._isLoadingNext?(i.warn("Messages are already fetching."),[2,[]]):(this._isLoadingNext=!0,o=this.viewBottom,u=[],[4,M((function(){return p(v,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,this._getLocalMessages(o,{nextLimit:this._nextResultLimit,inclusive:!1})];case 1:return e=t.sent(),u=this._filterUnderOffsetMessage(e.messages),[2]}}))}))}))]):[2,[]];case 1:return m.sent(),c=u.length>=this._nextResultLimit,r.localCacheEnabled&&a.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:c?"cache_hit":"cache_miss",max_db_size:null!==(t=null===(e=r.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:r.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),c&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(u))?[3,3]:(l=!1,[4,M((function(){return p(v,void 0,void 0,(function(){var e,t,n,s,r,i,c,h,p=this;return f(this,(function(f){switch(f.label){case 0:return e=F.of(this._iid).cacheContext,[4,this._getRemoteMessages(o,{nextLimit:this._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:e.localCacheEnabled,sdkSource:Le.EXTERNAL_COLLECTION})];case 1:return t=f.sent(),(u=this._filterUnderOffsetMessage(t.messages)).length>0&&((n=this._syncRange).extends.apply(n,d([],_(u.map((function(e){return e.createdAt}))),!1)),(null===(s=this._backgroundSync)||void 0===s?void 0:s.range.overlap(this._syncRange))&&t.isContinuousMessages&&(l=!0,null===(r=this._backgroundSync)||void 0===r||r.range.extends(this._syncRange.bottom))),u=u.filter((function(e){return Hs(p._messages,e)<0})),this._hasNext=null!==(i=t.hasNext)&&void 0!==i?i:u.length>=this._nextResultLimit,e.localCacheEnabled&&l&&a.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:"cache_fetch",max_db_size:null!==(h=null===(c=e.localCacheConfig)||void 0===c?void 0:c.maxSize)&&void 0!==h?h:0,use_local_cache:e.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}}))}))}))]);case 2:return m.sent(),this._addMessagesToView(u,E.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=u.length>=this._nextResultLimit,u.length>0&&this._addMessagesToView(u,E.REQUEST_MESSAGE),m.label=4;case 4:return this._isLoadingNext=!1,[2,u]}}))}))},e.prototype.removeFailedMessage=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:if(this._isDisposed)throw new h({code:re.COLLECTION_DISPOSED,message:"Collection has been disposed."});return[4,this._channelManager.removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},e.prototype.dispose=function(){var e,t,n,s=this;if(!this._isDisposed){this._isDisposed=!0;var r=F.of(this._iid),a=r.cacheContext,i=r.dispatcher;this._messages=[],this._clearCheckMyMutedTimer(),this._channel._runIfHandleableWithGroupChannel((function(e){e.myMemberState!==dn.NONE&&(s._channel._updateMessageCollectionLastAccessedAt(),i.dispatch(new On({channels:[s._channel],context:{source:E.CHANNEL_LASTACCESSEDAT_UPDATED}})))})),a.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._pollChangelogSync)||void 0===n||n.close(),this._channelManager.unsubscribeChannelEvent(this._key),this._channelManager.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}},e}(),er=function(t){function n(e,n){return t.call(this,e,s(s({},n),{channelManager:Os.of(e)}))||this}return e(n,t),n.prototype.keyOf=function(e){return e.messageId},n.prototype.initialize=function(e){return t.prototype.initialize.call(this,e)},n.prototype.setMessageCollectionHandler=function(e){this._setBaseMessageCollectionHandler(e)},n.prototype._addMessagesToView=function(e,t){var n,s,r=this,a=this._filterUnderOffsetMessage(e),i=[],o=[];try{for(var u=v(a),c=u.next();!c.done;c=u.next()){var l=c.value;if(t===E.SYNC_MESSAGE_FILL){if(l.messageId>0){if((C=Hs(this._messages,l))<0){Hs(this._unsentMessages,l)<0&&i.push(l);var h=Vs(this._messages,l);this._messages.splice(h,0,l)}}else if(l instanceof $e){(C=Hs(this._unsentMessages,l))<0&&Hs(this._messages,l)<0&&(this._unsentMessages.push(l),i.push(l))}}else if(l.messageId>0){if((C=Hs(this._messages,l))<0){var m=Hs(this._unsentMessages,l);m<0?i.push(l):(this._unsentMessages.splice(m,1),o.push(l));h=Vs(this._messages,l);this._messages.splice(h,0,l)}else o.push(l),this._messages[C]=l;if(l.updatedAt>0){var g=this._updateChildMessagesInView(l);o.push.apply(o,d([],_(g),!1))}}else if(l instanceof $e){var C;(C=Hs(this._unsentMessages,l))<0?Hs(this._messages,l)<0&&(this._unsentMessages.push(l),i.push(l)):(o.push(l),this._unsentMessages[C]=l)}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}ce(t)&&W((function(){return p(r,void 0,void 0,(function(){var e,n,s,r,a;return f(this,(function(u){return e={source:t},i.length>0&&(null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesAdded)||void 0===s||s.call(n,e,this.channel,i)),o.length>0&&(null===(a=null===(r=this._handler)||void 0===r?void 0:r.onMessagesUpdated)||void 0===a||a.call(r,e,this.channel,o)),[2]}))}))}))},n.prototype._updateMessagesToView=function(e,t){var n,s,r=this,a=[],i=[],o=[];try{for(var u=v(e),c=u.next();!c.done;c=u.next()){var l,h=c.value;if(h.messageId>0)if((l=Hs(this._messages,h))>=0)i.push(h),this._messages[l]=h;else{var m=Hs(this._unsentMessages,h);if(m>=0){var g=_(this._unsentMessages.splice(m,1),1)[0];if(this.hasNext&&g)o.push(g);else{i.push(h);var C=Vs(this._messages,h);this._messages.splice(C,0,h)}}else{var y=this._messages.map((function(e){return e.createdAt}));(h.createdAt<Math.min.apply(Math,d([],_(y),!1))&&!this._hasPrevious||h.createdAt>Math.max.apply(Math,d([],_(y),!1))&&!this._hasNext)&&a.push(h)}}else if(h instanceof $e)(l=Hs(this._unsentMessages,h))>=0&&(i.push(h),this._unsentMessages[l]=h)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}return ce(t)&&W((function(){return p(r,void 0,void 0,(function(){var e,n,s,r,u;return f(this,(function(c){return e={source:t},i.length>0?null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,i):o.length>0?null===(u=null===(r=this._handler)||void 0===r?void 0:r.onMessagesDeleted)||void 0===u||u.call(r,e,this.channel,[],o):a.length>0&&this._addMessagesToView(a,t),[2]}))}))})),i},n}($s),tr={coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isPublic:void 0,isDiscoverable:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},nr=function(t){function n(e){var n=this,s=e.channelUrl,r=e.token,a=e.limit,i=e.order,o=e.mutedMemberFilter,u=e.memberStateFilter,c=e.nicknameStartsWithFilter,l=e.operatorFilter;return(n=t.call(this)||this).method=N.GET,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/members"),n.params={token:r,limit:a,order:i,muted_member_filter:o,member_state_filter:u,nickname_startswith:c,operator_filter:l,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return e(n,t),n}(S),sr=function(t){function n(e,n){var s=t.call(this,e,n)||this;s.members=[];var r=n.next,a=n.members;return s.token=r,a&&a.length>0&&(s.members=a.map((function(t){return new En(e,t)}))),s}return e(n,t),n}(U);!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(Ys||(Ys={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(Js||(Js={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(Xs||(Xs={}));var rr=function(t){function a(e,n,s){var r,a,o,u,c=this;return(c=t.call(this,e,n,i.GROUP,s)||this).mutedMemberFilter=Ys.ALL,c.memberStateFilter=Xs.ALL,c.nicknameStartsWithFilter=null,c.operatorFilter=gn.ALL,c.order=Js.MEMBER_NICKNAME_ALPHABETICAL,c.mutedMemberFilter=null!==(r=s.mutedMemberFilter)&&void 0!==r?r:Ys.ALL,c.memberStateFilter=null!==(a=s.memberStateFilter)&&void 0!==a?a:Xs.ALL,c.nicknameStartsWithFilter=null!==(o=s.nicknameStartsWithFilter)&&void 0!==o?o:null,c.order=null!==(u=s.order)&&void 0!==u?u:Js.MEMBER_NICKNAME_ALPHABETICAL,c}return e(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&r(Ys,this.mutedMemberFilter)&&r(Xs,this.memberStateFilter)&&(g("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&r(gn,this.operatorFilter)&&r(Js,this.order)},a.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=F.of(this._iid).requestQueue,t=new nr(n(s(s({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=u.sent(),a=r.as(sr),i=a.members,o=a.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw h.queryInProgress;case 4:return[3,6];case 5:throw h.invalidParameters;case 6:return[2]}}))}))},a}(_e),ar=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,a=e.accessCode;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/accept"),n.params={user_id:r,access_code:a},n}return e(n,t),n}(S),ir=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new Jr(e,n),s.channel.myMemberState=dn.JOINED,s}return e(n,t),n}(U),or=function(n){function s(e){var s=this,r=e.channelUrl,a=e.isDistinct,i=e.isPublic,o=e.isDiscoverable,u=e.coverUrl,c=e.coverImage,l=e.accessCode,h=e.name,d=e.data,_=e.customType,p=e.operatorUserIds,f=e.messageSurvivalSeconds;return(s=n.call(this)||this).method=N.PUT,s.path="".concat(I,"/").concat(encodeURIComponent(r)),s.params=t({is_distinct:a,is_public:i,is_discoverable:o,name:h,data:d,custom_type:_,cover_url:u,cover_file:c,access_code:l,operator_ids:p,message_survival_seconds:f}),s}return e(s,n),s}(S),ur=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new Jr(e,n),s}return e(n,t),n}(U),cr=function(t){function n(e){var n=this,s=e.channelUrl;return(n=t.call(this)||this).method=N.DELETE,n.path="".concat(I,"/").concat(encodeURIComponent(s)),n}return e(n,t),n}(S);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(U);var lr=function(t){function n(e){var n=this,s=e.channelUrl;return(n=t.call(this)||this).method=N.DELETE,n.path="".concat(I,"/").concat(encodeURIComponent(s),"/hide"),n}return e(n,t),n}(S);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(U);var hr=function(t){function n(e){var n=e.userId,s=e.channelUrl,r=e.countPreference,a=t.call(this)||this;return a.method=N.PUT,a.path="".concat(A,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(s)),a.params={count_preference:r},a}return e(n,t),n}(S),dr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.countPreference=n.count_preference,s}return e(n,t),n}(U),_r=function(n){function s(e){var s=this,r=e.channelUrl,a=e.locale;return(s=n.call(this)||this).method=N.PUT,s.path="".concat(I,"/").concat(encodeURIComponent(r),"/reset_user_history"),s.params=t({locale:a}),s}return e(s,n),s}(S),pr=function(t){function n(e,n){var s=t.call(this,e,n)||this,r=n.ts_message_offset;return s.messageOffsetTimestamp=r,s}return e(n,t),n}(U),fr=s(s({},ut),{scheduledAt:void 0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),vr=s(s({},lt),{scheduledAt:void 0}),mr=function(s){function r(e){var r,a,i=this;i=s.call(this)||this;var o=[];e.mentionType===pe.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map((function(e){return e.userId}))));var u=e.channelType,c=e.channelUrl,l=e.scheduledMessageId;return i.method=N.PUT,i.path="".concat(oe(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),i.params=t(n({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:fe.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:null===(r=e._thumbnails)||void 0===r?void 0:r.map((function(e){return dt.payloadify(e)})),custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(a=e.metaArrays)||void 0===a?void 0:a.map((function(e){return _t.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?pt.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption})),i}return e(r,s),r}(S),gr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.message=new Oe(e,n),s}return e(n,t),n}(U),Cr=function(s){function r(e){var r,a=this;a=s.call(this)||this;var i=[];e.mentionType===pe.USERS&&(e.mentionedUserIds?i=e.mentionedUserIds:e.mentionedUsers&&(i=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl,c=e.scheduledMessageId;return a.method=N.PUT,a.path="".concat(oe(o),"/").concat(encodeURIComponent(u),"/scheduled_messages/").concat(encodeURIComponent(c)),a.params=t(n({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:fe.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(r=e.metaArrays)||void 0===r?void 0:r.map((function(e){return _t.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?pt.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),a}return e(r,s),r}(S);!function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.message=new Pe(e,n),s}e(n,t)}(U);var yr,Er,br=function(t){function n(e){var n=t.call(this)||this,s=e.channelType,r=e.channelUrl,a=e.scheduledMessageId;return n.method=N.DELETE,n.path="".concat(oe(s),"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(a)),n}return e(n,t),n}(S),Mr=function(t){function n(e){var n=t.call(this)||this,s=e.channelType,r=e.channelUrl,a=e.scheduledMessageId;return n.method=N.POST,n.path="".concat(oe(s),"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(a),"/send_now"),n}return e(n,t),n}(S),Nr=function(t){function n(e){var n=e.userId,s=e.channelUrl,r=e.pushTriggerOption,a=t.call(this)||this;return a.method=N.PUT,a.path="".concat(A,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(s)),a.params={push_trigger_option:r},a}return e(n,t),n}(S),Ar=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.pushTriggerOption=n.push_trigger_option,s.enabled=n.enable,s}return e(n,t),n}(U),Sr=function(t){function n(e){var n=e.userId,s=e.channelUrl,r=t.call(this)||this;return r.method=N.GET,r.path="".concat(A,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(s)),r}return e(n,t),n}(S),Ur=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.pushTriggerOption=n.push_trigger_option,s.enabled=n.enable,s}return e(n,t),n}(U),Tr=function(t){function n(e){var n=this,s=e.channelUrl,r=e.channelType;return(n=t.call(this)||this).method=N.GET,n.path="".concat(oe(r),"/").concat(encodeURIComponent(s),"/message_purge_offset"),n}return e(n,t),n}(S),Ir=function(t){function n(e,n){var s=t.call(this,e,n)||this,r=n.message_purge_offset;return s.messageDeletionTimestamp=r,s}return e(n,t),n}(U),wr=function(){function e(e){this.url=e.channel_url,this.lastMessageTs=e.last_message_ts}return e.payloadify=function(e){return{channel_url:e.url,last_message_ts:e.lastMessageTs}},e}(),Dr=function(){function e(e){var t,n,s,r;this.type=e.type,this.ticketId=null!==(t=e.ticket_id)&&void 0!==t?t:void 0,this.timestamp=null!==(n=e.timestamp)&&void 0!==n?n:void 0,this.estimatedAgentJoinAt=null!==(s=e.estimated_agent_join_at)&&void 0!==s?s:void 0,this.requestedAt=null!==(r=e.requested_at)&&void 0!==r?r:void 0}return e.payloadify=function(e){return t({type:e.type,ticket_id:e.ticketId,timestamp:e.timestamp,estimated_agent_join_at:e.estimatedAgentJoinAt,requested_at:e.requestedAt})},e}(),Lr=function(){function e(e){this.isResolved=e.is_resolved,this.determinedBy=e.determined_by}return e.payloadify=function(e){return{is_resolved:e.isResolved,determined_by:e.determinedBy}},e}();!function(e){e.DEFAULT="default",e.PROACTIVE="proactive"}(yr||(yr={})),function(e){e.OPEN="open",e.CLOSED="closed"}(Er||(Er={}));var xr,Rr,kr=function(){function e(e){var t,n,s,r,a,i;this.id=e.id,this.aiAgentId=e.ai_agent_id,this.type=e.conversation_type,this.status=e.status,this.channelInfo=new wr(e.channel),this.summary=null!==(t=e.summary_text)&&void 0!==t?t:void 0,this.csat=null!==(n=e.csat)&&void 0!==n?n:void 0,this.csatReason=null!==(s=e.csat_reason)&&void 0!==s?s:void 0,this.csatExpireAt=null!==(r=e.csat_expire_at)&&void 0!==r?r:void 0,this.resolution=e.resolution?new Lr(e.resolution):void 0,this.topics=null!==(a=e.topics)&&void 0!==a?a:[],this.handoff=e.handoff?new Dr(e.handoff):void 0,this.handedOverAt=null!==(i=e.handed_over_at)&&void 0!==i?i:void 0}return e.payloadify=function(e){return t(n({id:e.id,ai_agent_id:e.aiAgentId,conversation_type:e.type,status:e.status,channel:wr.payloadify(e.channelInfo),summary_text:e.summary,csat:e.csat,csat_reason:e.csatReason,csat_expire_at:e.csatExpireAt,resolution:e.resolution&&Lr.payloadify(e.resolution),topics:e.topics,handoff:e.handoff&&Dr.payloadify(e.handoff),handed_over_at:e.handedOverAt}))},e}(),Fr=function(n){function s(e){var s=this,r=e.channelUrl;return(s=n.call(this)||this).method=N.POST,s.path="".concat(ve,"/").concat(encodeURIComponent(r),"/submit_csat"),s.params=t({csat:e.csat,csat_reason:e.csatReason,csat_type:e.csatType,is_resolved:e.isResolved,resolution_score:e.resolutionScore,csat_started_at:e.csatStartedAt}),s}return e(s,n),s}(S),Pr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.conversation=new kr(n.conversation),s}return e(n,t),n}(U),Or=function(t){function n(e){var n=this,s=e.channelUrl;return(n=t.call(this)||this).method=N.POST,n.path="".concat(ve,"/").concat(encodeURIComponent(s),"/handoff"),n.params={},n}return e(n,t),n}(S),Hr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.conversation=new kr(n.conversation),s}return e(n,t),n}(U),Gr=function(t){function n(e){var n=this,s=e.channelUrl;return(n=t.call(this)||this).method=N.POST,n.path="".concat(ve,"/").concat(encodeURIComponent(s),"/close_conversation"),n.params={},n}return e(n,t),n}(S),Vr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.conversation=new kr(n.conversation),s}return e(n,t),n}(U),Br=function(s){function r(e){var r=e.aiAgentId,a=e.channelUrl,i=e.context,o=s.call(this)||this;return o.method=N.PUT,o.path="".concat(me,"/ai_agents/").concat(encodeURIComponent(r),"/channels/").concat(encodeURIComponent(a),"/ai_agent_context"),o.params=t(n({context:i})),o}return e(r,s),r}(S),qr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.contextObject=n,s}return e(n,t),n}(U),zr=function(t){function n(e){var n=e.aiAgentId,s=e.channelUrl,r=t.call(this)||this;return r.method=N.GET,r.path="".concat(me,"/ai_agents/").concat(encodeURIComponent(n),"/channels/").concat(encodeURIComponent(s),"/ai_agent_context"),r}return e(n,t),n}(S),Wr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.contextObject=n,s}return e(n,t),n}(U),jr=function(s){function r(e){var r=e.aiAgentId,a=e.channelUrl,i=e.context,o=s.call(this)||this;return o.method=N.PATCH,o.path="".concat(me,"/ai_agents/").concat(encodeURIComponent(r),"/channels/").concat(encodeURIComponent(a),"/ai_agent_context"),o.params=t(n({context:i})),o}return e(r,s),r}(S),Qr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.contextObject=n,s}return e(n,t),n}(U),Kr=function(){function e(e){this.type=e.type,this.ticketStatus=e.ticket_status}return e.payloadify=function(e){return t({type:e.type,ticket_status:e.ticketStatus})},e}();!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(xr||(xr={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(Rr||(Rr={}));var Yr,Jr=function(u){function c(e,t){var n,c,l,h,p,f,v,m,C,y,E,b,M,N,A,S,U,T,I,w,D,L=this;return(L=u.call(this,e,t)||this)._unreadMemberStateMap=new Map,L._undeliveredMemberStateMap=new Map,L._typingStatus=new Map,L._lastMemberCountUpdated=0,L._typingStarted=0,L._typingEnded=0,L._aiAgentAdditionalData={},L.isDistinct=!1,L.isSuper=!1,L.isBroadcast=!1,L.isExclusive=!1,L.isPublic=!1,L.isDiscoverable=!0,L.isChatNotification=!1,L.isAccessCodeRequired=!1,L.isPushEnabled=!1,L.unreadMessageCount=0,L.unreadMentionCount=0,L.totalUnreadReplyCount=0,L.members=[],L.memberCount=0,L.joinedMemberCount=0,L.hiddenState=Rr.UNHIDDEN,L.lastMessage=null,L.messageOffsetTimestamp=0,L.messageSurvivalSeconds=-1,L.myMemberState=dn.NONE,L.myRole=a.NONE,L.myMutedState=Y.UNMUTED,L.myLastRead=0,L.myCountPreference=xr.ALL,L.myPushTriggerOption=ye.DEFAULT,L.inviter=null,L.invitedAt=0,L.joinedAt=0,L.lastPinnedMessage=null,L.conversation=null,L.helpdeskInfo=null,L._latestMessageInfo=null,L._pinnedMessagesUpdatedAt=0,L._myMutedRemainingTime=-1,L._messageDeletionTimestamp=0,L.channelType=i.GROUP,L.isDistinct=null!==(c=t.is_distinct)&&void 0!==c&&c,L.isSuper=null!==(l=t.is_super)&&void 0!==l&&l,L.isBroadcast=null!==(h=t.is_broadcast)&&void 0!==h&&h,L.isExclusive=null!==(p=t.is_exclusive)&&void 0!==p&&p,L.isPublic=null!==(f=t.is_public)&&void 0!==f&&f,L.isDiscoverable=null!==(v=t.is_discoverable)&&void 0!==v?v:L.isPublic,L.isChatNotification=null!==(m=t.is_chat_notification)&&void 0!==m&&m,L.isAccessCodeRequired=null!==(C=t.is_access_code_required)&&void 0!==C&&C,L.isPushEnabled=null!==(y=t.is_push_enabled)&&void 0!==y&&y,Array.isArray(t.members)&&(n=L.members).push.apply(n,d([],_(t.members.map((function(e){return new En(L._iid,e)}))),!1)),L.memberCount=null!==(E=t.member_count)&&void 0!==E?E:0,L.joinedMemberCount=null!==(b=t.joined_member_count)&&void 0!==b?b:0,L.hiddenState=r(Rr,t.hidden_state)?t.hidden_state:Rr.UNHIDDEN,L.messageOffsetTimestamp=null!==(M=t.ts_message_offset)&&void 0!==M?M:0,L.messageSurvivalSeconds=null!==(N=t.message_survival_seconds)&&void 0!==N?N:-1,L.lastMessage=t.last_message?ot(L._iid,s({channel_type:L.channelType},t.last_message)):null,t.read_receipt&&Object.keys(t.read_receipt).forEach((function(e){g("number",t.read_receipt[e])&&L._updateUnreadMemberState(e,t.read_receipt[e])})),t.delivery_receipt&&Object.keys(t.delivery_receipt).forEach((function(e){g("number",t.delivery_receipt[e])&&L._updateUndeliveredMemberState(e,t.delivery_receipt[e])})),L.myMemberState=r(dn,t.member_state)?t.member_state:dn.NONE,L.myRole=r(a,t.my_role)?t.my_role:a.NONE,r(Y,t.is_muted)?L.myMutedState=t.is_muted:g("boolean",t.is_muted)?L.myMutedState=t.is_muted?Y.MUTED:Y.UNMUTED:L.myMutedState=Y.UNMUTED,L.myCountPreference=r(xr,t.count_preference)?t.count_preference:xr.ALL,L.myPushTriggerOption=r(ye,t.push_trigger_option)?t.push_trigger_option:ye.ALL,L.myLastRead=null!==(A=t.user_last_read)&&void 0!==A?A:0,L.inviter=t.inviter?new o(L._iid,t.inviter):null,L.invitedAt=null!==(S=t.invited_at)&&void 0!==S?S:0,L.joinedAt=null!==(U=t.joined_ts)&&void 0!==U?U:0,L._updateUnreadCount(null!==(T=t.unread_message_count)&&void 0!==T?T:0,null!==(I=t.unread_mention_count)&&void 0!==I?I:0),L.totalUnreadReplyCount=null!==(w=t.total_unread_thread_message_count)&&void 0!==w?w:0,L.lastPinnedMessage=t.latest_pinned_message?ot(L._iid,s({channel_type:L.channelType},t.latest_pinned_message)):null,L.conversation=t.conversation?new kr(t.conversation):null,L.helpdeskInfo=t.helpdesk_info?new Kr(t.helpdesk_info):null,t.latest_message&&(L._latestMessageInfo={messageId:t.latest_message.message_id,createdAt:t.latest_message.created_at}),L._aiAgentAdditionalData={hasBot:t.has_bot,hasAIBot:t.has_ai_bot,isAIAgent:t.is_ai_agent_channel,isDesk:t.is_desk_channel},L._messageDeletionTimestamp=null!==(D=t.message_purge_offset)&&void 0!==D?D:0,L}return e(c,u),Object.defineProperty(c.prototype,"isHidden",{get:function(){return this.hiddenState!==Rr.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isTyping",{get:function(){return this._typingStatus.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var s=v(this._unreadMemberStateMap),r=s.next();!r.done;r=s.next()){var a=_(r.value,2),i=a[0],o=a[1];n[i]=o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var s=v(this._undeliveredMemberStateMap),r=s.next();!r.done;r=s.next()){var a=_(r.value,2),i=a[0],o=a[1];n[i]=o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hasBot",{get:function(){return!!this._aiAgentAdditionalData.hasBot},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hasAiBot",{get:function(){return!!this._aiAgentAdditionalData.hasAIBot},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isDesk",{get:function(){return!!this._aiAgentAdditionalData.isDesk},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isAIAgent",{get:function(){return!!this._aiAgentAdditionalData.isAIAgent},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"messageDeletionTimestamp",{get:function(){return this._messageDeletionTimestamp},enumerable:!1,configurable:!0}),c.payloadify=function(e,r){var a,i,c,l;void 0===r&&(r=!1);var h=s(s({},u.payloadify.call(this,e,r)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,total_unread_thread_message_count:e.totalUnreadReplyCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return En.payloadify(e)})),last_message:e.lastMessage?ft(e.lastMessage):null,inviter:e.inviter?o.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt,latest_pinned_message:e.lastPinnedMessage?ft(e.lastPinnedMessage):null,latest_message:e._latestMessageInfo?{message_id:e._latestMessageInfo.messageId,created_at:e._latestMessageInfo.createdAt}:null,has_bot:null===(a=e._aiAgentAdditionalData)||void 0===a?void 0:a.hasBot,has_ai_bot:null===(i=e._aiAgentAdditionalData)||void 0===i?void 0:i.hasAIBot,is_desk_channel:null===(c=e._aiAgentAdditionalData)||void 0===c?void 0:c.isDesk,is_ai_agent_channel:null===(l=e._aiAgentAdditionalData)||void 0===l?void 0:l.isAIAgent,message_purge_offset:e.messageDeletionTimestamp,conversation:e.conversation?kr.payloadify(e.conversation):null,helpdesk_info:e.helpdeskInfo?Kr.payloadify(e.helpdeskInfo):null});return r?h:t(n(h))},c.prototype._shouldUpdateLastMessageWith=function(e){if(e.silent)return!1;var t=F.of(this._iid).appInfo;switch(null==t?void 0:t.lastMessageThreadingPolicy){case ge.NONE:case ge.INCLUDE_REPLY:break;case ge.EXCLUDE_REPLY:if(e.parentMessageId>0)return!1;break;case ge.INCLUDE_REPLY_TO_CHANNEL:if(e instanceof $e&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<=e.updatedAt},c.prototype._tryUpdateLastMessageAndCallEvents=function(e,t){var n=F.of(this._iid).dispatcher,s=Os.of(this._iid);this._updateLastMessage(t),s.handlers.map((function(t){t.onChannelChanged&&t.onChannelChanged(e)})),n.dispatch(new On({channels:[e],context:{source:E.EVENT_MESSAGE_SENT}}))},c.prototype._shouldUpdateUnreadCountWith=function(e){var t=F.of(this._iid).appInfo;switch(null==t?void 0:t.unreadCountThreadingPolicy){case Ce.NONE:case Ce.INCLUDE_REPLY:break;case Ce.EXCLUDE_REPLY:if(e.parentMessageId>0)return!1;break;case Ce.INCLUDE_REPLY_TO_CHANNEL:if(e instanceof $e&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},c.prototype._updateLastMessage=function(e){return!!this._shouldUpdateLastMessageWith(e)&&(this.lastMessage=e,!0)},c.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===xr.ALL||this.myCountPreference===xr.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var n=F.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===xr.ALL||this.myCountPreference===xr.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},c.prototype._updateUnreadMemberState=function(e,t,n){void 0===n&&(n=!1);var s=this._unreadMemberStateMap.get(e);return!!(!s||n||!n&&s<t)&&(s!==t&&(this._unreadMemberStateMap.set(e,t),F.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0))},c.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)},c.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)},c.prototype._clearTypingStatus=function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0},c.prototype._update=function(e){e._typingStatus=this._typingStatus,e._typingStarted=this._typingStarted,e._typingEnded=this._typingEnded,u.prototype._update.call(this,e)},c.prototype._setLatestMemberCount=function(e,t,n){var s=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,s=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),s},c.prototype.isReadMessage=function(e){var t=F.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return!!n&&n>=e.createdAt},c.prototype.serialize=function(){var e=this;return R(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState,Object.assign(t,e._serializeCachedMetaData())}))},c.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new er(this._iid,s(s({},e),{channel:this}))},c.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new rr(this._iid,this.url,e)},c.prototype.createThreadedParentMessageListQuery=function(e){return void 0===e&&(e={}),new vt(this._iid,this.url,this.channelType,e)},c.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex((function(t){return t.userId===e.userId}));if(n>-1){var s=this.members[n];s.state===dn.JOINED&&(e.state=s.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},c.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof En?e.userId:e,n=this.members.findIndex((function(e){return e.userId===t}));if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1},c.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof $e&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var s=F.of(this._iid).sdkState,r=e.createdAt,a=0;try{for(var i=v(this.members),o=i.next();!o.done;o=i.next()){var u=o.value;if(s.userId!==u.userId&&u.state===dn.JOINED&&e.sender.userId!==u.userId)(this.cachedUnreadMemberState[u.userId]||0)<r&&a++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}return 0},c.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof $e&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var s=F.of(this._iid).sdkState,r=e.createdAt,a=0;try{for(var i=v(this.members),o=i.next();!o.done;o=i.next()){var u=o.value;if(s.userId!==u.userId&&u.state===dn.JOINED&&e.sender.userId!==u.userId)(this.cachedUndeliveredMemberState[u.userId]||0)<r&&a++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}return 0},c.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var s=F.of(this._iid).sdkState;if(!s.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var r=e instanceof $e?e.sender:null,a=[];return this.members.forEach((function(i){if(t||i.userId!==s.userId&&i.userId!==(null==r?void 0:r.userId)){var o=n._unreadMemberStateMap.get(i.userId);o&&o>=e.createdAt&&a.push(i)}})),a},c.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var s=F.of(this._iid).sdkState;if(!s.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var r=e instanceof $e?e.sender:null,a=[];return this.members.forEach((function(i){if(t||i.userId!==s.userId&&i.userId!==(null==r?void 0:r.userId)){var o=n._unreadMemberStateMap.get(i.userId);o&&o<e.createdAt&&a.push(i)}})),a},c.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=F.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var s={};return this.members.forEach((function(r){if(e||r.userId!==n.userId){var a=t._unreadMemberStateMap.get(r.userId);s[r.userId]=new mt(t._iid,{channel_url:t.url,channel_type:t.channelType,user:En.payloadify(r),ts:null!=a?a:0})}})),s},c.prototype.getDeliveryStatus=function(e){var t=this;void 0===e&&(e=!0);var n=F.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var s={};return this.members.forEach((function(r){if(e||r.userId!==n.userId){var a=t._undeliveredMemberStateMap.get(r.userId);s[r.userId]=new bn(t._iid,{channel_url:t.url,channel_type:t.channelType,user:En.payloadify(r),ts:null!=a?a:0})}})),s},c.prototype.getTypingUsers=function(){var e=[];return this._typingStatus.forEach((function(t){var n=t.user;e.push(n)})),e},c.prototype.invalidateTypingStatus=function(){var e=this;if(!this.isTyping)return!1;var t=F.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),s=!1;return this._typingStatus.forEach((function(r,a){var i=r.ts;n-i>=t&&(e._typingStatus.delete(a),s=!0)})),s},c.prototype.refresh=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){return[2,this._refresh()]}))}))},c.prototype._refresh=function(e){return void 0===e&&(e=!1),p(this,void 0,void 0,(function(){var t,n,s,r,a,i;return f(this,(function(o){switch(o.label){case 0:return t=F.of(this._iid),n=t.requestQueue,s=t.dispatcher,r=new zn({channelUrl:this.url}),[4,n.send(r)];case 1:return a=o.sent(),i=a.as(Wn).channel,this._update(i),e||s.dispatch(new On({channels:[i],context:{source:E.REFRESH_CHANNEL}})),[2,this]}}))}))},c.prototype.freeze=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,u.prototype.freeze.call(this)];case 1:return e.sent(),F.of(this._iid).dispatcher.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_FROZEN},isWebSocketEventComing:!0})),[2]}}))}))},c.prototype.unfreeze=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,u.prototype.unfreeze.call(this)];case 1:return e.sent(),F.of(this._iid).dispatcher.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_UNFROZEN},isWebSocketEventComing:!0})),[2]}}))}))},c.prototype.updateChannel=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return t=s(s({},tr),e),l(function(e){return g("string",e.coverUrl,!0)&&(C(e.coverImage)||g("string",e.coverImage,!0))&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isDiscoverable,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&m("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)}(t)).throw(h.invalidParameters),n=F.of(this._iid),r=n.dispatcher,a=n.requestQueue,i=new or(s({channelUrl:this.url},t)),[4,a.send(i)];case 1:return o=c.sent(),u=o.as(ur).channel,this._update(u),r.dispatch(new On({channels:[u],context:{source:E.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.invite=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){return l(e.every((function(e){return e instanceof o}))).throw(h.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},c.prototype.inviteWithUserIds=function(e){return p(this,void 0,void 0,(function(){var t,n,s,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return l(m("string",e)).throw(h.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.requestQueue,r=t.sessionManager,a=new ps({channelUrl:this.url,userIds:e}),[4,s.send(a)];case 1:return i=u.sent(),o=i.as(fs).channel,this._update(o),n.dispatch(new On({channels:[o],context:{source:E.EVENT_CHANNEL_INVITED,inviter:r.currentUser,invitees:[]},isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.join=function(e){return p(this,void 0,void 0,(function(){var t,n,s,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return l(g("string",e,!0)).throw(h.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,r=t.requestQueue,a=new cs({channelUrl:this.url,userId:s.userId,accessCode:e}),[4,r.send(a)];case 1:return i=u.sent(),(o=i.as(ls).channel).myMemberState=this.myMemberState=dn.JOINED,this._update(o),n.dispatch(new On({channels:[o],context:{source:E.EVENT_CHANNEL_JOINED,users:[]},isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.leave=function(e){return void 0===e&&(e=!1),p(this,void 0,void 0,(function(){var t,n,s,r;return f(this,(function(a){switch(a.label){case 0:return t=F.of(this._iid),n=t.sdkState,s=t.requestQueue,r=new ds({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,s.send(r)];case 1:return a.sent(),this.myMemberState=dn.NONE,[2]}}))}))},c.prototype.acceptInvitation=function(e){return p(this,void 0,void 0,(function(){var t,n,s,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return l(g("string",e,!0)).throw(h.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,r=t.requestQueue,a=new ar({channelUrl:this.url,userId:s.userId,accessCode:e}),[4,r.send(a)];case 1:return i=u.sent(),(o=i.as(ir).channel).myMemberState=this.myMemberState=dn.JOINED,this._update(o),n.dispatch(new On({channels:[o],context:{source:E.EVENT_CHANNEL_ACCEPTED_INVITE},isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.declineInvitation=function(){return p(this,void 0,void 0,(function(){var e,t,n,s;return f(this,(function(r){switch(r.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new ms({channelUrl:this.url,userId:t.userId}),[4,n.send(s)];case 1:return r.sent(),this.myMemberState=dn.NONE,[2,this]}}))}))},c.prototype.sendUserMessage=function(e){var t=this,n=new wt,s=F.of(this._iid).dispatcher,r=Jt.of(this._iid);return u.prototype.sendUserMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){t&&r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),Os.of(t._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new On({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},c.prototype.updateUserMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,s,r,a,i=this;return f(this,(function(o){switch(o.label){case 0:return n=F.of(this._iid).dispatcher,[4,u.prototype.updateUserMessage.call(this,e,t)];case 1:return s=o.sent(),r=this._updateLastMessage(s),a=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===s.messageId&&(this.lastPinnedMessage=s,r=!0,a=!0),r&&(Os.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(i)})),n.dispatch(new On({channels:[this],context:{source:a?E.EVENT_PINNED_MESSAGE_UPDATED:E.EVENT_MESSAGE_UPDATED}}))),a&&Os.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(i)})),n.dispatch(new $({messages:[s],source:E.EVENT_MESSAGE_UPDATED})),[2,s]}}))}))},c.prototype._autoResendUserMessage=function(e){var t=this,n=new wt,s=F.of(this._iid).dispatcher,r=Jt.of(this._iid);return u.prototype._autoResendUserMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var a=Os.of(t._iid);r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),a.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new On({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},c.prototype.sendFileMessage=function(e){var t=this,n=new wt,s=F.of(this._iid).dispatcher,r=Jt.of(this._iid);return u.prototype.sendFileMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){t&&r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var a=Os.of(t._iid);r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),a.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new On({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},c.prototype.sendMultipleFilesMessage=function(e){var t=this,n=new gt,s=F.of(this._iid).dispatcher;return u.prototype.sendMultipleFilesMessage.call(this,e).onPending((function(e){n._trigger(e)})).onFailed((function(e,t){n._triggerFailed(e,t)})).onSucceeded((function(e){var r=Os.of(t._iid);t._updateLastMessage(e),r.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new On({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})).onFileUploaded((function(e,t,s,r){n._triggerOnFileUploaded(e,t,s,r)})),n},c.prototype.updateFileMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,s,r,a,i=this;return f(this,(function(o){switch(o.label){case 0:return n=F.of(this._iid).dispatcher,[4,u.prototype.updateFileMessage.call(this,e,t)];case 1:return s=o.sent(),r=this._updateLastMessage(s),a=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===s.messageId&&(this.lastPinnedMessage=s,r=!0,a=!0),r&&(Os.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(i)})),n.dispatch(new On({channels:[this],context:{source:a?E.EVENT_PINNED_MESSAGE_UPDATED:E.EVENT_MESSAGE_UPDATED}}))),a&&Os.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(i)})),n.dispatch(new $({messages:[s],source:E.EVENT_MESSAGE_UPDATED})),[2,s]}}))}))},c.prototype._autoResendFileMessage=function(e){var t=this,n=new wt,s=F.of(this._iid).dispatcher,r=Jt.of(this._iid);return u.prototype._autoResendFileMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var a=Os.of(t._iid);r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),a.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new On({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},c.prototype.deleteMessage=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,u.prototype.deleteMessage.call(this,e)];case 1:return t.sent(),0===e.messageId&&e instanceof $e&&F.of(this._iid).dispatcher.dispatch(new Ee({reqId:e.reqId,source:E.EVENT_MESSAGE_DELETED})),[2]}}))}))},c.prototype.hide=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a,i,o,u,c;return f(this,(function(d){switch(d.label){case 0:return t=s(s({},Cs),e),l(function(e){return g("boolean",e.hidePreviousMessages,!0)&&g("boolean",e.allowAutoUnhide,!0)}(t)).throw(h.invalidParameters),n=F.of(this._iid),r=n.dispatcher,a=n.sdkState,i=n.requestQueue,o=new ys(s({channelUrl:this.url,userId:a.userId},t)),[4,i.send(o)];case 1:return u=d.sent(),c=u.as(Es).messageOffsetTimestamp,this.hiddenState=t.allowAutoUnhide?Rr.HIDDEN_ALLOW_AUTO_UNHIDE:Rr.HIDDEN_PREVENT_AUTO_UNHIDE,t.hidePreviousMessages&&this._updateUnreadCount(0,0),c&&(this.messageOffsetTimestamp=c),r.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_HIDDEN},isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.unhide=function(){return p(this,void 0,void 0,(function(){var e,t,n,s;return f(this,(function(r){switch(r.label){case 0:return e=F.of(this._iid),t=e.dispatcher,n=e.requestQueue,s=new lr({channelUrl:this.url}),[4,n.send(s)];case 1:return r.sent(),this.hiddenState=Rr.UNHIDDEN,t.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_UNHIDDEN},isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.delete=function(){return p(this,void 0,void 0,(function(){var e,t;return f(this,(function(n){switch(n.label){case 0:return e=F.of(this._iid).requestQueue,t=new cr({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.markAsRead=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a,i,o=this;return f(this,(function(u){switch(u.label){case 0:return e=F.of(this._iid),t=e.dispatcher,n=e.requestQueue,s=new Dt({channelUrl:this.url}),[4,n.send(s)];case 1:return r=u.sent(),a=r.as(Ze).readStatus,this._updateUnreadMemberState(a.reader.userId,a.readAt),i=!1,(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),i=!0),Os.of(this._iid).handlers.map((function(e){i&&e.onChannelChanged&&e.onChannelChanged(o),e.onUserMarkedRead&&e.onUserMarkedRead(o,[a.reader.userId])})),t.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_READ,userIds:[a.reader.userId]}})),[2]}}))}))},c.prototype.markAsUnread=function(e){return p(this,void 0,void 0,(function(){var t,n,s,r,a,i,o,u,c,l,h,d,_=this;return f(this,(function(p){switch(p.label){case 0:return t=F.of(this._iid),n=t.sdkState,s=t.dispatcher,r=t.requestQueue,a=new xt({channelUrl:this.url,channelType:this.channelType,messageId:e.messageId,userId:n.userId,isExcluded:!0,uniqueId:"read-".concat(le())}),[4,r.send(a)];case 1:return i=p.sent(),o=i.as(Lt),u=o.readAt,c=o.unreadMessageCount,l=o.userId,h=o.isExcluded,d=o.totalUnreadCount,this._updateUnreadMemberState(l,u,h),this._updateUnreadCount(c,this.unreadMentionCount),s.dispatch(new be(d)),Os.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(_),e.onUserMarkedUnread&&e.onUserMarkedUnread(_,[l])})),s.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_UNREAD,userIds:[l]}})),[2]}}))}))},c.prototype.markAsDelivered=function(){return p(this,void 0,void 0,(function(){var e,t,n,s;return f(this,(function(r){switch(r.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new Is({channelUrl:this.url,userId:t.userId}),[4,n.send(s)];case 1:return r.sent(),[2]}}))}))},c.prototype.startTyping=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){switch(a.label){case 0:return e=F.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(s=(new Date).getTime())-this._typingStarted>=n?(this._typingStarted=s,this._typingEnded=0,r=new Ms({channelUrl:this.url,time:this._typingStarted}),[4,t.send(r)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},c.prototype.endTyping=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r;return f(this,(function(a){switch(a.label){case 0:return e=F.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(s=(new Date).getTime())-this._typingEnded>=n?(this._typingStarted=0,this._typingEnded=s,r=new As({channelUrl:this.url,time:this._typingStarted}),[4,t.send(r)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},c.prototype.createScheduledUserMessage=function(e){e=s(s({},Ct),e),l(yt(e)).throw(h.invalidParameters);var t=new wt;return this._createScheduledUserMessage(e,t),t},c.prototype.updateScheduledUserMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,r,a,i;return f(this,(function(o){switch(o.label){case 0:return n=s(s({},vr),t),l(function(e){return ht(e)&&g("number",e.scheduledAt,!0)}(n)).throw(h.invalidParameters),r=F.of(this._iid).requestQueue,a=new Cr(s({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,r.send(a)];case 1:return i=o.sent(),[2,i.as(Rt).message]}}))}))},c.prototype.createScheduledFileMessage=function(e){var t=this;e=s(s({},Et),e),l(bt(e)).throw(h.invalidParameters);var n=Date.now(),r=this._generateRequestId(),a=new wt;return K(kt).then((function(){var s=t._createPendingScheduledFileMessage(e,r,n);W((function(){return p(t,void 0,void 0,(function(){return f(this,(function(e){return[2,a._trigger(s)]}))}))}))})),C(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return t._createScheduledFileMessage(e,a,r,n)})):this._createScheduledFileMessage(e,a,r,n),a},c.prototype.updateScheduledFileMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,r,a;return f(this,(function(i){switch(i.label){case 0:return n=s(s({},fr),t),l(function(e){return ct(e)&&g("number",e.scheduledAt,!0)&&(C(e.file)||g("string",e.fileUrl))&&g("string",e.fileName,!0)&&g("string",e.mimeType,!0)&&g("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return g("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(n)).throw(h.invalidParameters),C(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r=new mr(s({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,F.of(this._iid).requestQueue.send(r)];case 3:return a=i.sent(),[2,a.as(gr).message]}}))}))},c.prototype.cancelScheduledMessage=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return t=new br({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,F.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.sendScheduledMessageNow=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return t=new Mr({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,F.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.getMyPushTriggerOption=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a;return f(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new Sr({userId:t.userId,channelUrl:this.url}),[4,n.send(s)];case 1:return r=i.sent(),a=r.as(Ur).pushTriggerOption,this.myPushTriggerOption=a,[2,a]}}))}))},c.prototype.setMyPushTriggerOption=function(e){return p(this,void 0,void 0,(function(){var t,n,s,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return l(r(ye,e)).throw(h.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,a=t.requestQueue,i=new Nr({userId:s.userId,channelUrl:this.url,pushTriggerOption:e}),[4,a.send(i)];case 1:return o=c.sent(),u=o.as(Ar).pushTriggerOption,this.myPushTriggerOption=u,n.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,u]}}))}))},c.prototype.setMyCountPreference=function(e){return p(this,void 0,void 0,(function(){var t,n,s,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return l(r(xr,e)).throw(h.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,a=t.requestQueue,i=new hr({channelUrl:this.url,userId:s.userId,countPreference:e}),[4,a.send(i)];case 1:return o=c.sent(),u=o.as(dr).countPreference,this.myCountPreference=u,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),n.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,u]}}))}))},c.prototype.resetMyHistory=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a;return f(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.dispatcher,n=e.requestQueue,s=new _r({channelUrl:this.url}),[4,n.send(s)];case 1:return r=i.sent(),a=r.as(pr).messageOffsetTimestamp,this.messageOffsetTimestamp=a,this.lastMessage&&this.lastMessage.createdAt<a&&(this.lastMessage=null),this._updateUnreadCount(0,0),this.totalUnreadReplyCount=0,t.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_RESET_HISTORY},isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype._uploadFileAndUpdateParams=function(e){return p(this,void 0,void 0,(function(){var t,n,s,r,a,i,o,u,c,l;return f(this,(function(h){switch(h.label){case 0:return C(e.file)?(t=F.of(this._iid).requestQueue,n=new Pt({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:s=h.sent(),r=s.as(Ft),a=r.url,i=r.fileSize,o=void 0===i?e.fileSize:i,u=r.thumbnails,c=r.requireAuth,l=void 0!==c&&c,e.fileUrl=a,e.fileSize=o,e.requireAuth=l,e._thumbnails=u,h.label=2;case 2:return[2]}}))}))},c.prototype.resendMessage=function(e,t){var n,s=this;if(l(e instanceof $e&&!e.scheduledInfo&&e.isResendable).throw(h.invalidParameters),e.isUserMessage()){var r=null!==(n=e.messageParams)&&void 0!==n?n:Mt(e),a=new wt;return this._sendUserMessage(r,Nt.RESEND,e.reqId).onPending((function(e){a._trigger(e)})).onFailed((function(e,t){a._triggerFailed(e,t)})).onSucceeded((function(e){s._tryUpdateLastMessageAndCallEvents(s,e),a._trigger(e)})),a}if(e.isFileMessage()){var i=this._validateFailedFileMessageHasFile(e,t);l(i).throw(h.invalidParameters);r=At(e,t);var o=new wt;return this._sendFileMessage(r,Nt.RESEND,e.reqId).onPending((function(e){o._trigger(e)})).onFailed((function(e,t){o._triggerFailed(e,t)})).onSucceeded((function(e){s._tryUpdateLastMessageAndCallEvents(s,e),o._trigger(e)})),o}if(e.isMultipleFilesMessage()){r=e.messageParams;var u=new gt;return this._sendMultipleFilesMessage(r,Nt.RESEND,e.reqId).onPending((function(e){u._trigger(e)})).onFailed((function(e,t){u._triggerFailed(e,t)})).onSucceeded((function(e){s._tryUpdateLastMessageAndCallEvents(s,e),u._trigger(e)})).onFileUploaded((function(e,t,n,s){u._triggerOnFileUploaded(e,t,n,s)})),u}},c.prototype.copyMessage=function(e,t){var n=this;if(l(e instanceof St&&t instanceof $e&&t.sendingStatus===ue.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(h.invalidParameters),t.isUserMessage()){l(!t.poll).throw(h.notSupportedError);var s=Ut(t),r=new wt;return e._sendUserMessage(s).onPending((function(e){r._trigger(e)})).onFailed((function(e,t){r._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),r._trigger(t)})),r}if(t.isFileMessage()){s=Tt(t);var a=new wt;return e._sendFileMessage(s).onPending((function(e){a._trigger(e)})).onFailed((function(e,t){a._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),a._trigger(t)})),a}if(t.isMultipleFilesMessage()){if(e.isGroupChannel()){s=It(t);var i=new gt;return e._sendMultipleFilesMessage(s,Nt.COPY).onPending((function(e){i._trigger(e)})).onFailed((function(e,t){i._triggerFailed(e,t)})).onSucceeded((function(t){n._tryUpdateLastMessageAndCallEvents(e,t),i._trigger(t)})).onFileUploaded((function(e,t,n,s){i._triggerOnFileUploaded(e,t,n,s)})),i}throw h.channelTypeNotSupportedError}},c.prototype.getMessageDeletionTimestamp=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a;return f(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.requestQueue,n=e.dispatcher,s=new Tr({channelUrl:this.url,channelType:this.channelType}),[4,t.send(s)];case 1:return r=i.sent(),a=r.as(Ir).messageDeletionTimestamp,this._messageDeletionTimestamp=a,n.dispatch(new Gn({channel:this})),[2,a]}}))}))},c.prototype.submitCSAT=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return l(g("string",e.csatType)&&g("number",e.csat,!0)&&g("string",e.csatReason,!0)&&g("boolean",e.isResolved,!0)&&g("number",e.resolutionScore,!0)&&g("number",e.csatStartedAt,!0)).throw(h.invalidParameters),t=F.of(this._iid),n=t.requestQueue,r=t.dispatcher,a=new Fr(s({channelUrl:this.url},e)),[4,n.send(a)];case 1:return i=u.sent(),o=i.as(Pr).conversation,this.conversation=o,r.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_CSAT_SUBMITTED}})),[2,o]}}))}))},c.prototype.markConversationAsHandoff=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a;return f(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.requestQueue,n=e.dispatcher,s=new Or({channelUrl:this.url}),[4,t.send(s)];case 1:return r=i.sent(),a=r.as(Hr).conversation,this.conversation=a,n.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_CONVERSATION_HANDEDOFF}})),[2,a]}}))}))},c.prototype.closeConversation=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,r,a;return f(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.requestQueue,n=e.dispatcher,s=new Gr({channelUrl:this.url}),[4,t.send(s)];case 1:return r=i.sent(),a=r.as(Vr).conversation,this.conversation=a,n.dispatch(new On({channels:[this],context:{source:E.EVENT_CHANNEL_UPDATED}})),[2,a]}}))}))},c.prototype.getContextObject=function(e){return p(this,void 0,void 0,(function(){var t,n,s;return f(this,(function(r){switch(r.label){case 0:return t=F.of(this._iid).requestQueue,n=new zr({aiAgentId:e,channelUrl:this.url}),[4,t.send(n)];case 1:return s=r.sent(),[2,s.as(Wr).contextObject]}}))}))},c.prototype.updateContext=function(e,t){return p(this,void 0,void 0,(function(){var n,s,r;return f(this,(function(a){switch(a.label){case 0:return n=F.of(this._iid).requestQueue,s=new Br({aiAgentId:e,channelUrl:this.url,context:t}),[4,n.send(s)];case 1:return r=a.sent(),[2,r.as(qr).contextObject]}}))}))},c.prototype.patchContext=function(e,t){return p(this,void 0,void 0,(function(){var n,s,r;return f(this,(function(a){switch(a.label){case 0:return n=F.of(this._iid).requestQueue,s=new jr({aiAgentId:e,channelUrl:this.url,context:t}),[4,n.send(s)];case 1:return r=a.sent(),[2,r.as(Qr).contextObject]}}))}))},c}(St),Xr={},Zr=function(){function e(e){var t=e._iid,n=e.limit,s=void 0===n?100:n,r=this;this.ref=0,this._iid=t,this._limit=s;var a,i=F.of(this._iid),o=i.sdkState,u=i.dispatcher,c=i.logger,l=i.cacheContext,v=i.statManager;this._metadataKey=(a=o.userId,"sendbird:".concat(a,"@groupchannel/sync.meta"));var m=function(e){return"sendbird:".concat(e,"@groupchannel/sync")}(o.userId);this._sync=new Vt(m,(function(){return p(r,void 0,void 0,(function(){var e,t,n,s,r,a,i,u,p,m,g,C,y,b,M,N;return f(this,(function(f){switch(f.label){case 0:return e={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:if(f.sent(),c.debug("channel background sync from",null===(p=this._metadata)||void 0===p?void 0:p.token),null===(m=this._metadata)||void 0===m?void 0:m.completed)return[3,14];t={includeEmpty:!0,includeMetaData:!0,hiddenChannelFilter:mn.ALL,order:Ot.CHRONOLOGICAL},f.label=2;case 2:if(f.trys.push([2,9,12,13]),t.order!==Ot.LATEST_LAST_MESSAGE)return[3,6];f.label=3;case 3:return f.trys.push([3,5,,6]),[4,l.preference.get(Me(o.appId))];case 4:return n=f.sent(),t.includeChatNotification=Boolean(n),[3,6];case 5:return f.sent(),t.includeChatNotification=!1,[3,6];case 6:return[4,Os.of(this._iid).getMyGroupChannels(null!==(C=null===(g=this._metadata)||void 0===g?void 0:g.token)&&void 0!==C?C:"",t,this._limit,E.SYNC_CHANNEL_BACKGROUND)];case 7:return s=f.sent(),r=s.channels,a=s.token,e.hasNext=r.length>=this._limit&&!!a,e.nextToken=a,this._metadata&&(this._metadata.token=a,(u=this._metadata.range).extends.apply(u,d([],_(r.map((function(e){return e.createdAt}))),!1)),this._metadata.completed=!e.hasNext),c.debug("channel background sync progress",e),[4,this.saveMetadata()];case 8:return f.sent(),[3,13];case 9:return i=f.sent(),c.debug("channel background sync error",i),i instanceof h&&i.isInvalidTokenError?[4,this.clearMetaData()]:[3,11];case 10:f.sent(),f.label=11;case 11:throw i;case 12:return v.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:"",measured_on:"channel_back_sync",event:"cache_fetch",max_db_size:null!==(b=null===(y=l.localCacheConfig)||void 0===y?void 0:y.maxSize)&&void 0!==b?b:0,use_local_cache:l.localCacheEnabled,starting_point:0,message_init_policy:null!==(N=null===(M=t.order)||void 0===M?void 0:M.toString())&&void 0!==N?N:"",collection_id:o.userId}})),[7];case 13:return[3,15];case 14:e.hasNext=!1,e.nextToken="",f.label=15;case 15:return[2,e]}}))}))})),this._connectionEventContext=u.on((function(e){if(e instanceof P)if(e.stateType===O.CONNECTED)r.resume();else r.pause();else e instanceof Bt&&r.resume()}))}return e.of=function(t){return Xr[t]||(Xr[t]=new e({_iid:t})),Xr[t].ref++,Xr[t]},e.clear=function(e){Xr[e]&&(Xr[e].close(),delete Xr[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new Ls({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)},enumerable:!1,configurable:!0}),e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,F.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:"",range:new Ls(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!e&&e.completed},t.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetaData=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){var e,t,n=F.of(this._iid),s=n.logger;n.sessionManager.session.hasSession&&(s.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:""))},e.prototype.pause=function(){F.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Xr[this._iid])},e}(),$r={},ea=function(){function e(e){var t=e._iid,n=this;this.ref=0,this._iid=t;var s,r=F.of(this._iid),a=r.logger,i=r.sdkState,o=r.dispatcher,u=r.cacheContext,c=r.statManager;this._metadataKey=(s=i.userId,"sendbird:".concat(s,"@groupchannel/changelogs.meta")),this._subscribers=new Ne;var l=function(e){return"sendbird:".concat(e,"@groupchannel/changelogs")}(i.userId);this._sync=new Vt(l,(function(){return p(n,void 0,void 0,(function(){var e,t,n,s,r,o,l,d,_,p,v,m,g;return f(this,(function(f){switch(f.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:f.sent(),a.debug("channel changelog sync from",null===(v=this._metadata)||void 0===v?void 0:v.token),t=Os.of(this._iid),f.label=2;case 2:f.trys.push([2,9,12,16]),n={includeEmpty:!0,includeMetaData:!0},f.label=3;case 3:return f.trys.push([3,5,,6]),[4,u.preference.get(Me(i.appId))];case 4:return s=f.sent(),n.includeChatNotification=Boolean(s),[3,6];case 5:return f.sent(),n.includeChatNotification=!1,[3,6];case 6:return[4,t.getMyGroupChannelChangeLogs(null!==(g=null===(m=this._metadata)||void 0===m?void 0:m.token)&&void 0!==g?g:"",n,E.SYNC_CHANNEL_CHANGELOGS)];case 7:return r=f.sent(),o=r.updatedChannels,l=r.deletedChannelUrls,d=r.hasMore,_=r.token,this._subscribers.dispatch("progress",{updatedChannels:o,deletedChannelUrls:l,hasMore:d,token:_}),e.hasNext=d,e.nextToken=_,this._metadata&&(this._metadata.token=_),a.debug("channel changelog sync progress",e),[4,this.saveMetadata()];case 8:return f.sent(),u.localCacheEnabled&&c.put(new H({type:G.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:"",measured_on:"channel_change_log_sync",event:o.length>0||l.length>0?"cache_miss":"cache_hit",max_db_size:o.length,use_local_cache:u.localCacheEnabled,starting_point:0,message_init_policy:l.length.toString(),collection_id:i.userId}})),[3,16];case 9:return p=f.sent(),a.debug("channel changelog sync error",p),p instanceof h&&p.isInvalidTokenError?[4,this.clearMetadata()]:[3,11];case 10:f.sent(),f.label=11;case 11:throw p;case 12:return e.hasNext?[3,15]:[4,K(500)];case 13:return f.sent(),[4,t.removeChannelsByRotation()];case 14:f.sent(),f.label=15;case 15:return[7];case 16:return[2,e]}}))}))})),this._sync.on("stop",(function(){n._subscribers.dispatch("pause")})),this._connectionEventContext=o.on((function(e){if(e instanceof P)if(e.stateType===O.CONNECTED)n.resume();else n.pause();else e instanceof Bt&&n.resume()}))}return e.of=function(t){return $r[t]||($r[t]=new e({_iid:t})),$r[t].ref++,$r[t]},e.clear=function(e){$r[e]&&($r[e].close(),delete $r[e])},Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._sync.isRunning},enumerable:!1,configurable:!0}),e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e,t,n,s;return f(this,(function(r){switch(r.label){case 0:return this._metadata?[3,2]:(e=F.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:s=r.sent(),this._metadata={token:s?s.token:n},r.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.on=function(e,t){return this._subscribers.on(e,t)},e.prototype.resume=function(){F.of(this._iid).sessionManager.session.hasSession&&this._sync.start(0)},e.prototype.pause=function(){this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete $r[this._iid])},e}(),ta=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},na=function(e,t,n){if(e.length>0){for(var s=ta(e,t),r=0,a=e.length-1,i=Math.floor((r+a)/2);r<a;){var o=sa(e[i],t,n);if(o>0)a=i,i=Math.floor((r+a)/2);else{if(!(o<0))return{place:i,oldPosition:s};r=i+1,i=Math.floor((r+a)/2)}}return{place:sa(e[i],t,n)>=0?i:i+1,oldPosition:s}}return{place:e.length,oldPosition:-1}},sa=function(e,t,n){switch(n){case Ot.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?0===(s=t.lastMessage.createdAt-e.lastMessage.createdAt)?t.createdAt-e.createdAt:s:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case Ot.CHRONOLOGICAL:return t.createdAt-e.createdAt;case Ot.CHANNEL_NAME_ALPHABETICAL:var s;return 0===(s=e.name.localeCompare(t.name))?e.createdAt-t.createdAt:s;default:return 0}},ra=function(){function e(e,t){var n=t.filter,s=void 0===n?new Nn:n,r=t.order,a=void 0===r?Ot.LATEST_LAST_MESSAGE:r,i=t.limit,o=void 0===i?Te:i,u=t.includeChangesOnInitialLoad,c=void 0!==u&&u,l=this;this.channels=[],this._isInitialized=!1,this._iid=e,this._key="gcc-".concat(le()),this._isDisposed=!1,this._isGetRemoteChannelsSucceeded=!0,this._includeChangesOnInitialLoad=c,this.filter=s,this.order=a,this._hasMore=!0,this._token="",this._limit=o;var h=F.of(this._iid),d=h.sdkState,_=h.cacheContext,v=h.dispatcher;_.localCacheEnabled&&(this._backgroundSync=Zr.of(e),this._backgroundSync.resume()),this._changelogSync=ea.of(e),this._changelogSync.resume(),Os.of(this._iid).subscribeChannelEvent(this._key,{onUpdate:function(e,t){var n=t.source;if(Pn(n)){var s=e.filter((function(e){return l.filter.match(e,d.userId)})),r=e.filter((function(e){return!l.filter.match(e,d.userId)})).map((function(e){return e.url}));s.length>0&&l._addChannelsToView(s,t),r.length>0&&l._removeChannelsFromView(r,t)}},onRemove:function(e,t){l._removeChannelsFromView(e,t)}}),v.on((function(e){e instanceof P&&(e.stateType===O.CONNECTED?l._isGetRemoteChannelsSucceeded||p(l,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._revokeLoadMore()];case 1:return e.sent(),[2]}}))})):e.stateType===O.LOGOUT&&l.dispose())}))}return Object.defineProperty(e.prototype,"hasMore",{get:function(){return!this._isDisposed&&this._hasMore},enumerable:!1,configurable:!0}),e.prototype.setGroupChannelCollectionHandler=function(e){this._handler=e},e.prototype._addChannelsToView=function(e,t,n){var s,r,a,i,o=this;void 0===n&&(n=!1);var u=[],c=[],l=[];try{for(var h=v(e),d=h.next();!d.done;d=h.next()){var _=d.value,m=ta(this.channels,_);m>=0&&this.channels.splice(m,1);var g=na(this.channels,_,this.order).place;if(m<0)g===this.channels.length?!n&&this._hasMore||(u.push(_),this.channels.push(_)):(u.push(_),this.channels.splice(g,0,_));else switch(t.source){case E.EVENT_CHANNEL_UPDATED:case E.EVENT_MESSAGE_RECEIVED:case E.SYNC_CHANNEL_CHANGELOGS:case E.EVENT_MESSAGE_SENT:this.order===Ot.CHANNEL_NAME_ALPHABETICAL&&this._hasMore&&g===this.channels.length?l.push(_):(this.channels.splice(g,0,_),c.push(_));break;default:this.channels.splice(g,0,_),c.push(_)}}}catch(e){s={error:e}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(s)throw s.error}}if(l.length>0)try{for(var C=v(l),y=C.next();!y.done;y=C.next()){_=y.value;var b=ta(this.channels,_);-1!==b&&this.channels.splice(b,1)}}catch(e){a={error:e}}finally{try{y&&!y.done&&(i=C.return)&&i.call(C)}finally{if(a)throw a.error}}Pn(t.source)&&W((function(){return p(o,void 0,void 0,(function(){var e,n,s;return f(this,(function(r){return u.length>0&&(null===(e=this._handler)||void 0===e?void 0:e.onChannelsAdded)&&this._handler.onChannelsAdded(t,u),c.length>0&&(null===(n=this._handler)||void 0===n?void 0:n.onChannelsUpdated)&&this._handler.onChannelsUpdated(t,c),l.length>0&&(null===(s=this._handler)||void 0===s?void 0:s.onChannelsDeleted)&&this._handler.onChannelsDeleted(t,l.map((function(e){return e.url}))),[2]}))}))}))},e.prototype._removeChannelsFromView=function(e,t){var n,s,r=this,a=[],i=function(e){var t=o.channels.findIndex((function(t){return t.url===e}));t>=0&&(a.push(o.channels[t].url),o.channels.splice(t,1))},o=this;try{for(var u=v(e),c=u.next();!c.done;c=u.next()){i(c.value)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}return Pn(t.source)&&a.length>0&&W((function(){return p(r,void 0,void 0,(function(){var e;return f(this,(function(n){return(null===(e=this._handler)||void 0===e?void 0:e.onChannelsDeleted)&&this._handler.onChannelsDeleted(t,a),[2]}))}))})),a},e.prototype._getLocalChannels=function(){return p(this,void 0,void 0,(function(){var e,t;return f(this,(function(n){switch(n.label){case 0:return e=Os.of(this._iid),t=this.channels.length>0?function(e,t){var n,s,r,a;switch(t){case Ot.LATEST_LAST_MESSAGE:return null!==(s=null===(n=e.lastMessage)||void 0===n?void 0:n.createdAt)&&void 0!==s?s:e.createdAt;case Ot.CHRONOLOGICAL:return e.createdAt;case Ot.CHANNEL_NAME_ALPHABETICAL:return e.name;default:return null!==(a=null===(r=e.lastMessage)||void 0===r?void 0:r.createdAt)&&void 0!==a?a:e.createdAt}}(this.channels[this.channels.length-1],this.order):null,[4,e.getChannelsFromCache(t,this.filter,this.order,this._limit,t?this.channels[this.channels.length-1].url:void 0)];case 1:return[2,n.sent()]}}))}))},e.prototype._getRemoteChannels=function(){return p(this,void 0,void 0,(function(){var e,t,r;return f(this,(function(a){switch(a.label){case 0:return[4,Os.of(this._iid).getMyGroupChannels(this._token,n(s(s({},this.filter),{userIdsFilter:this.filter.userIdsFilter,searchFilter:this.filter.searchFilter,order:this.order})),this._limit)];case 1:return e=a.sent(),t=e.channels,r=e.token,this._token=r,this._hasMore=!!r,[2,t]}}))}))},e.prototype._revokeLoadMore=function(){return p(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:if(this._isDisposed)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._getRemoteChannels()];case 2:return e=t.sent(),this._isGetRemoteChannelsSucceeded=!0,this._addChannelsToView(e,{source:E.REQUEST_CHANNEL},!0),[3,4];case 3:return t.sent(),this._isGetRemoteChannelsSucceeded=!1,[3,4];case 4:return[2]}}))}))},e.prototype.loadMore=function(){var e;return p(this,void 0,void 0,(function(){var t,n,s,r,a,i,o,u,c,l,d,_,m,g,C,y,b,N,A,S,U,T=this;return f(this,(function(I){switch(I.label){case 0:if(this._isDisposed)throw new h({code:re.COLLECTION_DISPOSED,message:"Collection has been disposed."});return t=null,this._includeChangesOnInitialLoad&&0===this.channels.length&&this._changelogSync.isRunning?[4,new Promise((function(e){T._changelogSyncSubscriberContext=T._changelogSync.on("progress",(function(t){return e(t)})).on("pause",(function(){return e(null)}))}))]:[3,2];case 1:t=I.sent(),null===(e=this._changelogSyncSubscriberContext)||void 0===e||e.close(),I.label=2;case 2:return n=F.of(this._iid),s=n.cacheContext,r=n.connectionManager,a=n.statManager,this._isInitialized?[3,5]:(this._isInitialized=!0,s.localCacheEnabled?[4,this._backgroundSync.loadMetadata()]:[3,4]);case 3:I.sent(),I.label=4;case 4:a.put(new de({type:G.FEATURE_LOCALCACHE,data:{use_local_cache:s.localCacheEnabled,collection_interface:{group_channel:!0}}})),I.label=5;case 5:return i=[],this._hasMore?!s.localCacheEnabled||r.isConnected&&!this._backgroundSync.completed?[3,7]:[4,M((function(){return p(T,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._getLocalChannels()];case 1:return i=e.sent(),[2]}}))}))}))]:[3,11];case 6:return I.sent(),this._hasMore=i.length>=this._limit,[3,10];case 7:return I.trys.push([7,9,,10]),[4,this._getRemoteChannels()];case 8:return i=I.sent(),this._isGetRemoteChannelsSucceeded=!0,[3,10];case 9:return I.sent(),this._isGetRemoteChannelsSucceeded=!1,[3,10];case 10:this._addChannelsToView(i,{source:E.REQUEST_CHANNEL},!0),I.label=11;case 11:if(t){o=F.of(this._iid).sdkState,u=t.updatedChannels.filter((function(e){return T.filter.match(e,o.userId)}));try{for(c=v(u),l=c.next();!l.done;l=c.next())d=l.value,(b=ta(i,d))>=0?i[b]=d:(_=na(i,d,this.order).place,i.splice(_,0,d)),this._addChannelsToView([d],{source:E.REQUEST_CHANNEL},!0)}catch(e){N={error:e}}finally{try{l&&!l.done&&(A=c.return)&&A.call(c)}finally{if(N)throw N.error}}m=i.map((function(e){return e.url}));try{for(g=v(t.deletedChannelUrls),C=g.next();!C.done;C=g.next())y=C.value,(b=m.indexOf(y))>=0&&(i.splice(b,1),m.splice(b,1))}catch(e){S={error:e}}finally{try{C&&!C.done&&(U=g.return)&&U.call(g)}finally{if(S)throw S.error}}this._removeChannelsFromView(t.deletedChannelUrls,{source:E.REQUEST_CHANNEL})}return[2,i]}}))}))},e.prototype.dispose=function(){var e,t,n;this._isDisposed||(this._isDisposed=!0,this.channels.length>0&&this.channels.splice(0,this.channels.length),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._changelogSyncSubscriberContext)||void 0===n||n.close(),Os.of(this._iid).unsubscribeChannelEvent(this._key))},e}(),aa=function(s){function r(e){var r=this,a=e.token,i=e.limit,o=e.order,u=e.includeEmpty,c=e.membershipFilter,l=e.channelNameContainsFilter,h=e.channelUrlsFilter,d=e.customTypesFilter,_=e.customTypeStartsWithFilter,p=e.superChannelFilter,f=e.metadataOrderKeyFilter,v=e.metadataKey,m=e.metadataValues,g=e.metadataValueStartsWith,C=e.includeFrozen,y=e.includeMetaData;return(r=s.call(this)||this).method=N.GET,r.path=I,r.params=t(n({token:a,limit:i,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:u,public_mode:_n.PUBLIC,public_membership_mode:c,name_contains:l,channel_urls:h,custom_types:d,custom_type_startswith:_,super_mode:p,metadata_order_key:f,metadata_key:v,metadata_values:m,metadata_value_startswith:g,show_frozen:C,show_metadata:y})),r}return e(r,s),r}(S),ia=function(t){function n(e,n){var s=t.call(this,e,n)||this;s.channels=[];var r=n.next,a=n.channels,i=n.ts;return s.token=r,a&&a.length>0&&(s.channels=a.map((function(t){return t.ts=i,new Jr(e,t)}))),s.ts="number"==typeof i?i:0,s}return e(n,t),n}(U);!function(e){e.ALL="all",e.JOINED="joined"}(Yr||(Yr={}));var oa=function(t){function a(e,n){var s,r,a,i,o,u,c,l,h,d,_,p,f,v,m=this;return(m=t.call(this,e,n)||this).includeEmpty=!1,m.includeFrozen=!0,m.includeMetaData=!0,m.channelUrlsFilter=null,m.customTypesFilter=null,m.customTypeStartsWithFilter=null,m.channelNameContainsFilter=null,m.membershipFilter=Yr.ALL,m.superChannelFilter=fn.ALL,m.metadataKey=null,m.metadataValues=null,m.metadataOrderKeyFilter=null,m.metadataValueStartsWith=null,m.order=Xt.CHRONOLOGICAL,m.includeEmpty=null!==(s=n.includeEmpty)&&void 0!==s&&s,m.includeFrozen=null===(r=n.includeFrozen)||void 0===r||r,m.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,m.channelUrlsFilter=null!==(i=n.channelUrlsFilter)&&void 0!==i?i:null,m.customTypesFilter=null!==(o=n.customTypesFilter)&&void 0!==o?o:null,m.customTypeStartsWithFilter=null!==(u=n.customTypeStartsWithFilter)&&void 0!==u?u:null,m.channelNameContainsFilter=null!==(c=n.channelNameContainsFilter)&&void 0!==c?c:null,m.membershipFilter=null!==(l=n.membershipFilter)&&void 0!==l?l:Yr.ALL,m.superChannelFilter=null!==(h=n.superChannelFilter)&&void 0!==h?h:fn.ALL,m.metadataKey=null!==(d=n.metadataKey)&&void 0!==d?d:null,m.metadataValues=null!==(_=n.metadataValues)&&void 0!==_?_:null,m.metadataOrderKeyFilter=null!==(p=n.metadataOrderKeyFilter)&&void 0!==p?p:null,m.metadataValueStartsWith=null!==(f=n.metadataValueStartsWith)&&void 0!==f?f:null,m.order=null!==(v=n.order)&&void 0!==v?v:Xt.CHRONOLOGICAL,m}return e(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&g("boolean",this.includeEmpty)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.channelNameContainsFilter,!0)&&m("string",this.channelUrlsFilter,!0)&&m("string",this.customTypesFilter,!0)&&g("string",this.customTypeStartsWithFilter,!0)&&r(Yr,this.membershipFilter)&&r(fn,this.superChannelFilter)&&r(Xt,this.order)&&g("string",this.metadataOrderKeyFilter,!0)&&g("string",this.metadataKey,!0)&&m("string",this.metadataValues,!0)&&g("string",this.metadataValueStartsWith,!0)},a.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,r,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=F.of(this._iid).requestQueue,r=new aa(n(s(s({},this),{token:this._token}))),[4,t.send(r)]):[3,2]):[3,5];case 1:return a=c.sent(),i=a.as(ia),o=i.channels,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,o];case 2:return[2,e];case 3:throw h.queryInProgress;case 4:return[3,6];case 5:throw h.invalidParameters;case 6:return[2]}}))}))},a}(k),ua=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}(function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.onUserJoined=te,e.onUserLeft=te,e.onUserReceivedInvitation=te,e.onUserDeclinedInvitation=te,e.onChannelHidden=te,e.onUnreadMemberStatusUpdated=te,e.onUserMarkedRead=te,e.onUserMarkedUnread=te,e.onUndeliveredMemberStatusUpdated=te,e.onTypingStatusUpdated=te,e.onPollUpdated=te,e.onPollVoted=te,e.onPollDeleted=te,e.onPinnedMessageUpdated=te,e}return e(n,t),n}(hn)),ca=function(s){function r(e){var r=this,a=e.token,i=e.limit,o=e.order,u=e.reverse,c=e.channelUrl,l=e.messageTypeFilter,h=e.scheduledStatus;return(r=s.call(this)||this).method=N.GET,r.path="".concat(w),r.params=t(n({token:a,limit:i,reverse:u,channel_url:c,order:o,message_type:l,status:h})),r}return e(r,s),r}(S),la=function(t){function n(e,n){var s=t.call(this,e,n)||this;s.scheduledMessages=[];var r=n.next,a=n.scheduled_messages;return s.token=r,s.scheduledMessages=a.map((function(t){return ot(e,t)})),s}return e(n,t),n}(U),ha=function(t){function a(e,n){var s,r,a,i,o,u=this;return(u=t.call(this,e,n)||this).channelUrl=null,u.order=null,u.reverse=!1,u.scheduledStatus=null,u.messageTypeFilter=y.ALL,u.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:null,u.order=null!==(r=n.order)&&void 0!==r?r:null,u.reverse=null!==(a=n.reverse)&&void 0!==a&&a,u.scheduledStatus=null!==(i=n.scheduledStatus)&&void 0!==i?i:null,u.messageTypeFilter=null!==(o=n.messageTypeFilter)&&void 0!==o?o:y.ALL,u}return e(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&g("string",this.channelUrl,!0)&&(r(Zt,this.order)||null===this.order)&&g("boolean",this.reverse)&&(m(Ie,this.scheduledStatus)||null===this.scheduledStatus)&&r(y,this.messageTypeFilter)},a.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,r,a,i,o;return f(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=F.of(this._iid).requestQueue,t=new ca(n(s(s({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=u.sent(),a=r.as(la),i=a.scheduledMessages,o=a.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw h.queryInProgress;case 4:return[3,6];case 5:throw h.invalidParameters;case 6:return[2]}}))}))},a}(k),da=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="groupChannel",e}return e(n,t),n.prototype.init=function(e,n){var s=n.sdkState,r=n.dispatcher,a=n.sessionManager,i=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;t.prototype.init.call(this,e,{sdkState:s,dispatcher:r,sessionManager:a,requestQueue:i,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new Os(e,{sdkState:s,cacheContext:c,dispatcher:r,sessionManager:a,requestQueue:i,logger:o})},n.prototype.createGroupChannelCollection=function(e){return void 0===e&&(e={}),new ra(this._iid,e)},n.prototype.createMyGroupChannelListQuery=function(e){return void 0===e&&(e={}),new Ts(this._iid,e)},n.prototype.createPublicGroupChannelListQuery=function(e){return void 0===e&&(e={}),new oa(this._iid,e)},n.prototype.createScheduledMessageListQuery=function(e){return void 0===e&&(e={}),new ha(this._iid,e)},n.prototype.addGroupChannelHandler=function(e,t){l(g("string",e)&&t instanceof ua).throw(h.invalidParameters),this._manager.addHandler(e,t)},n.prototype.removeGroupChannelHandler=function(e){l(g("string",e)).throw(h.invalidParameters),this._manager.removeHandler(e)},n.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},n.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},n.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},n.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},n.prototype.getChannel=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){return l(g("string",e)).throw(h.invalidParameters),[2,this._manager.getChannel(e)]}))}))},n.prototype.getChannelWithoutCache=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){return l(g("string",e)).throw(h.invalidParameters),[2,this._manager.getChannelWithoutCache(e)]}))}))},n.prototype.getMyGroupChannelChangeLogsByToken=function(e,t){return void 0===t&&(t={}),p(this,void 0,void 0,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return n=s(s({},Tn),t),l(g("string",e)&&In(n)).throw(h.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMyGroupChannelChangeLogsByTimestamp=function(e,t){return void 0===t&&(t={}),p(this,void 0,void 0,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return n=s(s({},Tn),t),l(g("number",e)&&In(n)).throw(h.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getGroupChannelCount=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){return t=s(s({},wn),e),l(Dn(t)).throw(h.invalidParameters),[2,this._manager.getGroupChannelCount(t)]}))}))},n.prototype.getUnreadItemCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._manager.getUnreadItemCount(e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getTotalUnreadChannelCount=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._manager.getTotalUnreadChannelCount()];case 1:return[2,e.sent()]}}))}))},n.prototype.getTotalUnreadMessageCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalScheduledMessageCount(e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getSubscribedTotalUnreadMessageCount=function(){return this._manager.getSubscribedTotalUnreadMessageCount()},n.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()},n.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)},n.prototype.createChannel=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){var t;return f(this,(function(n){return t=s(s({},Sn),e),l(Un(t)).throw(h.invalidParameters),[2,this._manager.createChannel(t)]}))}))},n.prototype.createDistinctChannelIfNotExist=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){var t;return f(this,(function(n){return t=s(s({},Sn),e),l(Un(t)).throw(h.invalidParameters),t&&(t.isDistinct=!0),[2,this.createChannel(t)]}))}))},n.prototype.createChannelWithUserIds=function(e,t,n,r,a,i){return void 0===t&&(t=!1),void 0===a&&(a=""),void 0===i&&(i=""),p(this,void 0,void 0,(function(){var o;return f(this,(function(u){return o=s(s({},Sn),{invitedUserIds:e,isDistinct:t,name:n,data:a,customType:i}),"string"==typeof r?o.coverUrl=r:o.coverImage=r,[2,this.createChannel(o)]}))}))},n.prototype.markAsReadAll=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){return this._manager.markAsReadAll(),[2]}))}))},n.prototype.markAsReadWithChannelUrls=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){return l(m("string",e)).throw(h.invalidParameters),this._manager.markAsReadWithChannelUrls(e),[2]}))}))},n.prototype.markAsDelivered=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return l(g("string",e)).throw(h.invalidParameters),[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},n}(Ae);export{Xs as A,$s as B,kr as C,bn as D,pn as E,er as F,ns as G,Kr as H,Zs as I,ws as J,Ys as K,oa as L,dn as M,fn as N,gn as O,_n as P,Cn as Q,Mn as R,ha as S,xn as T,vn as U,ts as a,Jr as b,On as c,Hn as d,Er as e,yr as f,Dr as g,Lr as h,Hs as i,wr as j,xr as k,da as l,ra as m,Fn as n,Nn as o,Vs as p,ua as q,Ts as r,yn as s,mn as t,Rr as u,Rn as v,En as w,Js as x,rr as y,Yr as z};
