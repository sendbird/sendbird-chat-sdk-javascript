import{c as e,e as t,u as n,g as s,X as r,a7 as i,bc as a,w as o,s as u,p as c,q as l,_ as h,b as d,ae as _,t as p,Q as f,a as v,i as m,ap as g,a2 as E,b6 as C,B as y,A as M,d as b,f as N,h as U,bd as S,al as T,b9 as A,U as I,W as w,aj as L,be as D,ah as x,aM as R,V as F,z as P,C as k,O,G as H,a3 as V,bb as G,aK as B,aR as q,aQ as z,am as j,aP as W,aU as Q,bf as K,a8 as Y,bg as J,E as X,D as Z,F as $,bh as ee,b8 as te,ax as ne,aL as se,ak as re,an as ie,bi as ae,b7 as oe,n as ue,ay as ce,bj as le,az as he,ai as de,aD as _e,av as pe,$ as fe,aT as ve}from"./__bundle-0b1520ed.js";import{D as me,a as ge,J as Ee,L as Ce,T as ye,K as Me,t as be,u as Ne,V as Ue,W as Se,X as Te,Y as Ae,Z as Ie,H as we,v as Le,_ as De,$ as xe,a0 as Re,a1 as Fe,a2 as Pe,a3 as ke,a4 as Oe,a5 as He,a6 as Ve,a7 as Ge,a8 as Be,a9 as qe,aa as ze,ab as je,ac as We,ad as Qe,ae as Ke,af as Ye,ag as Je,ah as Xe,ai as Ze,aj as $e,ak as et,al as tt,am as nt,an as st,ao as rt,Q as it,ap as at,aq as ot,ar as ut,as as ct,at as lt,au as ht,av as dt,aw as _t,x as pt,ax as ft,ay as vt,az as mt,aA as gt,aB as Et,aC as Ct,aD as yt,aE as Mt,aF as bt}from"./__bundle-dc8db3c3.js";import{G as Nt,g as Ut,D as St,c as Tt,R as At,U as It,a as wt,b as Lt,A as Dt}from"./__bundle-7b94e16f.js";import{C as xt,B as Rt,a as Ft,O as Pt,P as kt,M as Ot,T as Ht,R as Vt,U as Gt,A as Bt}from"./__bundle-168f8164.js";var qt;!function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited",e.LEFT="left"}(qt||(qt={}));var zt,jt,Wt,Qt,Kt,Yt,Jt,Xt,Zt=function(a){function o(e,t){var n=a.call(this,e,t)||this;return n.state=null,n.role=null,n.isMuted=!1,n.isBlockedByMe=!1,n.isBlockingMe=!1,n.state=r(qt,t.state)?t.state:null,n.role=r(i,t.role)?t.role:null,"boolean"==typeof t.is_muted&&(n.isMuted=t.is_muted),"boolean"==typeof t.is_blocked_by_me&&(n.isBlockedByMe=t.is_blocked_by_me),"boolean"==typeof t.is_blocking_me&&(n.isBlockingMe=t.is_blocking_me),n}return e(o,a),o.payloadify=function(e){return t(n(s(s({},a.payloadify.call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})))},o}(me);!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(zt||(zt={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(jt||(jt={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only",e.EXCLUSIVE_ONLY="exclusive_only"}(Wt||(Wt={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(Qt||(Qt={})),function(e){e.ALL="all",e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(Kt||(Kt={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(Yt||(Yt={})),function(e){e.AND="AND",e.OR="OR"}(Jt||(Jt={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}(Xt||(Xt={}));var $t,en=function(){function e(e){var t,n,s,r,i,a,o,u,c,l,h,d,_,p;this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=null!==(t=null==e?void 0:e.includeEmpty)&&void 0!==t&&t,this.nicknameContainsFilter=null!==(n=null==e?void 0:e.nicknameContainsFilter)&&void 0!==n?n:null,this.nicknameStartsWithFilter=null!==(s=null==e?void 0:e.nicknameStartsWithFilter)&&void 0!==s?s:null,this.nicknameExactMatchFilter=null!==(r=null==e?void 0:e.nicknameExactMatchFilter)&&void 0!==r?r:null,this.channelNameContainsFilter=null!==(i=null==e?void 0:e.channelNameContainsFilter)&&void 0!==i?i:"",this.myMemberStateFilter=null!==(a=null==e?void 0:e.myMemberStateFilter)&&void 0!==a?a:jt.ALL,this.customTypesFilter=null!==(o=null==e?void 0:e.customTypesFilter)&&void 0!==o?o:null,this.channelUrlsFilter=null!==(u=null==e?void 0:e.channelUrlsFilter)&&void 0!==u?u:null,this.superChannelFilter=null!==(c=null==e?void 0:e.superChannelFilter)&&void 0!==c?c:Wt.ALL,this.publicChannelFilter=null!==(l=null==e?void 0:e.publicChannelFilter)&&void 0!==l?l:zt.ALL,this.customTypeStartsWithFilter=null!==(h=null==e?void 0:e.customTypeStartsWithFilter)&&void 0!==h?h:null,this.unreadChannelFilter=null!==(d=null==e?void 0:e.unreadChannelFilter)&&void 0!==d?d:Qt.ALL,this.hiddenChannelFilter=null!==(_=null==e?void 0:e.hiddenChannelFilter)&&void 0!==_?_:Kt.UNHIDDEN,this.includeFrozen=null===(p=null==e?void 0:e.includeFrozen)||void 0===p||p,(null==e?void 0:e.createdAfter)&&(this.createdAfter=e.createdAfter),(null==e?void 0:e.createdBefore)&&(this.createdBefore=e.createdBefore)}return e.prototype._isFriend=function(e){return!(!e||!e.friendDiscoveryKey&&!e.friendName)},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=Jt.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t,n=new e;this.searchFilter&&n.setSearchFilter(this.searchFilter.fields,null!==(t=this.searchFilter.query)&&void 0!==t?t:void 0),this.userIdsFilter&&n.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var s=JSON.parse(JSON.stringify(this));return Object.keys(s).forEach((function(e){n[e]=s[e]})),n},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,s=n.query,r=n.fields;if(s&&r&&r.length>0&&!r.some((function(t){switch(t){case Xt.CHANNEL_NAME:return e.name.toLowerCase().includes(s.toLowerCase());case Xt.MEMBER_NICKNAME:return e.members.some((function(e){return e.nickname.toLowerCase().includes(s.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var i=this._userIdsFilter,o=i.userIds,u=i.includeMode,c=i.queryType,l=e.members.map((function(e){return e.userId}));if(u){if(o.length>0)switch(c){case Jt.AND:if(o.some((function(e){return!l.includes(e)})))return!1;break;case Jt.OR:if(o.every((function(e){return!l.includes(e)})))return!1}}else{if(o.includes(t)||o.push(t),e.members.length>o.length)return!1;if(!a(o,l))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var h=this.nicknameContainsFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().includes(h)})))return!1}if(this.nicknameStartsWithFilter){var d=this.nicknameStartsWithFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().startsWith(d)})))return!1}if(this.nicknameExactMatchFilter){var _=this.nicknameExactMatchFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase()!=_})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case jt.ALL:if("none"===e.myMemberState)return!1;break;case jt.JOINED:if("joined"!==e.myMemberState)return!1;break;case jt.INVITED:if("invited"!==e.myMemberState)return!1;break;case jt.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case jt.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case Kt.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case Kt.HIDDEN:if(!e.isHidden)return!1;break;case Kt.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case Kt.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===Qt.UNREAD_MESSAGE)if(0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case zt.PUBLIC:if(!e.isPublic)return!1;break;case zt.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case Wt.SUPER:if(!e.isSuper)return!1;break;case Wt.NON_SUPER:if(e.isSuper)return!1}return!(this.createdAfter&&e.createdAt<this.createdAfter)&&!(this.createdBefore&&e.createdAt>this.createdBefore)},e}(),tn=function(t){function n(e,n){var s=n.sdkState,r=n.cacheContext,i=t.call(this,e)||this;return i._channels=new Map,i._sdkState=s,i._cacheContext=r,i}return e(n,t),Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return o(!!e).throw(u.databaseError),e.collection(ge)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e,t){return void 0===t&&(t=0),s(s({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},n.prototype._deserialize=function(e){return hs.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(n.prototype,"channels",{get:function(){return c([],l(this._channels.values()),!1)},enumerable:!1,configurable:!0}),n.prototype.isCachedInMemory=function(e){return this._channels.has(e)},n.prototype.filterOffsetChanged=function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))},n.prototype.get=function(e){return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(s){switch(s.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=s.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];s.label=2;case 2:return[2,void 0];case 3:return[2,this._channels.get(e)]}}))}))},n.prototype.fetch=function(e){var t=e.token,n=e.limit,s=void 0===n?Ee:n,r=e.backward,i=void 0!==r&&r,a=e.filter,o=void 0===a?new en:a,u=e.order,c=void 0===u?Nt.LATEST_LAST_MESSAGE:u,l=e.borderlineChannelUrl;return h(this,void 0,void 0,(function(){var e,n,r,a,u=this;return d(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=Ut(c),n={where:function(e){if(t)switch(c){case Nt.CHANNEL_NAME_ALPHABETICAL:if(!i&&e.name.localeCompare(t)<0||i&&e.name.localeCompare(t)>0)return!1;if(l&&l===e.url)return!1;break;case Nt.CHRONOLOGICAL:if(!i&&e.createdAt>t||i&&e.createdAt<t)return!1;if(l&&l===e.url)return!1;break;case Nt.LATEST_LAST_MESSAGE:if(!i&&e.lastMessageUpdatedAt>t||i&&e.lastMessageUpdatedAt<t)return!1;if(l&&l===e.url)return!1}return o.match(u._deserialize(e),u._sdkState.userId)},index:e,backward:i},[4,this.collection.query(n)]):[3,3];case 1:return[4,h.sent().fetch({limit:s})];case 2:return r=h.sent(),(a=r.map((function(e){return u._deserialize(e)}))).forEach((function(e){u._channels.has(e.url)||u._channels.set(e.url,e)})),[2,a];case 3:return[2,[]]}}))}))},n.prototype.upsert=function(e,t){return h(this,void 0,void 0,(function(){var n,s,r,i=this;return d(this,(function(a){switch(a.label){case 0:if(n=[],e.forEach((function(e){if(i._channels.has(e.url)){var s=i._channels.get(e.url);s._pinnedMessagesUpdatedAt<e._pinnedMessagesUpdatedAt&&(s._pinnedMessagesUpdatedAt=e._pinnedMessagesUpdatedAt),s._messageCollectionLastAccessedAt>e._messageCollectionLastAccessedAt&&Object.assign(e,{_messageCollectionLastAccessedAt:void 0}),e.cachedMetaData&&t&&(s._updateCachedMetaData(e.cachedMetaData,t),Object.assign(e,{_cachedMetaData:void 0})),s._update(e),n.push(s)}else i._channels.set(e.url,e),n.push(e)})),!this.localCacheEnabled)return[3,2];for(s=[],r=0;r<n.length;r++)s.push(this._serialize(n[r],r));return[4,this.collection.upsertMany(s)];case 1:a.sent(),a.label=2;case 2:return[2,n]}}))}))},n.prototype.remove=function(e){return h(this,void 0,void 0,(function(){var t,n,s,r,i,a;return d(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),t=p(e),n=t.next(),o.label=1;case 1:return n.done?[3,4]:(s=n.value,this._channels.delete(s),this.localCacheEnabled?[4,this.collection.remove(s)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=o.sent(),i={error:r},[3,7];case 6:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}}))}))},n.prototype.clear=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.clearMemoryCache=function(){this._channels.clear()},n.prototype._setBlockStateOfAllChannels=function(e,t,n){return h(this,void 0,void 0,(function(){var s,r,i,a,o,u,c,l,h,_,f,v,m,g,E,C,y,M,b;return d(this,(function(d){switch(d.label){case 0:if(s=[],e===this._sdkState.userId)try{for(r=p(this._channels.values()),i=r.next();!i.done;i=r.next()){l=i.value;try{for(g=void 0,a=p(l.members),o=a.next();!o.done;o=a.next())if((f=o.value).userId===t){f.isBlockedByMe=n,s.push(l);break}}catch(e){g={error:e}}finally{try{o&&!o.done&&(E=a.return)&&E.call(a)}finally{if(g)throw g.error}}}}catch(e){v={error:e}}finally{try{i&&!i.done&&(m=r.return)&&m.call(r)}finally{if(v)throw v.error}}else if(t===this._sdkState.userId)try{for(u=p(this._channels.values()),c=u.next();!c.done;c=u.next()){l=c.value;try{for(M=void 0,h=p(l.members),_=h.next();!_.done;_=h.next())if((f=_.value).userId===e){f.isBlockingMe=n,s.push(l);break}}catch(e){M={error:e}}finally{try{_&&!_.done&&(b=h.return)&&b.call(h)}finally{if(M)throw M.error}}}}catch(e){C={error:e}}finally{try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(C)throw C.error}}return s.length>0?[4,this.upsert(s)]:[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))}))},n.prototype.block=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},n.prototype.unblock=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},n.prototype.markAsRead=function(e,t){return void 0===t&&(t=c([],l(this._channels.keys()),!1)),h(this,void 0,void 0,(function(){var n,s,r,i,a,o,u,c;return d(this,(function(l){switch(l.label){case 0:n=[],l.label=1;case 1:l.trys.push([1,6,7,8]),s=p(t),r=s.next(),l.label=2;case 2:return r.done?[3,5]:(i=r.value,[4,this.get(i)]);case 3:(null==(a=l.sent())?void 0:a._updateUnreadMemberState(this._sdkState.userId,e))&&(a._updateUnreadCount(0,0),n.push(a)),l.label=4;case 4:return r=s.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),u={error:o},[3,8];case 7:try{r&&!r.done&&(c=s.return)&&c.call(s)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:l.sent(),l.label=10;case 10:return[2]}}))}))},n}(_),nn={invitedUserIds:void 0,channelUrl:void 0,coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isSuper:void 0,isBroadcast:void 0,isExclusive:void 0,isPublic:void 0,isDiscoverable:void 0,isStrict:void 0,isEphemeral:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},sn=function(e){return f("string",e.invitedUserIds,!0)&&v("string",e.channelUrl,!0)&&v("string",e.coverUrl,!0)&&(m(e.coverImage)||v("string",e.coverImage,!0))&&v("boolean",e.isDistinct,!0)&&v("boolean",e.isSuper,!0)&&v("boolean",e.isBroadcast,!0)&&v("boolean",e.isExclusive,!0)&&v("boolean",e.isPublic,!0)&&v("boolean",e.isStrict,!0)&&v("boolean",e.isDiscoverable,!0)&&v("boolean",e.isEphemeral,!0)&&v("string",e.accessCode,!0)&&v("string",e.name,!0)&&v("string",e.data,!0)&&v("string",e.customType,!0)&&f("string",e.operatorUserIds,!0)&&v("number",e.messageSurvivalSeconds,!0)},rn={customTypes:void 0,includeEmpty:!1,includeFrozen:!0,includeChatNotification:!1},an=function(e){return f("string",e.customTypes,!0)&&v("boolean",e.includeEmpty)&&v("boolean",e.includeFrozen)&&v("boolean",e.includeChatNotification)},on={myMemberStateFilter:jt.ALL},un=function(e){return r(jt,e.myMemberStateFilter)};!function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}($t||($t={}));var cn={keys:[]},ln={channelCustomTypesFilter:void 0,superChannelFilter:Wt.ALL},hn=function(e){return f("string",e.channelCustomTypesFilter,!0)&&r(Wt,e.superChannelFilter)},dn={channelUrl:void 0,scheduledStatus:void 0,messageTypeFilter:g.ALL},_n=s({},E),pn=function(e){return e.startsWith("EVENT_")||e===E.SYNC_CHANNEL_CHANGELOGS||e===E.REFRESH_CHANNEL},fn=function(t){function n(e){var n=e.channels,s=e.context,r=e.isWebSocketEventComing,i=void 0!==r&&r,a=e.ts,o=t.call(this)||this;return o.channels=n,o.context=s,o.isWebSocketEventComing=i,o.ts=a,o}return e(n,t),n}(C),vn=function(t){function n(e){var n=e.channelUrls,s=e.context,r=e.isWebSocketEventComing,i=void 0!==r&&r,a=t.call(this)||this;return a.channelUrls=n,a.context=s,a.isWebSocketEventComing=i,a}return e(n,t),n}(C),mn=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,s=e.unsentMessageCache,r=e.dispatcher,i=this;this._observers=new Map,r.on((function(e){return h(i,void 0,void 0,(function(){var r,i,a,o,u,c,l,_,f,v,m,g,C,M,b,N,U,S,T=this;return d(this,(function(A){switch(A.label){case 0:if(!(e instanceof fn))return[3,19];if(r=e.channels,C=e.context,M=e.isWebSocketEventComing,i=r.filter((function(e){return e instanceof dr})),C.source!==E.EVENT_CHANNEL_RESET_HISTORY&&C.source!==E.EVENT_CHANNEL_HIDDEN)return[3,9];A.label=1;case 1:A.trys.push([1,6,7,8]),a=p(i),o=a.next(),A.label=2;case 2:return o.done?[3,5]:(f=o.value,[4,n.removeUnderOffset(f.url,f.messageOffsetTimestamp)]);case 3:A.sent(),A.label=4;case 4:return o=a.next(),[3,2];case 5:return[3,8];case 6:return u=A.sent(),b={error:u},[3,8];case 7:try{o&&!o.done&&(N=a.return)&&N.call(a)}finally{if(b)throw b.error}return[7];case 8:return[3,17];case 9:c=t.filterOffsetChanged(i),A.label=10;case 10:A.trys.push([10,15,16,17]),l=p(c),_=l.next(),A.label=11;case 11:return _.done?[3,14]:(f=_.value,[4,n.removeUnderOffset(f.url,f.messageOffsetTimestamp)]);case 12:A.sent(),A.label=13;case 13:return _=l.next(),[3,11];case 14:return[3,17];case 15:return v=A.sent(),U={error:v},[3,17];case 16:try{_&&!_.done&&(S=l.return)&&S.call(l)}finally{if(U)throw U.error}return[7];case 17:return[4,t.upsert(i,e.ts)];case 18:return m=A.sent(),M||this._broadcastUpdateEvent(m,C),[3,24];case 19:return e instanceof vn?(g=e.channelUrls,C=e.context,M=e.isWebSocketEventComing,[4,t.remove(g)]):[3,22];case 20:return A.sent(),[4,y((function(){return h(T,void 0,void 0,(function(){var e,t,r,i,a,o;return d(this,(function(u){switch(u.label){case 0:u.trys.push([0,6,7,8]),e=p(g),t=e.next(),u.label=1;case 1:return t.done?[3,5]:(r=t.value,[4,n.removeMessagesOfChannel(r)]);case 2:return u.sent(),[4,s.removeMessagesOfChannel(r)];case 3:u.sent(),u.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return i=u.sent(),a={error:i},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))}))];case 21:return A.sent(),M||this._broadcastRemoveEvent(g,C),[3,24];case 22:return e instanceof St?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,24];case 23:A.sent(),A.label=24;case 24:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,s;try{for(var r=p(this._observers.values()),i=r.next();!i.done;i=r.next()){var a=i.value;a.onUpdate&&a.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,s;try{for(var r=p(this._observers.values()),i=r.next();!i.done;i=r.next()){var a=i.value;a.onRemove&&a.onRemove(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e.prototype.unsubscribeAll=function(){this._observers.clear()},e}(),gn=function(r){function i(e){var i=e.userId,a=e.ts,o=e.token,u=e.filter,c=e.includeChatNotification,l=void 0!==c&&c,h=r.call(this)||this,d=s(s({},rn),u),_=d.customTypes,p=d.includeEmpty,f=d.includeFrozen;return h.method=M.GET,h.path="".concat(b,"/").concat(encodeURIComponent(i),"/my_group_channels/changelogs"),h.params=t(n({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:a||null,token:o,custom_types:_,show_empty:p,show_frozen:f,include_chat_notification:l})),h}return e(i,r),i}(N),En=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.updatedChannels=n.updated.map((function(t){return new dr(e,Object.assign(t,{ts:n.ts}))})),s.deletedChannelUrls=n.deleted,s.hasMore=n.has_more,s.token=n.next,s.ts=n.ts,s}return e(n,t),n}(U),Cn=function(t){function n(e){var n=e.channelUrl,s=e.isInternalCall,r=t.call(this)||this;return r.method=M.GET,r.path="".concat(s?S:T,"/").concat(encodeURIComponent(n)),r.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},r}return e(n,t),n}(N),yn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new dr(e,n),s}return e(n,t),n}(U),Mn={includeEmpty:!1,includeFrozen:!0,includeMetaData:!0,includeChatNotification:!1,channelUrlsFilter:void 0,customTypesFilter:void 0,customTypeStartsWithFilter:void 0,nicknameContainsFilter:void 0,nicknameStartsWithFilter:void 0,nicknameExactMatchFilter:void 0,channelNameContainsFilter:void 0,myMemberStateFilter:jt.ALL,unreadChannelFilter:Qt.ALL,superChannelFilter:Wt.ALL,publicChannelFilter:zt.ALL,hiddenChannelFilter:Kt.ALL,userIdsFilter:{userIds:[],includeMode:!0,queryType:Jt.AND},searchFilter:{query:void 0,fields:[]},metadataKey:void 0,metadataValues:void 0,metadataOrderKeyFilter:void 0,metadataValueStartsWith:void 0,order:Nt.LATEST_LAST_MESSAGE,createdAfter:void 0,createdBefore:void 0},bn=function(n){function s(e){var s=this,r=e.userId,i=e.token,a=e.limit,o=e.order,u=e.includeEmpty,c=e.myMemberStateFilter,l=e.superChannelFilter,h=e.publicChannelFilter,d=e.unreadChannelFilter,_=e.nicknameContainsFilter,p=e.nicknameStartsWithFilter,f=e.nicknameExactMatchFilter,v=e.channelNameContainsFilter,m=e.channelUrlsFilter,g=e.customTypesFilter,E=e.customTypeStartsWithFilter,C=e.hiddenChannelFilter,y=e.metadataOrderKeyFilter,N=e.metadataKey,U=e.metadataValues,S=e.metadataValueStartsWith,T=e.includeFrozen,A=e.includeMetaData,I=e.searchFilter,w=e.userIdsFilter,L=e.includeChatNotification,D=void 0!==L&&L,x=e.includeLeftChannel,R=void 0!==x&&x,F=e.createdAfter,P=e.createdBefore;return(s=n.call(this)||this).method=M.GET,s.path="".concat(b,"/").concat(encodeURIComponent(r),"/my_group_channels"),s.params=t({token:i,limit:a,order:null!=o?o:Mn.order,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:null!=u?u:Mn.includeEmpty,member_state_filter:null!=c?c:Mn.myMemberStateFilter,super_mode:null!=l?l:Mn.superChannelFilter,public_mode:null!=h?h:Mn.publicChannelFilter,unread_filter:null!=d?d:Mn.unreadChannelFilter,members_nickname_contains:_,members_nickname_startswith:p,members_nickname:f,name_contains:v,channel_urls:m,custom_types:g,custom_type_startswith:E,hidden_mode:C,metadata_order_key:y,metadata_key:N,metadata_values:U,metadata_value_startswith:S,show_frozen:T,show_metadata:A,include_chat_notification:D,include_left_channel:R,created_after:F,created_before:P}),I&&I.query&&I.fields&&(s.params.search_query=I.query,s.params.search_fields=I.fields),w&&w.userIds&&w.userIds.length>0&&(w.includeMode?(s.params.members_include_in=w.userIds,s.params.query_type=w.queryType.toUpperCase()):s.params.members_exactly_in=w.userIds),s}return e(s,n),s}(N),Nn=function(t){function n(e,n){var s=t.call(this,e,n)||this;s.channels=[];var r=n.next,i=n.channels,a=n.ts;return s.token=r,i&&i.length>0&&(s.channels=i.map((function(t){return t.ts=a,new dr(e,t)}))),s.ts=null!=a?a:0,s}return e(n,t),n}(U),Un=function(t){function n(e){var n=e.userId,s=e.filter,r=t.call(this)||this,i=s.myMemberStateFilter;return r.method=M.GET,r.path="".concat(b,"/").concat(encodeURIComponent(n),"/group_channel_count"),r.params={state:null!=i?i:jt.ALL},r}return e(n,t),n}(N),Sn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.groupChannelCount=n.group_channel_count,s}return e(n,t),n}(U),Tn=function(n){function s(e){var s=e.userId,r=e.filter,i=n.call(this)||this,a=r.keys;return i.method=M.GET,i.path="".concat(b,"/").concat(encodeURIComponent(s),"/unread_item_count"),i.params=t({item_keys:a}),i}return e(s,n),s}(N),An=function(t){function n(e,n){var s=t.call(this,e,n)||this;return"number"==typeof n[$t.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(s.groupChannelUnreadMentionCount=n[$t.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[$t.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(s.groupChannelUnreadMessageCount=n[$t.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[$t.GROUP_CHANNEL_INVITATION_COUNT]&&(s.groupChannelInvitationCount=n[$t.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[$t.SUPER_UNREAD_MENTION_COUNT]&&(s.superGroupChannelUnreadMentionCount=n[$t.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[$t.SUPER_UNREAD_MESSAGE_COUNT]&&(s.superGroupChannelUnreadMessageCount=n[$t.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[$t.SUPER_INVITATION_COUNT]&&(s.superGroupChannelInvitationCount=n[$t.SUPER_INVITATION_COUNT]),"number"==typeof n[$t.NONSUPER_UNREAD_MENTION_COUNT]&&(s.nonSuperGroupChannelUnreadMentionCount=n[$t.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[$t.NONSUPER_UNREAD_MESSAGE_COUNT]&&(s.nonSuperGroupChannelUnreadMessageCount=n[$t.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[$t.NONSUPER_INVITATION_COUNT]&&(s.nonSuperGroupChannelInvitationCount=n[$t.NONSUPER_INVITATION_COUNT]),s}return e(n,t),n}(U),In=function(t){function n(e){var n=e.userId,s=t.call(this)||this;return s.method=M.GET,s.path="".concat(b,"/").concat(encodeURIComponent(n),"/unread_channel_count"),s}return e(n,t),n}(N),wn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.unreadCount=n.unread_count,s}return e(n,t),n}(U),Ln=function(t){function n(e){var n=e.userId,s=e.filter,r=e.includeFeedChannel,i=void 0!==r&&r,a=t.call(this)||this,o=s.channelCustomTypesFilter,u=s.superChannelFilter;return a.method=M.GET,a.path="".concat(b,"/").concat(encodeURIComponent(n),"/unread_message_count"),a.params={super_mode:null!=u?u:Wt.ALL,custom_types:o,include_feed_channel:i},a}return e(n,t),n}(N),Dn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.unreadCount=n.unread_count,s.unreadFeedCount=n.unread_feed_count,s}return e(n,t),n}(U),xn=function(t){function n(e){var n=e.channelUrl,s=e.scheduledStatus,r=e.messageTypeFilter,i=t.call(this)||this;return i.method=M.GET,i.path="".concat(A,"/count"),i.params={channel_url:n,status:Fn(s)},r&&(i.params.message_type=r),i}return e(n,t),n}(N),Rn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.count=n.count,s}return e(n,t),n}(U),Fn=function(e){if(!e)return[];var t=[];return e.forEach((function(e){switch(e){case Ce.PENDING:t.push(ye.PENDING);break;case Ce.SENT:t.push(ye.IN_QUEUE),t.push(ye.SENT);break;case Ce.CANCELED:t.push(ye.CANCELED);break;case Ce.FAILED:t.push(ye.FAILED)}})),t},Pn=function(n){function s(e){var s=this,r=e.userId,i=e.channelUrl,a=e.coverUrl,o=e.coverImage,u=e.isDistinct,h=e.isSuper,d=e.isBroadcast,_=e.isPublic,p=e.isExclusive,f=e.isDiscoverable,v=e.isStrict,m=e.isEphemeral,g=e.accessCode,E=e.name,C=e.data,y=e.customType,b=e.messageSurvivalSeconds,N=e.invitedUserIds,U=e.operatorUserIds;return(s=n.call(this)||this).method=M.POST,s.path=T,s.params=t({user_ids:c([r],l(null!=N?N:[]),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:i,cover_url:a,cover_file:o,is_distinct:u,is_super:h,is_broadcast:d,is_exclusive:p,is_public:_,is_discoverable:f,strict:v,is_ephemeral:m,access_code:g,name:E,data:C,custom_type:y,operator_ids:U,message_survival_seconds:b}),s}return e(s,n),s}(N),kn=function(t){function n(e,n){var s,r=this;return(r=t.call(this,e,n)||this).channel=new dr(e,n),r.isCreated=null===(s=n.is_created)||void 0===s||s,r}return e(n,t),n}(U),On=function(t){function n(e){var n=e.userId,s=e.channelUrls,r=t.call(this)||this;return r.method=M.PUT,r.path="".concat(b,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),r.params={channel_urls:s},r}return e(n,t),n}(N);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(U);var Hn=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,i=e.accessCode;return(n=t.call(this)||this).method=M.PUT,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/join"),n.params={user_id:r,access_code:i},n}return e(n,t),n}(N),Vn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new dr(e,n),s}return e(n,t),n}(U),Gn=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this,i=s.data,a=i.member_count,o=void 0===a?0:a,u=i.joined_member_count,c=void 0===u?0:u,l=i.users,h=void 0===l?null:l;return r.memberCount=o,r.joinedMemberCount=c,r.members=Array.isArray(h)?h.map((function(t){return new Zt(e,t)})):[new Zt(e,s.data)],r}return e(n,t),n}(xt),Bn=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,i=e.shouldRemoveOperatorStatus;return(n=t.call(this)||this).method=M.PUT,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/leave"),n.params={user_id:r,should_remove_operator_status:i},n}return e(n,t),n}(N);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(U);var qn=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this,i=s.data,a=i.member_count,o=void 0===a?0:a,u=i.joined_member_count,c=void 0===u?0:u;return r.memberCount=o,r.joinedMemberCount=c,r.member=new Zt(r._iid,s.data),r}return e(n,t),n}(xt),zn=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userIds;return(n=t.call(this)||this).method=M.POST,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/invite"),n.params={user_ids:r},n}return e(n,t),n}(N),jn=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new dr(e,n),s}return e(n,t),n}(U),Wn=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this;r.inviter=null;var i=s.data,a=i.member_count,o=void 0===a?0:a,u=i.joined_member_count,c=void 0===u?0:u,l=i.inviter,h=i.invitees,d=void 0===h?[]:h;return r.memberCount=o,r.joinedMemberCount=c,l&&Object.keys(l).length>0&&(r.inviter=new I(e,l)),r.invitees=d.map((function(t){return new Zt(e,t)})),r}return e(n,t),n}(xt),Qn=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId;return(n=t.call(this)||this).method=M.PUT,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/decline"),n.params={user_id:r},n}return e(n,t),n}(N);!function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new dr(e,n),s.channel.myMemberState=qt.NONE,s}e(n,t)}(U);var Kn=function(t){function n(e,n,s){var r=t.call(this,e,n,s)||this,i=s.data,a=i.member_count,o=i.joined_member_count,u=i.inviter,c=i.invitee;return r.memberCount=null!=a?a:0,r.joinedMemberCount=null!=o?o:0,r.inviter=new I(e,u),r.invitee=new Zt(e,c),r}return e(n,t),n}(xt),Yn={hidePreviousMessages:!1,allowAutoUnhide:!0},Jn=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,i=e.hidePreviousMessages,a=e.allowAutoUnhide;return(n=t.call(this)||this).method=M.PUT,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/hide"),n.params={user_id:r,hide_previous_messages:null!=i?i:Yn.hidePreviousMessages,allow_auto_unhide:null!=a?a:Yn.allowAutoUnhide},n}return e(n,t),n}(N),Xn=function(t){function n(e,n){var s=t.call(this,e,n)||this,r=n.ts_message_offset;return s.messageOffsetTimestamp=r,s}return e(n,t),n}(U),Zn=function(t){function n(e,n,s){var r,i,a,o=this;return(o=t.call(this,e,"SYEV",s)||this).allowAutoUnhide=null,o.hidePreviousMessages=null,o.messageOffsetTimestamp=null,s.data&&(o.allowAutoUnhide=null!==(r=s.data.allow_auto_unhide)&&void 0!==r?r:null,o.hidePreviousMessages=null!==(i=s.data.hide_previous_messages)&&void 0!==i?i:null),o.messageOffsetTimestamp=null!==(a=s.ts_message_offset)&&void 0!==a?a:null,o}return e(n,t),n}(w),$n=function(t){function n(e){var n=e.channelUrl,s=e.time;return t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:s}})||this}return e(n,t),n}(L),es=function(t){function n(e,n,s){var r=t.call(this,e,"SYEV",s)||this;return r.user=new I(e,s.data),r}return e(n,t),n}(w),ts=function(t){function n(e){var n=e.channelUrl,s=e.time;return t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:s}})||this}return e(n,t),n}(L),ns=function(t){function n(e,n,s){var r=t.call(this,e,"SYEV",s)||this;return r.user=new I(e,s.data),r}return e(n,t),n}(w),ss=function(t){function n(e){var n=e.channelUrl,s=e.messageId;return t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:s}})||this}return e(n,t),n}(L),rs=function(t){function i(e,n){var s,r,i,a,o,u,c,l,h,d,_,p,f,v,m,g,E,C,y,M,b,N,U,S=this;return(S=t.call(this,e,n)||this).includeEmpty=!1,S.includeFrozen=!0,S.includeMetaData=!0,S.includeChatNotification=!1,S.channelUrlsFilter=null,S.customTypesFilter=null,S.customTypeStartsWithFilter=null,S.nicknameContainsFilter=null,S.nicknameStartsWithFilter=null,S.nicknameExactMatchFilter=null,S.channelNameContainsFilter="",S.myMemberStateFilter=jt.ALL,S.unreadChannelFilter=Qt.ALL,S.superChannelFilter=Wt.ALL,S.publicChannelFilter=zt.ALL,S.hiddenChannelFilter=Kt.UNHIDDEN,S.searchFilter={fields:[],query:null},S.userIdsFilter={userIds:[],includeMode:!0,queryType:Jt.AND},S.metadataKey=null,S.metadataValues=null,S.metadataOrderKeyFilter=null,S.metadataValueStartsWith=null,S.order=Nt.LATEST_LAST_MESSAGE,S.includeEmpty=null!==(s=n.includeEmpty)&&void 0!==s&&s,S.includeFrozen=null===(r=n.includeFrozen)||void 0===r||r,S.includeMetaData=null===(i=n.includeMetaData)||void 0===i||i,S.includeChatNotification=null!==(a=n.includeChatNotification)&&void 0!==a&&a,S.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,S.customTypesFilter=null!==(u=n.customTypesFilter)&&void 0!==u?u:null,S.customTypeStartsWithFilter=null!==(c=n.customTypeStartsWithFilter)&&void 0!==c?c:"",S.nicknameContainsFilter=null!==(l=n.nicknameContainsFilter)&&void 0!==l?l:null,S.nicknameStartsWithFilter=null!==(h=n.nicknameStartsWithFilter)&&void 0!==h?h:null,S.nicknameExactMatchFilter=null!==(d=n.nicknameExactMatchFilter)&&void 0!==d?d:null,S.channelNameContainsFilter=null!==(_=n.channelNameContainsFilter)&&void 0!==_?_:"",S.myMemberStateFilter=null!==(p=n.myMemberStateFilter)&&void 0!==p?p:jt.ALL,S.unreadChannelFilter=null!==(f=n.unreadChannelFilter)&&void 0!==f?f:Qt.ALL,S.superChannelFilter=null!==(v=n.superChannelFilter)&&void 0!==v?v:Wt.ALL,S.publicChannelFilter=null!==(m=n.publicChannelFilter)&&void 0!==m?m:zt.ALL,S.hiddenChannelFilter=null!==(g=n.hiddenChannelFilter)&&void 0!==g?g:Kt.UNHIDDEN,S.searchFilter=null!==(E=n.searchFilter)&&void 0!==E?E:{fields:[],query:null},S.userIdsFilter=null!==(C=n.userIdsFilter)&&void 0!==C?C:{userIds:[],includeMode:!0,queryType:Jt.AND},S.metadataKey=null!==(y=n.metadataKey)&&void 0!==y?y:null,S.metadataValues=null!==(M=n.metadataValues)&&void 0!==M?M:null,S.metadataOrderKeyFilter=null!==(b=n.metadataOrderKeyFilter)&&void 0!==b?b:null,S.metadataValueStartsWith=null!==(N=n.metadataValueStartsWith)&&void 0!==N?N:null,S.order=null!==(U=n.order)&&void 0!==U?U:Nt.LATEST_LAST_MESSAGE,n.createdAfter&&(S.createdAfter=n.createdAfter),n.createdBefore&&(S.createdBefore=n.createdBefore),S}return e(i,t),i.prototype._validate=function(){return t.prototype._validate.call(this)&&v("boolean",this.includeEmpty)&&v("boolean",this.includeFrozen)&&v("boolean",this.includeMetaData)&&v("string",this.channelNameContainsFilter)&&f("string",this.channelUrlsFilter,!0)&&f("string",this.customTypesFilter,!0)&&v("string",this.customTypeStartsWithFilter)&&v("string",this.nicknameContainsFilter,!0)&&v("string",this.nicknameStartsWithFilter,!0)&&v("string",this.nicknameExactMatchFilter,!0)&&r(jt,this.myMemberStateFilter)&&r(Wt,this.superChannelFilter)&&r(zt,this.publicChannelFilter)&&r(Qt,this.unreadChannelFilter)&&r(Kt,this.hiddenChannelFilter)&&f(Xt,this.searchFilter.fields)&&v("string",this.searchFilter.query,!0)&&f("string",this.userIdsFilter.userIds)&&v("boolean",this.userIdsFilter.includeMode)&&r(Jt,this.userIdsFilter.queryType)&&r(Nt,this.order)&&v("string",this.metadataOrderKeyFilter,!0)&&v("string",this.metadataKey,!0)&&f("string",this.metadataValues,!0)&&v("string",this.metadataValueStartsWith,!0)&&D(this.createdAfter,!0)&&D(this.createdBefore,!0)},i.prototype.serialize=function(){return x(this)},i.prototype.next=function(){return h(this,void 0,void 0,(function(){var e,t,r;return d(this,(function(i){switch(i.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,hs.of(this._iid).getMyGroupChannels(this._token,n(s({},this)),this.limit,E.REQUEST_CHANNEL,!0)]):[3,2]:[3,5];case 1:return e=i.sent(),t=e.channels,r=e.token,this._token=r,this._hasNext=!!r,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw u.queryInProgress;case 4:return[3,6];case 5:throw u.invalidParameters;case 6:return[2]}}))}))},i}(R),is=function(t){function n(e,n,r){var i,a=this;return(a=t.call(this,e,"SYEV",r)||this).pinnedMessageIds=[],a.latestPinnedMessage=null,a.ts=0,r.data&&(a.pinnedMessageIds=null!==(i=r.data.pinned_message_ids)&&void 0!==i?i:[],a.latestPinnedMessage=r.data.latest_pinned_message?Me(e,s({},r.data.latest_pinned_message)):null),a.ts=r.ts,a}return e(n,t),n}(w),as=function(n){function s(e){var s=e.channelUrl,r=e.userId,i=n.call(this)||this;return i.method=M.PUT,i.path="".concat(T,"/").concat(encodeURIComponent(s),"/messages/mark_as_delivered"),i.params=t({userId:r}),i}return e(s,n),s}(N);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(U);var os,us=function(t){function n(e,n,s){var r=t.call(this,e,"DLVR",s)||this;return r.channelUrl=s.channel_url,r.deliveredStateUpdate=s.updated,r}return e(n,t),n}(w),cs=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,s=e.bottom,r=void 0===s?0:s;this.top=n,this.bottom=r}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.intersect=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.some((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,c([this.top],l(e),!1)),this.bottom=Math.max.apply(Math,c([this.bottom],l(e),!1))},e}(),ls={},hs=function(a){function _(e,t){var n,r=this;return(r=a.call(this,e,s(s({},t),{channelType:k.GROUP}))||this)._leftChannels=new Map,r._disableMack=!1,r._markAsReadAllLastSentAt=0,r._disableMack=null!==(n=t.disableMack)&&void 0!==n&&n,r._groupChannelHandlers=new Map,r._groupChannelCache=new tn(r._iid,{sdkState:t.sdkState,cacheContext:t.cacheContext}),r._groupChannelBroadcast=new mn({dispatcher:t.dispatcher,groupChannelCache:r._groupChannelCache,messageCache:be.of(r._iid),unsentMessageCache:Ne.of(r._iid)}),setInterval((function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(r._dispatcher.dispatch(new fn({channels:[e],context:{source:E.EVENT_CHANNEL_TYPING_STATUS_UPDATE}})),r._groupChannelHandlers.forEach((function(t){t.onTypingStatusUpdated&&t.onTypingStatusUpdated(e)})))};try{for(var s=p(r._groupChannelCache.channels),i=s.next();!i.done;i=s.next()){n(i.value)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}}),1e3),r._dispatcher.on((function(e){e instanceof w?r._handleEvent(e).catch((function(e){if(O(e)&&"foreground"===r._sdkState.appState)throw e})):e instanceof Tt?h(r,void 0,void 0,(function(){var t,n;return d(this,(function(s){switch(s.label){case 0:return t=e.message,[4,this.getChannel(t.channelUrl,!0)];case 1:return n=s.sent(),t instanceof Se?n._autoResendUserMessage(t):t instanceof Te&&n._autoResendFileMessage(t),[2]}}))})):e instanceof At?r.reduceDBSize():e instanceof Ue&&h(r,void 0,void 0,(function(){var t,n,s,r,i,a=this;return d(this,(function(o){switch(o.label){case 0:return t=e.channelUrl,n=e.channelType,s=e.parentMessage,r=new Ae(this._iid,{channel_type:k.GROUP,channel_url:t,parent_message_id:s.messageId,thread_info:Ie.payloadify(s.threadInfo)}),n!==k.GROUP?[3,2]:[4,this.getChannel(t,!0)];case 1:i=o.sent(),H((function(){return h(a,void 0,void 0,(function(){var e,t,n,s,a;return d(this,(function(o){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onThreadInfoUpdated&&n.onThreadInfoUpdated(i,r)}catch(e){s={error:e}}finally{try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),o.label=2;case 2:return[2]}}))}))})),ls[e]||(ls[e]=r),r}return e(_,a),Object.defineProperty(_.prototype,"_messageCache",{get:function(){return be.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"_unsentMessageCache",{get:function(){return Ne.of(this._iid)},enumerable:!1,configurable:!0}),_.of=function(e){return ls[e]||(ls[e]=new _(e,F.of(e))),ls[e]},_.clear=function(e){ls[e]&&delete ls[e]},Object.defineProperty(_.prototype,"handlers",{get:function(){return c([],l(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),_.prototype.buildGroupChannelFromSerializedData=function(e){var t=P(e);return new dr(this._iid,dr.payloadify(t))},_.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=P(e);return new rs(this._iid,t)},_.prototype.buildMemberFromSerializedData=function(e){var t=P(e);return new Zt(this._iid,Zt.payloadify(t))},_.prototype.getChannelFromCache=function(e){var t;return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},_.prototype.getChannelsFromCache=function(e,t,n,s,r){return h(this,void 0,void 0,(function(){return d(this,(function(i){switch(i.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n,limit:s,borderlineChannelUrl:r})];case 1:return[2,i.sent()]}}))}))},_.prototype.upsertChannelsToCache=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.upsert(e)];case 1:return[2,t.sent()]}}))}))},_.prototype.removeChannelsFromCache=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.remove(e)];case 1:return t.sent(),[2]}}))}))},_.prototype.clearChannelsFromCache=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this._groupChannelCache.clear()];case 1:return e.sent(),[2]}}))}))},_.prototype.reduceDBSize=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r,i,a,o,u,c,l,h,_,p,f;return d(this,(function(d){switch(d.label){case 0:return e=be.of(this._iid),t=F.of(this._iid).cacheContext,n=t.localCacheConfig,s=t.nestdb,t.localCacheEnabled&&s&&s.state==Le.OPENED?(r=1024*n.maxSize*1024,[4,s.estimateUsage()]):[2];case 1:if((i=d.sent())<r)return[2];a=[],o=this._groupChannelCache.channels,u={},_=0,d.label=2;case 2:return _<o.length?[4,this.getMessagesFromCache(o[_].url,0,"prev",new we)]:[3,5];case 3:c=d.sent(),u[o[_].url]=JSON.stringify(c).length,l=new V({channel:o[_],cachedMessageCount:c.length}),a.push(l),d.label=4;case 4:return _++,[3,2];case 5:h=a.sort(n.clearOrderComparator),_=0,d.label=6;case 6:return _<h.length?[4,e.removeMessagesOfChannel(h[_].channel.url)]:[3,10];case 7:return d.sent(),[4,e._getGroupChannelPreferenceSize(h[_].channel.url)];case 8:if(p=d.sent(),f=u[h[_].channel.url]+p,(i-=f)<r)return[3,10];d.label=9;case 9:return _++,[3,6];case 10:return[2]}}))}))},_.prototype._handleEvent=function(e){var t,n;return h(this,void 0,void 0,(function(){var s,r,a,o,u,c,l,_,f,v,m,g,C,M,b,N,U,S,T,A,I,w,L,D,x,R,P,V,Y,X,Z,$,ee,te,ne,se,re,ie,ae,oe,ue,ce,le,he,de,_e,pe,fe,ve,me,ge,Ee,Ce,ye,Me,be,Ne,Ue,Se,Te,Ae,Ie,we,Le,Qe,Ke,Ye,Je,Xe,Ze,$e,et,tt,nt,st,rt,it,at,ot,ut,ct,lt,ht,dt,_t,pt,ft,vt,mt,gt,Et,Ct,yt,Mt,bt,Nt,Ut,St,Tt,At,Dt,Rt,zt,jt,Wt,Qt,Kt,Yt,Jt,Xt,Zt,$t,en,tn,nn,sn,rn,an,on,un,cn,ln,hn,dn,_n,pn,mn,gn,En,Cn,yn,Mn,bn,Nn,Un,Sn,Tn,An,In,wn,Ln=this;return d(this,(function(Dn){switch(Dn.label){case 0:switch(Dn.trys.push([0,80,,81]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"PEDI":return[3,32];case"VOTE":return[3,35];case"SYEV":return[3,38];case"USEV":return[3,78]}return[3,79];case 1:return _=null,"MESG"===e.code?_=e.as(je):"FILE"===e.code?_=e.as(We):"ADMM"!==e.code&&"BRDM"!=e.code||(_=e.as(Bt)),_?(s=_.message,r=_.isMentioned,a=_.forceUpdateLastMessage,s.channelType!==k.GROUP?[3,3]:(this._disableMack||y((function(){return h(Ln,void 0,void 0,(function(){var e;return d(this,(function(t){return e=new ss(s),this._requestQueue.send(e),[2]}))}))})),V=this._groupChannelCache.isCachedInMemory(s.channelUrl),w=s instanceof Be&&s.sender.userId===this._sdkState.userId,[4,this.getChannel(s.channelUrl,!0)])):[3,3];case 2:if((o=Dn.sent()).hiddenState===ar.HIDDEN_ALLOW_AUTO_UNHIDE&&(o.hiddenState=ar.UNHIDDEN),s instanceof Be){u=F.of(this._iid).useMemberInfoInMessage;try{for(c=p(o.members),l=c.next();!l.done;l=c.next())if((yt=l.value).userId===s.sender.userId){u||(s.sender.nickname=yt.nickname,s.sender.plainProfileUrl=yt.plainProfileUrl,s.sender.metaData=yt.metaData,s.sender.isBlockedByMe=yt.isBlockedByMe);break}}catch(e){yn={error:e}}finally{try{l&&!l.done&&(Mn=c.return)&&Mn.call(c)}finally{if(yn)throw yn.error}}!u&&r&&(null===(t=s.mentionedUsers)||void 0===t||t.forEach((function(e){var t,n;try{for(var s=p(o.members),r=s.next();!r.done;r=s.next()){var i=r.value;if(e.userId===i.userId){e.nickname=i.nickname,e.plainProfileUrl=i.plainProfileUrl,e.metaData=i.metaData;break}}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}}))),w&&(M=this._sessionManager.currentUser)&&(M.nickname=s.sender.nickname,M.plainProfileUrl=s.sender.plainProfileUrl,M.metaData=s.sender.metaData)}s.silent&&!w||(o.isEphemeral||V)&&(o._updateLastMessage(s),w||o._updateUnreadCount(o.unreadMessageCount+1,o.unreadMentionCount+(r?1:0))),a&&o._updateLastMessage(s),this._dispatcher.dispatch(new fn({channels:[o],context:{source:E.EVENT_MESSAGE_RECEIVED}})),s.silent&&!w||H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(o)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),this._dispatcher.dispatch(new j({messages:[s],source:E.EVENT_MESSAGE_RECEIVED})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,i,a;return d(this,(function(u){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageReceived&&n.onMessageReceived(o,s),r&&n.onMentionReceived&&n.onMentionReceived(o,s)}catch(e){i={error:e}}finally{try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(i)throw i.error}}return[2]}))}))})),Dn.label=3;case 3:return[3,79];case 4:return _=null,"MEDI"===e.code?_=e.as(qe):"FEDI"===e.code?_=e.as(ze):"AEDI"===e.code&&(_=e.as(Gt)),_?(f=_.message,v=_.mentionCountChange,f.threadInfo&&(f.threadInfo.unreadReplyCount=void 0),f.channelType!==k.GROUP?[3,6]:(V=this._groupChannelCache.isCachedInMemory(f.channelUrl),[4,this.getChannel(f.channelUrl,!0)])):[3,6];case 5:m=Dn.sent(),w=f instanceof Be&&f.sender.userId===this._sdkState.userId,g=!1,w?(C=f.sender,(M=this._sessionManager.currentUser)&&(M.nickname=C.nickname,M.plainProfileUrl=C.plainProfileUrl,M.metaData=C.metaData)):m.isReadMessage(f)||0!==v&&!f.silent&&V&&(m._updateUnreadCount(m.unreadMessageCount,m.unreadMentionCount+v),g=!0),m._updateLastMessage(f)?g=!0:(null===(n=m.lastMessage)||void 0===n?void 0:n.isIdentical(f))&&(V?m._updateLastMessage(f)&&(g=!0):g=!0),b=!1,m.lastPinnedMessage&&m.lastPinnedMessage.messageId===f.messageId&&(m.lastPinnedMessage=f,g=!0,b=!0),g&&(this._dispatcher.dispatch(new fn({channels:[m],context:{source:b?E.EVENT_PINNED_MESSAGE_UPDATED:E.EVENT_MESSAGE_UPDATED}})),f.silent&&!w||H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(m)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),b&&H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPinnedMessageUpdated&&n.onPinnedMessageUpdated(m)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),this._dispatcher.dispatch(new j({messages:[f],source:E.EVENT_MESSAGE_UPDATED})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated&&n.onMessageUpdated(m,f),v>0&&n.onMentionReceived&&n.onMentionReceived(m,f)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Dn.label=6;case 6:return[3,79];case 7:return N=e.as(K),me=N.channelUrl,ge=N.channelType,U=N.messageId,S=N.silent,T=N.messageCreatedAt,A=N.senderId,ge!==k.GROUP?[3,9]:[4,this.getChannel(me,!0)];case 8:I=Dn.sent(),w=A===this._sdkState.userId,S||w||T>0&&I.myLastRead<T&&I.unreadMessageCount>0&&I._updateUnreadCount(I.unreadMessageCount-1,0),this._dispatcher.dispatch(new Q({messageIds:[U],source:E.EVENT_MESSAGE_DELETED})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageDeleted&&n.onMessageDeleted(I,U)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Dn.label=9;case 9:return[3,79];case 10:return(L=e.as(Ge).readStatus).channelType!==k.GROUP?[3,12]:(V=this._groupChannelCache.isCachedInMemory(L.channelUrl),[4,this.getChannel(L.channelUrl,!0)]);case 11:D=Dn.sent(),V&&D._updateUnreadMemberState(L.reader.userId,L.readAt),L.reader.userId===this._sdkState.userId?V?(D.unreadMessageCount>0||D.unreadMentionCount>0)&&(D._updateUnreadCount(0,0),this._dispatcher.dispatch(new fn({channels:[D],context:{source:E.EVENT_CHANNEL_READ}})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(D)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))):0!==D.unreadMessageCount&&0!==D.unreadMentionCount||(this._dispatcher.dispatch(new fn({channels:[D],context:{source:E.EVENT_CHANNEL_READ}})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(D)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))):(this._dispatcher.dispatch(new fn({channels:[D],context:{source:E.EVENT_CHANNEL_READ}})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onUnreadMemberStatusUpdated&&n.onUnreadMemberStatusUpdated(D)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),Dn.label=12;case 12:return[3,79];case 13:return x=e.as(us),me=x.channelUrl,R=x.deliveredStateUpdate,P=void 0===R?{}:R,V=this._groupChannelCache.isCachedInMemory(me),[4,this.getChannel(me,!0)];case 14:return Y=Dn.sent(),V&&Object.keys(P).forEach((function(e){Y._updateUndeliveredMemberState(e,P[e])})),Object.keys(P).some((function(e){return e!==Ln._sdkState.userId}))&&(this._dispatcher.dispatch(new fn({channels:[Y],context:{source:E.EVENT_CHANNEL_DELIVERED}})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onUndeliveredMemberStatusUpdated&&n.onUndeliveredMemberStatusUpdated(Y)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),[3,79];case 15:return X=e.as(Vt),me=X.channelUrl,ge=X.channelType,Z=X.event,ge!==k.GROUP?[3,18]:[4,this.getChannel(me,!0)];case 16:return $=Dn.sent(),[4,this.getMessageFromCache(Z.messageId)];case 17:(ne=Dn.sent())?ne instanceof Ve&&(ne.applyReactionEvent(Z),this._dispatcher.dispatch(new j({messages:[ne],source:E.EVENT_MESSAGE_REACTION_UPDATED}))):this._dispatcher.dispatch(new W({event:Z,source:E.EVENT_MESSAGE_REACTION_UPDATED})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onReactionUpdated&&n.onReactionUpdated($,Z)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Dn.label=18;case 18:return[3,79];case 19:return(ee=e.as(Ht).event).channelType!==k.GROUP?[3,22]:[4,this.getChannel(ee.channelUrl,!0)];case 20:return te=Dn.sent(),[4,this.getMessageFromCache(ee.targetMessageId)];case 21:(ne=Dn.sent())?ne instanceof Ve&&(ne.applyThreadInfoUpdateEvent(ee),this._dispatcher.dispatch(new j({messages:[ne],source:E.EVENT_MESSAGE_THREADINFO_UPDATED}))):this._dispatcher.dispatch(new z({event:ee,source:E.EVENT_MESSAGE_THREADINFO_UPDATED})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onThreadInfoUpdated&&n.onThreadInfoUpdated(te,ee)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Dn.label=22;case 22:return[3,79];case 23:se=e.as(Ot).groupChannelMemberCounts,re=[],Dn.label=24;case 24:Dn.trys.push([24,29,30,31]),ie=p(se),ae=ie.next(),Dn.label=25;case 25:return ae.done?[3,28]:(oe=ae.value,me=oe.channelUrl,ct=oe.memberCount,lt=oe.joinedMemberCount,ue=oe.updatedAt,[4,this.getChannelFromCache(me)]);case 26:(ce=Dn.sent())&&ce._setLatestMemberCount(ct,lt,ue)&&re.push(ce),Dn.label=27;case 27:return ae=ie.next(),[3,25];case 28:return[3,31];case 29:return le=Dn.sent(),bn={error:le},[3,31];case 30:try{ae&&!ae.done&&(Nn=ie.return)&&Nn.call(ie)}finally{if(bn)throw bn.error}return[7];case 31:return re.length>0&&(this._dispatcher.dispatch(new fn({channels:re,context:{source:E.EVENT_CHANNEL_MEMBER_COUNT_UPDATED}})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelMemberCountChanged&&n.onChannelMemberCountChanged(re)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}))),[3,79];case 32:return he=e.as(kt),de=he.event,_e=he.status,me=he.channelUrl,ge=he.channelType,me&&ge===k.GROUP?[4,this.getChannel(me,!0)]:[3,34];case 33:pe=Dn.sent(),this._dispatcher.dispatch(new q({event:de,source:E.EVENT_POLL_UPDATED})),H(_e===J?function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollDeleted&&n.onPollDeleted(pe,de.pollId)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}:function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollUpdated&&n.onPollUpdated(pe,de)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))}),Dn.label=34;case 34:return[3,79];case 35:return fe=e.as(He),ve=fe.event,me=fe.channelUrl,ge=fe.channelType,me&&ge===k.GROUP?[4,this.getChannel(me,!0)]:[3,37];case 36:Ee=Dn.sent(),this._dispatcher.dispatch(new B({event:ve,source:E.EVENT_POLL_VOTED})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollVoted&&n.onPollVoted(Ee,ve)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),Dn.label=37;case 37:return[3,79];case 38:if(!(Ce=e.as(xt).event).isGroupChannelEvent)return[3,77];switch(Ce.category){case Ft.CHANNEL_JOIN:return[3,39];case Ft.CHANNEL_LEAVE:return[3,41];case Ft.CHANNEL_OPERATOR_UPDATE:return[3,45];case Ft.CHANNEL_INVITE:return[3,47];case Ft.CHANNEL_DECLINE_INVITE:return[3,49];case Ft.TYPING_START:case Ft.TYPING_END:return[3,51];case Ft.USER_CHANNEL_MUTE:case Ft.USER_CHANNEL_UNMUTE:return[3,53];case Ft.USER_CHANNEL_BAN:return[3,55];case Ft.USER_CHANNEL_UNBAN:return[3,59];case Ft.CHANNEL_FREEZE:case Ft.CHANNEL_UNFREEZE:return[3,61];case Ft.CHANNEL_HIDE:return[3,63];case Ft.CHANNEL_UNHIDE:return[3,65];case Ft.CHANNEL_DELETED:return[3,67];case Ft.CHANNEL_PROP_CHANGED:return[3,69];case Ft.CHANNEL_META_DATA_CHANGED:return[3,71];case Ft.CHANNEL_META_COUNTERS_CHANGED:return[3,73];case Ft.PINNED_MESSAGE_CHANGED:return[3,75]}return[3,77];case 39:return[4,this.getChannel(Ce.channelUrl,!0)];case 40:return ye=Dn.sent(),Me=e.as(Gn),be=Me.memberCount,Ne=Me.joinedMemberCount,Ue=Me.members,Se=!1,Ue.forEach((function(e){ye.isExclusive||ye.isSuper||ye.isBroadcast?Se=Se||ye._setLatestMemberCount(be,Ne,Ce.ts):(e.state=qt.JOINED,ye.addMember(e,Ce.ts),Ln._updateJoinedMemberCount(ye)),e.userId===Ln._sdkState.userId&&(ye.myMemberState=qt.JOINED)})),this._dispatcher.dispatch(new fn({channels:[ye],context:{source:E.EVENT_CHANNEL_JOINED,users:Ue}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var s=p(Ue),r=s.next();!r.done;r=s.next()){var i=r.value;e.onUserJoined&&e.onUserJoined(ye,i)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}ye.isBroadcast&&Se&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([ye])})),[2]}))}))})),[3,77];case 41:return(Mt=this._leftChannels.get(Ce.channelUrl))?(Ae=Mt.channel,[3,44]):[3,42];case 42:return[4,this.getChannel(Ce.channelUrl,!0)];case 43:Ae=Dn.sent(),Dn.label=44;case 44:return Te=Ae,Ie=e.as(qn),ct=Ie.memberCount,lt=Ie.joinedMemberCount,we=Ie.member,Le=!1,Qe=F.of(this._iid).appInfo,Te.isExclusive||Te.isSuper||Te.isBroadcast?Le=Te._setLatestMemberCount(ct,lt,Ce.ts):((null==Qe?void 0:Qe.enabledChannelMemberShipHistory)?((Ke=Te.members.find((function(e){return e.userId===we.userId})))&&(Ke.state=qt.LEFT),Te.memberCount=ct):Te.removeMember(we),this._updateJoinedMemberCount(Te)),we.userId===this._sdkState.userId?(Te.myMemberState=qt.NONE,Te.invitedAt=0,Te.joinedAt=0,Te._updateUnreadCount(0,0),Te.isPublic?this._dispatcher.dispatch(new fn({channels:[Te],context:{source:E.EVENT_CHANNEL_LEFT,user:we}})):(this._markAsLeave(Te),this._dispatcher.dispatch(new vn({channelUrls:[Te.url],context:{source:E.EVENT_CHANNEL_LEFT,user:we}})))):this._dispatcher.dispatch(new fn({channels:[Te],context:{source:E.EVENT_CHANNEL_LEFT,user:we}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft&&e.onUserLeft(Te,we),Te.isBroadcast&&Le&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([Te])})),[2]}))}))})),[3,77];case 45:return[4,this.getChannel(Ce.channelUrl,!0)];case 46:Ye=Dn.sent(),Je=e.as(Pt).operators,Xe=Je.map((function(e){return e.userId}));try{for(Ze=p(Ye.members),$e=Ze.next();!$e.done;$e=Ze.next())(yt=$e.value).role=Xe.includes(yt.userId)?i.OPERATOR:i.NONE}catch(e){Un={error:e}}finally{try{$e&&!$e.done&&(Sn=Ze.return)&&Sn.call(Ze)}finally{if(Un)throw Un.error}}return Ye.myRole=Xe.includes(this._sdkState.userId)?i.OPERATOR:i.NONE,this._dispatcher.dispatch(new fn({channels:[Ye],context:{source:E.EVENT_CHANNEL_OPERATOR_UPDATED,operators:Je}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated&&e.onOperatorUpdated(Ye,Je)})),[2]}))}))})),[3,77];case 47:return[4,this.getChannel(Ce.channelUrl,!0)];case 48:et=Dn.sent(),tt=e.as(Wn),ct=tt.memberCount,lt=tt.joinedMemberCount,nt=tt.inviter,(st=tt.invitees).forEach((function(e){return e.state=qt.INVITED}));try{for(rt=p(st),it=rt.next();!it.done;it=rt.next())at=it.value,et.isExclusive||et.isSuper||et.isBroadcast?et._setLatestMemberCount(ct,lt,Ce.ts):et.addMember(at,Ce.ts),this._sdkState.userId===at.userId&&(et.hiddenState=ar.UNHIDDEN,et.myMemberState!==qt.JOINED&&(et.myMemberState=qt.INVITED),et.invitedAt=Ce.ts)}catch(e){Tn={error:e}}finally{try{it&&!it.done&&(An=rt.return)&&An.call(rt)}finally{if(Tn)throw Tn.error}}return this._dispatcher.dispatch(new fn({channels:[et],context:{source:E.EVENT_CHANNEL_INVITED,inviter:nt,invitees:st}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation&&e.onUserReceivedInvitation(et,nt,st)})),[2]}))}))})),[3,77];case 49:return[4,this.getChannel(Ce.channelUrl,!0)];case 50:return ot=Dn.sent(),ut=e.as(Kn),ct=ut.memberCount,lt=ut.joinedMemberCount,ht=ut.inviter,dt=ut.invitee,ot.isExclusive||ot.isSuper||ot.isBroadcast?ot._setLatestMemberCount(ct,lt,Ce.ts):ot.removeMember(dt),this._sdkState.userId===dt.userId?(ot.invitedAt=0,ot.myMemberState=qt.NONE,ot.isPublic?this._dispatcher.dispatch(new fn({channels:[ot],context:{source:E.EVENT_CHANNEL_DECLINED_INVITE,inviter:ht,invitee:dt}})):this._dispatcher.dispatch(new vn({channelUrls:[ot.url],context:{source:E.EVENT_CHANNEL_DECLINED_INVITE,inviter:ht,invitee:dt}}))):this._dispatcher.dispatch(new fn({channels:[ot],context:{source:E.EVENT_CHANNEL_DECLINED_INVITE,inviter:ht,invitee:dt}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation&&e.onUserDeclinedInvitation(ot,ht,dt)})),[2]}))}))})),[3,77];case 51:return[4,this.getChannel(Ce.channelUrl,!0)];case 52:return _t=Dn.sent(),pt=Ce.category===Ft.TYPING_START,ft=e.as(pt?es:ns).user,_t._updateTypingStatus(ft,pt?Ce.ts:0),this._dispatcher.dispatch(new fn({channels:[_t],context:{source:E.EVENT_CHANNEL_TYPING_STATUS_UPDATE}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated&&e.onTypingStatusUpdated(_t)})),[2]}))}))})),[3,77];case 53:return[4,this.getChannel(Ce.channelUrl,!0)];case 54:vt=Dn.sent(),mt=Ce.category===Ft.USER_CHANNEL_MUTE,(gt=e.as(mt?ke:Oe).user).userId===this._sdkState.userId&&(vt.myMutedState=mt?G.MUTED:G.UNMUTED,vt._myMutedRemainingTime=gt.restrictionInfo.remainingDuration);try{for(Et=p(vt.members),Ct=Et.next();!Ct.done;Ct=Et.next())if((yt=Ct.value).userId===gt.userId){yt.isMuted=mt;break}}catch(e){In={error:e}}finally{try{Ct&&!Ct.done&&(wn=Et.return)&&wn.call(Et)}finally{if(In)throw In.error}}return this._dispatcher.dispatch(new fn({channels:[vt],context:{source:mt?E.EVENT_CHANNEL_MUTED:E.EVENT_CHANNEL_UNMUTED,user:gt}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){mt?e.onUserMuted&&e.onUserMuted(vt,gt):e.onUserUnmuted&&e.onUserUnmuted(vt,gt)})),[2]}))}))})),[3,77];case 55:return(Mt=this._leftChannels.get(Ce.channelUrl))?(Nt=Mt.channel,[3,58]):[3,56];case 56:return[4,this.getChannel(Ce.channelUrl,!0)];case 57:Nt=Dn.sent(),Dn.label=58;case 58:return bt=Nt,this._markAsLeave(bt),Ut=e.as(Pe).user,Ut.userId===this._sdkState.userId&&this._dispatcher.dispatch(new vn({channelUrls:[bt.url],context:{source:E.EVENT_CHANNEL_BANNED,user:Ut}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned&&e.onUserBanned(bt,Ut)})),[2]}))}))})),[3,77];case 59:return[4,this.getChannel(Ce.channelUrl,!0)];case 60:return St=Dn.sent(),Tt=e.as(Fe).user,Tt.userId===this._sdkState.userId&&this._dispatcher.dispatch(new vn({channelUrls:[St.url],context:{source:E.EVENT_CHANNEL_UNBANNED,user:Tt}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned&&e.onUserUnbanned(St,Tt)})),[2]}))}))})),[3,77];case 61:return[4,this.getChannel(Ce.channelUrl,!0)];case 62:return At=Dn.sent(),Dt=e.as(Re).freeze,At.isFrozen=Dt,this._dispatcher.dispatch(new fn({channels:[At],context:{source:Dt?E.EVENT_CHANNEL_FROZEN:E.EVENT_CHANNEL_UNFROZEN}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Dt?e.onChannelFrozen&&e.onChannelFrozen(At):e.onChannelUnfrozen&&e.onChannelUnfrozen(At)})),[2]}))}))})),[3,77];case 63:return[4,this.getChannel(Ce.channelUrl,!0)];case 64:return Rt=Dn.sent(),zt=e.as(Zn),jt=zt.allowAutoUnhide,Wt=zt.hidePreviousMessages,Qt=zt.messageOffsetTimestamp,null!==jt&&(Rt.hiddenState=jt?ar.HIDDEN_ALLOW_AUTO_UNHIDE:ar.HIDDEN_PREVENT_AUTO_UNHIDE),null!==Wt&&Wt&&Rt._updateUnreadCount(0,0),null!==Qt&&(Rt.messageOffsetTimestamp=Qt),this._dispatcher.dispatch(new fn({channels:[Rt],context:{source:E.EVENT_CHANNEL_HIDDEN}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden&&e.onChannelHidden(Rt)})),[2]}))}))})),[3,77];case 65:return[4,this.getChannel(Ce.channelUrl,!0)];case 66:return(Kt=Dn.sent()).hiddenState=ar.UNHIDDEN,this._dispatcher.dispatch(new fn({channels:[Kt],context:{source:E.EVENT_CHANNEL_UNHIDDEN}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(Kt)})),[2]}))}))})),[3,77];case 67:return[4,this.getChannel(Ce.channelUrl,!0)];case 68:return Yt=Dn.sent(),this._dispatcher.dispatch(new vn({channelUrls:[Ce.channelUrl],context:{source:E.EVENT_CHANNEL_DELETED}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(Yt.url,Yt.channelType)})),[2]}))}))})),[3,77];case 69:return[4,this.getChannelWithoutCache(Ce.channelUrl,!0)];case 70:return Jt=Dn.sent(),this._dispatcher.dispatch(new fn({channels:[Jt],context:{source:E.EVENT_CHANNEL_UPDATED}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(Jt)})),[2]}))}))})),[3,77];case 71:return[4,this.getChannel(Ce.channelUrl,!0)];case 72:return Xt=Dn.sent(),Zt=e.as(xe),$t=Zt.created,en=Zt.updated,tn=Zt.deleted,$t&&(Xt._upsertCachedMetaData($t,Ce.ts),this._dispatcher.dispatch(new fn({channels:[Xt],context:{source:E.EVENT_CHANNEL_METADATA_CREATED,metaData:$t}}))),en&&(Xt._upsertCachedMetaData(en,Ce.ts),this._dispatcher.dispatch(new fn({channels:[Xt],context:{source:E.EVENT_CHANNEL_METADATA_UPDATED,metaData:en}}))),tn&&(Xt._removeFromCachedMetaData(tn,Ce.ts),this._dispatcher.dispatch(new fn({channels:[Xt],context:{source:E.EVENT_CHANNEL_METADATA_DELETED,metaDataKeys:tn}}))),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){$t&&e.onMetaDataCreated&&e.onMetaDataCreated(Xt,$t),en&&e.onMetaDataUpdated&&e.onMetaDataUpdated(Xt,en),tn&&e.onMetaDataDeleted&&e.onMetaDataDeleted(Xt,tn)})),[2]}))}))})),[3,77];case 73:return[4,this.getChannel(Ce.channelUrl,!0)];case 74:return nn=Dn.sent(),sn=e.as(De),rn=sn.created,an=sn.updated,on=sn.deleted,rn&&this._dispatcher.dispatch(new fn({channels:[nn],context:{source:E.EVENT_CHANNEL_METACOUNTER_CREATED,metaCounters:rn}})),an&&this._dispatcher.dispatch(new fn({channels:[nn],context:{source:E.EVENT_CHANNEL_METACOUNTER_UPDATED,metaCounters:an}})),on&&this._dispatcher.dispatch(new fn({channels:[nn],context:{source:E.EVENT_CHANNEL_METACOUNTER_DELETED,metaCounterKeys:on}})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){rn&&e.onMetaCounterCreated&&e.onMetaCounterCreated(nn,rn),an&&e.onMetaCounterUpdated&&e.onMetaCounterUpdated(nn,an),on&&e.onMetaCounterDeleted&&e.onMetaCounterDeleted(nn,on)})),[2]}))}))})),[3,77];case 75:return[4,this.getChannel(Ce.channelUrl,!0)];case 76:return un=Dn.sent(),cn=e.as(is),ln=cn.pinnedMessageIds,hn=cn.latestPinnedMessage,(dn=cn.ts)>un._pinnedMessagesUpdatedAt&&(un.pinnedMessageIds=ln,un.lastPinnedMessage=hn,un._pinnedMessagesUpdatedAt=dn,this._dispatcher.dispatch(new fn({channels:[un],context:{source:E.EVENT_PINNED_MESSAGE_UPDATED}})),H((function(){return h(Ln,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){try{for(e=p(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(un)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),H((function(){return h(Ln,void 0,void 0,(function(){return d(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(un)})),[2]}))}))}))),[3,77];case 77:return[3,79];case 78:switch((_n=e.as(It).event).category){case wt.USER_BLOCK:pn=Lt.getDataAsUserBlockEvent(this._iid,_n),gn=pn.blocker,En=pn.blockee,this._groupChannelCache.block(gn.userId,En.userId);break;case wt.USER_UNBLOCK:mn=Lt.getDataAsUserBlockEvent(this._iid,_n),gn=mn.blocker,En=mn.blockee,this._groupChannelCache.unblock(gn.userId,En.userId)}return[3,79];case 79:return[3,81];case 80:if(Cn=Dn.sent(),O(Cn))throw Cn;return[3,81];case 81:return[2]}}))}))},_.prototype._markAsLeave=function(e){var t,n=this,s=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};s.ref++,this._leftChannels.set(e.url,s),setTimeout((function(){s.ref--,0===s.ref&&n._leftChannels.delete(e.url)}),1e4)},_.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},_.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},_.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},_.prototype.subscribeChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},_.prototype.unsubscribeChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},_.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter((function(e){return e.state===qt.JOINED})).length},_.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n;return d(this,(function(s){switch(s.label){case 0:o(v("string",e)).throw(u.invalidParameters),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=s.sent())?[2,n]:[3,4];case 3:return s.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,s.sent()]}}))}))},_.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,s,r,i,a;return d(this,(function(c){switch(c.label){case 0:return o(v("string",e)).throw(u.invalidParameters),n=new Cn({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(s=c.sent(),r=s.as(yn).channel,i=r.unreadMessageCount,a=r.unreadMentionCount,r.myCountPreference){case ir.UNREAD_MESSAGE_COUNT_ONLY:a=0;break;case ir.UNREAD_MENTION_COUNT_ONLY:i=0;break;case ir.OFF:i=0,a=0}return r._updateUnreadCount(i,a),[4,this.upsertChannelsToCache([r])];case 2:return[2,c.sent()[0]]}}))}))},_.prototype.refreshChannel=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=E.REFRESH_CHANNEL),h(this,void 0,void 0,(function(){var s,r,i,a,o;return d(this,(function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),s=new Cn({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(s)];case 1:return r=u.sent(),(i=r.as(yn).channel).myMemberState!==qt.NONE?[3,2]:(this._dispatcher.dispatch(new vn({channelUrls:[i.url],context:{source:n}})),[3,4]);case 2:return[4,this.upsertChannelsToCache([i])];case 3:a=u.sent(),this._dispatcher.dispatch(new fn({channels:a,context:{source:n}})),u.label=4;case 4:return[3,6];case 5:return(o=u.sent()).code!==Y.NON_AUTHORIZED&&o.code!==Y.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new vn({channelUrls:[e],context:{source:n}})),[3,6];case 6:return[2]}}))}))},_.prototype.getMyGroupChannels=function(e,t,n,r,i){return void 0===r&&(r=E.REQUEST_CHANNEL),void 0===i&&(i=!1),h(this,void 0,void 0,(function(){var a,o,u,c,l,h,_,p,f;return d(this,(function(d){switch(d.label){case 0:return t.createdAfter&&(t.createdAfter=Math.floor(t.createdAfter/1e3)),t.createdBefore&&(t.createdBefore=Math.floor(t.createdBefore/1e3)),a=!1,i&&(o=F.of(this._iid),u=o.appInfo,(c=o.cacheContext)&&!c.localCacheEnabled&&(null==u?void 0:u.enabledChannelMemberShipHistory)&&(null==u?void 0:u.applicationAttributes.includes("left_user_view_support"))&&(a=!0)),l=new bn(s(s({},t),{userId:this._sdkState.userId,token:e,limit:n,includeLeftChannel:i&&a})),[4,this._requestQueue.send(l)];case 1:return h=d.sent(),_=h.as(Nn),p=_.channels,f=_.token,this._dispatcher.dispatch(new fn({channels:p,context:{source:r}})),[2,{channels:p,token:f}]}}))}))},_.prototype.getMyGroupChannelChangeLogs=function(e,t,r){return void 0===r&&(r=E.REQUEST_CHANNEL_CHANGELOGS),h(this,void 0,void 0,(function(){var i,a,c,l,h,_,p,f;return d(this,(function(d){switch(d.label){case 0:return i=s(s({},rn),t),o((v("string",e)||v("number",e))&&an(i)).throw(u.invalidParameters),a=new gn(n({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:i})),[4,this._requestQueue.send(a)];case 1:return c=d.sent(),l=c.as(En),h=l.updatedChannels,_=l.deletedChannelUrls,p=l.hasMore,f=l.ts,h.length>0&&this._dispatcher.dispatch(new fn({channels:h,context:{source:r},ts:f})),_.length>0&&this._dispatcher.dispatch(new vn({channelUrls:_,context:{source:r}})),[2,{updatedChannels:h,deletedChannelUrls:_,hasMore:p,token:l.token}]}}))}))},_.prototype.getGroupChannelCount=function(e){return h(this,void 0,void 0,(function(){var t,n,r;return d(this,(function(i){switch(i.label){case 0:return t=s(s({},on),e),o(un(t)).throw(u.invalidParameters),n=new Un({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return r=i.sent(),[2,r.as(Sn).groupChannelCount]}}))}))},_.prototype.getUnreadItemCount=function(e){return h(this,void 0,void 0,(function(){var n,r,i,a,c,l,h,_,p,v,m,g,E,C,y,M;return d(this,(function(d){switch(d.label){case 0:return n=s(s({},cn),e),o(function(e){return f($t,e.keys)}(n)).throw(u.invalidParameters),r=F.of(this._iid),i=r.sdkState,a=r.requestQueue,c=new Tn({userId:i.userId,filter:n}),[4,a.send(c)];case 1:return l=d.sent(),h=l.as(An),_=h.groupChannelUnreadMentionCount,p=h.groupChannelUnreadMessageCount,v=h.groupChannelInvitationCount,m=h.superGroupChannelUnreadMentionCount,g=h.superGroupChannelUnreadMessageCount,E=h.superGroupChannelInvitationCount,C=h.nonSuperGroupChannelUnreadMentionCount,y=h.nonSuperGroupChannelUnreadMessageCount,M=h.nonSuperGroupChannelInvitationCount,[2,t({groupChannelUnreadMentionCount:_,groupChannelUnreadMessageCount:p,groupChannelInvitationCount:v,superGroupChannelUnreadMentionCount:m,superGroupChannelUnreadMessageCount:g,superGroupChannelInvitationCount:E,nonSuperGroupChannelUnreadMentionCount:C,nonSuperGroupChannelUnreadMessageCount:y,nonSuperGroupChannelInvitationCount:M})]}}))}))},_.prototype.getTotalUnreadChannelCount=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new In({userId:t.userId}),[4,n.send(s)];case 1:return r=i.sent(),[2,r.as(wn).unreadCount]}}))}))},_.prototype.getTotalUnreadMessageCount=function(e){return h(this,void 0,void 0,(function(){var t,n,r,i,a,c;return d(this,(function(l){switch(l.label){case 0:return t=s(s({},ln),e),o(hn(t)).throw(u.invalidParameters),n=F.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new Ln({userId:r.userId,filter:t}),[4,i.send(a)];case 1:return c=l.sent(),[2,c.as(Dn).unreadCount]}}))}))},_.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),h(this,void 0,void 0,(function(){var t,n,i,a;return d(this,(function(c){switch(c.label){case 0:return t=s(s({},dn),e),o(function(e){return v("string",e.channelUrl,!0)&&f(Ce,e.scheduledStatus,!0)&&r(g,e.messageTypeFilter)}(t)).throw(u.invalidParameters),n=F.of(this._iid).requestQueue,i=new xn(t),[4,n.send(i)];case 1:return a=c.sent(),[2,a.as(Rn).count]}}))}))},_.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=F.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},_.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=F.of(this._iid).subscribedUnreadMessageCount;return Object.keys(t.customTypes).forEach((function(n){e+=t.customTypes[n]})),e},_.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=F.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},_.prototype.createChannel=function(e){return h(this,void 0,void 0,(function(){var t,n,r,i;return d(this,(function(a){switch(a.label){case 0:return t=s(s({},nn),e),o(sn(t)).throw(u.invalidParameters),t.isPublic||(t.accessCode=void 0),n=new Pn(s({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return r=a.sent(),i=r.as(kn).channel,[4,this.upsertChannelsToCache([i])];case 2:return a.sent(),[2,i]}}))}))},_.prototype.markAsReadAll=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r,i,a,c;return d(this,(function(l){switch(l.label){case 0:return e=Date.now(),o(e-this._markAsReadAllLastSentAt>=1e3).throw(u.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new On({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:l.sent(),n=this._groupChannelCache.channels;try{for(s=p(n),r=s.next();!r.done;r=s.next())(i=r.value)._updateUnreadMemberState(this._sdkState.userId,e),i._updateUnreadCount(0,0)}catch(e){a={error:e}}finally{try{r&&!r.done&&(c=s.return)&&c.call(s)}finally{if(a)throw a.error}}return n.length>0?[4,this.upsertChannelsToCache(n)]:[3,3];case 2:l.sent(),l.label=3;case 3:return[2]}}))}))},_.prototype.markAsReadWithChannelUrls=function(e){return h(this,void 0,void 0,(function(){var t,n,s,r,i,a,c,l,h;return d(this,(function(d){switch(d.label){case 0:return t=Date.now(),o(f("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(u.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new On({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:d.sent(),s=this._groupChannelCache.channels,r=[];try{for(i=p(s),a=i.next();!a.done;a=i.next())c=a.value,e.includes(c.url)&&(c._updateUnreadMemberState(this._sdkState.userId,t),c._updateUnreadCount(0,0),r.push(c))}catch(e){l={error:e}}finally{try{a&&!a.done&&(h=i.return)&&h.call(i)}finally{if(l)throw l.error}}return r.length>0?[4,this.upsertChannelsToCache(r)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}}))}))},_.prototype.markAsDelivered=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},_.prototype.getMessageFromCache=function(e){var t;return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},_.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,t,n){return h(this,void 0,void 0,(function(){return d(this,(function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,filter:n,exactMatch:!0})];case 1:return[2,s.sent()]}}))}))},_.prototype.getMessagesFromCache=function(e,t,n,s,r,i){return void 0===r&&(r=Qe),void 0===i&&(i=!0),h(this,void 0,void 0,(function(){return d(this,(function(a){switch(a.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:s,backward:"next"===n,inclusive:i})];case 1:return[2,a.sent()]}}))}))},_.prototype.getPollMessagesFromCache=function(e,t,n,s){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:s,filter:n,backward:!1,isPollOnly:!0})];case 1:return[2,r.sent()]}}))}))},_.prototype.getCachedMessageCountBetween=function(e,t,n,s){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.countBetween(e,t,new cs({top:n,bottom:s}))];case 1:return[2,r.sent()]}}))}))},_.prototype.getUnsentMessagesFromCache=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t})];case 1:return[2,n.sent()]}}))}))},_.prototype.removeFailedMessageFromCache=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}}))}))},_}(Rt),ds=function(e,t){return t instanceof Be?e.findIndex((function(e){return e instanceof Be&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},_s=function(e,t){return e.findIndex((function(e){return e instanceof Ve?e.messageId===t:e instanceof Ke?e.notificationId===t:void 0}))},ps=function(e,t){if(e.length>0){for(var n=0,s=e.length-1,r=Math.floor((n+s)/2);n<s;){var i=e[r].createdAt-t.createdAt;if(i>0)s=r,r=Math.floor((n+s)/2);else{if(!(i<0))return r;n=r+1,r=Math.floor((n+s)/2)}}return e[r].createdAt>t.createdAt?r:r+1}return e.length};!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(os||(os={}));var fs,vs=function(t){function n(e,n,s,r){var i=t.call(this)||this;return i._state=os.IDLE,i._retryCount=0,i._retryLimit=3,i.priority=0,i._worker=n,i}return e(n,t),Object.defineProperty(n.prototype,"isIdle",{get:function(){return this._state===os.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRunning",{get:function(){return this._state===os.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isDone",{get:function(){return this._state===os.END},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),n.prototype._run=function(e){return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(s){switch(s.label){case 0:if(!this.isRunning)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=s.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=s.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}}))}))},n.prototype.start=function(e){this.isIdle&&(this._state=os.RUNNING,this._run(e))},n.prototype.stop=function(){this._state=os.IDLE,this.dispatch("stop")},n.prototype.end=function(){this._state=os.END,this.dispatch("end")},n}(X),ms={},gs=function(){function e(e){var t=e._iid,n=e.channel,s=e.limit,r=void 0===s?100:s,i=this;this.ref=0,this._iid=t,this._channel=n,this._limit=r,this._prevSyncLoopCount=0;var a,o,_=F.of(this._iid),p=_.sdkState,f=_.cacheContext,v=_.dispatcher,m=_.logger,g=_.statManager;this._metadataKey=(a=p.userId,o=n.url,"sendbird:".concat(a,"@groupchannel/").concat(o,"/message/sync.meta"));var C=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(p.userId,n.url);this._prevSync=new vs(C,(function(e){return h(i,void 0,void 0,(function(){var t,s,r,i,a,o,h,_,p,v,C,y;return d(this,(function(d){switch(d.label){case 0:return t={hasNext:!0,nextToken:0},this._prevSyncLoopCount++,[4,this.loadMetadata(e)];case 1:if(d.sent(),m.debug("message background prev sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.top),null===(h=this._metadata)||void 0===h?void 0:h.previousComplete)return[3,10];d.label=2;case 2:return d.trys.push([2,5,8,9]),[4,Ye.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(p=null===(_=this._metadata)||void 0===_?void 0:_.range)||void 0===p?void 0:p.top)?this._metadata.range.top:e,{prevResultSize:this._limit,nextResultSize:0,replyType:ne.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},E.SYNC_MESSAGE_BACKGROUND)];case 3:return(s=d.sent()).length>0&&(r=s.map((function(e){return e.createdAt})),(null===(v=this._metadata)||void 0===v?void 0:(a=v.range).intersect.apply(a,c([],l(r),!1)))?this.extendRange(s):this._metadata={range:new cs({top:Math.min.apply(Math,c([],l(r),!1)),bottom:Math.max.apply(Math,c([],l(r),!1))}),previousComplete:!1}),t.hasNext=s.length>=this._limit&&this._prevSyncLoopCount<1,this._metadata&&(t.nextToken=this._metadata.range.top,this._metadata.previousComplete=s.length<this._limit),m.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return d.sent(),[3,9];case 5:return i=d.sent(),m.debug("message background prev sync error",i),i instanceof u&&i.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:d.sent(),d.label=7;case 7:throw i;case 8:return g.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:n.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:null!==(y=null===(C=f.localCacheConfig)||void 0===C?void 0:C.maxSize)&&void 0!==y?y:0,use_local_cache:f.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 9:return[3,11];case 10:t.hasNext=!1,d.label=11;case 11:return[2,t]}}))}))})),this._nextSync=new vs(C,(function(e){return h(i,void 0,void 0,(function(){var t,s,r,i,a,o,u,h,_,p,v;return d(this,(function(d){switch(d.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata(e)];case 1:d.sent(),m.debug("message background next sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.bottom),d.label=2;case 2:return d.trys.push([2,5,6,7]),[4,Ye.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(h=null===(u=this._metadata)||void 0===u?void 0:u.range)||void 0===h?void 0:h.bottom)?this._metadata.range.bottom:e,{prevResultSize:0,nextResultSize:this._limit,replyType:ne.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},E.SYNC_MESSAGE_BACKGROUND)];case 3:return(s=d.sent()).length>0&&(r=s.map((function(e){return e.createdAt})),(null===(_=this._metadata)||void 0===_?void 0:(a=_.range).intersect.apply(a,c([],l(r),!1)))?this.extendRange(s):this._metadata={range:new cs({top:Math.min.apply(Math,c([],l(r),!1)),bottom:Math.max.apply(Math,c([],l(r),!1))}),previousComplete:!1}),t.hasNext=s.length>=this._limit,this._metadata&&(t.nextToken=this._metadata.range.bottom),m.debug("message background next sync progress",t),[4,this.saveMetadata()];case 4:return d.sent(),[3,7];case 5:throw i=d.sent(),m.debug("message background next sync error",i),i;case 6:return g.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:n.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:null!==(v=null===(p=f.localCacheConfig)||void 0===p?void 0:p.maxSize)&&void 0!==v?v:0,use_local_cache:f.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[2,t]}}))}))})),this._connectionEventContext=v.on((function(e){if(e instanceof Z)if(e.stateType===$.CONNECTED)i.resume();else i.pause()}))}return e.of=function(t,n){return ms[t]||(ms[t]={}),ms[t][n.url]||(ms[t][n.url]=new e({_iid:t,channel:n})),ms[t][n.url].ref++,ms[t][n.url]},e.clear=function(e,t){ms[e]&&ms[e][t]&&(ms[e][t].close(),delete ms[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new cs({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,c([],l(e.map((function(e){return e.createdAt}))),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,c([],l(e.map((function(e){return e.createdAt}))),!1))},e.prototype.loadMetadata=function(e){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,F.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{range:new cs(e.range),previousComplete:e.previousComplete}:{range:new cs({}),previousComplete:!1},t.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(e){var t,n,s,r;void 0===e&&(e=Date.now());var i=F.of(this._iid),a=i.logger;i.sessionManager.session.hasSession&&(a.debug("message background sync resume()"),this._prevSyncLoopCount=0,this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(n=null===(t=this._metadata)||void 0===t?void 0:t.range.top)&&void 0!==n?n:e),this._nextSync.start(null!==(r=null===(s=this._metadata)||void 0===s?void 0:s.range.bottom)&&void 0!==r?r:e))},e.prototype.pause=function(){F.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete ms[this._iid][this._channel.url])},e}(),Es={},Cs=function(){function e(e){var t=e._iid,n=e.channel,r=e.includeParams,i=this;this.ref=0,this._iid=t,this._channel=n,this._includeParams=r;var a,o,c=F.of(this._iid),l=c.logger,_=c.sdkState,p=c.dispatcher;this._metadataKey=(a=_.userId,o=n.url,"sendbird:".concat(a,"@groupchannel/").concat(o,"/message/changelogs.meta"));var f=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(_.userId,this._channel.url);this._sync=new vs(f,(function(){return h(i,void 0,void 0,(function(){var e,t,n,r,i,a,o,c;return d(this,(function(h){switch(h.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:h.sent(),l.debug("message changelog sync from",null===(c=this._metadata)||void 0===c?void 0:c.token),h.label=2;case 2:return h.trys.push([2,5,,8]),[4,Ye.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,s({replyType:ne.ALL},this._includeParams),E.SYNC_MESSAGE_CHANGELOGS)];case 3:return t=h.sent(),n=t.updatedMessages,r=t.deletedMessageIds,i=t.hasMore,a=t.token,e.hasNext=i,e.nextToken=a,(n.length>0||r.length>0)&&this._metadata&&(this._metadata.token=a),l.debug("message changelog sync progress",e),[4,this.saveMetadata()];case 4:return h.sent(),[3,8];case 5:return o=h.sent(),l.debug("message changelog sync error",o),o instanceof u&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:h.sent(),h.label=7;case 7:throw o;case 8:return[2,e]}}))}))})),this._connectionEventContext=p.on((function(e){if(e instanceof Z)if(e.stateType===$.CONNECTED)i.resume();else i.pause()}))}return e.of=function(t,n,s){return Es[t]||(Es[t]={}),Es[t][n.url]||(Es[t][n.url]=new e({_iid:t,channel:n,includeParams:s})),Es[t][n.url].ref++,Es[t][n.url]},e.clear=function(e,t){Es[e]&&Es[e][t]&&(Es[e][t].close(),delete Es[e])},e.prototype.loadMetadata=function(){return h(this,void 0,void 0,(function(){var e,t,n,s;return d(this,(function(r){switch(r.label){case 0:return this._metadata?[3,2]:(e=F.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:s=r.sent(),this._metadata={token:s?s.token:n},r.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){var e=F.of(this._iid),t=e.logger;e.sessionManager.session.hasSession&&(t.debug("message changelog sync resume()"),this._sync.start(0))},e.prototype.pause=function(){F.of(this._iid).logger.debug("message changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Es[this._iid][this._channel.url])},e}(),ys={},Ms=function(){function e(e){var t=e._iid,n=e.channel,s=e.hasPollMessage,r=this;this.ref=0,this._iid=t,this._channel=n;var i,a,o=F.of(this._iid),c=o.logger,l=o.sdkState,_=o.dispatcher;this._metadataKey=(i=l.userId,a=n.url,"sendbird:".concat(i,"@groupchannel/").concat(a,"/poll/changelogs.meta"));var p=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(l.userId,this._channel.url);this._sync=new vs(p,(function(){return h(r,void 0,void 0,(function(){var e,t,n,r,i,a,o,l;return d(this,(function(h){switch(h.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return h.sent(),c.debug("poll changelog sync from",null===(l=this._metadata)||void 0===l?void 0:l.token),(t=!this._metadata||!this._metadata.token)?[4,s()]:[3,3];case 2:t=!h.sent(),h.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];this._metadata||(n=F.of(this._iid).firstConnectedAt,this._metadata={token:n}),h.label=4;case 4:return h.trys.push([4,7,,10]),[4,se.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return r=h.sent(),i=r.hasMore,a=r.token,e.hasNext=i,e.nextToken=a,this._metadata.token=a,c.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return h.sent(),[3,10];case 7:return o=h.sent(),c.debug("poll changelog sync error",o),o instanceof u&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:h.sent(),h.label=9;case 9:throw o;case 10:return[2,e]}}))}))})),this._connectionEventContext=_.on((function(e){if(e instanceof Z)if(e.stateType===$.CONNECTED)r.resume();else r.pause()}))}return e.of=function(t,n,s){return ys[t]||(ys[t]={}),ys[t][n.url]||(ys[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:s})),ys[t][n.url].ref++,ys[t][n.url]},e.prototype.loadMetadata=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,F.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{token:e.token}:void 0,t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this._metadata?[4,F.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,F.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){F.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){F.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete ys[this._iid][this._channel.url])},e}(),bs=function(n){function s(e){var s,r,i,a,o,u,c,l,h,d,_=this;return(_=n.call(this)||this).method=M.GET,_.path="".concat(re(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),_.params=t({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(s=e.threshold)&&void 0!==s?s:null,reverse:!0,custom_types:null!==(r=e.customTypes)&&void 0!==r?r:["*"],message_type:null!==(i=e.messageType)&&void 0!==i?i:null,include_reply_type:null!==(a=e.replyType)&&void 0!==a?a:ne.NONE,include_reactions:null===(o=e.includeReactions)||void 0===o||o,include_meta_array:null===(u=e.includeMetaArray)||void 0===u||u,include_thread_info:null===(c=e.includeThreadInfo)||void 0===c||c,include_parent_message_info:null===(l=e.includeParentMessageInfo)||void 0===l||l,with_sorted_meta_array:null===(h=e.includeMetaArray)||void 0===h||h,show_subchannel_messages_only:null!==(d=e.showSubchannelMessagesOnly)&&void 0!==d&&d,include_poll_details:!0,checking_continuous_messages:e.checkingContinuousMessages}),_}return e(s,n),s}(N),Ns=function(t){function n(e,n){var s,r,i,a,o,u,c=this;return(c=t.call(this,e,n)||this).isHugeGap=n.is_huge_gap,c.prevMessages=(null!==(s=n.prev_messages)&&void 0!==s?s:[]).map((function(t){return Me(e,t)})),c.prevHasMore=null!==(r=n.prev_hasmore)&&void 0!==r&&r,c.isContinuousPrevMessages=null!==(i=n.is_continuous_prev_messages)&&void 0!==i&&i,c.nextMessages=(null!==(a=n.next_messages)&&void 0!==a?a:[]).map((function(t){return Me(e,t)})),c.nextHasmore=null!==(o=n.next_hasmore)&&void 0!==o&&o,c.isContinuousNextMessages=null!==(u=n.is_continuous_next_messages)&&void 0!==u&&u,c}return e(n,t),n}(U),Us={includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0,includeParentMessageInfo:!0};!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api"}(fs||(fs={}));var Ss,Ts,As,Is=function(){function e(){this._onCacheResult=ce,this._onApiResult=ce}return e.prototype._invokeResponse=function(e,t,n){var s=this;H((function(){return h(s,void 0,void 0,(function(){return d(this,(function(s){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),ws=function(){function e(e,t){var n=t.filter,s=t.startingPoint,r=t.limit,i=t.prevResultLimit,a=t.nextResultLimit,o=t.channel,u=t.channelManager,_=t.disableBackgroundSync,f=void 0!==_&&_,v=this;this._messages=[],this._unsentMessages=[],this._isLoadingPrevious=!1,this._isLoadingNext=!1,this._iid=e,this._key="mc-".concat(ue()),this._isDisposed=!1,this.filter=null!=n?n:new we,this._channel=o,this._syncRange=new cs({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof s&&Number.isFinite(s)?s:Number.MAX_SAFE_INTEGER,this._limit=r||Qe,this._prevResultLimit=null!=i?i:Math.floor(this._limit/2),this._nextResultLimit=null!=a?a:Math.floor(this._limit/2),this._channelManager=u,this._channelManager.subscribeChannelEvent(this._key,{onUpdate:function(e,t){var n=t.source,s=e.findIndex((function(e){return e.isIdentical(v.channel)}));s>=0&&(v._replaceChannelOfCollection(e[s]),v.channel._runIfHandleableWithGroupChannel((function(e){switch(n){case E.EVENT_CHANNEL_UPDATED:for(var s=!1,r=0;r<v._messages.length;r++){if(v._messages[r].createdAt>=e.messageOffsetTimestamp){s=!0;var i=r;if(i>0){var a=v._messages.splice(0,i);v._removeMessagesFromView(a.map((function(e){return v.keyOf(e)})),E.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!s&&v._messages.length>0&&v._removeMessagesFromView(v._messages.map((function(e){return v.keyOf(e)})),E.EVENT_MESSAGE_OFFSET_UPDATED);break;case E.EVENT_CHANNEL_UNMUTED:var o=F.of(v._iid).sdkState,u=t.user;o.userId===u.userId&&v._clearCheckMyMutedTimer();break;case E.EVENT_CHANNEL_MUTED:o=F.of(v._iid).sdkState,u=t.user;o.userId===u.userId&&-1!==e._myMutedRemainingTime&&v._startCheckMyMutedTimer(e._myMutedRemainingTime);break;case E.EVENT_CHANNEL_LEFT:e.isPublic&&v._clearCheckMyMutedTimer()}H((function(){return h(v,void 0,void 0,(function(){var e;return d(this,(function(s){return pn(n)&&(null===(e=this._handler)||void 0===e?void 0:e.onChannelUpdated)&&this._handler.onChannelUpdated(t,this.channel),[2]}))}))}))})),v._postprocessChannelUpdateEvent(e[s],n))},onRemove:function(e,t){var n=e.indexOf(v.channel.url);n>=0&&(v._clearCheckMyMutedTimer(),H((function(){return h(v,void 0,void 0,(function(){var e;return d(this,(function(n){return(null===(e=this._handler)||void 0===e?void 0:e.onChannelDeleted)&&this._handler.onChannelDeleted(t,this.channel.url),[2]}))}))})),v._postprocessChannelRemoveEvent(e[n]))}}),this._channelManager.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,s,r=[],i=[];try{for(var a=p(e),o=a.next();!o.done;o=a.next()){var u=o.value;u.channelUrl===v._channel.url&&(v.filter.match(u)?r.push(u):i.push(v.keyOf(u)))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}if(ae(t)){if(r.length>0)switch(t){case E.LOCAL_MESSAGE_CANCELED:case E.LOCAL_MESSAGE_RESEND_STARTED:case E.EVENT_MESSAGE_SENT_FAILED:case E.EVENT_MESSAGE_SENT_SUCCESS:case E.EVENT_MESSAGE_UPDATED:case E.EVENT_MESSAGE_THREADINFO_UPDATED:case E.EVENT_MESSAGE_REACTION_UPDATED:case E.EVENT_MESSAGE_FEEDBACK_ADDED:case E.EVENT_MESSAGE_FEEDBACK_UPDATED:case E.EVENT_MESSAGE_FEEDBACK_DELETED:case E.SYNC_MESSAGE_CHANGELOGS:v._updateMessagesToView(r,t);break;case E.EVENT_MESSAGE_SENT_PENDING:v._addMessagesToView(r,t);break;case E.EVENT_MESSAGE_RECEIVED:v.hasNext||v._addMessagesToView(r,t);break;case E.SYNC_MESSAGE_FILL:v._addMessagesToView(r,t)}i.length>0&&v._removeMessagesFromView(i,t)}v._postprocessMessageUpdateEvent(e,t)},onRemove:function(e,t){v._removeMessagesFromView(e,t),v._postprocessMessageRemoveEvent(e)},onRemoveUnsent:function(e,t){v._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){v._updatePollsToView(e,t)},onPollUpdate:function(e,t){v._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){v._applyPollVoteEventToView(e,t)},onReactionUpdate:function(e,t){v._applyReactionEventToView(e,t)},onThreadInfoUpdate:function(e,t){v._applyThreadInfoEventToView(e,t)}});var m=F.of(this._iid),g=m.cacheContext,C=m.dispatcher;this._channel._updateMessageCollectionLastAccessedAt(),C.dispatch(new fn({channels:[this._channel],context:{source:E.CHANNEL_LASTACCESSEDAT_UPDATED}})),!f&&this._shouldStartBackgroundSync()&&(this._backgroundSync=gs.of(this._iid,this._channel),this._backgroundSync.resume(this._startingPoint)),this._changelogSync=Cs.of(this._iid,this._channel,this.changelogIncludeParams),this._changelogSync.resume(),this._pollChangelogSync=Ms.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new vs(this._key,(function(e){return h(v,void 0,void 0,(function(){var t,n,s,r,i,a,o;return d(this,(function(u){switch(u.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._prevResultLimit,source:E.SYNC_MESSAGE_FILL,checkingContinuousMessages:g.localCacheEnabled})];case 1:return t=u.sent(),n=t.messages,s=t.isContinuousMessages,n.length>0?(r=Math.min.apply(Math,c([],l(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(r),s&&(null===(i=this._backgroundSync)||void 0===i||i.range.extends(r)),[2,{hasNext:n.length>=this._prevResultLimit&&this.viewTop<r,nextToken:this._syncRange.top}]):(M.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(o=null===(a=g.localCacheConfig)||void 0===a?void 0:a.maxSize)&&void 0!==o?o:0,use_local_cache:g.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}}))}))})),this._nextFill=new vs(this._key,(function(e){return h(v,void 0,void 0,(function(){var t,n,s,r,i,a,o;return d(this,(function(u){switch(u.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._nextResultLimit,source:E.SYNC_MESSAGE_FILL,checkingContinuousMessages:g.localCacheEnabled})];case 1:return t=u.sent(),n=t.messages,s=t.isContinuousMessages,n.length>0?(r=Math.max.apply(Math,c([],l(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(r),s&&(null===(i=this._backgroundSync)||void 0===i||i.range.extends(r)),[2,{hasNext:!(n.length>=this._nextResultLimit&&this._hasNext)||this.viewBottom>r,nextToken:this._syncRange.bottom}]):(M.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(o=null===(a=g.localCacheConfig)||void 0===a?void 0:a.maxSize)&&void 0!==o?o:0,use_local_cache:g.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}}))}))})),this._connectionEventContext=C.on((function(e){if(e instanceof Z)switch(e.stateType){case $.CONNECTED:y((function(){return h(v,void 0,void 0,(function(){return d(this,(function(e){return this._activate(),[2]}))}))}));break;case $.LOGOUT:v.dispose();break;default:v._clearCheckMyMutedTimer(),v._prevFill.stop(),v._nextFill.stop()}}));var M=F.of(this._iid).statManager;M.put(new oe({type:te.FEATURE_LOCALCACHE,data:{use_local_cache:g.localCacheEnabled,collection_interface:{message:!0}}}))}return e.prototype.keyOf=function(e){return 0},Object.defineProperty(e.prototype,"changelogIncludeParams",{get:function(){return{includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0}},enumerable:!1,configurable:!0}),e.prototype._postprocessChannelUpdateEvent=function(e,t){},e.prototype._postprocessChannelRemoveEvent=function(e){},e.prototype._postprocessMessageUpdateEvent=function(e,t){},e.prototype._postprocessMessageRemoveEvent=function(e){},Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return c([],l(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===ie.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===ie.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,c(c([],l(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,c(c([],l(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype._activate=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return F.of(this._iid).logger.debug("check huge gap"),this._checkHugeGap(),[4,this._refreshChannel(E.SYNC_CHANNEL_CHANGELOGS)];case 1:return e.sent(),[2]}}))}))},e.prototype._replaceChannelOfCollection=function(e){this._channel.isGroupChannel()?this._channel=e:this._channel.isFeedChannel()&&(this._channel._groupChannel=e._groupChannel)},e.prototype._shouldStartBackgroundSync=function(){var e=F.of(this._iid).cacheContext;return this.channel.isGroupChannel()?e.localCacheEnabled&&!this.channel.isSuper:e.localCacheEnabled},e.prototype._setBaseMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){return e},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach((function(n){n instanceof Ve&&n.parentMessageId===e.messageId&&n.applyParentMessage(e)&&t.push(n)})),t},e.prototype._updatePollsToView=function(e,t){var n,s,r=this,i=[];try{for(var a=p(e),o=a.next();!o.done;o=a.next()){var u=o.value,c=_s(this._messages,u.messageId);if(c>=0){var l=this._messages[c];l.isUserMessage()&&l.applyPoll(u),i.push(l)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return i.length>0&&ae(t)&&H((function(){return h(r,void 0,void 0,(function(){var e,n,s;return d(this,(function(r){return e={source:t},i.length>0&&(null===(s=(n=this._handler).onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,i)),[2]}))}))})),i},e.prototype._applyPollUpdateEventToView=function(e,t){var n=this,s=_s(this._messages,e.messageId);if(s>=0){var r=this._messages[s];r&&r.isUserMessage()&&r.poll&&r.poll.applyPollUpdateEvent(e)&&ae(t)&&H((function(){return h(n,void 0,void 0,(function(){var e,n,s;return d(this,(function(i){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))}))}},e.prototype._applyPollVoteEventToView=function(e,t){var n=this,s=_s(this._messages,e.messageId);if(s>=0){var r=this._messages[s];r&&r.isUserMessage()&&r.poll&&r.poll.applyPollVoteEvent(e)&&ae(t)&&H((function(){return h(n,void 0,void 0,(function(){var e,n,s;return d(this,(function(i){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))}))}},e.prototype._applyReactionEventToView=function(e,t){var n=this,s=_s(this._messages,e.messageId);if(s>=0){var r=this._messages[s];r&&(r.isUserMessage()||r.isFileMessage()||r.isMultipleFilesMessage())&&ae(t)&&(r.applyReactionEvent(e),H((function(){return h(n,void 0,void 0,(function(){var e,n,s;return d(this,(function(i){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))})))}},e.prototype._applyThreadInfoEventToView=function(e,t){var n=this,s=_s(this._messages,e.targetMessageId);if(s>=0){var r=this._messages[s];r&&(r.isUserMessage()||r.isFileMessage()||r.isMultipleFilesMessage())&&ae(t)&&(r.applyThreadInfoUpdateEvent(e),H((function(){return h(n,void 0,void 0,(function(){var e,n,s;return d(this,(function(i){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,[r]),[2]}))}))})))}},e.prototype._removeMessagesFromView=function(e,t){var n,s,r=this,i=[],a=[],o=function(e){var t=u._messages.findIndex((function(t){return r.keyOf(t)===e}));if(t>=0){var n=u._messages[t];i.push(u.keyOf(n)),a.push(n),u._messages.splice(t,1)}},u=this;try{for(var c=p(e),l=c.next();!l.done;l=c.next()){o(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(n)throw n.error}}return ae(t)&&a.length>0&&H((function(){return h(r,void 0,void 0,(function(){var e,n,s;return d(this,(function(r){return e={source:t},null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesDeleted)||void 0===s||s.call(n,e,this.channel,i,a),[2]}))}))})),i},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,s=void 0===n?0:n,r=t.nextLimit,i=void 0===r?0:r,a=t.inclusive,o=void 0===a||a;return h(this,void 0,void 0,(function(){var t,n,r,a,u;return d(this,(function(h){switch(h.label){case 0:return t=[],o?[4,this._channelManager.getExactlyMatchingMessagesForTokenFromCache(this._channel.url,e,this.filter)]:[3,2];case 1:t=h.sent(),h.label=2;case 2:return s>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"prev",this.filter,s,!1)]:[3,4];case 3:return r=h.sent(),[3,5];case 4:r=[],h.label=5;case 5:return n=r,i>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"next",this.filter,i,!1)]:[3,7];case 6:return u=h.sent(),[3,8];case 7:u=[],h.label=8;case 8:return a=u,[2,c(c(c([],l(t),!1),l(n),!1),l(a),!1).sort((function(e,t){return t.createdAt-e.createdAt}))]}}))}))},e.prototype._getRemoteMessages=function(e,t){var r=t.prevLimit,i=void 0===r?0:r,a=t.nextLimit,o=void 0===a?0:a,u=t.source,c=void 0===u?E.REQUEST_MESSAGE:u,l=t.reverse,_=void 0!==l&&l,p=t.checkingHasNext,f=void 0!==p&&p,v=t.checkingContinuousMessages,m=void 0!==v&&v;return h(this,void 0,void 0,(function(){var t,r;return d(this,(function(a){switch(a.label){case 0:return t=Ye.of(this._iid),i>0||o>0?[4,t._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,e,n(s(s(s({},this.filter),Us),{isInclusive:!0,reverse:_,prevResultSize:i,nextResultSize:o})),c,f,m)]:[3,2];case 1:return r=a.sent(),[3,3];case 2:r={messages:[],isContinuousMessages:!1},a.label=3;case 3:return[2,r]}}))}))},e.prototype._checkHugeGap=function(){var e,t,n,r,i;return h(this,void 0,void 0,(function(){var a,o,_,p,f,v,m,g,C,y,M,b,N,U,S,T,A,I,w,L,D,x,R,P,k,O=this;return d(this,(function(V){switch(V.label){case 0:return a=F.of(this._iid),o=a.dispatcher,_=a.requestQueue,p=a.cacheContext,f=a.statManager,v=a.logger,this._messages.length>0?(m=this._syncRange.top,g=this.viewTop,C=this._syncRange.bottom,y=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,g,m)]):[3,8];case 1:return M=V.sent(),[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,C,y)];case 2:b=V.sent(),V.label=3;case 3:return V.trys.push([3,5,6,7]),[4,le((function(){return h(O,void 0,void 0,(function(){var e,t,n,r,i,a,u,f,v,N,U,S,T,A,I,w,L,D=this;return d(this,(function(x){switch(x.label){case 0:return e=new bs(s(s({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:g,prevEnd:m,prevCount:M,nextStart:C,nextEnd:y,nextCount:b,checkingContinuousMessages:p.localCacheEnabled},this.filter),Us)),[4,_.send(e)];case 1:return t=x.sent(),n=t.as(Ns),r=n.isHugeGap,i=n.prevMessages,a=void 0===i?[]:i,u=n.prevHasMore,f=n.isContinuousPrevMessages,v=n.nextMessages,N=void 0===v?[]:v,U=n.nextHasmore,S=n.isContinuousNextMessages,r?H((function(){return h(D,void 0,void 0,(function(){var e;return d(this,(function(t){return(null===(e=this._handler)||void 0===e?void 0:e.onHugeGapDetected)&&this._handler.onHugeGapDetected(),[2]}))}))})):(T=this.viewTop,A=this.viewBottom,I=Math.min.apply(Math,c([Number.MAX_SAFE_INTEGER,T],l(a.map((function(e){return e.createdAt}))),!1)),w=Math.max.apply(Math,c([0,A],l(N.map((function(e){return e.createdAt}))),!1)),o.dispatch(new j({messages:a,source:E.SYNC_MESSAGE_FILL})),o.dispatch(new j({messages:N,source:E.SYNC_MESSAGE_FILL})),this._syncRange.extends(I,w),(f||S)&&(null===(L=this._backgroundSync)||void 0===L||L.range.extends(I,w)),u&&this._prevFill.start(I),U&&this._nextFill.start(w)),[2]}}))}))}),1)];case 4:return V.sent(),[3,7];case 5:return N=V.sent(),v.debug("Failed HugeGap Check ",N),[3,7];case 6:return f.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(t=null===(e=p.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:p.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[3,13];case 8:U=Date.now(),V.label=9;case 9:return V.trys.push([9,11,12,13]),[4,this._getRemoteMessages(U,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit,source:E.SYNC_MESSAGE_FILL,checkingHasNext:!0,checkingContinuousMessages:p.localCacheEnabled})];case 10:if(S=V.sent(),T=S.messages,A=S.isContinuousMessages,I=S.hasNext,T.length>0){for(w=T.map((function(e){return e.createdAt})),L=0,D=0,x=0;x<w.length;x++)(R=w[x])<=U?L++:R>=U&&D++;this._hasPrevious=L>=this._prevResultLimit,this._hasNext=null!=I?I:D>=this._nextResultLimit,(k=this._syncRange).extends.apply(k,c([],l(w),!1)),A&&(null===(n=this._backgroundSync)||void 0===n||n.range.extends(this._syncRange.top,this._syncRange.bottom)),this._addMessagesToView(T,E.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;return[3,13];case 11:return(P=V.sent())instanceof u&&P.code===Y.NOT_FOUND_IN_DATABASE&&(this._hasPrevious=!1,this._hasNext=!1),[3,13];case 12:return f.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(i=null===(r=p.localCacheConfig)||void 0===r?void 0:r.maxSize)&&void 0!==i?i:0,use_local_cache:p.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 13:return[2]}}))}))},e.prototype._loadUnsentMessages=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return e=this,[4,this._channelManager.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return e._unsentMessages=t.sent(),[2]}}))}))},e.prototype._hasPollMessage=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this._channelManager.getPollMessagesFromCache(this._channel.url,Date.now()+6e5,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}}))}))},e.prototype._refreshChannel=function(e){var t=this;y((function(){return h(t,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this._channelManager.refreshChannel(this.channel.url,!0,e)];case 1:return t.sent(),[2]}}))}))}))},e.prototype._startCheckMyMutedTimer=function(e){var t=this;this._clearCheckMyMutedTimer(),this._checkMyMutedStateTimer=setTimeout((function(){return h(t,void 0,void 0,(function(){var e,t,n,s=this;return d(this,(function(r){switch(r.label){case 0:this._checkMyMutedStateTimer=void 0,e=!0,r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this._channel.getMyMutedInfo()];case 2:return t=r.sent(),e=!t.isMuted,[3,5];case 3:return r.sent(),e=!0,[3,5];case 4:return e&&(n=F.of(this._iid).sessionManager,this.channel._runIfHandleableWithGroupChannel((function(e){var t,r;e.myMutedState=G.UNMUTED;var i={source:E.EVENT_CHANNEL_UNMUTED,user:n.currentUser};null===(r=null===(t=s._handler)||void 0===t?void 0:t.onChannelUpdated)||void 0===r||r.call(t,i,s.channel)}))),[7];case 5:return[2]}}))}))}),e+1e3)},e.prototype._clearCheckMyMutedTimer=function(){this._checkMyMutedStateTimer&&(clearTimeout(this._checkMyMutedStateTimer),this._checkMyMutedStateTimer=void 0)},e.prototype.initialize=function(e){var t=this,n=new Is;this._messages=[],this._unsentMessages=[],this._syncRange=new cs({}),this._hasNext=!0,this._hasPrevious=!0,this._refreshChannel(E.REFRESH_CHANNEL);var s=F.of(this._iid),r=s.cacheContext,i=s.statManager;if(e===fs.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit}).then((function(e){return h(t,void 0,void 0,(function(){var t;return d(this,(function(s){switch(s.label){case 0:return t=this._filterUnderOffsetMessage(e),this._addMessagesToView(t,E.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return s.sent(),n._invokeResponse("local",null,t),[2]}}))}))})).catch((function(e){if(O(e))throw e;n._invokeResponse("local",e,null)})).finally((function(){var s=F.of(t._iid).cacheContext;t._getRemoteMessages(t._startingPoint,{prevLimit:t._prevResultLimit,nextLimit:t._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:s.localCacheEnabled}).then((function(r){var a,o,u,h,d,_,p=r.messages,f=r.isContinuousMessages,v=r.hasNext,m=t._filterUnderOffsetMessage(p),g=!0;if(t._messages.length===m.length){for(var C=t._messages.map((function(e){return t.keyOf(e)})),y=0;y<m.length;y++)if(!C.includes(t.keyOf(m[y]))){g=!1;break}}else g=!1;if(t._messages=[],m.length>0){var M=m.map((function(e){return e.createdAt})),b=0,N=0;for(y=0;y<M.length;y++){var U=M[y];U<t._startingPoint?b++:U>t._startingPoint&&N++}t._hasPrevious=b>=t._prevResultLimit,t._hasNext=null!=v?v:N>=t._nextResultLimit,(a=t._syncRange).extends.apply(a,c([],l(m.map((function(e){return e.createdAt}))),!1)),f&&(null===(o=t._backgroundSync)||void 0===o||o.range.extends(t._syncRange.top,t._syncRange.bottom)),t._addMessagesToView(m,E.REQUEST_MESSAGE)}else t._hasPrevious=!1,t._hasNext=!1;i.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:t.channel.url,starting_point:t._startingPoint,measured_on:"initial_load",event:g?"cache_hit":"cache_miss",max_db_size:null!==(h=null===(u=s.localCacheConfig)||void 0===u?void 0:u.maxSize)&&void 0!==h?h:0,message_init_policy:e,use_local_cache:s.localCacheEnabled,collection_id:t._key}})),i.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:t.channel.url,starting_point:t._startingPoint,measured_on:"initial_load",event:"cache_fetch",max_db_size:null!==(_=null===(d=s.localCacheConfig)||void 0===d?void 0:d.maxSize)&&void 0!==_?_:0,message_init_policy:e,use_local_cache:s.localCacheEnabled,collection_id:t._key}})),n._invokeResponse("remote",null,m)})).catch((function(e){if(O(e))throw e;n._invokeResponse("remote",e,null)}))}));return i.put(new oe({type:te.FEATURE_LOCALCACHE,data:{use_local_cache:r.localCacheEnabled,collection_interface:{message_init_policy:e}}})),n},e.prototype.loadPrevious=function(){var e,t,n;return h(this,void 0,void 0,(function(){var s,r,i,a,o,_,p,f,v=this;return d(this,(function(m){switch(m.label){case 0:if(this._isDisposed)throw new u({code:Y.COLLECTION_DISPOSED,message:"Collection has been disposed."});return s=F.of(this._iid),r=s.cacheContext,i=s.statManager,a=s.logger,this._hasPrevious?this._isLoadingPrevious?(a.warn("Messages are already fetching."),[2,[]]):(this._isLoadingPrevious=!0,o=this.viewTop,_=[],[4,y((function(){return h(v,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getLocalMessages(o,{prevLimit:this._prevResultLimit,inclusive:!1})];case 1:return _=e.apply(this,[t.sent()]),[2]}}))}))}))]):[2,[]];case 1:return m.sent(),p=_.length>=this._prevResultLimit,i.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:r.localCacheEnabled&&p?"cache_hit":"cache_miss",max_db_size:null!==(t=null===(e=r.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:r.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),p&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(_))?[3,3]:(f=!1,[4,y((function(){return h(v,void 0,void 0,(function(){var e,t,n,s,r,a,u,h=this;return d(this,(function(d){switch(d.label){case 0:return e=F.of(this._iid).cacheContext,[4,this._getRemoteMessages(o,{prevLimit:this._prevResultLimit,reverse:!0,checkingContinuousMessages:e.localCacheEnabled})];case 1:return t=d.sent(),(_=this._filterUnderOffsetMessage(t.messages)).length>0&&((n=this._syncRange).extends.apply(n,c([],l(_.map((function(e){return e.createdAt}))),!1)),(null===(s=this._backgroundSync)||void 0===s?void 0:s.range.overlap(this._syncRange))&&t.isContinuousMessages&&(f=!0,null===(r=this._backgroundSync)||void 0===r||r.range.extends(this._syncRange.top))),_=_.filter((function(e){return ds(h._messages,e)<0})),this._hasPrevious=_.length>=this._prevResultLimit,f&&i.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:"cache_fetch",max_db_size:null!==(u=null===(a=e.localCacheConfig)||void 0===a?void 0:a.maxSize)&&void 0!==u?u:0,use_local_cache:e.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}}))}))}))]);case 2:return m.sent(),this._addMessagesToView(_,E.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=_.length>=this._prevResultLimit,_.length>0&&this._addMessagesToView(_,E.REQUEST_MESSAGE),m.label=4;case 4:return this._isLoadingPrevious=!1,[2,_]}}))}))},e.prototype.loadNext=function(){var e,t,n;return h(this,void 0,void 0,(function(){var s,r,i,a,o,_,p,f,v=this;return d(this,(function(m){switch(m.label){case 0:if(this._isDisposed)throw new u({code:Y.COLLECTION_DISPOSED,message:"Collection has been disposed."});return s=F.of(this._iid),r=s.cacheContext,i=s.statManager,a=s.logger,this._hasNext?this._isLoadingNext?(a.warn("Messages are already fetching."),[2,[]]):(this._isLoadingNext=!0,o=this.viewBottom,_=[],[4,y((function(){return h(v,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getLocalMessages(o,{nextLimit:this._nextResultLimit,inclusive:!1})];case 1:return _=e.apply(this,[t.sent()]),[2]}}))}))}))]):[2,[]];case 1:return m.sent(),p=_.length>=this._nextResultLimit,i.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:r.localCacheEnabled&&p?"cache_hit":"cache_miss",max_db_size:null!==(t=null===(e=r.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:r.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),p&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(_))?[3,3]:(f=!1,[4,y((function(){return h(v,void 0,void 0,(function(){var e,t,n,s,r,a,u,h,p=this;return d(this,(function(d){switch(d.label){case 0:return e=F.of(this._iid).cacheContext,[4,this._getRemoteMessages(o,{nextLimit:this._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:e.localCacheEnabled})];case 1:return t=d.sent(),(_=this._filterUnderOffsetMessage(t.messages)).length>0&&((n=this._syncRange).extends.apply(n,c([],l(_.map((function(e){return e.createdAt}))),!1)),(null===(s=this._backgroundSync)||void 0===s?void 0:s.range.overlap(this._syncRange))&&t.isContinuousMessages&&(f=!0,null===(r=this._backgroundSync)||void 0===r||r.range.extends(this._syncRange.bottom))),_=_.filter((function(e){return ds(p._messages,e)<0})),this._hasNext=null!==(a=t.hasNext)&&void 0!==a?a:_.length>=this._nextResultLimit,f&&i.put(new ee({type:te.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:"cache_fetch",max_db_size:null!==(h=null===(u=e.localCacheConfig)||void 0===u?void 0:u.maxSize)&&void 0!==h?h:0,use_local_cache:e.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}}))}))}))]);case 2:return m.sent(),this._addMessagesToView(_,E.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=_.length>=this._nextResultLimit,_.length>0&&this._addMessagesToView(_,E.REQUEST_MESSAGE),m.label=4;case 4:return this._isLoadingNext=!1,[2,_]}}))}))},e.prototype.removeFailedMessage=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:if(this._isDisposed)throw new u({code:Y.COLLECTION_DISPOSED,message:"Collection has been disposed."});return[4,this._channelManager.removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},e.prototype.dispose=function(){var e,t,n,s=this;if(!this._isDisposed){this._isDisposed=!0;var r=F.of(this._iid),i=r.cacheContext,a=r.dispatcher;this._messages=[],this._clearCheckMyMutedTimer(),this._channel._runIfHandleableWithGroupChannel((function(e){e.myMemberState!==qt.NONE&&(s._channel._updateMessageCollectionLastAccessedAt(),a.dispatch(new fn({channels:[s._channel],context:{source:E.CHANNEL_LASTACCESSEDAT_UPDATED}})))})),i.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._pollChangelogSync)||void 0===n||n.close(),this._channelManager.unsubscribeChannelEvent(this._key),this._channelManager.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}},e}(),Ls=function(t){function n(e,n){return t.call(this,e,s(s({},n),{channelManager:hs.of(e)}))||this}return e(n,t),n.prototype.keyOf=function(e){return e.messageId},n.prototype.initialize=function(e){var n=this;return y((function(){return h(n,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(e=t.sent()).isMuted&&-1!==e.remainingDuration&&this._startCheckMyMutedTimer(e.remainingDuration),[2]}}))}))})),t.prototype.initialize.call(this,e)},n.prototype.setMessageCollectionHandler=function(e){this._setBaseMessageCollectionHandler(e)},n.prototype._activate=function(){return h(this,void 0,void 0,(function(){var e=this;return d(this,(function(n){switch(n.label){case 0:return[4,t.prototype._activate.call(this)];case 1:return n.sent(),[4,y((function(){return h(e,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(e=t.sent()).isMuted&&-1!==e.remainingDuration&&this._startCheckMyMutedTimer(e.remainingDuration),[2]}}))}))}))];case 2:return n.sent(),[2]}}))}))},n.prototype._addMessagesToView=function(e,t){var n,s,r=this,i=this._filterUnderOffsetMessage(e),a=[],o=[];try{for(var u=p(i),_=u.next();!_.done;_=u.next()){var f=_.value;if(t===E.SYNC_MESSAGE_FILL){if(f.messageId>0){if((C=ds(this._messages,f))<0){ds(this._unsentMessages,f)<0&&a.push(f);var v=ps(this._messages,f);this._messages.splice(v,0,f)}}else if(f instanceof Be){(C=ds(this._unsentMessages,f))<0&&ds(this._messages,f)<0&&(this._unsentMessages.push(f),a.push(f))}}else if(f.messageId>0){if((C=ds(this._messages,f))<0){var m=ds(this._unsentMessages,f);m<0?a.push(f):(this._unsentMessages.splice(m,1),o.push(f));v=ps(this._messages,f);this._messages.splice(v,0,f)}else o.push(f),this._messages[C]=f;if(f.updatedAt>0){var g=this._updateChildMessagesInView(f);o.push.apply(o,c([],l(g),!1))}}else if(f instanceof Be){var C;(C=ds(this._unsentMessages,f))<0?ds(this._messages,f)<0&&(this._unsentMessages.push(f),a.push(f)):(o.push(f),this._unsentMessages[C]=f)}}}catch(e){n={error:e}}finally{try{_&&!_.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}ae(t)&&H((function(){return h(r,void 0,void 0,(function(){var e,n,s,r,i;return d(this,(function(u){return e={source:t},a.length>0&&(null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesAdded)||void 0===s||s.call(n,e,this.channel,a)),o.length>0&&(null===(i=null===(r=this._handler)||void 0===r?void 0:r.onMessagesUpdated)||void 0===i||i.call(r,e,this.channel,o)),[2]}))}))}))},n.prototype._updateMessagesToView=function(e,t){var n,s,r=this,i=[],a=[],o=[];try{for(var u=p(e),_=u.next();!_.done;_=u.next()){var f,v=_.value;if(v.messageId>0)if((f=ds(this._messages,v))>=0)a.push(v),this._messages[f]=v;else{var m=ds(this._unsentMessages,v);if(m>=0){var g=l(this._unsentMessages.splice(m,1),1)[0];if(this.hasNext&&g)o.push(g);else{a.push(v);var E=ps(this._messages,v);this._messages.splice(E,0,v)}}else{var C=this._messages.map((function(e){return e.createdAt}));(v.createdAt<Math.min.apply(Math,c([],l(C),!1))&&!this._hasPrevious||v.createdAt>Math.max.apply(Math,c([],l(C),!1))&&!this._hasNext)&&i.push(v)}}else if(v instanceof Be)(f=ds(this._unsentMessages,v))>=0&&(a.push(v),this._unsentMessages[f]=v)}}catch(e){n={error:e}}finally{try{_&&!_.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}return ae(t)&&H((function(){return h(r,void 0,void 0,(function(){var e,n,s,r,u;return d(this,(function(c){return e={source:t},a.length>0?null===(s=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===s||s.call(n,e,this.channel,a):o.length>0?null===(u=null===(r=this._handler)||void 0===r?void 0:r.onMessagesDeleted)||void 0===u||u.call(r,e,this.channel,[],o):i.length>0&&this._addMessagesToView(i,t),[2]}))}))})),a},n}(ws),Ds={coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isPublic:void 0,isDiscoverable:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},xs=function(t){function n(e){var n=this,s=e.channelUrl,r=e.token,i=e.limit,a=e.order,o=e.mutedMemberFilter,u=e.memberStateFilter,c=e.nicknameStartsWithFilter,l=e.operatorFilter;return(n=t.call(this)||this).method=M.GET,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/members"),n.params={token:r,limit:i,order:a,muted_member_filter:o,member_state_filter:u,nickname_startswith:c,operator_filter:l,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return e(n,t),n}(N),Rs=function(t){function n(e,n){var s=t.call(this,e,n)||this;s.members=[];var r=n.next,i=n.members;return s.token=r,i&&i.length>0&&(s.members=i.map((function(t){return new Zt(e,t)}))),s}return e(n,t),n}(U);!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(Ss||(Ss={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(Ts||(Ts={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(As||(As={}));var Fs=function(t){function i(e,n,s){var r,i,a,o,u=this;return(u=t.call(this,e,n,k.GROUP,s)||this).mutedMemberFilter=Ss.ALL,u.memberStateFilter=As.ALL,u.nicknameStartsWithFilter=null,u.operatorFilter=Yt.ALL,u.order=Ts.MEMBER_NICKNAME_ALPHABETICAL,u.mutedMemberFilter=null!==(r=s.mutedMemberFilter)&&void 0!==r?r:Ss.ALL,u.memberStateFilter=null!==(i=s.memberStateFilter)&&void 0!==i?i:As.ALL,u.nicknameStartsWithFilter=null!==(a=s.nicknameStartsWithFilter)&&void 0!==a?a:null,u.order=null!==(o=s.order)&&void 0!==o?o:Ts.MEMBER_NICKNAME_ALPHABETICAL,u}return e(i,t),i.prototype._validate=function(){return t.prototype._validate.call(this)&&r(Ss,this.mutedMemberFilter)&&r(As,this.memberStateFilter)&&(v("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&r(Yt,this.operatorFilter)&&r(Ts,this.order)},i.prototype.next=function(){return h(this,void 0,void 0,(function(){var e,t,r,i,a,o;return d(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=F.of(this._iid).requestQueue,t=new xs(n(s(s({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=c.sent(),i=r.as(Rs),a=i.members,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw u.queryInProgress;case 4:return[3,6];case 5:throw u.invalidParameters;case 6:return[2]}}))}))},i}(he),Ps=function(t){function n(e){var n=this,s=e.channelUrl,r=e.userId,i=e.accessCode;return(n=t.call(this)||this).method=M.PUT,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/accept"),n.params={user_id:r,access_code:i},n}return e(n,t),n}(N),ks=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new dr(e,n),s.channel.myMemberState=qt.JOINED,s}return e(n,t),n}(U),Os=function(n){function s(e){var s=this,r=e.channelUrl,i=e.isDistinct,a=e.isPublic,o=e.isDiscoverable,u=e.coverUrl,c=e.coverImage,l=e.accessCode,h=e.name,d=e.data,_=e.customType,p=e.operatorUserIds,f=e.messageSurvivalSeconds;return(s=n.call(this)||this).method=M.PUT,s.path="".concat(T,"/").concat(encodeURIComponent(r)),s.params=t({is_distinct:i,is_public:a,is_discoverable:o,name:h,data:d,custom_type:_,cover_url:u,cover_file:c,access_code:l,operator_ids:p,message_survival_seconds:f}),s}return e(s,n),s}(N),Hs=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.channel=new dr(e,n),s}return e(n,t),n}(U),Vs=function(t){function n(e){var n=this,s=e.channelUrl;return(n=t.call(this)||this).method=M.DELETE,n.path="".concat(T,"/").concat(encodeURIComponent(s)),n}return e(n,t),n}(N);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(U);var Gs=function(t){function n(e){var n=this,s=e.channelUrl;return(n=t.call(this)||this).method=M.DELETE,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/hide"),n}return e(n,t),n}(N);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(U);var Bs=function(t){function n(e){var n=e.userId,s=e.channelUrl,r=e.countPreference,i=t.call(this)||this;return i.method=M.PUT,i.path="".concat(b,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(s)),i.params={count_preference:r},i}return e(n,t),n}(N),qs=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.countPreference=n.count_preference,s}return e(n,t),n}(U),zs=function(t){function n(e){var n=this,s=e.channelUrl;return(n=t.call(this)||this).method=M.PUT,n.path="".concat(T,"/").concat(encodeURIComponent(s),"/reset_user_history"),n}return e(n,t),n}(N),js=function(t){function n(e,n){var s=t.call(this,e,n)||this,r=n.ts_message_offset;return s.messageOffsetTimestamp=r,s}return e(n,t),n}(U),Ws=s(s({},Je),{scheduledAt:void 0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),Qs=s(s({},Ze),{scheduledAt:void 0}),Ks=function(s){function r(e){var r,i,a=this;a=s.call(this)||this;var o=[];e.mentionType===de.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map((function(e){return e.userId}))));var u=e.channelType,c=e.channelUrl,l=e.scheduledMessageId;return a.method=M.PUT,a.path="".concat(re(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),a.params=t(n({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:_e.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:null===(r=e._thumbnails)||void 0===r?void 0:r.map((function(e){return et.payloadify(e)})),custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((function(e){return tt.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?nt.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption})),a}return e(r,s),r}(N),Ys=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.message=new Te(e,n),s}return e(n,t),n}(U),Js=function(s){function r(e){var r,i=this;i=s.call(this)||this;var a=[];e.mentionType===de.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl,c=e.scheduledMessageId;return i.method=M.PUT,i.path="".concat(re(o),"/").concat(encodeURIComponent(u),"/scheduled_messages/").concat(encodeURIComponent(c)),i.params=t(n({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:_e.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:a,sorted_metaarray:null===(r=e.metaArrays)||void 0===r?void 0:r.map((function(e){return tt.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?nt.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),i}return e(r,s),r}(N);!function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.message=new Se(e,n),s}e(n,t)}(U);var Xs=function(t){function n(e){var n=t.call(this)||this,s=e.channelType,r=e.channelUrl,i=e.scheduledMessageId;return n.method=M.DELETE,n.path="".concat(re(s),"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i)),n}return e(n,t),n}(N),Zs=function(t){function n(e){var n=t.call(this)||this,s=e.channelType,r=e.channelUrl,i=e.scheduledMessageId;return n.method=M.POST,n.path="".concat(re(s),"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i),"/send_now"),n}return e(n,t),n}(N),$s=function(t){function n(e){var n=e.userId,s=e.channelUrl,r=e.pushTriggerOption,i=t.call(this)||this;return i.method=M.PUT,i.path="".concat(b,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(s)),i.params={push_trigger_option:r},i}return e(n,t),n}(N),er=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.pushTriggerOption=n.push_trigger_option,s.enabled=n.enable,s}return e(n,t),n}(U),tr=function(t){function n(e){var n=e.userId,s=e.channelUrl,r=t.call(this)||this;return r.method=M.GET,r.path="".concat(b,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(s)),r}return e(n,t),n}(N),nr=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.pushTriggerOption=n.push_trigger_option,s.enabled=n.enable,s}return e(n,t),n}(U),sr=function(t){function n(e){var n=e.channelType,s=e.channelUrl,r=e.messageId,i=t.call(this)||this;return i.method=M.POST,i.path="".concat(re(n),"/").concat(encodeURIComponent(s),"/messages/").concat(r,"/pin"),i}return e(n,t),n}(N);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(U);var rr=function(t){function n(e){var n=e.channelType,s=e.channelUrl,r=e.messageId,i=t.call(this)||this;return i.method=M.DELETE,i.path="".concat(re(n),"/").concat(encodeURIComponent(s),"/messages/").concat(r,"/pin"),i}return e(n,t),n}(N);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(U);var ir,ar,or=function(t){function n(e,n){var s=t.call(this,e)||this;return s.message=null,s.message=Me(e,n.message),s}return e(n,t),n}(_),ur=function(n){function s(e){var s=this,r=e.channelType,i=e.channelUrl,a=e.limit,o=e.token,u=e.includeReactions,c=e.includeMetaArray,l=e.includeParentMessageInfo,h=e.includeThreadInfo,d=e.includePollDetails;return(s=n.call(this)||this).method=M.GET,s.path="".concat(re(r),"/").concat(encodeURIComponent(i),"/pinned_messages"),s.params=t({limit:a,token:o,include_reactions:u,with_sorted_meta_array:c,include_thread_info:h,include_parent_message_info:l,include_poll_details:d}),s}return e(s,n),s}(N),cr=function(t){function n(e,n){var s=t.call(this,e,n)||this,r=n.pinned_messages,i=n.has_more,a=n.next;return s.pinnedMessages=r.map((function(t){return new or(e,t)})),s.hasMore=i,s.token=a,s}return e(n,t),n}(U),lr=function(t){function n(e,n,s,r){var i=t.call(this,e,n,s,r)||this;return i.includeMetaArray=r.includeMetaArray,i.includeReactions=r.includeReactions,i.includeParentMessageInfo=r.includeParentMessageInfo,i.includeThreadInfo=r.includeThreadInfo,i.includePollDetails=r.includePollDetails,i}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&v("boolean",this.includeMetaArray,!0)&&v("boolean",this.includeReactions,!0)&&v("boolean",this.includeParentMessageInfo,!0)&&v("boolean",this.includeThreadInfo,!0)&&v("boolean",this.includePollDetails,!0)},n.prototype.next=function(){return h(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return d(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=F.of(this._iid).requestQueue,t=new ur(s(s({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=c.sent(),r=n.as(cr),i=r.pinnedMessages,a=r.hasMore,o=r.token,this._token=o,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw u.queryInProgress;case 4:return[3,6];case 5:throw u.invalidParameters;case 6:return[2]}}))}))},n}(he),hr=function(t){function n(e,n){var s,r,i=this;return(i=t.call(this,e)||this).channelUrl=null!==(s=n.channel_url)&&void 0!==s?s:"",i.channelType=null!==(r=n.channel_type)&&void 0!==r?r:k.GROUP,i.member=new I(i._iid,n.user),i.deliveryAt=n.ts,i}return e(n,t),n}(_);!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(ir||(ir={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(ar||(ar={}));var dr=function(a){function _(e,t){var n,o,u,h,d,_,p,f,m,g,E,C,y,M,b,N,U,S,T,A,w,L=this;return(L=a.call(this,e,t)||this)._unreadMemberStateMap=new Map,L._undeliveredMemberStateMap=new Map,L._typingStatus=new Map,L._lastMemberCountUpdated=0,L._typingStarted=0,L._typingEnded=0,L.isDistinct=!1,L.isSuper=!1,L.isBroadcast=!1,L.isExclusive=!1,L.isPublic=!1,L.isDiscoverable=!0,L.isChatNotification=!1,L.isAccessCodeRequired=!1,L.isPushEnabled=!1,L.unreadMessageCount=0,L.unreadMentionCount=0,L.totalUnreadReplyCount=0,L.members=[],L.memberCount=0,L.joinedMemberCount=0,L.hiddenState=ar.UNHIDDEN,L.lastMessage=null,L.messageOffsetTimestamp=0,L.messageSurvivalSeconds=-1,L.myMemberState=qt.NONE,L.myRole=i.NONE,L.myMutedState=G.UNMUTED,L.myLastRead=0,L.myCountPreference=ir.ALL,L.myPushTriggerOption=fe.DEFAULT,L.inviter=null,L.invitedAt=0,L.joinedAt=0,L.pinnedMessageIds=[],L.lastPinnedMessage=null,L._pinnedMessagesUpdatedAt=0,L._myMutedRemainingTime=-1,L.channelType=k.GROUP,L.isDistinct=null!==(o=t.is_distinct)&&void 0!==o&&o,L.isSuper=null!==(u=t.is_super)&&void 0!==u&&u,L.isBroadcast=null!==(h=t.is_broadcast)&&void 0!==h&&h,L.isExclusive=null!==(d=t.is_exclusive)&&void 0!==d&&d,L.isPublic=null!==(_=t.is_public)&&void 0!==_&&_,L.isDiscoverable=null!==(p=t.is_discoverable)&&void 0!==p?p:L.isPublic,L.isChatNotification=null!==(f=t.is_chat_notification)&&void 0!==f&&f,L.isAccessCodeRequired=null!==(m=t.is_access_code_required)&&void 0!==m&&m,L.isPushEnabled=null!==(g=t.is_push_enabled)&&void 0!==g&&g,Array.isArray(t.members)&&(n=L.members).push.apply(n,c([],l(t.members.map((function(e){return new Zt(L._iid,e)}))),!1)),L.memberCount=null!==(E=t.member_count)&&void 0!==E?E:0,L.joinedMemberCount=null!==(C=t.joined_member_count)&&void 0!==C?C:0,L.hiddenState=r(ar,t.hidden_state)?t.hidden_state:ar.UNHIDDEN,L.messageOffsetTimestamp=null!==(y=t.ts_message_offset)&&void 0!==y?y:0,L.messageSurvivalSeconds=null!==(M=t.message_survival_seconds)&&void 0!==M?M:-1,L.lastMessage=t.last_message?Me(L._iid,s({channel_type:L.channelType},t.last_message)):null,t.read_receipt&&Object.keys(t.read_receipt).forEach((function(e){v("number",t.read_receipt[e])&&L._updateUnreadMemberState(e,t.read_receipt[e])})),t.delivery_receipt&&Object.keys(t.delivery_receipt).forEach((function(e){v("number",t.delivery_receipt[e])&&L._updateUndeliveredMemberState(e,t.delivery_receipt[e])})),L.myMemberState=r(qt,t.member_state)?t.member_state:qt.NONE,L.myRole=r(i,t.my_role)?t.my_role:i.NONE,r(G,t.is_muted)?L.myMutedState=t.is_muted:v("boolean",t.is_muted)?L.myMutedState=t.is_muted?G.MUTED:G.UNMUTED:L.myMutedState=G.UNMUTED,L.myCountPreference=r(ir,t.count_preference)?t.count_preference:ir.ALL,L.myPushTriggerOption=r(fe,t.push_trigger_option)?t.push_trigger_option:fe.ALL,L.myLastRead=null!==(b=t.user_last_read)&&void 0!==b?b:0,L.inviter=t.inviter?new I(L._iid,t.inviter):null,L.invitedAt=null!==(N=t.invited_at)&&void 0!==N?N:0,L.joinedAt=null!==(U=t.joined_ts)&&void 0!==U?U:0,L._updateUnreadCount(null!==(S=t.unread_message_count)&&void 0!==S?S:0,null!==(T=t.unread_mention_count)&&void 0!==T?T:0),L.totalUnreadReplyCount=null!==(A=t.total_unread_thread_message_count)&&void 0!==A?A:0,L.pinnedMessageIds=null!==(w=t.pinned_message_ids)&&void 0!==w?w:[],L.lastPinnedMessage=t.latest_pinned_message?Me(L._iid,s({channel_type:L.channelType},t.latest_pinned_message)):null,L}return e(_,a),Object.defineProperty(_.prototype,"isHidden",{get:function(){return this.hiddenState!==ar.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isTyping",{get:function(){return this._typingStatus.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var s=p(this._unreadMemberStateMap),r=s.next();!r.done;r=s.next()){var i=l(r.value,2),a=i[0],o=i[1];n[a]=o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var s=p(this._undeliveredMemberStateMap),r=s.next();!r.done;r=s.next()){var i=l(r.value,2),a=i[0],o=i[1];n[a]=o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),_.payloadify=function(e){return t(n(s(s({},a.payloadify.call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,total_unread_thread_message_count:e.totalUnreadReplyCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return Zt.payloadify(e)})),last_message:e.lastMessage?st(e.lastMessage):null,inviter:e.inviter?I.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt,pinned_message_ids:e.pinnedMessageIds,latest_pinned_message:e.lastPinnedMessage?st(e.lastPinnedMessage):null})))},_.prototype._shouldUpdateLastMessageWith=function(e){return!e.silent&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)},_.prototype._tryUpdateLastMessageAndCallEvents=function(e,t){var n=F.of(this._iid).dispatcher,s=hs.of(this._iid);this._updateLastMessage(t),s.handlers.map((function(t){t.onChannelChanged&&t.onChannelChanged(e)})),n.dispatch(new fn({channels:[e],context:{source:E.EVENT_MESSAGE_SENT}}))},_.prototype._updateLastMessage=function(e){return!!this._shouldUpdateLastMessageWith(e)&&(this.lastMessage=e,!0)},_.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===ir.ALL||this.myCountPreference===ir.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var n=F.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===ir.ALL||this.myCountPreference===ir.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},_.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),F.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},_.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)},_.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)},_.prototype._clearTypingStatus=function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0},_.prototype._setLatestMemberCount=function(e,t,n){var s=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,s=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),s},_.prototype.isReadMessage=function(e){var t=F.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return!!n&&n>=e.createdAt},_.prototype.serialize=function(){var e=this;return x(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))},_.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new Ls(this._iid,s(s({},e),{channel:this}))},_.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new Fs(this._iid,this.url,e)},_.prototype.createThreadedParentMessageListQuery=function(e){return void 0===e&&(e={}),new rt(this._iid,this.url,this.channelType,e)},_.prototype.createPinnedMessageListQuery=function(e){return void 0===e&&(e={}),new lr(this._iid,this.url,this.channelType,e)},_.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex((function(t){return t.userId===e.userId}));if(n>-1){var s=this.members[n];s.state===qt.JOINED&&(e.state=s.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},_.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof Zt?e.userId:e,n=this.members.findIndex((function(e){return e.userId===t}));if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1},_.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof Be&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var s=F.of(this._iid).sdkState,r=e.createdAt,i=0;try{for(var a=p(this.members),o=a.next();!o.done;o=a.next()){var u=o.value;if(s.userId!==u.userId&&u.state===qt.JOINED&&e.sender.userId!==u.userId)(this.cachedUnreadMemberState[u.userId]||0)<r&&i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}return 0},_.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof Be&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var s=F.of(this._iid).sdkState,r=e.createdAt,i=0;try{for(var a=p(this.members),o=a.next();!o.done;o=a.next()){var u=o.value;if(s.userId!==u.userId&&u.state===qt.JOINED&&e.sender.userId!==u.userId)(this.cachedUndeliveredMemberState[u.userId]||0)<r&&i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}return 0},_.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var s=F.of(this._iid).sdkState;if(!s.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var r=e instanceof Be?e.sender:null,i=[];return this.members.forEach((function(a){if(t||a.userId!==s.userId&&a.userId!==(null==r?void 0:r.userId)){var o=n._unreadMemberStateMap.get(a.userId);o&&o>=e.createdAt&&i.push(a)}})),i},_.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var s=F.of(this._iid).sdkState;if(!s.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var r=e instanceof Be?e.sender:null,i=[];return this.members.forEach((function(a){if(t||a.userId!==s.userId&&a.userId!==(null==r?void 0:r.userId)){var o=n._unreadMemberStateMap.get(a.userId);o&&o<e.createdAt&&i.push(a)}})),i},_.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=F.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var s={};return this.members.forEach((function(r){if(e||r.userId!==n.userId){var i=t._unreadMemberStateMap.get(r.userId);s[r.userId]=new it(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Zt.payloadify(r),ts:null!=i?i:0})}})),s},_.prototype.getDeliveryStatus=function(e){var t=this;void 0===e&&(e=!0);var n=F.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var s={};return this.members.forEach((function(r){if(e||r.userId!==n.userId){var i=t._undeliveredMemberStateMap.get(r.userId);s[r.userId]=new hr(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Zt.payloadify(r),ts:null!=i?i:0})}})),s},_.prototype.getTypingUsers=function(){var e=[];return this._typingStatus.forEach((function(t){var n=t.user;e.push(n)})),e},_.prototype.invalidateTypingStatus=function(){var e=this,t=F.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),s=!1;return this._typingStatus.forEach((function(r,i){var a=r.ts;n-a>=t&&(e._typingStatus.delete(i),s=!0)})),s},_.prototype.refresh=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._refresh()]}))}))},_.prototype._refresh=function(e){return void 0===e&&(e=!1),h(this,void 0,void 0,(function(){var t,n,s,r,i,a;return d(this,(function(o){switch(o.label){case 0:return t=F.of(this._iid),n=t.requestQueue,s=t.dispatcher,r=new Cn({channelUrl:this.url}),[4,n.send(r)];case 1:return i=o.sent(),a=i.as(yn).channel,this._update(a),e||s.dispatch(new fn({channels:[a],context:{source:E.REFRESH_CHANNEL}})),[2,this]}}))}))},_.prototype.freeze=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,a.prototype.freeze.call(this)];case 1:return e.sent(),F.of(this._iid).dispatcher.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_FROZEN},isWebSocketEventComing:!0})),[2]}}))}))},_.prototype.unfreeze=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,a.prototype.unfreeze.call(this)];case 1:return e.sent(),F.of(this._iid).dispatcher.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_UNFROZEN},isWebSocketEventComing:!0})),[2]}}))}))},_.prototype.updateChannel=function(e){return h(this,void 0,void 0,(function(){var t,n,r,i,a,c,l;return d(this,(function(h){switch(h.label){case 0:return t=s(s({},Ds),e),o(function(e){return v("string",e.coverUrl,!0)&&(m(e.coverImage)||v("string",e.coverImage,!0))&&v("boolean",e.isDistinct,!0)&&v("boolean",e.isPublic,!0)&&v("boolean",e.isDiscoverable,!0)&&v("string",e.accessCode,!0)&&v("string",e.name,!0)&&v("string",e.data,!0)&&v("string",e.customType,!0)&&f("string",e.operatorUserIds,!0)&&v("number",e.messageSurvivalSeconds,!0)}(t)).throw(u.invalidParameters),n=F.of(this._iid),r=n.dispatcher,i=n.requestQueue,a=new Os(s({channelUrl:this.url},t)),[4,i.send(a)];case 1:return c=h.sent(),l=c.as(Hs).channel,this._update(l),r.dispatch(new fn({channels:[l],context:{source:E.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,this]}}))}))},_.prototype.invite=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return o(e.every((function(e){return e instanceof I}))).throw(u.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},_.prototype.inviteWithUserIds=function(e){return h(this,void 0,void 0,(function(){var t,n,s,r,i,a,c;return d(this,(function(l){switch(l.label){case 0:return o(f("string",e)).throw(u.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.requestQueue,r=t.sessionManager,i=new zn({channelUrl:this.url,userIds:e}),[4,s.send(i)];case 1:return a=l.sent(),c=a.as(jn).channel,this._update(c),n.dispatch(new fn({channels:[c],context:{source:E.EVENT_CHANNEL_INVITED,inviter:r.currentUser,invitees:[]},isWebSocketEventComing:!0})),[2,this]}}))}))},_.prototype.join=function(e){return h(this,void 0,void 0,(function(){var t,n,s,r,i,a,c;return d(this,(function(l){switch(l.label){case 0:return o(v("string",e,!0)).throw(u.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,r=t.requestQueue,i=new Hn({channelUrl:this.url,userId:s.userId,accessCode:e}),[4,r.send(i)];case 1:return a=l.sent(),(c=a.as(Vn).channel).myMemberState=this.myMemberState=qt.JOINED,this._update(c),n.dispatch(new fn({channels:[c],context:{source:E.EVENT_CHANNEL_JOINED,users:[]},isWebSocketEventComing:!0})),[2,this]}}))}))},_.prototype.leave=function(e){return void 0===e&&(e=!1),h(this,void 0,void 0,(function(){var t,n,s,r;return d(this,(function(i){switch(i.label){case 0:return t=F.of(this._iid),n=t.sdkState,s=t.requestQueue,r=new Bn({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,s.send(r)];case 1:return i.sent(),this.myMemberState=qt.NONE,[2]}}))}))},_.prototype.acceptInvitation=function(e){return h(this,void 0,void 0,(function(){var t,n,s,r,i,a,c;return d(this,(function(l){switch(l.label){case 0:return o(v("string",e,!0)).throw(u.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,r=t.requestQueue,i=new Ps({channelUrl:this.url,userId:s.userId,accessCode:e}),[4,r.send(i)];case 1:return a=l.sent(),(c=a.as(ks).channel).myMemberState=this.myMemberState=qt.JOINED,this._update(c),n.dispatch(new fn({channels:[c],context:{source:E.EVENT_CHANNEL_ACCEPTED_INVITE},isWebSocketEventComing:!0})),[2,this]}}))}))},_.prototype.declineInvitation=function(){return h(this,void 0,void 0,(function(){var e,t,n,s;return d(this,(function(r){switch(r.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new Qn({channelUrl:this.url,userId:t.userId}),[4,n.send(s)];case 1:return r.sent(),this.myMemberState=qt.NONE,[2,this]}}))}))},_.prototype.sendUserMessage=function(e){var t=this,n=new gt,s=F.of(this._iid).dispatcher,r=Dt.of(this._iid);return a.prototype.sendUserMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){t&&r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){t.hiddenState===ar.HIDDEN_ALLOW_AUTO_UNHIDE&&(t.hiddenState=ar.UNHIDDEN),r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),hs.of(t._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new fn({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},_.prototype.updateUserMessage=function(e,t){return h(this,void 0,void 0,(function(){var n,s,r,i,o=this;return d(this,(function(u){switch(u.label){case 0:return n=F.of(this._iid).dispatcher,[4,a.prototype.updateUserMessage.call(this,e,t)];case 1:return s=u.sent(),r=this._updateLastMessage(s),i=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===s.messageId&&(this.lastPinnedMessage=s,r=!0,i=!0),r&&(hs.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)})),n.dispatch(new fn({channels:[this],context:{source:i?E.EVENT_PINNED_MESSAGE_UPDATED:E.EVENT_MESSAGE_UPDATED}}))),i&&hs.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(o)})),n.dispatch(new j({messages:[s],source:E.EVENT_MESSAGE_UPDATED})),[2,s]}}))}))},_.prototype._autoResendUserMessage=function(e){var t=this,n=new gt,s=F.of(this._iid).dispatcher,r=Dt.of(this._iid);return a.prototype._autoResendUserMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var i=hs.of(t._iid);r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),i.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new fn({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},_.prototype.sendFileMessage=function(e){var t=this,n=new gt,s=F.of(this._iid).dispatcher,r=Dt.of(this._iid);return a.prototype.sendFileMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){t&&r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var i=hs.of(t._iid);r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),i.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new fn({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},_.prototype.sendMultipleFilesMessage=function(e){var t=this,n=new at,s=F.of(this._iid).dispatcher;return a.prototype.sendMultipleFilesMessage.call(this,e).onPending((function(e){n._trigger(e)})).onFailed((function(e,t){n._triggerFailed(e,t)})).onSucceeded((function(e){var r=hs.of(t._iid);t._updateLastMessage(e),r.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new fn({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})).onFileUploaded((function(e,t,s,r){n._triggerOnFileUploaded(e,t,s,r)})),n},_.prototype.updateFileMessage=function(e,t){return h(this,void 0,void 0,(function(){var n,s,r,i,o=this;return d(this,(function(u){switch(u.label){case 0:return n=F.of(this._iid).dispatcher,[4,a.prototype.updateFileMessage.call(this,e,t)];case 1:return s=u.sent(),r=this._updateLastMessage(s),i=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===s.messageId&&(this.lastPinnedMessage=s,r=!0,i=!0),r&&(hs.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)})),n.dispatch(new fn({channels:[this],context:{source:i?E.EVENT_PINNED_MESSAGE_UPDATED:E.EVENT_MESSAGE_UPDATED}}))),i&&hs.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(o)})),n.dispatch(new j({messages:[s],source:E.EVENT_MESSAGE_UPDATED})),[2,s]}}))}))},_.prototype._autoResendFileMessage=function(e){var t=this,n=new gt,s=F.of(this._iid).dispatcher,r=Dt.of(this._iid);return a.prototype._autoResendFileMessage.call(this,e).onPending((function(e){r.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){r.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var i=hs.of(t._iid);r.completeCurrentAndProcessNextAutoResend(e),t._updateLastMessage(e),i.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),s.dispatch(new fn({channels:[t],context:{source:E.EVENT_MESSAGE_SENT}})),n._trigger(e)})),n},_.prototype.deleteMessage=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,a.prototype.deleteMessage.call(this,e)];case 1:return t.sent(),0===e.messageId&&e instanceof Be&&F.of(this._iid).dispatcher.dispatch(new ve({reqId:e.reqId,source:E.EVENT_MESSAGE_DELETED})),[2]}}))}))},_.prototype.hide=function(e){return h(this,void 0,void 0,(function(){var t,n,r,i,a,c,l,h;return d(this,(function(d){switch(d.label){case 0:return t=s(s({},Yn),e),o(function(e){return v("boolean",e.hidePreviousMessages,!0)&&v("boolean",e.allowAutoUnhide,!0)}(t)).throw(u.invalidParameters),n=F.of(this._iid),r=n.dispatcher,i=n.sdkState,a=n.requestQueue,c=new Jn(s({channelUrl:this.url,userId:i.userId},t)),[4,a.send(c)];case 1:return l=d.sent(),h=l.as(Xn).messageOffsetTimestamp,this.hiddenState=t.allowAutoUnhide?ar.HIDDEN_ALLOW_AUTO_UNHIDE:ar.HIDDEN_PREVENT_AUTO_UNHIDE,t.hidePreviousMessages&&this._updateUnreadCount(0,0),h&&(this.messageOffsetTimestamp=h),r.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_HIDDEN},isWebSocketEventComing:!0})),[2,this]}}))}))},_.prototype.unhide=function(){return h(this,void 0,void 0,(function(){var e,t,n,s;return d(this,(function(r){switch(r.label){case 0:return e=F.of(this._iid),t=e.dispatcher,n=e.requestQueue,s=new Gs({channelUrl:this.url}),[4,n.send(s)];case 1:return r.sent(),this.hiddenState=ar.UNHIDDEN,t.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_UNHIDDEN},isWebSocketEventComing:!0})),[2,this]}}))}))},_.prototype.delete=function(){return h(this,void 0,void 0,(function(){var e,t;return d(this,(function(n){switch(n.label){case 0:return e=F.of(this._iid).requestQueue,t=new Vs({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},_.prototype.markAsRead=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r,i,a,o=this;return d(this,(function(u){switch(u.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.dispatcher,s=e.requestQueue,r=new Et({channelUrl:this.url}),[4,s.send(r)];case 1:return i=u.sent(),a=i.as(Ge).readStatus,this._updateUnreadMemberState(t.userId,a.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),hs.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)}))),n.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_READ}})),[2]}}))}))},_.prototype.markAsDelivered=function(){return h(this,void 0,void 0,(function(){var e,t,n,s;return d(this,(function(r){switch(r.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new as({channelUrl:this.url,userId:t.userId}),[4,n.send(s)];case 1:return r.sent(),[2]}}))}))},_.prototype.startTyping=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(s=(new Date).getTime())-this._typingStarted>=n?(this._typingStarted=s,this._typingEnded=0,r=new $n({channelUrl:this.url,time:this._typingStarted}),[4,t.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},_.prototype.endTyping=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r;return d(this,(function(i){switch(i.label){case 0:return e=F.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(s=(new Date).getTime())-this._typingEnded>=n?(this._typingStarted=0,this._typingEnded=s,r=new ts({channelUrl:this.url,time:this._typingStarted}),[4,t.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},_.prototype.createScheduledUserMessage=function(e){e=s(s({},ot),e),o(ut(e)).throw(u.invalidParameters);var t=new gt;return this._createScheduledUserMessage(e,t),t},_.prototype.updateScheduledUserMessage=function(e,t){return h(this,void 0,void 0,(function(){var n,r,i,a;return d(this,(function(c){switch(c.label){case 0:return n=s(s({},Qs),t),o(function(e){return $e(e)&&v("number",e.scheduledAt,!0)}(n)).throw(u.invalidParameters),r=F.of(this._iid).requestQueue,i=new Js(s({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,r.send(i)];case 1:return a=c.sent(),[2,a.as(Ct).message]}}))}))},_.prototype.createScheduledFileMessage=function(e){var t=this;e=s(s({},ct),e),o(lt(e)).throw(u.invalidParameters);var n=Date.now(),r=this._generateRequestId(),i=new gt;return pe(yt).then((function(){var s=t._createPendingScheduledFileMessage(e,r,n);H((function(){return h(t,void 0,void 0,(function(){return d(this,(function(e){return[2,i._trigger(s)]}))}))}))})),m(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return t._createScheduledFileMessage(e,i,r,n)})):this._createScheduledFileMessage(e,i,r,n),i},_.prototype.updateScheduledFileMessage=function(e,t){return h(this,void 0,void 0,(function(){var n,r,i;return d(this,(function(a){switch(a.label){case 0:return n=s(s({},Ws),t),o(function(e){return Xe(e)&&v("number",e.scheduledAt,!0)&&(m(e.file)||v("string",e.fileUrl))&&v("string",e.fileName,!0)&&v("string",e.mimeType,!0)&&v("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return v("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(n)).throw(u.invalidParameters),m(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:a.sent(),a.label=2;case 2:return r=new Ks(s({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,F.of(this._iid).requestQueue.send(r)];case 3:return i=a.sent(),[2,i.as(Ys).message]}}))}))},_.prototype.cancelScheduledMessage=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return t=new Xs({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,F.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},_.prototype.sendScheduledMessageNow=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return t=new Zs({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,F.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},_.prototype.getMyPushTriggerOption=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r,i;return d(this,(function(a){switch(a.label){case 0:return e=F.of(this._iid),t=e.sdkState,n=e.requestQueue,s=new tr({userId:t.userId,channelUrl:this.url}),[4,n.send(s)];case 1:return r=a.sent(),i=r.as(nr).pushTriggerOption,this.myPushTriggerOption=i,[2,i]}}))}))},_.prototype.setMyPushTriggerOption=function(e){return h(this,void 0,void 0,(function(){var t,n,s,i,a,c,l;return d(this,(function(h){switch(h.label){case 0:return o(r(fe,e)).throw(u.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,i=t.requestQueue,a=new $s({userId:s.userId,channelUrl:this.url,pushTriggerOption:e}),[4,i.send(a)];case 1:return c=h.sent(),l=c.as(er).pushTriggerOption,this.myPushTriggerOption=l,n.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,l]}}))}))},_.prototype.setMyCountPreference=function(e){return h(this,void 0,void 0,(function(){var t,n,s,i,a,c,l;return d(this,(function(h){switch(h.label){case 0:return o(r(ir,e)).throw(u.invalidParameters),t=F.of(this._iid),n=t.dispatcher,s=t.sdkState,i=t.requestQueue,a=new Bs({channelUrl:this.url,userId:s.userId,countPreference:e}),[4,i.send(a)];case 1:return c=h.sent(),l=c.as(qs).countPreference,this.myCountPreference=l,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),n.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,l]}}))}))},_.prototype.resetMyHistory=function(){return h(this,void 0,void 0,(function(){var e,t,n,s,r,i;return d(this,(function(a){switch(a.label){case 0:return e=F.of(this._iid),t=e.dispatcher,n=e.requestQueue,s=new zs({channelUrl:this.url}),[4,n.send(s)];case 1:return r=a.sent(),i=r.as(js).messageOffsetTimestamp,this.messageOffsetTimestamp=i,this.lastMessage&&this.lastMessage.createdAt<i&&(this.lastMessage=null),this._updateUnreadCount(0,0),this.totalUnreadReplyCount=0,t.dispatch(new fn({channels:[this],context:{source:E.EVENT_CHANNEL_RESET_HISTORY},isWebSocketEventComing:!0})),[2,this]}}))}))},_.prototype.pinMessage=function(e){return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(s){switch(s.label){case 0:return o(v("number",e)&&e>0).throw(u.invalidParameters),t=F.of(this._iid).requestQueue,n=new sr({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return s.sent(),[2]}}))}))},_.prototype.unpinMessage=function(e){return h(this,void 0,void 0,(function(){var t,n;return d(this,(function(s){switch(s.label){case 0:return o(v("number",e)&&e>0).throw(u.invalidParameters),t=F.of(this._iid).requestQueue,n=new rr({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return s.sent(),[2]}}))}))},_.prototype._uploadFileAndUpdateParams=function(e){return h(this,void 0,void 0,(function(){var t,n,s,r,i,a,o,u,c,l;return d(this,(function(h){switch(h.label){case 0:return m(e.file)?(t=F.of(this._iid).requestQueue,n=new bt({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:s=h.sent(),r=s.as(Mt),i=r.url,a=r.fileSize,o=void 0===a?e.fileSize:a,u=r.thumbnails,c=r.requireAuth,l=void 0!==c&&c,e.fileUrl=i,e.fileSize=o,e.requireAuth=l,e._thumbnails=u,h.label=2;case 2:return[2]}}))}))},_.prototype.resendMessage=function(e,t){var n,s=this;if(o(e instanceof Be&&!e.scheduledInfo&&e.isResendable).throw(u.invalidParameters),e.isUserMessage()){var r=null!==(n=e.messageParams)&&void 0!==n?n:ht(e),i=new gt;return this._sendUserMessage(r,dt.RESEND,e.reqId).onPending((function(e){i._trigger(e)})).onFailed((function(e,t){i._triggerFailed(e,t)})).onSucceeded((function(e){s._tryUpdateLastMessageAndCallEvents(s,e),i._trigger(e)})),i}if(e.isFileMessage()){var a=this._validateFailedFileMessageHasFile(e,t);o(a).throw(u.invalidParameters);r=_t(e,t);var c=new gt;return this._sendFileMessage(r,dt.RESEND,e.reqId).onPending((function(e){c._trigger(e)})).onFailed((function(e,t){c._triggerFailed(e,t)})).onSucceeded((function(e){s._tryUpdateLastMessageAndCallEvents(s,e),c._trigger(e)})),c}if(e.isMultipleFilesMessage()){r=e.messageParams;var l=new at;return this._sendMultipleFilesMessage(r,dt.RESEND,e.reqId).onPending((function(e){l._trigger(e)})).onFailed((function(e,t){l._triggerFailed(e,t)})).onSucceeded((function(e){s._tryUpdateLastMessageAndCallEvents(s,e),l._trigger(e)})).onFileUploaded((function(e,t,n,s){l._triggerOnFileUploaded(e,t,n,s)})),l}},_.prototype.copyMessage=function(e,t){var n=this;if(o(e instanceof pt&&t instanceof Be&&t.sendingStatus===ie.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(u.invalidParameters),t.isUserMessage()){o(!t.poll).throw(u.notSupportedError);var s=ft(t),r=new gt;return e._sendUserMessage(s).onPending((function(e){r._trigger(e)})).onFailed((function(e,t){r._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),r._trigger(t)})),r}if(t.isFileMessage()){s=vt(t);var i=new gt;return e._sendFileMessage(s).onPending((function(e){i._trigger(e)})).onFailed((function(e,t){i._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),i._trigger(t)})),i}if(t.isMultipleFilesMessage()){if(e.isGroupChannel()){s=mt(t);var a=new at;return e._sendMultipleFilesMessage(s,dt.COPY).onPending((function(e){a._trigger(e)})).onFailed((function(e,t){a._triggerFailed(e,t)})).onSucceeded((function(t){n._tryUpdateLastMessageAndCallEvents(e,t),a._trigger(t)})).onFileUploaded((function(e,t,n,s){a._triggerOnFileUploaded(e,t,n,s)})),a}throw u.channelTypeNotSupportedError}},_}(pt);export{Dn as A,ln as B,ir as C,hr as D,hn as E,Ln as F,hs as G,Kt as H,ds as I,ps as J,ws as K,Zt as M,Yt as O,zt as P,Jt as Q,vs as S,cs as T,Qt as U,en as a,dr as b,Wt as c,rs as d,rn as e,on as f,un as g,nn as h,sn as i,_n as j,Xt as k,ar as l,Ts as m,Fs as n,qt as o,As as p,jt as q,Ls as r,pn as s,Is as t,fs as u,an as v,Ss as w,or as x,lr as y,$t as z};
