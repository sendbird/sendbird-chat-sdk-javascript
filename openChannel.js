import{_ as e,b as n,c as t,$ as r,m as a,a as i,i as s,A as o,aP as u,aQ as l,f as c,h,e as d,a9 as p,U as f,W as v,w as C,x as _,J as y,t as m,aC as E,y as g,aD as U,ah as w,O as T,aF as N,s as b,S as M,g as P,aJ as O,al as H,V as x,a2 as D,n as I,B as A,am as L}from"./lib/__bundle-a8f5769e.js";import{q as R,r as F,t as k,w as S,u as q,x as Q,y as z,P as K,z as j,A as V,C as W,E as B,f as G}from"./lib/__bundle-ad6d760f.js";import{C as X,a as J,O as Y,P as Z,M as $,T as ee,R as ne,U as te,A as re,B as ae}from"./lib/__bundle-e21f40c4.js";import{m as ie,c as se}from"./lib/__bundle-f20da9a5.js";import{P as oe}from"./lib/__bundle-ed97dd0a.js";import"./lib/__bundle-6bc4500a.js";var ue=function(r){function a(){var e=null!==r&&r.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}return e(a,r),Object.defineProperty(a.prototype,"enteredChannels",{get:function(){var e=this;return this._enteredChannelUrls.map((function(n){return e._channels.get(n)})).filter((function(e){return null!==e}))},enumerable:!1,configurable:!0}),a.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},a.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},a.prototype.exit=function(e){var n=this._enteredChannelUrls.indexOf(e);n>=0&&this._enteredChannelUrls.splice(n,1)},a.prototype.exitAll=function(){this._enteredChannelUrls=[]},a.prototype.get=function(e){var r;return n(this,void 0,void 0,(function(){return t(this,(function(n){return[2,null!==(r=this._channels.get(e))&&void 0!==r?r:null]}))}))},a.prototype.upsert=function(e){return n(this,void 0,void 0,(function(){var n,r=this;return t(this,(function(t){return n=[],e.forEach((function(e){if(r._channels.has(e.url)){var t=r._channels.get(e.url);Object.assign(t,e),n.push(t)}else r._channels.set(e.url,e),n.push(e)})),[2,n]}))}))},a.prototype.remove=function(e){return n(this,void 0,void 0,(function(){return t(this,(function(n){return this._channels.delete(e),this.exit(e),[2]}))}))},a.prototype.clear=function(){return n(this,void 0,void 0,(function(){return t(this,(function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]}))}))},a}(r),le={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null,isEphemeral:null},ce=function(n){function t(e){var t=e.channelUrl,r=e.isInternalCall,a=n.call(this)||this;return a.method=o.GET,a.path="".concat(r?u:l,"/").concat(encodeURIComponent(t)),a}return e(t,n),t}(c),he=function(n){function t(e,t){var r=n.call(this,e,t)||this;return r.channel=null,r.channel=new be(e,t),r}return e(t,n),t}(h),de=function(n){function t(e){var t=this,r=e.channelUrl,a=e.coverUrlOrImage,u=e.name,c=e.data,h=e.customType,p=e.operatorUserIds,f=e.isEphemeral;return(t=n.call(this)||this).method=o.POST,t.path=l,t.params=d({channel_url:r,cover_url:i("string",a)?a:null,cover_file:s(a)?a:null,name:u,data:c,custom_type:h,operators:p,is_ephemeral:f}),t}return e(t,n),t}(c);!function(n){function t(e,t){var r=n.call(this,e,t)||this;return r.channel=new be(e,t),r}e(t,n)}(h);var pe=function(n){function t(e){var t=e.channelUrl;return n.call(this,{code:"ENTR",payload:{channel_url:t},ackRequired:!0})||this}return e(t,n),t}(p),fe=function(n){function t(e,t,r){var a,i,s=this;return s=n.call(this,e,"SYEV",r)||this,r.data&&(s.participantCount=null!==(a=r.data.participant_count)&&void 0!==a?a:0,s.user=new f(e,r.data),s.ts=null!==(i=r.data.edge_ts)&&void 0!==i?i:0),s}return e(t,n),t}(X),ve=function(n){function t(e){var t=e.channelUrl;return n.call(this,{code:"EXIT",payload:{channel_url:t},ackRequired:!0})||this}return e(t,n),t}(p),Ce=function(n){function t(e,t,r){var a,i,s=this;return s=n.call(this,e,"EXIT",r)||this,r.data&&(s.participantCount=null!==(a=r.data.participant_count)&&void 0!==a?a:0,s.user=new f(e,r.data),s.ts=null!==(i=r.data.edge_ts)&&void 0!==i?i:0),s}return e(t,n),t}(X),_e={},ye=function(){function e(e,n){var t=n.sdkState,r=n.dispatcher,a=n.requestQueue,i=this;return _e[e]||(this._iid=e,this._sdkState=t,this._requestQueue=a,this._dispatcher=r,this._openChannelCache=new ue(e),this._openChannelHandlers=new Map,this._dispatcher.on((function(e){var n,t;if(e instanceof v)i._handleEvent(e);else if(e instanceof C&&e.stateType===_.CONNECTED){var r=i._openChannelCache.enteredChannels;try{for(var a=y(r),s=a.next();!s.done;s=a.next()){s.value.enter()}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(n)throw n.error}}}})),_e[e]=this),_e[e]}return e.of=function(e){return _e[e]},e.prototype.buildOpenChannelFromSerializedData=function(e){var n=m(e);return new be(this._iid,be.payloadify(n))},e.prototype.getChannelFromCache=function(e){return n(this,void 0,void 0,(function(){return t(this,(function(n){switch(n.label){case 0:return[4,this._openChannelCache.get(e)];case 1:return[2,n.sent()]}}))}))},e.prototype.upsertChannelsToCache=function(e){return n(this,void 0,void 0,(function(){return t(this,(function(n){switch(n.label){case 0:return[4,this._openChannelCache.upsert(e)];case 1:return[2,n.sent()]}}))}))},e.prototype.removeChannelsFromCache=function(e){return n(this,void 0,void 0,(function(){var n,r,a,i,s,o;return t(this,(function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),n=y(e),r=n.next(),t.label=1;case 1:return r.done?[3,4]:(a=r.value,[4,this._openChannelCache.remove(a)]);case 2:t.sent(),t.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return i=t.sent(),s={error:i},[3,7];case 6:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},e.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},e.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},e.prototype._handleEvent=function(e){return n(this,void 0,void 0,(function(){var r,a,i,s,o,u,l,c,h,d,p,f,v,C,_,m,b,M,P,H,x,D,I,A,L,G,ae,se,oe,ue,le,ce,he,de,pe,ve,_e,ye,me,Ee,ge,Ue,we,Te,Ne,be,Me,Pe,Oe,He,xe,De,Ie,Ae,Le,Re,Fe,ke,Se,qe,Qe,ze,Ke,je,Ve,We,Be,Ge,Xe=this;return t(this,(function(Je){switch(Je.label){case 0:switch(Je.trys.push([0,57,,58]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"PEDI":return[3,27];case"VOTE":return[3,30];case"SYEV":return[3,33]}return[3,56];case 1:return s=null,"MESG"===e.code?s=e.as(B):"FILE"===e.code?s=e.as(ie):"ADMM"!==e.code&&"BRDM"!=e.code||(s=e.as(re)),s?(r=s.message,a=s.isMentioned,r.channelType!==T.OPEN?[3,3]:[4,this.getChannel(r.channelUrl,!0)]):[3,3];case 2:i=Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){var e,n,s,o,u;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())s=n.value,this._openChannelCache.isEnteredChannel(i.url)&&(s.onMessageReceived(i,r),a&&s.onMentionReceived(i,r))}catch(e){o={error:e}}finally{try{n&&!n.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}}return[2]}))}))})),Je.label=3;case 3:return[3,56];case 4:return s=null,"MEDI"===e.code?s=e.as(V):"FEDI"===e.code?s=e.as(W):"AEDI"===e.code&&(s=e.as(te)),s?(o=s.message,u=s.mentionCountChange,o.channelType!==T.OPEN?[3,6]:[4,this.getChannel(o.channelUrl,!0)]):[3,6];case 5:l=Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a,i;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())r=n.value,this._openChannelCache.isEnteredChannel(l.url)&&(r.onMessageUpdated(l,o),u>0&&r.onMentionReceived(l,o))}catch(e){a={error:e}}finally{try{n&&!n.done&&(i=e.return)&&i.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),Je.label=6;case 6:return[3,56];case 7:return c=e.as(j),le=c.channelUrl,ce=c.channelType,h=c.messageId,ce!==T.OPEN?[3,9]:[4,this.getChannel(le,!0)];case 8:d=Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a,i;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())r=n.value,this._openChannelCache.isEnteredChannel(d.url)&&r.onMessageDeleted(d,h)}catch(e){a={error:e}}finally{try{n&&!n.done&&(i=e.return)&&i.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),Je.label=9;case 9:return[3,56];case 10:return p=e.as(ne),le=p.channelUrl,ce=p.channelType,f=p.event,ce!==T.OPEN?[3,12]:[4,this.getChannel(le,!0)];case 11:v=Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a,i;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())r=n.value,this._openChannelCache.isEnteredChannel(v.url)&&r.onReactionUpdated(v,f)}catch(e){a={error:e}}finally{try{n&&!n.done&&(i=e.return)&&i.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),Je.label=12;case 12:return[3,56];case 13:return(C=e.as(ee).event).channelType!==T.OPEN?[3,15]:[4,this.getChannel(C.channelUrl,!0)];case 14:_=Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a,i;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())r=n.value,this._openChannelCache.isEnteredChannel(_.url)&&r.onThreadInfoUpdated(_,C)}catch(e){a={error:e}}finally{try{n&&!n.done&&(i=e.return)&&i.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),Je.label=15;case 15:return[3,56];case 16:m=e.as($).openChannelMemberCounts,b=[],Je.label=17;case 17:Je.trys.push([17,22,23,24]),M=y(m),P=M.next(),Je.label=18;case 18:return P.done?[3,21]:(H=P.value,le=H.channelUrl,ge=H.participantCount,x=H.updatedAt,[4,this.getChannelFromCache(le)]);case 19:(D=Je.sent())&&D._updateParticipantCount(ge,x)&&b.push(D),Je.label=20;case 20:return P=M.next(),[3,18];case 21:return[3,24];case 22:return I=Je.sent(),Be={error:I},[3,24];case 23:try{P&&!P.done&&(Ge=M.return)&&Ge.call(M)}finally{if(Be)throw Be.error}return[7];case 24:return b.length>0?[4,this.upsertChannelsToCache(b)]:[3,26];case 25:A=Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())n.value.onChannelMemberCountChanged(A)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Je.label=26;case 26:return[3,56];case 27:return L=e.as(Z),G=L.event,ae=L.status,le=L.channelUrl,ce=L.channelType,le&&ce===T.OPEN?[4,this.getChannel(le,!0)]:[3,29];case 28:se=Je.sent(),this._dispatcher.dispatch(new N({event:G,source:w.EVENT_POLL_UPDATED})),g(ae===O?function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())n.value.onPollDeleted(se,G.pollId)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))}:function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())n.value.onPollUpdated(se,G)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))}),Je.label=29;case 29:return[3,56];case 30:return oe=e.as(K),ue=oe.event,le=oe.channelUrl,ce=oe.channelType,le&&ce===T.OPEN?[4,this.getChannel(le,!0)]:[3,32];case 31:he=Je.sent(),this._dispatcher.dispatch(new U({event:ue,source:w.EVENT_POLL_VOTED})),g((function(){return n(Xe,void 0,void 0,(function(){var e,n,r,a;return t(this,(function(t){try{for(e=y(this._openChannelHandlers.values()),n=e.next();!n.done;n=e.next())n.value.onPollVoted(he,ue)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Je.label=32;case 32:return[3,56];case 33:if(!(de=e.as(X).event).isOpenChannelEvent)return[3,55];switch(de.category){case J.CHANNEL_ENTER:return[3,34];case J.CHANNEL_EXIT:return[3,36];case J.CHANNEL_OPERATOR_UPDATE:return[3,38];case J.USER_CHANNEL_MUTE:case J.USER_CHANNEL_UNMUTE:return[3,40];case J.USER_CHANNEL_BAN:case J.USER_CHANNEL_UNBAN:return[3,42];case J.CHANNEL_FREEZE:case J.CHANNEL_UNFREEZE:return[3,44];case J.CHANNEL_DELETED:return[3,46];case J.CHANNEL_PROP_CHANGED:return[3,49];case J.CHANNEL_META_DATA_CHANGED:return[3,51];case J.CHANNEL_META_COUNTERS_CHANGED:return[3,53]}return[3,55];case 34:return[4,this.getChannel(de.channelUrl,!0)];case 35:return pe=Je.sent(),ve=e.as(fe),ge=ve.participantCount,_e=ve.user,ye=pe._updateParticipantCount(ge,de.ts),g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onUserEntered(pe,_e),ye&&e.onChannelParticipantCountChanged(pe)})),[2]}))}))})),[3,55];case 36:return[4,this.getChannel(de.channelUrl,!0)];case 37:return me=Je.sent(),Ee=e.as(Ce),ge=Ee.participantCount,Ue=Ee.user,we=me._updateParticipantCount(ge,de.ts),g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onUserExited(me,Ue),we&&e.onChannelParticipantCountChanged(me)})),[2]}))}))})),[3,55];case 38:return[4,this.getChannel(de.channelUrl,!0)];case 39:return Te=Je.sent(),Ne=e.as(Y).operators,Te.operators=Ne,this.upsertChannelsToCache([Te]),g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onOperatorUpdated(Te,Ne)})),[2]}))}))})),[3,55];case 40:return[4,this.getChannel(de.channelUrl,!0)];case 41:return be=Je.sent(),Me=de.category===J.USER_CHANNEL_MUTE,Pe=e.as(Me?Q:z).user,g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){Me?e.onUserMuted(be,Pe):e.onUserUnmuted(be,Pe)})),[2]}))}))})),[3,55];case 42:return[4,this.getChannel(de.channelUrl,!0)];case 43:return Oe=Je.sent(),He=de.category===J.USER_CHANNEL_BAN,xe=e.as(He?S:q).user,g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){He?e.onUserBanned(Oe,xe):e.onUserUnbanned(Oe,xe)})),[2]}))}))})),[3,55];case 44:return[4,this.getChannel(de.channelUrl,!0)];case 45:return De=Je.sent(),Ie=e.as(k).freeze,De.isFrozen=Ie,this.upsertChannelsToCache([De]),g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){Ie?e.onChannelFrozen(De):e.onChannelUnfrozen(De)})),[2]}))}))})),[3,55];case 46:return[4,this.getChannel(de.channelUrl,!0)];case 47:return Ae=Je.sent(),[4,this.removeChannelsFromCache([Ae.url])];case 48:return Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onChannelDeleted(Ae.url,Ae.channelType)})),[2]}))}))})),[3,55];case 49:return[4,this.getChannelWithoutCache(de.channelUrl,!0)];case 50:return Le=Je.sent(),g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onChannelChanged(Le)})),[2]}))}))})),[3,55];case 51:return[4,this.getChannel(de.channelUrl,!0)];case 52:return Re=Je.sent(),Fe=e.as(F),ke=Fe.created,Se=Fe.updated,qe=Fe.deleted,ke&&Re._upsertCachedMetaData(ke,de.ts),Se&&Re._upsertCachedMetaData(Se,de.ts),qe&&Re._removeFromCachedMetaData(qe,de.ts),g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){ke&&e.onMetaDataCreated(Re,ke),Se&&e.onMetaDataUpdated(Re,Se),qe&&e.onMetaDataDeleted(Re,qe)})),[2]}))}))})),[3,55];case 53:return[4,this.getChannel(de.channelUrl,!0)];case 54:return Qe=Je.sent(),ze=e.as(R),Ke=ze.created,je=ze.updated,Ve=ze.deleted,g((function(){return n(Xe,void 0,void 0,(function(){return t(this,(function(e){return this._openChannelHandlers.forEach((function(e){Ke&&e.onMetaCounterCreated(Qe,Ke),je&&e.onMetaCounterUpdated(Qe,je),Ve&&e.onMetaCounterDeleted(Qe,Ve)})),[2]}))}))})),[3,55];case 55:return[3,56];case 56:return[3,58];case 57:if(We=Je.sent(),E(We))throw We;return[3,58];case 58:return[2]}}))}))},e.prototype.addHandler=function(e,n){this._openChannelHandlers.set(e,n)},e.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},e.prototype.clearHandler=function(){this._openChannelHandlers.clear()},e.prototype.getChannel=function(e,r){return n(this,void 0,void 0,(function(){var n;return t(this,(function(t){switch(t.label){case 0:b(i("string",e)).throw(M.invalidParameters),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=t.sent())?[2,n]:[3,4];case 3:return t.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e)];case 5:return[2,t.sent()]}}))}))},e.prototype.getChannelWithoutCache=function(e,r){return void 0===r&&(r=!1),n(this,void 0,void 0,(function(){var n,a,s;return t(this,(function(t){switch(t.label){case 0:return b(i("string",e)).throw(M.invalidParameters),n=new ce({channelUrl:e,isInternalCall:r}),[4,this._requestQueue.send(n)];case 1:return a=t.sent(),s=a.as(he).channel,[4,this.upsertChannelsToCache([s])];case 2:return[2,t.sent()[0]]}}))}))},e.prototype.createChannel=function(e){return n(this,void 0,void 0,(function(){var n,r,o,u;return t(this,(function(t){switch(t.label){case 0:return n=P(P({},le),e),b(function(e){return a("string",e.operatorUserIds,!0)&&(i("string",e.coverUrlOrImage)||s(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&i("string",e.name,!0)&&i("string",e.data,!0)&&i("string",e.customType,!0)&&(i("string",e.channelUrl)&&/^\w+$/.test(e.channelUrl)||null===e.channelUrl)&&i("boolean",e.isEphemeral,!0)}(n)).throw(M.invalidParameters),r=new de(n),[4,this._requestQueue.send(r)];case 1:return o=t.sent(),u=o.as(he).channel,this.upsertChannelsToCache([u]),[2,u]}}))}))},e}(),me={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},Ee=function(n){function t(e){var t=this,r=e.channelUrl,a=e.token,i=e.limit;return(t=n.call(this)||this).method=o.GET,t.path="".concat(l,"/").concat(encodeURIComponent(r),"/participants"),t.params={token:a,limit:i},t}return e(t,n),t}(c),ge=function(n){function t(e,t){var r=n.call(this,e,t)||this;r.token=null,r.participants=[];var a=t.next,i=t.participants;return r.token=a,r.participants=i.map((function(n){return new oe(e,n)})),r}return e(t,n),t}(h),Ue=function(r){function a(e,n,t){return r.call(this,e,n,T.OPEN,t)||this}return e(a,r),a.prototype._validate=function(){return r.prototype._validate.call(this)},a.prototype.next=function(){return n(this,void 0,void 0,(function(){var e,n,r,a,i,s;return t(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=x.of(this._iid).requestQueue,n=new Ee(P(P({},this),{token:this._token})),[4,e.send(n)]):[3,2]:[3,5];case 1:return r=t.sent(),a=r.as(ge),i=a.participants,s=a.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw M.queryInProgress;case 4:return[3,6];case 5:throw M.invalidParameters;case 6:return[2]}}))}))},a}(H),we=function(n){function t(e){var t=this,r=e.channelUrl,a=e.coverUrlOrImage,u=e.name,c=e.data,h=e.customType,p=e.operatorUserIds;return(t=n.call(this)||this).method=o.PUT,t.path="".concat(l,"/").concat(encodeURIComponent(r)),t.params=d({cover_url:i("string",a)?a:null,cover_file:s(a)?a:null,name:u,data:c,custom_type:h,operators:p}),t}return e(t,n),t}(c),Te=function(n){function t(e,t){var r=n.call(this,e,t)||this;return r.channel=new be(e,t),r}return e(t,n),t}(h),Ne=function(n){function t(e){var t=this,r=e.channelUrl;return(t=n.call(this)||this).method=o.DELETE,t.path="".concat(l,"/").concat(encodeURIComponent(r)),t}return e(t,n),t}(c);!function(n){function t(e,t){return n.call(this,e,t)||this}e(t,n)}(h);var be=function(r){function o(e,n){var t,a=this;return(a=r.call(this,e,n)||this)._lastParticipantCountUpdated=0,a.participantCount=0,a.operators=[],a.channelType=T.OPEN,a.participantCount=null!==(t=n.participant_count)&&void 0!==t?t:0,a.operators=Array.isArray(n.operators)?n.operators.map((function(n){return new f(e,n)})):[],a}return e(o,r),o.payloadify=function(e){return e?d(P(P({},G.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map((function(e){return f.payloadify(e)}))})):null},o.prototype.serialize=function(){return D(this)},o.prototype.isOperator=function(e){return e instanceof f?this.isOperator(e.userId):this.operators.some((function(n){return n.userId===e}))},o.prototype._updateParticipantCount=function(e,n){return n>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=n,!0)},o.prototype.createParticipantListQuery=function(e){return new Ue(this._iid,this.url,e)},o.prototype.refresh=function(){return n(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,ye.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}}))}))},o.prototype.enter=function(){return n(this,void 0,void 0,(function(){var e,n,r,a,i,s;return t(this,(function(t){switch(t.label){case 0:return e=x.of(this._iid).requestQueue,n=new pe({channelUrl:this.url}),[4,e.send(n)];case 1:return r=t.sent(),a=r.as(fe),i=a.participantCount,s=a.ts,this._updateParticipantCount(i,s),ye.of(this._iid).setEnteredToCache(this),[2]}}))}))},o.prototype.exit=function(){return n(this,void 0,void 0,(function(){var e,n,r,a,i,s;return t(this,(function(t){switch(t.label){case 0:return e=x.of(this._iid).requestQueue,n=new ve({channelUrl:this.url}),[4,e.send(n)];case 1:return r=t.sent(),a=r.as(Ce),i=a.participantCount,s=a.ts,this._updateParticipantCount(i,s),ye.of(this._iid).setExitedToCache(this),se.of(this._iid).fileMessageQueue.cancel(this),[2]}}))}))},o.prototype.updateChannel=function(e){return n(this,void 0,void 0,(function(){var n,r,o,u,l;return t(this,(function(t){switch(t.label){case 0:return n=P(P({},me),e),b(function(e){return a("string",e.operatorUserIds,!0)&&(i("string",e.coverUrlOrImage)||s(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&i("string",e.name,!0)&&i("string",e.data,!0)&&i("string",e.customType,!0)}(n)).throw(M.invalidParameters),r=x.of(this._iid).requestQueue,o=new we(P({channelUrl:this.url},n)),[4,r.send(o)];case 1:return u=t.sent(),l=u.as(Te).channel,this._update(l),[4,ye.of(this._iid).upsertChannelsToCache([l])];case 2:return t.sent(),[2,this]}}))}))},o.prototype.updateChannelWithOperatorUserIds=function(e,r,a,i,s){return n(this,void 0,void 0,(function(){var n;return t(this,(function(t){return n=P(P({},me),{name:e,coverUrlOrImage:r,data:a,operatorUserIds:i,customType:s}),[2,this.updateChannel(n)]}))}))},o.prototype.delete=function(){return n(this,void 0,void 0,(function(){var e,n;return t(this,(function(t){switch(t.label){case 0:return e=x.of(this._iid).requestQueue,n=new Ne({channelUrl:this.url}),[4,e.send(n)];case 1:return t.sent(),[4,ye.of(this._iid).removeChannelsFromCache([this.url])];case 2:return t.sent(),[2]}}))}))},o.prototype.sendUserMessage=function(e){return b(!e.isPinnedMessage).throw(M.notSupportedError),r.prototype.sendUserMessage.call(this,e)},o.prototype.sendFileMessage=function(e){return b(!e.isPinnedMessage).throw(M.notSupportedError),r.prototype.sendFileMessage.call(this,e)},o}(G),Me=function(n){function t(e){void 0===e&&(e={});var t=n.call(this)||this;return Object.keys(e).forEach((function(n){t.hasOwnProperty(n)&&(t[n]=e[n])})),t}return e(t,n),t}(function(n){function t(){var e=null!==n&&n.apply(this,arguments)||this;return e.onUserEntered=I,e.onUserExited=I,e.onChannelParticipantCountChanged=I,e.onPollUpdated=I,e.onPollVoted=I,e.onPollDeleted=I,e}return e(t,n),t}(ae)),Pe=function(n){function t(e){var t=this,r=e.token,a=e.limit,i=e.nameKeyword,s=e.urlKeyword,u=e.customTypes,c=e.includeFrozen,h=e.includeMetaData;return(t=n.call(this)||this).method=o.GET,t.path=l,t.params=d({token:r,limit:a,name_contains:i,url_contains:s,custom_types:u,show_frozen:c,show_metadata:h}),t}return e(t,n),t}(c),Oe=function(n){function t(e,t){var r=n.call(this,e,t)||this;r.token=null,r.channels=[],r.ts=null;var a=t.next,i=t.channels,s=t.ts;return r.token=a,i&&i.length>0&&(r.channels=i.map((function(n){return new be(e,n)}))),r.ts="number"==typeof s?s:null,r}return e(t,n),t}(h),He=function(r){function s(e,n){var t,a,i,s,o,u=this;return(u=r.call(this,e,n)||this).includeFrozen=!0,u.includeMetaData=!0,u.nameKeyword=null,u.urlKeyword=null,u.customTypes=null,u.includeFrozen=null===(t=n.includeFrozen)||void 0===t||t,u.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,u.nameKeyword=null!==(i=n.nameKeyword)&&void 0!==i?i:null,u.urlKeyword=null!==(s=n.urlKeyword)&&void 0!==s?s:null,u.customTypes=null!==(o=n.customTypes)&&void 0!==o?o:null,u}return e(s,r),s.prototype._validate=function(){return r.prototype._validate.call(this)&&i("boolean",this.includeFrozen)&&i("boolean",this.includeMetaData)&&i("string",this.nameKeyword,!0)&&i("string",this.urlKeyword,!0)&&a("string",this.customTypes,!0)},s.prototype.next=function(){return n(this,void 0,void 0,(function(){var e,n,r,a,i,s;return t(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,e=x.of(this._iid).requestQueue,n=new Pe(P(P({},this),{token:this._token})),[4,e.send(n)]):[3,3]:[3,6];case 1:return r=t.sent(),a=r.as(Oe),i=a.channels,s=a.token,this._token=s,this._hasNext=!!s,[4,ye.of(this._iid).upsertChannelsToCache(i)];case 2:return t.sent(),this._isLoading=!1,[2,i];case 3:return[2,[]];case 4:throw M.queryInProgress;case 5:return[3,7];case 6:throw M.invalidParameters;case 7:return[2]}}))}))},s}(A),xe=function(r){function a(){var e=null!==r&&r.apply(this,arguments)||this;return e.name="openChannel",e}return e(a,r),a.prototype.init=function(e,n){var t=n.sdkState,a=n.dispatcher,i=n.sessionManager,s=n.requestQueue,o=n.logger,u=n.onlineDetector,l=n.cacheContext;r.prototype.init.call(this,e,{sdkState:t,dispatcher:a,sessionManager:i,requestQueue:s,logger:o,onlineDetector:u,cacheContext:l}),this._manager=new ye(e,{sdkState:t,dispatcher:a,requestQueue:s})},a.prototype.createOpenChannelListQuery=function(e){return void 0===e&&(e={}),new He(this._iid,e)},a.prototype.addOpenChannelHandler=function(e,n){this._manager.addHandler(e,n)},a.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},a.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},a.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},a.prototype.getChannel=function(e){return n(this,void 0,void 0,(function(){return t(this,(function(n){return[2,this._manager.getChannel(e)]}))}))},a.prototype.getChannelWithoutCache=function(e){return n(this,void 0,void 0,(function(){return t(this,(function(n){return[2,this._manager.getChannelWithoutCache(e)]}))}))},a.prototype.createChannel=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){return t(this,(function(n){return[2,this._manager.createChannel(e)]}))}))},a.prototype.createChannelWithOperatorUserIds=function(e,r,a,i,s){return n(this,void 0,void 0,(function(){var n;return t(this,(function(t){return(n=P({},le)).name=e,n.coverUrlOrImage=r,n.data=a,n.operatorUserIds=i,n.customType=s,[2,this._manager.createChannel(n)]}))}))},a}(L);export{be as OpenChannel,Me as OpenChannelHandler,He as OpenChannelListQuery,xe as OpenChannelModule,Ue as ParticipantListQuery};
