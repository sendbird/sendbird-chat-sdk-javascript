var Sendbird=function(e){"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{u(r.next(e))}catch(e){s(e)}}function o(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}function a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function u(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var c,l="4.1.3",h=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return l},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),e}();!function(e){e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",e[e.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED"}(c||(c={}));var d,p=function(e){return!(e instanceof f&&!e.shouldThrowOutside)},f=function(e){function t(n){var r=n.code,i=void 0===r?0:r,s=n.message,a=e.call(this,s)||this;return a.shouldThrowOutside=!1,a.name="SendbirdError",a.code=i,Object.setPrototypeOf(a,t.prototype),a}return n(t,e),Object.defineProperty(t.prototype,"isInvalidTokenError",{get:function(){return this.code===c.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===c.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===c.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t,"debugModeRequired",{get:function(){return new t({code:c.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"lostInstance",{get:function(){return new t({code:c.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRenew",{get:function(){return new t({code:c.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidConnectionStateTransition",{get:function(){return new t({code:c.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRequired",{get:function(){return new t({code:c.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionCanceled",{get:function(){return new t({code:c.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidParameters",{get:function(){return new t({code:c.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"notSupportedError",{get:function(){return new t({code:c.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"networkError",{get:function(){return new t({code:c.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"markAsReadAllRateLimitExceeded",{get:function(){return new t({code:c.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"queryInProgress",{get:function(){return new t({code:c.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"noAckTimeout",{get:function(){return new t({code:c.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"loginTimeout",{get:function(){return new t({code:c.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionClosed",{get:function(){return new t({code:c.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestFailed",{get:function(){return new t({code:c.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileUploadCanceled",{get:function(){return new t({code:c.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestCanceled",{get:function(){return new t({code:c.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRefreshFailed",{get:function(){return new t({code:c.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRequestFailed",{get:function(){return new t({code:c.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),t.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},t}(Error),_=[c.CONNECTION_REQUIRED,c.NETWORK_ERROR,c.ACK_TIMEOUT,c.WEBSOCKET_CONNECTION_CLOSED,c.WEBSOCKET_CONNECTION_FAILED,c.FILE_UPLOAD_CANCEL_FAILED,c.REQUEST_CANCELED,c.INTERNAL_SERVER_ERROR,c.RATE_LIMIT_EXCEEDED,c.UNKNOWN_SERVER_ERROR],v=[c.WEBSOCKET_CONNECTION_CLOSED,c.WEBSOCKET_CONNECTION_FAILED,c.CONNECTION_REQUIRED],m=function(e,t){if(e!==t){var n=r({},e),i=r({},t);return(!n.hasOwnProperty("messageId")||!i.hasOwnProperty("messageId")||n.messageId===i.messageId)&&((!n.hasOwnProperty("reqId")||!i.hasOwnProperty("reqId")||n.reqId===i.reqId)&&(n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,i.hasOwnProperty("messageId")&&delete i.messageId,i.hasOwnProperty("reqId")&&delete i.reqId,JSON.stringify(n)===JSON.stringify(i)))}return!0},g=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||("string"!=typeof e?"object"==typeof e?y(e,t):E(e,t):typeof t===e)},y=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Object.values(e).includes(t)},E=function(e,t){return t instanceof e},b=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return g(e,t)}))},C=function(e){return e>0&&v.indexOf(e)>=0},T=function(e,t){if(void 0===t&&(t=!1),t&&null===e)return!0;var n=g("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},I=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberInfoInMessage,r=void 0===n||n,i=t.typingIndicatorInvalidateTime,s=void 0===i?1e4:i,a=t.typingIndicatorThrottle,o=void 0===a?1e3:a,u=t.websocketResponseTimeout,c=void 0===u?1e4:u;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=r,this._typingIndicatorInvalidateTime=s,this._typingIndicatorThrottle=o,this._websocketResponseTimeout=c}return Object.defineProperty(e.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){g("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){g("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){g("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){g("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),e}(),S={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},N={encrypt:function(e){return e},decrypt:function(e){return e}},w=function(){function e(e){var t=e.store;this._preference=new Map,this._store=t}return e.prototype._savePreferenceKeys=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:u([],o(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}}))}))},e.prototype.init=function(e){var t;return i(this,void 0,void 0,(function(){var n,r,i,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return this._keysAddress=e,[4,this._store.get(e)];case 1:n=null!==(t=s.sent())&&void 0!==t?t:[],s.label=2;case 2:s.trys.push([2,7,8,9]),r=a(n),i=r.next(),s.label=3;case 3:return i.done?[3,6]:(o=i.value,[4,this._store.get(o)]);case 4:(u=s.sent())&&this._preference.set(o,u),s.label=5;case 5:return i=r.next(),[3,3];case 6:return[3,9];case 7:return c=s.sent(),l={error:c},[3,9];case 8:try{i&&!i.done&&(h=r.return)&&h.call(r)}finally{if(l)throw l.error}return[7];case 9:return[2]}}))}))},e.prototype.get=function(e){var t;return i(this,void 0,void 0,(function(){return s(this,(function(n){return[2,null!==(t=this._preference.get(e))&&void 0!==t?t:null]}))}))},e.prototype.set=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=!this._preference.has(e),[4,this._store.set({key:e,value:t,generation:1})];case 1:return r.sent(),this._preference.set(e,t),n?[4,this._savePreferenceKeys()]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._store.remove(e)];case 1:return t.sent(),this._preference.delete(e),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._store.removeMany(u([],o(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}}))}))},e}(),M=function(e){var t=e.encryption,n=void 0===t?null:t,r=e.store,i=void 0===r?null:r,s=e.localCacheEnabled,a=void 0===s||s;this.nestdb=null,this.store=i,this.preference=new w({store:i}),this.encryption=null!=n?n:N,this.localCacheEnabled=a},A=function(){function e(){this.sessionKey=null,this.authToken=null}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=null,this.sessionKey=null},e}(),U=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},O=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=U()}return e.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},e}(),R=function(){function e(){this._container={}}return e.prototype.on=function(e,t){return new O({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new O({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var s=[];try{for(var o=a(i.keys()),u=o.next();!u.done;u=o.next()){var c=u.value,l=i.get(c);l.handler(t),l.occurence>0&&(l.occurence--,0===l.occurence&&s.push(c))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}s.forEach((function(e){return i.delete(e)}))}},e}(),L=function(){function e(){this._dispatcher=new R}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},e}(),k=function(){},D=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0!==e[n]&&NaN!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(d||(d={}));var P,x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=U(),t}return n(t,e),t.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},t.prototype.encodeParams=function(e){var t=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return t.encodeParams(e)})).join(","):"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))},Object.defineProperty(t.prototype,"query",{get:function(){var e=this,t=D(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){var e=this,t=D(this.params);if(Object.keys(t).some((function(e){return T(t[e])}))){var n=new FormData;return Object.keys(t).forEach((function(r){var i,s=t[r];if(T(s)){var a=s;n.append(r,a,null!==(i=a.name)&&void 0!==i?i:"filename")}else n.append(r,e.stringifyParams(s))})),n}return JSON.stringify(t)},enumerable:!1,configurable:!0}),t}(k),F=function(e){function t(t,n){var r=e.call(this)||this;return r._iid=t,r._payload=n,r}return n(t,e),Object.defineProperty(t.prototype,"payload",{get:function(){return r({},this._payload)},enumerable:!1,configurable:!0}),t.prototype.as=function(e){return new e(this._iid,this.payload)},t}(k),q=function(e){function t(t){var n=e.call(this)||this;return n.requestId=t,n}return n(t,e),t}(k),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(k),H=function(e){function t(t){var n=e.call(this)||this;return n.statLog=t,n}return n(t,e),t}(k);!function(e){e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result"}(P||(P={}));var V,K=function(){function e(e){var t=e.type,n=e.data,r=e.ts,i=void 0===r?Date.now():r;this.type=t,this.createdAt=i,this.data=n}return e.payloadify=function(e){return D({stat_type:e.type,ts:e.createdAt,data:D(e.data)})},e}(),Q=function(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},B=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,a=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on((function(e){e instanceof q&&a.cancel(e.requestId)})),this._logger=s}return Object.defineProperty(e.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t=Q()?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",i=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(h.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(i)},enumerable:!1,configurable:!0}),e.prototype._createHeader=function(e,t){void 0===t&&(t=null);var n=this._sdkState,i=n.appId,s=n.appVersion,a=r(r({},e.headers),{SendBird:"JS,".concat(h.OS_VERSION,",").concat(h.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(a["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(a["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(a["App-Id"]=i,a["Access-Token"]=this._auth.authToken),a},e.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new H(new K({type:P.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},e.prototype.send=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c,l,h,p,_,v,m,g;return s(this,(function(s){switch(s.label){case 0:t=e.path,n=e.method,r=![d.GET,d.DELETE].includes(n),i=this._sdkState.api,a="".concat(i.host).concat(t).concat(r?"":e.query),o=r?e.payload:null,u=this._createHeader(e,o instanceof FormData?o:null),c=new AbortController,l=c.signal,this._abortControl.set(e.requestId,c),h=Date.now(),s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(a,{method:n,body:o,headers:u,signal:l})];case 2:return[4,(p=s.sent()).json()];case 3:if(_=s.sent(),p.ok||p.redirected)return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,h,null),[2,new F(this._iid,_)];throw _?(v=new f(_),!e.requireAuth&&v.isSessionKeyExpiredError&&this._dispatcher.dispatch(new G),this._statLogApiResult(e,h,v),v):(v=f.requestFailed,this._statLogApiResult(e,h,v),v);case 4:throw m=s.sent(),this._statLogApiResult(e,h,m),m instanceof f?(this._logger.debug("fail api request",m),m):"AbortError"===m.name?f.requestCanceled:(g=f.networkError,this._logger.debug("fail api request",g),g);case 5:return[2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},e.prototype.cancelAll=function(){var e,t;try{for(var n=a(this._abortControl.values()),r=n.next();!r.done;r=n.next()){r.value.abort()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},e}(),j=function(e){function t(t,n,r,i){void 0===i&&(i="");var s,a=this;return(a=e.call(this)||this)._iid=t,a.code=n,a.payload=r,a.requestId=r?null!==(s=r.req_id)&&void 0!==s?s:i:"",a}return n(t,e),t.createFromRawMessage=function(e,n){var r=n.substring(0,4),i=null;try{i=JSON.parse(n.substring(4))}catch(e){r="NOOP"}finally{return new t(e,r,i)}},t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},t.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},t}(k),z=function(e){function t(t){var n,r=t.code,i=t.ackRequired,s=t.payload,a=void 0===s?null:s,o=this;return(o=e.call(this)||this).code=r,o.payload=a,o.requestId=null!==(n=o.payload.req_id)&&void 0!==n?n:U(),o.ackRequired=i,o.payload.req_id=o.requestId,o}return n(t,e),t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},t}(k),W=function(e){function t(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return n(t,e),t}(z),Y=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,r=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=r}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this,n=new W;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e.prototype.refreshTimer=function(){var e,t=this;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e}(),J=function(){};e.ConnectionState=void 0,(V=e.ConnectionState||(e.ConnectionState={})).CONNECTING="CONNECTING",V.OPEN="OPEN",V.CLOSED="CLOSED";var X,Z=function(t){function r(e,n){var r=n.sdkState,i=n.dispatcher,s=n.logger,a=t.call(this)||this;return a._pinger=null,a.lastActive=0,a._iid=e,a._sdkState=r,a._dispatcher=i,a._logger=s,a._sdkState.websocket.pingerDisabled||(a._pinger=new Y({pingDelegate:{send:function(e){return a.send(e)},error:function(e){return a.error(e)}},sdkState:a._sdkState,logger:s})),a}return n(r,t),Object.defineProperty(r.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return e.ConnectionState.CONNECTING;case 1:return e.ConnectionState.OPEN}return e.ConnectionState.CLOSED},enumerable:!1,configurable:!0}),r.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach((function(e){if(e&&g("string",e)){var n=j.createFromRawMessage(t._iid,e);t._logger.debug("receive websocket event",n),"LOGI"===n.code?(n.payload&&!n.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",n)):"PONG"===n.code?t._pinger&&t._pinger.pong():"EXPR"===n.code?n.payload&&n.payload.expires_in>=0&&t._dispatcher.dispatch(new G):"NOOP"===n.code||t.dispatch("message",n)}}))},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",f.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},r.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=J,this._ws.onmessage=J,this._ws.onerror=J,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},r.prototype.send=function(e){if(!this._ws)throw f.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},r.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)},r}(R),$=function(e){function t(t){var n=t.all,r=t.custom_types,i=t.ts,s=e.call(this)||this;return s.all=n,s.customTypes=r,s.ts=i,s}return n(t,e),t}(k),ee=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))},te=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,a=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=s,this.apiClient=new B(e,{auth:n,sdkState:r,dispatcher:i,logger:s}),this.websocketClient=new Z(e,{sdkState:r,dispatcher:i,logger:s}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&a._dispatcher.dispatch(new $(e.payload.unread_cnt)),e.requestId){if(a._ackStateMap.has(e.requestId)){var t=a._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new f({code:e.payload.code,message:e.payload.message}))}}else a._dispatcher.dispatch(e)})).on("close",(function(){a._ackStateMap.forEach((function(e){e.reject(f.connectionClosed)})),a._ackStateMap.clear()}))}return e.prototype._sendApiRequest=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.apiClient.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i=this;return s(this,(function(s){if(t=new ee,e.ackRequired){n=null,r=function(r,s){void 0===r&&(r=null),void 0===s&&(s=null),i._ackStateMap.has(e.requestId)&&(i._ackStateMap.delete(e.requestId),n&&(clearTimeout(n),n=null),r?(i._logger.debug("fail websocket request",r),t.reject(r)):(i._logger.debug("receive websocket ack",e.requestId),t.resolve(s)))};try{n=setTimeout((function(){return r(f.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return r(null,e)},reject:function(e){return r(e)}}),this.websocketClient.send(e)}catch(e){r(e)}}else try{this.websocketClient.send(e),t.resolve(null)}catch(e){t.reject(e)}return[2,t.promise]}))}))},e.prototype.send=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e instanceof x?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return e instanceof z?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw f.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e)},e.prototype.cancelAll=function(){this.apiClient.cancelAll()},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT"}(X||(X={}));var ne,re,ie,se,ae,oe,ue,ce,le,he=function(e){function t(t){var n=t.stateType,r=e.call(this)||this;return r.stateType=n,r}return n(t,e),t}(k),de=function(){function e(e,t){var n=t.auth,r=t.sdkState,a=t.dispatcher,o=t.logger,u=this;this._currentConnectionStateType=X.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new te(e,{auth:n,sdkState:r,dispatcher:a,logger:o}),this._auth=n,this._logger=o,this._dispatcher=a,this._dispatcher.on((function(e){if(e instanceof he){var t=e.stateType;switch(u._currentConnectionStateType=t,t){case X.CONNECTED:var n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return i(u,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:t=e.command,n=e.deferred,r=e.timeout,clearTimeout(r),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.send(t)];case 2:return i=s.sent(),n.resolve(i),[3,4];case 3:return a=s.sent(),n.reject(a),[3,4];case 4:return[2]}}))}))}));break;case X.INITIALIZED:case X.DISCONNECTED:case X.LOGOUT:n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return i(u,void 0,void 0,(function(){var t,n;return s(this,(function(r){return t=e.deferred,n=e.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(f.connectionClosed):t.reject(f.connectionRequired),[2]}))}))}))}}}))}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===X.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===X.CONNECTING||this._currentConnectionStateType===X.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.send=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:return e instanceof z?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:return[2,i.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new ee,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),f.connectionRequired;case 3:return[3,7];case 4:return e instanceof x?this._auth.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new ee,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=f.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}}))}))},e.prototype.forceSend=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._logger.debug("send forced request",e),[4,this.commandRouter.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(f.connectionRequired),this._lazyCallQueue.splice(t,1))},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},e}(),pe="v3",fe="/".concat(pe,"/users"),_e="/".concat(pe,"/storage/file"),ve="/".concat(pe,"/group_channels"),me="/".concat(pe,"/sdk/group_channels"),ge="/".concat(pe,"/open_channels"),ye="/".concat(pe,"/sdk/open_channels"),Ee="/".concat(pe,"/search"),be="/".concat(pe,"/report"),Ce="/".concat(pe,"/emojis"),Te="/".concat(pe,"/emoji_categories"),Ie="/".concat(pe,"/polls"),Se="/".concat(pe,"/scheduled_messages"),Ne="/".concat(pe,"/sdk/statistics"),we=function(e){function t(t){var n=t.userId,r=t.authToken,i=t.expiringSession,s=void 0===i||i,a=e.call(this)||this;return a.path="".concat(fe,"/").concat(n,"/session_key"),a.method=d.POST,a.params={token:r,expiring_session:!!s},a.requireAuth=!1,a}return n(t,e),t}(x),Me=function(e){function t(t){var n=t.authToken,r=t.expiringSession,i=void 0===r||r;return e.call(this,{code:"LOGI",payload:{token:n,expiring_session:i?1:0},ackRequired:!0})||this}return n(t,e),t}(z),Ae=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.key;return r.key=i,r}return n(t,e),t}(F),Ue=function(e){function t(t,n,r){var i=e.call(this,t,"LOGI",r)||this;return i.error=null,i.newKey=r.new_key,i.error=r.error?new f(r.error):null,i}return n(t,e),t}(j),Oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(k),Re=function(e){return i(void 0,void 0,void 0,(function(){return s(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},Le=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),ke=function(e,t,n){return void 0===n&&(n=new Le),i(void 0,void 0,void 0,(function(){var r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:r=0,i=null,a=function(e){return void 0===e&&(e=null),i=null!=e?e:new Error("Halted")},o=function(){r=0},s.label=1;case 1:if(!(-1===t||r<t))return[3,9];s.label=2;case 2:return s.trys.push([2,4,,8]),[4,e(a,o)];case 3:if(u=s.sent(),i)throw i;return[2,u];case 4:if(c=s.sent(),i)return[3,6];if(++r===t)throw c;return[4,Re(n.calcTimeout(r))];case 5:return s.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},De=function(e){return i(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof f))throw t;return t.throwOutside(),[3,3];case 3:return[2]}}))}))},Pe=function(e){return i(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))}))},xe=function(e){function t(t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.requestQueue,a=t.logger,o=e.call(this)||this;return o._currentConnectionStateType=X.INITIALIZED,o._isRefreshingAuthToken=!1,o._isRefreshingSessionKey=!1,o.auth=n,o._sdkState=r,o._dispatcher=i,o._requestQueue=s,o._logger=a,o._dispatcher.on((function(e){if(e instanceof he){var t=e.stateType;o._currentConnectionStateType=t}else e instanceof G&&o.handler&&(o._logger.debug("session expired"),o.handler.onSessionExpired(),o.refresh())})),o}return n(t,e),t.prototype.createRefreshWebsocketCommand=function(e){return new Me({authToken:e,expiringSession:!0})},t.prototype._refreshSessionKeyByWebSocket=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return t=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(t)];case 1:if(n=s.sent(),r=n.as(Ue),i=r.newKey,a=r.error)throw a;return this.auth.sessionKey=null!=i?i:this.auth.sessionKey,[2]}}))}))},t.prototype._refreshSessionKeyByApi=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return t=new we({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),[4,ke((function(e){return i(n,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(t)];case 1:return n=s.sent(),r=n.as(Ae).key,this.auth.sessionKey=r,[3,3];case 2:if(i=s.sent(),!this._isSessionRelatedError(i))throw i;return e(i),[3,3];case 3:return[2]}}))}))}),3)];case 1:return r.sent(),[2]}}))}))},t.prototype._refreshSessionKey=function(e,t){return void 0===t&&(t=!0),i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(this._currentConnectionStateType!==X.CONNECTED)return[3,9];s.label=1;case 1:return s.trys.push([1,3,,9]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return s.sent(),this.complete(),[2];case 3:return n=s.sent(),this._isSessionRelatedError(n)?t?(r=this.auth,[4,this._receiveNewAuthToken()]):[3,8]:[3,8];case 4:return r.authToken=s.sent(),this.auth.authToken?[4,this._refreshSessionKey(this.auth.authToken,!1)]:[3,6];case 5:return s.sent(),this.complete(),[3,7];case 6:this.close(),s.label=7;case 7:return[2];case 8:return[3,9];case 9:return s.trys.push([9,11,,20]),[4,this._refreshSessionKeyByApi(e)];case 10:return s.sent(),this.complete(),[3,20];case 11:return i=s.sent(),this._isSessionRelatedError(i)?t?(a=this.auth,[4,this._receiveNewAuthToken()]):[3,16]:[3,18];case 12:return a.authToken=s.sent(),this.auth.authToken?[4,this._refreshSessionKeyByApi(this.auth.authToken)]:[3,14];case 13:return s.sent(),this.complete(),[3,15];case 14:this.close(),s.label=15;case 15:return[3,17];case 16:throw i;case 17:return[3,19];case 18:throw i;case 19:return[3,20];case 20:return[2]}}))}))},t.prototype._receiveNewAuthToken=function(){var e=this,t=new ee;return De((function(){return i(e,void 0,void 0,(function(){var e=this;return s(this,(function(n){return this._isRefreshingAuthToken=!0,this.auth.clear(),this.handler.onSessionTokenRequired((function(n){e._isRefreshingAuthToken=!1,e.dispatch("refresh-authtoken"),t.resolve(n)}),(function(n){e._isRefreshingAuthToken=!1,t.reject(n)})),[2]}))}))})),t.promise},t.prototype._isSessionRelatedError=function(e){return e instanceof f&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError)},Object.defineProperty(t.prototype,"isSessionKeyRefreshing",{get:function(){return this._isRefreshingSessionKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),t.prototype.complete=function(){var e=this;this.dispatch("refresh"),De((function(){return i(e,void 0,void 0,(function(){return s(this,(function(e){return this._logger.debug("session refreshed"),this.handler.onSessionRefreshed(),[2]}))}))}))},t.prototype.error=function(e){var t=this;De((function(){return i(t,void 0,void 0,(function(){return s(this,(function(t){return this.handler.onSessionError(e),[2]}))}))}))},t.prototype.close=function(){var e=this;this.dispatch("close"),De((function(){return i(e,void 0,void 0,(function(){return s(this,(function(e){return this._logger.debug("session closed"),this.handler.onSessionClosed(),[2]}))}))}))},t.prototype.refresh=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(!this.handler)return[3,7];if(this._isRefreshingSessionKey)return[3,7];if(this._isRefreshingSessionKey=!0,this.auth.authToken)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._receiveNewAuthToken()];case 2:return(e=n.sent())?(this._logger.debug("session refreshing.."),this.auth.authToken=e,[3,4]):(this.close(),this._isRefreshingSessionKey=!1,[2]);case 3:throw n.sent(),t=f.sessionTokenRequestFailed,this._dispatcher.dispatch(new Oe),this.error(t),this._isRefreshingSessionKey=!1,t;case 4:return n.trys.push([4,6,,7]),[4,this._refreshSessionKey(this.auth.authToken)];case 5:return n.sent(),this._isRefreshingSessionKey=!1,[3,7];case 6:throw n.sent(),t=f.sessionTokenRefreshFailed,this._dispatcher.dispatch(new Oe),this.error(t),this._isRefreshingSessionKey=!1,t;case 7:return[2]}}))}))},t}(R),Fe=function(){function e(){this.type=X.NONE,this.name="none"}return e.prototype.run=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onReconnect=function(e,t){return t.resetReconnectCount,i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e}(),qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=X.LOGOUT,t.name="logout",t}return n(t,e),t.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return t=e.sdkState.userId,e.logout(),De((function(){return i(n,void 0,void 0,(function(){return s(this,(function(n){return e.connectionHandlers.forEach((function(e){e.onDisconnected(t)})),[2]}))}))})),[4,e.changeState(new Qe)];case 1:return r.sent(),[2]}}))}))},t}(Fe),Ge=function(e){function t(t){var n=t.autoReconnect,r=e.call(this)||this;return r.type=X.DISCONNECTED,r.name="disconnected",r._autoReconnect=!1,r._autoReconnect=n,r}return n(t,e),t.prototype.run=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e.disconnect(),this._autoReconnect?[4,e.changeState(new He)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return e.disconnect(),[4,e.changeState(new Ke({authToken:t}))];case 1:return n.sent(),[2]}}))}))},t.prototype.onReconnect=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new He)];case 1:return t.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new qe)];case 1:return t.sent(),[2]}}))}))},t}(Fe),He=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=X.RECONNECTING,t.name="reconnecting",t._haltConnect=null,t._resetConnect=null,t._callbacks=[],t}return n(t,e),t.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}))},t.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r,a,o,u=this;return s(this,(function(l){switch(l.label){case 0:t=new ee,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),De((function(){return i(u,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted()})),[2]}))}))})),l.label=1;case 1:return l.trys.push([1,4,,9]),n=e.sdkState.websocket,r=n.reconnectMaxRetry,a=n.reconnectRetryStrategy,[4,ke((function(t,n){return i(u,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:this._haltConnect=t,this._resetConnect=n,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.connect()];case 2:return i.sent(),[3,4];case 3:if((r=i.sent())instanceof f&&r.code===c.CONNECTION_CANCELED)return t(r),[2];throw r;case 4:return[2]}}))}))}),r,a)];case 2:return l.sent(),[4,e.changeState(new Ve)];case 3:return l.sent(),De((function(){return i(u,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded()})),this.flushCallbacks(null),[2]}))}))})),[3,9];case 4:return o=l.sent(),p(o)?[3,7]:o instanceof f?o.code===c.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Ge({autoReconnect:!1}))]:[3,6];case 5:l.sent(),l.label=6;case 6:return De((function(){return i(u,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectFailed()})),this.flushCallbacks(o),[2]}))}))})),[3,8];case 7:throw o;case 8:return[3,9];case 9:return[2,t.promise]}}))}))},t.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=new ee,this._resetConnect&&this._resetConnect(),e.cancelConnectForRetry(),this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),[2,t.promise]}))}))},t.prototype.onReconnect=function(e,t){var n=t.resetReconnectCount,r=void 0!==n&&n;return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=new ee,this._resetConnect&&r&&this._resetConnect(),e.cancelConnectForRetry(),this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),[2,t.promise]}))}))},t.prototype.onDisconnect=function(e,t){var n=t.error,r=void 0===n?null:n,a=t.autoReconnect,o=void 0===a||a;return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=r?r:f.connectionCanceled),[4,e.changeState(new Ge({autoReconnect:o}))];case 1:return t.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(f.connectionCanceled),[4,e.changeState(new qe)];case 1:return t.sent(),[2]}}))}))},t}(Fe),Ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=X.CONNECTED,t.name="connected",t}return n(t,e),t.prototype.onReconnect=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e.disconnect(),[4,e.changeState(new He)];case 1:return t.sent(),[2]}}))}))},t.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new Ge({autoReconnect:n}))];case 1:return t.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new qe)];case 1:return t.sent(),[2]}}))}))},t}(Fe),Ke=function(e){function t(t){var n=t.authToken,r=e.call(this)||this;return r.type=X.CONNECTING,r.name="connecting",r._authToken="",r._haltConnect=null,r._callbacks=[],r._authToken=n,r}return n(t,e),t.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}))},t.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(a){switch(a.label){case 0:t=new ee,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),a.label=1;case 1:return a.trys.push([1,4,,9]),[4,ke((function(t){return i(r,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return r.sent(),[3,4];case 3:if((n=r.sent())instanceof f&&n.code===c.CONNECTION_CANCELED)return t(n),[2];throw n;case 4:return[2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return a.sent(),[4,e.changeState(new Ve)];case 3:return a.sent(),De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(t){t.onConnected(e.sdkState.userId)})),this.flushCallbacks(null),[2]}))}))})),[3,9];case 4:return n=a.sent(),p(n)?[3,7]:(e.disconnect(),n instanceof f?n.code===c.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Qe)]:[3,6]);case 5:a.sent(),a.label=6;case 6:return De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(e){return this.flushCallbacks(n),[2]}))}))})),[3,8];case 7:throw n;case 8:return[3,9];case 9:return[2,t.promise]}}))}))},t.prototype.onConnect=function(e){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new ee,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},t.prototype.onDisconnect=function(e,t){var n=t.error,r=void 0===n?null:n;return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=r?r:f.connectionCanceled),[4,e.changeState(new qe)];case 1:return t.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(f.connectionCanceled),[4,e.changeState(new qe)];case 1:return t.sent(),[2]}}))}))},t}(Fe),Qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=X.INITIALIZED,t.name="initialized",t}return n(t,e),t.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,e.changeState(new Ke({authToken:t}))];case 1:return n.sent(),[2]}}))}))},t}(Fe),Be=new Map,je=function(e,t){var n;return void 0===t&&(t=null),null!==t&&Be.set(e,t),null!==(n=Be.get(e))&&void 0!==n?n:""},ze=function(e){void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[],this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history")},We=function(){function e(e){this._iid="",this._iid=e}return e.payloadify=function(e){return e?{}:null},e}(),Ye=function(e){function t(t){var n=t.userId,r=t.metadata,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(fe,"/").concat(n,"/metadata"),i.params={metadata:r},i}return n(t,e),t}(x);!function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}n(t,e)}(F),e.ChannelType=void 0,(ne=e.ChannelType||(e.ChannelType={})).BASE="base",ne.GROUP="group",ne.OPEN="open",e.Role=void 0,(re=e.Role||(e.Role={})).OPERATOR="operator",re.NONE="none",e.MessageType=void 0,(ie=e.MessageType||(e.MessageType={})).BASE="base",ie.USER="user",ie.FILE="file",ie.ADMIN="admin",e.MessageTypeFilter=void 0,(se=e.MessageTypeFilter||(e.MessageTypeFilter={})).ALL="",se.USER="MESG",se.FILE="FILE",se.ADMIN="ADMM",function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(ae||(ae={})),e.MentionType=void 0,(oe=e.MentionType||(e.MentionType={})).USERS="users",oe.CHANNEL="channel",e.ReplyType=void 0,(ue=e.ReplyType||(e.ReplyType={})).ALL="all",ue.NONE="none",ue.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",e.PushNotificationDeliveryOption=void 0,(ce=e.PushNotificationDeliveryOption||(e.PushNotificationDeliveryOption={})).DEFAULT="default",ce.SUPPRESS="suppress",e.SendingStatus=void 0,(le=e.SendingStatus||(e.SendingStatus={})).PENDING="pending",le.SCHEDULED="scheduled",le.SUCCEEDED="succeeded",le.FAILED="failed",le.CANCELED="canceled";var Je=function(t){switch(t){case e.ChannelType.GROUP:return ve;case e.ChannelType.OPEN:return ge;default:return null}},Xe=function(t){switch(t){case e.ChannelType.GROUP:return"".concat(be,"/group_channels");case e.ChannelType.OPEN:return"".concat(be,"/open_channels");default:return null}},Ze=function(t,n,r){var i,s;switch(t){case e.MentionType.CHANNEL:return!0;case e.MentionType.USERS:if(n)try{for(var o=a(n),u=o.next();!u.done;u=o.next()){if(u.value===r)return!0}}catch(e){i={error:e}}finally{try{u&&!u.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}return!1},$e=function(e,t,n){var r=Ze(e.mentionType,e.mentionedUserIds,n),i=Ze(t.mentionType,t.mentionedUserIds,n);return!r&&i?1:r&&!i?-1:0},et=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.metadata;return(n=e.call(this)||this).method=d.POST,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:s,include_ts:!0},n}return n(t,e),t}(x),tt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaData=null!=n?n:{},r}return n(t,e),t}(F),nt=function(e){function t(t){var n=t.userId,r=t.metadata,i=t.upsert,s=e.call(this)||this;return s.method=d.PUT,s.path="".concat(fe,"/").concat(n,"/metadata"),s.params={metadata:r,upsert:i},s}return n(t,e),t}(x),rt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}return n(t,e),t}(F),it=function(e){function t(t){var n=t.userId,r=t.metadataKey,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(fe,"/").concat(n,"/metadata/").concat(r),i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var st=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.DELETE,r.path="".concat(fe,"/").concat(n,"/metadata"),r}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var at,ot=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},ut=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},ct=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};e.UserOnlineState=void 0,(at=e.UserOnlineState||(e.UserOnlineState={})).ONLINE="online",at.OFFLINE="offline",at.NON_AVAILABLE="nonavailable";var lt,ht=function(t){function a(n,r){var i,s,a,c,l,h,d,p,f,_,v,m,E=this;return(E=t.call(this,n)||this).userId=null!==(s=null!==(i=r.guest_id)&&void 0!==i?i:r.user_id)&&void 0!==s?s:"",E.nickname=null!==(c=null!==(a=r.nickname)&&void 0!==a?a:r.name)&&void 0!==c?c:"",E.plainProfileUrl=null!==(h=null!==(l=r.profile_url)&&void 0!==l?l:r.image)&&void 0!==h?h:"",E.requireAuth=null!==(d=r.require_auth_for_profile_image)&&void 0!==d&&d,E.metaData=null!==(p=r.metadata)&&void 0!==p?p:{},E.connectionStatus=e.UserOnlineState.NON_AVAILABLE,y(e.UserOnlineState,r.is_online)?E.connectionStatus=r.is_online:g("boolean",r.is_online)&&(E.connectionStatus=r.is_online?e.UserOnlineState.ONLINE:e.UserOnlineState.OFFLINE),E.isActive=null===(f=r.is_active)||void 0===f||f,E.lastSeenAt=null!==(_=r.last_seen_at)&&void 0!==_?_:null,E.preferredLanguages=r.preferred_languages?u([],o(r.preferred_languages),!1):null,E.friendDiscoveryKey=null!==(v=r.friend_discovery_key)&&void 0!==v?v:null,E.friendName=null!==(m=r.friend_name)&&void 0!==m?m:null,E}return n(a,t),a.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null},Object.defineProperty(a.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(je(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),a.prototype.serialize=function(){return ot(this)},a.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return g("string",e)}))},a.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(r){t?delete n.metaData[r]:n.metaData[r]=e[r]}))},a.prototype.createMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return ct(this._isValidMetaData(e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Ye({userId:n.userId,metadata:e}),[4,r.send(i)];case 1:return a=s.sent(),o=a.as(tt).metaData,this._applyMetaData(o),[2,this.metaData]}}))}))},a.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(this._isValidMetaData(e)).throw(f.invalidParameters),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new nt({userId:r.userId,metadata:e,upsert:t}),[4,i.send(a)];case 1:return o=s.sent(),u=o.as(rt).metadata,this._applyMetaData(u),[2,this.metaData]}}))}))},a.prototype.deleteMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new it({userId:n.userId,metadataKey:e}),[4,r.send(i)];case 1:return s.sent(),this._applyMetaData(((a={})[e]=!0,a),!0),[2,this.metaData]}}))}))},a.prototype.deleteAllMetaData=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new st({userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),this.metaData={},[2]}}))}))},a}(We),dt=function(e){function t(t){var n=t.userProfile,r=e.call(this)||this;return r.userProfile=n,r}return n(t,e),t}(k),pt=function(){function e(e,t){var n,r,i,s,a,o,u,c,l,h,d,p,f,_;this._iid=e,this.appInfo=new ze(t),this.user=new ht(e,t),this.connectedAt=1e3*(null!==(n=t.login_ts)&&void 0!==n?n:0),this.firstConnectedAt=0,this.pingInterval=null!==(r=t.ping_interval)&&void 0!==r?r:15e3,this.pongTimeout=null!==(i=t.pong_timeout)&&void 0!==i?i:5e3,this.reconnectInterval=null!==(a=null===(s=t.reconnect)||void 0===s?void 0:s.interval)&&void 0!==a?a:3e3,this.reconnectMaxInterval=null!==(u=null===(o=t.reconnect)||void 0===o?void 0:o.max_interval)&&void 0!==u?u:6e4,this.reconnectRetryCount=null!==(l=null===(c=t.reconnect)||void 0===c?void 0:c.retry_cnt)&&void 0!==l?l:5,this.reconnectIntervalMultiple=null!==(d=null===(h=t.reconnect)||void 0===h?void 0:h.mul)&&void 0!==d?d:2,this.maxUnreadCountOnSuperGroup=null!==(p=t.max_unread_cnt_on_super_group)&&void 0!==p?p:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(f=t.concurrent_call_limit)&&void 0!==f?f:5,this.backOffDelay=null!==(_=t.back_off_delay)&&void 0!==_?_:100}return e.payloadify=function(e){return r(r({},ht.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},e.prototype.apply=function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=wt.of(this._iid);r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}},r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new dt({userProfile:this}))},e}(),ft=function(e){function t(t,n,r){var i,s=this;return(s=e.call(this,t,n,r)||this).error=null,s.userProfile=new pt(t,r),s.key=r.key,s.ekey=null!==(i=r.ekey)&&void 0!==i?i:"",s.error=r.error?new f(r):null,s}return n(t,e),t.asError=function(e){return new t(null,"LOGI",r({user_id:null,error:!0},e))},t.prototype.applyTo=function(e){if(this.error)throw this.error;var t=wt.of(e);if(!t)throw f.lostInstance;t.sessionManager.auth.sessionKey=this.key,je(e,this.ekey),this.userProfile.apply()},t}(j),_t=function(e){function t(t){var n=e.call(this)||this;return n.enabled=t,n}return n(t,e),t}(k),vt=function(e){function t(t,n){var r=n.sdkState,i=n.cacheContext,s=n.connectionHandlers,a=n.sessionManager,o=n.websocketClient,u=n.dispatcher,c=n.logger,l=n.entryState,h=void 0===l?new Qe:l,d=e.call(this)||this;return d._currentState=null,d._loginTimer=null,d._connectingAt=0,d._connectionRequestQueue=[],d._iid=t,d.sdkState=r,d.cacheContext=i,d.connectionHandlers=s,d._sessionManager=a,d._websocketClient=o,d._dispatcher=u,d._logger=c,d._currentState=h,d._websocketClient.on("message",(function(e){if("LOGI"===e.code){d._loginTimer&&(clearTimeout(d._loginTimer),d._loginTimer=null);var t=e.as(ft);if(t.error)(t.error.isSessionKeyExpiredError||t.error.isSessionTokenExpiredError)&&d._dispatcher.dispatch(new G),d._connectionRequestQueue.forEach((function(e){return e.reject(t.error)})),d._statLogConnection(t.error);else{t.applyTo(d._iid),d._connectionRequestQueue.forEach((function(e){return e.resolve()}));var n=t.userProfile;d._enableStatLog(n.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),d._statLogConnection(null)}d._connectionRequestQueue=[]}})).on("close",(function(){d._connectionRequestQueue.length>0&&(d._connectionRequestQueue.forEach((function(e){return e.reject(f.networkError)})),d._connectionRequestQueue=[],d._statLogConnection(f.networkError))})),d}return n(t,e),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),t.prototype.changeState=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._currentState=e,this._dispatcher.dispatch(new he({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)];case 1:return t.sent(),[2]}}))}))},t.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,s=t.extensions,a=this.cacheContext.localCacheEnabled,o=this._sessionManager.auth,u=s.sb_syncmanager?"s".concat(s.sb_syncmanager):"",c=s.sb_uikit?"u".concat(s.sb_uikit):"",l="JS/c".concat(h.SDK_VERSION,"/").concat(u,"/").concat(c);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(h.OS_VERSION),"&sv=").concat(encodeURIComponent(h.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(o.hasSession?"&key=".concat(encodeURIComponent(o.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(l,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(a?1:0,"&include_poll_details=1")},t.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new _t(e))},t.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new H(new K({type:P.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},t.prototype.connect=function(e){return void 0===e&&(e=""),i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){return t=this._url(e),n=new ee,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){r._loginTimer=null,r._dispatcher.dispatch(ft.asError(f.loginTimeout))}),this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]}))}))},t.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(ft.asError(f.connectionRenew))},t.prototype.disconnect=function(){this._websocketClient.disconnect()},t.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},t}(R),mt=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,i=t.connectionHandlers,s=t.sessionManager,a=t.websocketClient,o=t.dispatcher,u=t.logger,c=t.disableAutoReconnect,l=void 0!==c&&c,h=this;this._context=null,this._logger=u,this._context=new vt(e,{sdkState:n,cacheContext:r,connectionHandlers:i,sessionManager:s,websocketClient:a,dispatcher:o,logger:u}),l||(s.on("refresh-authtoken",(function(){h.isConnected||(h._logger.debug("try reconnect by session token refresh"),h.reconnect())})).on("refresh",(function(){h.isConnecting||h.isConnected||(h._logger.debug("try reconnect by session key refresh"),h.reconnect())})),a.on("close",(function(){"foreground"===n.appState&&setTimeout((function(){s.isRefreshingAuthToken||(h._logger.debug("try reconnect by websocket connection closed"),h.reconnect())}),100)})))}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===X.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===X.CONNECTING||e.type===X.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onConnect(this._context,e)];case 1:return t.sent(),[2]}}))}))},e.prototype.reconnect=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}}))}))},e.prototype.resetAndReconnect=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}}))}))},e.prototype.background=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return void 0===e&&(e=null),i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.logout=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}}))}))},e}(),gt=function(e){function t(t){var n=t.deviceId,r=t.statLogs,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(Ne),i.params={device_id:n,log_entries:r.map((function(e){return K.payloadify(e)}))},i}return n(t,e),t}(x);!function(e){e[e.PENDING=0]="PENDING",e[e.ENABLED=1]="ENABLED",e[e.DISABLED=2]="DISABLED"}(lt||(lt={}));var yt,Et=function(){function e(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.baseLimit,s=void 0===i?100:i,a=e.maxLimit,o=void 0===a?1e3:a,u=e.minLimit,c=void 0===u?10:u;this.queue=[],this.enabledstate=lt.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=U(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=s,this.limit=s,this.maxLimit=o,this.minLimit=c}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.enabledstate===lt.ENABLED},enumerable:!1,configurable:!0}),e.prototype._save=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return K.payloadify(e)})),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype._flush=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,n.label=1;case 1:return n.trys.push([1,5,6,7]),(e=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length>0?(t=new gt({deviceId:this.deviceId,statLogs:e}),[4,this.requestQueue.send(t)]):[3,4];case 2:return n.sent(),this.queue=this.queue.slice(e.length),[4,this._save()];case 3:n.sent(),n.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return n.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}}))}))},e.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:return this.key=e,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return(t=i.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map((function(e){return new K({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit?(n=Math.min(Math.floor(18e4*Math.random()),100),[4,Re(n)]):[3,4]):[3,4];case 2:return i.sent(),[4,this._flush()];case 3:i.sent(),i.label=4;case 4:return this.dispatcher.on((function(e){if(e instanceof H){var t=e.statLog;r.put(t)}else e instanceof _t&&(r.enabledstate=e.enabled?lt.ENABLED:lt.DISABLED,r.isEnabled?r.queue.length>=r.limit&&r._flush():r.clear())})),[2]}}))}))},e.prototype.put=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.enabledstate===lt.DISABLED?[3,3]:(this.queue.push(e),[4,this._save()]);case 1:return t.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}}))}))},e}();e.LogLevel=void 0,(yt=e.LogLevel||(e.LogLevel={}))[yt.NONE=0]="NONE",yt[yt.VERBOSE=1]="VERBOSE",yt[yt.DEBUG=2]="DEBUG",yt[yt.INFO=3]="INFO",yt[yt.WARN=4]="WARN",yt[yt.ERROR=5]="ERROR";var bt,Ct,Tt,It,St=function(){function t(){this.level=e.LogLevel.WARN}return t.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.level<=e.LogLevel.VERBOSE&&console.log.apply(console,u(["[verbose]"],o(t),!1))},t.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.level<=e.LogLevel.DEBUG&&console.log.apply(console,u(["[debug]"],o(t),!1))},t.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.level<=e.LogLevel.INFO&&console.log.apply(console,u(["[info]"],o(t),!1))},t.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.level<=e.LogLevel.WARN&&console.warn.apply(console,u(["[warn]"],o(t),!1))},t.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.level<=e.LogLevel.ERROR&&console.error.apply(console,u(["[error]"],o(t),!1))},t}(),Nt={},wt=function(){function t(t,n){var r,i,s,a,o,u,c,l;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Nt[t]){Nt[t]=this;var d=null!==(r=n.options)&&void 0!==r?r:new I,p=this.sdkState={appId:n.appId,appVersion:null!==(i=n.appVersion)&&void 0!==i?i:"",appState:"foreground",userId:null,extensions:{},api:{host:null!==(s=n.apiHost)&&void 0!==s?s:"https://api-".concat(n.appId,".sendbird.com")},websocket:{host:null!==(a=n.websocketHost)&&void 0!==a?a:"wss://ws-".concat(n.appId,".sendbird.com"),pingerDisabled:!!n.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new Le,responseTimeout:d.websocketResponseTimeout}};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0};var f=this.logger=new St;this.logger.level=null!==(o=n.logLevel)&&void 0!==o?o:e.LogLevel.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new M({encryption:n.encryption,store:n.store,localCacheEnabled:null!==(u=n.localCacheEnabled)&&void 0!==u&&u}),this.debugMode=null!==(c=n.debugMode)&&void 0!==c&&c,this.maxSuperGroupChannelUnreadCount=h.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=d.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=d.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=d.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;var _=this.dispatcher=new L,v=new A;this.requestQueue=new de(t,{auth:v,sdkState:p,dispatcher:_,logger:f}),this.sessionManager=new xe({auth:v,sdkState:p,dispatcher:_,requestQueue:this.requestQueue,logger:f}),this.connectionManager=new mt(t,{sdkState:p,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:_,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableAutoReconnect:null!==(l=n.disableAutoReconnect)&&void 0!==l&&l,logger:f}),this.statLogCollector=new Et({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:_})}return Nt[t]}return t.of=function(e){if(Nt[e])return Nt[e];throw f.lostInstance},t}();e.PushTokenRegistrationState=void 0,(bt=e.PushTokenRegistrationState||(e.PushTokenRegistrationState={})).SUCCESS="success",bt.PENDING="pending",bt.ERROR="error",e.PushTriggerOption=void 0,(Ct=e.PushTriggerOption||(e.PushTriggerOption={})).DEFAULT="default",Ct.ALL="all",Ct.MENTION_ONLY="mention_only",Ct.OFF="off",e.PushTokenType=void 0,(Tt=e.PushTokenType||(e.PushTokenType={})).FCM="gcm",Tt.APNS="apns",Tt.UNKNOWN="unknown",e.PushTemplate=void 0,(It=e.PushTemplate||(e.PushTemplate={})).ALTERNATIVE="alternative",It.DEFAULT="default";var Mt,At=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger;t.onlineDetector;var o=t.cacheContext,u=void 0===o?null:o;this._iid=e,this._cacheContext=u,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=a},e}(),Ut=function(e){function t(t){var n=e.call(this)||this;if(n.method=d.POST,n.path="".concat(_e),n.params=D({file:t.file,channel_url:t.channelUrl}),t.thumbnailSizes)for(var r=0;r<t.thumbnailSizes.length;r++){var i=t.thumbnailSizes[r],s=i.maxWidth,a=i.maxHeight;n.params["thumbnail".concat(r+1)]="".concat(s,",").concat(a)}return n.requestId=t.requestId,n}return n(t,e),t}(x),Ot=function(e){function t(t,n){var r,i,s,a=this;return(a=e.call(this,t,n)||this).url=n.url,a.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,a.thumbnailSizes=null!==(i=n.thumbnails)&&void 0!==i?i:[],a.requireAuth=null!==(s=n.require_auth)&&void 0!==s&&s,a}return n(t,e),t}(F),Rt=function(e){function t(t,n){var r,i,s,a=this;return(a=e.call(this,t)||this).replyCount=0,a.mostRepliedUsers=null,a.lastRepliedAt=0,a.updatedAt=0,a.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,a.mostRepliedUsers=n.hasOwnProperty("most_replies")&&b("object",n.most_replies)?n.most_replies.map((function(e){return new ht(a._iid,e)})):[],a.lastRepliedAt=null!==(i=n.last_replied_at)&&void 0!==i?i:0,a.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,a}return n(t,e),t.payloadify=function(t){return t?D(r(r({},e.payloadify.call(this,t)),{reply_count:t.replyCount,most_replies:Array.isArray(t.mostRepliedUsers)?t.mostRepliedUsers.map((function(e){return ht.payloadify(e)})):[],last_replied_at:t.lastRepliedAt,updated_at:t.updatedAt})):null},t}(We);e.ReactionEventOperation=void 0,(Mt=e.ReactionEventOperation||(e.ReactionEventOperation={})).ADD="add",Mt.DELETE="delete";var Lt,kt,Dt=function(t){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var n=g("string",t.msg_id)?parseInt(t.msg_id):t.msg_id,r=t.user_id,i=t.operation?t.operation.toLowerCase():null,s=t.reaction,a=t.updated_at;n&&g("string",r)&&g("string",i)&&y(e.ReactionEventOperation,i)&&g("string",s)&&s&&g("number",a)&&(this.messageId=n,this.userId=r,this.key=s,this.operation=i,this.updatedAt=a)},Pt=function(){function t(e){var t,n,r,i=e.key,s=null!==(r=u([],o(e.user_ids),!1))&&void 0!==r?r:[],c=e.updated_at;g("string",i)&&i&&b("string",s)&&s.length>0&&g("number",c)&&(this.key=i,this.userIds=s,this.updatedAt=c);var l={};try{for(var h=a(this.userIds),d=h.next();!d.done;d=h.next()){l[d.value]=this.updatedAt}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}this._version=l}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),t.payloadify=function(e){return e?D({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},t.prototype.applyEvent=function(t){if(t.key===this.key&&this.updatedAt<=t.updatedAt){if(!this._version[t.userId]||this._version[t.userId]<=t.updatedAt){var n=this.userIds.indexOf(t.userId);switch(t.operation){case e.ReactionEventOperation.ADD:n<0&&this.userIds.push(t.userId);break;case e.ReactionEventOperation.DELETE:n>=0&&this.userIds.splice(n,1)}this._version[t.userId]=t.updatedAt}this.updatedAt=Math.max(this.updatedAt,t.updatedAt)}},t}(),xt=function(){function e(e){this.key=e.key,this.value=b("string",e.value)?u([],o(e.value),!1):[]}return e.payloadify=function(e){var t;return e?D({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null},e}(),Ft=function(){function e(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}return e.payloadify=function(e){var t,n;return e?D({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null},e}(),qt=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new Ft(e["og:image"]))}return e.payloadify=function(e){return e?D({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Ft.payloadify(e.defaultImage):null}):null},e}(),Gt=function(){function e(e){var t,n;this.name=null,this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return e.payloadify=function(e){return e?D({name:e.name,volume:e.volume}):null},e}();e.ScheduledStatus=void 0,(Lt=e.ScheduledStatus||(e.ScheduledStatus={})).PENDING="pending",Lt.SENT="sent",Lt.FAILED="failed",Lt.CANCELED="canceled",function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(kt||(kt={}));var Ht,Vt=function(t){switch(t){case e.MessageType.BASE:return"";case e.MessageType.USER:return"MESG";case e.MessageType.FILE:return"FILE";case e.MessageType.ADMIN:return"ADMM"}},Kt=function(t){function i(n,r){var i,s,a,o,u,c,l,h,d,p,f,_,v,m=this;(m=t.call(this,n)||this).channelUrl=null,m.channelType=e.ChannelType.BASE,m.messageId=0,m.parentMessageId=null,m.parentMessage=null,m.silent=!1,m.isOperatorMessage=!1,m.messageType=e.MessageType.BASE,m.data=null,m.customType=null,m.mentionType=null,m.mentionedUsers=[],m.mentionedUserIds=[],m.mentionedMessageTemplate=null,m.threadInfo=null,m.reactions=[],m.metaArrays=[],m.ogMetaData=null,m.appleCriticalAlertOptions=null,m.createdAt=0,m.updatedAt=0,m.scheduledInfo=null,m._scheduledStatus=null,m.messageId=null!==(s=null!==(i=r.msg_id)&&void 0!==i?i:r.message_id)&&void 0!==s?s:0,m.channelUrl=r.channel_url,m.channelType=y(e.ChannelType,r.channel_type)?r.channel_type:e.ChannelType.GROUP,r.channel&&(r.channel.channel_url&&(m.channelUrl=r.channel.channel_url),r.channel.channel_type&&(m.channelType=r.channel.channel_type)),m.parentMessageId=null!==(a="string"==typeof r.parent_message_id?parseInt(r.parent_message_id):r.parent_message_id)&&void 0!==a?a:0,m.data=null!==(o=r.data)&&void 0!==o?o:"",m.customType=null!==(u=r.custom_type)&&void 0!==u?u:"",m.mentionType=y(e.MentionType,r.mention_type)?r.mention_type:null;var g=r.mentioned_users;m.mentionedUsers=g?g.map((function(e){return new ht(m._iid,e)})):null;var E=r.mentioned_user_ids;m.mentionedUserIds=null!=E?E:null,m.mentionedMessageTemplate=null!==(c=r.mentioned_message_template)&&void 0!==c?c:"",m.threadInfo=r.thread_info?new Rt(m._iid,r.thread_info):null,m.reactions=r.reactions?r.reactions.map((function(e){return new Pt(e)})):[];for(var b=null!==(l=r.metaarray)&&void 0!==l?l:{},C=null!==(h=r.metaarray_key_order)&&void 0!==h?h:Object.keys(b).sort((function(e,t){return e.localeCompare(t)})),T=0;T<C.length;T++){var I=C[T];m.metaArrays.push(new xt({key:I,value:b[I]||[]}))}return r.sorted_metaarray&&(m.metaArrays=r.sorted_metaarray.map((function(e){return new xt(e)}))),m.ogMetaData=r.og_tag?new qt(r.og_tag):null,m.silent=null!==(d=r.silent)&&void 0!==d&&d,m.isOperatorMessage=null!==(p=r.is_op_msg)&&void 0!==p&&p,m.appleCriticalAlertOptions=r.apple_critical_alert_options?new Gt(r.apple_critical_alert_options):null,m.createdAt=null!==(_=null!==(f=r.created_at)&&void 0!==f?f:r.ts)&&void 0!==_?_:0,m.updatedAt=null!==(v=r.updated_at)&&void 0!==v?v:0,"number"==typeof r.scheduled_message_id&&"number"==typeof r.scheduled_at&&r.scheduled_status&&(m.scheduledInfo={scheduledMessageId:r.scheduled_message_id,scheduledAt:r.scheduled_at},m._scheduledStatus=r.scheduled_status),m}return n(i,t),i.payloadify=function(e){var n,i,s,a;return e?D(r(r({},t.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:Vt(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(n=e.mentionedUsers)||void 0===n?void 0:n.map((function(e){return ht.payloadify(e)})),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?Rt.payloadify(e.threadInfo):null,reactions:e.reactions.map((function(e){return Pt.payloadify(e)})),sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((function(e){return xt.payloadify(e)})),og_tag:qt.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:Gt.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(s=e.scheduledInfo)||void 0===s?void 0:s.scheduledMessageId,scheduled_at:null===(a=e.scheduledInfo)||void 0===a?void 0:a.scheduledAt,scheduled_status:e._scheduledStatus})):null},i.prototype.isIdentical=function(e){return this.messageId===e.messageId},i.prototype.isEqual=function(e){return m(this,e)},i.prototype.isUserMessage=function(){return this.messageType===e.MessageType.USER},i.prototype.isFileMessage=function(){return this.messageType===e.MessageType.FILE},i.prototype.isAdminMessage=function(){return this.messageType===e.MessageType.ADMIN},i.prototype.serialize=function(){return ot(this)},i.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},i.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},i.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new Pt(Pt.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},i.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1},i}(We),Qt=function(t){function i(n,r){var i=t.call(this,n,r)||this;return i.role=null,i.isBlockedByMe=!1,i.role=y(e.Role,r.role)?r.role:e.Role.NONE,r.hasOwnProperty("is_blocked_by_me")&&(i.isBlockedByMe=r.is_blocked_by_me),i}return n(i,t),i.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null},i}(ht),Bt=function(t){function i(n,r){var i,s,a,o,u=this;if((u=t.call(this,n,r)||this).sender=null,u.reqId="",u.replyToChannel=!1,u.sendingStatus=null,u.errorCode=0,u.sender=r.user?new Qt(u._iid,r.user):r.sender_id,u.reqId=null!==(s=null!==(i=r.req_id)&&void 0!==i?i:r.request_id)&&void 0!==s?s:"",u.replyToChannel=null!==(a=r.is_reply_to_channel)&&void 0!==a&&a,r.request_state&&y(e.SendingStatus,r.request_state)&&(u.sendingStatus=r.request_state),!u.sendingStatus)if(u.messageId>0)u.sendingStatus=e.SendingStatus.SUCCEEDED;else if(u.scheduledInfo)switch(u._scheduledStatus=r.scheduled_status,r.scheduled_status){case kt.SENT:case kt.IN_QUEUE:u.sendingStatus=e.SendingStatus.SUCCEEDED;break;case kt.PENDING:u.sendingStatus=e.SendingStatus.SCHEDULED;break;case kt.FAILED:case kt.REMOVED:u.sendingStatus=e.SendingStatus.FAILED;break;case kt.CANCELED:u.sendingStatus=e.SendingStatus.CANCELED}else u.sendingStatus=e.SendingStatus.PENDING;return u.errorCode=null!==(o=r.error_code)&&void 0!==o?o:0,u}return n(i,t),i.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{user:Qt.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null},Object.defineProperty(i.prototype,"isResendable",{get:function(){return this.sendingStatus===e.SendingStatus.FAILED&&((t=this.errorCode)>0&&_.indexOf(t)>=0);var t},enumerable:!1,configurable:!0}),i.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},i}(Kt),jt=function(){function e(e){var t,n;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(n=e.real_height)&&void 0!==n?n:e.height}return e.payloadify=function(e){return e?D({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(e.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),e}(),zt={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Wt=function(t){return g("number",t.prevResultSize)&&g("number",t.nextResultSize)&&g("boolean",t.isInclusive)&&g("boolean",t.reverse)&&g("string",t.messageTypeFilter)&&y(e.MessageTypeFilter,t.messageTypeFilter)&&b("string",t.customTypesFilter,!0)&&b("string",t.senderUserIdsFilter,!0)&&g("boolean",t.includeMetaArray)&&g("boolean",t.includeReactions)&&g("boolean",t.includeParentMessageInfo)},Yt=function(t){function a(n,i){var s,a,o,u,c=this;if((c=t.call(this,n,i)||this).message=null,c.translations={},c.message=null!==(s=i.message)&&void 0!==s?s:"",c.messageType=e.MessageType.ADMIN,c.translations=null!==(a=i.translations)&&void 0!==a?a:{},i.parent_message_info){var l=i.parent_message_info,h=r(r({},l),{message_id:c.parentMessageId,channel_url:c.channelUrl,channel_type:c.channelType,file:l.file,url:null===(o=l.file)||void 0===o?void 0:o.url,require_auth:null===(u=l.file)||void 0===u?void 0:u.require_auth});c.parentMessage=sn(n,h)}return c}return n(a,t),a.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:rn(e.parentMessage)})):null},a.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},zt),t),ct(this.messageId>0&&g("number",e)&&Wt(n)).throw(f.invalidParameters),[4,kn.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,i.sent()]}}))}))},a}(Kt),Jt=function(){function e(e){var t,n;this.type=null,this.vendor=null,this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.hasOwnProperty("detail")&&g("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return e.payloadify=function(e){return e?D({type:e.type,vendor:e.vendor,detail:e.detail}):null},e}();!function(e){e.OPEN="open",e.CLOSED="closed"}(Ht||(Ht={}));var Xt,Zt=function(e){switch(e){case Ht.OPEN:return Ht.OPEN;case Ht.CLOSED:return Ht.CLOSED}},$t=function(e){return!e||e.text&&g("string",e.text)},en=function(e){function t(t,n){var r,i,s,a,o,u,c,l=this;return(l=e.call(this,t)||this).pollId=0,l.id=0,l.text=null,l.voteCount=0,l.createdBy=null,l.createdAt=0,l.updatedAt=0,l._lastVotedAt=0,l.pollId=null!==(r=n.poll_id)&&void 0!==r?r:0,l.id=null!==(i=n.id)&&void 0!==i?i:0,l.text=null!==(s=n.text)&&void 0!==s?s:null,l.voteCount=null!==(a=n.vote_count)&&void 0!==a?a:0,l.createdBy=null!==(o=n.created_by)&&void 0!==o?o:null,l.createdAt=null!==(u=n.created_at)&&void 0!==u?u:0,l.updatedAt=null!==(c=n.updated_at)&&void 0!==c?c:0,l}return n(t,e),t.payloadify=function(t){return t?D(r(r({},e.payloadify.call(this,t)),{vote_count:t.voteCount,poll_id:t.pollId,text:t.text,created_at:t.createdAt,id:t.id,created_by:t.createdBy,updated_at:t.updatedAt})):null},t}(We),tn=function(e){function t(t,n){var r,i,s,a,o,u,c,l,h,d,p,f,_,v=this;return(v=e.call(this,t)||this).id=0,v.title=null,v.createdAt=0,v.updatedAt=0,v.closeAt=-1,v.status=Ht.CLOSED,v.messageId=0,v.data=null,v.voterCount=-1,v.options=[],v.createdBy=null,v.allowUserSuggestion=!1,v.allowMultipleVotes=!1,v.votedPollOptionIds=[],v.id=null!==(r=n.id)&&void 0!==r?r:0,v.title=null!==(i=n.title)&&void 0!==i?i:null,v.createdAt=null!==(s=n.created_at)&&void 0!==s?s:0,v.updatedAt=null!==(a=n.updated_at)&&void 0!==a?a:0,v.closeAt=null!==(o=n.close_at)&&void 0!==o?o:-1,v.status=null!==(u=Zt(n.status))&&void 0!==u?u:Ht.CLOSED,v.messageId=null!==(c=n.message_id)&&void 0!==c?c:0,v.data=null!==(l=n.data)&&void 0!==l?l:null,v.voterCount=null!==(h=n.voter_count)&&void 0!==h?h:-1,v.options=n.options?n.options.map((function(e){return new en(v._iid,e)})):[],v.createdBy=null!==(d=n.created_by)&&void 0!==d?d:null,v.allowUserSuggestion=null!==(p=n.allow_user_suggestion)&&void 0!==p&&p,v.allowMultipleVotes=null!==(f=n.allow_multiple_votes)&&void 0!==f&&f,v.votedPollOptionIds=null!==(_=n.voted_option_ids)&&void 0!==_?_:[],v}return n(t,e),t.prototype._applyPollUpdatePayload=function(e){var t,n,r,i,s,a,o,u,c=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(r=e.close_at)&&void 0!==r?r:this.closeAt,this.status=null!==(i=Zt(e.status))&&void 0!==i?i:this.status,this.data=null!==(s=e.data)&&void 0!==s?s:this.data,this.voterCount=null!==(a=e.voter_count)&&void 0!==a?a:this.voterCount,this.options=e.options?e.options.map((function(e){return new en(c._iid,e)})):this.options,this.allowUserSuggestion=null!==(o=e.allow_user_suggestion)&&void 0!==o?o:this.allowUserSuggestion,this.allowMultipleVotes=null!==(u=e.allow_multiple_votes)&&void 0!==u?u:this.allowMultipleVotes},t.payloadify=function(t){return t?D(r(r({},e.payloadify.call(this,t)),{id:t.id,title:t.title,created_at:t.createdAt,updated_at:t.updatedAt,close_at:t.closeAt,status:t.status,message_id:t.messageId,data:t.data,voter_count:t.voterCount,options:t.options.map((function(e){return en.payloadify(e)})),created_by:t.createdBy,allow_user_suggestion:t.allowUserSuggestion,allow_multiple_votes:t.allowMultipleVotes,voted_option_ids:t.votedPollOptionIds})):null},t.prototype.applyPollUpdateEvent=function(e){var t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)},t.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var t=this.options,n=t.map((function(e){return e.id})),r=e._payload,i=Math.floor(r.ts/1e3);return r.updated_vote_counts.forEach((function(e){var r=n.indexOf(e.option_id);if(r>-1){var s=t[r];i>s._lastVotedAt&&(s.voteCount=e.vote_count,s._lastVotedAt=i)}})),r.req_id&&r.voted_option_ids&&(this.votedPollOptionIds=r.voted_option_ids),!0},t}(We),nn=function(t){function o(n,i){var s,o,u,c,l,h,d,p=this;if((p=t.call(this,n,i)||this).message="",p.messageParams=null,p.translations={},p.translationTargetLanguages=[],p.messageSurvivalSeconds=-1,p.plugins=[],p._poll=null,p.message=i.message,p.messageType=e.MessageType.USER,p.translations=null!==(u=i.translations)&&void 0!==u?u:{},p.translationTargetLanguages=null!==(c=i.target_langs)&&void 0!==c?c:[],0===Object.keys(p.translations).length&&p.translationTargetLanguages.length>0)try{for(var f=a(p.translationTargetLanguages),_=f.next();!_.done;_=f.next()){var v=_.value;p.translations[v]=""}}catch(e){s={error:e}}finally{try{_&&!_.done&&(o=f.return)&&o.call(f)}finally{if(s)throw s.error}}if(p.messageSurvivalSeconds=null!==(l=i.message_survival_seconds)&&void 0!==l?l:-1,p.plugins=i.plugins?i.plugins.map((function(e){return new Jt(e)})):[],p._poll=i.poll?new tn(p._iid,i.poll):null,i.parent_message_info){var m=i.parent_message_info,g=r(r({},m),{created_at:m.ts,message_id:p.parentMessageId,channel_url:p.channelUrl,channel_type:p.channelType,file:m.file,url:null===(h=m.file)||void 0===h?void 0:h.url,require_auth:null===(d=m.file)||void 0===d?void 0:d.require_auth});p.parentMessage=sn(n,D(g))}return p}return n(o,t),o.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((function(e){return Jt.payloadify(e)})),poll:tn.payloadify(e._poll),parent_message_info:rn(e.parentMessage)})):null},o.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},zt),t),ct(this.messageId>0&&g("number",e)&&Wt(n)).throw(f.invalidParameters),[4,kn.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,i.sent()]}}))}))},o.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(o.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),o}(Bt),rn=function(t){if(t)switch(t.messageType){case e.MessageType.USER:return nn.payloadify(t);case e.MessageType.FILE:return an.payloadify(t);case e.MessageType.ADMIN:return Yt.payloadify(t)}return null},sn=function(e,t){switch(t.type){case"MESG":return new nn(e,t);case"FILE":return new an(e,t);case"ADMM":case"BRDM":return new Yt(e,t)}return null},an=function(t){function a(n,i){var s,a,o,u,c,l,h,d,p,f,_,v,m,g,y,E=this;(E=t.call(this,n,i)||this).messageParams=null,E.plainUrl="",E.requireAuth=!1,E.name=null,E.size=0,E.type=null,E.thumbnails=[],E.messageSurvivalSeconds=-1,E.messageType=e.MessageType.FILE;var b=null!==(s=i.file)&&void 0!==s?s:null;if(E.plainUrl=(null!==(o=null!==(a=null==b?void 0:b.url)&&void 0!==a?a:i.url)&&void 0!==o?o:"").split("?auth=")[0],E.name=null!==(c=null!==(u=null==b?void 0:b.name)&&void 0!==u?u:i.name)&&void 0!==c?c:"File",E.size=null!==(h=null!==(l=null==b?void 0:b.size)&&void 0!==l?l:i.size)&&void 0!==h?h:0,E.data=null!==(p=null!==(d=null==b?void 0:b.data)&&void 0!==d?d:i.custom)&&void 0!==p?p:"",E.type=b?null!==(f=b.type)&&void 0!==f?f:"":null!==(_=i.type)&&void 0!==_?_:"",E.requireAuth=null!==(v=i.require_auth)&&void 0!==v&&v,E.thumbnails=i.thumbnails?i.thumbnails.map((function(e){return new jt(r(r({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(E.requireAuth?"?auth=".concat(je(E._iid)):"")}))})):[],E.messageSurvivalSeconds=null!==(m=i.message_survival_seconds)&&void 0!==m?m:-1,i.parent_message_info){var C=i.parent_message_info,T=r(r({},C),{message_id:E.parentMessageId,channel_url:E.channelUrl,channel_type:E.channelType,file:C.file,url:null===(g=C.file)||void 0===g?void 0:g.url,require_auth:null===(y=C.file)||void 0===y?void 0:y.require_auth});E.parentMessage=sn(n,T)}return E}return n(a,t),a.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:rn(e.parentMessage)})):null},Object.defineProperty(a.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(je(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),a.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},zt),t),ct(this.messageId>0&&g("number",e)&&Wt(n)).throw(f.invalidParameters),[4,kn.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,i.sent()]}}))}))},a}(Bt),on=function(t){function r(n){var r,i,s,a=[];return n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?a=n.mentionedUserIds:n.mentionedUsers&&(a=n.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"FILE",ackRequired:!0,payload:D({channel_url:n.channelUrl,url:n.url,name:null!==(r=n.fileName)&&void 0!==r?r:"",type:null!==(i=n.mimeType)&&void 0!==i?i:"",size:null!==(s=n.fileSize)&&void 0!==s?s:0,custom:n.data,custom_type:n.customType,thumbnails:n.thumbnailSizes,require_auth:n.requireAuth,metaarray:n.metaArrays,mention_type:n.mentionType,mentioned_user_ids:a,push_option:n.pushNotificationDeliveryOption&&n.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?n.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:n.appleCriticalAlertOptions,silent:n.silent,reply_to_channel:n.isReplyToChannel,parent_message_id:n.parentMessageId>0?n.parentMessageId:null,req_id:n.reqId})})||this}return n(r,t),r}(z),un=function(t){function r(n){var r,i=this;i=t.call(this)||this;var s=[];return n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?s=n.mentionedUserIds:n.mentionedUsers&&(s=n.mentionedUsers.map((function(e){return e.userId})))),i.method=d.POST,i.path="".concat(Je(n.channelType),"/").concat(encodeURIComponent(n.channelUrl),"/messages"),i.params=D({message_type:e.MessageType.FILE,user_id:n.userId,url:n.fileUrl,mention_type:n.mentionType,mentioned_user_ids:s,file_name:n.fileName,file_size:n.fileSize,file_type:n.mimeType,data:n.data,custom_type:n.customType,thumbnails:n.thumbnailSizes.map((function(e){return jt.payloadify(e)})),require_auth:n.requireAuth,sorted_metaarray:null===(r=n.metaArrays)||void 0===r?void 0:r.map((function(e){return xt.payloadify(e)})),push_option:n.pushNotificationDeliveryOption,parent_message_id:n.parentMessageId>0?n.parentMessageId:null,apple_critical_alert_options:Gt.payloadify(n.appleCriticalAlertOptions),reply_to_channel:n.isReplyToChannel,req_id:n.reqId}),i}return n(r,t),r}(x),cn=function(e){function t(t,n,r){var i,s,a,o=this;(o=e.call(this,t,"FILE",r)||this).message=new an(t,r);var u=wt.of(t).sdkState;return o.isMentioned=Ze(o.message.mentionType,null!==(i=o.message.mentionedUserIds)&&void 0!==i?i:null===(s=o.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(a=r.force_update_last_message)&&void 0!==a&&a,o}return n(t,e),t}(j),ln=function(e){function t(t,n){var r,i,s=this;(s=e.call(this,t,n)||this).message=new an(t,n);var a=wt.of(t).sdkState;return s.isMentioned=Ze(s.message.mentionType,null!==(r=s.message.mentionedUserIds)&&void 0!==r?r:s.message.mentionedUsers.map((function(e){return e.userId})),a.userId),s.forceUpdateLastMessage=null!==(i=n.force_update_last_message)&&void 0!==i&&i,s}return n(t,e),t}(F);!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(Xt||(Xt={}));var hn,dn=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext,o=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=a,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof he&&(o._connectionState=e.stateType)})),this._onlineDetector=s}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===X.CONNECTED||this._connectionState===X.CONNECTING||this._connectionState===X.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return i(this,void 0,void 0,(function(){var n,i;return s(this,(function(s){switch(s.label){case 0:return this._shouldSendThroughWebSocket?(n=new on(r(r({channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(n)]):[3,2];case 1:return i=s.sent(),[2,i.as(cn).message];case 2:return n=new un(r(r({channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,userId:this._sdkState.userId,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(n)];case 3:return i=s.sent(),[2,i.as(ln).message]}}))}))},e.prototype._resolveMessageQueue=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,l,h,d,p,_,v;return s(this,(function(s){switch(s.label){case 0:if(!(t=this._queueMap.get(e.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,s.label=1;case 1:s.trys.push([1,15,16,17]),i=a(t.messageQueue),o=i.next(),s.label=2;case 2:if(o.done)return[3,14];switch(u=o.value,u.state){case Xt.PENDING:case Xt.UPLOADING:return[3,3];case Xt.UPLOADED:return[3,4];case Xt.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(u),[3,13];case 4:if(!r)return[3,10];s.label=5;case 5:return s.trys.push([5,8,,9]),u.state=Xt.SENDING,[4,this._sendFileMessage(e,u)];case 6:return l=s.sent(),u.deferred.resolve(l),[4,Re(100)];case 7:return s.sent(),[3,9];case 8:return h=s.sent(),u.deferred.reject(h),[3,9];case 9:return[3,11];case 10:n.push(u),s.label=11;case 11:return[3,13];case 12:return u.deferred.reject(u.error.code===c.REQUEST_CANCELED?f.fileUploadCanceled:u.error),[3,13];case 13:return o=i.next(),[3,2];case 14:return[3,17];case 15:return d=s.sent(),_={error:d},[3,17];case 16:try{o&&!o.done&&(v=i.return)&&v.call(i)}finally{if(_)throw _.error}return[7];case 17:return p=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,p?[4,this._resolveMessageQueue(e)]:[3,19];case 18:s.sent(),s.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,s.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,l,h,d,p,_,v,m;return s(this,(function(s){switch(s.label){case 0:return t=this._queueMap.get(e.url),(n=t.messageQueue.find((function(e){return e.state===Xt.PENDING})))?T(n.params.file)?t.uploadQueue.length<6?(n.state=Xt.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!s.sent())return[3,8];s.label=2;case 2:return s.trys.push([2,4,5,7]),r=new Ut({file:n.params.file,channelUrl:e.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),a=i.as(Ot),o=a.url,u=a.fileSize,l=void 0===u?n.params.fileSize:u,h=a.thumbnailSizes,d=void 0===h?n.params.thumbnailSizes:h,p=a.requireAuth,_=void 0!==p&&p,n.params.fileUrl=o,n.params.fileSize=l,n.params.thumbnailSizes=d,n.params.requireAuth=_,n.requireAuth=_,n.state=Xt.UPLOADED,[3,7];case 4:return(v=s.sent()).code===c.REQUEST_FAILED?n.error=new f({code:c.NETWORK_ERROR,message:"Failed to upload a file."}):n.error=v,n.state=Xt.FAILED,[3,7];case 5:return(m=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(m,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 6:return s.sent(),[7];case 7:return[3,10];case 8:return n.state=Xt.FAILED,n.error=f.connectionRequired,(m=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(m,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=Xt.UPLOADED,[4,this._resolveMessageQueue(e)];case 12:s.sent(),s.label=13;case 13:return[2]}}))}))},e.prototype.request=function(e,t,n){var r,a,o;return i(this,void 0,void 0,(function(){var i;return s(this,(function(s){return i=new ee,T(n.file)&&(n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(a=n.mimeType)&&void 0!==a?a:n.file.type,n.fileSize=null!==(o=n.fileSize)&&void 0!==o?o:n.file.size),this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(e.url).messageQueue.push({requestId:t,params:n,state:Xt.PENDING,deferred:i,requireAuth:n.requireAuth}),this._uploadNextPendingItem(e),[2,i.promise]}))}))},e.prototype.cancel=function(e,t){var n,r;void 0===t&&(t=null);var i=this._queueMap.get(e.url);if(i){var s=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:u([],o(i.messageQueue),!1);try{for(var c=a(s),l=c.next();!l.done;l=c.next()){var h=l.value;if(h)switch(h.state){case Xt.PENDING:h.state=Xt.FAILED,h.error=f.requestCanceled,this._resolveMessageQueue(e);break;case Xt.UPLOADING:this._requestQueue.cancel(h.requestId)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},e}(),pn={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:e.ReplyType.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},fn=function(t){return g("number",t.prevResultSize)&&g("number",t.nextResultSize)&&g("boolean",t.isInclusive)&&g("boolean",t.reverse)&&g("string",t.messageTypeFilter)&&y(e.MessageTypeFilter,t.messageTypeFilter)&&b("string",t.customTypesFilter,!0)&&b("string",t.senderUserIdsFilter,!0)&&y(e.ReplyType,t.replyType)&&g("boolean",t.includeMetaArray)&&g("boolean",t.includeReactions)&&g("boolean",t.includeParentMessageInfo)&&g("boolean",t.includeThreadInfo)&&g("boolean",t.showSubchannelMessagesOnly)},_n={replyType:e.ReplyType.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},vn=function(t){return y(e.ReplyType,t.replyType)&&g("boolean",t.includeReactions)&&g("boolean",t.includeMetaArray)&&g("boolean",t.includeParentMessageInfo)&&g("boolean",t.includeThreadInfo)};e.MessageEventSource=void 0,(hn=e.MessageEventSource||(e.MessageEventSource={})).UNKNOWN="UNKNOWN",hn.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",hn.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",hn.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",hn.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",hn.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",hn.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",hn.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",hn.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",hn.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",hn.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",hn.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",hn.REQUEST_MESSAGE="REQUEST_MESSAGE",hn.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",hn.EVENT_POLL_VOTED="EVENT_POLL_VOTED",hn.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",hn.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",hn.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",hn.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",hn.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",hn.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",hn.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",hn.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",hn.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",hn.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",hn.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";var mn,gn=function(t){return t.startsWith("EVENT_")||t===e.MessageEventSource.SYNC_MESSAGE_FILL||t===e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS||t===e.MessageEventSource.SYNC_POLL_CHANGELOGS},yn=function(e){function t(t){var n=t.messages,r=t.source,i=e.call(this)||this;return i.messages=n,i.source=r,i}return n(t,e),t}(k),En=function(e){function t(t){var n=t.messageIds,r=t.source,i=e.call(this)||this;return i.messageIds=n,i.source=r,i}return n(t,e),t}(k),bn=function(e){function t(t){var n=t.reqId,r=t.source,i=e.call(this)||this;return i.reqId=n,i.source=r,i}return n(t,e),t}(k),Cn=function(e){function t(t){var n=t.polls,r=t.source,i=e.call(this)||this;return i.polls=n,i.source=r,i}return n(t,e),t}(k),Tn=function(e){function t(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=n,i.source=r,i}return n(t,e),t}(k),In=function(e){function t(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=null,i.source=null,i.event=n,i.source=r,i}return n(t,e),t}(k),Sn=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,s=t.includeMetaArray,a=t.includeReactions,o=t.includeThreadInfo,u=t.includeParentMessageInfo,c=e.call(this)||this;return c.method=d.GET,c.path="".concat(Je(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i)),c.params={is_sdk:!0,with_sorted_meta_array:s,include_reactions:a,include_thread_info:o,include_parent_message_info:u,include_poll_details:!0},c}return n(t,e),t}(x),Nn=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.message=n?sn(t,r({},n)):null,i}return n(t,e),t}(F),wn=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=void 0===i?null:i,a=t.token,o=void 0===a?null:a,u=t.prevResultSize,c=t.nextResultSize,l=t.isInclusive,h=t.reverse,p=t.messageTypeFilter,f=t.customTypesFilter,_=t.senderUserIdsFilter,v=t.replyType,m=t.includeMetaArray,g=t.includeReactions,y=t.parentMessageId,E=t.includeThreadInfo,b=t.includeParentMessageInfo,C=t.showSubchannelMessagesOnly,T=e.call(this)||this;return T.method=d.GET,T.path="".concat(Je(n),"/").concat(encodeURIComponent(r),"/messages"),T.params=D({is_sdk:!0,prev_limit:u,next_limit:c,include:l,reverse:h,message_ts:s,message_id:o,message_type:null!=p?p:null,custom_types:f,sender_ids:_,include_reply_type:v,with_sorted_meta_array:m,include_reactions:g,parent_message_id:y,include_thread_info:E,include_parent_message_info:b,show_subchannel_message_only:C,include_poll_details:!0}),T}return n(t,e),t}(x),Mn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.messages=n.messages.map((function(e){return sn(t,e)})),r}return n(t,e),t}(F),An=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=t.token,a=t.replyType,o=t.includeMetaArray,u=t.includeReactions,c=t.includeThreadInfo,l=t.includeParentMessageInfo,h=e.call(this)||this;return h.method=d.GET,h.path="".concat(Je(n),"/").concat(encodeURIComponent(r),"/messages/changelogs"),h.params={change_ts:i,token:s,with_sorted_meta_array:o,include_reactions:u,include_thread_info:c,include_reply_type:a,include_parent_message_info:l,include_poll_details:!0},h}return n(t,e),t}(x),Un=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedMessages=n.updated.map((function(e){return sn(t,e)})),r.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r}return n(t,e),t}(F),On=function(e){function t(t){var n=t.channelUrl,r=t.scheduledMessageId,i=e.call(this)||this;return i.method=d.GET,i.path="".concat(ve,"/").concat(encodeURIComponent(n),"/scheduled_messages/").concat(encodeURIComponent(r)),i.params={},i}return n(t,e),t}(x),Rn=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.message=n?sn(t,r({},n)):null,i}return n(t,e),t}(F),Ln={},kn=function(){function t(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._onlineDetector=s,this._cacheContext=a,this.fileMessageQueue=new dn(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:a}),Ln[e]=this}return t.of=function(e){return Ln[e]},t.prototype.buildMessageFromSerializedData=function(t){var n=ut(t);switch(n.messageType){case e.MessageType.USER:return new nn(this._iid,nn.payloadify(n));case e.MessageType.FILE:return new an(this._iid,an.payloadify(n));case e.MessageType.ADMIN:return new Yt(this._iid,Yt.payloadify(n))}return null},t.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return D({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId})},t.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return D({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth})},t.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return r(r({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},t.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return r(r({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},t.prototype.buildSenderFromSerializedData=function(e){var t=ut(e);return new Qt(this._iid,Qt.payloadify(t))},t.prototype.getMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=new Sn(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Nn).message]}}))}))},t.prototype.getScheduledMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=new On(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Rn).message]}}))}))},t.prototype.getMessagesByMessageId=function(t,n,a,o,u){return void 0===u&&(u=e.MessageEventSource.REQUEST_MESSAGE),i(this,void 0,void 0,(function(){var e,i,c;return s(this,(function(s){switch(s.label){case 0:return e=new wn(r(r({channelType:n,channelUrl:t,token:String(a)},pn),o)),[4,this._requestQueue.send(e)];case 1:return i=s.sent(),c=i.as(Mn).messages,this._dispatcher.dispatch(new yn({messages:c,source:u})),[2,c]}}))}))},t.prototype.getMessagesByTimestamp=function(t,n,a,o,u){return void 0===u&&(u=e.MessageEventSource.REQUEST_MESSAGE),i(this,void 0,void 0,(function(){var e,i,c;return s(this,(function(s){switch(s.label){case 0:return e=new wn(r(r({channelType:n,channelUrl:t,timestamp:a},pn),o)),[4,this._requestQueue.send(e)];case 1:return i=s.sent(),c=i.as(Mn).messages,this._dispatcher.dispatch(new yn({messages:c,source:u})),[2,c]}}))}))},t.prototype.getThreadedMessagesByTimestamp=function(t,n,a,o){return void 0===o&&(o=e.MessageEventSource.REQUEST_THREADED_MESSAGE),i(this,void 0,void 0,(function(){var i,u,c,l;return s(this,(function(s){switch(s.label){case 0:return i=new wn(r(r(r({channelUrl:t.channelUrl,channelType:t.channelType,timestamp:n},zt),a),{replyType:e.ReplyType.ALL,parentMessageId:t.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(i)];case 1:return u=s.sent(),c=u.as(Mn).messages,(l=c.slice(1)).forEach((function(e){e.parentMessage=t})),this._dispatcher.dispatch(new yn({messages:l,source:o})),[2,{parentMessage:c[0],threadedMessages:l}]}}))}))},t.prototype.getMessageChangelogs=function(t,n,a,o,u){return void 0===u&&(u=e.MessageEventSource.REQUEST_MESSAGE_CHANGELOGS),i(this,void 0,void 0,(function(){var e,i,c,l,h,d,p,f;return s(this,(function(s){switch(s.label){case 0:return e=new An(D(r(r({channelType:n,channelUrl:t,timestamp:"number"==typeof a?a:null,token:"string"==typeof a?a:null},_n),o))),[4,this._requestQueue.send(e)];case 1:return i=s.sent(),c=i.as(Un),l=c.updatedMessages,h=c.deletedMessagesInfo,d=c.hasMore,p=c.nextToken,f=h.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new yn({messages:l,source:u})),f.length>0&&this._dispatcher.dispatch(new En({messageIds:f,source:u})),[2,{updatedMessages:l,deletedMessageIds:f,hasMore:d,token:p}]}}))}))},t}(),Dn=function(){function t(){this._onPending=J,this._onFailed=J,this._onSucceeded=J}return t.prototype._trigger=function(t,n){switch(n.sendingStatus){case e.SendingStatus.PENDING:this._onPending(n);break;case e.SendingStatus.FAILED:case e.SendingStatus.CANCELED:this._onFailed(t,n.scheduledInfo?null:n);break;case e.SendingStatus.SCHEDULED:case e.SendingStatus.SUCCEEDED:this._onSucceeded(n)}},t.prototype.onPending=function(e){return this._onPending=e,this},t.prototype.onFailed=function(e){return this._onFailed=e,this},t.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},t}(),Pn=function(e){function t(t,n){var r=e.call(this,t)||this;r.threadInfo=null,r.targetMessageId=0,r.channelUrl=null,r.channelType=null;var i=n.thread_info,s=n.root_message_id,a=n.channel_url,o=n.channel_type;return i&&g("object",i)&&g("number",s)&&g("string",a)&&g("string",o)&&(r.threadInfo=new Rt(t,i),r.targetMessageId=s,r.channelUrl=a,r.channelType=o),r}return n(t,e),t}(We),xn={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},Fn=function(){function e(e,t){var n;this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return g("number",this.limit)&&this.limit>0},e}(),qn=function(e){function t(t){var n=t.channelCustomType,r=t.keyword,i=t.limit,s=t.reverse,a=t.exactMatch,o=t.channelUrl,u=t.order,c=t.messageTimestampFrom,l=t.messageTimestampTo,h=t.advancedQuery,p=t.targetFields,f=t.nextToken,_=e.call(this)||this;return _.method=d.GET,_.path="".concat(Ee,"/messages"),_.params={custom_type:n,query:r,limit:i,reverse:s,exact_match:a,channel_url:o,message_ts_from:c,message_ts_to:l,sort_field:u,advanced_query:h,target_fields:p,after:f},_}return n(t,e),t}(x),Gn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.messages=n.results.map((function(e){return sn(t,e)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r.totalCount=n.total_count,r}return n(t,e),t}(F);e.MessageSearchOrder=void 0,(mn=e.MessageSearchOrder||(e.MessageSearchOrder={})).SCORE="score",mn.TIMESTAMP="ts";var Hn,Vn,Kn,Qn=function(t){function a(n,r){var i,s,a,o,u,c,l,h,d,p=this;return(p=t.call(this,n,r)||this).keyword="",p.reverse=!1,p.exactMatch=!1,p.channelUrl="",p.channelCustomType="",p.messageTimestampFrom=null,p.messageTimestampTo=null,p.order=e.MessageSearchOrder.SCORE,p.advancedQuery=!1,p.targetFields=null,p._nextToken="",p.totalCount=-1,p.keyword=r.keyword,p.reverse=null!==(i=r.reverse)&&void 0!==i&&i,p.exactMatch=null!==(s=r.exactMatch)&&void 0!==s&&s,p.channelUrl=null!==(a=r.channelUrl)&&void 0!==a?a:"",p.channelCustomType=null!==(o=r.channelCustomType)&&void 0!==o?o:"",p.messageTimestampFrom=null!==(u=r.messageTimestampFrom)&&void 0!==u?u:null,p.messageTimestampTo=null!==(c=r.messageTimestampTo)&&void 0!==c?c:null,p.order=null!==(l=r.order)&&void 0!==l?l:e.MessageSearchOrder.SCORE,p.advancedQuery=null!==(h=r.advancedQuery)&&void 0!==h&&h,p.targetFields=null!==(d=r.targetFields)&&void 0!==d?d:null,p}return n(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&g("string",this.keyword)&&this.keyword.length>0&&g("boolean",this.reverse)&&g("boolean",this.exactMatch)&&g("string",this.channelUrl)&&g("string",this.channelCustomType)&&(g("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(g("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&y(e.MessageSearchOrder,this.order)&&g("boolean",this.advancedQuery)&&b("string",this.targetFields,!0)},a.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new qn(r(r({},this),{nextToken:this._nextToken?this._nextToken:null})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(Gn),a=i.messages,o=i.hasNext,u=i.nextToken,c=i.totalCount,this._nextToken=u,this._hasNext=o,this._isLoading=!1,this.totalCount=c,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},a}(Fn),Bn=function(t){function r(e,n,r,i){var s=t.call(this,e,i)||this;return s.channelUrl=n,s.channelType=r,s}return n(r,t),r.prototype._validate=function(){return t.prototype._validate.call(this)&&g("string",this.channelUrl)&&y(e.ChannelType,this.channelType)},r}(Fn),jn=function(t){function r(n,r,i,s){var a,o,u,c,l,h,d,p,f,_,v=this;return(v=t.call(this,n,r,i,s)||this).reverse=!1,v.messageTypeFilter=e.MessageTypeFilter.ALL,v.customTypesFilter=null,v.senderUserIdsFilter=null,v.replyType=e.ReplyType.NONE,v.includeMetaArray=!1,v.includeReactions=!1,v.includeParentMessageInfo=!1,v.includeThreadInfo=!1,v.showSubchannelMessagesOnly=!1,v._edge=Number.MAX_SAFE_INTEGER,v.reverse=null!==(a=s.reverse)&&void 0!==a&&a,v.messageTypeFilter=null!==(o=s.messageTypeFilter)&&void 0!==o?o:e.MessageTypeFilter.ALL,v.customTypesFilter=null!==(u=s.customTypesFilter)&&void 0!==u?u:null,v.senderUserIdsFilter=null!==(c=s.senderUserIdsFilter)&&void 0!==c?c:null,v.replyType=null!==(l=s.replyType)&&void 0!==l?l:e.ReplyType.NONE,v.includeMetaArray=null!==(h=s.includeMetaArray)&&void 0!==h&&h,v.includeReactions=null!==(d=s.includeReactions)&&void 0!==d&&d,v.includeParentMessageInfo=null!==(p=s.includeParentMessageInfo)&&void 0!==p&&p,v.includeThreadInfo=null!==(f=s.includeThreadInfo)&&void 0!==f&&f,v.showSubchannelMessagesOnly=null!==(_=s.showSubchannelMessagesOnly)&&void 0!==_&&_,v}return n(r,t),r.prototype._validate=function(){return t.prototype._validate.call(this)&&g("boolean",this.reverse)&&y(e.MessageTypeFilter,this.messageTypeFilter)&&y(e.ReplyType,this.replyType)&&b("string",this.customTypesFilter,!0)&&b("string",this.senderUserIdsFilter,!0)&&g("boolean",this.includeMetaArray)&&g("boolean",this.includeReactions)&&g("boolean",this.includeParentMessageInfo)&&g("boolean",this.includeThreadInfo)&&g("boolean",this.showSubchannelMessagesOnly)},r.prototype.load=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,kn.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,u([Number.MAX_SAFE_INTEGER],o(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},r}(Bn),zn={channelUrl:null,scheduledMessageId:0},Wn=function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="message",e}return n(a,t),a.prototype.init=function(e,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;t.prototype.init.call(this,e,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new kn(e,{sdkState:r,dispatcher:i,requestQueue:a,onlineDetector:u,cacheContext:c})},a.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},a.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},a.prototype.getMessage=function(t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){return n=r(r({},xn),t),ct(function(t){return g("string",t.channelUrl)&&g("string",t.channelType)&&y(e.ChannelType,t.channelType)&&g("number",t.messageId)&&g("boolean",t.includeMetaArray)&&g("boolean",t.includeParentMessageInfo)&&g("boolean",t.includeThreadInfo)}(n)).throw(f.invalidParameters),[2,this._manager.getMessage(n)]}))}))},a.prototype.getScheduledMessage=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=r(r({},zn),e),ct(function(e){return g("string",e.channelUrl)&&g("number",e.scheduledMessageId)}(t)).throw(f.invalidParameters),[2,this._manager.getScheduledMessage(t)]}))}))},a}(At),Yn=function(e){function t(t){var n=t.title,r=t.optionTexts,i=t.data,s=t.allowUserSuggestion,a=t.allowMultipleVotes,o=t.closeAt,u=e.call(this)||this;return u.method=d.POST,u.path=Ie,u.params={title:n,options:r,data:i,allow_user_suggestion:s,allow_multiple_votes:a,close_at:o},u}return n(t,e),t}(x),Jn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new tn(t,n),r}return n(t,e),t}(F),Xn=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,s=e.call(this)||this;return s.method=d.GET,s.path="".concat(Ie,"/").concat(encodeURIComponent(i)),s.params={channel_url:n,channel_type:r},s}return n(t,e),t}(x),Zn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new tn(t,n),r}return n(t,e),t}(F),$n=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,s=t.pollOptionId,a=e.call(this)||this;return a.method=d.GET,a.path="".concat(Ie,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s)),a.params={channel_url:n,channel_type:r},a}return n(t,e),t}(x),er=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pollOption=new en(t,n),r}return n(t,e),t}(F),tr=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=t.token,a=e.call(this)||this;return a.method=d.GET,a.path="".concat(Je(n),"/").concat(encodeURIComponent(r),"/polls/changelogs"),a.params=D({change_ts:i,token:s}),a}return n(t,e),t}(x),nr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedPolls=n.updated.map((function(e){return function(e,t){return t?new tn(e,t):null}(t,e)})),r.deletedPollIds=n.deleted.map((function(e){return e})),r.hasMore=n.has_more,r.nextToken=n.next,r}return n(t,e),t}(F),rr={title:null,optionTexts:null,data:null,allowUserSuggestion:null,allowMultipleVotes:null,closeAt:-1},ir=function(e){return g("string",e.title)&&(t=e.optionTexts,b("string",t)&&t.every((function(e){return""!==e.trim()})))&&$t(e.data)&&g("boolean",e.allowUserSuggestion,!0)&&g("boolean",e.allowMultipleVotes,!0)&&g("number",e.closeAt,!0);var t},sr={channelUrl:null,channelType:null,pollId:null,pollOptionId:null},ar=function(t){return g("string",t.channelUrl)&&y(e.ChannelType,t.channelType)&&g("number",t.pollId)&&g("number",t.pollOptionId)},or={channelUrl:null,channelType:null,pollId:null},ur=function(t){return g("string",t.channelUrl)&&""!==t.channelUrl&&y(e.ChannelType,t.channelType)&&g("number",t.pollId)},cr={},lr=function(){function t(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger;this._iid=e,this._sdkState=n,this._sessionManager=i,this._requestQueue=s,this._dispatcher=r,this._logger=a,cr[e]=this}return t.of=function(e){return cr[e]},t.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(i){switch(i.label){case 0:return ct(ur(e)).throw(f.invalidParameters),t=new Xn(r({},e)),[4,this._requestQueue.send(t)];case 1:return n=i.sent(),[2,n.as(Zn).poll]}}))}))},t.prototype.create=function(e){return i(this,void 0,void 0,(function(){var t,n,i;return s(this,(function(s){switch(s.label){case 0:return ct(ir(e)).throw(f.invalidParameters),t=e.data,n=new Yn(r(r({},e),{data:t})),[4,this._requestQueue.send(n)];case 1:return i=s.sent(),[2,i.as(Jn).poll]}}))}))},t.prototype.getOption=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(i){switch(i.label){case 0:return ct(ar(e)).throw(f.invalidParameters),t=new $n(r({},e)),[4,this._requestQueue.send(t)];case 1:return n=i.sent(),[2,n.as(er).pollOption]}}))}))},t.prototype.getPollChangeLogs=function(t,n,r,a){return void 0===a&&(a=e.MessageEventSource.SYNC_POLL_CHANGELOGS),i(this,void 0,void 0,(function(){var e,i,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return e=new tr(D({channelType:n,channelUrl:t,timestamp:"number"==typeof r?r:null,token:"string"==typeof r?r:null})),[4,this._requestQueue.send(e)];case 1:return i=s.sent(),o=i.as(nr),u=o.updatedPolls,c=o.deletedPollIds,l=o.hasMore,h=o.nextToken,u.length>0&&this._dispatcher.dispatch(new Cn({polls:u,source:a})),[2,{updatedPolls:u,deletedPollIds:c,hasMore:l,token:h}]}}))}))},t}(),hr=function(e,t){this.pollId=0,this.messageId=0,this.pollId=t.poll.id,this.messageId=t.poll.message_id,this._iid=e,this._payload=t},dr=function(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e},pr=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.token,s=t.limit,a=e.call(this)||this;return a.method=d.GET,a.path=Ie,a.params={channel_url:n,channel_type:r,token:i,limit:s},a}return n(t,e),t}(x),fr=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).polls=(null!==(r=n.polls)&&void 0!==r?r:[]).map((function(e){return new tn(t,e)})),i.token=n.next,i}return n(t,e),t}(F),_r=function(e){function t(t,n){return e.call(this,t,n.channelUrl,n.channelType,n)||this}return n(t,e),t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new pr(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(fr),a=i.polls,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Bn),vr=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,s=t.pollOptionId,a=t.token,o=t.limit,u=e.call(this)||this;return u.method=d.GET,u.path="".concat(Ie,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s),"/voters"),u.params={channel_url:n,channel_type:r,token:a,limit:o},u}return n(t,e),t}(x),mr=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).voters=(null!==(r=n.voters)&&void 0!==r?r:[]).map((function(e){return new ht(t,e)})),i.token=n.next,i}return n(t,e),t}(F),gr=function(e){function t(t,n){var r=e.call(this,t,n.channelUrl,n.channelType,n)||this;return r.pollId=n.pollId,r.pollOptionId=n.pollOptionId,r}return n(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&g("number",this.pollId)&&g("number",this.pollOptionId)},t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new vr(r(r({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(mr),a=i.voters,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Bn),yr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="poll",t}return n(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new lr(t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c})},t.prototype.create=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=r(r({},rr),e),ct(ir(t)).throw(f.invalidParameters),[2,this._manager.create(t)]}))}))},t.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=r(r({},or),e),ct(ur(t)).throw(f.invalidParameters),[2,this._manager.get(t)]}))}))},t.prototype.getOption=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=r(r({},sr),e),ct(ar(t)).throw(f.invalidParameters),[2,this._manager.getOption(t)]}))}))},t}(At),Er={profileImage:null,profileUrl:null,nickname:null},br=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return n(t,e),t}((function(){this.onSessionExpired=J,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=J,this.onSessionRefreshed=J,this.onSessionClosed=J})),Cr=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return n(t,e),t}((function(){this.onConnected=J,this.onReconnectStarted=J,this.onReconnectSucceeded=J,this.onReconnectFailed=J,this.onDisconnected=J})),Tr=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return n(t,e),t}((function(){this.onFriendsDiscovered=J,this.onTotalUnreadMessageCountUpdated=J})),Ir="GroupChannel",Sr=100,Nr="Message";e.GroupChannelListOrder=void 0,(Hn=e.GroupChannelListOrder||(e.GroupChannelListOrder={})).LATEST_LAST_MESSAGE="latest_last_message",Hn.CHRONOLOGICAL="chronological",Hn.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",Hn.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.PublicGroupChannelListOrder=void 0,(Vn=e.PublicGroupChannelListOrder||(e.PublicGroupChannelListOrder={})).CHRONOLOGICAL="chronological",Vn.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",Vn.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.ScheduledMessageListOrder=void 0,(Kn=e.ScheduledMessageListOrder||(e.ScheduledMessageListOrder={})).CREATED_AT="created_at",Kn.SCHEDULED_AT="scheduled_at";var wr,Mr=function(t){switch(t){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case e.GroupChannelListOrder.CHRONOLOGICAL:return["-createdAt","syncIndex"];case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return["name"]}},Ar=function(){function t(){this.messageTypeFilter=e.MessageTypeFilter.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=e.ReplyType.NONE}return t.prototype.clone=function(){var e=new t,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(t){e[t]=n[t]})),e},t.prototype.match=function(t){switch(this.messageTypeFilter){case e.MessageTypeFilter.USER:if(t.messageType!==e.MessageType.USER)return!1;break;case e.MessageTypeFilter.FILE:if(t.messageType!==e.MessageType.FILE)return!1;break;case e.MessageTypeFilter.ADMIN:if(t.messageType!==e.MessageType.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(t instanceof Bt))return!1;if(!this.senderUserIdsFilter.includes(t.sender.userId))return!1}switch(this.replyType){case e.ReplyType.NONE:if(t.parentMessageId>0)return!1;break;case e.ReplyType.ONLY_REPLY_TO_CHANNEL:if(t instanceof Bt&&t.parentMessageId>0&&!t.replyToChannel)return!1}return!0},t}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(wr||(wr={}));var Ur,Or=function(e){switch(e){case wr.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case wr.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Rr={data:null,customType:null,mentionType:e.MentionType.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Lr=function(t){return g("string",t.data,!0)&&g("string",t.customType,!0)&&y(e.MentionType,t.mentionType)&&b("string",t.mentionedUserIds,!0)&&b(ht,t.mentionedUsers,!0)&&g("string",t.mentionedMessageTemplate,!0)&&b(xt,t.metaArrays,!0)&&g("number",t.parentMessageId,!0)&&g("boolean",t.isReplyToChannel)&&y(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&g(Gt,t.appleCriticalAlertOptions,!0)},kr=function(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}:null},Dr=r(r({},Rr),{message:null,translationTargetLanguages:null,pollId:null}),Pr=function(e){return Lr(e)&&g("string",e.message)&&b("string",e.translationTargetLanguages,!0)&&g("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(Ur||(Ur={}));var xr,Fr=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},qr=function(e){return e===Ur.BLOB||e===Ur.FILE},Gr=function(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null},Hr=r(r({},Rr),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1}),Vr=function(e){return Lr(e)&&(T(e.file)||g("string",e.fileUrl))&&g("string",e.fileName,!0)&&g("string",e.mimeType,!0)&&g("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return g("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Kr=r(r({},Dr),{scheduledAt:null}),Qr=r(r({},Rr),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),Br="UnsentMessage",jr={},zr=function(e){function t(t,n){var r=n.sdkState,i=n.cacheContext,s=e.call(this,t)||this;return s._sdkState=r,s._cacheContext=i,jr[t]=s,s}return n(t,e),t.of=function(e){return jr[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection(Br)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){if(e.messageId>0)throw f.invalidParameters;var t,n=r({},e.serialize());return e instanceof nn?(e.messageParams&&(n.messageParams=kr(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,r(r({},kr(t)),{scheduledAt:t.scheduledAt})))):e instanceof an&&(e.messageParams&&(n.messageParams=Gr(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=function(e){return r(r({},Gr(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))),n},t.prototype._deserialize=function(e){return e?(e=r(r({},e),{messageId:parseInt(e.messageId)}),kn.of(this._iid).buildMessageFromSerializedData(e)):null},t.prototype._deserializeWithMessageCreateParams=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t=kn.of(this._iid),n=this._deserialize(e),e.messageParams?n instanceof nn?(r=e.messageParams,n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof an?(r=e.messageParams).fileKey&&"string"==typeof r.fileKey&&qr(r.fileType)?(i=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:i.file=s.sent(),s.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),s.label=4;case 4:return n.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?n instanceof nn?(a=e.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(a,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof an?(a=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof a.fileKey&&qr(a.fileType)?(o=a,[4,this.collection.getBlob(a.fileKey)]):[3,7]:[3,8];case 6:o.file=s.sent(),s.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(a,n),s.label=8;case 8:return[2,n]}}))}))},t.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserializeWithMessageCreateParams(t)];n.label=2;case 2:return[2,null]}}))}))},t.prototype.fetch=function(e){var t=e.channelUrl,n=void 0===t?null:t,r=e.filter,a=void 0===r?new Ar:r,o=e.order,u=void 0===o?wr.CHANNEL_LATEST:o,c=e.sendingStatus,l=void 0===c?null:c,h=e.backward,d=void 0!==h&&h,p=e.parentMessageId,f=void 0===p?null:p;return i(this,void 0,void 0,(function(){var e,t,r,o,c=this;return s(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=Or(u),t={"/where":function(e){return!!(u!==wr.NEWEST_CHILD_MESSAGE||f&&0!==e.parentMessageId&&e.parentMessageId===f)&&a.match(c._deserialize(e))}},n&&(t.channelUrl=n),l&&(t.sendingStatus=l),r={where:t,index:e,backward:d},[4,this.collection.query(r)]):[3,3];case 1:return[4,h.sent().fetch({})];case 2:return o=h.sent(),[2,Promise.all(o.map((function(e){return i(c,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._deserializeWithMessageCreateParams(e)];case 1:return[2,t.sent()]}}))}))})))];case 3:return[2,[]]}}))}))},t.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ar),i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this.fetch({filter:t,order:wr.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},t.prototype.upsert=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,3];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.upsertChildMessages=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:if(!this.localCacheEnabled)return[3,8];s.label=1;case 1:s.trys.push([1,6,7,8]),t=a(e),n=t.next(),s.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:s.sent(),s.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}}))}))},t.prototype.removeMessagesOfChannel=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.saveBlobs=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return e instanceof an?e.messageParams&&(t=e.messageParams).file&&Fr(t.file)?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2]:[3,4];case 1:r=i.sent(),t.fileKey=r,t.fileType=Ur.BLOB,i.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&((n=e.scheduledInfo.scheduledMessageParams).file&&Fr(n.file))?[4,this.collection.saveBlob(n.file,e.reqId)]:[3,4];case 3:r=i.sent(),n.fileKey=r,n.fileType=Ur.BLOB,i.label=4;case 4:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},t}(We),Wr={},Yr=function(e){function t(t,n){var r=n.sdkState,i=n.cacheContext,s=n.unsentMessageCache,a=e.call(this,t)||this;return a._sdkState=r,a._cacheContext=i,a._unsentMessageCache=s,Wr[t]=a,a}return n(t,e),t.of=function(e){return Wr[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection(Nr):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return r(r({},e.serialize()),{messageId:"".concat(e.messageId)})},t.prototype._deserialize=function(e){return e=r(r({},e),{messageId:parseInt(e.messageId)}),kn.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,null]}}))}))},t.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,a=void 0===r?Sr:r,o=e.filter,u=void 0===o?new Ar:o,c=e.order,l=void 0===c?wr.CHANNEL_LATEST:c,h=e.backward,d=void 0!==h&&h,p=e.parentMessageId,f=void 0===p?null:p,_=e.isPollOnly,v=void 0!==_&&_;return i(this,void 0,void 0,(function(){var e,r,o,c=this;return s(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=Or(l),r={where:{channelUrl:t,"/where":function(e){if(n)switch(l){case wr.CHANNEL_LATEST:if(!d&&e.createdAt>n||d&&e.createdAt<n)return!1;break;case wr.NEWEST_CHILD_MESSAGE:if(!f||0===e.parentMessageId||e.parentMessageId!==f)return!1}return!(v&&!e._poll)&&u.match(c._deserialize(e))}},index:e,backward:d},[4,this.collection.query(r)]):[3,3];case 1:return[4,h.sent().fetch({limit:a})];case 2:return o=h.sent(),[2,Promise.all(o.map((function(e){return i(c,void 0,void 0,(function(){return s(this,(function(t){return[2,this._deserialize(e)]}))}))})))];case 3:return[2,[]]}}))}))},t.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ar),i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:wr.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},t.prototype.upsert=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:return r.sent(),[4,this.upsertChildMessages(e)];case 3:return r.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},t.prototype.upsertChildMessages=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:if(!this.localCacheEnabled)return[3,8];s.label=1;case 1:s.trys.push([1,6,7,8]),t=a(e),n=t.next(),s.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:s.sent(),s.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}}))}))},t.prototype.removeMessagesOfChannel=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:Or(wr.CHANNEL_LATEST)})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},t.prototype.removeUnderOffset=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:Or(wr.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.countBetween=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i=this;return s(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=Or(wr.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,s.sent()];case 2:return[2,0]}}))}))},t.prototype.saveBlobs=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return e instanceof an&&e.messageParams&&((t=e.messageParams).file&&Fr(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},t}(We),Jr=function(e){function t(){var t=e.call(this)||this;return t._pauseDelayTimer=null,t._currentState="visible",t._toggleState=t._toggleState.bind(t),t}return n(t,e),Object.defineProperty(t.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=null,e.dispatch("pause")}),3e4)),this._currentState=document.visibilityState},t.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})},t.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})},t}(R),Xr=function(){function e(e){var t=e.logger,n=e.connectionDelegate,r=void 0===n?null:n,i=this;this._onlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.reconnect()},this._offlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.disconnect()},this.unsubscribes=[],this._onlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("online",e),function(){return window.removeEventListener("online",e,!1)}},this._offlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("offline",e),function(){return window.removeEventListener("offline",e,!1)}},this.logger=t,r&&(this.connectionDelegate=r)}return Object.defineProperty(e.prototype,"isAvailableOnWeb",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),e.prototype.setOnlineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._onlineListener=e)},e.prototype.setOfflineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._offlineListener=e)},e.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]},e.prototype.stop=function(){var e=this;this.unsubscribes.forEach((function(t){try{null==t||t()}catch(t){e.logger.warn(t.message)}})),this.unsubscribes=[]},e.prototype.isOnline=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise((function(e){fetch("https://www.google.com",{method:d.GET,mode:"no-cors"}).then((function(){return e(!0)})).catch((function(){return e(!1)}))}))]}))}))},e}(),Zr=function(e){function t(t){var n=t.message,r=e.call(this)||this;return r.message=n,r}return n(t,e),t}(k),$r={},ei=function(){function t(e,t){var n=t.localCacheEnabled,r=t.dispatcher,i=t.sdkState,s=t.logger,a=this;$r[e]=this,this._iid=e,$r[e]=this,this._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=s,this._sdkState=i,this._localCacheEnabled&&r.on((function(e){if(e instanceof he)switch(e.stateType){case X.CONNECTED:a._isProcessingAutoResend||a.processAutoResendRegisteredPendingMessages().then((function(){return a._processNextAutoResend()}));break;case X.DISCONNECTED:a._isProcessingAutoResend=!1}}))}return t.of=function(e){return $r[e]},t.prototype.processNonAutoResendRegisteredPendingMessages=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=s.sent();try{for(n=a(t),r=n.next();!r.done;r=n.next())0===(i=r.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=e.SendingStatus.FAILED,i.errorCode=c.ACK_TIMEOUT,this._dispatcher.dispatch(new yn({messages:[i],source:e.MessageEventSource.LOCAL_MESSAGE_FAILED})))}catch(e){o={error:e}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}}return[2]}}))}))},t.prototype.processAutoResendRegisteredPendingMessages=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=s.sent();try{for(n=a(t),r=n.next();!r.done;r=n.next())(i=r.value).errorCode&&C(i.errorCode)&&(o=(new Date).getTime(),u=i.createdAt+2592e5,o<=u?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(u).toLocaleString()),i.sendingStatus=e.SendingStatus.FAILED,this._dispatcher.dispatch(new yn({messages:[i],source:e.MessageEventSource.LOCAL_MESSAGE_FAILED}))))}catch(e){c={error:e}}finally{try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}}return[2]}}))}))},t.prototype.completeCurrentAndProcessNextAutoResend=function(t){if(this._localCacheEnabled&&(t.sendingStatus===e.SendingStatus.SUCCEEDED||t.sendingStatus===e.SendingStatus.FAILED&&!C(t.errorCode))){var n=this.indexOf(t);n>=0&&this._autoResendQueue.splice(n,1),0===n&&this._processNextAutoResend()}},t.prototype._fetchAllCachedPendingMessages=function(){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return(t=zr.of(this._iid))?[4,t.fetch({sendingStatus:e.SendingStatus.PENDING,backward:!0})]:[3,2];case 1:return n=r.sent(),[3,3];case 2:n=[],r.label=3;case 3:return[2,n]}}))}))},t.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},t.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},t.prototype._processNextAutoResend=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._dispatcher.dispatch(new Zr({message:e})),this._logger.debug("processing auto-resend for message request id: ",e.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]}))}))},t}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(xr||(xr={}));var ti=function(){function e(e){this.category=e.cat,this.data=e.data}return e.getDataAsUserBlockEvent=function(e,t){var n=t.data,r=n.blocker,i=n.blockee;return{blocker:new ht(e,r),blockee:new ht(e,i)}},e.getDataAsFriendDiscoveredEvent=function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new ht(e,t)})):[]}},e}(),ni=function(e){function t(t,n){var r=n.userId,i=e.call(this)||this;return i._iid=t,i.userId=r,i}return n(t,e),t}(k),ri=function(e){function t(t,n,r){var i=e.call(this,t,"USEV",r)||this;return i.event=new ti(r),i}return n(t,e),t}(j),ii=function(e){function t(t){var n=t.userId,r=t.nickname,i=void 0===r?null:r,s=t.profileUrl,a=void 0===s?null:s,o=t.profileImage,u=void 0===o?null:o,c=t.preferredLanguages,l=void 0===c?null:c,h=e.call(this)||this;return h.method=d.PUT,h.path="".concat(fe,"/").concat(encodeURIComponent(n)),h.params=D({nickname:i,profile_url:a,profile_file:u,preferred_languages:l}),h}return n(t,e),t}(x),si=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.user=null,i.user=new ht(t,r({},n)),i}return n(t,e),t}(F),ai=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/apns"),i.params={apns_device_token:r,always_push:!0},i}return n(t,e),t}(x);!function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.token=r.token,i.type=r.type?e.PushTokenType[r.type.toLowerCase()]:e.PushTokenType.UNKNOWN,i.user=new ht(n,r.user),i}n(r,t)}(F);var oi=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/gcm"),i.params={gcm_reg_token:r,always_push:!0},i}return n(t,e),t}(x);!function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.token=r.token,i.type=r.type?e.PushTokenType[r.type.toLowerCase()]:e.PushTokenType.UNKNOWN,i.user=new ht(n,r.user),i}n(r,t)}(F);var ui=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/apns/").concat(encodeURIComponent(r)),i}return n(t,e),t}(x);!function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new ht(t,n.user),r}n(t,e)}(F);var ci=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/gcm/").concat(encodeURIComponent(r)),i}return n(t,e),t}(x);!function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new ht(t,n.user),r}n(t,e)}(F);var li=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.DELETE,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/apns"),r}return n(t,e),t}(x);!function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.type=r.type?e.PushTokenType[r.type.toLowerCase()]:e.PushTokenType.UNKNOWN,i.user=new ht(n,r.user),i}n(r,t)}(F);var hi=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.DELETE,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/gcm"),r}return n(t,e),t}(x);!function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.type=r.type?e.PushTokenType[r.type.toLowerCase()]:e.PushTokenType.UNKNOWN,i.user=new ht(n,r.user),i}n(r,t)}(F);var di=function(e){function t(t){var n=t.userId,r=t.type,i=t.token,s=t.ts,a=e.call(this)||this;return a.method=d.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/").concat(encodeURIComponent(r),"/device_tokens"),a.params={created_ts:s,token:i},a}return n(t,e),t}(x),pi=function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.pushTokens={type:r.type?e.PushTokenType[r.type.toLowerCase()]:e.PushTokenType.UNKNOWN,deviceTokens:r.device_tokens,hasMore:r.has_more,token:r.token},i}return n(r,t),r}(F),fi=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),r}return n(t,e),t}(x),_i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return n(t,e),t}(F),vi=function(e){function t(t){var n=t.userId,r=t.willAutoAccept,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),i.params={auto_accept:r},i}return n(t,e),t}(x),mi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return n(t,e),t}(F),gi=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference"),r}return n(t,e),t}(x),yi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return n(t,e),t}(F),Ei=function(e){function t(t){var n=t.userId,r=t.doNotDisturbOn,i=t.startHour,s=t.startMin,a=t.endHour,o=t.endMin,u=t.timezone,c=e.call(this)||this;return c.method=d.PUT,c.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference"),c.params={do_not_disturb:r,start_hour:i,start_min:s,end_hour:a,end_min:o,timezone:u},c}return n(t,e),t}(x),bi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return n(t,e),t}(F),Ci=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference"),r}return n(t,e),t}(x),Ti=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return n(t,e),t}(F),Ii=function(e){function t(t){var n=t.userId,r=t.snoozeOn,i=t.startTs,s=t.endTs,a=e.call(this)||this;return a.method=d.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference"),a.params={snooze_enabled:r,snooze_start_ts:i,snooze_end_ts:s},a}return n(t,e),t}(x),Si=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return n(t,e),t}(F),Ni=function(e){function t(t){var n=t.userId,r=t.blockedUserId,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/block"),i.params={target_id:r},i}return n(t,e),t}(x);!function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.user=new ht(t,n),r}n(t,e)}(F);var wi=function(e){function t(t){var n=t.userId,r=t.unblockedUserId,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/block/").concat(encodeURIComponent(r)),i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Mi=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference"),r}return n(t,e),t}(x),Ai=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return n(t,e),t}(F),Ui=function(e){function t(t){var n=t.userId,r=t.pushTriggerOption,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference"),i.params={push_trigger_option:r},i}return n(t,e),t}(x),Oi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return n(t,e),t}(F),Ri=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/template"),r}return n(t,e),t}(x),Li=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return n(t,e),t}(F),ki=function(e){function t(t){var n=t.userId,r=t.templateName,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push/template"),i.params={name:r},i}return n(t,e),t}(x),Di=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return n(t,e),t}(F),Pi=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.GET,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/friends/changelogs"),i.params={token:r},i}return n(t,e),t}(x),xi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.changelogs={addedUsers:n.added.map((function(e){return new ht(t,e)})),updatedUsers:n.updated.map((function(e){return new ht(t,e)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next},r}return n(t,e),t}(F),Fi=function(e){function t(t){var n=t.userId,r=t.discoveries,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discoveries:r.map((function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},i}return n(t,e),t}(x),qi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.friendDiscoveryRequestId=n.friend_discovery_request_id,r}return n(t,e),t}(F),Gi=function(e){function t(t){var n=t.userId,r=t.discoveryKeys,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discovery_keys:r},i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Hi=function(e){function t(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return n(t,e),t}(x),Vi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ht(t,e)})),r}return n(t,e),t}(F),Ki=function(e){function t(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Qi=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(fe,"/").concat(n,"/allow_friend_discovery"),r.params={},r}return n(t,e),t}(x),Bi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allowFriendDiscovery=n.allow_friend_discovery,r}return n(t,e),t}(F),ji=function(e){function t(t){var n=t.userId,r=t.allowFriendDiscovery,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(fe,"/").concat(n,"/allow_friend_discovery"),i.params={allow_friend_discovery:r},i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var zi,Wi=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},Yi=function(e){var t,n,r;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(t=e.id)&&void 0!==t?t:0,this.name=null!==(n=e.name)&&void 0!==n?n:"",this.url=null!==(r=e.url)&&void 0!==r?r:"",this.emojis=e.emojis?e.emojis.map((function(e){return new Wi(e)})):[]},Ji=function(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new Yi(e)})):[]},Xi=function(e){function t(){var t=e.call(this)||this;return t.method=d.GET,t.path=Te,t}return n(t,e),t}(x),Zi=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.emojiContainer=new Ji(n),r}return n(t,e),t}(F),$i=function(e){function t(t){var n=t.categoryId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Te,"/").concat(n),r}return n(t,e),t}(x),es=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.emojiCategory=new Yi(n),r}return n(t,e),t}(F),ts=function(e){function t(t){var n=t.key,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Ce,"/").concat(n),r}return n(t,e),t}(x),ns=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.emoji=new Wi(n),r}return n(t,e),t}(F),rs=function(e){function t(t){var n=t.limit,r=t.token,i=t.userIdsFilter,s=t.metaDataKeyFilter,a=t.metaDataValuesFilter,o=t.nicknameStartsWithFilter,u=e.call(this)||this;return u.method=d.GET,u.path=fe,u.params=D({limit:n,token:r,user_ids:i,metadatakey:s,metadatavalues_in:a,nickname_startswith:o}),u}return n(t,e),t}(x),is=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ht(t,e)})),r.next=n.next,r}return n(t,e),t}(F),ss=function(e){function t(t,n){var r,i,s,a=this;return(a=e.call(this,t,n)||this).userIdsFilter=null,a.metaDataKeyFilter=null,a.metaDataValuesFilter=null,a.nicknameStartsWithFilter=null,a.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,a.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,a.metaDataValuesFilter=null!==(s=n.metaDataValuesFilter)&&void 0!==s?s:null,a.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,a}return n(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&b("string",this.userIdsFilter,!0)&&g("string",this.metaDataKeyFilter,!0)&&b("string",this.metaDataValuesFilter,!0)&&g("string",this.metaDataKeyFilter,!0)},t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new rs(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(is),a=i.users,o=i.next,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Fn),as=function(e){function t(t){var n=t.userId,r=t.limit,i=t.token,s=t.userIdsFilter,a=e.call(this)||this;return a.method=d.GET,a.path="".concat(fe,"/").concat(n,"/block"),a.params=D({limit:r,token:i,user_ids:s}),a}return n(t,e),t}(x),os=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ht(t,e)})),r.next=n.next,r}return n(t,e),t}(F),us=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return n(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&b("string",this.userIdsFilter,!0)},t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,i=new as(r(r({},this),{userId:t.userId,token:this._token})),[4,n.send(i)]):[3,2]:[3,5];case 1:return a=s.sent(),o=a.as(os),u=o.users,c=o.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Fn),cs=function(e){function t(t){var n=t.userId,r=t.limit,i=t.token,s=e.call(this)||this;return s.method=d.GET,s.path="".concat(fe,"/").concat(encodeURIComponent(n),"/friends"),s.params={limit:r,token:i},s}return n(t,e),t}(x),ls=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(e){return new ht(t,e)})),r.next=n.next,r}return n(t,e),t}(F),hs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,i=new cs(r(r({},this),{userId:t.userId,token:this._token})),[4,n.send(i)]):[3,2]:[3,5];case 1:return a=s.sent(),o=a.as(ls),u=o.users,c=o.hasMore,l=o.next,this._token=l,this._hasNext=c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Fn),ds={},ps=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,s=void 0===i?256:i,a=e.blockHashBase,o=void 0===a?2:a,u=e.blockHashMultiplier,c=void 0===u?10:u,l=e.blockHashConstant,h=void 0===l?11:l,d=e.transactionApplyDelay,p=void 0===d?200:d,f=e.disableLogger,_=void 0!==f&&f;return ds[t]||(this.itemSizeLimit=r,this.cacheLimit=s,this.blockHashBase=o,this.blockHashMultiplier=c,this.blockHashConstant=h,this.transactionApplyDelay=p,this.disableLogger=_,ds[t]=this),ds[t]}return e.get=function(e){return ds[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(zi||(zi={}));var fs,_s=function(e){function t(n){var r=n.code,i=void 0===r?zi.UNKNOWN_ERROR:r,s=n.message,a=void 0===s?"Unknown error occurred.":s,o=e.call(this,a)||this;return o.code=i,Object.setPrototypeOf(o,t.prototype),o}return n(t,e),Object.defineProperty(t,"storeNotDefined",{get:function(){return new t({code:zi.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailable",{get:function(){return new t({code:zi.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t({code:zi.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeIsFull",{get:function(){return new t({code:zi.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeKeyTypeIsInvalid",{get:function(){return new t({code:zi.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenIntegrity",{get:function(){return new t({code:zi.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenBlob",{get:function(){return new t({code:zi.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeEncryptionInvalid",{get:function(){return new t({code:zi.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeItemSizeExceeded",{get:function(){return new t({code:zi.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeReadFailed",{get:function(){return new t({code:zi.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeWriteFailed",{get:function(){return new t({code:zi.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseSchemaNotOnUpgrade",{get:function(){return new t({code:zi.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionNotReady",{get:function(){return new t({code:zi.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotMatch",{get:function(){return new t({code:zi.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionQueryNotValid",{get:function(){return new t({code:zi.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionInsertDuplicate",{get:function(){return new t({code:zi.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotFound",{get:function(){return new t({code:zi.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotGiven",{get:function(){return new t({code:zi.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionWriteFailed",{get:function(){return new t({code:zi.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionItemSizeExceeded",{get:function(){return new t({code:zi.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTableIsRequired",{get:function(){return new t({code:zi.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTypesNotMatch",{get:function(){return new t({code:zi.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"compareTypesNotMatch",{get:function(){return new t({code:zi.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"circularReferenceFound",{get:function(){return new t({code:zi.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(fs||(fs={}));var vs,ms=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw _s.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map((function(e){return ms(e,t)}));else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=ms(e[r],t);return t.delete(e),n}return e},gs=function(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw _s.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n},ys=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},Es=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},bs=function(e,t){if(!t)return!1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return!bs(e,t)})))return!1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return!bs(e,t)})))return!1}else if("/where"===n){if(!(0,e[n])(t))return!1}else{var r=n;if("object"==typeof e[r]){var i=e[r];for(var s in i)switch(s){case"/eq":case"=":if((a=t[r])!==(o=i[s]))return!1;break;case"/neq":case"!=":if((a=t[r])===(o=i[s]))return!1;break;case"/gt":case">":var a=t[r],o=i[s];if(!(gs(a,o)>0))return!1;break;case"/gte":case">=":a=t[r],o=i[s];if(!(gs(a,o)>=0))return!1;break;case"/lt":case"<":a=t[r],o=i[s];if(!(gs(a,o)<0))return!1;break;case"/lte":case"<=":a=t[r],o=i[s];if(!(gs(a,o)<=0))return!1;break;case"/in":a=t[r];if(!(o=i[s]).includes(a))return!1;break;case"/nin":a=t[r];if((o=i[s]).includes(a))return!1;break;case"/contain":a=t[r],o=i[s];if(!a.includes(o))return!1;break;case"/regex":a=t[r];if(!(o=i[s]).test(a))return!1;break;case"/where":a=t[r];if(!(0,i[s])(a))return!1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return!1}else if(e[r]!==t[r])return!1}}return!0}return e(t)},Cs=function(){},Ts=function(){return Promise.resolve()},Is=function(e){return e},Ss=function(e,t){t(null)};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(vs||(vs={}));var Ns,ws,Ms,As=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,s=e.iterator,a=e.map,o=void 0===a?Is:a,u=e.backward,c=void 0===u?Ts:u,l=e.forward,h=void 0===l?Ts:l,d=e.complete,p=void 0===d?Cs:d;this._prevValue=n,this._nextValue=i,this._error=null,this._map=o,this._backward=c,this._forward=h,this._iterator=s,this._complete=p}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return i(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},e}(),Us=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.blockManager,a=e.indexer;this.condition=n,this.backward=i,this._blockManager=s,this._indexer=a}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],a=1;if("-"===s[0]&&(s=s.slice(1),a=-1),this.condition[s])if("object"==typeof this.condition[s]){var o=a>0?n:t;for(var u in this.condition[s])if(o.includes(u))for(var c=r;c>=0;c--)if(a*gs(this._indexer.origin[c].columnValues[i],this.condition[s][u])<=0){r=c;break}}else for(c=r;c>=0;c--)if(a*gs(this._indexer.origin[c].columnValues[i],this.condition[s])<=0){r=c;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=function(r){var i=d._indexer.fields[r],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),d.condition[i])if("object"==typeof d.condition[i])Object.keys(d.condition[i]).forEach((function(a){if((s>0?t:n).includes(a))for(var o=l;o<e._indexer.origin.length;o++)if(s*gs(e._indexer.origin[o].columnValues[r],e.condition[i][a])>=0){l=o;break}}));else for(var a=l;a<d._indexer.origin.length;a++)if(s*gs(d._indexer.origin[a].columnValues[r],d.condition[i])>=0){l=a;break}},d=this,i=0;i<this._indexer.fields.length;i++)h(i);return Math.max(l-1,0)},e.prototype.each=function(e){return i(this,void 0,void 0,(function(){var t,n,r,a,o,u,c,l=this;return s(this,(function(h){switch(h.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r=function(){if(l._indexer.origin[t]){if(!l._indexer.origin[t].keys[++n]){if(!l._indexer.origin[++t])return!1;n=0}return!0}return!1},a=function(){if(l._indexer.origin[t]){if(!l._indexer.origin[t].keys[--n]){if(!l._indexer.origin[--t])return!1;n=l._indexer.origin[t].keys.length-1}return!0}return!1},o=null,!this._indexer.origin[t])return[3,4];u=this.backward?a:r,h.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if(c=h.sent(),bs(this.condition,c))return o=c,[3,4];h.label=3;case 3:if(u())return[3,1];h.label=4;case 4:return[4,new Promise((function(u){var c=new As({initialNextValue:ms(o),iterator:e,forward:function(){return i(l,void 0,void 0,(function(){var e,i;return s(this,(function(s){switch(s.label){case 0:e=this.backward?a:r,s.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return i=s.sent(),bs(this.condition,i)?[2,ms(i)]:[3,1];case 3:return[2,null]}}))}))},backward:function(){return i(l,void 0,void 0,(function(){var e,i;return s(this,(function(s){switch(s.label){case 0:e=this.backward?r:a,s.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return i=s.sent(),bs(this.condition,i)?[2,ms(i)]:[3,1];case 3:return[2,null]}}))}))},complete:u});e(c)}))];case 5:return[2,h.sent()]}}))}))},e}(),Os=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.mutex,a=e.blockManager,o=e.indexer;this._mutex=s,this._iterator=new Us({condition:n,backward:i,blockManager:a,indexer:o})}return e.prototype.fetch=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,n,r,a,o=this;return s(this,(function(u){switch(u.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(n<0)throw _s.collectionQueryNotValid;u.label=1;case 1:return u.trys.push([1,4,,5]),r=[],[4,this._mutex.lock()];case 2:return u.sent(),[4,this._iterator.each((function(e){return i(o,void 0,void 0,(function(){return s(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r.push(e.nextValue),0<n&&n<=r.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return u.sent(),this._mutex.unlock(),[2,r];case 4:throw a=u.sent(),this._mutex.unlock(),a;case 5:return[2]}}))}))},e.prototype.count=function(){return i(this,void 0,void 0,(function(){var e,t,n=this;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r.sent(),[4,this._iterator.each((function(t){return i(n,void 0,void 0,(function(){return s(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r.sent(),this._mutex.unlock(),t;case 4:return[2]}}))}))},e}(),Rs=function(e){return"".concat("nest","@").concat(e)},Ls=function(e,t){return"".concat(Rs(e),"/").concat(t)},ks=function(e,t){return"".concat(Ls(e,t),".metadata")},Ds=function(e,t){return"".concat(Ls(e,t),"/block.")},Ps=function(e,t){return"".concat(Ls(e,t),"/blob.")},xs=function(e,t,n,r){return void 0===r&&(r=0),"".concat(Ps(e,t)).concat(n,".").concat(r)},Fs=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this._store=r}return e.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(n>0){for(var r=Math.ceil(e.data.length/n),i="".concat(r,".").concat(e.type,".").concat(t),s=[],a=0;a<e.data.length;a+=n){var o=e.data.slice(a,a+n);s.push(o)}return{blobId:i,shards:s}}return{blobId:null,shards:null}},e.prototype._encode=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){var n=new FileReader;n.onload=function(){t({data:n.result,type:e.type})},n.readAsDataURL(e)}))];case 1:return[2,t.sent()]}}))}))},e.prototype._decode=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return"undefined"==typeof fetch?[3,3]:[4,fetch(e.data)];case 1:return[4,s.sent().blob()];case 2:return[2,s.sent()];case 3:for(512,t=[],n=atob(e.data.split(",")[1]),r=0;r<n.length;r+=512){for(i=n.slice(r,r+512),a=new Array(i.length),o=0;o<i.length;o++)a[o]=i.charCodeAt(o);t.push(new Uint8Array(a))}return[2,new Blob(t,{type:e.type})]}}))}))},e.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,u,c,l;return s(this,(function(s){switch(s.label){case 0:if(t=[],n=o(e.split("."),2),r=n[0],i=n[1],!((a=parseInt(r))>0))return[3,6];u=0,s.label=1;case 1:return u<a?(c=xs(this.dbname,this.collectionName,e,u),[4,this._store.get(c)]):[3,4];case 2:if(!(l=s.sent())||!l.d)throw _s.storeBrokenBlob;t.push(l.d),s.label=3;case 3:return u++,[3,1];case 4:return[4,this._decode({data:t.join(""),type:i})];case 5:return[2,s.sent()];case 6:return[2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),i(this,void 0,void 0,(function(){var n,r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return n=[],[4,this._encode(e)];case 1:if(r=s.sent(),i=this._makeShards(r,t),a=i.blobId,o=i.shards,!a)return[3,3];for(u=0;u<o.length;u++)c=xs(this.dbname,this.collectionName,a,u),n.push({key:c,value:{d:o[u]},generation:1});return[4,this._store.setMany(n)];case 2:if(s.sent().some((function(e){return e instanceof Error})))throw _s.storeWriteFailed;return[2,a];case 3:return[2,null]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(t=[],n=o(e.split("."),1),r=n[0],!((i=parseInt(r))>0))return[3,2];for(a=0;a<i;a++)t.push(xs(this.dbname,this.collectionName,e,a));return[4,this._store.removeMany(t)];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,o,u,c;return s(this,(function(s){switch(s.label){case 0:return e=Ps(this.dbname,this.collectionName),t=[],[4,this._store.getAllKeys()];case 1:n=s.sent();try{for(r=a(n),i=r.next();!i.done;i=r.next())(o=i.value).startsWith(e)&&t.push(o)}catch(e){u={error:e}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return[4,this._store.removeMany(n)];case 2:return s.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(Ns||(Ns={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(ws||(ws={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(Ms||(Ms={}));var qs=[ws.PENDING,ws.VOLATILE],Gs={},Hs=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return Gs[t]||(this.dbname=t,this._items=[],this._limit=r,Gs[t]=this),Gs[t]}return e.get=function(e){return Gs[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=Ms.DEFAULT),i(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return(r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return(i=s.sent())&&(r={key:t,value:i,generation:1,state:n===Ms.PERSISTENT?ws.PERSISTENT:ws.VOLATILE},this.put(r)),[3,3];case 2:n===Ms.PERSISTENT&&(r.state=ws.PERSISTENT),s.label=3;case 3:return[2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=Ms.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===Ms.PERSISTENT&&(r.state=ws.PERSISTENT),t!==Ms.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)qs.includes(this._items[r].state)&&qs.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter((function(e){return e.state===ws.VOLATILE})),s=i.length-this._limit;if(s>0){var o=[];try{for(var u=a(this._items),c=u.next();!c.done;c=u.next()){var l=c.value;l.state===ws.VOLATILE&&s>0?s--:o.push(l)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}this._items=o}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return!e(t)}))},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==ws.VOLATILE}))},e}(),Vs=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return"".concat(Ls(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return"".concat(Ls(e,t),"/trans.recordset")}(t,n),this._store=r}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=n.sent()||[]).push.apply(t,u([],o(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],s=[],a=i.requests.length-1;a>=0;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}s.length>0&&(i.requests=s,t.unshift(i))}return t},e.prototype._applyRecord=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a,o,u,c,l,h,d;return s(this,(function(s){switch(s.label){case 0:n=Hs.get(this.dbname),i=t.generation,a=t.requests,o=null,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.setMany(a.map((function(e){return r(r({},e.data),{generation:i})})))];case 2:for(u=s.sent(),c=0;c<a.length;c++)u[c]instanceof Error&&(o||(o=u[c]),l=a[c].data,n.put(r(r({},l),{generation:i,state:ws.PERSISTENT})));return[3,4];case 3:return h=s.sent(),o=h,[3,4];case 4:return o?[3,6]:(d=e.filter((function(e){return e.generation!==i})),[4,this._store.set({key:this.recordsetKey,value:d,generation:i})]);case 5:return s.sent(),this._onWrite.forEach((function(e){e(a.map((function(e){return e.data})))})),[3,7];case 6:this._onError.forEach((function(e){return e(o)})),s.label=7;case 7:return[2]}}))}))},e.prototype.init=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,o,u,c;return s(this,(function(s){switch(s.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=s.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=s.sent(),s.label=3;case 3:s.trys.push([3,8,9,10]),n=a(t),r=n.next(),s.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._applyRecord(t,i)]);case 5:s.sent(),s.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return o=s.sent(),u={error:o},[3,10];case 9:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 10:return[2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case Ns.COMMIT:this._onCommit.set(t,n);break;case Ns.WRITE:this._onWrite.set(t,n);break;case Ns.ERROR:this._onError.set(t,n)}},e.prototype.requestWrite=function(e,t){void 0===t&&(t=null),this._requests.push({data:e,options:t}),Hs.get(this.dbname).put(r({state:ws.PENDING,generation:this.generation},e))},e.prototype.requestMultipleWrite=function(e,t){var n,i;void 0===t&&(t=null);var s=Hs.get(this.dbname);try{for(var o=a(e),u=o.next();!u.done;u=o.next()){var c=u.value;this._requests.push({data:c,options:t}),s.put(r({state:ws.PENDING,generation:this.generation},c))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return Hs.get(this.dbname).clearByCondition((function(e){return e.state===ws.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c,l,h,d,p,f=this;return s(this,(function(s){switch(s.label){case 0:if(!((e=this._requests).length>0))return[3,4];for(t=[],n={},c=e.length-1;c>=0;c--)i=e[c],h=i.data,n[h.key]||(n[h.key]=!0,t.unshift(i));return a={generation:this.generation,requests:t},[4,this._getReducedRecordset([a])];case 1:return o=s.sent(),[4,this._store.set({key:this.recordsetKey,value:o,generation:this.generation})];case 2:return s.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(s.sent(),u=Hs.get(this.dbname),c=0;c<t.length;c++)l=t[c],h=l.data,d=l.options,u.put(r(r({},h),{generation:a.generation,state:d&&d.persistent?ws.PERSISTENT:ws.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})))})),p=ps.get(this.dbname),setTimeout((function(){try{f._applyRecord(o,a)}catch(e){f._onError.forEach((function(t){return t(e)}))}}),p.transactionApplyDelay),s.label=4;case 4:return[2]}}))}))},e}(),Ks=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,s=e.limit;this.blockId=t,this.keyName=n,this.limit=s,this._items=u([],o(i),!1)}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this;return this._items.find((function(n){var r=n[t.keyName];return e===r}))},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},e.prototype.clear=function(){this._items=[]},e}(),Qs=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,s=void 0===i?ys:i,a=e.transaction,o=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=a,this._store=o}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,s="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||ys)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(Ds(n,r)).concat(i,".").concat(s);var n,r,i,s},e.prototype._findBlock=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:t=Hs.get(this.dbname),n=this.metadata.blockLevel,s.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i=s.sent())&&(a=Ks.createFromCacheItem(i),a.getItemByKey(e)))return[2,a];s.label=3;case 3:return n--,[3,1];case 4:return[2,null]}}))}))},e.prototype.getFromBlock=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return[2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return n=ps.get(this.dbname),r=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,Hs.get(this.dbname).find(this._store,r)];case 1:return a=s.sent(),(o=a?Ks.createFromCacheItem(a):new Ks({blockId:r,keyName:this.keyName,items:[],limit:i})).add(t)?(this._transaction.requestWrite({key:o.blockId,value:o.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return(t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return e=Ds(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=s.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:s.sent(),r=Hs.get(this.dbname);try{for(i=a(n),o=i.next();!o.done;o=i.next())u=o.value,r.remove(u)}catch(e){c={error:e}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return[2]}}))}))},e}(),Bs=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,a=e.store,o=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=function(e,t,n){return"".concat(Ls(e,t),"/index.").concat(n)}(this.dbname,this.collectionName,this.fields.join(">")),this._transaction=s,this._store=a,this._transaction.on(Ns.COMMIT,this.indexerKey,(function(){return o.commit()})),this._transaction.on(Ns.ERROR,this.indexerKey,(function(){return o.abort()}))}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=o(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=o(this.indexOf(n),2),i=r[0];if(r[1]){var s=this._table[i].keys.indexOf(t);if(s>-1)return this._table[i].keys.splice(s,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return!1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,s=[];try{for(var o=a(this.fields),u=o.next();!u.done;u=o.next()){var c=u.value;if("-"===c[0]&&(c=c.slice(1)),r=e[c],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw _s.indexTypesNotMatch;s.push(e[c])}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=gs(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},e.prototype.ensure=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,o,u,c,l,h,d,p,f,_,v,m,g;return s(this,(function(s){switch(s.label){case 0:return[4,(e=Hs.get(this.dbname)).find(this._store,this.indexerKey,Ms.PERSISTENT)];case 1:return(t=s.sent())?[3,11]:(n=Ds(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=s.sent(),s.label=3;case 3:s.trys.push([3,8,9,10]),i=a(r),o=i.next(),s.label=4;case 4:return o.done?[3,7]:(u=o.value).startsWith(n)?[4,e.find(this._store,u,Ms.NO_CACHE)]:[3,6];case 5:c=s.sent(),l=Ks.createFromCacheItem(c);try{for(m=void 0,h=a(l.items),d=h.next();!d.done;d=h.next())p=d.value,this._addItem(p)}catch(e){m={error:e}}finally{try{d&&!d.done&&(g=h.return)&&g.call(h)}finally{if(m)throw m.error}}s.label=6;case 6:return o=i.next(),[3,4];case 7:return[3,10];case 8:return f=s.sent(),_={error:f},[3,10];case 9:try{o&&!o.done&&(v=i.return)&&v.call(i)}finally{if(_)throw _.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=ms(this._origin),s.label=12;case 12:return[2]}}))}))},e.prototype.drop=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return Hs.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}}))}))},e.prototype.addItem=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=ms(this._origin)},e.prototype.abort=function(){this._table=ms(this._origin)},e}(),js="undefined"!=typeof document&&"undefined"!=typeof navigator;js&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var zs=js&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");js&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),js&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),js&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");var Ws,Ys,Js=js&&navigator.userAgent&&navigator.userAgent.includes("Edge/"),Xs=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(Ws||(Ws={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(Ys||(Ys={}));var Zs,$s={},ea=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=Ws.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],$s[e]&&!t.forceCreate||(this.nodeId=Xs(),this.key=e,js&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t,r,i=e.data,s=i.nodeId,o=i.requestId,u=i.key,c=i.op,l=i.data;if(s!==n.nodeId&&u===n.key)switch(c){case Ys.NEWNODE:n._sendSync();break;case Ys.CLAIM_HOST:n._sendSync(),n._hostId=s;break;case Ys.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var h=l,d=h.currentItemRequestId,p=h.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:Ys.REQUEST_LOCK,ts:e.ts})};try{for(var _=a(p),v=_.next();!v.done;v=_.next()){f(v.value)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===d})),n._completeSync()}break;case Ys.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=null,n._acquire(n._queue[0]));break;case Ys.REQUEST_LOCK:n._requestLock(i);break;case Ys.ACQUIRE_LOCK:var m=n._queue.find((function(e){return e.requestId===o}));n._acquire(m);break;case Ys.RELEASE_LOCK:n._release(o)}})),window.addEventListener("beforeunload",(function(){n._send(Ys.REMOVENODE)}))),$s[e]=this),$s[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==Ws.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n,r;void 0===t&&(t={});var i={nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:Xs(),key:this.key,op:e,data:null!==(r=t.data)&&void 0!==r?r:null,ts:Date.now()};return js&&window.postMessage(i,"*"),i},e.prototype._acquire=function(e){void 0===e&&(e=null),e?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=null,t.nodeId===this.nodeId&&this._send(Ys.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased(e)}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Ys.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},i=!1;for(var s in t._queue)if(t._queue[s].ts>r.ts){t._queue.splice(parseInt(s),0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(Ys.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})},e.prototype._waitUntilSyncCompleted=function(){return i(this,void 0,void 0,(function(){var e=this;return s(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t)}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))},e.prototype._completeSync=function(){this.isInSync||(this._state=Ws.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])},e.prototype.registerNode=function(){this._send(Ys.NEWNODE),this._waitSync()},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Ys.CLAIM_HOST),this._waitSync()},e.prototype.lock=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(Ys.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;this._release(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)},e}(),ta=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,a=e.store,c=this;this._state=fs.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=u([[r]],o(s.filter((function(e){return Bs.createKey(e)!==c.keyName}))),!1),this._keyHash=i,this._store=a,this._mutex=new ea(function(e,t){return"".concat(Ls(e,t),".lock")}(t,n)),this._blobContainer=new Fs({dbname:t,collectionName:n,store:a}),this._transaction=new Vs({dbname:t,collectionName:n,store:a})}return e.metadataOf=function(e,t,n){return i(this,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return r=ks(e,t),[4,n.get(r)];case 1:return[2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===fs.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,c,l,h,d,p,f,_,v,m,g,y=this;return s(this,(function(s){switch(s.label){case 0:return[4,this._mutex.lock()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,9,,10]),t=ps.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=s.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:s.sent(),this._blockManager=new Qs({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=u([],o(this.indexes),!1),i=[],c=r.map((function(e){return Bs.createKey(e)})),l=n?n.indexes.map((function(e){return Bs.createKey(e)})):[];try{for(h=a(l),d=h.next();!d.done;d=h.next())p=d.value,c.includes(p)||i.push(Bs.parseKey(p))}catch(e){m={error:e}}finally{try{d&&!d.done&&(g=h.return)&&g.call(h)}finally{if(m)throw m.error}}return(f=[]).push.apply(f,u([],o(r.map((function(e){var t=new Bs({dbname:y.dbname,collectionName:y.name,keyName:y.keyName,fields:e,transaction:y._transaction,store:y._store});return y._indexers.push(t),t.ensure()}))),!1)),f.push.apply(f,u([],o(i.map((function(e){return new Bs({dbname:y.dbname,collectionName:y.name,keyName:y.keyName,fields:e,transaction:y._transaction,store:y._store}).drop()}))),!1)),[4,Promise.all(f)];case 5:return s.sent(),[4,this._transaction.commit()];case 6:return s.sent(),c.sort().join(",")===l.sort().join(",")?[3,8]:(_=ks(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:_,value:this._metadata,generation:1})]);case 7:s.sent(),s.label=8;case 8:return this._state=fs.READY,this._mutex.unlock(),[3,10];case 9:throw v=s.sent(),this._mutex.unlock(),v;case 10:return[2]}}))}))},e.prototype.close=function(){this._state=fs.CLOSED},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return"string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=Bs.createKey(e);try{for(var i=a(this._indexers),s=i.next();!s.done;s=i.next()){var o=s.value;if(r===Bs.createKey(o.fields))return o}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},e.prototype._upgradeBlockLevel=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=ks(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata,generation:1})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return s.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return s.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return s.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:s.sent(),s.label=5;case 5:s.trys.push([5,10,11,12]),n=a(this._indexers),r=n.next(),s.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:s.sent(),s.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=s.sent(),o={error:i},[3,12];case 11:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}return[7];case 12:return[3,14];case 13:throw _s.collectionInsertDuplicate;case 14:return[2]}}))}))},e.prototype._requestUpsert=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l,h,d,p,f,_;return s(this,(function(s){switch(s.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=s.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return s.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return s.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:s.sent(),s.label=5;case 5:s.trys.push([5,10,11,12]),r=a(this._indexers),i=r.next(),s.label=6;case 6:return i.done?[3,9]:[4,(l=i.value).addItem(e)];case 7:s.sent(),s.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return o=s.sent(),d={error:o},[3,12];case 11:try{i&&!i.done&&(p=r.return)&&p.call(r)}finally{if(d)throw d.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,e)];case 14:s.sent(),s.label=15;case 15:s.trys.push([15,21,22,23]),u=a(this._indexers),c=u.next(),s.label=16;case 16:return c.done?[3,20]:0===(l=c.value).diff(l.getColumnValues(n),l.getColumnValues(e))?[3,19]:[4,l.removeItem(n)];case 17:return s.sent(),[4,l.addItem(e)];case 18:s.sent(),s.label=19;case 19:return c=u.next(),[3,16];case 20:return[3,23];case 21:return h=s.sent(),f={error:h},[3,23];case 22:try{c&&!c.done&&(_=u.return)&&_.call(u)}finally{if(f)throw f.error}return[7];case 23:return[2]}}))}))},e.prototype._requestUpdate=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=s.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:s.sent(),s.label=3;case 3:s.trys.push([3,9,10,11]),r=a(this._indexers),i=r.next(),s.label=4;case 4:return i.done?[3,8]:0===(o=i.value).diff(o.getColumnValues(n),o.getColumnValues(e))?[3,7]:[4,o.removeItem(n)];case 5:return s.sent(),[4,o.addItem(e)];case 6:s.sent(),s.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return u=s.sent(),c={error:u},[3,11];case 10:try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}return[7];case 11:return[2]}}))}))},e.prototype._requestRemove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:return[4,this._blockManager.getFromBlock(e)];case 1:return(t=s.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:s.sent(),s.label=3;case 3:s.trys.push([3,8,9,10]),n=a(this._indexers),r=n.next(),s.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:s.sent(),s.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=s.sent(),o={error:i},[3,10];case 9:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}return[7];case 10:return[2]}}))}))},e.prototype._requestClear=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:s.sent(),s.label=2;case 2:s.trys.push([2,7,8,9]),e=a(this._indexers),t=e.next(),s.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:s.sent(),s.label=5;case 5:return t=e.next(),[3,3];case 6:return[3,9];case 7:return n=s.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}return[7];case 9:return[2]}}))}))},e.prototype.getByKey=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,ms(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return[3,7];case 6:throw _s.collectionNotReady;case 7:return[2]}}))}))},e.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new Os({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},e.prototype.insertOne=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw _s.collectionKeyNotGiven;return[4,this._requestInsert(ms(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw _s.collectionNotReady;case 9:return[2]}}))}))},e.prototype.insertMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l=this;return s(this,(function(s){switch(s.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:s.sent(),s.label=2;case 2:if(s.trys.push([2,12,,14]),e.some((function(e){return!l._hasPropertyOfKeyName(e)})))throw _s.collectionKeyNotGiven;s.label=3;case 3:s.trys.push([3,8,9,10]),t=a(e),n=t.next(),s.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(ms(r))]);case 5:s.sent(),s.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=s.sent(),u={error:i},[3,10];case 9:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return s.sent(),this._mutex.unlock(),[2,e];case 12:return o=s.sent(),[4,this._transaction.clear()];case 13:throw s.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw _s.collectionNotReady;case 16:return[2]}}))}))},e.prototype.upsertOne=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw _s.collectionKeyNotGiven;return[4,this._requestUpsert(ms(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw _s.collectionNotReady;case 9:return[2]}}))}))},e.prototype.upsertMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l=this;return s(this,(function(s){switch(s.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:s.sent(),s.label=2;case 2:if(s.trys.push([2,12,,14]),e.some((function(e){return!l._hasPropertyOfKeyName(e)})))throw _s.collectionKeyNotGiven;s.label=3;case 3:s.trys.push([3,8,9,10]),t=a(e),n=t.next(),s.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(ms(r))]);case 5:s.sent(),s.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=s.sent(),u={error:i},[3,10];case 9:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return s.sent(),this._mutex.unlock(),[2,e];case 12:return o=s.sent(),[4,this._transaction.clear()];case 13:throw s.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw _s.collectionNotReady;case 16:return[2]}}))}))},e.prototype.update=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw _s.collectionKeyNotGiven;return[4,this._requestUpdate(ms(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw _s.collectionNotReady;case 9:return[2]}}))}))},e.prototype.updateIf=function(e,t){return i(this,void 0,void 0,(function(){var n,r,o,u,c,l,h,d,p,f,_,v,m,g,y=this;return s(this,(function(E){switch(E.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:E.sent(),E.label=2;case 2:return E.trys.push([2,13,,15]),n=e.where,r=void 0===n?{}:n,o=e.index,u=void 0===o?null:o,c=e.backward,l=void 0!==c&&c,h=[],[4,new Us({condition:r,blockManager:this._blockManager,backward:l,indexer:this._getIndexerBy(u)}).each((function(e){return i(y,void 0,void 0,(function(){var n,i;return s(this,(function(s){if(e.error)throw e.stop(),e.error;if(e.hasNext){if(n=e.nextValue,bs(r,n)&&t.set){if("function"!=typeof t.set)for(i in t.set)n[i]=t.set[i];else t.set(n);h.push(n)}e.next()}else e.stop();return[2]}))}))}))];case 3:E.sent(),E.label=4;case 4:E.trys.push([4,9,10,11]),d=a(h),p=d.next(),E.label=5;case 5:return p.done?[3,8]:(f=p.value,[4,this._requestUpdate(ms(f))]);case 6:E.sent(),E.label=7;case 7:return p=d.next(),[3,5];case 8:return[3,11];case 9:return _=E.sent(),m={error:_},[3,11];case 10:try{p&&!p.done&&(g=d.return)&&g.call(d)}finally{if(m)throw m.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return E.sent(),this._mutex.unlock(),[2,h];case 13:return v=E.sent(),[4,this._transaction.clear()];case 14:throw E.sent(),this._mutex.unlock(),v;case 15:return[3,17];case 16:throw this._transaction.clear(),_s.collectionNotReady;case 17:return[2]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw _s.collectionNotReady;case 9:return[2]}}))}))},e.prototype.removeIf=function(e){return i(this,void 0,void 0,(function(){var t,n,r,o,u,c,l,h,d,p,f,_,v,m,g=this;return s(this,(function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r=e.index,o=void 0===r?null:r,u=e.backward,c=void 0!==u&&u,l=[],[4,new Us({condition:n,blockManager:this._blockManager,backward:c,indexer:this._getIndexerBy(o)}).each((function(e){return i(g,void 0,void 0,(function(){var t,r;return s(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,bs(n,t)&&(r=t[this.keyName],l.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),h=a(l),d=h.next(),y.label=5;case 5:return d.done?[3,8]:(p=d.value,[4,this._requestRemove(p)]);case 6:y.sent(),y.label=7;case 7:return d=h.next(),[3,5];case 8:return[3,11];case 9:return f=y.sent(),v={error:f},[3,11];case 10:try{d&&!d.done&&(m=h.return)&&m.call(h)}finally{if(v)throw v.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,l];case 13:throw _=y.sent(),this._mutex.unlock(),_;case 14:return[3,16];case 15:throw this._transaction.clear(),_s.collectionNotReady;case 16:return[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw _s.collectionNotReady;case 9:return[2]}}))}))},e.prototype.getBlob=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return void 0===t&&(t=null),i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._blobContainer.save(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),na={},ra=function(){function e(e){void 0===e&&(e={});var t=e.itemSizeLimit,n=void 0===t?4194304:t,r=e.delay,i=void 0===r?1:r,s=e.encryption,a=void 0===s?N:s;this._encryption=a,this.itemSizeLimit=n,this.delay=i,this.observer={}}return Object.defineProperty(e.prototype,"rawData",{get:function(){return na[this.dbname]},set:function(e){na[this.dbname]=e},enumerable:!1,configurable:!0}),e.prototype.observe=function(e,t,n){var r=this;this.observer[e]={},t.forEach((function(t){return r.observer[e][t]=n}))},e.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:this.dbname=e,na[this.dbname]={},n.label=1;case 1:return n.trys.push([1,,3,5]),[4,this.get(S.key)];case 2:if((t=n.sent())&&JSON.stringify(t)!==JSON.stringify(S.value))throw _s.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(S)];case 4:return n.sent(),[7];case 5:return[2]}}))}))},e.prototype.getAllKeys=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,Object.keys(na[this.dbname]).filter((function(e){return e!==S.key}))]}))}))},e.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this.getRaw(e)];case 1:return[2,(t=n.sent())?this._encryption.decrypt(t):null]}}))}))},e.prototype.getRaw=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,Es(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.get?t.get(e):null)throw n;return[2,na[this.dbname][e]]}}))}))},e.prototype.set=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return[4,Es(this.delay)];case 1:if(s.sent(),t=e.key,n=e.value,r=this.observer[t],i=r&&r.set?r.set(t):null)throw i;if(a=this._encryption.encrypt(n),o=JSON.stringify(a),t===S.key||o.length<this.itemSizeLimit)return na[this.dbname][t]=a,[2,na[this.dbname][t]];throw _s.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return[4,Es(this.delay)];case 1:return r.sent(),t=[],e.forEach((function(e){var r=e.key,i=e.value,s=n.observer[r];if(s&&s.set?s.set(r):null)t.push(_s.collectionWriteFailed);else{var a=n._encryption.encrypt(i),o=JSON.stringify(a);r===S.key||o.length<n.itemSizeLimit?(na[n.dbname][r]=a,t.push(i)):t.push(_s.storeItemSizeExceeded)}})),[2,t]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,Es(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.remove?t.remove(e):null)throw n;return na[this.dbname][e]&&delete na[this.dbname][e],[2,e]}}))}))},e.prototype.removeMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c;return s(this,(function(s){switch(s.label){case 0:return[4,Es(this.delay)];case 1:s.sent();try{for(t=a(e),n=t.next();!n.done;n=t.next()){if(r=n.value,i=this.observer[r],o=i&&i.remove?i.remove(r):null)throw o;na[this.dbname][r]&&delete na[this.dbname][r]}}catch(e){u={error:e}}finally{try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}}return[2,e]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,Es(this.delay)];case 1:return e.sent(),na[this.dbname]={},[2]}}))}))},e}(),ia="NestDBStore",sa=function(){function e(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;var t=e.encryption,n=void 0===t?N:t;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=n}return e.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:return this.dbname=e,[4,new Promise((function(e,t){if(r._window&&js)if(zs){var n=r._indexedDB.open("_testMozilla");n.onerror=function(){return t(_s.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}}else Js?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(_s.storeNotAvailableInPrivateBrowsing):e();else t(_s.storeNotAvailable)}))];case 1:return i.sent(),t=this,[4,new Promise((function(t,n){var i=r._indexedDB.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(ia,{keyPath:"key"})})),i.addEventListener("success",(function(e){return t(e.target.result)})),i.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 2:t._database=i.sent(),i.label=3;case 3:return i.trys.push([3,,5,7]),[4,this.get(S.key)];case 4:if((n=i.sent())&&JSON.stringify(n)!==JSON.stringify(S.value))throw _s.storeEncryptionInvalid;return[3,7];case 5:return[4,this.set(S)];case 6:return i.sent(),[7];case 7:return[2]}}))}))},e.prototype.getAllKeys=function(){return i(this,void 0,void 0,(function(){var e=this;return s(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){var r=e._database.transaction(ia,"readonly").objectStore(ia).getAllKeys();r.addEventListener("success",(function(e){t(e.target.result.filter((function(e){return e!==S.key})))})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 1:return[2,t.sent()]}}))}))},e.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this.getRaw(e)];case 1:return[2,(t=n.sent())?this._encryption.decrypt(t):null]}}))}))},e.prototype.getRaw=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,r){var i=t._database.transaction(ia,"readonly").objectStore(ia).get(e);i.addEventListener("success",(function(e){return n(e.target.result?e.target.result.value:null)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 1:return[2,n.sent()]}}))}))},e.prototype.set=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,[4,new Promise((function(e,i){var s=r._database.transaction(ia,"readwrite").objectStore(ia).put({key:t,value:r._encryption.encrypt(n)});s.addEventListener("success",(function(t){e(t.target.result)})),s.addEventListener("error",(function(e){return i(e.target.error)}))}))];case 1:return i.sent(),[2,n]}}))}))},e.prototype.setMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:return t=[],n=this._database.transaction(ia,"readwrite").objectStore(ia),e.forEach((function(e){var i=e.key,s=e.value;t.push(new Promise((function(e){var t=n.put({key:i,value:r._encryption.encrypt(s)});t.addEventListener("success",(function(t){e(t.target.result)})),t.addEventListener("error",(function(){e(_s.collectionWriteFailed)}))})))})),[4,Promise.all(t)];case 1:return i.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,r){var i=t._database.transaction(ia,"readwrite").objectStore(ia).delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 1:return[2,n.sent()]}}))}))},e.prototype.removeMany=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this._database.transaction(ia,"readwrite").objectStore(ia),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))})))];case 1:return[2,n.sent()]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e=this;return s(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){var r=e._database.transaction(ia,"readwrite").objectStore(ia).clear();r.addEventListener("success",(function(){return t()})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 1:return[2,t.sent()]}}))}))},e}(),aa=function(){function e(e){var t=e.AsyncStorage,n=e.encryption,r=void 0===n?N:n;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=r}return e.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},e.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},e.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:this.dbname=e,n.label=1;case 1:return n.trys.push([1,,3,5]),[4,this.get(S.key)];case 2:if((t=n.sent())&&JSON.stringify(t)!==JSON.stringify(S.value))throw _s.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(S)];case 4:return n.sent(),[7];case 5:return[2]}}))}))},e.prototype.getAllKeys=function(){return i(this,void 0,void 0,(function(){var e,t,n=this;return s(this,(function(r){switch(r.label){case 0:return e=this._getActualKey(S.key),[4,this._asyncStorage.getAllKeys()];case 1:return t=r.sent(),[2,t.filter((function(t){return n._isBelonging(t)&&t!==e})).map((function(e){return e.substring("".concat(n.dbname,"/").length)}))]}}))}))},e.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this.getRaw(e)];case 1:return[2,(t=n.sent())?this._encryption.decrypt(t):null]}}))}))},e.prototype.getRaw=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},e.prototype.set=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,r=JSON.stringify(this._encryption.encrypt(n)),t===S.key||r.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),r)]:[3,2];case 1:return i.sent(),[2,JSON.parse(r)];case 2:throw _s.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l,h,d;return s(this,(function(s){switch(s.label){case 0:t=[],n=[];try{for(r=a(e),i=r.next();!i.done;i=r.next()){o=i.value;try{u=o.key,c=o.value,l=JSON.stringify(this._encryption.encrypt(c)),u===S.key||l.length<this.itemSizeLimit?(n.push([this._getActualKey(u),l]),t.push(c)):t.push(_s.storeItemSizeExceeded)}catch(e){t.push(_s.collectionWriteFailed)}}}catch(e){h={error:e}}finally{try{i&&!i.done&&(d=r.return)&&d.call(r)}finally{if(h)throw h.error}}s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return s.sent(),[3,4];case 3:return s.sent(),[2,new Array(t.length).fill(_s.collectionWriteFailed)];case 4:return[2,t]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._asyncStorage.removeItem(this._getActualKey(e))];case 1:return t.sent(),[2,e]}}))}))},e.prototype.removeMany=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2,e]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[4,this.remove(S.key)];case 3:return t.sent(),[2]}}))}))},e}(),oa="[NESTDB]",ua=!0,ca=function(){function e(){}return e.off=function(){ua=!1},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ua&&console.log.apply(console,u(["".concat(oa,"[LOG]")],o(e),!1))},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ua&&console.warn.apply(console,u(["".concat(oa,"[WARNING]")],o(e),!1))},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ua&&console.error.apply(console,u(["".concat(oa,"[ERROR]")],o(e),!1))},e}();!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(Zs||(Zs={}));var la,ha=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=Zs.INIT,this._config=i||new ps({dbname:t}),this._store=r,this._event={success:Cs,error:Cs,upgrade:Ss},this._collections=new Map,this._globalMutex=new ea("".concat(this.name,".lock")),this._config.disableLogger&&ca.off(),new Hs({dbname:t,limit:this._config.cacheLimit})}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.estimateUsage=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,(t=this._store,i(void 0,void 0,void 0,(function(){var e,n,r,i,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return e=0,[4,t.getAllKeys()];case 1:n=s.sent(),s.label=2;case 2:s.trys.push([2,7,8,9]),r=a(n),i=r.next(),s.label=3;case 3:return i.done?[3,6]:(o=i.value,[4,t.getRaw(o)]);case 4:u=s.sent(),e+=JSON.stringify(u).length,s.label=5;case 5:return i=r.next(),[3,3];case 6:return[3,9];case 7:return c=s.sent(),l={error:c},[3,9];case 8:try{i&&!i.done&&(h=r.return)&&h.call(r)}finally{if(l)throw l.error}return[7];case 9:return[2,e]}}))})))];case 1:return[2,e.sent()]}var t}))}))},e.prototype.commitSchema=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return this._state!==Zs.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=e.collectionName,n=e.keyName,r=e.index,i=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new ta({dbname:this.name,collectionName:t,keyName:n,indexes:i,store:this._store})),[4,this._collections.get(t).init()];case 1:return s.sent(),[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw _s.databaseSchemaNotOnUpgrade;case 3:return[2]}}))}))},e.prototype.open=function(){var e;return i(this,void 0,void 0,(function(){var t,n,r,a,o=this;return s(this,(function(u){switch(u.label){case 0:return[4,this._globalMutex.lock()];case 1:if(u.sent(),this._state===Zs.OPENED)return[3,15];this._state=Zs.OPENING,u.label=2;case 2:return u.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return u.sent(),c=this.name,t="".concat(Rs(c),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:return r=null!==(e=u.sent())&&void 0!==e?e:n,[2,new Promise((function(e,n){var a=function(e){r.version<o._version?o._event.upgrade(r.version,(function(n){return i(o,void 0,void 0,(function(){var i;return s(this,(function(s){switch(s.label){case 0:if(n)return[3,5];r.version++,r.collectionNames=Array.from(this._collections.keys()),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r,generation:this._version})];case 2:return s.sent(),e({continued:!0}),[3,4];case 3:return i=s.sent(),e({continued:!1,err:i}),[3,4];case 4:return[3,6];case 5:e({continued:!1,err:n}),s.label=6;case 6:return[2]}}))}))})):e({continued:!1})},u=function(t){var c=t.continued,l=void 0!==c&&c,h=t.err,d=void 0===h?null:h;if(l)setTimeout((function(){return a(u)}),10);else if(d)ca.error(d.message),o._globalMutex.unlock(),o._event.error(d),n(d);else{var p=[];r.collectionNames.forEach((function(e){o._collections.has(e)||p.push(i(o,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,ta.metadataOf(this.name,e,this._store)];case 1:return(t=r.sent())?(n=new ta({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(e,n),[4,n.init()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))})))})),Promise.all(p).then((function(){o._state=Zs.OPENED,o._globalMutex.unlock(),o._event.success(),e()})).catch((function(e){ca.error(e.message),o._globalMutex.unlock(),o._event.error(e),n(e)}))}};a(u)}))];case 5:switch(a=u.sent(),a.code){case zi.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case zi.STORE_NOT_AVAILABLE:return[3,8];case zi.STORE_ENCRYPTION_INVALID:return[3,10]}return[3,13];case 6:return ca.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new ra({}),this._globalMutex.unlock(),this._event.error(a),[4,this.open()];case 7:return u.sent(),[3,14];case 8:return ca.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new ra({}),this._globalMutex.unlock(),this._event.error(a),[4,this.open()];case 9:return u.sent(),[3,14];case 10:return ca.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return u.sent(),this._globalMutex.unlock(),this._event.error(a),[4,this.open()];case 12:return u.sent(),[3,14];case 13:throw ca.error(a.message),this._globalMutex.unlock(),this._event.error(a),a;case 14:return[3,15];case 15:return[2]}var c}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=Zs.CLOSED},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return i(this,void 0,void 0,(function(){var e,t=this;return s(this,(function(n){switch(n.label){case 0:return this.close(),(e=Hs.get(this.name))&&e.clearByCondition((function(e){return e.key.startsWith(Rs(t.name))})),[4,this._store.clear()];case 1:return n.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=Ss;else this._event[e]=Cs},e.prototype.collection=function(e){return this._collections.get(e)||null},e}();e.RestrictionType=void 0,(la=e.RestrictionType||(e.RestrictionType={})).MUTED="muted",la.BANNED="banned";var da,pa=function(){function t(t){var n,r,i;this.restrictionType=null,this.description=null,this.endAt=-1,y(e.RestrictionType,t.restriction_type)&&(this.restrictionType=t.restriction_type),this.description=null!==(n=t.description)&&void 0!==n?n:null,this.endAt=null!==(i=null!==(r=t.end_at)&&void 0!==r?r:t.muted_end_at)&&void 0!==i?i:-1}return t.payloadify=function(e){return e?D({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null},t}(),fa=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.restrictionInfo=null,r.restrictionInfo=new pa(n),r}return n(t,e),t.payloadify=function(t){return t?D(r(r({},e.payloadify.call(this,t)),pa.payloadify(t.restrictionInfo))):null},t}(ht),_a={data:null,customType:null,mentionType:e.MentionType.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},va=function(t){return g("string",t.data,!0)&&g("string",t.customType,!0)&&y(e.MentionType,t.mentionType)&&b("string",t.mentionedUserIds,!0)&&b(ht,t.mentionedUsers,!0)&&g("string",t.mentionedMessageTemplate,!0)&&b(xt,t.metaArrays,!0)&&y(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&g(Gt,t.appleCriticalAlertOptions,!0)},ma=r(r({},_a),{message:null,translationTargetLanguages:null,pollId:null}),ga=function(e){return va(e)&&g("string",e.message,!0)&&b("string",e.translationTargetLanguages,!0)&&g("number",e.pollId,!0)},ya=r({},_a),Ea=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.token,s=t.limit,a=e.call(this)||this;return a.method=d.GET,a.path="".concat(Je(r),"/").concat(encodeURIComponent(n),"/operators"),a.params={token:i,limit:s},a}return n(t,e),t}(x),ba=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.operators=n.operators.map((function(e){return new ht(t,e)})),r.token=n.next,r}return n(t,e),t}(F),Ca=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return n(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=wt.of(this._iid).requestQueue,n=new Ea(r(r({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(n)]):[3,2]):[3,5];case 1:return i=s.sent(),a=i.as(ba),o=a.operators,u=a.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,o];case 2:return[2,e];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Bn),Ta=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.limit,a=t.token;return(n=e.call(this)||this).method=d.GET,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/mute"),n.params={limit:s,token:a},n}return n(t,e),t}(x),Ia=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.mutedUsers=[];var i=n.next,s=n.muted_list;return r.token=i,s&&s.length>0&&(r.mutedUsers=s.map((function(e){return new fa(t,e)}))),r}return n(t,e),t}(F),Sa=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return n(t,e),t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new Ta(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(Ia),a=i.mutedUsers,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Bn),Na=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.limit,a=t.token;return(n=e.call(this)||this).method=d.GET,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/ban"),n.params=D({limit:s,token:a}),n}return n(t,e),t}(x),wa=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.bannedUsers=[];var i=n.next,s=n.banned_list;return r.token=i,s&&s.length>0&&(r.bannedUsers=s.map((function(e){return new fa(t,e.user)}))),r}return n(t,e),t}(F),Ma=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return n(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new Na(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(wa),a=i.bannedUsers,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},t}(Bn);e.ReportCategory=void 0,(da=e.ReportCategory||(e.ReportCategory={})).SPAM="spam",da.HARASSING="harassing",da.SUSPICIOUS="suspicious",da.INAPPROPRIATE="inappropriate";var Aa=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.operatorUserIds;return(n=e.call(this)||this).method=d.POST,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:s},n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Ua=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.operatorUserIds;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:s},n}return n(t,e),t}(x);!function(e){function t(t,n){return e.call(this,t,n)||this}n(t,e)}(F);var Oa=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.userId;return(n=e.call(this)||this).method=d.GET,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/mute/").concat(s),n}return n(t,e),t}(x),Ra=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.isMuted=!1,r.startAt=null,r.endAt=null,r.remainingDuration=null,r.description=null;var i=n.is_muted,s=n.start_at,a=n.end_at,o=n.remaining_duration,u=n.description;return r.isMuted=i,r.startAt=s,r.endAt=a,r.remainingDuration=o,r.description=u,r}return n(t,e),t}(F),La=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.keys;return(n=e.call(this)||this).method=d.GET,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={keys:s,include_ts:!0},n}return n(t,e),t}(x),ka=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.metadata,s=n.ts;return r.metadata=i,r.ts=null!=s?s:null,r}return n(t,e),t}(F),Da=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.metadata,a=t.upsert;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:s,include_ts:!0,upsert:null!=a&&a},n}return n(t,e),t}(x),Pa=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.metadata,s=n.ts;return r.metadata=i,r.ts=null!=s?s:null,r}return n(t,e),t}(F),xa=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.created=null,i.updated=null,i.deleted=null,r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return n(t,e),t}(j),Fa=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.key;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metadata/").concat(s),n.params={include_ts:!0},n}return n(t,e),t}(x),qa=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.ts;return r.ts=null!=i?i:null,r}return n(t,e),t}(F),Ga=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={include_ts:!0},n}return n(t,e),t}(x),Ha=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.ts;return r.ts=null!=i?i:null,r}return n(t,e),t}(F),Va=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.keys;return(n=e.call(this)||this).method=d.GET,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={keys:s},n}return n(t,e),t}(x),Ka=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return n(t,e),t}(F),Qa=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.metaCounter;return(n=e.call(this)||this).method=d.POST,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:s},n}return n(t,e),t}(x),Ba=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return n(t,e),t}(F),ja=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.metaCounter,a=t.upsert,o=void 0!==a&&a,u=t.mode,c=void 0===u?"set":u;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:s,upsert:o,mode:c},n}return n(t,e),t}(x),za=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return n(t,e),t}(F),Wa=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.created=null,i.updated=null,i.deleted=null,r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return n(t,e),t}(j),Ya=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.key;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metacounter/").concat(s),n.params=null,n}return n(t,e),t}(x);!function(e){function t(t,n){return e.call(this,t,n)||this}n(t,e)}(F);var Ja=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params=null,n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Xa=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.userId,a=t.seconds,o=t.description;return(n=e.call(this)||this).method=d.POST,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/mute"),n.params={user_id:s,seconds:a,description:o},n}return n(t,e),t}(x);!function(e){function t(t,n){return e.call(this,t,n)||this}n(t,e)}(F);var Za=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new fa(t,r.data),i}return n(t,e),t}(j),$a=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.userId;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/mute/").concat(encodeURIComponent(s)),n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var eo=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new fa(t,r.data),i}return n(t,e),t}(j),to=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.userId,a=t.seconds,o=t.description;return(n=e.call(this)||this).method=d.POST,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/ban"),n.params=D({user_id:s,seconds:a,description:o}),n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var no=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.memberCount=null,i.joinedMemberCount=null,i.user=new fa(t,r.data),r.data.member_count&&(i.memberCount=r.data.member_count),r.data.joined_member_count&&(i.joinedMemberCount=r.data.joined_member_count),i}return n(t,e),t}(j),ro=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.userId;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/ban/").concat(encodeURIComponent(s)),n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var io=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new fa(t,r.data),i}return n(t,e),t}(j),so=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.freezing;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(Je(i),"/").concat(encodeURIComponent(r),"/freeze"),n.params={freeze:s},n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var ao=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.freeze=r.data.freeze,i}return n(t,e),t}(j),oo=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.category,a=t.userId,o=t.description;return(n=e.call(this)||this).method=d.POST,n.path="".concat(Xe(i),"/").concat(encodeURIComponent(r)),n.params={report_category:s,reporting_user_id:a,report_description:o},n}return n(t,e),t}(x),uo=function(t){function r(n){var r=this,i=n.channelUrl,s=n.channelType,a=n.category,o=n.userId,u=n.offendingUserId,c=n.description;return(r=t.call(this)||this).method=d.POST,r.path="".concat(be,"/users/").concat(u),r.params={channel_url:i,channel_type:s===e.ChannelType.OPEN?"open_channels":"group_channels",report_category:a,reporting_user_id:o,report_description:c},r}return n(r,t),r}(x),co=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.category,a=t.userId,o=t.offendingUserId,u=t.messageId,c=t.description;return(n=e.call(this)||this).method=d.POST,n.path="".concat(Xe(i),"/").concat(encodeURIComponent(r),"/messages/").concat(u),n.params={report_category:s,reporting_user_id:a,report_description:c,offending_user_id:o},n}return n(t,e),t}(x),lo=function(t){function r(n){var r=[];return n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?r=n.mentionedUserIds:n.mentionedUsers&&(r=n.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"MESG",ackRequired:!0,payload:D({channel_url:n.channelUrl,message:n.message,data:n.data,custom_type:n.customType,metaarray:n.metaArrays,mention_type:n.mentionType,mentioned_user_ids:r,mentioned_message_template:n.mentionedMessageTemplate,target_langs:n.translationTargetLanguages,push_option:n.pushNotificationDeliveryOption&&n.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?n.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:n.appleCriticalAlertOptions,silent:n.silent,reply_to_channel:n.isReplyToChannel,parent_message_id:n.parentMessageId>0?n.parentMessageId:null,req_id:n.reqId,poll_id:n.pollId})})||this}return n(r,t),r}(z),ho=function(e){function t(t,n,r){var i,s,a,o=this;(o=e.call(this,t,"MESG",r)||this).message=new nn(t,r);var u=wt.of(t).sdkState;return o.isMentioned=Ze(o.message.mentionType,null!==(i=o.message.mentionedUserIds)&&void 0!==i?i:null===(s=o.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(a=r.force_update_last_message)&&void 0!==a&&a,o}return n(t,e),t}(j),po=function(t){function r(n){var r=[];return n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?r=n.mentionedUserIds:n.mentionedUsers&&(r=n.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"MEDI",ackRequired:!0,payload:D({channel_url:n.channelUrl,msg_id:n.messageId,message:n.message,data:n.data,custom_type:n.customType,metaarray:n.metaArrayParams,mention_type:n.mentionType,mentioned_user_ids:r,mentioned_message_template:n.mentionedMessageTemplate,apple_critical_alert_options:n.appleCriticalAlertOptions,poll_id:n.pollId})})||this}return n(r,t),r}(z),fo=function(e){function t(t,n,r){var i,s,a,o,u,c,l=this;(l=e.call(this,t,"MEDI",r)||this).message=new nn(t,r);var h=wt.of(t).sdkState;return l.mentionCountChange=$e({mentionType:null!==(s=null===(i=r.old_values)||void 0===i?void 0:i.mention_type)&&void 0!==s?s:null,mentionedUserIds:null!==(o=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return n(t,e),t}(j),_o=function(t){function r(n){var r=[];return n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?r=n.mentionedUserIds:n.mentionedUsers&&(r=n.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"FEDI",ackRequired:!0,payload:D({channel_url:n.channelUrl,msg_id:n.messageId,data:n.data,custom_type:n.customType,metaarray:n.metaArrayParams,mention_type:n.mentionType,mentioned_user_ids:r,apple_critical_alert_options:n.appleCriticalAlertOptions})})||this}return n(r,t),r}(z),vo=function(e){function t(t,n,r){var i,s,a,o,u,c,l=this;(l=e.call(this,t,"FEDI",r)||this).message=new an(t,r);var h=wt.of(t).sdkState;return l.mentionCountChange=$e({mentionType:null!==(s=null===(i=r.old_values)||void 0===i?void 0:i.mention_type)&&void 0!==s?s:null,mentionedUserIds:null!==(o=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return n(t,e),t}(j),mo=function(e){function t(t){var n=e.call(this)||this;return n.method=d.DELETE,n.path="".concat(Je(t.channelType),"/").concat(t.channelUrl,"/messages/").concat(t.messageId),n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var go,yo=function(e){function t(t,n,r){var i=e.call(this,t,"DELM",r)||this;return i.channelUrl=r.channel_url,i.channelType=r.channel_type,i.messageId=Number(r.msg_id),i}return n(t,e),t}(j),Eo=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,s=t.reactionKey,a=e.call(this)||this;return a.method=d.POST,a.path="".concat(Je(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/reactions"),a.params={reaction:s},a}return n(t,e),t}(x),bo=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.reactionEvent=new Dt(n),r}return n(t,e),t}(F),Co=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,s=t.reactionKey,a=e.call(this)||this;return a.method=d.DELETE,a.path="".concat(Je(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/reactions"),a.params={reaction:s},a}return n(t,e),t}(x),To=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.reactionEvent=new Dt(r({},n)),i}return n(t,e),t}(F),Io=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,s=t.translationTargetLanguages,a=e.call(this)||this;return a.method=d.POST,a.path="".concat(Je(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i),"/translation"),a.params={target_langs:s},a}return n(t,e),t}(x),So=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new nn(t,n),r}return n(t,e),t}(F),No=function(t){function r(n){var r,i=this;i=t.call(this)||this;var s=[];n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?s=n.mentionedUserIds:n.mentionedUsers&&(s=n.mentionedUsers.map((function(e){return e.userId}))));var a=n.channelType,o=n.channelUrl;return i.method=d.POST,i.path="".concat(Je(a),"/").concat(encodeURIComponent(o),"/scheduled_messages"),i.params={req_id:n.reqId,scheduled_at:n.scheduledAt,message_type:ae.USER,message:n.message,custom_type:n.customType,data:n.data,mention_type:n.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=n.metaArrays)||void 0===r?void 0:r.map((function(e){return xt.payloadify(e)})),apple_critical_alert_options:Gt.payloadify(n.appleCriticalAlertOptions),target_langs:n.translationTargetLanguages,push_option:n.pushNotificationDeliveryOption},i}return n(r,t),r}(x),wo=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new nn(t,n),r}return n(t,e),t}(F),Mo=function(t){function r(n){var r,i=this;i=t.call(this)||this;var s=[];n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?s=n.mentionedUserIds:n.mentionedUsers&&(s=n.mentionedUsers.map((function(e){return e.userId}))));var a=n.channelType,o=n.channelUrl;return i.method=d.POST,i.path="".concat(Je(a),"/").concat(encodeURIComponent(o),"/scheduled_messages"),i.params={req_id:n.reqId,scheduled_at:n.scheduledAt,message_type:ae.FILE,url:n.fileUrl,file_name:n.fileName,file_size:n.fileSize,file_type:n.mimeType,thumbnails:n.thumbnailSizes?n.thumbnailSizes.map((function(e){return jt.payloadify(e)})):[],custom_type:n.customType,data:n.data,require_auth:n.requireAuth,mention_type:n.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=n.metaArrays)||void 0===r?void 0:r.map((function(e){return xt.payloadify(e)})),apple_critical_alert_options:Gt.payloadify(n.appleCriticalAlertOptions),push_option:n.pushNotificationDeliveryOption},i}return n(r,t),r}(x),Ao=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new an(t,n),r}return n(t,e),t}(F),Uo=function(t){function l(n,r){var i,s,a,o,u=this;return(u=t.call(this,n)||this).url="",u.channelType=e.ChannelType.BASE,u.name="",u.coverUrl="",u.customType="",u.data="",u.isFrozen=!1,u.isEphemeral=!1,u.creator=null,u.createdAt=0,u.url=r.channel_url,u.name=null!==(i=r.name)&&void 0!==i?i:"",u.coverUrl=null!==(s=r.cover_url)&&void 0!==s?s:"",u.customType=null!==(a=r.custom_type)&&void 0!==a?a:"",u.data=null!==(o=r.data)&&void 0!==o?o:"",u.isFrozen=!!g("boolean",r.freeze)&&r.freeze,u.isEphemeral=!!g("boolean",r.is_ephemeral)&&r.is_ephemeral,u.creator=r.created_by?new ht(u._iid,r.created_by):null,u.createdAt=1e3*r.created_at,u._cachedMetaData=new Map,r.metadata&&r.ts&&Object.keys(r.metadata).forEach((function(e){u._cachedMetaData.set(e,{value:r.metadata[e],isRemoved:!1,updatedAt:r.ts})})),u}return n(l,t),l.payloadify=function(e){return D(r(r({},t.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:ht.payloadify(e.creator),created_at:e.createdAt/1e3}))},l.prototype.isGroupChannel=function(){return this.channelType===e.ChannelType.GROUP},l.prototype.isOpenChannel=function(){return this.channelType===e.ChannelType.OPEN},Object.defineProperty(l.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e},enumerable:!1,configurable:!0}),l.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){var i=n._cachedMetaData.get(r);(!i||i.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))},l.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!1,r.updatedAt=t)}))},l.prototype._generateRequestId=function(){return"rq-".concat(U())},l.prototype.isIdentical=function(e){return e&&this.url===e.url},l.prototype.isEqual=function(e){return m(this,e)},l.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new Ca(this._iid,this.url,this.channelType,e)},l.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new Sa(this._iid,this.url,this.channelType,e)},l.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new Ma(this._iid,this.url,this.channelType,e)},l.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new jn(this._iid,this.url,this.channelType,e)},l.prototype.addOperators=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new Aa({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},l.prototype.removeOperators=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new Ua({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},l.prototype.getMyMutedInfo=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Oa({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),a=i.as(Ra),o=a.isMuted,u=a.startAt,c=a.endAt,l=a.remainingDuration,h=a.description,[2,{isMuted:o,startAt:u,endAt:c,remainingDuration:l,description:h}]}}))}))},l.prototype.getMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new La({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(ka),a=i.metadata,o=i.ts,this._upsertCachedMetaData(a,o),[2,a]}}))}))},l.prototype.getAllMetaData=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid).requestQueue,t=new La({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(ka),i=r.metadata,a=r.ts,this._upsertCachedMetaData(i,a),[2,i]}}))}))},l.prototype.createMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid).requestQueue,n=new et({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(tt).metaData,this._upsertCachedMetaData(i,0),[2,i]}}))}))},l.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return n=wt.of(this._iid).requestQueue,r=new Da({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,n.send(r)];case 1:return i=s.sent(),a=i.as(Pa),o=a.metadata,u=a.ts,this._upsertCachedMetaData(o,u),[2,o]}}))}))},l.prototype.deleteMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new Fa({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(qa).ts,this._removeFromCachedMetaData([e],i),[2]}}))}))},l.prototype.deleteAllMetaData=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return e=wt.of(this._iid).requestQueue,t=new Ga({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n=i.sent(),r=n.as(Ha).ts,this._removeFromCachedMetaData(u([],o(this._cachedMetaData.keys()),!1),r),[2]}}))}))},l.prototype.getMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new Va({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Ka).metaCounter]}}))}))},l.prototype.getAllMetaCounters=function(){return i(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:return e=wt.of(this._iid).requestQueue,t=new Va({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(Ka).metaCounter]}}))}))},l.prototype.createMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return t=wt.of(this._iid).requestQueue,n=new Qa({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Ba).metaCounter]}}))}))},l.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return n=wt.of(this._iid).requestQueue,r=new ja({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(za).metaCounter]}}))}))},l.prototype.increaseMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return t=wt.of(this._iid).requestQueue,n=new ja({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(za).metaCounter]}}))}))},l.prototype.decreaseMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return t=wt.of(this._iid).requestQueue,n=new ja({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(za).metaCounter]}}))}))},l.prototype.deleteMetaCounter=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new Ya({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},l.prototype.deleteAllMetaCounters=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=wt.of(this._iid).requestQueue,t=new Ja({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},l.prototype.muteUser=function(e,t,n){return i(this,void 0,void 0,(function(){return s(this,(function(r){return[2,this.muteUserWithUserId(e.userId,t,n)]}))}))},l.prototype.muteUserWithUserId=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",e)&&g("number",t,!0)&&g("string",n,!0)).throw(f.invalidParameters),r=wt.of(this._iid).requestQueue,i=new Xa({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},l.prototype.unmuteUser=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.unmuteUserWithUserId(e.userId)]}))}))},l.prototype.unmuteUserWithUserId=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new $a({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},l.prototype.banUser=function(e,t,n){return i(this,void 0,void 0,(function(){return s(this,(function(r){return[2,this.banUserWithUserId(e.userId,t,n)]}))}))},l.prototype.banUserWithUserId=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",e)&&g("number",t,!0)&&g("string",n,!0)).throw(f.invalidParameters),r=wt.of(this._iid).requestQueue,i=new to({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},l.prototype.unbanUser=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.unbanUserWithUserId(e.userId)]}))}))},l.prototype.unbanUserWithUserId=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid).requestQueue,n=new ro({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},l.prototype.freeze=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=wt.of(this._iid).requestQueue,t=new so({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!0,[2]}}))}))},l.prototype.unfreeze=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=wt.of(this._iid).requestQueue,t=new so({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!1,[2]}}))}))},l.prototype.getMessagesByMessageId=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},pn),t),ct(g("number",e)&&fn(n)).throw(f.invalidParameters),[4,kn.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,n)];case 1:return[2,i.sent()]}}))}))},l.prototype.getMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},pn),t),ct(g("number",e)&&fn(n)).throw(f.invalidParameters),[4,kn.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,n)];case 1:return[2,i.sent()]}}))}))},l.prototype.getMessageChangeLogsSinceTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},_n),t),ct(g("number",e)&&vn(n)).throw(f.invalidParameters),[4,kn.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,i.sent()]}}))}))},l.prototype.getMessageChangeLogsSinceToken=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},_n),t),ct(g("string",e)&&vn(n)).throw(f.invalidParameters),[4,kn.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,i.sent()]}}))}))},l.prototype._createPendingSendableMessagePayload=function(t,n,r){var i=wt.of(this._iid).sessionManager;return D({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,sorted_metaarray:t.metaArrays?t.metaArrays.map((function(e){return xt.payloadify(e)})):null,apple_critical_alert_options:t.appleCriticalAlertOptions?Gt.payloadify(t.appleCriticalAlertOptions):null,created_at:r,user:Qt.payloadify(i.currentUser),req_id:n,request_state:e.SendingStatus.PENDING,mentioned_user_ids:t.mentionedUserIds,mentioned_users:t.mentionedUsers})},l.prototype._createPendingUserMessage=function(t,n,i){var s,o,u={};if(t.translationTargetLanguages)try{for(var c=a(t.translationTargetLanguages),l=c.next();!l.done;l=c.next()){u[l.value]=""}}catch(e){s={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(s)throw s.error}}var h=D(r(r({},this._createPendingSendableMessagePayload(t,n,i)),{type:e.MessageType.USER,message:t.message,translations:u})),d=new nn(this._iid,h);return d.messageParams=t,d},l.prototype._createPendingScheduledUserMessage=function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},l.prototype._createPendingFileMessage=function(t,n,i){var s=D(r(r({},this._createPendingSendableMessagePayload(t,n,i)),{type:e.MessageType.FILE,url:t.fileUrl,file:{name:t.fileName,size:t.fileSize,type:t.mimeType,data:t.data},thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),a=new an(this._iid,s);return a.messageParams=t,a},l.prototype._createPendingScheduledFileMessage=function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},l.prototype._markMessageAsFailed=function(t,n,r){void 0===r&&(r=!1),t.errorCode=n.code,n.code===c.REQUEST_CANCELED?t.sendingStatus=e.SendingStatus.CANCELED:r||(t.sendingStatus=e.SendingStatus.FAILED)},l.prototype.sendUserMessage=function(e){var t=r(r({},Dr),e);return ct(Pr(t)).throw(f.invalidParameters),this._sendUserMessage(t)},l.prototype._sendUserMessage=function(t,n){var a=this;void 0===n&&(n=null);var o=wt.of(this._iid),u=o.dispatcher,c=o.requestQueue,l=n,h=Date.now(),d=new Dn;if(!l){l=this._generateRequestId();var f=wt.of(this._iid).dispatcher;Re(2).then((function(){var n=a._createPendingUserMessage(t,l,h);f.dispatch(new yn({messages:[n],source:e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING})),De((function(){return i(a,void 0,void 0,(function(){return s(this,(function(e){return[2,d._trigger(null,n)]}))}))}))}))}var _=new lo(r({channelUrl:this.url,channelType:this.channelType,reqId:l},t));return c.send(_).then((function(t){var n=t.as(ho).message;u.dispatch(new yn({messages:[n],source:e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS})),De((function(){return i(a,void 0,void 0,(function(){return s(this,(function(e){return[2,d._trigger(null,n)]}))}))}))})).catch((function(n){if(p(n))throw n;Re(2).then((function(){var r=a._createPendingUserMessage(t,l,h),o=wt.of(a._iid).cacheContext.localCacheEnabled&&C(n.code);a._markMessageAsFailed(r,n,o),u.dispatch(new yn({messages:[r],source:r.sendingStatus===e.SendingStatus.PENDING?e.MessageEventSource.REQUEST_RESEND_MESSAGE:e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED})),De((function(){return i(a,void 0,void 0,(function(){return s(this,(function(e){return[2,d._trigger(n,r)]}))}))}))}))})),d},l.prototype._autoResendUserMessage=function(e){return ct(e instanceof nn).throw(f.invalidParameters),this._sendUserMessage(e.messageParams,e.reqId)},l.prototype.resendUserMessage=function(e){var t;return i(this,void 0,void 0,(function(){var n,r;return s(this,(function(i){return ct(e instanceof nn&&!e.scheduledInfo).throw(f.invalidParameters),n=new ee,r=null!==(t=e.messageParams)&&void 0!==t?t:function(e){var t;return D({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)})}(e),this._sendUserMessage(r,e.reqId).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},l.prototype.updateUserMessage=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},ma),t),ct(g("number",e)&&ga(n)).throw(f.invalidParameters),i=wt.of(this._iid).requestQueue,a=new po(r({channelType:this.channelType,channelUrl:this.url,messageId:e},n)),[4,i.send(a)];case 1:return o=s.sent(),[2,o.as(fo).message]}}))}))},l.prototype.copyUserMessage=function(t,n){var a,o,u;return i(this,void 0,void 0,(function(){var i,c;return s(this,(function(s){return ct(t instanceof l&&n instanceof nn&&n.sendingStatus===e.SendingStatus.SUCCEEDED&&t.url===n.channelUrl&&!n.scheduledInfo).throw(f.invalidParameters),ct(!n.poll).throw(f.notSupportedError),i=new ee,c=null!==(a=n.messageParams)&&void 0!==a?a:r(r({},n),{mentionType:n.mentionType,mentionedUserIds:null!==(o=n.mentionedUserIds)&&void 0!==o?o:null===(u=n.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(n.translations),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),t._sendUserMessage(c).onSucceeded((function(e){return i.resolve(e)})).onFailed((function(e){return i.reject(e)})),[2,i.promise]}))}))},l.prototype.translateUserMessage=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(e instanceof nn&&e.messageId>0&&b("string",t)).throw(f.invalidParameters),n=wt.of(this._iid).requestQueue,r=new Io({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(So).message]}}))}))},l.prototype._createScheduledUserMessage=function(e,t){var n=this,a=wt.of(this._iid).requestQueue,o=Date.now(),u=this._generateRequestId();Re(2).then((function(){var r=n._createPendingScheduledUserMessage(e,u,o);De((function(){return i(n,void 0,void 0,(function(){return s(this,(function(e){return[2,t._trigger(null,r)]}))}))}))}));var c=new No(r({reqId:u,channelType:this.channelType,channelUrl:this.url},e));a.send(c).then((function(e){var r=e.as(wo).message;De((function(){return i(n,void 0,void 0,(function(){return s(this,(function(e){return[2,t._trigger(null,r)]}))}))}))})).catch((function(r){if(p(r))throw r;Re(2).then((function(){var a=n._createPendingScheduledUserMessage(e,u,o);n._markMessageAsFailed(a,r),De((function(){return i(n,void 0,void 0,(function(){return s(this,(function(e){return[2,t._trigger(r,a)]}))}))}))}))}))},l.prototype.sendFileMessage=function(e){var t=r(r({},Hr),e);return ct(Vr(t)).throw(f.invalidParameters),this._sendFileMessage(t)},l.prototype._sendFileMessage=function(t,n){var r=this;void 0===n&&(n=null);var a=wt.of(this._iid).dispatcher,o=kn.of(this._iid).fileMessageQueue,u=n,c=Date.now(),l=new Dn;return u||(u=this._generateRequestId(),Re(2).then((function(){var n=r._createPendingFileMessage(t,u,c);a.dispatch(new yn({messages:[n],source:e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING})),De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(e){return[2,l._trigger(null,n)]}))}))}))}))),o.request(this,u,t).then((function(t){a.dispatch(new yn({messages:[t],source:e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS})),De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(e){return[2,l._trigger(null,t)]}))}))}))})).catch((function(n){if(p(n))throw n;Re(2).then((function(){var o=r._createPendingFileMessage(t,u,c),h=wt.of(r._iid).cacheContext.localCacheEnabled&&C(n.code);r._markMessageAsFailed(o,n,h),a.dispatch(new yn({messages:[o],source:o.sendingStatus===e.SendingStatus.PENDING?e.MessageEventSource.REQUEST_RESEND_MESSAGE:e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED})),De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(e){return[2,l._trigger(n,o)]}))}))}))}))})),l},l.prototype._autoResendFileMessage=function(e){ct(e instanceof an).throw(f.invalidParameters);var t=wt.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))},l.prototype._createScheduledFileMessage=function(e,t,n,a){var o=this,u=wt.of(this._iid).requestQueue,c=new Mo(r(r({reqId:n,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));u.send(c).then((function(e){var n=e.as(Ao).message;De((function(){return i(o,void 0,void 0,(function(){return s(this,(function(e){return[2,t._trigger(null,n)]}))}))}))})).catch((function(r){if(p(r))throw r;Re(2).then((function(){var u=o._createPendingScheduledFileMessage(e,n,a);o._markMessageAsFailed(u,r),De((function(){return i(o,void 0,void 0,(function(){return s(this,(function(e){return[2,t._trigger(r,u)]}))}))}))}))}))},l.prototype.sendFileMessages=function(e){var t,n;ct(e.every((function(e){return Vr(r(r({},Hr),e))}))).throw(f.invalidParameters);var i=new Dn;try{for(var s=a(e),o=s.next();!o.done;o=s.next()){var u=o.value;this.sendFileMessage(u).onPending((function(e){return i._trigger(null,e)})).onFailed((function(e,t){return i._trigger(e,t)})).onSucceeded((function(e){return i._trigger(null,e)}))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i},l.prototype.resendFileMessage=function(e,t){var n;return i(this,void 0,void 0,(function(){var r,i,a;return s(this,(function(s){return r=Boolean(e.url)||T(t)||T(null===(n=e.messageParams)||void 0===n?void 0:n.file),ct(e instanceof an&&r&&!e.scheduledInfo).throw(f.invalidParameters),i=new ee,a=function(e,t){var n;return void 0===t&&(t=null),e.messageParams?(!e.url&&T(t)&&(e.messageParams.file=t),e.messageParams):D({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:null!=t?t:null===(n=e.messageParams)||void 0===n?void 0:n.file,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))})}(e,t),this._sendFileMessage(a,e.reqId).onFailed((function(e){return i.reject(e)})).onSucceeded((function(e){return i.resolve(e)})),[2,i.promise]}))}))},l.prototype.updateFileMessage=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},ya),t),ct(g("number",e)&&function(e){return va(e)}(n)).throw(f.invalidParameters),i=wt.of(this._iid).requestQueue,a=new _o(r({channelType:this.channelType,channelUrl:this.url,messageId:e},n)),[4,i.send(a)];case 1:return o=s.sent(),[2,o.as(vo).message]}}))}))},l.prototype.cancelUploadingFileMessage=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return ct(g("string",e)).throw(f.invalidParameters),kn.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},l.prototype.copyFileMessage=function(t,n){var a,o;return i(this,void 0,void 0,(function(){var i,u;return s(this,(function(s){return ct(t instanceof l&&n instanceof an&&n.sendingStatus===e.SendingStatus.SUCCEEDED&&t.url===n.channelUrl&&!n.scheduledInfo).throw(f.invalidParameters),i=new ee,u=r(r({},n),{fileUrl:n.url,fileName:n.name,fileSize:n.size,mimeType:n.type,mentionType:n.mentionType,mentionedUserIds:null!==(a=n.mentionedUserIds)&&void 0!==a?a:null===(o=n.mentionedUsers)||void 0===o?void 0:o.map((function(e){return e.userId})),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:n.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:n.requireAuth}),t._sendFileMessage(u).onSucceeded((function(e){return i.resolve(e)})).onFailed((function(e){return i.reject(e)})),[2,i.promise]}))}))},l.prototype.deleteMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return ct(e instanceof Bt).throw(f.invalidParameters),e.messageId>0?(t=wt.of(this._iid).requestQueue,n=new mo({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,t.send(n)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},l.prototype.addReaction=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(e instanceof Kt&&e.messageId>0&&g("string",t)).throw(f.invalidParameters),n=wt.of(this._iid).requestQueue,r=new Eo({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(bo).reactionEvent]}}))}))},l.prototype.deleteReaction=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(e instanceof Kt&&e.messageId>0&&g("string",t)).throw(f.invalidParameters),n=wt.of(this._iid).requestQueue,r=new Co({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(To).reactionEvent]}}))}))},l.prototype._updateMessageMetaArray=function(t,n,r,a){return i(this,void 0,void 0,(function(){var i,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return i=wt.of(this._iid),o=i.dispatcher,u=i.requestQueue,c=new po({channelType:this.channelType,channelUrl:this.url,messageId:t,metaArrayParams:{array:n,mode:r,upsert:a}}),[4,u.send(c)];case 1:return l=s.sent(),h=l.as(fo).message,o.dispatch(new yn({messages:[h],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),[2,h]}}))}))},l.prototype.createMessageMetaArrayKeys=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return ct(e instanceof Bt&&e.messageId>0&&b("string",t)).throw(f.invalidParameters),n=t.map((function(e){return new xt({key:e})})),[2,this._updateMessageMetaArray(e.messageId,n,"add",!0)]}))}))},l.prototype.deleteMessageMetaArrayKeys=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return ct(e instanceof Bt&&e.messageId>0&&b("string",t)).throw(f.invalidParameters),n=t.map((function(e){return new xt({key:e})})),[2,this._updateMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},l.prototype.addMessageMetaArrayValues=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){return ct(e instanceof Bt&&e.messageId>0&&t.every((function(e){return e instanceof xt}))).throw(f.invalidParameters),[2,this._updateMessageMetaArray(e.messageId,t,"add",!0)]}))}))},l.prototype.removeMessageMetaArrayValues=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){return ct(e instanceof Bt&&e.messageId>0&&t.every((function(e){return e instanceof xt}))).throw(f.invalidParameters),[2,this._updateMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},l.prototype.report=function(t,n){return i(this,void 0,void 0,(function(){var r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return ct(y(e.ReportCategory,t)&&g("string",n)).throw(f.invalidParameters),r=wt.of(this._iid),i=r.sdkState,a=r.requestQueue,o=new oo({channelUrl:this.url,channelType:this.channelType,userId:i.userId,category:t,description:n}),[4,a.send(o)];case 1:return s.sent(),[2]}}))}))},l.prototype.reportUser=function(t,n,r){return i(this,void 0,void 0,(function(){var i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(t instanceof ht&&y(e.ReportCategory,n)&&g("string",r)).throw(f.invalidParameters),i=wt.of(this._iid),a=i.sdkState,o=i.requestQueue,u=new uo({channelUrl:this.url,channelType:this.channelType,userId:a.userId,offendingUserId:t.userId,category:n,description:r}),[4,o.send(u)];case 1:return s.sent(),[2]}}))}))},l.prototype.reportMessage=function(t,n,r){return i(this,void 0,void 0,(function(){var i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(t instanceof Bt&&y(e.ReportCategory,n)&&g("string",r)).throw(f.invalidParameters),i=wt.of(this._iid),a=i.sdkState,o=i.requestQueue,u=new co({channelUrl:this.url,channelType:this.channelType,userId:a.userId,offendingUserId:t.sender.userId,messageId:t.messageId,category:n,description:r}),[4,o.send(u)];case 1:return s.sent(),[2]}}))}))},l}(We),Oo=null,Ro=function(){function t(e,t,n){var r=this;this._fcmPushToken=null,this._apnsPushToken=null,this._iid=e,this.options=t;var a=wt.of(e),o=a.sdkState,u=a.cacheContext,c=a.dispatcher,l=a.sessionManager,h=a.requestQueue,d=a.logger,p=a.userEventHandlers;this._onlineDetector=new Xr({logger:d,connectionDelegate:{reconnect:function(){var t=wt.of(e),n=t.sdkState,r=t.connectionManager;"foreground"===n.appState&&r.resetAndReconnect()},disconnect:function(){wt.of(e).connectionManager.disconnect()}}}),new ei(e,{localCacheEnabled:u.localCacheEnabled,dispatcher:c,sdkState:o,logger:d}),n.forEach((function(t){t.init(e,{sdkState:o,cacheContext:u,dispatcher:c,sessionManager:l,requestQueue:h,logger:d,onlineDetector:r._onlineDetector}),r[t.name]=t})),this._appStateChangeDetector=new Jr,this._appStateChangeDetector.on("resume",(function(){d.debug("the page resumes from freeze"),r.setForegroundState()})).on("pause",(function(){d.debug("the page freezes"),r.setBackgroundState()})),c.on((function(t){if(t instanceof j){if("USEV"===t.code){var n=t.as(ri).event;if(n.category===xr.FRIEND_DISCOVERED){var a=ti.getDataAsFriendDiscoveredEvent(e,n).friendDiscoveries;De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(e){return[2,p.forEach((function(e){e.onFriendsDiscovered(a)}))]}))}))}))}}}else if(t instanceof $){var c=wt.of(r._iid).subscribedUnreadMessageCount,l=!1,h=t.ts;if("number"==typeof h&&h>c.ts){if(c.all!==t.all&&(l=!0),c.all=t.all>=0?t.all:0,t.customTypes)for(var d in t.customTypes)c.customTypes[d]!==t.customTypes[d]&&(l=!0),c.customTypes[d]=t.customTypes[d];l=l&&c.ts>0,c.ts=h}l&&De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(e){return[2,p.forEach((function(e){e.onTotalUnreadMessageCountUpdated(c.all,c.customTypes)}))]}))}))}))}else t instanceof dt&&u.localCacheEnabled&&u.preference.set(r._getUserProfileCacheKey(o.userId),pt.payloadify(t.userProfile))}))}return t.init=function(e){var n=e.appId,r=e.appVersion,i=void 0===r?null:r,s=e.modules,a=void 0===s?[]:s,c=e.options,l=void 0===c?new I:c,h=e.debugMode,d=void 0!==h&&h,p=e.customApiHost,f=e.customWebSocketHost,_=e.newInstance,v=void 0!==_&&_,m=e.logLevel,g=e.localCacheEnabled,y=void 0!==g&&g,E=e.localCacheEncryption,b=e.useAsyncStorageStore,C=void 0===b?null:b;if(!Oo||v){var T="su-".concat(U()),S=null!=E?E:{encrypt:function(e){return e},decrypt:function(e){return e}},N=new ra({encryption:S});d||(N=C?new aa({AsyncStorage:C,encryption:S}):new sa({encryption:S})),new wt(T,{appId:n,appVersion:i,options:l,apiHost:null!=p?p:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=f?f:"wss://ws-".concat(n,".sendbird.com"),store:N,encryption:S,logLevel:m,localCacheEnabled:y,debugMode:d});var w=[new Wn,new yr],M=new t(T,l,u(u([],o(a),!1),o(w),!1));return Oo||(Oo=M),M}return Oo},Object.defineProperty(t,"instance",{get:function(){return Oo},enumerable:!1,configurable:!0}),Object.defineProperty(t,"version",{get:function(){return l},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appId",{get:function(){return wt.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appInfo",{get:function(){return wt.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appVersion",{get:function(){var e;return null!==(e=wt.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debugMode",{get:function(){return wt.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"logLevel",{get:function(){return wt.of(this._iid).logger.level},set:function(e){wt.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCacheEnabled",{get:function(){return wt.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ekey",{get:function(){return je(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentUser",{get:function(){var e;return null!==(e=wt.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){var t=wt.of(this._iid).connectionManager;return t.isConnected?e.ConnectionState.OPEN:t.isConnecting?e.ConnectionState.CONNECTING:e.ConnectionState.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastConnectedAt",{get:function(){var e=wt.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),t.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},t.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},t.prototype.getMemoryStoreForDebugging=function(){var e=wt.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof ra?n.store:null;throw f.debugModeRequired},t.prototype.addExtension=function(e,t){var n=wt.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(e)>-1&&(n.extensions[e]=t)},t.prototype.setOnlineListener=function(e){this._onlineDetector.setOnlineListener(e)},t.prototype.setOfflineListener=function(e){this._onlineDetector.setOfflineListener(e)},t.prototype.initializeCache=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return n=wt.of(this._iid),r=n.sdkState,i=n.cacheContext,a=n.connectionManager,o=n.dispatcher,r.userId&&r.userId===t?[3,6]:[4,a.logout()];case 1:return s.sent(),r.userId=t,i.localCacheEnabled?(u="sendbird@".concat(r.appId,"/").concat(t,".db"),i.nestdb&&i.nestdb.state!==Zs.CLOSED&&i.nestdb.name===u?[3,3]:((c=i.nestdb=new ha({name:"sendbird@".concat(r.appId,"/").concat(t,".db"),version:1,store:i.store})).on("upgrade",function(t){return function(n,r){0===n?t.commitSchema([{collectionName:Ir,keyName:"url",index:[Mr(e.GroupChannelListOrder.LATEST_LAST_MESSAGE),Mr(e.GroupChannelListOrder.CHRONOLOGICAL),Mr(e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:Nr,keyName:"messageId",index:[Or(wr.CHANNEL_LATEST),Or(wr.NEWEST_CHILD_MESSAGE)]},{collectionName:Br,keyName:"reqId",index:[Or(wr.CHANNEL_LATEST),Or(wr.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then((function(){return r()})).catch((function(e){return r(e)})):r()}}(c)),[4,c.open()])):[3,6];case 2:s.sent(),o.dispatch(new ni(this._iid,{userId:t})),s.label=3;case 3:return[4,i.preference.init(this._getPreferenceCacheKey(t))];case 4:return s.sent(),[4,i.preference.get(this._getUserProfileCacheKey(t))];case 5:(l=s.sent())&&new pt(this._iid,l).apply(),s.label=6;case 6:return[2]}}))}))},t.prototype.clearCachedData=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return(e=wt.of(this._iid).cacheContext).localCacheEnabled?(e.nestdb&&e.nestdb.clear(),[4,e.preference.clear()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.clearCachedMessages=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(a){switch(a.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=Yr.of(this._iid),n=zr.of(this._iid),t&&n?[4,Promise.all(e.map((function(e){return i(r,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,t.removeMessagesOfChannel(e)];case 1:return r.sent(),[4,n.removeMessagesOfChannel(e)];case 2:return r.sent(),[2]}}))}))})))]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},t.prototype.connect=function(e,t){return void 0===t&&(t=null),i(this,void 0,void 0,(function(){var n,r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:ct(g("string",e)&&g("string",t,!0)).throw(f.invalidParameters),n=wt.of(this._iid),r=n.sdkState,i=n.cacheContext,a=n.connectionManager,o=n.statLogCollector,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.initializeCache(e)];case 2:return s.sent(),[3,4];case 3:return s.sent(),u=wt.of(this._iid).logger,i.localCacheEnabled=!1,u.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,o.init("sendbird@".concat(r.appId,"/").concat(e,".statlog"))];case 5:return s.sent(),[4,a.connect(t)];case 6:return s.sent(),this._appStateChangeDetector.start(),r.appState="foreground",[4,null==(c=ei.of(this._iid))?void 0:c.processNonAutoResendRegisteredPendingMessages()];case 7:return s.sent(),this._onlineDetector.start(),[2,this.currentUser]}}))}))},t.prototype.reconnect=function(){var e=wt.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&t.resetAndReconnect().then((function(){n.appState="foreground"})).catch((function(){})),r},t.prototype.disconnect=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return e=wt.of(this._iid),t=e.connectionManager,n=e.cacheContext,r=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return i.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.setBackgroundState=function(){var e=wt.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background())},t.prototype.setForegroundState=function(){var e=wt.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect())},t.prototype.setSessionHandler=function(e){ct(e instanceof br).throw(f.invalidParameters),wt.of(this._iid).sessionManager.handler=e},t.prototype.addUserEventHandler=function(e,t){ct(g("string",e)&&t instanceof Tr).throw(f.invalidParameters),wt.of(this._iid).userEventHandlers.set(e,t)},t.prototype.removeUserEventHandler=function(e){wt.of(this._iid).userEventHandlers.delete(e)},t.prototype.removeAllUserEventHandler=function(){wt.of(this._iid).userEventHandlers.clear()},t.prototype.addConnectionHandler=function(e,t){ct(g("string",e)&&t instanceof Cr).throw(f.invalidParameters),wt.of(this._iid).connectionHandlers.set(e,t)},t.prototype.removeConnectionHandler=function(e){wt.of(this._iid).connectionHandlers.delete(e)},t.prototype.removeAllConnectionHandler=function(){wt.of(this._iid).connectionHandlers.clear()},t.prototype.createApplicationUserListQuery=function(e){return void 0===e&&(e={}),new ss(this._iid,e)},t.prototype.createBlockedUserListQuery=function(e){return void 0===e&&(e={}),new us(this._iid,e)},t.prototype.createFriendListQuery=function(e){return void 0===e&&(e={}),new hs(this._iid,e)},t.prototype.createMessageSearchQuery=function(e){return new Qn(this._iid,e)},t.prototype.createPollListQuery=function(e){return new _r(this._iid,r({},e))},t.prototype.createPollVoterListQuery=function(e){return new gr(this._iid,r({},e))},t.prototype.buildUserFromSerializedData=function(e){var t=ut(e);return new ht(this._iid,ht.payloadify(t))},t.prototype.updateCurrentUserInfo=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,n,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return t=r(r({},Er),e),ct(function(e){return T(e.profileImage,!0)&&g("string",e.profileUrl,!0)&&g("string",e.nickname,!0)}(t)).throw(f.invalidParameters),this.currentUser?(n=wt.of(this._iid),i=n.sdkState,a=n.requestQueue,o=new ii(r({userId:i.userId},t)),[4,a.send(o)]):[3,2];case 1:return u=s.sent(),c=u.as(si).user,this.currentUser&&(t.nickname&&(this.currentUser.nickname=c.nickname),(t.profileUrl||t.profileImage)&&(this.currentUser.plainProfileUrl=c.profileUrl)),[2,c];case 2:throw f.connectionRequired}}))}))},t.prototype.updateCurrentUserInfoWithPreferredLanguages=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),this.currentUser?(t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ii({userId:n.userId,preferredLanguages:e}),[4,r.send(i)]):[3,2];case 1:return a=s.sent(),o=a.as(si).user,this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),[2,o];case 2:throw f.connectionRequired}}))}))},t.prototype.registerFCMPushTokenForCurrentUser=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(ct(g("string",t)).throw(f.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new oi({userId:r.userId,token:t}),[4,i.send(a)];case 2:return s.sent(),this._fcmPushToken="",[2,e.PushTokenRegistrationState.SUCCESS];case 3:return s.sent(),[2,e.PushTokenRegistrationState.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=t,[2,e.PushTokenRegistrationState.PENDING];case 6:return[2]}}))}))},t.prototype.unregisterFCMPushTokenForCurrentUser=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(ct(g("string",t)).throw(f.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new ci({userId:r.userId,token:t}),[4,i.send(a)];case 2:return s.sent(),this._fcmPushToken="",[2,e.PushTokenRegistrationState.SUCCESS];case 3:return s.sent(),[2,e.PushTokenRegistrationState.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=t,[2,e.PushTokenRegistrationState.PENDING];case 6:return[2]}}))}))},t.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new hi({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},t.prototype.registerAPNSPushTokenForCurrentUser=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(ct(g("string",t)).throw(f.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new ai({userId:r.userId,token:t}),[4,i.send(a)];case 2:return s.sent(),this._fcmPushToken="",[2,e.PushTokenRegistrationState.SUCCESS];case 3:return s.sent(),[2,e.PushTokenRegistrationState.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=t,[2,e.PushTokenRegistrationState.PENDING];case 6:return[2]}}))}))},t.prototype.unregisterAPNSPushTokenForCurrentUser=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(ct(g("string",t)).throw(f.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new ui({userId:r.userId,token:t}),[4,i.send(a)];case 2:return s.sent(),this._fcmPushToken="",[2,e.PushTokenRegistrationState.SUCCESS];case 3:return s.sent(),[2,e.PushTokenRegistrationState.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=t,[2,e.PushTokenRegistrationState.PENDING];case 6:return[2]}}))}))},t.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new li({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},t.prototype.getChannelInvitationPreference=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new fi({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,{autoAccept:i.as(_i).autoAccept}]}}))}))},t.prototype.setChannelInvitationPreference=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return ct(g("boolean",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new vi({userId:n.userId,willAutoAccept:e}),[4,r.send(i)];case 1:return a=s.sent(),[2,{autoAccept:a.as(mi).autoAccept}]}}))}))},t.prototype.getDoNotDisturb=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new gi({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(yi).preference]}}))}))},t.prototype.setDoNotDisturb=function(e,t,n,r,a,o){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=""),i(this,void 0,void 0,(function(){var i,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return ct(g("boolean",e)&&g("number",t)&&g("number",n)&&g("number",r)&&g("number",a)&&g("string",o)).throw(f.invalidParameters),i=wt.of(this._iid),u=i.sdkState,c=i.requestQueue,l=new Ei({userId:u.userId,doNotDisturbOn:e,startHour:t,startMin:n,endHour:r,endMin:a,timezone:o}),[4,c.send(l)];case 1:return h=s.sent(),[2,h.as(bi).preference]}}))}))},t.prototype.getSnoozePeriod=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ci({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Ti).snoozePeriod]}}))}))},t.prototype.setSnoozePeriod=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),i(this,void 0,void 0,(function(){var r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(g("boolean",e)&&g("number",t)&&g("number",n)).throw(f.invalidParameters),r=wt.of(this._iid),i=r.sdkState,a=r.requestQueue,o=new Ii({userId:i.userId,snoozeOn:e,startTs:t,endTs:n}),[4,a.send(o)];case 1:return u=s.sent(),[2,u.as(Si).snoozePeriod]}}))}))},t.prototype.getMyPushTokensByToken=function(t,n){return i(this,void 0,void 0,(function(){var r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",t)&&y(e.PushTokenType,n)).throw(f.invalidParameters),r=wt.of(this._iid),i=r.sdkState,a=r.requestQueue,o=new di({userId:i.userId,type:n,token:t}),[4,a.send(o)];case 1:return u=s.sent(),[2,u.as(pi).pushTokens]}}))}))},t.prototype.getPushTriggerOption=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Mi({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(Ai).pushTriggerOption]}}))}))},t.prototype.setPushTriggerOption=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return ct(y(e.PushTriggerOption,t)).throw(f.invalidParameters),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new Ui({userId:r.userId,pushTriggerOption:t}),[4,i.send(a)];case 1:return[2,s.sent().as(Oi).pushTriggerOption]}}))}))},t.prototype.getPushTemplate=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ri({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(Li).name]}}))}))},t.prototype.setPushTemplate=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return ct(y(e.PushTemplate,t)).throw(f.invalidParameters),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new ki({userId:r.userId,templateName:t}),[4,i.send(a)];case 1:return[2,s.sent().as(Di).name]}}))}))},t.prototype.blockUser=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(e instanceof ht||g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Ni({userId:n.userId,blockedUserId:e instanceof ht?e.userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},t.prototype.blockUserWithUserId=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.blockUser(e)]}))}))},t.prototype.unblockUser=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(e instanceof ht||g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new wi({userId:n.userId,unblockedUserId:e instanceof ht?e.userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},t.prototype.unblockUserWithUserId=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.unblockUser(e)]}))}))},t.prototype.getFriendChangeLogsByToken=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Pi({userId:n.userId,token:e}),[4,r.send(i)];case 1:return a=s.sent(),[2,a.as(xi).changelogs]}}))}))},t.prototype.getAllowFriendDiscovery=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Qi({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Bi).allowFriendDiscovery]}}))}))},t.prototype.setAllowFriendDiscovery=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(g("boolean",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ji({userId:n.userId,allowFriendDiscovery:e}),[4,r.send(i)];case 1:return s.sent(),[2,e]}}))}))},t.prototype.uploadFriendDiscoveries=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Fi({userId:n.userId,discoveries:e}),[4,r.send(i)];case 1:return a=s.sent(),[2,a.as(qi).friendDiscoveryRequestId]}}))}))},t.prototype.deleteFriendDiscovery=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.deleteFriendDiscoveries([e])]}))}))},t.prototype.deleteFriendDiscoveries=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Gi({userId:n.userId,discoveryKeys:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},t.prototype.addFriends=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Hi({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return a=s.sent(),[2,a.as(Vi).users]}}))}))},t.prototype.deleteFriend=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.deleteFriends([e])]}))}))},t.prototype.deleteFriends=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(b("string",e)).throw(f.invalidParameters),t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Ki({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},t.prototype.getAllEmoji=function(){return i(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:return e=wt.of(this._iid).requestQueue,t=new Xi,[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(Zi).emojiContainer]}}))}))},t.prototype.getEmojiCategory=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return t=wt.of(this._iid).requestQueue,n=new $i({categoryId:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(es).emojiCategory]}}))}))},t.prototype.getEmoji=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return t=wt.of(this._iid).requestQueue,n=new ts({key:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(ns).emoji]}}))}))},t}();e.MemberState=void 0,(go=e.MemberState||(e.MemberState={})).NONE="none",go.JOINED="joined",go.INVITED="invited",go.LEFT="left";var Lo,ko,Do,Po,xo,Fo,qo,Go,Ho=function(t){function i(n,r){var i=t.call(this,n,r)||this;return i.state=null,i.role=null,i.isMuted=!1,i.isBlockedByMe=!1,i.isBlockingMe=!1,i.state=y(e.MemberState,r.state)?r.state:null,i.role=y(e.Role,r.role)?r.role:null,r.hasOwnProperty("is_muted")&&(i.isMuted=r.is_muted),r.hasOwnProperty("is_blocked_by_me")&&(i.isBlockedByMe=r.is_blocked_by_me),r.hasOwnProperty("is_blocking_me")&&(i.isBlockingMe=r.is_blocking_me),i}return n(i,t),i.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})):null},i}(fa),Vo=function(t){function r(n,r){var i,s,a=this;return(a=t.call(this,n)||this).channelUrl=null!==(i=r.channel_url)&&void 0!==i?i:"",a.channelType=null!==(s=r.channel_type)&&void 0!==s?s:e.ChannelType.GROUP,a.reader=new ht(a._iid,r.user),a.readAt=r.ts,a}return n(r,t),r}(We);e.PublicChannelFilter=void 0,(Lo=e.PublicChannelFilter||(e.PublicChannelFilter={})).ALL="all",Lo.PUBLIC="public",Lo.PRIVATE="private",e.MyMemberStateFilter=void 0,(ko=e.MyMemberStateFilter||(e.MyMemberStateFilter={})).ALL="all",ko.JOINED="joined_only",ko.INVITED="invited_only",ko.INVITED_BY_FRIEND="invited_by_friend",ko.INVITED_BY_NON_FRIEND="invited_by_non_friend",e.SuperChannelFilter=void 0,(Do=e.SuperChannelFilter||(e.SuperChannelFilter={})).ALL="all",Do.SUPER="super",Do.NON_SUPER="nonsuper",Do.BROADCAST_ONLY="broadcast_only",Do.EXCLUSIVE_ONLY="exclusive_only",e.UnreadChannelFilter=void 0,(Po=e.UnreadChannelFilter||(e.UnreadChannelFilter={})).ALL="all",Po.UNREAD_MESSAGE="unread_message",e.HiddenChannelFilter=void 0,(xo=e.HiddenChannelFilter||(e.HiddenChannelFilter={})).ALL="all",xo.UNHIDDEN="unhidden_only",xo.HIDDEN="hidden_only",xo.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",xo.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide",e.OperatorFilter=void 0,(Fo=e.OperatorFilter||(e.OperatorFilter={})).ALL="all",Fo.OPERATOR="operator",Fo.NONOPERATOR="nonoperator",e.QueryType=void 0,(qo=e.QueryType||(e.QueryType={})).AND="AND",qo.OR="OR",e.GroupChannelSearchField=void 0,(Go=e.GroupChannelSearchField||(e.GroupChannelSearchField={})).MEMBER_NICKNAME="member_nickname",Go.CHANNEL_NAME="channel_name";var Ko,Qo=function(){function t(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=e.MyMemberStateFilter.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=e.SuperChannelFilter.ALL,this.publicChannelFilter=e.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=e.UnreadChannelFilter.ALL,this.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,this.includeFrozen=!0}return t.prototype._isFriend=function(e){return!!e.friendDiscoveryKey||!!e.friendName},Object.defineProperty(t.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),t.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(t.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),t.prototype.setUserIdsFilter=function(t,n,r){void 0===r&&(r=e.QueryType.AND),this._userIdsFilter={userIds:t,includeMode:n,queryType:r}},t.prototype.clone=function(){var e=new t;this.searchFilter&&e.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&e.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(t){e[t]=n[t]})),e},t.prototype.match=function(t,n){if(this._searchFilter){var r=this._searchFilter,i=r.query,s=r.fields;if(i&&s&&s.length>0&&!s.some((function(n){switch(n){case e.GroupChannelSearchField.CHANNEL_NAME:return t.name.toLowerCase().includes(i.toLowerCase());case e.GroupChannelSearchField.MEMBER_NICKNAME:return t.members.some((function(e){return e.nickname.toLowerCase().includes(i.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var a=this._userIdsFilter,c=a.userIds,l=a.includeMode,h=a.queryType,d=t.members.map((function(e){return e.userId}));if(l){if(c.length>0)switch(h){case e.QueryType.AND:if(c.some((function(e){return!d.includes(e)})))return!1;break;case e.QueryType.OR:if(c.every((function(e){return!d.includes(e)})))return!1}}else{if(c.includes(n)||c.push(n),t.members.length>c.length)return!1;if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=u([],o(e),!1).sort(),r=u([],o(t),!1).sort(),i=0;i<n.length;++i)if(n[i]!==r[i])return!1;return!0}(c,d))return!1}}if(!this.includeEmpty&&!t.lastMessage)return!1;if(!this.includeFrozen&&t.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(t.customType))return!1;if(this.channelNameContainsFilter&&!t.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var p=this.nicknameContainsFilter.toLowerCase();if(t.members.every((function(e){return!e.nickname.toLowerCase().includes(p)})))return!1}if(this.nicknameStartsWithFilter){var f=this.nicknameStartsWithFilter.toLowerCase();if(t.members.every((function(e){return!e.nickname.toLowerCase().startsWith(f)})))return!1}if(this.nicknameExactMatchFilter){var _=this.nicknameExactMatchFilter.toLowerCase();if(t.members.every((function(e){return e.nickname.toLowerCase()!=_})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(t.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case e.MyMemberStateFilter.JOINED:if("joined"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED:if("invited"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED_BY_FRIEND:if("invited"!==t.myMemberState||!this._isFriend(t.inviter))return!1;break;case e.MyMemberStateFilter.INVITED_BY_NON_FRIEND:if("invited"!==t.myMemberState||this._isFriend(t.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case e.HiddenChannelFilter.UNHIDDEN:if(t.isHidden||"unhidden"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN:if(!t.isHidden)return!1;break;case e.HiddenChannelFilter.HIDDEN_ALLOW_AUTO_UNHIDE:if(!t.isHidden||"hidden_allow_auto_unhide"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN_PREVENT_AUTO_UNHIDE:if(!t.isHidden||"hidden_prevent_auto_unhide"!==t.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===e.UnreadChannelFilter.UNREAD_MESSAGE)if(0===t.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case e.PublicChannelFilter.PUBLIC:if(!t.isPublic)return!1;break;case e.PublicChannelFilter.PRIVATE:if(t.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case e.SuperChannelFilter.SUPER:if(!t.isSuper)return!1;break;case e.SuperChannelFilter.NON_SUPER:if(t.isSuper)return!1}return!0},t}(),Bo=function(t){function c(e,n){var r=n.sdkState,i=n.cacheContext,s=t.call(this,e)||this;return s._channels=new Map,s._sdkState=r,s._cacheContext=i,s}return n(c,t),Object.defineProperty(c.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection(Ir):null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),c.prototype._serialize=function(e,t){return void 0===t&&(t=0),r(r({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},c.prototype._deserialize=function(e){return hc.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(c.prototype,"channels",{get:function(){return u([],o(this._channels.values()),!1)},enumerable:!1,configurable:!0}),c.prototype.isCachedInMemory=function(e){return this._channels.has(e)},c.prototype.filterOffsetChanged=function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))},c.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,null];case 3:return[2,this._channels.get(e)]}}))}))},c.prototype.fetch=function(t){var n=t.token,r=t.limit,a=void 0===r?100:r,o=t.backward,u=void 0!==o&&o,c=t.filter,l=void 0===c?new Qo:c,h=t.order,d=void 0===h?e.GroupChannelListOrder.LATEST_LAST_MESSAGE:h;return i(this,void 0,void 0,(function(){var t,r,i,o,c=this;return s(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(t=Mr(d),r={where:function(t){if(n)switch(d){case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:if(!u&&t.name.localeCompare(n)<0||u&&t.name.localeCompare(n)>0)return!1;break;case e.GroupChannelListOrder.CHRONOLOGICAL:if(!u&&t.createdAt>n||u&&t.createdAt<n)return!1;break;case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:if(!u&&t.lastMessageUpdatedAt>n||u&&t.lastMessageUpdatedAt<n)return!1}return l.match(c._deserialize(t),c._sdkState.userId)},index:t,backward:u},[4,this.collection.query(r)]):[3,3];case 1:return[4,s.sent().fetch({limit:a})];case 2:return i=s.sent(),(o=i.map((function(e){return c._deserialize(e)}))).forEach((function(e){c._channels.has(e.url)||c._channels.set(e.url,e)})),[2,o];case 3:return[2,[]]}}))}))},c.prototype.upsert=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:if(e.forEach((function(e){if(r._channels.has(e.url)){var t=r._channels.get(e.url);Object.assign(t,e,{_iid:r._iid})}else r._channels.set(e.url,e)})),!this.localCacheEnabled)return[3,2];for(n in t=[],e)t.push(this._serialize(e[n],parseInt(n)));return[4,this.collection.upsertMany(t)];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},c.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),t=a(e),n=t.next(),s.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:s.sent(),s.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return i=s.sent(),o={error:i},[3,7];case 6:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 7:return[2]}}))}))},c.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},c.prototype.clearMemoryCache=function(){this._channels.clear()},c.prototype._setBlockStateOfAllChannels=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,o,u,c,l,h,d,p,f,_,v,m,g,y,E,b,C,T;return s(this,(function(s){switch(s.label){case 0:if(r=[],e===this._sdkState.userId)try{for(i=a(this._channels.values()),o=i.next();!o.done;o=i.next()){d=o.value;try{for(g=void 0,u=a(d.members),c=u.next();!c.done;c=u.next())if((_=c.value).userId===t){_.isBlockedByMe=n,r.push(d);break}}catch(e){g={error:e}}finally{try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(g)throw g.error}}}}catch(e){v={error:e}}finally{try{o&&!o.done&&(m=i.return)&&m.call(i)}finally{if(v)throw v.error}}else if(t===this._sdkState.userId)try{for(l=a(this._channels.values()),h=l.next();!h.done;h=l.next()){d=h.value;try{for(C=void 0,p=a(d.members),f=p.next();!f.done;f=p.next())if((_=f.value).userId===e){_.isBlockingMe=n,r.push(d);break}}catch(e){C={error:e}}finally{try{f&&!f.done&&(T=p.return)&&T.call(p)}finally{if(C)throw C.error}}}}catch(e){E={error:e}}finally{try{h&&!h.done&&(b=l.return)&&b.call(l)}finally{if(E)throw E.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},c.prototype.block=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},c.prototype.unblock=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},c.prototype.markAsRead=function(e,t){return void 0===t&&(t=u([],o(this._channels.keys()),!1)),i(this,void 0,void 0,(function(){var n,r,i,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:n=[],s.label=1;case 1:s.trys.push([1,6,7,8]),r=a(t),i=r.next(),s.label=2;case 2:return i.done?[3,5]:(o=i.value,[4,this.get(o)]);case 3:(u=s.sent())._updateUnreadMemberState(this._sdkState.userId,e)&&(u._updateUnreadCount(0,0),n.push(u)),s.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return c=s.sent(),l={error:c},[3,8];case 7:try{i&&!i.done&&(h=r.return)&&h.call(r)}finally{if(l)throw l.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[2]}}))}))},c}(We);!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE"}(Ko||(Ko={}));var jo,zo=function(){function t(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}return Object.defineProperty(t.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===e.ChannelType.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===e.ChannelType.OPEN},enumerable:!1,configurable:!0}),t}(),Wo={invitedUserIds:null,channelUrl:null,coverUrl:null,coverImage:null,isDistinct:null,isSuper:null,isBroadcast:null,isExclusive:null,isPublic:null,isDiscoverable:null,isStrict:null,isEphemeral:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},Yo=function(e){return b("string",e.invitedUserIds,!0)&&g("string",e.channelUrl,!0)&&g("string",e.coverUrl,!0)&&(T(e.coverImage)||g("string",e.coverImage)||null===e.coverImage)&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isSuper,!0)&&g("boolean",e.isBroadcast,!0)&&g("boolean",e.isExclusive,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isStrict,!0)&&g("boolean",e.isDiscoverable,!0)&&g("boolean",e.isEphemeral,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&b("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)},Jo={customTypes:null,includeEmpty:!1,includeFrozen:!0},Xo=function(e){return b("string",e.customTypes,!0)&&g("boolean",e.includeEmpty)&&g("boolean",e.includeFrozen)},Zo={myMemberStateFilter:e.MyMemberStateFilter.ALL},$o=function(t){return y(e.MyMemberStateFilter,t.myMemberStateFilter)};e.UnreadItemKey=void 0,(jo=e.UnreadItemKey||(e.UnreadItemKey={})).GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",jo.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",jo.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",jo.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",jo.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",jo.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",jo.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",jo.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",jo.SUPER_INVITATION_COUNT="super_group_channel_invitation_count";var eu,tu={keys:[]},nu={channelCustomTypesFilter:null,superChannelFilter:e.SuperChannelFilter.ALL},ru={channelUrl:null,scheduledStatus:null,messageTypeFilter:e.MessageTypeFilter.ALL};e.GroupChannelEventSource=void 0,(eu=e.GroupChannelEventSource||(e.GroupChannelEventSource={})).UNKNOWN="UNKNOWN",eu.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",eu.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",eu.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",eu.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",eu.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",eu.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",eu.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",eu.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",eu.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",eu.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",eu.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",eu.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",eu.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",eu.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",eu.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",eu.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",eu.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",eu.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",eu.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",eu.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",eu.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",eu.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",eu.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",eu.REQUEST_CHANNEL="REQUEST_CHANNEL",eu.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",eu.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",eu.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS";var iu=function(t){return t.startsWith("EVENT_")||t===e.GroupChannelEventSource.SYNC_CHANNEL_BACKGROUND||t===e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS},su=function(e){function t(t){var n=t.channels,r=t.source,i=e.call(this)||this;return i.channels=n,i.source=r,i}return n(t,e),t}(k),au=function(e){function t(t){var n=t.channelUrls,r=t.source,i=e.call(this)||this;return i.channelUrls=n,i.source=r,i}return n(t,e),t}(k),ou=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,r=e.unsentMessageCache,o=e.dispatcher,u=this;this._observers=new Map,o.on((function(e){return i(u,void 0,void 0,(function(){var o,u,c,l,h,d,p,f,_,v,m=this;return s(this,(function(g){switch(g.label){case 0:if(!(e instanceof su))return[3,2];o=e.channels,f=e.source,u=o.filter((function(e){return e instanceof wl})),c=t.filterOffsetChanged(u);try{for(l=a(c),h=l.next();!h.done;h=l.next())d=h.value,n.removeUnderOffset(d.url,d.messageOffsetTimestamp)}catch(e){_={error:e}}finally{try{h&&!h.done&&(v=l.return)&&v.call(l)}finally{if(_)throw _.error}}return[4,t.upsert(u)];case 1:return g.sent(),this._broadcastUpdateEvent(u,f),[3,7];case 2:return e instanceof au?(p=e.channelUrls,f=e.source,[4,t.remove(p)]):[3,5];case 3:return g.sent(),[4,Pe((function(){return i(m,void 0,void 0,(function(){var e,t,i,o,u,c;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,6,7,8]),e=a(p),t=e.next(),s.label=1;case 1:return t.done?[3,5]:(i=t.value,[4,n.removeMessagesOfChannel(i)]);case 2:return s.sent(),[4,r.removeMessagesOfChannel(i)];case 3:s.sent(),s.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return o=s.sent(),u={error:o},[3,8];case 7:try{t&&!t.done&&(c=e.return)&&c.call(e)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))}))];case 4:return g.sent(),this._broadcastRemoveEvent(p,f),[3,7];case 5:return e instanceof ni?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,7];case 6:g.sent(),g.label=7;case 7:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),uu=function(){function e(e){var t=e.cacheContext,n=e.messageCache,r=e.unsentMessageCache,a=e.dispatcher,o=e.logger,u=this;this._cacheContext=null,this._observers=new Map,this._logger=null,this._cacheContext=t,this._logger=o,a.on((function(e){return i(u,void 0,void 0,(function(){var t,a,o,u,c,l,h,d,p,f,_,v,m,g=this;return s(this,(function(y){switch(y.label){case 0:return e instanceof yn?(t=e.messages,v=e.source,a=t.filter((function(e){return e.messageId>0})),o=t.filter((function(e){return 0===e.messageId})),a.length>0?[4,Pe((function(){return i(g,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,n.upsert(a)];case 1:return e.sent(),[4,r.remove(a.map((function(e){return e instanceof Bt?e.reqId:null})).filter((function(e){return null!==e})))];case 2:return e.sent(),[2]}}))}))}))]:[3,2]):[3,5];case 1:y.sent(),this._broadcastUpdateEvent(a,v),y.label=2;case 2:return o.length>0?[4,Pe((function(){return i(g,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,r.upsert(o)];case 1:return e.sent(),[2]}}))}))}))]:[3,4];case 3:y.sent(),this._broadcastUpdateEvent(o,v),y.label=4;case 4:return[3,21];case 5:return e instanceof En?(u=e.messageIds,v=e.source,[4,Pe((function(){return i(g,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,n.remove(u)];case 1:return e.sent(),[2]}}))}))}))]):[3,7];case 6:return y.sent(),this._broadcastRemoveEvent(u,v),[3,21];case 7:return e instanceof bn?(c=e.reqId,v=e.source,[4,Pe((function(){return i(g,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,r.remove([c])];case 1:return e.sent(),[2]}}))}))}))]):[3,9];case 8:return y.sent(),this._broadcastRemoveUnsentEvent(c,v),[3,21];case 9:return e instanceof Cn?(l=e.polls,v=e.source,this._cacheContext.localCacheEnabled?(h=l.map((function(e){return e.messageId})),[4,Promise.all(h.map((function(e){return n.get(e)})))]):[3,12]):[3,13];case 10:return(d=y.sent().filter((function(e){return e}))).length>0&&l.forEach((function(e){var t=d.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),[4,Pe((function(){return i(g,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,n.upsert(d)];case 1:return[2,e.sent()]}}))}))}))];case 11:y.sent(),y.label=12;case 12:return this._broadcastPollChangeLogEvent(l,v),[3,21];case 13:return e instanceof Tn?(p=e.event,v=e.source,[4,n.get(p.messageId)]):[3,17];case 14:return(f=y.sent())&&f.isUserMessage()&&f.poll&&f.poll.applyPollUpdateEvent(p)?[4,Pe((function(){return i(g,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,n.upsert([f])];case 1:return[2,e.sent()]}}))}))}))]:[3,16];case 15:y.sent(),y.label=16;case 16:return this._broadcastPollUpdateEvent(p,v),[3,21];case 17:return e instanceof In?(_=e.event,v=e.source,[4,n.get(_.messageId)]):[3,21];case 18:return(m=y.sent())&&m.isUserMessage()&&m.poll&&m.poll.applyPollVoteEvent(_)?[4,Pe((function(){return i(g,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,n.upsert([m])];case 1:return[2,e.sent()]}}))}))}))]:[3,20];case 19:y.sent(),y.label=20;case 20:this._broadcastPollVoteEvent(_,v),y.label=21;case 21:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onPollChangeLogUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onPollUpdate(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onPollVote(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var i=a(this._observers.values()),s=i.next();!s.done;s=i.next()){s.value.onRemoveUnsent(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),cu=function(e){function t(t){var n=t.userId,i=t.ts,s=t.token,a=t.filter,o=e.call(this)||this,u=r(r({},Jo),a),c=u.customTypes,l=u.includeEmpty,h=u.includeFrozen;return o.method=d.GET,o.path="".concat(fe,"/").concat(encodeURIComponent(n),"/my_group_channels/changelogs"),o.params=D({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:i>0?i:null,token:s,custom_types:c,show_empty:l,show_frozen:h}),o}return n(t,e),t}(x),lu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedChannels=n.updated.map((function(e){return new wl(t,e)})),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r}return n(t,e),t}(F),hu=function(e){function t(t){var n=t.channelUrl,r=t.isInternalCall,i=e.call(this)||this;return i.method=d.GET,i.path="".concat(r?me:ve,"/").concat(encodeURIComponent(n)),i.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},i}return n(t,e),t}(x),du=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=null,r.channel=new wl(t,n),r}return n(t,e),t}(F),pu=function(e){function t(t){var n=this,r=t.userId,i=t.token,s=t.limit,a=t.order,o=t.includeEmpty,u=t.myMemberStateFilter,c=t.superChannelFilter,l=t.publicChannelFilter,h=t.unreadChannelFilter,p=t.nicknameContainsFilter,f=t.nicknameStartsWithFilter,_=t.nicknameExactMatchFilter,v=t.channelNameContainsFilter,m=t.channelUrlsFilter,g=t.customTypesFilter,y=t.customTypeStartsWithFilter,E=t.hiddenChannelFilter,b=t.metadataOrderKeyFilter,C=t.metadataKey,T=t.metadataValues,I=t.metadataValueStartsWith,S=t.includeFrozen,N=t.includeMetaData,w=t.searchFilter,M=t.userIdsFilter;return(n=e.call(this)||this).method=d.GET,n.path="".concat(fe,"/").concat(encodeURIComponent(r),"/my_group_channels"),n.params=D({token:i,limit:s,order:a,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:o,member_state_filter:u,super_mode:c,public_mode:l,unread_filter:h,members_nickname_contains:p,members_nickname_startswith:f,members_nickname:_,name_contains:v,channel_urls:m,custom_types:g,custom_type_startswith:y,hidden_mode:E,metadata_order_key:b,metadata_key:C,metadata_values:T,metadata_value_startswith:I,show_frozen:S,show_metadata:N}),w&&w.query&&w.fields&&(n.params.search_query=w.query,n.params.search_fields=w.fields),M&&M.userIds&&M.userIds.length>0&&(M.includeMode?(n.params.members_include_in=M.userIds,n.params.query_type=M.queryType.toUpperCase()):n.params.members_exactly_in=M.userIds),n}return n(t,e),t}(x),fu=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var i=n.next,s=n.channels,a=n.ts;return r.token=i,s&&s.length>0&&(r.channels=s.map((function(e){return e.ts=a,new wl(t,e)}))),r.ts=null!=a?a:null,r}return n(t,e),t}(F),_u=function(t){function r(n){var r=n.userId,i=n.filter,s=t.call(this)||this,a=i.myMemberStateFilter;return s.method=d.GET,s.path="".concat(fe,"/").concat(encodeURIComponent(r),"/group_channel_count"),s.params={state:null!=a?a:e.MyMemberStateFilter.ALL},s}return n(r,t),r}(x),vu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.groupChannelCount=n.group_channel_count,r}return n(t,e),t}(F),mu=function(e){function t(t){var n=t.userId,r=t.filter,i=e.call(this)||this,s=r.keys;return i.method=d.GET,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/unread_item_count"),i.params={item_keys:s},i}return n(t,e),t}(x),gu=function(t){function r(n,r){var i=t.call(this,n,r)||this;return"number"==typeof r[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(i.groupChannelUnreadMentionCount=r[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof r[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(i.groupChannelUnreadMessageCount=r[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof r[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]&&(i.groupChannelInvitationCount=r[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof r[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]&&(i.superGroupChannelUnreadMentionCount=r[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof r[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]&&(i.superGroupChannelUnreadMessageCount=r[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof r[e.UnreadItemKey.SUPER_INVITATION_COUNT]&&(i.superGroupChannelInvitationCount=r[e.UnreadItemKey.SUPER_INVITATION_COUNT]),"number"==typeof r[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]&&(i.nonSuperGroupChannelUnreadMentionCount=r[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof r[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]&&(i.nonSuperGroupChannelUnreadMessageCount=r[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof r[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]&&(i.nonSuperGroupChannelInvitationCount=r[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]),i}return n(r,t),r}(F),yu=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(fe,"/").concat(encodeURIComponent(n),"/unread_channel_count"),r}return n(t,e),t}(x),Eu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r}return n(t,e),t}(F),bu=function(t){function r(n){var r=n.userId,i=n.filter,s=t.call(this)||this,a=i.channelCustomTypesFilter,o=i.superChannelFilter;return s.method=d.GET,s.path="".concat(fe,"/").concat(encodeURIComponent(r),"/unread_message_count"),s.params={super_mode:null!=o?o:e.SuperChannelFilter.ALL,custom_types:a},s}return n(r,t),r}(x),Cu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r}return n(t,e),t}(F),Tu=function(e){function t(t){var n=t.channelUrl,r=t.scheduledStatus,i=t.messageTypeFilter,s=e.call(this)||this;return s.method=d.GET,s.path="".concat(Se,"/count"),s.params={channel_url:n,status:Su(r)},i&&(s.params.message_type=i),s}return n(t,e),t}(x),Iu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.count=n.count,r}return n(t,e),t}(F),Su=function(t){if(t){var n=[];return t.forEach((function(t){switch(t){case e.ScheduledStatus.PENDING:n.push(kt.PENDING);break;case e.ScheduledStatus.SENT:n.push(kt.IN_QUEUE),n.push(kt.SENT);break;case e.ScheduledStatus.CANCELED:n.push(kt.CANCELED);break;case e.ScheduledStatus.FAILED:n.push(kt.FAILED)}})),n}},Nu=function(e){function t(t){var n=this,r=t.userId,i=t.channelUrl,s=t.coverUrl,a=t.coverImage,c=t.isDistinct,l=t.isSuper,h=t.isBroadcast,p=t.isPublic,f=t.isExclusive,_=t.isDiscoverable,v=t.isStrict,m=t.isEphemeral,g=t.accessCode,y=t.name,E=t.data,b=t.customType,C=t.messageSurvivalSeconds,T=t.invitedUserIds,I=t.operatorUserIds;return(n=e.call(this)||this).method=d.POST,n.path=ve,n.params=D({user_ids:u([r],o(null!=T?T:[]),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:i,cover_url:s,cover_file:a,is_distinct:c,is_super:l,is_broadcast:h,is_exclusive:f,is_public:p,is_discoverable:_,strict:v,is_ephemeral:m,access_code:g,name:y,data:E,custom_type:b,operator_ids:I,message_survival_seconds:C}),n}return n(t,e),t}(x),wu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new wl(t,n),r.isCreated=n.is_created,r}return n(t,e),t}(F),Mu=function(e){function t(t){var n=t.userId,r=t.channelUrls,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),i.params={channel_urls:r},i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Au=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.event=new zo(r),i}return n(t,e),t}(j),Uu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,s=t.accessCode;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:i,access_code:s},n}return n(t,e),t}(x),Ou=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new wl(t,n),r}return n(t,e),t}(F),Ru=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,s=r.data,a=s.member_count,o=void 0===a?null:a,u=s.joined_member_count,c=void 0===u?null:u,l=s.users,h=void 0===l?null:l;return i.memberCount=o,i.joinedMemberCount=c,i.members=Array.isArray(h)?h.map((function(e){return new Ho(t,e)})):[new Ho(t,r.data)],i}return n(t,e),t}(Au),Lu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,s=t.shouldRemoveOperatorStatus;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:i,should_remove_operator_status:s},n}return n(t,e),t}(x);!function(e){function t(t,n){return e.call(this,t,n)||this}n(t,e)}(F);var ku=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,s=r.data,a=s.member_count,o=void 0===a?null:a,u=s.joined_member_count,c=void 0===u?null:u;return i.memberCount=o,i.joinedMemberCount=c,i.member=new Ho(i._iid,r.data),i}return n(t,e),t}(Au),Du=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userIds;return(n=e.call(this)||this).method=d.POST,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:i},n}return n(t,e),t}(x),Pu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new wl(t,n),r}return n(t,e),t}(F),xu=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,s=r.data,a=s.member_count,o=void 0===a?null:a,u=s.joined_member_count,c=void 0===u?null:u,l=s.inviter,h=void 0===l?null:l,d=s.invitees,p=void 0===d?[]:d;return i.memberCount=o,i.joinedMemberCount=c,i.inviter=h?new ht(t,h):null,i.invitees=p.map((function(e){return new Ho(t,e)})),i}return n(t,e),t}(Au),Fu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:i},n}return n(t,e),t}(x),qu=function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.channel=new wl(n,r),i.channel.myMemberState=e.MemberState.NONE,i}return n(r,t),r}(F),Gu=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,s=r.data,a=s.member_count,o=void 0===a?null:a,u=s.joined_member_count,c=void 0===u?null:u,l=s.inviter,h=void 0===l?null:l,d=s.invitee,p=void 0===d?null:d;return i.memberCount=o,i.joinedMemberCount=c,i.inviter=h?new ht(t,h):null,i.invitee=p?new Ho(t,p):null,i}return n(t,e),t}(Au),Hu=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return n(t,e),t}(z),Vu=function(e){function t(t,n,r){var i=e.call(this,t,"READ",r)||this;return i.readStatus=new Vo(t,r),i}return n(t,e),t}(j),Ku=function(e){function t(t){var n=t.channelUrl,r=t.userId,i=e.call(this)||this;return(i=e.call(this)||this).method=d.PUT,i.path="".concat(ve,"/").concat(encodeURIComponent(n),"/messages/mark_as_delivered"),i.params=D({userId:r}),i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Qu,Bu=function(e){function t(t,n,r){var i=e.call(this,t,"DLVR",r)||this;return i.channelUrl=r.channel_url,i.deliveredStateUpdate=r.updated,i}return n(t,e),t}(j),ju=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,s=t.hidePreviousMessages,a=t.allowAutoUnhide;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:i,hide_previous_messages:s,allow_auto_unhide:a},n}return n(t,e),t}(x),zu=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var i=n.ts_message_offset;return r.messageOffsetTimestamp=null!=i?i:null,r}return n(t,e),t}(F),Wu=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.allowAutoUnhide=null,i.hidePreviousMessages=null,i.messageOffsetTimestamp=null,r.data&&(i.allowAutoUnhide=r.data.allow_auto_unhide,i.hidePreviousMessages=r.data.hide_previous_messages),i.messageOffsetTimestamp=r.ts_message_offset,i}return n(t,e),t}(j),Yu=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return n(t,e),t}(z),Ju=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new ht(t,r.data),i}return n(t,e),t}(j),Xu=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return n(t,e),t}(z),Zu=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new ht(t,r.data),i}return n(t,e),t}(j),$u=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,s=r.data.operators,a=void 0===s?[]:s;return i.operators=a.map((function(e){return new ht(i._iid,e)})),i}return n(t,e),t}(Au),ec=function(e){function t(t,n,r){var i=e.call(this,t,"MCNT",r)||this;return i.groupChannelMemberCounts=r.group_channels.map((function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}})),i.openChannelMemberCounts=r.open_channels.map((function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}})),i}return n(t,e),t}(j),tc=function(e){function t(t){var n=t.channelUrl,r=t.messageId;return e.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return n(t,e),t}(z),nc=function(e){function t(t,n,r){var i,s,a,o=this;(o=e.call(this,t,"ADMM",r)||this).message=new Yt(t,r);var u=wt.of(t).sdkState;return o.isMentioned=Ze(o.message.mentionType,null!==(i=o.message.mentionedUserIds)&&void 0!==i?i:null===(s=o.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(a=r.force_update_last_message)&&void 0!==a&&a,o}return n(t,e),t}(j),rc=function(e){function t(t,n,r){var i,s,a,o,u,c,l=this;(l=e.call(this,t,"AEDI",r)||this).message=new Yt(t,r);var h=wt.of(t).sdkState;return l.mentionCountChange=$e({mentionType:null!==(s=null===(i=r.old_values)||void 0===i?void 0:i.mention_type)&&void 0!==s?s:null,mentionedUserIds:null!==(o=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return n(t,e),t}(j),ic=function(e){function t(t,n,r){var i=e.call(this,t,"MRCT",r)||this;return i.channelUrl=r.channel_url,i.channelType=r.channel_type,i.event=new Dt(r),i}return n(t,e),t}(j),sc=function(e){function t(t,n,r){var i=e.call(this,t,"MTHD",r)||this;return i.event=new Pn(t,r),i}return n(t,e),t}(j),ac=function(e){function t(t,n,r){var i=e.call(this,t,"PEDI",r)||this;return i.event=null,i.status=null,i.channelUrl=null,i.channelType=null,i.event=new hr(t,r),i.status=Zt(r.poll.status)||r.poll.status,i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return n(t,e),t}(j),oc=function(e){function t(t,n,r){var i=e.call(this,t,"VOTE",r)||this;return i.event=null,i.channelUrl=null,i.channelType=null,i.event=new dr(r),i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return n(t,e),t}(j),uc=function(t){function r(n,r){var i,s,a,o,u,c,l,h,d,p,f,_,v,m,g,y,E,b,C,T,I,S,N=this;return(N=t.call(this,n,r)||this).includeEmpty=!1,N.includeFrozen=!0,N.includeMetaData=!0,N.channelUrlsFilter=null,N.customTypesFilter=null,N.customTypeStartsWithFilter=null,N.nicknameContainsFilter=null,N.nicknameStartsWithFilter=null,N.nicknameExactMatchFilter=null,N.channelNameContainsFilter="",N.myMemberStateFilter=e.MyMemberStateFilter.ALL,N.unreadChannelFilter=e.UnreadChannelFilter.ALL,N.superChannelFilter=e.SuperChannelFilter.ALL,N.publicChannelFilter=e.PublicChannelFilter.ALL,N.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,N.searchFilter={fields:[],query:null},N.userIdsFilter={userIds:[],includeMode:!0,queryType:e.QueryType.AND},N.metadataKey=null,N.metadataValues=null,N.metadataOrderKeyFilter=null,N.metadataValueStartsWith=null,N.order=e.GroupChannelListOrder.LATEST_LAST_MESSAGE,N.includeEmpty=null!==(i=r.includeEmpty)&&void 0!==i&&i,N.includeFrozen=null===(s=r.includeFrozen)||void 0===s||s,N.includeMetaData=null===(a=r.includeMetaData)||void 0===a||a,N.channelUrlsFilter=null!==(o=r.channelUrlsFilter)&&void 0!==o?o:null,N.customTypesFilter=null!==(u=r.customTypesFilter)&&void 0!==u?u:null,N.customTypeStartsWithFilter=null!==(c=r.customTypeStartsWithFilter)&&void 0!==c?c:"",N.nicknameContainsFilter=null!==(l=r.nicknameContainsFilter)&&void 0!==l?l:null,N.nicknameStartsWithFilter=null!==(h=r.nicknameStartsWithFilter)&&void 0!==h?h:null,N.nicknameExactMatchFilter=null!==(d=r.nicknameExactMatchFilter)&&void 0!==d?d:null,N.channelNameContainsFilter=null!==(p=r.channelNameContainsFilter)&&void 0!==p?p:"",N.myMemberStateFilter=null!==(f=r.myMemberStateFilter)&&void 0!==f?f:e.MyMemberStateFilter.ALL,N.unreadChannelFilter=null!==(_=r.unreadChannelFilter)&&void 0!==_?_:e.UnreadChannelFilter.ALL,N.superChannelFilter=null!==(v=r.superChannelFilter)&&void 0!==v?v:e.SuperChannelFilter.ALL,N.publicChannelFilter=null!==(m=r.publicChannelFilter)&&void 0!==m?m:e.PublicChannelFilter.ALL,N.hiddenChannelFilter=null!==(g=r.hiddenChannelFilter)&&void 0!==g?g:e.HiddenChannelFilter.UNHIDDEN,N.searchFilter=null!==(y=r.searchFilter)&&void 0!==y?y:{fields:[],query:null},N.userIdsFilter=null!==(E=r.userIdsFilter)&&void 0!==E?E:{userIds:[],includeMode:!0,queryType:e.QueryType.AND},N.metadataKey=null!==(b=r.metadataKey)&&void 0!==b?b:null,N.metadataValues=null!==(C=r.metadataValues)&&void 0!==C?C:null,N.metadataOrderKeyFilter=null!==(T=r.metadataOrderKeyFilter)&&void 0!==T?T:null,N.metadataValueStartsWith=null!==(I=r.metadataValueStartsWith)&&void 0!==I?I:null,N.order=null!==(S=r.order)&&void 0!==S?S:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,N}return n(r,t),r.prototype._validate=function(){return t.prototype._validate.call(this)&&g("boolean",this.includeEmpty)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.channelNameContainsFilter)&&b("string",this.channelUrlsFilter,!0)&&b("string",this.customTypesFilter,!0)&&g("string",this.customTypeStartsWithFilter)&&g("string",this.nicknameContainsFilter,!0)&&g("string",this.nicknameStartsWithFilter,!0)&&g("string",this.nicknameExactMatchFilter,!0)&&y(e.MyMemberStateFilter,this.myMemberStateFilter)&&y(e.SuperChannelFilter,this.superChannelFilter)&&y(e.PublicChannelFilter,this.publicChannelFilter)&&y(e.UnreadChannelFilter,this.unreadChannelFilter)&&y(e.HiddenChannelFilter,this.hiddenChannelFilter)&&b(e.GroupChannelSearchField,this.searchFilter.fields)&&g("string",this.searchFilter.query,!0)&&b("string",this.userIdsFilter.userIds)&&g("boolean",this.userIdsFilter.includeMode)&&y(e.QueryType,this.userIdsFilter.queryType)&&y(e.GroupChannelListOrder,this.order)&&g("string",this.metadataOrderKeyFilter,!0)&&g("string",this.metadataKey,!0)&&b("string",this.metadataValues,!0)&&g("string",this.metadataValueStartsWith,!0)},r.prototype.serialize=function(){return ot(this)},r.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,hc.of(this._iid).getMyGroupChannels(this._token,this,this.limit)]):[3,2]:[3,5];case 1:return e=r.sent(),t=e.channels,n=e.token,this._token=n,this._hasNext=!!n,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},r}(Fn),cc=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,r=e.bottom,i=void 0===r?0:r;this.top=n,this.bottom=i}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,u([this.top],o(e),!1)),this.bottom=Math.max.apply(Math,u([this.bottom],o(e),!1))},e}(),lc={},hc=function(){function t(t,n){var r=n.sdkState,o=n.cacheContext,u=n.dispatcher,c=n.sessionManager,l=n.requestQueue,h=n.logger,d=this;this._leftChannels=new Map,this._markAsReadAllLastSentAt=0,this._iid=t,this._sdkState=r,this._sessionManager=c,this._requestQueue=l,this._dispatcher=u,this._logger=h,this._groupChannelHandlers=new Map,this._groupChannelCache=new Bo(this._iid,{sdkState:r,cacheContext:o}),this._unsentMessageCache=new zr(this._iid,{sdkState:r,cacheContext:o}),this._messageCache=new Yr(this._iid,{sdkState:r,cacheContext:o,unsentMessageCache:this._unsentMessageCache}),this._groupChannelBroadcast=new ou({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:u}),this._messageBroadcast=new uu({cacheContext:o,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:u,logger:h}),setInterval((function(){var t,n,r=function(t){t.invalidateTypingStatus()&&(d._dispatcher.dispatch(new su({channels:[t],source:e.GroupChannelEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),d._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(t)})))};try{for(var i=a(d._groupChannelCache.channels),s=i.next();!s.done;s=i.next()){r(s.value)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}),1e3),this._dispatcher.on((function(e){e instanceof j?d._handleEvent(e):e instanceof Zr&&i(d,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=e.message,[4,this.getChannel(t.channelUrl,!0)];case 1:return n=r.sent(),t instanceof nn?n._autoResendUserMessage(t):t instanceof an&&n._autoResendFileMessage(t),[2]}}))}))})),lc[t]=this}return t.of=function(e){return lc[e]},Object.defineProperty(t.prototype,"handlers",{get:function(){return u([],o(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),t.prototype.buildGroupChannelFromSerializedData=function(e){var t=ut(e);return new wl(this._iid,wl.payloadify(t))},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=ut(e);return new uc(this._iid,t)},t.prototype.buildMemberFromSerializedData=function(e){var t=ut(e);return new Ho(this._iid,Ho.payloadify(t))},t.prototype.getChannelFromCache=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getChannelsFromCache=function(e,t,n){return i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n})];case 1:return[2,r.sent()]}}))}))},t.prototype._handleEvent=function(t){return i(this,void 0,void 0,(function(){var n,r,o,u,c,l,h,d,f,_,v,m,g,y,E,b,C,T,I,S,N,w,M,A,U,O,R,L,k,D,P,x,F,q,G,H,V,K,Q,B,j,z,W,Y,J,X,Z,$,ee,te,ne,re,ie,se,ae,oe,ue,ce,le,he,de,pe,fe,_e,ve,me,ge,ye,Ee,be,Ce,Te,Ie,Se,Ne,we,Me,Ae,Ue,Oe,Re,Le,ke,xe,Fe,qe,Ge,He,Ve,Ke,Qe,Be,je,ze,We,Ye,Je,Xe,Ze,$e,et,tt,nt,rt,it,st,at,ot,ut,ct,lt,ht,dt,pt,ft,_t,vt,mt,gt,yt,Et,bt,Ct,Tt,It,St,Nt,Mt,At,Ut,Ot=this;return s(this,(function(Rt){switch(Rt.label){case 0:switch(Rt.trys.push([0,76,,77]),t.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"PEDI":return[3,32];case"VOTE":return[3,34];case"SYEV":return[3,36];case"USEV":return[3,74]}return[3,75];case 1:return d=null,"MESG"===t.code?d=t.as(ho):"FILE"===t.code?d=t.as(cn):"ADMM"!==t.code&&"BRDM"!=t.code||(d=t.as(nc)),d?(n=d.message,r=d.isMentioned,o=d.forceUpdateLastMessage,n.channelType!==e.ChannelType.GROUP?[3,3]:(Pe((function(){return i(Ot,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new tc(n),this._requestQueue.send(e),[2]}))}))})),M=this._groupChannelCache.isCachedInMemory(n.channelUrl),m=n instanceof Bt&&n.sender.userId===this._sdkState.userId,[4,this.getChannel(n.channelUrl,!0)])):[3,3];case 2:if((u=Rt.sent()).hiddenState=e.HiddenState.UNHIDDEN,n instanceof Bt){c=wt.of(this._iid).useMemberInfoInMessage;try{for(l=a(u.members),h=l.next();!h.done;h=l.next())if((He=h.value).userId===n.sender.userId){c||(n.sender.nickname=He.nickname,n.sender.plainProfileUrl=He.plainProfileUrl,n.sender.metaData=He.metaData,n.sender.isBlockedByMe=He.isBlockedByMe);break}}catch(e){Et={error:e}}finally{try{h&&!h.done&&(bt=l.return)&&bt.call(l)}finally{if(Et)throw Et.error}}!c&&r&&n.mentionedUsers.forEach((function(e){var t,n;try{for(var r=a(u.members),i=r.next();!i.done;i=r.next()){var s=i.value;if(e.userId===s.userId){e.nickname=s.nickname,e.plainProfileUrl=s.plainProfileUrl,e.metaData=s.metaData;break}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),m&&(y=this._sessionManager.currentUser)&&(y.nickname=n.sender.nickname,y.plainProfileUrl=n.sender.plainProfileUrl,y.metaData=n.sender.metaData)}n.silent&&!m||(u.isEphemeral||M)&&((!u.lastMessage||u.lastMessage.createdAt<n.createdAt)&&(u.lastMessage=n),m||u._updateUnreadCount(u.unreadMessageCount+1,u.unreadMentionCount+(r?1:0))),o&&(!u.lastMessage||u.lastMessage.createdAt<n.createdAt)&&(u.lastMessage=n),this._dispatcher.dispatch(new su({channels:[u],source:e.GroupChannelEventSource.EVENT_MESSAGE_RECEIVED})),n.silent&&!m||De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(u)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),this._dispatcher.dispatch(new yn({messages:[n],source:e.MessageEventSource.EVENT_MESSAGE_RECEIVED})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,i,o,c;return s(this,(function(s){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(i=t.value).onMessageReceived(u,n),r&&i.onMentionReceived(u,n)}catch(e){o={error:e}}finally{try{t&&!t.done&&(c=e.return)&&c.call(e)}finally{if(o)throw o.error}}return[2]}))}))})),Rt.label=3;case 3:return[3,75];case 4:return d=null,"MEDI"===t.code?d=t.as(fo):"FEDI"===t.code?d=t.as(vo):"AEDI"===t.code&&(d=t.as(rc)),d?(f=d.message,_=d.mentionCountChange,f.channelType!==e.ChannelType.GROUP?[3,6]:(M=this._groupChannelCache.isCachedInMemory(f.channelUrl),[4,this.getChannel(f.channelUrl,!0)])):[3,6];case 5:v=Rt.sent(),m=f instanceof Bt&&f.sender.userId===this._sdkState.userId,g=!1,m?(y=this._sessionManager.currentUser)&&(y.nickname=f.sender.nickname,y.plainProfileUrl=f.sender.plainProfileUrl,y.metaData=f.sender.metaData):v.isReadMessage(f)||0!==_&&!f.silent&&M&&(v._updateUnreadCount(v.unreadMessageCount,v.unreadMentionCount+_),g=!0),!v.lastMessage||v.lastMessage.createdAt<f.createdAt?(v.lastMessage=f,g=!0):v.lastMessage.isIdentical(f)&&(M?v.lastMessage.updatedAt<f.updatedAt&&(v.lastMessage=f,g=!0):g=!0),g&&(this._dispatcher.dispatch(new su({channels:[v],source:e.GroupChannelEventSource.EVENT_MESSAGE_UPDATED})),f.silent&&!m||De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(v)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),this._dispatcher.dispatch(new yn({messages:[f],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated(v,f),0!==_&&n.onMentionReceived(v,f)}catch(e){r={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Rt.label=6;case 6:return[3,75];case 7:return E=t.as(yo),X=E.channelUrl,Z=E.channelType,b=E.messageId,Z!==e.ChannelType.GROUP?[3,9]:[4,this.getChannel(X,!0)];case 8:C=Rt.sent(),this._dispatcher.dispatch(new En({messageIds:[b],source:e.MessageEventSource.EVENT_MESSAGE_DELETED})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onMessageDeleted(C,b)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),Rt.label=9;case 9:return[3,75];case 10:return(T=t.as(Vu).readStatus).channelType!==e.ChannelType.GROUP?[3,12]:(M=this._groupChannelCache.isCachedInMemory(T.channelUrl),[4,this.getChannel(T.channelUrl,!0)]);case 11:I=Rt.sent(),M&&I._updateUnreadMemberState(T.reader.userId,T.readAt),T.reader.userId===this._sdkState.userId?M?(I.unreadMessageCount>0||I.unreadMentionCount>0)&&(I._updateUnreadCount(0,0),this._dispatcher.dispatch(new su({channels:[I],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(I)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):0!==I.unreadMessageCount&&0!==I.unreadMentionCount||(this._dispatcher.dispatch(new su({channels:[I],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(I)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):(this._dispatcher.dispatch(new su({channels:[I],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUnreadMemberStatusUpdated(I)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),Rt.label=12;case 12:return[3,75];case 13:return S=t.as(Bu),X=S.channelUrl,N=S.deliveredStateUpdate,w=void 0===N?{}:N,M=this._groupChannelCache.isCachedInMemory(X),[4,this.getChannel(X,!0)];case 14:if(A=Rt.sent(),M)for(U in w)A._updateUndeliveredMemberState(U,w[U]);return this._dispatcher.dispatch(new su({channels:[A],source:e.GroupChannelEventSource.EVENT_CHANNEL_DELIVERED})),Object.keys(w).some((function(e){return e!==Ot._sdkState.userId}))&&De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUndeliveredMemberStatusUpdated(A)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),[3,75];case 15:return O=t.as(ic),X=O.channelUrl,Z=O.channelType,R=O.event,Z!==e.ChannelType.GROUP?[3,18]:[4,this.getChannel(X,!0)];case 16:return L=Rt.sent(),[4,this.getMessageFromCache(R.messageId)];case 17:(P=Rt.sent())&&(P.applyReactionEvent(R),this._dispatcher.dispatch(new yn({messages:[P],source:e.MessageEventSource.EVENT_MESSAGE_REACTION_UPDATED}))),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onReactionUpdated(L,R)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),Rt.label=18;case 18:return[3,75];case 19:return(k=t.as(sc).event).channelType!==e.ChannelType.GROUP?[3,22]:[4,this.getChannel(k.channelUrl,!0)];case 20:return D=Rt.sent(),[4,this.getMessageFromCache(k.targetMessageId)];case 21:(P=Rt.sent())&&(P.applyThreadInfoUpdateEvent(k),this._dispatcher.dispatch(new yn({messages:[P],source:e.MessageEventSource.EVENT_MESSAGE_THREADINFO_UPDATED}))),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onThreadInfoUpdated(D,k)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),Rt.label=22;case 22:return[3,75];case 23:x=t.as(ec).groupChannelMemberCounts,F=[],Rt.label=24;case 24:Rt.trys.push([24,29,30,31]),q=a(x),G=q.next(),Rt.label=25;case 25:return G.done?[3,28]:(H=G.value,X=H.channelUrl,we=H.memberCount,Me=H.joinedMemberCount,V=H.updatedAt,[4,this.getChannelFromCache(X)]);case 26:(K=Rt.sent())&&K._setLatestMemberCount(we,Me,V)&&F.push(K),Rt.label=27;case 27:return G=q.next(),[3,25];case 28:return[3,31];case 29:return Q=Rt.sent(),Ct={error:Q},[3,31];case 30:try{G&&!G.done&&(Tt=q.return)&&Tt.call(q)}finally{if(Ct)throw Ct.error}return[7];case 31:return F.length>0&&(this._dispatcher.dispatch(new su({channels:F,source:e.GroupChannelEventSource.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelMemberCountChanged(F)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),[3,75];case 32:return B=t.as(ac),j=B.event,z=B.status,X=B.channelUrl,Z=B.channelType,X&&Z?[4,this.getChannel(X,!0)]:[3,75];case 33:return W=Rt.sent(),this._dispatcher.dispatch(new Tn({event:j,source:e.MessageEventSource.EVENT_POLL_UPDATED})),De("removed"===z?function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onPollDeleted(W,j.pollId)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}:function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onPollUpdated(W,j)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}),[3,75];case 34:return Y=t.as(oc),J=Y.event,X=Y.channelUrl,Z=Y.channelType,X&&Z?[4,this.getChannel(X,!0)]:[3,75];case 35:return $=Rt.sent(),this._dispatcher.dispatch(new In({event:J,source:e.MessageEventSource.EVENT_POLL_VOTED})),De((function(){return i(Ot,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onPollVoted($,J)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),[3,75];case 36:if(!(ee=t.as(Au).event).isGroupChannelEvent)return[3,73];switch(ee.category){case Ko.CHANNEL_JOIN:return[3,37];case Ko.CHANNEL_LEAVE:return[3,39];case Ko.CHANNEL_OPERATOR_UPDATE:return[3,43];case Ko.CHANNEL_INVITE:return[3,45];case Ko.CHANNEL_DECLINE_INVITE:return[3,47];case Ko.TYPING_START:case Ko.TYPING_END:return[3,49];case Ko.USER_CHANNEL_MUTE:case Ko.USER_CHANNEL_UNMUTE:return[3,51];case Ko.USER_CHANNEL_BAN:return[3,53];case Ko.USER_CHANNEL_UNBAN:return[3,57];case Ko.CHANNEL_FREEZE:case Ko.CHANNEL_UNFREEZE:return[3,59];case Ko.CHANNEL_HIDE:return[3,61];case Ko.CHANNEL_UNHIDE:return[3,63];case Ko.CHANNEL_DELETED:return[3,65];case Ko.CHANNEL_PROP_CHANGED:return[3,67];case Ko.CHANNEL_META_DATA_CHANGED:return[3,69];case Ko.CHANNEL_META_COUNTERS_CHANGED:return[3,71]}return[3,73];case 37:return[4,this.getChannel(ee.channelUrl,!0)];case 38:return te=Rt.sent(),ne=t.as(Ru),re=ne.memberCount,ie=ne.joinedMemberCount,se=ne.members,ae=!1,se.forEach((function(t){te.isExclusive||te.isSuper||te.isBroadcast?ae=ae||te._setLatestMemberCount(re,ie,ee.ts):(t.state=e.MemberState.JOINED,te.addMember(t,ee.ts),Ot._updateJoinedMemberCount(te)),t.userId===Ot._sdkState.userId&&(te.myMemberState=e.MemberState.JOINED)})),this._dispatcher.dispatch(new su({channels:[te],source:e.GroupChannelEventSource.EVENT_CHANNEL_JOINED})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var r=a(se),i=r.next();!i.done;i=r.next()){var s=i.value;e.onUserJoined(te,s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}te.isBroadcast&&ae&&e.onChannelMemberCountChanged([te])})),[2]}))}))})),[3,73];case 39:return(Ve=this._leftChannels.get(ee.channelUrl))?(ue=Ve.channel,[3,42]):[3,40];case 40:return[4,this.getChannel(ee.channelUrl,!0)];case 41:ue=Rt.sent(),Rt.label=42;case 42:return oe=ue,ce=t.as(ku),we=ce.memberCount,Me=ce.joinedMemberCount,le=ce.member,he=!1,de=wt.of(this._iid).appInfo,oe.isExclusive||oe.isSuper||oe.isBroadcast?he=oe._setLatestMemberCount(we,Me,ee.ts):(de.enabledChannelMemberShipHistory?(oe.members.find((function(e){return e.userId===le.userId})).state=e.MemberState.LEFT,oe.memberCount=we):oe.removeMember(le),this._updateJoinedMemberCount(oe)),le.userId===this._sdkState.userId?(oe.myMemberState=e.MemberState.NONE,oe.invitedAt=0,oe.joinedAt=0,oe._updateUnreadCount(0,0),oe.isPublic?this._dispatcher.dispatch(new su({channels:[oe],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})):(this._markAsLeave(oe),this._dispatcher.dispatch(new au({channelUrls:[oe.url],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new su({channels:[oe],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft(oe,le),oe.isBroadcast&&he&&e.onChannelMemberCountChanged([oe])})),[2]}))}))})),[3,73];case 43:return[4,this.getChannel(ee.channelUrl,!0)];case 44:pe=Rt.sent(),fe=t.as($u).operators,_e=fe.map((function(e){return e.userId}));try{for(ve=a(pe.members),me=ve.next();!me.done;me=ve.next())(He=me.value).role=_e.includes(He.userId)?e.Role.OPERATOR:e.Role.NONE}catch(e){It={error:e}}finally{try{me&&!me.done&&(St=ve.return)&&St.call(ve)}finally{if(It)throw It.error}}return pe.myRole=_e.includes(this._sdkState.userId)?e.Role.OPERATOR:e.Role.NONE,this._dispatcher.dispatch(new su({channels:[pe],source:e.GroupChannelEventSource.EVENT_CHANNEL_OPERATOR_UPDATED})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated(pe,fe)})),[2]}))}))})),[3,73];case 45:return[4,this.getChannel(ee.channelUrl,!0)];case 46:ge=Rt.sent(),ye=t.as(xu),we=ye.memberCount,Me=ye.joinedMemberCount,Ee=ye.inviter,(be=ye.invitees).forEach((function(t){return t.state=e.MemberState.INVITED}));try{for(Ce=a(be),Te=Ce.next();!Te.done;Te=Ce.next())Ie=Te.value,ge.isExclusive||ge.isSuper||ge.isBroadcast?ge._setLatestMemberCount(we,Me,ee.ts):ge.addMember(Ie,ee.ts),this._sdkState.userId===Ie.userId&&(ge.hiddenState=e.HiddenState.UNHIDDEN,ge.myMemberState!==e.MemberState.JOINED&&(ge.myMemberState=e.MemberState.INVITED),ge.invitedAt=ee.ts)}catch(e){Nt={error:e}}finally{try{Te&&!Te.done&&(Mt=Ce.return)&&Mt.call(Ce)}finally{if(Nt)throw Nt.error}}return this._dispatcher.dispatch(new su({channels:[ge],source:e.GroupChannelEventSource.EVENT_CHANNEL_INVITED})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation(ge,Ee,be)})),[2]}))}))})),[3,73];case 47:return[4,this.getChannel(ee.channelUrl,!0)];case 48:return Se=Rt.sent(),Ne=t.as(Gu),we=Ne.memberCount,Me=Ne.joinedMemberCount,Ae=Ne.inviter,Ue=Ne.invitee,Se.isExclusive||Se.isSuper||Se.isBroadcast?Se._setLatestMemberCount(we,Me,ee.ts):Se.removeMember(Ue),this._sdkState.userId===Ue.userId?(Se.invitedAt=0,Se.myMemberState=e.MemberState.NONE,Se.isPublic?this._dispatcher.dispatch(new su({channels:[Se],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new au({channelUrls:[Se.url],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new su({channels:[Se],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation(Se,Ae,Ue)})),[2]}))}))})),[3,73];case 49:return[4,this.getChannel(ee.channelUrl,!0)];case 50:return Oe=Rt.sent(),Re=ee.category===Ko.TYPING_START,Le=t.as(Re?Ju:Zu).user,Oe._updateTypingStatus(Le,Re?ee.ts:0),this._dispatcher.dispatch(new su({channels:[Oe],source:e.GroupChannelEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(Oe)})),[2]}))}))})),[3,73];case 51:return[4,this.getChannel(ee.channelUrl,!0)];case 52:ke=Rt.sent(),xe=ee.category===Ko.USER_CHANNEL_MUTE,(Fe=t.as(xe?Za:eo).user).userId===this._sdkState.userId&&(ke.myMutedState=xe?e.MutedState.MUTED:e.MutedState.UNMUTED);try{for(qe=a(ke.members),Ge=qe.next();!Ge.done;Ge=qe.next())if((He=Ge.value).userId===Fe.userId){He.isMuted=xe;break}}catch(e){At={error:e}}finally{try{Ge&&!Ge.done&&(Ut=qe.return)&&Ut.call(qe)}finally{if(At)throw At.error}}return this._dispatcher.dispatch(new su({channels:[ke],source:xe?e.GroupChannelEventSource.EVENT_CHANNEL_MUTED:e.GroupChannelEventSource.EVENT_CHANNEL_UNMUTED})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){xe?e.onUserMuted(ke,Fe):e.onUserUnmuted(ke,Fe)})),[2]}))}))})),[3,73];case 53:return(Ve=this._leftChannels.get(ee.channelUrl))?(Qe=Ve.channel,[3,56]):[3,54];case 54:return[4,this.getChannel(ee.channelUrl,!0)];case 55:Qe=Rt.sent(),Rt.label=56;case 56:return Ke=Qe,this._markAsLeave(Ke),Be=t.as(no).user,De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned(Ke,Be)})),[2]}))}))})),[3,73];case 57:return[4,this.getChannel(ee.channelUrl,!0)];case 58:return je=Rt.sent(),ze=t.as(io).user,De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned(je,ze)})),[2]}))}))})),[3,73];case 59:return[4,this.getChannel(ee.channelUrl,!0)];case 60:return We=Rt.sent(),Ye=t.as(ao).freeze,We.isFrozen=Ye,this._dispatcher.dispatch(new su({channels:[We],source:Ye?e.GroupChannelEventSource.EVENT_CHANNEL_FROZEN:e.GroupChannelEventSource.EVENT_CHANNEL_UNFROZEN})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Ye?e.onChannelFrozen(We):e.onChannelUnfrozen(We)})),[2]}))}))})),[3,73];case 61:return[4,this.getChannel(ee.channelUrl,!0)];case 62:return Je=Rt.sent(),Xe=t.as(Wu),Ze=Xe.allowAutoUnhide,$e=Xe.hidePreviousMessages,et=Xe.messageOffsetTimestamp,null!==Ze&&(Je.hiddenState=Ze?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),null!==$e&&$e&&Je._updateUnreadCount(0,0),null!==et&&(Je.messageOffsetTimestamp=et),this._dispatcher.dispatch(new su({channels:[Je],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden(Je)})),[2]}))}))})),[3,73];case 63:return[4,this.getChannel(ee.channelUrl,!0)];case 64:return(tt=Rt.sent()).hiddenState=e.HiddenState.UNHIDDEN,this._dispatcher.dispatch(new su({channels:[tt],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(tt)})),[2]}))}))})),[3,73];case 65:return[4,this.getChannel(ee.channelUrl,!0)];case 66:return nt=Rt.sent(),this._dispatcher.dispatch(new au({channelUrls:[ee.channelUrl],source:e.GroupChannelEventSource.EVENT_CHANNEL_DELETED})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted(nt.url,nt.channelType)})),[2]}))}))})),[3,73];case 67:return[4,this.getChannelWithoutCache(ee.channelUrl,!0)];case 68:return rt=Rt.sent(),this._dispatcher.dispatch(new su({channels:[rt],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(rt)})),[2]}))}))})),[3,73];case 69:return[4,this.getChannel(ee.channelUrl,!0)];case 70:return it=Rt.sent(),st=t.as(xa),at=st.created,ot=st.updated,ut=st.deleted,at&&it._upsertCachedMetaData(at,ee.ts),ot&&it._upsertCachedMetaData(ot,ee.ts),ut&&it._removeFromCachedMetaData(ut,ee.ts),De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){at&&e.onMetaDataCreated(it,at),ot&&e.onMetaDataUpdated(it,ot),ut&&e.onMetaDataDeleted(it,ut)})),[2]}))}))})),[3,73];case 71:return[4,this.getChannel(ee.channelUrl,!0)];case 72:return ct=Rt.sent(),lt=t.as(Wa),ht=lt.created,dt=lt.updated,pt=lt.deleted,De((function(){return i(Ot,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){ht&&e.onMetaCounterCreated(ct,ht),dt&&e.onMetaCounterUpdated(ct,dt),pt&&e.onMetaCounterDeleted(ct,pt)})),[2]}))}))})),[3,73];case 73:return[3,75];case 74:switch((ft=t.as(ri).event).category){case xr.USER_BLOCK:_t=ti.getDataAsUserBlockEvent(this._iid,ft),mt=_t.blocker,gt=_t.blockee,this._groupChannelCache.block(mt.userId,gt.userId);break;case xr.USER_UNBLOCK:vt=ti.getDataAsUserBlockEvent(this._iid,ft),mt=vt.blocker,gt=vt.blockee,this._groupChannelCache.unblock(mt.userId,gt.userId)}return[3,75];case 75:return[3,77];case 76:if(yt=Rt.sent(),p(yt))throw yt;return[3,77];case 77:return[2]}}))}))},t.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)},t.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},t.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},t.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},t.prototype.subscribeGroupChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},t.prototype.unsubscribeGroupChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},t.prototype.subscribeMessageEvent=function(e,t){this._messageBroadcast.subscribe(e,t)},t.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},t.prototype._updateJoinedMemberCount=function(t){t.joinedMemberCount=t.members.filter((function(t){return t.state===e.MemberState.JOINED})).length},t.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:ct(g("string",e)).throw(f.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}}))}))},t.prototype.getChannelWithoutCache=function(t,n){return void 0===n&&(n=!1),i(this,void 0,void 0,(function(){var r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",t)).throw(f.invalidParameters),r=new hu({channelUrl:t,isInternalCall:n}),[4,this._requestQueue.send(r)];case 1:switch(i=s.sent(),a=i.as(du).channel,o=a.unreadMessageCount,u=a.unreadMentionCount,a.myCountPreference){case e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY:u=0;break;case e.CountPreference.UNREAD_MENTION_COUNT_ONLY:o=0;break;case e.CountPreference.OFF:o=0,u=0}return a._updateUnreadCount(o,u),[4,this._groupChannelCache.upsert([a])];case 2:return s.sent(),[2,a]}}))}))},t.prototype.getMyGroupChannels=function(t,n,a,o){return void 0===o&&(o=e.GroupChannelEventSource.REQUEST_CHANNEL),i(this,void 0,void 0,(function(){var e,i,u,c,l;return s(this,(function(s){switch(s.label){case 0:return e=new pu(r(r({},n),{userId:this._sdkState.userId,token:t,limit:a})),[4,this._requestQueue.send(e)];case 1:return i=s.sent(),u=i.as(fu),c=u.channels,l=u.token,this._dispatcher.dispatch(new su({channels:c,source:o})),[2,{channels:c,token:l}]}}))}))},t.prototype.getMessageFromCache=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getMessagesFromCache=function(e,t,n,r,a){return void 0===a&&(a=Sr),i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:a,filter:r,backward:"next"===n})];case 1:return[2,i.sent()]}}))}))},t.prototype.getPollMessagesFromCache=function(e,t,n,r){return void 0===r&&(r=Sr),i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:n,backward:!1,isPollOnly:!0})];case 1:return[2,i.sent()]}}))}))},t.prototype.getAllFailedMessagesFromCache=function(t,n){return i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:t,filter:n,sendingStatus:e.SendingStatus.FAILED})];case 1:return[2,r.sent()]}}))}))},t.prototype.removeFailedMessageFromCache=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}}))}))},t.prototype.getCachedMessageCountBetween=function(e,t,n,r){return i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this._messageCache.countBetween(e,t,new cc({top:n,bottom:r}))];case 1:return[2,i.sent()]}}))}))},t.prototype.getMyGroupChannelChangeLogs=function(t,n,a){return void 0===a&&(a=e.GroupChannelEventSource.REQUEST_CHANNEL_CHANGELOGS),i(this,void 0,void 0,(function(){var e,i,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return e=r(r({},Jo),n),ct((g("string",t)||g("number",t))&&Xo(e)).throw(f.invalidParameters),i=new cu(D({userId:this._sdkState.userId,ts:"number"==typeof t?t:null,token:"string"==typeof t?t:null,filter:e})),[4,this._requestQueue.send(i)];case 1:return o=s.sent(),u=o.as(lu),c=u.updatedChannels,l=u.deletedChannelUrls,c.length>0&&this._dispatcher.dispatch(new su({channels:c,source:a})),l.length>0&&this._dispatcher.dispatch(new au({channelUrls:l,source:a})),[2,u]}}))}))},t.prototype.getGroupChannelCount=function(e){return i(this,void 0,void 0,(function(){var t,n,i;return s(this,(function(s){switch(s.label){case 0:return t=r(r({},Zo),e),ct($o(t)).throw(f.invalidParameters),n=new _u({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return i=s.sent(),[2,i.as(vu).groupChannelCount]}}))}))},t.prototype.getUnreadItemCount=function(t){return i(this,void 0,void 0,(function(){var n,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},tu),t),ct(function(t){return b(e.UnreadItemKey,t.keys)}(n)).throw(f.invalidParameters),i=wt.of(this._iid),a=i.sdkState,o=i.requestQueue,u=new mu({userId:a.userId,filter:n}),[4,o.send(u)];case 1:return[2,s.sent().as(gu)]}}))}))},t.prototype.getTotalUnreadChannelCount=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new yu({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Eu).unreadCount]}}))}))},t.prototype.getTotalUnreadMessageCount=function(t){return i(this,void 0,void 0,(function(){var n,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},nu),t),ct(function(t){return b("string",t.channelCustomTypesFilter,!0)&&y(e.SuperChannelFilter,t.superChannelFilter)}(n)).throw(f.invalidParameters),i=wt.of(this._iid),a=i.sdkState,o=i.requestQueue,u=new bu({userId:a.userId,filter:n}),[4,o.send(u)];case 1:return c=s.sent(),[2,c.as(Cu).unreadCount]}}))}))},t.prototype.getTotalScheduledMessageCount=function(t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},ru),t),ct(function(t){return g("string",t.channelUrl,!0)&&b(e.ScheduledStatus,t.scheduledStatus,!0)&&y(e.MessageTypeFilter,t.messageTypeFilter)}(n)).throw(f.invalidParameters),i=wt.of(this._iid).requestQueue,a=new Tu(n),[4,i.send(a)];case 1:return o=s.sent(),[2,o.as(Iu).count]}}))}))},t.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=wt.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=wt.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=wt.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},t.prototype.createChannel=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a;return s(this,(function(s){switch(s.label){case 0:return t=r(r({},Wo),e),ct(Yo(t)).throw(f.invalidParameters),t.isPublic||(t.accessCode=null),n=new Nu(r({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return i=s.sent(),a=i.as(wu).channel,[4,this._groupChannelCache.upsert([a])];case 2:return s.sent(),[2,a]}}))}))},t.prototype.markAsReadAll=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,o,u,c;return s(this,(function(s){switch(s.label){case 0:return e=Date.now(),ct(e-this._markAsReadAllLastSentAt>=1e3).throw(f.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new Mu({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:s.sent(),n=this._groupChannelCache.channels;try{for(r=a(n),i=r.next();!i.done;i=r.next())(o=i.value)._updateUnreadMemberState(this._sdkState.userId,e),o._updateUnreadCount(0,0)}catch(e){u={error:e}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return n.length>0?[4,this._groupChannelCache.upsert(n)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},t.prototype.markAsReadWithChannelUrls=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return t=Date.now(),ct(b("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(f.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new Mu({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:s.sent(),r=this._groupChannelCache.channels,i=[];try{for(o=a(r),u=o.next();!u.done;u=o.next())c=u.value,e.includes(c.url)&&(c._updateUnreadMemberState(this._sdkState.userId,t),c._updateUnreadCount(0,0),i.push(c))}catch(e){l={error:e}}finally{try{u&&!u.done&&(h=o.return)&&h.call(o)}finally{if(l)throw l.error}}return i.length>0?[4,this._groupChannelCache.upsert(i)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},t.prototype.markAsDelivered=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},t}(),dc=new Map,pc=new Map,fc=new Map,_c=function(){function e(t){var n=t.key,r=t.concurrentCallLimit,a=void 0===r?2:r,o=t.backOffDelay,u=void 0===o?0:o,c=this;this._holdersKey=e.createSemaphoreHoldersKey(n),this._resolversKey=e.createSemaphoreResolversKey(n),this._chainProcessStateKey=e.createChainProcessStateKey(n),this._numLocks=a,this._backOffDelay=u,this._localAcquiredKeys=[],this._localResolversData=[],Q()?(dc[this._holdersKey]||(dc[this._holdersKey]=[]),pc[this._resolversKey]||(pc[this._resolversKey]=[])):(window.addEventListener("storage",(function(e){return i(c,void 0,void 0,(function(){var t,n;return s(this,(function(r){if(this._localResolversData.length>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()&&this._hasHighestPriorityResolver())switch(e.key){case this._holdersKey:if(t=JSON.parse(e.oldValue),n=JSON.parse(e.newValue),!t||!n||n.length>=t.length)return[2];this._processChainResolve();break;case this._chainProcessStateKey:if(JSON.parse(e.newValue))return[2];this._processChainResolve();break;default:return[2]}return[2]}))}))})),window.addEventListener("beforeunload",(function(){var e=c._getLocalResolversData(),t=c._localResolversData.map((function(e){return e.key})),n=e.filter((function(e){return t.indexOf(e.key)<0}));window.localStorage.setItem(c._resolversKey,JSON.stringify(n)),c._localAcquiredKeys.forEach((function(e){return c.release(e)}))})))}return e.createSemaphoreHoldersKey=function(e){return"collection@semaphore_holders_for:"+e},e.createSemaphoreResolversKey=function(e){return"collection@semaphore_resolvers_for:"+e},e.createChainProcessStateKey=function(e){return"collection@semaphore_chain_process_state_for:"+e},Object.defineProperty(e.prototype,"numLocks",{get:function(){return this._numLocks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backOffDelay",{get:function(){return this._backOffDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numLocksAvailable",{get:function(){if(Q())return this.numLocks-dc[this._holdersKey].length;var e=this._getLocalHoldersData();return this.numLocks-e.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waitCount",{get:function(){return Q()?pc[this._resolversKey].length:this._getLocalResolversData().length},enumerable:!1,configurable:!0}),e.prototype._hasHighestPriorityResolver=function(){var e=this._getLocalResolversData();return e.length>0&&this._localResolversData.map((function(e){return e.key})).indexOf(e[0].key)>=0},e.prototype._isProcessChainAcquireRunning=function(){if(Q())return fc[this._chainProcessStateKey];var e=window.localStorage[this._chainProcessStateKey];return void 0!==e&&JSON.parse(e)},e.prototype._setProcessChainAcquireRunning=function(e){Q()?fc[this._chainProcessStateKey]=e:e?window.localStorage.setItem(this._chainProcessStateKey,JSON.stringify(e)):window.localStorage.removeItem(this._chainProcessStateKey)},e.prototype._processChainResolve=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this.waitCount>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()?(this._setProcessChainAcquireRunning(!0),this._tryResolve()?[4,Re(this._backOffDelay)]:[3,2]):[3,3];case 1:t.sent(),t.label=2;case 2:this._setProcessChainAcquireRunning(!1),Q()?this._processChainResolve():(e=new StorageEvent("storage",{key:this._chainProcessStateKey,oldValue:JSON.stringify(!0),newValue:JSON.stringify(!1)}),dispatchEvent(e)),t.label=3;case 3:return[2]}}))}))},e.prototype.acquire=function(e){return void 0===e&&(e=0),i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){return Q()?[2,new Promise((function(t){for(var r={key:U(),resolver:function(e){return t(e)},priority:e},i=pc[n._resolversKey],s=-1,a=0;a<i.length;a++)if(e>i[a].priority){s=a;break}s>=0?pc[n._resolversKey].splice(s,0,r):pc[n._resolversKey].push(r),n._processChainResolve()}))]:(t=this._getLocalResolversData(),[2,new Promise((function(r){for(var i=U(),s={key:i,priority:e},a={key:i,resolver:function(e){return r(e)},priority:e},o=-1,u=0;u<t.length;u++)if(e>t[u].priority){o=u;break}o>=0?(t.splice(o,0,s),n._localResolversData.splice(o,0,a)):(t.push(s),n._localResolversData.push(a)),window.localStorage.setItem(n._resolversKey,JSON.stringify(t)),n._processChainResolve()}))])}))}))},e.prototype.release=function(e){if(Q()){if((t=dc[this._holdersKey].indexOf(e))>=0)return dc[this._holdersKey].splice(t,1),this._processChainResolve(),!0}else if(window.localStorage[this._holdersKey]){var t,n=JSON.parse(window.localStorage[this._holdersKey]),r=u([],o(n),!1);if((t=n.indexOf(e))>=0){n.splice(t,1),window.localStorage.setItem(this._holdersKey,JSON.stringify(n)),this._localAcquiredKeys.splice(this._localAcquiredKeys.indexOf(e),1);var i=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(r),newValue:JSON.stringify(n)});return dispatchEvent(i),!0}}return!1},e.prototype._tryResolve=function(){if(Q()){if(dc[this._holdersKey].length<this.numLocks){var e=U();return dc[this._holdersKey]=u(u([],o(dc[this._holdersKey]),!1),[e],!1),(n=pc[this._resolversKey].shift()).resolver(e),!0}}else{var t=this._getLocalHoldersData();if(t.length<this.numLocks){e=U();var n=this._localResolversData.shift(),r=this._getLocalResolversData(),i=r.map((function(e){return e.key})).indexOf(n.key);r.splice(i,1),window.localStorage.setItem(this._resolversKey,JSON.stringify(r)),window.localStorage.setItem(this._holdersKey,JSON.stringify(u(u([],o(t),!1),[e],!1))),this._localAcquiredKeys.push(e);var s=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(u([],o(t),!1)),newValue:JSON.stringify(u(u([],o(t),!1),[e],!1))});return dispatchEvent(s),(0,n.resolver)(e),!0}}return!1},e.prototype._getLocalHoldersData=function(){var e=window.localStorage[this._holdersKey];return void 0!==e?JSON.parse(e):[]},e.prototype._getLocalResolversData=function(){var e=window.localStorage[this._resolversKey];return void 0!==e?JSON.parse(e):[]},e}();!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(Qu||(Qu={}));var vc=function(e){function t(t,n,r,i){void 0===r&&(r=2),void 0===i&&(i=10);var s=e.call(this)||this;return s._worker=null,s._state=Qu.IDLE,s._semaphore=null,s._retryCount=0,s._retryLimit=3,s.priority=0,s._worker=n,s._semaphore=new _c({key:t,concurrentCallLimit:r,backOffDelay:i}),s}return n(t,e),Object.defineProperty(t.prototype,"isIdle",{get:function(){return this._state===Qu.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._state===Qu.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDone",{get:function(){return this._state===Qu.END},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),t.prototype._run=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}}))}))},t.prototype.start=function(e){this.isIdle&&(this._state=Qu.RUNNING,this._run(e))},t.prototype.stop=function(){this._state=Qu.IDLE,this.dispatch("stop")},t.prototype.end=function(){this._state=Qu.END,this.dispatch("end")},t}(R),mc=function(e){this.source=e},gc=function(e){this.source=e},yc={},Ec=100,bc=function(){function t(t){var n=t._iid,r=t.channel,a=this;this._prevSync=null,this._nextSync=null,this._metadata=null,this._iid=n,this._channel=r;var o,u,c=wt.of(this._iid),l=c.sdkState,h=c.logger;this._metadataKey=(o=l.userId,u=r.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/message/sync.meta"));var d=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(l.userId,r.url);this._prevSync=new vc(d,(function(t){return i(a,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return n={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:if(s.sent(),h.debug("message background prev sync from",null===(a=this._metadata)||void 0===a?void 0:a.range.top),this._metadata.previousComplete)return[3,9];s.label=2;case 2:return s.trys.push([2,5,,8]),[4,kn.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(u=null===(o=this._metadata.range)||void 0===o?void 0:o.top)&&void 0!==u?u:t,{prevResultSize:Ec,nextResultSize:0,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.MessageEventSource.SYNC_MESSAGE_BACKGROUND)];case 3:return r=s.sent(),this.extendRange(r),n.hasNext=r.length>=Ec,n.nextToken=this._metadata.range.top,this._metadata.previousComplete=!n.hasNext,h.debug("message background prev sync progress",n),[4,this.saveMetadata()];case 4:return s.sent(),[3,8];case 5:return i=s.sent(),h.debug("message background prev sync error",i),i instanceof f&&i.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:s.sent(),s.label=7;case 7:throw i;case 8:return[3,10];case 9:n.hasNext=!1,s.label=10;case 10:return[2,n]}}))}))})),this._nextSync=new vc(d,(function(t){return i(a,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return n={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:s.sent(),h.debug("message background next sync from",null===(a=this._metadata)||void 0===a?void 0:a.range.bottom),s.label=2;case 2:return s.trys.push([2,5,,6]),[4,kn.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(u=null===(o=this._metadata.range)||void 0===o?void 0:o.bottom)&&void 0!==u?u:t,{prevResultSize:0,nextResultSize:Ec,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.MessageEventSource.SYNC_MESSAGE_BACKGROUND)];case 3:return r=s.sent(),this.extendRange(r),n.hasNext=r.length>=Ec,n.nextToken=this._metadata.range.bottom,h.debug("message background next sync progress",n),[4,this.saveMetadata()];case 4:return s.sent(),[3,6];case 5:throw i=s.sent(),h.debug("message background next sync error",i),i;case 6:return[2,n]}}))}))}))}return t.of=function(e,n){if(yc[e]||(yc[e]={}),!yc[e][n.url]){var r=yc[e][n.url]=new t({_iid:e,channel:n});wt.of(e).dispatcher.on((function(e){if(e instanceof he)if(e.stateType===X.CONNECTED)r.resume();else r.pause()}))}return yc[e][n.url]},Object.defineProperty(t.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),t.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,u([],o(e.map((function(e){return e.createdAt}))),!1))},t.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,u([],o(e.map((function(e){return e.createdAt}))),!1))},t.prototype.loadMetadata=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,wt.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={range:new cc(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:Number.MAX_SAFE_INTEGER}),previousComplete:!!e&&e.previousComplete},t.label=2;case 2:return[2]}}))}))},t.prototype.saveMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._metadata?[4,wt.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.clearMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,wt.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},t.prototype.resume=function(){var e,t,n,r;wt.of(this._iid).logger.debug("message background sync resume()"),this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:Date.now())},t.prototype.pause=function(){wt.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},t}(),Cc={},Tc=function(){function t(t){var n=t._iid,r=t.channel,a=this;this._sync=null,this._metadata=null,this._iid=n,this._channel=r;var o,u,c=wt.of(this._iid),l=c.logger,h=c.sdkState;this._metadataKey=(o=h.userId,u=r.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/message/changelogs.meta"));var d=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(h.userId,this._channel.url);this._sync=new vc(d,(function(){return i(a,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:s.sent(),l.debug("message changelog sync from",null===(o=this._metadata)||void 0===o?void 0:o.token),s.label=2;case 2:return s.trys.push([2,5,,8]),[4,kn.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:e.ReplyType.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS)];case 3:return n=s.sent(),r=n.hasMore,i=n.token,t.hasNext=r,t.nextToken=i,this._metadata.token=i,l.debug("message changelog sync progress",t),[4,this.saveMetadata()];case 4:return s.sent(),[3,8];case 5:return a=s.sent(),l.debug("message changelog sync error",a),a instanceof f&&a.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:s.sent(),s.label=7;case 7:throw a;case 8:return[2,t]}}))}))}))}return t.of=function(e,n){if(Cc[e]||(Cc[e]={}),!Cc[e][n.url]){var r=Cc[e][n.url]=new t({_iid:e,channel:n});wt.of(e).dispatcher.on((function(e){if(e instanceof he)if(e.stateType===X.CONNECTED)r.resume();else r.pause()}))}return Cc[e][n.url]},t.prototype.loadMetadata=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return this._metadata?[3,2]:(e=wt.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=i.sent(),this._metadata={token:r?r.token:n/1e3},i.label=2;case 2:return[2]}}))}))},t.prototype.saveMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._metadata?[4,wt.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.clearMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,wt.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},t.prototype.resume=function(){wt.of(this._iid).logger.debug("message changelog sync resume()"),this._sync.start(0)},t.prototype.pause=function(){wt.of(this._iid).logger.debug("message changelog sync pause()"),this._sync.stop()},t}(),Ic=function(e){function t(t){var n,r,i,s,a,o,u=this;return(u=e.call(this)||this).method=d.GET,u.path="".concat(Je(t.channelType),"/").concat(t.channelUrl,"/messages_gap"),u.params=D({prev_start_ts:t.prevStart,prev_end_ts:t.prevEnd,prev_cache_count:t.prevCount,next_start_ts:t.nextStart,next_end_ts:t.nextEnd,next_cache_count:t.nextCount,huge_gap_threshold:null!==(n=t.threshold)&&void 0!==n?n:null,reverse:!0,custom_types:null!==(r=t.customTypes)&&void 0!==r?r:["*"],message_type:null!==(i=t.messageType)&&void 0!==i?i:null,include_reactions:null===(s=t.includeReactions)||void 0===s||s,with_sorted_meta_array:null===(a=t.includeMetaArray)||void 0===a||a,show_subchannel_messages_only:null!==(o=t.showSubchannelMessagesOnly)&&void 0!==o&&o,include_poll_details:!0}),u}return n(t,e),t}(x),Sc=function(e){function t(t,n){var r,i,s,a,o=this;return(o=e.call(this,t,n)||this).isHugeGap=n.is_huge_gap,o.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map((function(e){return sn(t,e)})),o.prevHasMore=null!==(i=n.prev_hasmore)&&void 0!==i&&i,o.nextMessages=(null!==(s=n.next_messages)&&void 0!==s?s:[]).map((function(e){return sn(t,e)})),o.nextHasmore=null!==(a=n.next_hasmore)&&void 0!==a&&a,o}return n(t,e),t}(F),Nc=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},wc=function(e,t,n){if(e.length>0){var r=Nc(e,t);if(r<0){for(var i=0,s=e.length-1,a=Math.floor((i+s)/2);i<s;){var o=Mc(e[a],t,n);if(o>0)s=a,a=Math.floor((i+s)/2);else{if(!(o<0))return{place:a,contains:e[a].isIdentical(t)};i=a+1,a=Math.floor((i+s)/2)}}return{place:Mc(e[a],t,n)>0?a:a+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},Mc=function(t,n,r){switch(r){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return t.lastMessage&&n.lastMessage?n.lastMessage.createdAt-t.lastMessage.createdAt:t.lastMessage?-1:n.lastMessage?1:n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHRONOLOGICAL:return n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return t.name.localeCompare(n.name)}},Ac=function(e,t){return t instanceof Bt?e.findIndex((function(e){return e instanceof Bt&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},Uc=function(e,t){return e.findIndex((function(e){return e.messageId===t}))},Oc=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,i=Math.floor((n+r)/2);n<r;){var s=e[i].createdAt-t.createdAt;if(s>0)r=i,i=Math.floor((n+r)/2);else{if(!(s<0))return i;n=i+1,i=Math.floor((n+r)/2)}}return e[i].createdAt>t.createdAt?i:i+1}return e.length},Rc={},Lc=function(){function e(e){var t=e._iid,n=e.channel,r=e.hasPollMessage,a=this;this._sync=null,this._metadata=null,this._iid=t,this._channel=n;var o,u,c=wt.of(this._iid),l=c.logger,h=c.sdkState;this._metadataKey=(o=h.userId,u=n.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/poll/changelogs.meta"));var d=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(h.userId,this._channel.url);this._sync=new vc(d,(function(){return i(a,void 0,void 0,(function(){var e,t,n,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return s.sent(),l.debug("poll changelog sync from",null===(u=this._metadata)||void 0===u?void 0:u.token),(t=!this._metadata||!this._metadata.token)?[4,r()]:[3,3];case 2:t=!s.sent(),s.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];s.label=4;case 4:return s.trys.push([4,7,,10]),[4,lr.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return n=s.sent(),i=n.hasMore,a=n.token,e.hasNext=i,e.nextToken=a,this._metadata.token=a,l.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return s.sent(),[3,10];case 7:return o=s.sent(),l.debug("poll changelog sync error",o),o instanceof f&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:s.sent(),s.label=9;case 9:throw o;case 10:return[2,e]}}))}))}))}return e.of=function(t,n,r){if(Rc[t]||(Rc[t]={}),!Rc[t][n.url]){var i=Rc[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r});wt.of(t).dispatcher.on((function(e){if(e instanceof he)if(e.stateType===X.CONNECTED)i.resume();else i.pause()}))}return Rc[t][n.url]},e.prototype.loadMetadata=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return this._metadata?[3,2]:(e=wt.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=i.sent(),this._metadata={token:r?r.token:n/1e3},i.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._metadata?[4,wt.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,wt.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},e.prototype.resume=function(){wt.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){wt.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e}(),kc=6e5;e.MessageCollectionInitPolicy=void 0,(e.MessageCollectionInitPolicy||(e.MessageCollectionInitPolicy={})).CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api";var Dc,Pc,xc,Fc=function(){function e(){}return e.prototype._invokeResponse=function(e,t,n){var r=this;De((function(){return i(r,void 0,void 0,(function(){return s(this,(function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),qc=function(){function t(t,n){var r=n.channel,c=n.filter,l=n.startingPoint,h=n.limit,d=this;this._channel=null,this._messages=[],this._unsentMessages=[],this._readReceiptMap=new Map,this._deliveryReceiptMap=new Map,this._iid=t,this._key="mc-".concat(U()),this.filter=null!=c?c:new Ar,this._channel=r,this._syncRange=new cc({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint=l||Date.now()+kc,this._limit=h||Sr;var p=hc.of(this._iid);p.subscribeGroupChannelEvent(this._key,{onUpdate:function(t,n){var r,o,u,c,l=Nc(t,d._channel);if(l>=0)switch(De((function(){return i(d,void 0,void 0,(function(){var e;return s(this,(function(r){return e=new mc(n),this._channel=t[l],this._handler.onChannelUpdated(e,this.channel),[2]}))}))})),n){case e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED:var h=!1;for(var p in d._messages){if((y=d._messages[p]).createdAt>=d._channel.messageOffsetTimestamp){h=!0;var f=parseInt(p);if(f>0){var _=d._messages.splice(0,f);d._removeMessagesFromView(_.map((function(e){return e.messageId})),e.MessageEventSource.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!h&&d._messages.length>0&&d._removeMessagesFromView(d._messages.map((function(e){return e.messageId})),e.MessageEventSource.EVENT_MESSAGE_OFFSET_UPDATED);break;case e.GroupChannelEventSource.EVENT_CHANNEL_READ:var v=[];try{for(var m=a(d._messages),g=m.next();!g.done;g=m.next()){var y=g.value;if((C=d._readReceiptMap.get(y.messageId))>0)C!==d._channel.getUnreadMemberCount(y)&&v.push(y)}}catch(e){r={error:e}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}v.length>0&&d._updateMessagesToView(v,e.MessageEventSource.EVENT_MESSAGE_READ);break;case e.GroupChannelEventSource.EVENT_CHANNEL_DELIVERED:v=[];try{for(var E=a(d._messages),b=E.next();!b.done;b=E.next()){var C;y=b.value;if((C=d._deliveryReceiptMap.get(y.messageId))>0)C!==d._channel.getUndeliveredMemberCount(y)&&v.push(y)}}catch(e){u={error:e}}finally{try{b&&!b.done&&(c=E.return)&&c.call(E)}finally{if(u)throw u.error}}v.length>0&&d._updateMessagesToView(v,e.MessageEventSource.EVENT_MESSAGE_READ)}},onRemove:function(e,t){e.indexOf(d.channel.url)>=0&&De((function(){return i(d,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new mc(t),this._handler.onChannelDeleted(e,this.channel.url),[2]}))}))}))}}),p.subscribeMessageEvent(this._key,{onUpdate:function(t,n){var r,i,s=[],o=[];try{for(var u=a(t),c=u.next();!c.done;c=u.next()){var l=c.value;l.channelUrl===d._channel.url&&(d.filter.match(l)?s.push(l):o.push(l.messageId))}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}if(gn(n)){if(s.length>0)switch(n){case e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED:case e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS:case e.MessageEventSource.EVENT_MESSAGE_UPDATED:case e.MessageEventSource.EVENT_MESSAGE_THREADINFO_UPDATED:case e.MessageEventSource.EVENT_MESSAGE_REACTION_UPDATED:case e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS:d._updateMessagesToView(s,n);break;case e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING:case e.MessageEventSource.EVENT_MESSAGE_RECEIVED:case e.MessageEventSource.SYNC_MESSAGE_FILL:d._addMessagesToView(s,n)}o.length>0&&d._removeMessagesFromView(o,n)}},onRemove:function(e,t){d._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){d._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){d._updatePollsToView(e,t)},onPollUpdate:function(e,t){d._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){d._applyPollVoteEventToView(e,t)}});var f=wt.of(this._iid).cacheContext;!this._channel.isSuper&&f.localCacheEnabled&&bc.of(this._iid,this._channel).resume(),Tc.of(this._iid,this._channel).resume(),Lc.of(this._iid,this._channel,this._hasPollMessage.bind(this)).resume(),this._prevFill=new vc(this._key,(function(t){return i(d,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:return[4,this._getRemoteMessages(t,{prevLimit:this._limit,source:e.MessageEventSource.SYNC_MESSAGE_FILL})];case 1:return(n=i.sent()).length>0?(r=Math.min.apply(Math,u([],o(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(r),[2,{hasNext:n.length>=this._limit&&this.viewTop<r,nextToken:this._syncRange.top}]):[2,{hasNext:!1,nextToken:0}]}}))}))})),this._nextFill=new vc(this._key,(function(t){return i(d,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:return[4,this._getRemoteMessages(t,{nextLimit:this._limit,source:e.MessageEventSource.SYNC_MESSAGE_FILL})];case 1:return(n=i.sent()).length>0?(r=Math.max.apply(Math,u([],o(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(r),[2,{hasNext:!(n.length>=this._limit&&this._hasNext)||this.viewBottom>r,nextToken:this._syncRange.bottom}]):[2,{hasNext:!1,nextToken:0}]}}))}))}));var _=wt.of(this._iid),v=_.dispatcher,m=_.logger;v.on((function(e){if(e instanceof he)if(e.stateType===X.CONNECTED)m.debug("check huge gap"),d._checkHugeGap();else d._prevFill.stop(),d._nextFill.stop()}))}return Object.defineProperty(t.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"succeededMessages",{get:function(){return u([],o(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewTop",{get:function(){return Math.min.apply(Math,u(u([],o(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,u(u([],o(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),t.prototype.setMessageCollectionHandler=function(e){this._handler=e},t.prototype._filterUnderOffsetMessage=function(e){return e},t.prototype._addMessagesToView=function(t,n){var r,c,l=this,h=this._filterUnderOffsetMessage(t),d=[],p=[];try{for(var f=a(h),_=f.next();!_.done;_=f.next()){var v=_.value;if(n===e.MessageEventSource.SYNC_MESSAGE_FILL){if(v.messageId>0){if((E=Ac(this._messages,v))<0){Ac(this._unsentMessages,v)<0&&d.push(v);var m=Oc(this._messages,v);this._messages.splice(m,0,v)}this._readReceiptMap.set(v.messageId,this._channel.getUnreadMemberCount(v)),this._deliveryReceiptMap.set(v.messageId,this._channel.getUndeliveredMemberCount(v))}else if(v instanceof Bt){(E=Ac(this._unsentMessages,v))<0&&Ac(this._messages,v)<0&&(this._unsentMessages.push(v),d.push(v))}}else if(v.messageId>0){if((E=Ac(this._messages,v))<0){var g=Ac(this._unsentMessages,v);g<0?d.push(v):(this._unsentMessages.splice(g,1),p.push(v));m=Oc(this._messages,v);this._messages.splice(m,0,v)}else p.push(v),this._messages[E]=v;if(this._readReceiptMap.set(v.messageId,this._channel.getUnreadMemberCount(v)),this._deliveryReceiptMap.set(v.messageId,this._channel.getUndeliveredMemberCount(v)),v.updatedAt>0){var y=this._updateChildMessagesInView(v);p.push.apply(p,u([],o(y),!1))}}else if(v instanceof Bt){var E;(E=Ac(this._unsentMessages,v))<0?Ac(this._messages,v)<0&&(this._unsentMessages.push(v),d.push(v)):(p.push(v),this._unsentMessages[E]=v)}}}catch(e){r={error:e}}finally{try{_&&!_.done&&(c=f.return)&&c.call(f)}finally{if(r)throw r.error}}gn(n)&&De((function(){return i(l,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new gc(n),d.length>0&&this._handler.onMessagesAdded(e,this.channel,d),p.length>0&&this._handler.onMessagesUpdated(e,this.channel,p),[2]}))}))}))},t.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach((function(n){n.applyParentMessage(e)&&t.push(n)})),t},t.prototype._updatePollsToView=function(e,t){var n,r,o=this,u=[];try{for(var c=a(e),l=c.next();!l.done;l=c.next()){var h=l.value,d=Uc(this._messages,h.messageId);if(d>=0){var p=this._messages[d];p&&p.applyPoll(h),u.push(p)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return u.length>0&&gn(t)&&De((function(){return i(o,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new gc(t),u.length>0&&this._handler.onMessagesUpdated(e,this.channel,u),[2]}))}))})),u},t.prototype._applyPollUpdateEventToView=function(e,t){var n=this,r=Uc(this._messages,e.messageId);if(r>=0){var a=this._messages[r];a&&a.isUserMessage()&&a.poll&&a.poll.applyPollUpdateEvent(e)&&gn(t)&&De((function(){return i(n,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new gc(t),this._handler.onMessagesUpdated(e,this.channel,[a]),[2]}))}))}))}},t.prototype._applyPollVoteEventToView=function(e,t){var n=this,r=Uc(this._messages,e.messageId);if(r>=0){var a=this._messages[r];a&&a.isUserMessage()&&a.poll&&a.poll.applyPollVoteEvent(e)&&gn(t)&&De((function(){return i(n,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new gc(t),this._handler.onMessagesUpdated(e,this.channel,[a]),[2]}))}))}))}},t.prototype._updateMessagesToView=function(e,t){var n,r,o=this,u=[];try{for(var c=a(e),l=c.next();!l.done;l=c.next()){var h,d=l.value;if(d.messageId>0)if((h=Ac(this._messages,d))>=0)u.push(d),this._messages[h]=d;else{var p=Ac(this._unsentMessages,d);if(p>=0){u.push(d),this._unsentMessages.splice(p,1);var f=Oc(this._messages,d);this._messages.splice(f,0,d)}}else if(d instanceof Bt)(h=Ac(this._unsentMessages,d))>=0&&(u.push(d),this._unsentMessages[h]=d)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return gn(t)&&De((function(){return i(o,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new gc(t),u.length>0&&this._handler.onMessagesUpdated(e,this.channel,u),[2]}))}))})),u},t.prototype._removeMessagesFromView=function(e,t){var n,r,o=this,u=[],c=function(e){var t=l._messages.findIndex((function(t){return t.messageId===e}));t>=0&&(u.push(l._messages[t].messageId),l._messages.splice(t,1))},l=this;try{for(var h=a(e),d=h.next();!d.done;d=h.next()){c(d.value)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return gn(t)&&u.length>0&&De((function(){return i(o,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new gc(t),u.length>0&&this._handler.onMessagesDeleted(e,this.channel,u),[2]}))}))})),u},t.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},t.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,a=t.nextLimit,c=void 0===a?0:a;return i(this,void 0,void 0,(function(){var t,n,i,a,l,h,d;return s(this,(function(s){switch(s.label){case 0:return t=hc.of(this._iid),r>0?[4,t.getMessagesFromCache(this._channel.url,e,"prev",this.filter,this._limit)]:[3,2];case 1:return i=s.sent(),[3,3];case 2:i=[],s.label=3;case 3:return n=i,c>0?[4,t.getMessagesFromCache(this._channel.url,e,"next",this.filter,this._limit)]:[3,5];case 4:return l=s.sent(),[3,6];case 5:l=[],s.label=6;case 6:if(a=l,n.length>0&&a.length)for(d in h=n.map((function(e){return e.messageId})),a)if(h.includes(a[d].messageId)){a.splice(parseInt(d),1);break}return[2,u(u([],o(n),!1),o(a),!1).sort((function(e,t){return t.createdAt-e.createdAt}))]}}))}))},t.prototype._getRemoteMessages=function(t,n){var a=n.prevLimit,o=void 0===a?0:a,u=n.nextLimit,c=void 0===u?0:u,l=n.source,h=void 0===l?e.MessageEventSource.REQUEST_MESSAGE:l,d=n.reverse,p=void 0!==d&&d;return i(this,void 0,void 0,(function(){var e,n;return s(this,(function(i){switch(i.label){case 0:return e=kn.of(this._iid),o>0||c>0?[4,e.getMessagesByTimestamp(this._channel.url,this._channel.channelType,t,r(r({},this.filter),{reverse:p,prevResultSize:o,nextResultSize:c,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),h)]:[3,2];case 1:return n=i.sent(),[3,3];case 2:n=[],i.label=3;case 3:return[2,n]}}))}))},t.prototype._checkHugeGap=function(){return i(this,void 0,void 0,(function(){var t,n,a,c,l,h,d,p,f,_,v=this;return s(this,(function(m){switch(m.label){case 0:return this._messages.length>0?(t=this.viewTop,n=this._syncRange.top,a=this._syncRange.bottom,c=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,(l=hc.of(this._iid)).getCachedMessageCountBetween(this._channel.url,this.filter,t,n)]):[3,4];case 1:return h=m.sent(),[4,l.getCachedMessageCountBetween(this._channel.url,this.filter,a,c)];case 2:return d=m.sent(),[4,ke((function(){return i(v,void 0,void 0,(function(){var l,p,f,_,v,m,g,y,E,b,C,T,I,S,N,w,M,A=this;return s(this,(function(U){switch(U.label){case 0:return l=wt.of(this._iid),p=l.dispatcher,f=l.requestQueue,_=new Ic(r({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:t,prevEnd:n,prevCount:h,nextStart:a,nextEnd:c,nextCount:d},this.filter)),[4,f.send(_)];case 1:return v=U.sent(),m=v.as(Sc),g=m.isHugeGap,y=m.prevMessages,E=void 0===y?[]:y,b=m.prevHasMore,C=m.nextMessages,T=void 0===C?[]:C,I=m.nextHasmore,g?De((function(){return i(A,void 0,void 0,(function(){return s(this,(function(e){return this._handler.onHugeGapDetected(),[2]}))}))})):(this._hasPrevious=b,this._hasNext=I,S=this.viewTop,N=this.viewBottom,w=Math.min.apply(Math,u([Number.MAX_SAFE_INTEGER],o(E.map((function(e){return e.createdAt}))),!1)),M=Math.max.apply(Math,u([0],o(T.map((function(e){return e.createdAt}))),!1)),p.dispatch(new yn({messages:E,source:e.MessageEventSource.SYNC_MESSAGE_FILL})),p.dispatch(new yn({messages:T,source:e.MessageEventSource.SYNC_MESSAGE_FILL})),this._syncRange.extends(w,M),S<w&&this._prevFill.start(w),N>M&&this._nextFill.start(M)),[2]}}))}))}),1)];case 3:return m.sent(),[3,6];case 4:return p=Math.floor(this._limit/2),[4,this._getRemoteMessages(Date.now(),{prevLimit:p,nextLimit:p,source:e.MessageEventSource.SYNC_MESSAGE_FILL})];case 5:(f=m.sent()).length>0&&((_=this._syncRange).extends.apply(_,u([],o(f.map((function(e){return e.createdAt}))),!1)),f.length<p&&(this._hasPrevious=!1,this._hasNext=!1)),m.label=6;case 6:return[2]}}))}))},t.prototype._loadAllFailedMessages=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,hc.of(this._iid).getAllFailedMessagesFromCache(this._channel.url,this.filter)];case 1:return e=t.sent(),this._unsentMessages=e,[2,e]}}))}))},t.prototype._hasPollMessage=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,hc.of(this._iid).getPollMessagesFromCache(this._channel.url,Date.now()+kc,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}}))}))},t.prototype.initialize=function(t){var n=this,r=new Fc;this._messages=[],this._unsentMessages=[],this._syncRange=new cc({}),this._hasNext=!0,this._hasPrevious=!0;var i=Math.floor(this._limit/2);if(t===e.MessageCollectionInitPolicy.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:i,nextLimit:i}).then((function(t){var i=n._filterUnderOffsetMessage(t);n._addMessagesToView(i,e.MessageEventSource.REQUEST_MESSAGE),r._invokeResponse("local",null,i)})).catch((function(e){if(p(e))throw e;r._invokeResponse("local",e,null)})).finally((function(){n._loadAllFailedMessages(),n._getRemoteMessages(n._startingPoint,{prevLimit:i,nextLimit:i,reverse:!0}).then((function(t){var s;n._messages=[];var a=n._filterUnderOffsetMessage(t);a.length<i&&(n._hasPrevious=!1,n._hasNext=!1),a.length>0&&((s=n._syncRange).extends.apply(s,u([],o(a.map((function(e){return e.createdAt}))),!1)),n._addMessagesToView(a,e.MessageEventSource.REQUEST_MESSAGE)),r._invokeResponse("remote",null,a)})).catch((function(e){if(p(e))throw e;r._invokeResponse("remote",e,null)}))}));return r},t.prototype.loadPrevious=function(){return i(this,void 0,void 0,(function(){var t,n,r,a,c=this;return s(this,(function(l){switch(l.label){case 0:return this._hasPrevious?(t=this.viewTop,n=[],[4,Pe((function(){return i(c,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getLocalMessages(t,{prevLimit:this._limit})];case 1:return n=e.apply(this,[r.sent()]),[2]}}))}))}))]):[3,5];case 1:return l.sent(),r=bc.of(this._iid,this._channel),0!==n.length&&r.isWrappingMessages(n)?[3,3]:[4,Pe((function(){return i(c,void 0,void 0,(function(){var e,i;return s(this,(function(s){switch(s.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(t,{prevLimit:this._limit})];case 1:return n=e.apply(this,[s.sent()]),this._hasPrevious=n.length>=this._limit,n.length>0&&((i=this._syncRange).extends.apply(i,u([],o(n.map((function(e){return e.createdAt}))),!1)),r.range.overlap(this._syncRange)&&r.range.extends(this._syncRange.top)),[2]}}))}))}))];case 2:return l.sent(),this._addMessagesToView(n,e.MessageEventSource.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=n.length>=this._limit,n.length>0&&((a=this._syncRange).extends.apply(a,u([],o(n.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(n,e.MessageEventSource.REQUEST_MESSAGE)),l.label=4;case 4:return[2,n];case 5:return[2,[]]}}))}))},t.prototype.loadNext=function(){return i(this,void 0,void 0,(function(){var t,n,r,a,c=this;return s(this,(function(l){switch(l.label){case 0:return t=this.viewBottom,n=[],[4,Pe((function(){return i(c,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getLocalMessages(t,{nextLimit:this._limit})];case 1:return n=e.apply(this,[r.sent()]),[2]}}))}))}))];case 1:return l.sent(),r=bc.of(this._iid,this._channel),0!==n.length&&r.isWrappingMessages(n)?[3,3]:[4,Pe((function(){return i(c,void 0,void 0,(function(){var e,i;return s(this,(function(s){switch(s.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(t,{nextLimit:this._limit})];case 1:return n=e.apply(this,[s.sent()]),this._hasNext=n.length>=this._limit,n.length>0&&((i=this._syncRange).extends.apply(i,u([],o(n.map((function(e){return e.createdAt}))),!1)),r.range.overlap(this._syncRange)&&r.range.extends(this._syncRange.bottom)),[2]}}))}))}))];case 2:return l.sent(),this._addMessagesToView(n,e.MessageEventSource.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=n.length>=this._limit,n.length>0&&((a=this._syncRange).extends.apply(a,u([],o(n.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(n,e.MessageEventSource.REQUEST_MESSAGE)),l.label=4;case 4:return[2,n]}}))}))},t.prototype.removeFailedMessage=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,hc.of(this._iid).removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},t.prototype.dispose=function(){wt.of(this._iid).cacheContext.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop(),bc.of(this._iid,this._channel).pause()),Tc.of(this._iid,this._channel).pause(),Lc.of(this._iid,this._channel,this._hasPollMessage.bind(this)).pause();var e=hc.of(this._iid);e.unsubscribeGroupChannelEvent(this._key),e.unsubscribeMessageEvent(this._key)},t}(),Gc={coverUrl:null,coverImage:null,isDistinct:null,isPublic:null,isDiscoverable:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},Hc={hidePreviousMessages:!1,allowAutoUnhide:!0},Vc=function(e){function t(t){var n=this,r=t.channelUrl,i=t.token,s=t.limit,a=t.order,o=t.mutedMemberFilter,u=t.memberStateFilter,c=t.nicknameStartsWithFilter,l=t.operatorFilter;return(n=e.call(this)||this).method=d.GET,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/members"),n.params={token:i,limit:s,order:a,muted_member_filter:o,member_state_filter:u,nickname_startswith:c,operator_filter:l,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return n(t,e),t}(x),Kc=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.members=[];var i=n.next,s=n.members;return r.token=i,s&&s.length>0&&(r.members=s.map((function(e){return new Ho(t,e)}))),r}return n(t,e),t}(F);e.MutedMemberFilter=void 0,(Dc=e.MutedMemberFilter||(e.MutedMemberFilter={})).ALL="all",Dc.MUTED="muted",Dc.UNMUTED="unmuted",e.MemberListOrder=void 0,(Pc=e.MemberListOrder||(e.MemberListOrder={})).MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",Pc.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical",e.MemberStateFilter=void 0,(xc=e.MemberStateFilter||(e.MemberStateFilter={})).ALL="all",xc.JOINED="joined_only",xc.INVITED="invited_only",xc.INVITED_BY_FRIEND="invited_by_friend",xc.INVITED_BY_NON_FRIEND="invited_by_non_friend";var Qc=function(t){function a(n,r,i){var s,a,o,u,c=this;return(c=t.call(this,n,r,e.ChannelType.GROUP,i)||this).mutedMemberFilter=e.MutedMemberFilter.ALL,c.memberStateFilter=e.MemberStateFilter.ALL,c.nicknameStartsWithFilter=null,c.operatorFilter=e.OperatorFilter.ALL,c.order=e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,c.mutedMemberFilter=null!==(s=i.mutedMemberFilter)&&void 0!==s?s:e.MutedMemberFilter.ALL,c.memberStateFilter=null!==(a=i.memberStateFilter)&&void 0!==a?a:e.MemberStateFilter.ALL,c.nicknameStartsWithFilter=null!==(o=i.nicknameStartsWithFilter)&&void 0!==o?o:null,c.order=null!==(u=i.order)&&void 0!==u?u:e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,c}return n(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&y(e.MutedMemberFilter,this.mutedMemberFilter)&&y(e.MemberStateFilter,this.memberStateFilter)&&(g("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&y(e.OperatorFilter,this.operatorFilter)&&y(e.MemberListOrder,this.order)},a.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new Vc(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(Kc),a=i.members,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},a}(Bn),Bc=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,s=t.accessCode;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:i,access_code:s},n}return n(t,e),t}(x),jc=function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.channel=new wl(n,r),i.channel.myMemberState=e.MemberState.JOINED,i}return n(r,t),r}(F),zc=function(e){function t(t){var n=this,r=t.channelUrl,i=t.isDistinct,s=t.isPublic,a=t.isDiscoverable,o=t.coverUrl,u=t.coverImage,c=t.accessCode,l=t.name,h=t.data,p=t.customType,f=t.operatorUserIds,_=t.messageSurvivalSeconds;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ve,"/").concat(encodeURIComponent(r)),n.params=D({is_distinct:i,is_public:s,is_discoverable:a,name:l,data:h,custom_type:p,cover_url:o,cover_file:u,access_code:c,operator_ids:f,message_survival_seconds:_}),n}return n(t,e),t}(x),Wc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new wl(t,n),r}return n(t,e),t}(F),Yc=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(ve,"/").concat(encodeURIComponent(r)),n}return n(t,e),t}(x);!function(e){function t(t,n){return e.call(this,t,n)||this}n(t,e)}(F);var Jc=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/hide"),n}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Xc=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=t.countPreference,s=e.call(this)||this;return s.method=d.PUT,s.path="".concat(fe,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),s.params={count_preference:i},s}return n(t,e),t}(x),Zc=function(t){function r(n,r){var i=t.call(this,n,r)||this;return i.countPreference=e.CountPreference[r.count_preference],i}return n(r,t),r}(F),$c=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ve,"/").concat(encodeURIComponent(r),"/reset_user_history"),n}return n(t,e),t}(x),el=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var i=n.ts_message_offset;return r.messageOffsetTimestamp=null!=i?i:null,r}return n(t,e),t}(F),tl=r(r({},_a),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),nl=r(r({},ma),{scheduledAt:null}),rl=function(t){function r(n){var r,i=this;i=t.call(this)||this;var s=[];n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?s=n.mentionedUserIds:n.mentionedUsers&&(s=n.mentionedUsers.map((function(e){return e.userId}))));var a=n.channelType,o=n.channelUrl,u=n.scheduledMessageId;return i.method=d.PUT,i.path="".concat(Je(a),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(u)),i.params={req_id:n.reqId,scheduled_at:n.scheduledAt,message_type:ae.FILE,url:n.fileUrl,file_name:n.fileName,file_size:n.fileSize,file_type:n.mimeType,thumbnails:n.thumbnailSizes?n.thumbnailSizes.map((function(e){return jt.payloadify(e)})):[],custom_type:n.customType,data:n.data,require_auth:n.requireAuth,mention_type:n.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=n.metaArrays)||void 0===r?void 0:r.map((function(e){return xt.payloadify(e)})),apple_critical_alert_options:Gt.payloadify(n.appleCriticalAlertOptions),push_option:n.pushNotificationDeliveryOption},i}return n(r,t),r}(x),il=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new an(t,n),r}return n(t,e),t}(F),sl=function(t){function r(n){var r,i=this;i=t.call(this)||this;var s=[];n.mentionType===e.MentionType.USERS&&(n.mentionedUserIds?s=n.mentionedUserIds:n.mentionedUsers&&(s=n.mentionedUsers.map((function(e){return e.userId}))));var a=n.channelType,o=n.channelUrl,u=n.scheduledMessageId;return i.method=d.PUT,i.path="".concat(Je(a),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(u)),i.params={req_id:n.reqId,scheduled_at:n.scheduledAt,message_type:ae.USER,message:n.message,custom_type:n.customType,data:n.data,mention_type:n.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=n.metaArrays)||void 0===r?void 0:r.map((function(e){return xt.payloadify(e)})),apple_critical_alert_options:Gt.payloadify(n.appleCriticalAlertOptions),target_langs:n.translationTargetLanguages,push_option:n.pushNotificationDeliveryOption},i}return n(r,t),r}(x);!function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new nn(t,n),r}n(t,e)}(F);var al=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,i=t.channelUrl,s=t.scheduledMessageId;return n.method=d.DELETE,n.path="".concat(Je(r),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(s)),n}return n(t,e),t}(x),ol=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,i=t.channelUrl,s=t.scheduledMessageId;return n.method=d.POST,n.path="".concat(Je(r),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(s),"/send_now"),n}return n(t,e),t}(x),ul=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=t.pushTriggerOption,s=e.call(this)||this;return s.method=d.PUT,s.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),s.params={push_trigger_option:i},s}return n(t,e),t}(x),cl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return n(t,e),t}(F),ll=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=e.call(this)||this;return i.method=d.GET,i.path="".concat(fe,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),i}return n(t,e),t}(x),hl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return n(t,e),t}(F),dl=function(e){function t(t){var n=t.pollId,r=t.title,i=t.data,s=t.allowUserSuggestion,a=t.allowMultipleVotes,o=t.closeAt,u=e.call(this)||this;return u.method=d.PUT,u.path="".concat(Ie,"/").concat(encodeURIComponent(n)),u.params={title:r,data:i,allow_user_suggestion:s,allow_multiple_votes:a,close_at:o},u}return n(t,e),t}(x),pl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new tn(t,n),r}return n(t,e),t}(F),fl=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=d.DELETE,r.path="".concat(Ie,"/").concat(encodeURIComponent(n)),r}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var _l=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=d.PUT,r.path="".concat(Ie,"/").concat(encodeURIComponent(n),"/close"),r}return n(t,e),t}(x),vl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new tn(t,n),r}return n(t,e),t}(F),ml=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,s=t.optionText,a=e.call(this)||this;return a.method=d.POST,a.path="".concat(Ie,"/").concat(encodeURIComponent(i),"/options"),a.params={channel_url:n,channel_type:r,text:s},a}return n(t,e),t}(x),gl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new tn(t,n),r}return n(t,e),t}(F),yl=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,i=t.optionText,s=e.call(this)||this;return s.method=d.PUT,s.path="".concat(Ie,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),s.params={text:i},s}return n(t,e),t}(x),El=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new tn(t,n),r}return n(t,e),t}(F),bl=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(Ie,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),i}return n(t,e),t}(x);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e)}(F);var Cl,Tl,Il,Sl=function(t){function r(n){var r=n.reqId,i=n.channelType,s=n.channelUrl,a=n.pollId,o=n.pollOptionIds;return t.call(this,{code:"VOTE",ackRequired:!0,payload:D({req_id:r,channel_type:i===e.ChannelType.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:a,option_ids:o})})||this}return n(r,t),r}(z);e.CountPreference=void 0,(Cl=e.CountPreference||(e.CountPreference={})).ALL="all",Cl.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",Cl.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",Cl.OFF="off",e.MutedState=void 0,(Tl=e.MutedState||(e.MutedState={})).MUTED="muted",Tl.UNMUTED="unmuted",e.HiddenState=void 0,(Il=e.HiddenState||(e.HiddenState={})).UNHIDDEN="unhidden",Il.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",Il.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide";var Nl,wl=function(t){function c(n,i){var s,a,c,l,h,d,p,f,_,v,m,E,b,C,T,I,S,N,w=this;return(w=t.call(this,n,i)||this)._unreadMemberStateMap=new Map,w._undeliveredMemberStateMap=new Map,w._typingStatus=new Map,w._lastMemberCountUpdated=0,w._typingStarted=0,w._typingEnded=0,w.isDistinct=!1,w.isSuper=!1,w.isBroadcast=!1,w.isExclusive=!1,w.isPublic=!1,w.isDiscoverable=!0,w.isAccessCodeRequired=!1,w.isPushEnabled=!1,w.unreadMessageCount=0,w.unreadMentionCount=0,w.members=[],w.memberCount=0,w.joinedMemberCount=0,w.hiddenState=e.HiddenState.UNHIDDEN,w.lastMessage=null,w.messageOffsetTimestamp=0,w.messageSurvivalSeconds=-1,w.myMemberState=e.MemberState.NONE,w.myRole=e.Role.NONE,w.myMutedState=e.MutedState.UNMUTED,w.myLastRead=0,w.myCountPreference=e.CountPreference.ALL,w.myPushTriggerOption=e.PushTriggerOption.DEFAULT,w.inviter=null,w.invitedAt=0,w.joinedAt=0,w.channelType=e.ChannelType.GROUP,w.isDistinct=null!==(a=i.is_distinct)&&void 0!==a&&a,w.isSuper=null!==(c=i.is_super)&&void 0!==c&&c,w.isBroadcast=null!==(l=i.is_broadcast)&&void 0!==l&&l,w.isExclusive=null!==(h=i.is_exclusive)&&void 0!==h&&h,w.isPublic=null!==(d=i.is_public)&&void 0!==d&&d,w.isDiscoverable=null!==(p=i.is_discoverable)&&void 0!==p?p:w.isPublic,w.isAccessCodeRequired=null!==(f=i.is_access_code_required)&&void 0!==f&&f,w.isPushEnabled=null!==(_=i.is_push_enabled)&&void 0!==_&&_,Array.isArray(i.members)&&(s=w.members).push.apply(s,u([],o(i.members.map((function(e){return new Ho(w._iid,e)}))),!1)),w.memberCount=null!==(v=i.member_count)&&void 0!==v?v:0,w.joinedMemberCount=null!==(m=i.joined_member_count)&&void 0!==m?m:0,w.hiddenState=y(e.HiddenState,i.hidden_state)?i.hidden_state:e.HiddenState.UNHIDDEN,w.messageOffsetTimestamp=null!==(E=i.ts_message_offset)&&void 0!==E?E:0,w.messageSurvivalSeconds=null!==(b=i.message_survival_seconds)&&void 0!==b?b:-1,w.lastMessage=i.last_message?sn(w._iid,r({channel_type:w.channelType},i.last_message)):null,i.read_receipt&&Object.keys(i.read_receipt).forEach((function(e){g("number",i.read_receipt[e])&&w._updateUnreadMemberState(e,i.read_receipt[e])})),i.delivery_receipt&&Object.keys(i.delivery_receipt).forEach((function(e){g("number",i.delivery_receipt[e])&&w._updateUndeliveredMemberState(e,i.delivery_receipt[e])})),w.myMemberState=y(e.MemberState,i.member_state)?i.member_state:e.MemberState.NONE,w.myRole=y(e.Role,i.my_role)?i.my_role:e.Role.NONE,y(e.MutedState,i.is_muted)?w.myMutedState=i.is_muted:g("boolean",i.is_muted)?w.myMutedState=i.is_muted?e.MutedState.MUTED:e.MutedState.UNMUTED:w.myMutedState=e.MutedState.UNMUTED,w.myCountPreference=y(e.CountPreference,i.count_preference)?i.count_preference:e.CountPreference.ALL,w.myPushTriggerOption=y(e.PushTriggerOption,i.push_trigger_option)?i.push_trigger_option:e.PushTriggerOption.ALL,w.myLastRead=null!==(C=i.user_last_read)&&void 0!==C?C:0,w.inviter=i.inviter?new ht(w._iid,i.inviter):null,w.invitedAt=null!==(T=i.invited_at)&&void 0!==T?T:0,w.joinedAt=null!==(I=i.joined_ts)&&void 0!==I?I:0,w._updateUnreadCount(null!==(S=i.unread_message_count)&&void 0!==S?S:0,null!==(N=i.unread_mention_count)&&void 0!==N?N:0),w}return n(c,t),Object.defineProperty(c.prototype,"isHidden",{get:function(){return this.hiddenState!==e.HiddenState.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isTyping",{get:function(){return Object.keys(this._typingStatus).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=a(this._unreadMemberStateMap),i=r.next();!i.done;i=r.next()){var s=o(i.value,2),u=s[0],c=s[1];n[u]=c}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=a(this._undeliveredMemberStateMap),i=r.next();!i.done;i=r.next()){var s=o(i.value,2),u=s[0],c=s[1];n[u]=c}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),c.payloadify=function(e){return e?D(r(r({},t.payloadify.call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return Ho.payloadify(e)})),last_message:rn(e.lastMessage),inviter:e.inviter?ht.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt})):null},c.prototype._shouldUpdateLastMessageWith=function(e){return!(e instanceof Bt&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)},c.prototype._updateUnreadCount=function(t,n){if("number"==typeof t&&t>=0)if(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var r=wt.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=r&&t>=r?r:t}else this.unreadMessageCount=t;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof n&&n>=0&&(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=n:this.unreadMentionCount=0},c.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),wt.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},c.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);(!n||n<t)&&this._undeliveredMemberStateMap.set(e,t)},c.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus[e.userId]={user:e,ts:t}:delete this._typingStatus[e.userId]},c.prototype._invalidateTypingStatus=function(){var e=(new Date).getTime(),t=!1;for(var n in this._typingStatus){e-this._typingStatus[n].ts>=1e4&&(delete this._typingStatus[n],t=!0)}return t},c.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},c.prototype.isReadMessage=function(e){var t=wt.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt},c.prototype.serialize=function(){var e=this;return ot(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))},c.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new qc(this._iid,r({channel:this},e))},c.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new Qc(this._iid,this.url,e)},c.prototype.addMember=function(t,n){if(void 0===n&&(n=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=this.members.findIndex((function(e){return e.userId===t.userId}));if(r>-1){var i=this.members[r];i.state===e.MemberState.JOINED&&(t.state=i.state),this.members.splice(r,1),this.memberCount--}this.members.push(t),this.memberCount++,this._updateUnreadMemberState(t.userId,n),this._updateUndeliveredMemberState(t.userId,n)}},c.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=this.members.findIndex((function(t){return t.userId===e.userId}));if(t>-1)return this.members.splice(t,1),this.memberCount--,!0}return!1},c.prototype.getUnreadMemberCount=function(t){var n,r;if(t instanceof Bt&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var i=wt.of(this._iid).sdkState,s=t.createdAt,o=0;try{for(var u=a(this.members),c=u.next();!c.done;c=u.next()){var l=c.value;if(i.userId!==l.userId&&l.state===e.MemberState.JOINED&&t.sender.userId!==l.userId)(this.cachedUnreadMemberState[l.userId]||0)<s&&o++}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return o}return 0},c.prototype.getUndeliveredMemberCount=function(t){var n,r;if(t instanceof Bt&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var i=wt.of(this._iid).sdkState,s=t.createdAt,o=0;try{for(var u=a(this.members),c=u.next();!c.done;c=u.next()){var l=c.value;if(i.userId!==l.userId&&l.state===e.MemberState.JOINED&&t.sender.userId!==l.userId)(this.cachedUndeliveredMemberState[l.userId]||0)<s&&o++}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return o}return 0},c.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=wt.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=[];return this.members.forEach((function(s){(t||s.userId!==r.userId&&s.userId!==e.sender.userId)&&(n._unreadMemberStateMap.get(s.userId)>=e.createdAt&&i.push(s))})),i},c.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=wt.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=[];return this.members.forEach((function(s){(t||s.userId!==r.userId&&s.userId!==e.sender.userId)&&(n._unreadMemberStateMap.get(s.userId)<e.createdAt&&i.push(s))})),i},c.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=wt.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(i){if(e||i.userId!==n.userId){var s=t._unreadMemberStateMap.get(i.userId);r[i.userId]=new Vo(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Ho.payloadify(i),ts:s})}})),r},c.prototype.getTypingUsers=function(){var e=[];for(var t in this._typingStatus){var n=this._typingStatus[t].user;e.push(n)}return e},c.prototype.invalidateTypingStatus=function(){var e=wt.of(this._iid).typingIndicatorInvalidateTime,t=(new Date).getTime(),n=!1;for(var r in this._typingStatus){t-this._typingStatus[r].ts>=e&&(delete this._typingStatus[r],n=!0)}return n},c.prototype.refresh=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid),n=t.requestQueue,r=t.dispatcher,i=new hu({channelUrl:this.url}),[4,n.send(i)];case 1:return a=s.sent(),o=a.as(du).channel,r.dispatch(new su({channels:[o],source:e.GroupChannelEventSource.REQUEST_CHANNEL})),[2,o]}}))}))},c.prototype.freeze=function(){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t.prototype.freeze.call(this)];case 1:return n.sent(),wt.of(this._iid).dispatcher.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN})),[2]}}))}))},c.prototype.unfreeze=function(){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t.prototype.unfreeze.call(this)];case 1:return n.sent(),wt.of(this._iid).dispatcher.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN})),[2]}}))}))},c.prototype.updateChannel=function(t){return i(this,void 0,void 0,(function(){var n,i,a,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},Gc),t),ct(function(e){return g("string",e.coverUrl,!0)&&(T(e.coverImage)||g("string",e.coverImage)||null===e.coverImage)&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isDiscoverable,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&b("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)}(n)).throw(f.invalidParameters),i=wt.of(this._iid),a=i.dispatcher,o=i.requestQueue,u=new zc(r({channelUrl:this.url},n)),[4,o.send(u)];case 1:return c=s.sent(),l=c.as(Wc).channel,a.dispatch(new su({channels:[l],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),[2,l]}}))}))},c.prototype.invite=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return ct(e.every((function(e){return e instanceof ht}))).throw(f.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},c.prototype.inviteWithUserIds=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(b("string",t)).throw(f.invalidParameters),n=wt.of(this._iid),r=n.dispatcher,i=n.requestQueue,a=new Du({channelUrl:this.url,userIds:t}),[4,i.send(a)];case 1:return o=s.sent(),u=o.as(Pu).channel,r.dispatch(new su({channels:[u],source:e.GroupChannelEventSource.EVENT_CHANNEL_INVITED})),[2,u]}}))}))},c.prototype.join=function(t){return void 0===t&&(t=null),i(this,void 0,void 0,(function(){var n,r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",t)||null===t).throw(f.invalidParameters),n=wt.of(this._iid),r=n.dispatcher,i=n.sdkState,a=n.requestQueue,o=new Uu({channelUrl:this.url,userId:i.userId,accessCode:t}),[4,a.send(o)];case 1:return u=s.sent(),(c=u.as(Ou).channel).myMemberState=e.MemberState.JOINED,r.dispatch(new su({channels:[c],source:e.GroupChannelEventSource.EVENT_CHANNEL_JOINED})),[2,this]}}))}))},c.prototype.leave=function(e){return void 0===e&&(e=!1),i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Lu({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},c.prototype.acceptInvitation=function(t){return void 0===t&&(t=null),i(this,void 0,void 0,(function(){var n,r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",t)||null===t).throw(f.invalidParameters),n=wt.of(this._iid),r=n.dispatcher,i=n.sdkState,a=n.requestQueue,o=new Bc({channelUrl:this.url,userId:i.userId,accessCode:t}),[4,a.send(o)];case 1:return u=s.sent(),(c=u.as(jc).channel).myMemberState=e.MemberState.JOINED,r.dispatch(new su({channels:[c],source:e.GroupChannelEventSource.EVENT_CHANNEL_ACCEPTED_INVITE})),[2,c]}}))}))},c.prototype.declineInvitation=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Fu({channelUrl:this.url,userId:n.userId}),[4,r.send(i)];case 1:return a=s.sent(),(o=a.as(qu).channel).myMemberState=e.MemberState.NONE,[2,o]}}))}))},c.prototype.sendUserMessage=function(n){var r=this,i=new Dn,s=wt.of(this._iid).dispatcher,a=ei.of(this._iid);return t.prototype.sendUserMessage.call(this,n).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),i._trigger(null,e)})).onFailed((function(e,t){t&&a.completeCurrentAndProcessNextAutoResend(t),i._trigger(e,t)})).onSucceeded((function(t){var n=hc.of(r._iid);a.completeCurrentAndProcessNextAutoResend(t),r._shouldUpdateLastMessageWith(t)&&(r.lastMessage=t),n.handlers.map((function(e){return e.onChannelChanged(r)})),s.dispatch(new su({channels:[r],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),i._trigger(null,t)})),i},c.prototype.updateUserMessage=function(n,r){return i(this,void 0,void 0,(function(){var i,a,o,u=this;return s(this,(function(s){switch(s.label){case 0:return i=wt.of(this._iid).dispatcher,[4,t.prototype.updateUserMessage.call(this,n,r)];case 1:return a=s.sent(),o=!1,!a.silent&&this._shouldUpdateLastMessageWith(a)&&(this.lastMessage=a,o=!0),o&&(hc.of(this._iid).handlers.map((function(e){return e.onChannelChanged(u)})),i.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED}))),i.dispatch(new yn({messages:[a],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),[2,a]}}))}))},c.prototype._autoResendUserMessage=function(n){var r=this,i=new Dn,s=wt.of(this._iid).dispatcher,a=ei.of(this._iid);return t.prototype._autoResendUserMessage.call(this,n).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),i._trigger(null,e)})).onFailed((function(e,t){a.completeCurrentAndProcessNextAutoResend(t),i._trigger(e,t)})).onSucceeded((function(t){var n=hc.of(r._iid);a.completeCurrentAndProcessNextAutoResend(t),r._shouldUpdateLastMessageWith(t)&&(r.lastMessage=t),n.handlers.map((function(e){return e.onChannelChanged(r)})),s.dispatch(new su({channels:[r],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),i._trigger(null,t)})),i},c.prototype.sendFileMessage=function(n){var r=this,i=new Dn,s=wt.of(this._iid).dispatcher,a=ei.of(this._iid);return t.prototype.sendFileMessage.call(this,n).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),i._trigger(null,e)})).onFailed((function(e,t){t&&a.completeCurrentAndProcessNextAutoResend(t),i._trigger(e,t)})).onSucceeded((function(t){var n=hc.of(r._iid);a.completeCurrentAndProcessNextAutoResend(t),r._shouldUpdateLastMessageWith(t)&&(r.lastMessage=t),n.handlers.map((function(e){return e.onChannelChanged(r)})),s.dispatch(new su({channels:[r],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),i._trigger(null,t)})),i},c.prototype.updateFileMessage=function(n,r){return i(this,void 0,void 0,(function(){var i,a,o,u=this;return s(this,(function(s){switch(s.label){case 0:return i=wt.of(this._iid).dispatcher,[4,t.prototype.updateFileMessage.call(this,n,r)];case 1:return a=s.sent(),o=!1,!a.silent&&this._shouldUpdateLastMessageWith(a)&&(this.lastMessage=a,o=!0),o&&(hc.of(this._iid).handlers.map((function(e){return e.onChannelChanged(u)})),i.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED}))),i.dispatch(new yn({messages:[a],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),[2,a]}}))}))},c.prototype._autoResendFileMessage=function(n){var r=this,i=new Dn,s=wt.of(this._iid).dispatcher,a=ei.of(this._iid);return t.prototype._autoResendFileMessage.call(this,n).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),i._trigger(null,e)})).onFailed((function(e,t){a.completeCurrentAndProcessNextAutoResend(t),i._trigger(e,t)})).onSucceeded((function(t){var n=hc.of(r._iid);a.completeCurrentAndProcessNextAutoResend(t),r._shouldUpdateLastMessageWith(t)&&(r.lastMessage=t),n.handlers.map((function(e){return e.onChannelChanged(r)})),s.dispatch(new su({channels:[r],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),i._trigger(null,t)})),i},c.prototype.deleteMessage=function(n){return i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,t.prototype.deleteMessage.call(this,n)];case 1:return r.sent(),0===n.messageId&&wt.of(this._iid).dispatcher.dispatch(new bn({reqId:n.reqId,source:e.MessageEventSource.EVENT_MESSAGE_DELETED})),[2]}}))}))},c.prototype.hide=function(t){return i(this,void 0,void 0,(function(){var n,i,a,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},Hc),t),ct(function(e){return g("boolean",e.hidePreviousMessages)&&g("boolean",e.allowAutoUnhide)}(n)).throw(f.invalidParameters),i=wt.of(this._iid),a=i.dispatcher,o=i.sdkState,u=i.requestQueue,c=new ju(r({channelUrl:this.url,userId:o.userId},n)),[4,u.send(c)];case 1:return l=s.sent(),h=l.as(zu).messageOffsetTimestamp,this.hiddenState=n.allowAutoUnhide?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,n.hidePreviousMessages&&this._updateUnreadCount(0,0),h&&(this.messageOffsetTimestamp=h),a.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN})),[2,this]}}))}))},c.prototype.unhide=function(){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid),n=t.dispatcher,r=t.requestQueue,i=new Jc({channelUrl:this.url}),[4,r.send(i)];case 1:return s.sent(),this.hiddenState=e.HiddenState.UNHIDDEN,n.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN})),[2,this]}}))}))},c.prototype.delete=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=wt.of(this._iid).requestQueue,t=new Yc({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.markAsRead=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c=this;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid),n=t.sdkState,r=t.dispatcher,i=t.requestQueue,a=new Hu({channelUrl:this.url}),[4,i.send(a)];case 1:return o=s.sent(),u=o.as(Vu).readStatus,this._updateUnreadMemberState(n.userId,u.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),hc.of(this._iid).handlers.map((function(e){return e.onChannelChanged(c)}))),r.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),[2]}}))}))},c.prototype.markAsDelivered=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ku({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},c.prototype.startTyping=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){return e=wt.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n&&(this._typingStarted=r,this._typingEnded=0,i=new Yu({channelUrl:this.url,time:this._typingStarted}),t.send(i)),[2]}))}))},c.prototype.endTyping=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){return e=wt.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n&&(this._typingStarted=0,this._typingEnded=r,i=new Xu({channelUrl:this.url,time:this._typingStarted}),t.send(i)),[2]}))}))},c.prototype.createScheduledUserMessage=function(e){e=r(r({},Kr),e),ct(function(e){return Pr(e)&&g("number",e.scheduledAt,!0)}(e)).throw(f.invalidParameters);var t=new Dn;return this._createScheduledUserMessage(e,t),t},c.prototype.updateScheduledUserMessage=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},nl),t),ct(function(e){return ga(e)&&g("number",e.scheduledAt,!0)}(n)).throw(f.invalidParameters),i=wt.of(this._iid).requestQueue,a=new sl(r({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,i.send(a)];case 1:return o=s.sent(),[2,o.as(wo).message]}}))}))},c.prototype.createScheduledFileMessage=function(e){var t=this;e=r(r({},Qr),e),ct(function(e){return Lr(e)&&g("number",e.scheduledAt)&&(T(e.file)||g("string",e.fileUrl))&&g("string",e.fileName,!0)&&g("string",e.mimeType,!0)&&g("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return g("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(e)).throw(f.invalidParameters);var n=Date.now(),a=this._generateRequestId(),o=new Dn;return Re(2).then((function(){var r=t._createPendingScheduledFileMessage(e,a,n);De((function(){return i(t,void 0,void 0,(function(){return s(this,(function(e){return[2,o._trigger(null,r)]}))}))}))})),T(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return t._createScheduledFileMessage(e,o,a,n)})):this._createScheduledFileMessage(e,o,a,n),o},c.prototype.updateScheduledFileMessage=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a;return s(this,(function(s){switch(s.label){case 0:return n=r(r({},tl),t),ct(function(e){return va(e)&&g("number",e.scheduledAt,!0)&&(T(e.file)||g("string",e.fileUrl))&&g("string",e.fileName,!0)&&g("string",e.mimeType,!0)&&g("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return g("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(n)).throw(f.invalidParameters),T(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:s.sent(),s.label=2;case 2:return i=new rl(r({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,wt.of(this._iid).requestQueue.send(i)];case 3:return a=s.sent(),[2,a.as(il).message]}}))}))},c.prototype.cancelScheduledMessage=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=new al({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,wt.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.sendScheduledMessageNow=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=new ol({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,wt.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.getMyPushTriggerOption=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new ll({userId:t.userId,channelUrl:this.url}),[4,n.send(r)];case 1:return i=s.sent(),a=i.as(hl).pushTriggerOption,this.myPushTriggerOption=a,[2,a]}}))}))},c.prototype.setMyPushTriggerOption=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return ct(y(e.PushTriggerOption,t)).throw(f.invalidParameters),n=wt.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new ul({userId:r.userId,channelUrl:this.url,pushTriggerOption:t}),[4,i.send(a)];case 1:return o=s.sent(),u=o.as(cl).pushTriggerOption,this.myPushTriggerOption=u,[2,u]}}))}))},c.prototype.setMyCountPreference=function(t){return i(this,void 0,void 0,(function(){var n,r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return ct(y(e.CountPreference,t)).throw(f.invalidParameters),n=wt.of(this._iid),r=n.dispatcher,i=n.sdkState,a=n.requestQueue,o=new Xc({channelUrl:this.url,userId:i.userId,countPreference:t}),[4,a.send(o)];case 1:return u=s.sent(),c=u.as(Zc).countPreference,this.myCountPreference=c,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),r.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_CREATED})),[2,c]}}))}))},c.prototype.resetMyHistory=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t=wt.of(this._iid),n=t.dispatcher,r=t.requestQueue,i=new $c({channelUrl:this.url}),[4,r.send(i)];case 1:return a=s.sent(),o=a.as(el).messageOffsetTimestamp,this.messageOffsetTimestamp=o,n.dispatch(new su({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_RESET_HISTORY})),[2,this]}}))}))},c.prototype.updatePoll=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a;return s(this,(function(s){switch(s.label){case 0:return ct(g("number",e)&&function(e){return g("string",e.title,!0)&&$t(e.data)&&g("boolean",e.allowUserSuggestion,!0)&&g("boolean",e.allowMultipleVotes,!0)&&g("number",e.closeAt,!0)}(t)).throw(f.invalidParameters),n=wt.of(this._iid).requestQueue,i=new dl(r({pollId:e},t)),[4,n.send(i)];case 1:return a=s.sent(),[2,a.as(pl).poll]}}))}))},c.prototype.deletePoll=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return t=g("number",e),ct(t).throw(f.invalidParameters),n=wt.of(this._iid).requestQueue,r=new fl({pollId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},c.prototype.closePoll=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=g("number",e),ct(t).throw(f.invalidParameters),n=wt.of(this._iid).requestQueue,r=new _l({pollId:e}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(vl).poll]}}))}))},c.prototype.addPollOption=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return n=g("number",e)&&g("string",t)&&""!==t.trim(),ct(n).throw(f.invalidParameters),r=wt.of(this._iid).requestQueue,i=new ml({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,r.send(i)];case 1:return a=s.sent(),[2,a.as(gl).poll]}}))}))},c.prototype.updatePollOption=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return r=g("number",e)&&g("number",t)&&g("string",n)&&""!==n.trim(),ct(r).throw(f.invalidParameters),i=wt.of(this._iid).requestQueue,a=new yl({pollId:e,pollOptionId:t,optionText:n}),[4,i.send(a)];case 1:return o=s.sent(),[2,o.as(El).poll]}}))}))},c.prototype.deletePollOption=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return n=g("number",e)&&g("number",t),ct(n).throw(f.invalidParameters),r=wt.of(this._iid).requestQueue,i=new bl({pollId:e,pollOptionId:t}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},c.prototype.votePoll=function(t,n){return i(this,void 0,void 0,(function(){var r,i,a,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return r=g("number",t)&&b("number",n),ct(r).throw(f.invalidParameters),i=wt.of(this._iid),a=i.requestQueue,o=i.dispatcher,u=new Sl({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:t,pollOptionIds:n}),[4,a.send(u)];case 1:return c=s.sent(),l=c.as(oc).event,o.dispatch(new In({event:l,source:e.MessageEventSource.EVENT_POLL_VOTED})),[2,l]}}))}))},c.prototype.getPollChangeLogsSinceTimestamp=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return ct(g("number",e)).throw(f.invalidParameters),[4,lr.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},c.prototype.getPollChangeLogsSinceToken=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return ct(g("string",e,!0)),[4,lr.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},c.prototype.createPollListQuery=function(e){return void 0===e&&(e=10),new _r(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},c.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=20),new gr(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},c.prototype._uploadFileAndUpdateParams=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c,l,h,d;return s(this,(function(s){switch(s.label){case 0:return T(e.file)?(t=wt.of(this._iid).requestQueue,n=new Ut({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:r=s.sent(),i=r.as(Ot),a=i.url,o=i.fileSize,u=void 0===o?e.fileSize:o,c=i.thumbnailSizes,l=void 0===c?e.thumbnailSizes:c,h=i.requireAuth,d=void 0!==h&&h,e.fileUrl=a,e.fileSize=u,e.thumbnailSizes=l,e.requireAuth=d,s.label=2;case 2:return[2]}}))}))},c}(Uo),Ml={},Al=function(){function t(t){var n=t._iid,r=this;this._sync=null,this._metadata=null,this._iid=n;var a,c=wt.of(this._iid),l=c.sdkState,h=c.logger;this._metadataKey=(a=l.userId,"sendbird:".concat(a,"@groupchannel/sync.meta"));var d=function(e){return"sendbird:".concat(e,"@groupchannel/sync")}(l.userId);this._sync=new vc(d,(function(){return i(r,void 0,void 0,(function(){var t,n,r,i,a,c;return s(this,(function(s){switch(s.label){case 0:return t={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:if(s.sent(),h.debug("channel background sync from",this._metadata.token),this._metadata.completed)return[3,9];s.label=2;case 2:return s.trys.push([2,5,,8]),[4,hc.of(this._iid).getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:e.GroupChannelListOrder.CHRONOLOGICAL},100,e.GroupChannelEventSource.SYNC_CHANNEL_BACKGROUND)];case 3:return n=s.sent(),r=n.channels,i=n.token,t.hasNext=r.length>=100&&!!i,t.nextToken=i,this._metadata.token=i,(c=this._metadata.range).extends.apply(c,u([],o(r.map((function(e){return e.createdAt}))),!1)),this._metadata.completed=!t.hasNext,h.debug("channel background sync progress",t),[4,this.saveMetadata()];case 4:return s.sent(),[3,8];case 5:return a=s.sent(),h.debug("channel background sync error",a),a instanceof f&&a.isInvalidTokenError?[4,this.clearMetaData()]:[3,7];case 6:s.sent(),s.label=7;case 7:throw a;case 8:return[3,10];case 9:t.hasNext=!1,t.nextToken="",s.label=10;case 10:return[2,t]}}))}))}))}return t.of=function(e){if(!Ml[e]){var n=Ml[e]=new t({_iid:e});wt.of(e).dispatcher.on((function(e){if(e instanceof he)if(e.stateType===X.CONNECTED)n.resume();else n.pause()}))}return Ml[e]},Object.defineProperty(t.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"completed",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)},enumerable:!1,configurable:!0}),t.prototype.loadMetadata=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,wt.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:"",range:new cc(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!e&&e.completed},t.label=2;case 2:return[2]}}))}))},t.prototype.saveMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._metadata?[4,wt.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.clearMetaData=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,wt.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},t.prototype.resume=function(){var e,t;wt.of(this._iid).logger.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:"")},t.prototype.pause=function(){wt.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},t}(),Ul={},Ol=function(){function t(t){var n=t._iid,r=this;this._sync=null,this._metadataKey=null,this._metadata=null,this._iid=n;var a,o=wt.of(this._iid),u=o.logger,c=o.sdkState;this._metadataKey=(a=c.userId,"sendbird:".concat(a,"@groupchannel/changelogs.meta"));var l=function(e){return"sendbird:".concat(e,"@groupchannel/changelogs")}(c.userId);this._sync=new vc(l,(function(){return i(r,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:s.sent(),u.debug("channel changelog sync from",this._metadata.token),s.label=2;case 2:return s.trys.push([2,5,,8]),[4,hc.of(this._iid).getMyGroupChannelChangeLogs(this._metadata.token,{},e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS)];case 3:return n=s.sent(),r=n.hasMore,i=n.token,t.hasNext=r,t.nextToken=i,this._metadata.token=i,u.debug("channel changelog sync progress",t),[4,this.saveMetadata()];case 4:return s.sent(),[3,8];case 5:return a=s.sent(),u.debug("channel changelog sync error",a),a instanceof f&&a.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:s.sent(),s.label=7;case 7:throw a;case 8:return[2,t]}}))}))}))}return t.of=function(e){if(!Ul[e]){var n=Ul[e]=new t({_iid:e});wt.of(e).dispatcher.on((function(e){if(e instanceof he)if(e.stateType===X.CONNECTED)n.resume();else n.pause()}))}return Ul[e]},t.prototype.loadMetadata=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return this._metadata?[3,2]:(e=wt.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=i.sent(),this._metadata={token:r?r.token:n/1e3},i.label=2;case 2:return[2]}}))}))},t.prototype.saveMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._metadata?[4,wt.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.clearMetadata=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,wt.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}}))}))},t.prototype.resume=function(){this._sync.start(0)},t.prototype.pause=function(){this._sync.stop()},t}(),Rl=function(){function t(t,n){var r=n.filter,i=n.order,s=n.limit,a=this;this.channels=[],this._iid=t,this._key="gcc-".concat(U()),this.filter=null!=r?r:new Qo,this.order=null!=i?i:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=s?s:100;var o=wt.of(this._iid),u=o.sdkState;o.cacheContext.localCacheEnabled&&Al.of(t).resume(),Ol.of(t).resume(),hc.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e.filter((function(e){return a.filter.match(e,u.userId)})),r=e.filter((function(e){return!a.filter.match(e,u.userId)})).map((function(e){return e.url}));n.length>0&&a._addChannelsToView(n,t),r.length>0&&a._removeChannelsFromView(r,t)},onRemove:function(e,t){a._removeChannelsFromView(e,t)}})}return Object.defineProperty(t.prototype,"hasMore",{get:function(){return this._hasMore},enumerable:!1,configurable:!0}),t.prototype.setGroupChannelCollectionHandler=function(e){this._handler=e},t.prototype._addChannelsToView=function(t,n,r){var o,u,c=this;void 0===r&&(r=!1);var l=[],h=[];try{for(var d=a(t),p=d.next();!p.done;p=d.next()){var f=p.value,_=wc(this.channels,f,this.order),v=_.place;if(_.contains)switch(h.push(f),n){case e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED:case e.GroupChannelEventSource.EVENT_MESSAGE_RECEIVED:this.channels.splice(v,1);var m=wc(this.channels,f,this.order).place;this.channels.splice(m,0,f);break;default:this.channels[v]=f}else if(v===this.channels.length){var g=Al.of(this._iid);(r||g.completed)&&(l.push(f),this.channels.push(f))}else l.push(f),this.channels.splice(v,0,f)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(u=d.return)&&u.call(d)}finally{if(o)throw o.error}}iu(n)&&De((function(){return i(c,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new mc(n),l.length>0&&this._handler.onChannelsAdded(e,l),h.length>0&&this._handler.onChannelsUpdated(e,h),[2]}))}))}))},t.prototype._removeChannelsFromView=function(e,t){var n,r,o=this,u=[],c=function(e){var t=l.channels.findIndex((function(t){return t.url===e}));t>=0&&(u.push(l.channels[t].url),l.channels.splice(t,1))},l=this;try{for(var h=a(e),d=h.next();!d.done;d=h.next()){c(d.value)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return iu(t)&&u.length>0&&De((function(){return i(o,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new mc(t),this._handler.onChannelsDeleted(e,u),[2]}))}))})),u},t.prototype._getLocalChannels=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,hc.of(this._iid).getChannelsFromCache(this._token,this.filter,this.order)];case 1:return[2,e.sent()]}}))}))},t.prototype._getRemoteChannels=function(){return i(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(i){switch(i.label){case 0:return[4,hc.of(this._iid).getMyGroupChannels(this._token,r(r({},this.filter),{order:this.order}),this._limit)];case 1:return e=i.sent(),t=e.channels,n=e.token,this._token=n,this._hasMore=!!n,[2,t]}}))}))},t.prototype.loadMore=function(){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return this._hasMore?(t=[],[4,Pe((function(){return i(n,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._getLocalChannels()];case 1:return t=e.sent(),[2]}}))}))}))]):[3,3];case 1:return r.sent(),[4,Pe((function(){return i(n,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._getRemoteChannels()];case 1:return t=e.sent(),[2]}}))}))}))];case 2:return r.sent(),this._addChannelsToView(t,e.GroupChannelEventSource.REQUEST_CHANNEL,!0),[2,t];case 3:return[2,[]]}}))}))},t.prototype.dispose=function(){wt.of(this._iid).cacheContext.localCacheEnabled&&Al.of(this._iid).pause(),Ol.of(this._iid).pause(),hc.of(this._iid).unsubscribeGroupChannelEvent(this._key)},t}(),Ll=function(t){function r(n){var r=this,i=n.token,s=n.limit,a=n.order,o=n.includeEmpty,u=n.membershipFilter,c=n.channelNameContainsFilter,l=n.channelUrlsFilter,h=n.customTypesFilter,p=n.customTypeStartsWithFilter,f=n.superChannelFilter,_=n.metadataOrderKeyFilter,v=n.metadataKey,m=n.metadataValues,g=n.metadataValueStartsWith,y=n.includeFrozen,E=n.includeMetaData;return(r=t.call(this)||this).method=d.GET,r.path=ve,r.params=D({token:i,limit:s,order:a,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:o,public_mode:e.PublicChannelFilter.PUBLIC,public_membership_mode:u,name_contains:c,channel_urls:l,custom_types:h,custom_type_startswith:p,super_mode:f,metadata_order_key:_,metadata_key:v,metadata_values:m,metadata_value_startswith:g,show_frozen:y,show_metadata:E}),r}return n(r,t),r}(x),kl=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var i=n.next,s=n.channels,a=n.ts;return r.token=i,s&&s.length>0&&(r.channels=s.map((function(e){return e.ts=a,new wl(t,e)}))),r.ts="number"==typeof a?a:null,r}return n(t,e),t}(F);e.MembershipFilter=void 0,(Nl=e.MembershipFilter||(e.MembershipFilter={})).ALL="all",Nl.JOINED="joined";var Dl=function(t){function a(n,r){var i,s,a,o,u,c,l,h,d,p,f,_,v,m,g=this;return(g=t.call(this,n,r)||this).includeEmpty=!1,g.includeFrozen=!0,g.includeMetaData=!0,g.channelUrlsFilter=null,g.customTypesFilter=null,g.customTypeStartsWithFilter=null,g.channelNameContainsFilter=null,g.membershipFilter=e.MembershipFilter.ALL,g.superChannelFilter=e.SuperChannelFilter.ALL,g.metadataKey=null,g.metadataValues=null,g.metadataOrderKeyFilter=null,g.metadataValueStartsWith=null,g.order=e.PublicGroupChannelListOrder.CHRONOLOGICAL,g.includeEmpty=null!==(i=r.includeEmpty)&&void 0!==i&&i,g.includeFrozen=null===(s=r.includeFrozen)||void 0===s||s,g.includeMetaData=null===(a=r.includeMetaData)||void 0===a||a,g.channelUrlsFilter=null!==(o=r.channelUrlsFilter)&&void 0!==o?o:null,g.customTypesFilter=null!==(u=r.customTypesFilter)&&void 0!==u?u:null,g.customTypeStartsWithFilter=null!==(c=r.customTypeStartsWithFilter)&&void 0!==c?c:null,g.channelNameContainsFilter=null!==(l=r.channelNameContainsFilter)&&void 0!==l?l:null,g.membershipFilter=null!==(h=r.membershipFilter)&&void 0!==h?h:e.MembershipFilter.ALL,g.superChannelFilter=null!==(d=r.superChannelFilter)&&void 0!==d?d:e.SuperChannelFilter.ALL,g.metadataKey=null!==(p=r.metadataKey)&&void 0!==p?p:null,g.metadataValues=null!==(f=r.metadataValues)&&void 0!==f?f:null,g.metadataOrderKeyFilter=null!==(_=r.metadataOrderKeyFilter)&&void 0!==_?_:null,g.metadataValueStartsWith=null!==(v=r.metadataValueStartsWith)&&void 0!==v?v:null,g.order=null!==(m=r.order)&&void 0!==m?m:e.PublicGroupChannelListOrder.CHRONOLOGICAL,g}return n(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&g("boolean",this.includeEmpty)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.channelNameContainsFilter,!0)&&b("string",this.channelUrlsFilter,!0)&&b("string",this.customTypesFilter,!0)&&g("string",this.customTypeStartsWithFilter,!0)&&y(e.MembershipFilter,this.membershipFilter)&&y(e.SuperChannelFilter,this.superChannelFilter)&&y(e.PublicGroupChannelListOrder,this.order)&&g("string",this.metadataOrderKeyFilter,!0)&&g("string",this.metadataKey,!0)&&b("string",this.metadataValues,!0)&&g("string",this.metadataValueStartsWith,!0)},a.prototype.next=function(){return i(this,void 0,void 0,(function(){var t,n,i,a,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:(t=[],this._hasNext?(this._isLoading=!0,n=wt.of(this._iid),i=n.requestQueue,a=n.dispatcher,o=new Ll(r(r({},this),{token:this._token})),[4,i.send(o)]):[3,2]):[3,5];case 1:return u=s.sent(),c=u.as(kl),l=c.channels,h=c.token,this._token=h,this._hasNext=!!h,a.dispatch(new su({channels:l,source:e.GroupChannelEventSource.REQUEST_CHANNEL})),this._isLoading=!1,[2,l];case 2:return[2,t];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},a}(Fn),Pl=function(){this.onUserMuted=J,this.onUserUnmuted=J,this.onUserBanned=J,this.onUserUnbanned=J,this.onChannelChanged=J,this.onChannelDeleted=J,this.onChannelFrozen=J,this.onChannelUnfrozen=J,this.onOperatorUpdated=J,this.onChannelMemberCountChanged=J,this.onMetaDataCreated=J,this.onMetaDataUpdated=J,this.onMetaDataDeleted=J,this.onMetaCounterCreated=J,this.onMetaCounterUpdated=J,this.onMetaCounterDeleted=J,this.onMessageReceived=J,this.onMessageUpdated=J,this.onMessageDeleted=J,this.onMentionReceived=J,this.onReactionUpdated=J,this.onThreadInfoUpdated=J},xl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUserJoined=J,t.onUserLeft=J,t.onUserReceivedInvitation=J,t.onUserDeclinedInvitation=J,t.onChannelHidden=J,t.onUnreadMemberStatusUpdated=J,t.onUndeliveredMemberStatusUpdated=J,t.onTypingStatusUpdated=J,t.onPollUpdated=J,t.onPollVoted=J,t.onPollDeleted=J,t}return n(t,e),t}(Pl),Fl=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return n(t,e),t}(xl),ql=function(e){function t(t){var n=this,r=t.token,i=t.limit,s=t.order,a=t.reverse,o=t.channelUrl,u=t.messageTypeFilter,c=t.scheduledStatus;return(n=e.call(this)||this).method=d.GET,n.path="".concat(Se),n.params=D({limit:i,reverse:a,channel_url:o,order:s,status:c}),r&&(n.params.token=r),u&&(n.params.message_type=u),n}return n(t,e),t}(x),Gl=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.scheduledMessages=[];var i=n.next,s=n.scheduled_messages;return r.token=i,r.scheduledMessages=s.map((function(e){return sn(t,e)})),r}return n(t,e),t}(F),Hl=function(t){function a(n,r){var i,s,a,o,u,c=this;return(c=t.call(this,n,r)||this).channelUrl=null,c.order=null,c.reverse=!1,c.scheduledStatus=null,c.messageTypeFilter=e.MessageTypeFilter.ALL,c.channelUrl=null!==(i=r.channelUrl)&&void 0!==i?i:null,c.order=null!==(s=r.order)&&void 0!==s?s:null,c.reverse=null!==(a=r.reverse)&&void 0!==a&&a,c.scheduledStatus=null!==(o=r.scheduledStatus)&&void 0!==o?o:null,c.messageTypeFilter=null!==(u=r.messageTypeFilter)&&void 0!==u?u:e.MessageTypeFilter.ALL,c}return n(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&g("string",this.channelUrl,!0)&&(y(e.ScheduledMessageListOrder,this.order)||null===this.order)&&g("boolean",this.reverse)&&(b(e.ScheduledStatus,this.scheduledStatus)||null===this.scheduledStatus)&&y(e.MessageTypeFilter,this.messageTypeFilter)},a.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new ql(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(Gl),a=i.scheduledMessages,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},a}(Fn),Vl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="groupChannel",t}return n(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new hc(t,{sdkState:r,cacheContext:c,dispatcher:i,sessionManager:s,requestQueue:a,logger:o})},t.prototype.createGroupChannelCollection=function(e){return void 0===e&&(e={}),new Rl(this._iid,e)},t.prototype.createMyGroupChannelListQuery=function(e){return void 0===e&&(e={}),new uc(this._iid,e)},t.prototype.createPublicGroupChannelListQuery=function(e){return void 0===e&&(e={}),new Dl(this._iid,e)},t.prototype.createScheduledMessageListQuery=function(e){return void 0===e&&(e={}),new Hl(this._iid,e)},t.prototype.addGroupChannelHandler=function(e,t){ct(g("string",e)&&t instanceof Fl).throw(f.invalidParameters),this._manager.addHandler(e,t)},t.prototype.removeGroupChannelHandler=function(e){ct(g("string",e)).throw(f.invalidParameters),this._manager.removeHandler(e)},t.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},t.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},t.prototype.getChannel=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return ct(g("string",e)).throw(f.invalidParameters),[2,this._manager.getChannel(e)]}))}))},t.prototype.getChannelWithoutCache=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return ct(g("string",e)).throw(f.invalidParameters),[2,this._manager.getChannelWithoutCache(e)]}))}))},t.prototype.getMyGroupChannelChangeLogsByToken=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},Jo),t),ct(g("string",e)&&Xo(n)).throw(f.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,i.sent()]}}))}))},t.prototype.getMyGroupChannelChangeLogsByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=r(r({},Jo),t),ct(g("number",e)&&Xo(n)).throw(f.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,i.sent()]}}))}))},t.prototype.getGroupChannelCount=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=r(r({},Zo),e),ct($o(t)).throw(f.invalidParameters),[2,this._manager.getGroupChannelCount(t)]}))}))},t.prototype.getUnreadItemCount=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._manager.getUnreadItemCount(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getTotalUnreadChannelCount=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._manager.getTotalUnreadChannelCount()];case 1:return[2,e.sent()]}}))}))},t.prototype.getTotalUnreadMessageCount=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalScheduledMessageCount(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getSubscribedTotalUnreadMessageCount=function(){return this._manager.getSubscribedTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)},t.prototype.createChannel=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=r(r({},Wo),e),ct(Yo(t)).throw(f.invalidParameters),[2,this._manager.createChannel(t)]}))}))},t.prototype.createDistinctChannelIfNotExist=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=r(r({},Wo),e),ct(Yo(t)).throw(f.invalidParameters),t&&(t.isDistinct=!0),[2,this.createChannel(t)]}))}))},t.prototype.createChannelWithUserIds=function(e,t,n,a,o,u){return void 0===t&&(t=!1),void 0===n&&(n=null),void 0===a&&(a=null),void 0===o&&(o=""),void 0===u&&(u=""),i(this,void 0,void 0,(function(){var i;return s(this,(function(s){return i=r(r({},Wo),{invitedUserIds:e,isDistinct:t,name:n,data:o,customType:u}),"string"==typeof a?i.coverUrl=a:i.coverImage=a,[2,this.createChannel(i)]}))}))},t.prototype.markAsReadAll=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return this._manager.markAsReadAll(),[2]}))}))},t.prototype.markAsReadWithChannelUrls=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return ct(b("string",e)).throw(f.invalidParameters),this._manager.markAsReadWithChannelUrls(e),[2]}))}))},t.prototype.markAsDelivered=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},t}(At),Kl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._channels=new Map,t._enteredChannelUrls=[],t}return n(t,e),Object.defineProperty(t.prototype,"enteredChannels",{get:function(){var e=this;return this._enteredChannelUrls.map((function(t){return e._channels.get(t)})).filter((function(e){return null!==e}))},enumerable:!1,configurable:!0}),t.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},t.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},t.prototype.exit=function(e){var t=this._enteredChannelUrls.indexOf(e);t>=0&&this._enteredChannelUrls.splice(t,1)},t.prototype.exitAll=function(){this._enteredChannelUrls=[]},t.prototype.get=function(e){var t;return i(this,void 0,void 0,(function(){return s(this,(function(n){return[2,null!==(t=this._channels.get(e))&&void 0!==t?t:null]}))}))},t.prototype.upsert=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){return e.forEach((function(e){if(t._channels.has(e.url)){var n=t._channels.get(e.url);Object.assign(n,e)}else t._channels.set(e.url,e)})),[2]}))}))},t.prototype.remove=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return this._channels.delete(e),this.exit(e),[2]}))}))},t.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]}))}))},t}(We),Ql={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},Bl=function(e){function t(t){var n=t.channelUrl,r=t.isInternalCall,i=e.call(this)||this;return i.method=d.GET,i.path="".concat(r?ye:ge,"/").concat(encodeURIComponent(n)),i}return n(t,e),t}(x),jl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=null,r.channel=new oh(t,n),r}return n(t,e),t}(F),zl=function(e){function t(t){var n=this,r=t.channelUrl,i=t.coverUrlOrImage,s=t.name,a=t.data,o=t.customType,u=t.operatorUserIds;return(n=e.call(this)||this).method=d.POST,n.path=ge,n.params=D({channel_url:r,cover_url:g("string",i)?i:null,cover_file:T(i)?i:null,name:s,data:a,custom_type:o,operators:u}),n}return n(t,e),t}(x);!function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new oh(t,n),r}n(t,e)}(F);var Wl=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"ENTR",payload:{channel_url:n},ackRequired:!0})||this}return n(t,e),t}(z),Yl=function(e){function t(t,n,r){var i,s,a=this;return a=e.call(this,t,"ENTR",r)||this,r.data&&(a.participantCount=null!==(i=r.data.participant_count)&&void 0!==i?i:0,a.user=new ht(t,r.data),a.ts=null!==(s=r.data.edge_ts)&&void 0!==s?s:0),a}return n(t,e),t}(j),Jl=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"EXIT",payload:{channel_url:n},ackRequired:!0})||this}return n(t,e),t}(z),Xl=function(e){function t(t,n,r){var i,s,a=this;return a=e.call(this,t,"EXIT",r)||this,r.data&&(a.participantCount=null!==(i=r.data.participant_count)&&void 0!==i?i:0,a.user=new ht(t,r.data),a.ts=null!==(s=r.data.edge_ts)&&void 0!==s?s:0),a}return n(t,e),t}(j),Zl={},$l=function(){function t(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=this;this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._openChannelCache=new Kl(e),this._openChannelHandlers=new Map,this._dispatcher.on((function(e){var t,n;if(e instanceof j)s._handleEvent(e);else if(e instanceof he&&e.stateType===X.CONNECTED){var r=s._openChannelCache.enteredChannels;try{for(var i=a(r),o=i.next();!o.done;o=i.next()){o.value.enter()}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}})),Zl[e]=this}return t.of=function(e){return Zl[e]},t.prototype.buildOpenChannelFromSerializedData=function(e){var t=ut(e);return new oh(t._iid,oh.payloadify(t))},t.prototype.getChannelFromCache=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._openChannelCache.get(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.upsertChannelsToCache=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._openChannelCache.upsert(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.removeChannelsFromCache=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),t=a(e),n=t.next(),s.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._openChannelCache.remove(r)]);case 2:s.sent(),s.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return i=s.sent(),o={error:i},[3,7];case 6:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 7:return[2]}}))}))},t.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},t.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},t.prototype._handleEvent=function(t){return i(this,void 0,void 0,(function(){var n,r,o,u,c,l,h,d,f,_,v,m,g,y,E,b,C,T,I,S,N,w,M,A,U,O,R,L,k,D,P,x,F,q,G,H,V,K,Q,B,j,z,W,Y,J,X,Z,$,ee,te,ne,re,ie,se,ae,oe,ue,ce,le,he=this;return s(this,(function(de){switch(de.label){case 0:switch(de.trys.push([0,51,,52]),t.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"SYEV":return[3,27]}return[3,50];case 1:return u=null,"MESG"===t.code?u=t.as(ho):"FILE"===t.code?u=t.as(cn):"ADMM"!==t.code&&"BRDM"!=t.code||(u=t.as(nc)),u?(n=u.message,r=u.isMentioned,n.channelType!==e.ChannelType.OPEN?[3,3]:[4,this.getChannel(n.channelUrl,!0)]):[3,3];case 2:o=de.sent(),De((function(){return i(he,void 0,void 0,(function(){var e,t,i,u,c;return s(this,(function(s){try{for(e=a(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())i=t.value,this._openChannelCache.isEnteredChannel(o.url)&&i.onMessageReceived(o,n),r&&i.onMentionReceived(o,n)}catch(e){u={error:e}}finally{try{t&&!t.done&&(c=e.return)&&c.call(e)}finally{if(u)throw u.error}}return[2]}))}))})),de.label=3;case 3:return[3,50];case 4:return u=null,"MEDI"===t.code?u=t.as(fo):"FEDI"===t.code?u=t.as(vo):"AEDI"===t.code&&(u=t.as(rc)),u?(c=u.message).channelType!==e.ChannelType.OPEN?[3,6]:[4,this.getChannel(c.channelUrl,!0)]:[3,6];case 5:l=de.sent(),De((function(){return i(he,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){try{for(e=a(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())n=t.value,this._openChannelCache.isEnteredChannel(l.url)&&n.onMessageUpdated(l,c)}catch(e){r={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),de.label=6;case 6:return[3,50];case 7:return h=t.as(yo),N=h.channelUrl,v=h.channelType,d=h.messageId,v!==e.ChannelType.OPEN?[3,9]:[4,this.getChannel(N,!0)];case 8:f=de.sent(),De((function(){return i(he,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){try{for(e=a(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())n=t.value,this._openChannelCache.isEnteredChannel(f.url)&&n.onMessageDeleted(f,d)}catch(e){r={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),de.label=9;case 9:return[3,50];case 10:return _=t.as(ic),N=_.channelUrl,v=_.channelType,m=_.event,v!==e.ChannelType.OPEN?[3,12]:[4,this.getChannel(N,!0)];case 11:g=de.sent(),De((function(){return i(he,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onReactionUpdated(g,m)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),de.label=12;case 12:return[3,50];case 13:return(y=t.as(sc).event).channelType!==e.ChannelType.OPEN?[3,15]:[4,this.getChannel(y.channelUrl,!0)];case 14:E=de.sent(),De((function(){return i(he,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onThreadInfoUpdated(E,y)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),de.label=15;case 15:return[3,50];case 16:b=t.as(ec).openChannelMemberCounts,C=[],de.label=17;case 17:de.trys.push([17,22,23,24]),T=a(b),I=T.next(),de.label=18;case 18:return I.done?[3,21]:(S=I.value,N=S.channelUrl,x=S.participantCount,w=S.updatedAt,[4,this.getChannelFromCache(N)]);case 19:(M=de.sent())&&M._updateParticipantCount(x,w)&&C.push(M),de.label=20;case 20:return I=T.next(),[3,18];case 21:return[3,24];case 22:return A=de.sent(),ce={error:A},[3,24];case 23:try{I&&!I.done&&(le=T.return)&&le.call(T)}finally{if(ce)throw ce.error}return[7];case 24:return C.length>0?[4,this.upsertChannelsToCache(C)]:[3,26];case 25:de.sent(),De((function(){return i(he,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){try{for(e=a(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelMemberCountChanged(C)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),de.label=26;case 26:return[3,50];case 27:if(!(U=t.as(Au).event).isOpenChannelEvent)return[3,49];switch(U.category){case Ko.CHANNEL_ENTER:return[3,28];case Ko.CHANNEL_EXIT:return[3,30];case Ko.CHANNEL_OPERATOR_UPDATE:return[3,32];case Ko.USER_CHANNEL_MUTE:case Ko.USER_CHANNEL_UNMUTE:return[3,34];case Ko.USER_CHANNEL_BAN:case Ko.USER_CHANNEL_UNBAN:return[3,36];case Ko.CHANNEL_FREEZE:case Ko.CHANNEL_UNFREEZE:return[3,38];case Ko.CHANNEL_DELETED:return[3,40];case Ko.CHANNEL_PROP_CHANGED:return[3,43];case Ko.CHANNEL_META_DATA_CHANGED:return[3,45];case Ko.CHANNEL_META_COUNTERS_CHANGED:return[3,47]}return[3,49];case 28:return[4,this.getChannel(U.channelUrl,!0)];case 29:return O=de.sent(),R=t.as(Yl),x=R.participantCount,L=R.user,k=O._updateParticipantCount(x,U.ts),De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onUserEntered(O,L),k&&e.onChannelParticipantCountChanged(O)})),[2]}))}))})),[3,49];case 30:return[4,this.getChannel(U.channelUrl,!0)];case 31:return D=de.sent(),P=t.as(Xl),x=P.participantCount,F=P.user,q=D._updateParticipantCount(x,U.ts),De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onUserExited(D,F),q&&e.onChannelParticipantCountChanged(D)})),[2]}))}))})),[3,49];case 32:return[4,this.getChannel(U.channelUrl,!0)];case 33:return G=de.sent(),H=t.as($u).operators,G.operators=H,this.upsertChannelsToCache([G]),De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onOperatorUpdated(G,H)})),[2]}))}))})),[3,49];case 34:return[4,this.getChannel(U.channelUrl,!0)];case 35:return V=de.sent(),K=U.category===Ko.USER_CHANNEL_MUTE,Q=t.as(K?Za:eo).user,De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){K?e.onUserMuted(V,Q):e.onUserUnmuted(V,Q)})),[2]}))}))})),[3,49];case 36:return[4,this.getChannel(U.channelUrl,!0)];case 37:return B=de.sent(),j=U.category===Ko.USER_CHANNEL_BAN,z=t.as(j?no:io).user,De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){j?e.onUserBanned(B,z):e.onUserUnbanned(B,z)})),[2]}))}))})),[3,49];case 38:return[4,this.getChannel(U.channelUrl,!0)];case 39:return W=de.sent(),Y=t.as(ao).freeze,W.isFrozen=Y,this.upsertChannelsToCache([W]),De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){Y?e.onChannelFrozen(W):e.onChannelUnfrozen(W)})),[2]}))}))})),[3,49];case 40:return[4,this.getChannel(U.channelUrl,!0)];case 41:return J=de.sent(),[4,this.removeChannelsFromCache([J.url])];case 42:return de.sent(),De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onChannelDeleted(J.url,J.channelType)})),[2]}))}))})),[3,49];case 43:return[4,this.getChannelWithoutCache(U.channelUrl,!0)];case 44:return X=de.sent(),De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onChannelChanged(X)})),[2]}))}))})),[3,49];case 45:return[4,this.getChannel(U.channelUrl,!0)];case 46:return Z=de.sent(),$=t.as(xa),ee=$.created,te=$.updated,ne=$.deleted,ee&&Z._upsertCachedMetaData(ee,U.ts),te&&Z._upsertCachedMetaData(te,U.ts),ne&&Z._removeFromCachedMetaData(ne,U.ts),De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){ee&&e.onMetaDataCreated(Z,ee),te&&e.onMetaDataUpdated(Z,te),ne&&e.onMetaDataDeleted(Z,ne)})),[2]}))}))})),[3,49];case 47:return[4,this.getChannel(U.channelUrl,!0)];case 48:return re=de.sent(),ie=t.as(Wa),se=ie.created,ae=ie.updated,oe=ie.deleted,De((function(){return i(he,void 0,void 0,(function(){return s(this,(function(e){return this._openChannelHandlers.forEach((function(e){se&&e.onMetaCounterCreated(re,se),ae&&e.onMetaCounterUpdated(re,ae),oe&&e.onMetaCounterDeleted(re,oe)})),[2]}))}))})),[3,49];case 49:return[3,50];case 50:return[3,52];case 51:if(ue=de.sent(),p(ue))throw ue;return[3,52];case 52:return[2]}}))}))},t.prototype.addHandler=function(e,t){this._openChannelHandlers.set(e,t)},t.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},t.prototype.clearHandler=function(){this._openChannelHandlers.clear()},t.prototype.getChannel=function(e,t){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:ct(g("string",e)).throw(f.invalidParameters),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(t=n.sent())?[2,t]:[3,4];case 3:return n.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e)];case 5:return[2,n.sent()]}}))}))},t.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return ct(g("string",e)).throw(f.invalidParameters),n=new Bl({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:return r=s.sent(),i=r.as(jl).channel,[4,this.upsertChannelsToCache([i])];case 2:return s.sent(),[2,i]}}))}))},t.prototype.createChannel=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a;return s(this,(function(s){switch(s.label){case 0:return t=r(r({},Ql),e),ct(function(e){return b("string",e.operatorUserIds,!0)&&(g("string",e.coverUrlOrImage)||T(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&(g("string",e.channelUrl)&&/^\w+$/.test(e.channelUrl)||null===e.channelUrl)}(t)).throw(f.invalidParameters),n=new zl(t),[4,this._requestQueue.send(n)];case 1:return i=s.sent(),a=i.as(jl).channel,this.upsertChannelsToCache([a]),[2,a]}}))}))},t}(),eh={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},th=function(e){function t(t){var n=this,r=t.channelUrl,i=t.token,s=t.limit;return(n=e.call(this)||this).method=d.GET,n.path="".concat(ge,"/").concat(encodeURIComponent(r),"/participants"),n.params={token:i,limit:s},n}return n(t,e),t}(x),nh=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.participants=[];var i=n.next,s=n.participants;return r.token=i,r.participants=s.map((function(e){return new ht(t,e)})),r}return n(t,e),t}(F),rh=function(t){function a(n,r,i){return t.call(this,n,r,e.ChannelType.OPEN,i)||this}return n(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)},a.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new th(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),i=n.as(nh),a=i.participants,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},a}(Bn),ih=function(e){function t(t){var n=this,r=t.channelUrl,i=t.coverUrlOrImage,s=t.name,a=t.data,o=t.customType,u=t.operatorUserIds;return(n=e.call(this)||this).method=d.PUT,n.path="".concat(ge,"/").concat(encodeURIComponent(r)),n.params=D({cover_url:g("string",i)?i:null,cover_file:T(i)?i:null,name:s,data:a,custom_type:o,operators:u}),n}return n(t,e),t}(x),sh=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new oh(t,n),r}return n(t,e),t}(F),ah=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=d.DELETE,n.path="".concat(ge,"/").concat(encodeURIComponent(r)),n}return n(t,e),t}(x);!function(e){function t(t,n){return e.call(this,t,n)||this}n(t,e)}(F);var oh=function(t){function a(n,r){var i,s=this;return(s=t.call(this,n,r)||this)._lastParticipantCountUpdated=0,s.participantCount=0,s.operators=[],s.channelType=e.ChannelType.OPEN,s.participantCount=null!==(i=r.participant_count)&&void 0!==i?i:0,s.operators=Array.isArray(r.operators)?r.operators.map((function(e){return new ht(n,e)})):[],s}return n(a,t),a.payloadify=function(e){return e?D(r(r({},Uo.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map((function(e){return ht.payloadify(e)}))})):null},a.prototype.serialize=function(){return ot(this)},a.prototype.isOperator=function(e){return e instanceof ht?this.isOperator(e.userId):this.operators.some((function(t){return t.userId===e}))},a.prototype._updateParticipantCount=function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)},a.prototype.createParticipantListQuery=function(e){return new rh(this._iid,this.url,e)},a.prototype.refresh=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,$l.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}}))}))},a.prototype.enter=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid).requestQueue,t=new Wl({channelUrl:this.url}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(Yl),i=r.participantCount,a=r.ts,this._updateParticipantCount(i,a),$l.of(this._iid).setEnteredToCache(this),[2]}}))}))},a.prototype.exit=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=wt.of(this._iid).requestQueue,t=new Jl({channelUrl:this.url}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(Xl),i=r.participantCount,a=r.ts,this._updateParticipantCount(i,a),$l.of(this._iid).setExitedToCache(this),kn.of(this._iid).fileMessageQueue.cancel(this),[2]}}))}))},a.prototype.updateChannel=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t=r(r({},eh),e),ct(function(e){return b("string",e.operatorUserIds,!0)&&(g("string",e.coverUrlOrImage)||T(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)}(t)).throw(f.invalidParameters),n=wt.of(this._iid).requestQueue,i=new ih(r({channelUrl:this.url},t)),[4,n.send(i)];case 1:return a=s.sent(),o=a.as(sh).channel,[4,$l.of(this._iid).upsertChannelsToCache([o])];case 2:return s.sent(),[2,o]}}))}))},a.prototype.updateChannelWithOperatorUserIds=function(e,t,n,a,o){return i(this,void 0,void 0,(function(){var i;return s(this,(function(s){return i=r(r({},eh),{name:e,coverUrlOrImage:t,data:n,operatorUserIds:a,customType:o}),[2,this.updateChannel(i)]}))}))},a.prototype.delete=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=wt.of(this._iid).requestQueue,t=new ah({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[4,$l.of(this._iid).removeChannelsFromCache([this.url])];case 2:return n.sent(),[2]}}))}))},a}(Uo),uh=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUserEntered=J,t.onUserExited=J,t.onChannelParticipantCountChanged=J,t}return n(t,e),t}(Pl),ch=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return n(t,e),t}(uh),lh=function(e){function t(t){var n=this,r=t.token,i=t.limit,s=t.nameKeyword,a=t.urlKeyword,o=t.customTypes,u=t.includeFrozen,c=t.includeMetaData;return(n=e.call(this)||this).method=d.GET,n.path=ge,n.params=D({token:r,limit:i,name_contains:s,url_contains:a,custom_types:o,show_frozen:u,show_metadata:c}),n}return n(t,e),t}(x),hh=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var i=n.next,s=n.channels,a=n.ts;return r.token=i,s&&s.length>0&&(r.channels=s.map((function(e){return new oh(t,e)}))),r.ts="number"==typeof a?a:null,r}return n(t,e),t}(F),dh=function(e){function t(t,n){var r,i,s,a,o,u=this;return(u=e.call(this,t,n)||this).includeFrozen=!0,u.includeMetaData=!0,u.nameKeyword=null,u.urlKeyword=null,u.customTypes=null,u.includeFrozen=null===(r=n.includeFrozen)||void 0===r||r,u.includeMetaData=null===(i=n.includeMetaData)||void 0===i||i,u.nameKeyword=null!==(s=n.nameKeyword)&&void 0!==s?s:null,u.urlKeyword=null!==(a=n.urlKeyword)&&void 0!==a?a:null,u.customTypes=null!==(o=n.customTypes)&&void 0!==o?o:null,u}return n(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.nameKeyword,!0)&&g("string",this.urlKeyword,!0)&&b("string",this.customTypes,!0)},t.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,e=wt.of(this._iid).requestQueue,t=new lh(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,3]:[3,6];case 1:return n=s.sent(),i=n.as(hh),a=i.channels,o=i.token,this._token=o,this._hasNext=!!o,[4,$l.of(this._iid).upsertChannelsToCache(a)];case 2:return s.sent(),this._isLoading=!1,[2,a];case 3:return[2,[]];case 4:throw f.queryInProgress;case 5:return[3,7];case 6:throw f.invalidParameters;case 7:return[2]}}))}))},t}(Fn),ph=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="openChannel",t}return n(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new $l(t,{sdkState:r,dispatcher:i,requestQueue:a})},t.prototype.createOpenChannelListQuery=function(e){return void 0===e&&(e={}),new dh(this._iid,e)},t.prototype.addOpenChannelHandler=function(e,t){this._manager.addHandler(e,t)},t.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},t.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},t.prototype.getChannel=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this._manager.getChannel(e)]}))}))},t.prototype.getChannelWithoutCache=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this._manager.getChannelWithoutCache(e)]}))}))},t.prototype.createChannel=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this._manager.createChannel(e)]}))}))},t.prototype.createChannelWithOperatorUserIds=function(e,t,n,a,o){return i(this,void 0,void 0,(function(){var i;return s(this,(function(s){return(i=r({},Ql)).name=e,i.coverUrlOrImage=t,i.data=n,i.operatorUserIds=a,i.customType=o,[2,this._manager.createChannel(i)]}))}))},t}(At);return e.AdminMessage=Yt,e.AppleCriticalAlertOptions=Gt,e.ApplicationUserListQuery=ss,e.BannedUserListQuery=Ma,e.BaseChannel=Uo,e.BaseMessage=Kt,e.BlockedUserListQuery=us,e.ConnectionHandler=Cr,e.Emoji=Wi,e.EmojiCategory=Yi,e.EmojiContainer=Ji,e.FileMessage=an,e.FriendListQuery=hs,e.GroupChannel=wl,e.GroupChannelCollection=Rl,e.GroupChannelEventContext=mc,e.GroupChannelFilter=Qo,e.GroupChannelHandler=Fl,e.GroupChannelListQuery=uc,e.GroupChannelModule=Vl,e.Member=Ho,e.MemberListQuery=Qc,e.MemoryStore=ra,e.MessageCollection=qc,e.MessageCollectionInitHandler=Fc,e.MessageEventContext=gc,e.MessageFilter=Ar,e.MessageMetaArray=xt,e.MessageModule=Wn,e.MessageRequestHandler=Dn,e.MessageSearchQuery=Qn,e.MutedUserListQuery=Sa,e.OGImage=Ft,e.OGMetaData=qt,e.OpenChannel=oh,e.OpenChannelHandler=ch,e.OpenChannelListQuery=dh,e.OpenChannelModule=ph,e.OperatorListQuery=Ca,e.ParticipantListQuery=rh,e.Plugin=Jt,e.PreviousMessageListQuery=jn,e.PublicGroupChannelListQuery=Dl,e.Reaction=Pt,e.ReactionEvent=Dt,e.ReadStatus=Vo,e.RestrictedUser=fa,e.RestrictionInfo=pa,e.ScheduledMessageListQuery=Hl,e.SendbirdChat=Ro,e.SendbirdChatOptions=I,e.SendbirdError=f,e.Sender=Qt,e.SessionHandler=br,e.ThreadInfo=Rt,e.ThreadInfoUpdateEvent=Pn,e.Thumbnail=jt,e.User=ht,e.UserEventHandler=Tr,e.UserMessage=nn,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
